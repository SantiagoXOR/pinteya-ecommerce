<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Console Logs - Trending Searches</title>
    <style>
      body {
        font-family: 'Courier New', monospace;
        margin: 0;
        padding: 20px;
        background-color: #1e1e1e;
        color: #d4d4d4;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .header {
        background: #2d2d30;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .log-container {
        background: #252526;
        border: 1px solid #3e3e42;
        border-radius: 8px;
        padding: 15px;
        max-height: 600px;
        overflow-y: auto;
        font-size: 14px;
        line-height: 1.4;
      }
      .log-entry {
        margin: 5px 0;
        padding: 5px;
        border-left: 3px solid transparent;
      }
      .log-info {
        border-left-color: #007acc;
      }
      .log-warn {
        border-left-color: #ffcc02;
        background: rgba(255, 204, 2, 0.1);
      }
      .log-error {
        border-left-color: #f14c4c;
        background: rgba(241, 76, 76, 0.1);
      }
      .log-success {
        border-left-color: #89d185;
        background: rgba(137, 209, 133, 0.1);
      }
      .timestamp {
        color: #858585;
        font-size: 12px;
      }
      .controls {
        margin-bottom: 20px;
      }
      button {
        background: #0e639c;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
        font-size: 14px;
      }
      button:hover {
        background: #1177bb;
      }
      .clear-btn {
        background: #a74a45;
      }
      .clear-btn:hover {
        background: #c5504b;
      }
      .filter-btn {
        background: #6f42c1;
      }
      .filter-btn:hover {
        background: #8a5cf5;
      }
      .stats {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }
      .stat-item {
        background: #2d2d30;
        padding: 10px 15px;
        border-radius: 4px;
        text-align: center;
      }
      .stat-number {
        font-size: 24px;
        font-weight: bold;
        color: #4fc3f7;
      }
      .stat-label {
        font-size: 12px;
        color: #858585;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîç Debug Console Logs - Trending Searches</h1>
        <p>Capturando logs de consola para debugging de trending searches</p>
      </div>

      <div class="stats">
        <div class="stat-item">
          <div class="stat-number" id="total-logs">0</div>
          <div class="stat-label">Total Logs</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="trending-logs">0</div>
          <div class="stat-label">Trending Logs</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="error-logs">0</div>
          <div class="stat-label">Errores</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="hook-logs">0</div>
          <div class="stat-label">Hook Logs</div>
        </div>
      </div>

      <div class="controls">
        <button onclick="clearLogs()" class="clear-btn">üßπ Limpiar Logs</button>
        <button onclick="filterTrending()" class="filter-btn">üî• Solo Trending</button>
        <button onclick="filterHooks()" class="filter-btn">‚öõÔ∏è Solo Hooks</button>
        <button onclick="showAll()" class="filter-btn">üìã Mostrar Todo</button>
        <button onclick="testTrendingAPI()">üß™ Test API</button>
      </div>

      <div class="log-container" id="log-container">
        <div class="log-entry log-info">
          <span class="timestamp">[Iniciando...]</span> Capturador de logs iniciado. Abre la
          aplicaci√≥n en otra pesta√±a para ver los logs.
        </div>
      </div>
    </div>

    <script>
      let allLogs = []
      let currentFilter = 'all'
      let stats = {
        total: 0,
        trending: 0,
        errors: 0,
        hooks: 0,
      }

      // Interceptar console.log, console.warn, console.error
      const originalLog = console.log
      const originalWarn = console.warn
      const originalError = console.error

      function addLog(message, type = 'info', source = 'console') {
        const timestamp = new Date().toLocaleTimeString()
        const logEntry = {
          timestamp,
          message: String(message),
          type,
          source,
          id: Date.now() + Math.random(),
        }

        allLogs.push(logEntry)
        updateStats(logEntry)
        updateDisplay()
      }

      function updateStats(logEntry) {
        stats.total++

        const message = logEntry.message.toLowerCase()
        if (message.includes('trending') || message.includes('üî•')) {
          stats.trending++
        }
        if (logEntry.type === 'error') {
          stats.errors++
        }
        if (message.includes('hook') || message.includes('use') || message.includes('‚öõÔ∏è')) {
          stats.hooks++
        }

        document.getElementById('total-logs').textContent = stats.total
        document.getElementById('trending-logs').textContent = stats.trending
        document.getElementById('error-logs').textContent = stats.errors
        document.getElementById('hook-logs').textContent = stats.hooks
      }

      function updateDisplay() {
        const container = document.getElementById('log-container')
        const filteredLogs = filterLogs()

        container.innerHTML = filteredLogs
          .map(
            log => `
                <div class="log-entry log-${log.type}">
                    <span class="timestamp">[${log.timestamp}]</span>
                    <span class="source">[${log.source}]</span>
                    ${log.message}
                </div>
            `
          )
          .join('')

        // Auto-scroll al final
        container.scrollTop = container.scrollHeight
      }

      function filterLogs() {
        switch (currentFilter) {
          case 'trending':
            return allLogs.filter(
              log => log.message.toLowerCase().includes('trending') || log.message.includes('üî•')
            )
          case 'hooks':
            return allLogs.filter(
              log =>
                log.message.toLowerCase().includes('hook') ||
                log.message.toLowerCase().includes('use') ||
                log.message.includes('‚öõÔ∏è')
            )
          default:
            return allLogs
        }
      }

      function clearLogs() {
        allLogs = []
        stats = { total: 0, trending: 0, errors: 0, hooks: 0 }
        document.getElementById('total-logs').textContent = '0'
        document.getElementById('trending-logs').textContent = '0'
        document.getElementById('error-logs').textContent = '0'
        document.getElementById('hook-logs').textContent = '0'
        updateDisplay()
      }

      function filterTrending() {
        currentFilter = 'trending'
        updateDisplay()
      }

      function filterHooks() {
        currentFilter = 'hooks'
        updateDisplay()
      }

      function showAll() {
        currentFilter = 'all'
        updateDisplay()
      }

      async function testTrendingAPI() {
        addLog('üß™ Iniciando test de API trending...', 'info', 'test')

        try {
          const response = await fetch('http://localhost:3000/api/search/trending?limit=6')
          addLog(`üß™ API Response status: ${response.status}`, 'info', 'test')

          const data = await response.json()
          addLog(`üß™ API Response data: ${JSON.stringify(data, null, 2)}`, 'success', 'test')
        } catch (error) {
          addLog(`üß™ API Error: ${error.message}`, 'error', 'test')
        }
      }

      // Override console methods
      console.log = function (...args) {
        originalLog.apply(console, args)
        addLog(args.join(' '), 'info', 'console')
      }

      console.warn = function (...args) {
        originalWarn.apply(console, args)
        addLog(args.join(' '), 'warn', 'console')
      }

      console.error = function (...args) {
        originalError.apply(console, args)
        addLog(args.join(' '), 'error', 'console')
      }

      // Capturar errores no manejados
      window.addEventListener('error', function (e) {
        addLog(`Unhandled Error: ${e.message} at ${e.filename}:${e.lineno}`, 'error', 'window')
      })

      window.addEventListener('unhandledrejection', function (e) {
        addLog(`Unhandled Promise Rejection: ${e.reason}`, 'error', 'promise')
      })

      // Mensaje inicial
      addLog(
        'üöÄ Debug Console iniciado. Abre http://localhost:3000 en otra pesta√±a para capturar logs.',
        'success',
        'system'
      )

      // Auto-test inicial
      setTimeout(() => {
        testTrendingAPI()
      }, 2000)
    </script>
  </body>
</html>
