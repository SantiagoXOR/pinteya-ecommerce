/* ⚡ OPTIMIZACIÓN: variables.css ahora está inline en layout.tsx para eliminar request bloqueante */
/* ⚡ OPTIMIZACIÓN: checkout-transition.css y hero-carousel.css se cargan diferidamente via DeferredCSS.tsx */
/* Los @import bloqueantes fueron removidos para eliminar ~760ms de render-blocking */

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ⚡ PERFORMANCE: Aspect ratio para prevenir CLS */
@layer utilities {
  .hero-carousel img,
  .hero-carousel picture {
    aspect-ratio: 16 / 9;
    object-fit: contain;
  }
  
  .product-image {
    aspect-ratio: 1 / 1;
    object-fit: cover;
  }
  
  .category-image {
    aspect-ratio: 4 / 3;
    object-fit: cover;
  }
  
  /* Prevenir layout shifts en todas las imágenes */
  img:not([width]):not([height]) {
    height: auto;
  }
  
  /* ⚡ PERFORMANCE: Reservar espacio para contenido dinámico */
  .hero-section {
    min-height: 320px;
  }
  
  @media (min-width: 1024px) {
    .hero-section {
      min-height: 500px;
    }
  }
  
  /* Prevenir CLS en carruseles */
  .carousel-container,
  .swiper-container {
    position: relative;
    width: 100%;
    overflow: hidden;
  }
  
  /* Reservar espacio para skeletons */
  .skeleton-loader {
    display: block;
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s ease-in-out infinite;
  }
  
  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  /* ⚡ PERFORMANCE: Shimmer animation para skeletons - Pulso sutil sin movimiento horizontal */
  @keyframes shimmer {
    0% {
      opacity: 0.9;
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 0.9;
    }
  }

  /* ⚡ PERFORMANCE: Content Visibility para optimizar rendering below-fold (-0.4s) */
  .below-fold-content {
    content-visibility: auto;
    contain-intrinsic-size: auto 400px;
  }

  .product-section {
    content-visibility: auto;
    contain-intrinsic-size: auto 500px;
  }

  .testimonials-section {
    content-visibility: auto;
    contain-intrinsic-size: auto 600px;
  }

  .newsletter-section {
    content-visibility: auto;
    contain-intrinsic-size: auto 350px;
  }

  .trust-section {
    content-visibility: auto;
    contain-intrinsic-size: auto 450px;
  }

  /* ⚡ PERFORMANCE: Wave animation para skeleton shimmer effect - FIX: Contenedor con overflow */
  .skeleton-wave {
    position: relative;
    overflow: hidden; /* ✅ FIX: Asegurar que no se salga */
    contain: layout style paint; /* ✅ FIX: Optimizar rendering */
  }

  .skeleton-wave::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    /* DESACTIVADO: Sin animación horizontal - transform: translateX(-100%); */
    background: rgba(255, 255, 255, 0.1);
    animation: shimmer-pulse 2.5s ease-in-out infinite;
    will-change: opacity; /* ✅ FIX: Optimizar animación */
  }

  /* Shimmer mejorado - Pulso sutil sin animación horizontal */
  .skeleton-shimmer {
    background: #f0f0f0;
    animation: shimmer-pulse 2.5s ease-in-out infinite;
    overflow: hidden; /* ✅ FIX: Asegurar que no se salga */
    contain: layout style paint; /* ✅ FIX: Optimizar rendering */
  }

  @keyframes shimmer-pulse {
    0% {
      opacity: 0.9;
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 0.9;
    }
  }

  /* Pulso sutil para skeletons que usan animate-pulse de Tailwind */
  @keyframes pulse {
    0%, 100% {
      opacity: 0.95;
    }
    50% {
      opacity: 1;
    }
  }

  .animate-pulse {
    animation: pulse 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  html {
    @apply scroll-smooth;
    overflow-x: hidden;
    max-width: 100vw;
    width: 100%;
  }

  body {
    @apply font-euclid-circular-a font-normal text-base text-dark-3 dark:text-bright-sun-200 relative z-1;
    @apply bg-background text-foreground;
    overflow-x: hidden;
    max-width: 100vw;
    width: 100%;
    /* Fondo degradado negro/naranja por defecto en todas las rutas - sobrescribe bg-white */
    background: radial-gradient(ellipse at top right, #f27a1d 0%, transparent 50%),
                radial-gradient(ellipse at bottom left, #bd4811 0%, transparent 50%),
                #000000 !important;
    background-attachment: fixed !important;
    background-size: cover !important;
    background-position: center !important;
    background-repeat: no-repeat !important;
    color: #fff4c6 !important;
    /* Header height unificado: ScrollingBanner (~28px) + Main (~60px) = ~88px, usando 92px para spacing óptimo */
    padding-top: 92px; /* Ajustado para header más alto en mobile */
    /* Emoji font fallbacks to ensure color emoji rendering across platforms */
    font-family: 'Euclid Circular A', system-ui, -apple-system, 'Segoe UI', Roboto,
      'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif,
      var(--emoji-fonts);
  }
  
  /* Prevenir scroll horizontal en todos los contenedores principales */
  #__next {
    overflow-x: hidden;
    max-width: 100vw;
    width: 100%;
  }

  /* Mobile pequeño - Reducir padding para aprovechar mejor el espacio */
  @media (max-width: 375px) {
    body {
      padding-top: 88px; /* Menos padding en pantallas muy pequeñas */
    }
  }

  /* Ajuste específico para desktop */
  @media (min-width: 1024px) {
    body {
      padding-top: 105px; /* Ajustado para mejor spacing con header más alto */
    }
  }
  :root {
    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
    /* Cross-platform emoji fonts */
    --emoji-fonts: 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', 'EmojiOne Color';
  }
  .dark {
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer components {
  .dropdown {
    @apply flex-col gap-0 min-w-max xl:w-[193px] mt-2 lg:mt-0 bg-white shadow-2 ease-in duration-200 py-2.5 rounded-md border border-gray-3;
  }

  .custom-search-input .prose {
    width: 100%;
  }

  .custom-search-input input {
    width: 100%;
    border: 2px solid #fdba74; /* orange-300 */
    border-radius: 0.5rem; /* rounded-lg */
    padding-left: 1rem; /* pl-4 */
    padding-right: 3rem; /* pr-12 */
    padding-top: 0.625rem; /* py-2.5 */
    padding-bottom: 0.625rem; /* py-2.5 */
    color: #ea580c; /* text-blaze-orange-600 */
    font-size: 0.875rem; /* text-sm */
    font-weight: 500; /* font-medium */
    box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); /* shadow-sm */
    transition: all 0.3s;
    background-color: transparent !important;
  }

  @media (min-width: 640px) {
    .custom-search-input input {
      font-size: 1rem; /* sm:text-base */
    }
  }

  .custom-search-input input:focus {
    border-color: #f97316; /* focus:border-orange-500 */
    box-shadow: 0 0 0 2px #fed7aa; /* focus:ring-2 focus:ring-orange-200 */
  }

  .custom-search-input input:hover {
    border-color: #fb923c; /* hover:border-orange-400 */
  }

  /* Dropdown específico para búsqueda */
  .search-dropdown {
    position: absolute !important;
    top: 100% !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 2000 !important;
    margin-top: 4px !important;
    background-color: #fff3c5 !important;
    border-radius: 8px !important;
    box-shadow:
      0 10px 25px -3px rgba(0, 0, 0, 0.1),
      0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
    max-height: 384px !important;
    overflow-y: auto !important;
    min-height: 100px !important;
    /* Forzar que no se corte */
    clip: unset !important;
    clip-path: none !important;
    contain: none !important;
  }

  /* Asegurar que el contenedor del dropdown no limite */
  .search-focus-ring {
    position: relative;
    z-index: 1;
    /* Permitir que el dropdown se extienda fuera del contenedor */
    overflow: visible !important;
  }

  /* Contenedor de búsqueda sin limitaciones */
  .custom-search-input {
    position: relative;
    z-index: 1;
    overflow: visible !important;
  }
}

@layer utilities {
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }

  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  /* Clase específica para ocultar scrollbar en carrusel de categorías */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Header Animation Classes - Restored for Header functionality */
  .header-sticky-transition {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(135deg, #ea5a17 0%, #f97316 100%);
  }

  .logo-sticky-scale {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Logo container optimizations */
  .logo-container {
    overflow: visible !important;
    contain: none !important;
  }

  .logo-container img {
    will-change: transform;
    backface-visibility: hidden;
  }

  .focus-ring:focus {
    outline: 2px solid #f27a1d;
    outline-offset: 2px;
    border-radius: 0.375rem;
  }

  .focus-ring:focus-visible {
    outline: 2px solid #f27a1d;
    outline-offset: 2px;
    border-radius: 0.375rem;
  }

  /* Mobile bottom navigation padding - TEMPORALMENTE DESACTIVADO */
  /* .mobile-bottom-nav-padding {
    padding-bottom: env(safe-area-inset-bottom);
  } */

  /* App content wrapper - Clase estática para evitar hydration mismatch */
  .app-content-wrapper {
    /* Sin padding adicional por ahora */
  }

  /* Floating button effect for cart */
  .floating-button {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .floating-button:hover {
    transform: translateY(-2px);
    box-shadow:
      0 10px 15px -3px rgba(0, 0, 0, 0.1),
      0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }

  /* Search focus ring - Fixed: Removed transform scale that created stacking context issues */
  .search-focus-ring:focus-within {
    box-shadow:
      0 0 0 3px rgba(242, 122, 29, 0.1),
      0 4px 12px rgba(242, 122, 29, 0.15);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    /* Removed transform: scale(1.01) to prevent dropdown clipping */
  }

  /* ==========================================
     Emoji rendering fixes (utility classes)
     ========================================== */
  .emoji,
  .emoji-fix,
  .whatsapp-message,
  .whatsapp-preview {
    font-family: var(--emoji-fonts) !important;
    line-height: 1.2;
    text-rendering: optimizeLegibility;
  }
}

/* =====================================================
   Pinteya Brand Loader (Pantalla de carga mejorada)
   Fondo naranja con microinteracción del logo
   ===================================================== */

@keyframes brand-bob {
  0%, 100% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-6px) scale(1.02); }
}

@keyframes brand-shimmer {
  0% { transform: translateX(-120%); opacity: 0.0; }
  30% { opacity: 0.25; }
  50% { opacity: 0.35; }
  100% { transform: translateX(120%); opacity: 0; }
}

@keyframes micro-drop {
  0% { transform: translate(0, -8px) scale(0.9); opacity: 0; }
  20% { opacity: 1; }
  50% { transform: translate(0, 0) scale(1); }
  70% { transform: translate(0, 2px) scale(0.98); }
  100% { transform: translate(0, -8px) scale(0.9); opacity: 0; }
}

.brand-loader {
  position: fixed;
  inset: 0;
  z-index: 999999;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #ea5a17 0%, #f97316 100%);
}

.brand-loader-inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 18px;
}

.brand-badge {
  position: relative;
  width: 112px;
  height: 112px;
  border-radius: 28px;
  background: #ffd57a; /* amarillo cálido del tile */
  box-shadow:
    0 10px 25px rgba(0, 0, 0, 0.25),
    inset 0 -6px 10px rgba(0, 0, 0, 0.1),
    inset 0 6px 10px rgba(255, 255, 255, 0.5);
  display: grid;
  place-items: center;
  animation: brand-bob 1.8s ease-in-out infinite;
}

.brand-logo {
  width: 84px;
  height: 84px;
  object-fit: contain;
  filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.2));
}

.brand-shine {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0.35) 50%,
    rgba(255, 255, 255, 0) 100%
  );
  transform: translateX(-120%);
  animation: brand-shimmer 1.8s ease-in-out infinite;
}

.brand-micro-drop {
  width: 10px;
  height: 14px;
  border-radius: 8px 8px 12px 12px;
  background: #6b2107; /* tono más oscuro de la marca */
  opacity: 0.85;
  filter: drop-shadow(0 2px 1px rgba(0,0,0,0.2));
  animation: micro-drop 1.8s ease-in-out infinite;
}

.brand-loader-text {
  color: #fff7ed; /* naranja claro para contraste */
  font-weight: 600;
  letter-spacing: 0.2px;
}

/* Padding para bottom navigation estilo MercadoLibre */
@media (max-width: 768px) {
  body {
    padding-bottom: 64px; /* Altura del bottom nav */
  }
  
  /* Safe area para dispositivos con notch */
  .safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }
}
