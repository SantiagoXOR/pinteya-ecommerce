/* âš¡ OPTIMIZACIÃ“N: variables.css ahora estÃ¡ inline en layout.tsx para eliminar request bloqueante */
/* âš¡ OPTIMIZACIÃ“N: checkout-transition.css y hero-carousel.css se cargan diferidamente via DeferredCSS.tsx */
/* Los @import bloqueantes fueron removidos para eliminar ~760ms de render-blocking */

@tailwind base;
@tailwind components;
@tailwind utilities;

/* âš¡ PERFORMANCE: Aspect ratio para prevenir CLS */
@layer utilities {
  .hero-carousel img,
  .hero-carousel picture {
    aspect-ratio: 16 / 9;
    object-fit: contain;
  }
  
  .product-image {
    aspect-ratio: 1 / 1;
    object-fit: cover;
  }
  
  .category-image {
    aspect-ratio: 4 / 3;
    object-fit: cover;
  }
  
  /* Prevenir layout shifts en todas las imÃ¡genes */
  img:not([width]):not([height]) {
    height: auto;
  }
  
  /* âš¡ PERFORMANCE: Reservar espacio para contenido dinÃ¡mico */
  .hero-section {
    min-height: 320px;
  }
  
  @media (min-width: 1024px) {
    .hero-section {
      min-height: 500px;
    }
  }
  
  /* Prevenir CLS en carruseles */
  .carousel-container,
  .swiper-container {
    position: relative;
    width: 100%;
    overflow: hidden;
  }
  
  /* Reservar espacio para skeletons */
  .skeleton-loader {
    display: block;
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s ease-in-out infinite;
  }
  
  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  /* âš¡ PERFORMANCE: Shimmer animation para skeletons - Pulso sutil sin movimiento horizontal */
  @keyframes shimmer {
    0% {
      opacity: 0.9;
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 0.9;
    }
  }

  /* âš¡ PERFORMANCE: Content Visibility para optimizar rendering below-fold (-0.4s) */
  .below-fold-content {
    content-visibility: auto;
    contain-intrinsic-size: auto 400px;
  }

  .product-section {
    content-visibility: auto;
    contain-intrinsic-size: auto 500px;
  }

  .testimonials-section {
    content-visibility: auto;
    contain-intrinsic-size: auto 600px;
  }

  .newsletter-section {
    content-visibility: auto;
    contain-intrinsic-size: auto 350px;
  }

  .trust-section {
    content-visibility: auto;
    contain-intrinsic-size: auto 450px;
  }

  /* âš¡ PERFORMANCE: Wave animation para skeleton shimmer effect - FIX: Contenedor con overflow */
  .skeleton-wave {
    position: relative;
    overflow: hidden; /* âœ… FIX: Asegurar que no se salga */
    contain: layout style paint; /* âœ… FIX: Optimizar rendering */
  }

  .skeleton-wave::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    /* DESACTIVADO: Sin animaciÃ³n horizontal - transform: translateX(-100%); */
    background: rgba(255, 255, 255, 0.1);
    animation: shimmer-pulse 2.5s ease-in-out infinite;
    will-change: opacity; /* âœ… FIX: Optimizar animaciÃ³n */
  }

  /* Shimmer mejorado - Pulso sutil sin animaciÃ³n horizontal */
  .skeleton-shimmer {
    background: #f0f0f0;
    animation: shimmer-pulse 2.5s ease-in-out infinite;
    overflow: hidden; /* âœ… FIX: Asegurar que no se salga */
    contain: layout style paint; /* âœ… FIX: Optimizar rendering */
  }

  @keyframes shimmer-pulse {
    0% {
      opacity: 0.9;
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 0.9;
    }
  }

  /* Pulso sutil para skeletons que usan animate-pulse de Tailwind */
  @keyframes pulse {
    0%, 100% {
      opacity: 0.95;
    }
    50% {
      opacity: 1;
    }
  }

  .animate-pulse {
    animation: pulse 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  html {
    @apply scroll-smooth;
    overflow-x: hidden;
    overflow-y: auto; /* âš¡ FIX: Permitir solo scroll vertical en html */
    max-width: 100vw;
    width: 100%;
    height: 100%; /* âš¡ FIX: Altura completa para evitar scroll duplicado */
    /* âš¡ OPTIMIZACIÃ“N: GPU acceleration para scroll vertical a 60fps */
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    /* ðŸ“± OPTIMIZACIÃ“N MÃ“VILES PEQUEÃ‘OS: Font-size base reducido en mÃ³viles <375px */
    /* Esto hace que todos los rem se reduzcan proporcionalmente */
    font-size: 14px; /* Base reducido para mÃ³viles pequeÃ±os */
  }
  
  @media (min-width: 375px) {
    html {
      font-size: 16px; /* TamaÃ±o normal */
    }
  }

  body {
    @apply font-plus-jakarta-sans font-normal text-base text-dark-3 dark:text-bright-sun-200 relative z-1;
    @apply bg-background text-foreground;
    overflow-x: hidden;
    overflow-y: hidden !important; /* âš¡ FIX CRÃTICO: No scroll en body, solo en html */
    max-width: 100vw;
    width: 100%;
    height: auto; /* âš¡ FIX: Altura automÃ¡tica, no min-height para evitar scroll duplicado */
    /* âš¡ FIX: No usar transform en body para que position:fixed funcione correctamente */
    /* Fondo degradado dinÃ¡mico por tenant - orden independiente por tenant */
    /* âš¡ FIX: Usar solo variable CSS sin fallback hardcodeado - el fallback debe venir de TenantThemeStyles */
    background: linear-gradient(to bottom, var(--tenant-gradient-start) 0%, var(--tenant-gradient-start) 40%, var(--tenant-gradient-end) 100%) !important;
    background-attachment: fixed !important;
    background-size: cover !important;
    background-position: center !important;
    background-repeat: no-repeat !important;
    color: #ffffff !important;
    /* Header height unificado: ScrollingBanner (~28px) + Main (~60px) = ~88px, usando 92px para spacing Ã³ptimo */
    /* Agregar safe area superior para iOS Safari cuando se oculta la interfaz */
    padding-top: calc(92px + env(safe-area-inset-top, 0px)); /* Ajustado para header mÃ¡s alto en mobile + safe area iOS */
    /* Emoji font fallbacks to ensure color emoji rendering across platforms */
    font-family: 'Plus Jakarta Sans', system-ui, -apple-system, 'Segoe UI', Roboto,
      'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif,
      var(--emoji-fonts);
  }
  
  /* âš¡ FIX: Prevenir scroll en contenedores principales - solo html debe hacer scroll */
  #__next {
    overflow-x: hidden;
    overflow-y: hidden !important; /* âš¡ FIX CRÃTICO: No scroll aquÃ­ */
    max-width: 100vw;
    width: 100%;
    height: auto; /* Altura automÃ¡tica */
    position: relative;
  }
  
  /* âš¡ FIX: Asegurar que main no tenga overflow que cause scroll duplicado */
  main {
    overflow-x: hidden;
    overflow-y: hidden !important; /* âš¡ FIX CRÃTICO: No scroll aquÃ­, solo en html */
    position: relative;
  }

  /* âš¡ FIX: Asegurar que elementos fixed (header, bottom nav) funcionen correctamente */
  header[class*="fixed"],
  nav[class*="fixed"],
  header.fixed,
  nav.fixed {
    position: fixed !important;
    z-index: 1100 !important;
  }

  /* Bottom navigation especÃ­fico */
  nav.z-bottom-nav,
  nav[class*="bottom-nav"] {
    position: fixed !important;
    z-index: 1300 !important;
  }

  /* Mobile pequeÃ±o - Reducir padding para aprovechar mejor el espacio */
  @media (max-width: 375px) {
    body {
      /* Menos padding en pantallas muy pequeÃ±as + safe area iOS */
      padding-top: calc(88px + env(safe-area-inset-top, 0px));
    }
  }

  /* Ajuste especÃ­fico para desktop */
  @media (min-width: 1024px) {
    body {
      /* Ajustado para mejor spacing con header mÃ¡s alto + safe area iOS */
      padding-top: calc(105px + env(safe-area-inset-top, 0px));
    }
  }
  :root {
    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
    /* Cross-platform emoji fonts */
    --emoji-fonts: 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', 'EmojiOne Color';
    /* ðŸ“± OPTIMIZACIÃ“N MÃ“VILES PEQUEÃ‘OS: Variables CSS para escalado automÃ¡tico */
    --mobile-font-scale: 1; /* Valor base */
    --mobile-spacing-scale: 1; /* Valor base */
  }
  
  /* ðŸ“± Reducir escala en mÃ³viles <375px */
  @media (max-width: 374px) {
    :root {
      --mobile-font-scale: 0.875; /* Reduce 12.5% */
      --mobile-spacing-scale: 0.875; /* Reduce 12.5% */
    }
  }
  .dark {
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer components {
  .dropdown {
    @apply flex-col gap-0 min-w-max xl:w-[193px] mt-2 lg:mt-0 bg-white shadow-2 ease-in duration-200 py-2.5 rounded-md border border-gray-3;
  }

  .custom-search-input .prose {
    width: 100%;
  }

  .custom-search-input input {
    width: 100%;
    border: 2px solid #fdba74; /* orange-300 */
    border-radius: 0.5rem; /* rounded-lg */
    padding-left: 1rem; /* pl-4 */
    padding-right: 3rem; /* pr-12 */
    padding-top: 0.625rem; /* py-2.5 */
    padding-bottom: 0.625rem; /* py-2.5 */
    color: #ea580c; /* text-blaze-orange-600 */
    font-size: 0.875rem; /* text-sm */
    font-weight: 500; /* font-medium */
    box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); /* shadow-sm */
    transition: all 0.3s;
    background-color: transparent !important;
  }

  @media (min-width: 640px) {
    .custom-search-input input {
      font-size: 1rem; /* sm:text-base */
    }
  }

  .custom-search-input input:focus {
    border-color: #f97316; /* focus:border-orange-500 */
    box-shadow: 0 0 0 2px #fed7aa; /* focus:ring-2 focus:ring-orange-200 */
  }

  .custom-search-input input:hover {
    border-color: #fb923c; /* hover:border-orange-400 */
  }

  /* Dropdown especÃ­fico para bÃºsqueda */
  .search-dropdown {
    position: absolute !important;
    top: 100% !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 2000 !important;
    margin-top: 4px !important;
    background-color: #fff3c5 !important;
    border-radius: 8px !important;
    box-shadow:
      0 10px 25px -3px rgba(0, 0, 0, 0.1),
      0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
    max-height: 384px !important;
    overflow-y: auto !important;
    min-height: 100px !important;
    /* Forzar que no se corte */
    clip: unset !important;
    clip-path: none !important;
    contain: none !important;
  }

  /* Asegurar que el contenedor del dropdown no limite */
  .search-focus-ring {
    position: relative;
    z-index: 1;
    /* Permitir que el dropdown se extienda fuera del contenedor */
    overflow: visible !important;
  }

  /* Contenedor de bÃºsqueda sin limitaciones */
  .custom-search-input {
    position: relative;
    z-index: 1;
    overflow: visible !important;
  }
}

@layer utilities {
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }

  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  /* Clase especÃ­fica para ocultar scrollbar en carrusel de categorÃ­as */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Header Animation Classes - Restored for Header functionality */
  .header-sticky-transition {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(135deg, #ea5a17 0%, #f97316 100%);
  }

  .logo-sticky-scale {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Logo container optimizations */
  .logo-container {
    overflow: visible !important;
    contain: none !important;
  }

  .logo-container img {
    will-change: transform;
    backface-visibility: hidden;
  }

  .focus-ring:focus {
    outline: 2px solid #f27a1d;
    outline-offset: 2px;
    border-radius: 0.375rem;
  }

  .focus-ring:focus-visible {
    outline: 2px solid #f27a1d;
    outline-offset: 2px;
    border-radius: 0.375rem;
  }

  /* Mobile bottom navigation padding - TEMPORALMENTE DESACTIVADO */
  /* .mobile-bottom-nav-padding {
    padding-bottom: env(safe-area-inset-bottom);
  } */

  /* App content wrapper - Clase estÃ¡tica para evitar hydration mismatch */
  .app-content-wrapper {
    /* Sin padding adicional por ahora */
  }

  /* Floating button effect for cart */
  .floating-button {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .floating-button:hover {
    transform: translateY(-2px);
    box-shadow:
      0 10px 15px -3px rgba(0, 0, 0, 0.1),
      0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }

  /* Search focus ring - Fixed: Removed transform scale that created stacking context issues */
  .search-focus-ring:focus-within {
    box-shadow:
      0 0 0 3px rgba(242, 122, 29, 0.1),
      0 4px 12px rgba(242, 122, 29, 0.15);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    /* Removed transform: scale(1.01) to prevent dropdown clipping */
  }

  /* ==========================================
     Emoji rendering fixes (utility classes)
     ========================================== */
  .emoji,
  .emoji-fix,
  .whatsapp-message,
  .whatsapp-preview {
    font-family: var(--emoji-fonts) !important;
    line-height: 1.2;
    text-rendering: optimizeLegibility;
  }

  /* ðŸ“± OPTIMIZACIÃ“N MÃ“VILES PEQUEÃ‘OS: Reducir automÃ¡ticamente padding, margins y gaps */
  @media (max-width: 374px) {
    /* Padding reducido */
    .p-2 { padding: 0.375rem !important; } /* 6px en lugar de 8px */
    .p-3 { padding: 0.5rem !important; } /* 8px en lugar de 12px */
    .p-4 { padding: 0.625rem !important; } /* 10px en lugar de 16px */
    .p-6 { padding: 0.875rem !important; } /* 14px en lugar de 24px */
    
    .px-2 { padding-left: 0.375rem !important; padding-right: 0.375rem !important; }
    .px-3 { padding-left: 0.5rem !important; padding-right: 0.5rem !important; }
    .px-4 { padding-left: 0.625rem !important; padding-right: 0.625rem !important; }
    
    .py-2 { padding-top: 0.375rem !important; padding-bottom: 0.375rem !important; }
    .py-3 { padding-top: 0.5rem !important; padding-bottom: 0.5rem !important; }
    .py-4 { padding-top: 0.625rem !important; padding-bottom: 0.625rem !important; }
    .py-6 { padding-top: 0.875rem !important; padding-bottom: 0.875rem !important; }
    
    /* Margins reducidos */
    .m-2 { margin: 0.375rem !important; }
    .m-3 { margin: 0.5rem !important; }
    .m-4 { margin: 0.625rem !important; }
    .m-6 { margin: 0.875rem !important; }
    
    .mb-2 { margin-bottom: 0.375rem !important; }
    .mb-3 { margin-bottom: 0.5rem !important; }
    .mb-4 { margin-bottom: 0.625rem !important; }
    .mb-6 { margin-bottom: 0.875rem !important; }
    
    .mt-2 { margin-top: 0.375rem !important; }
    .mt-3 { margin-top: 0.5rem !important; }
    .mt-4 { margin-top: 0.625rem !important; }
    .mt-6 { margin-top: 0.875rem !important; }
    
    /* Gaps reducidos */
    .gap-2 { gap: 0.375rem !important; }
    .gap-3 { gap: 0.5rem !important; }
    .gap-4 { gap: 0.625rem !important; }
    .gap-6 { gap: 0.875rem !important; }
    
    /* Alturas reducidas para inputs y botones */
    .h-10 { height: 2rem !important; } /* 32px en lugar de 40px */
    .h-12 { height: 2.5rem !important; } /* 40px en lugar de 48px */
    
    /* Espaciado vertical reducido */
    .space-y-2 > * + * { margin-top: 0.375rem !important; }
    .space-y-3 > * + * { margin-top: 0.5rem !important; }
    .space-y-4 > * + * { margin-top: 0.625rem !important; }
    .space-y-6 > * + * { margin-top: 0.875rem !important; }
  }
}

/* =====================================================
   Pinteya Brand Loader (Pantalla de carga mejorada)
   Fondo naranja con microinteracciÃ³n del logo
   ===================================================== */

@keyframes brand-bob {
  0%, 100% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-6px) scale(1.02); }
}

@keyframes brand-shimmer {
  0% { transform: translateX(-120%); opacity: 0.0; }
  30% { opacity: 0.25; }
  50% { opacity: 0.35; }
  100% { transform: translateX(120%); opacity: 0; }
}

@keyframes micro-drop {
  0% { transform: translate(0, -8px) scale(0.9); opacity: 0; }
  20% { opacity: 1; }
  50% { transform: translate(0, 0) scale(1); }
  70% { transform: translate(0, 2px) scale(0.98); }
  100% { transform: translate(0, -8px) scale(0.9); opacity: 0; }
}

.brand-loader {
  position: fixed;
  inset: 0;
  z-index: 999999;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #ea5a17 0%, #f97316 100%);
}

.brand-loader-inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 18px;
}

.brand-badge {
  position: relative;
  width: 112px;
  height: 112px;
  border-radius: 28px;
  background: #ffd57a; /* amarillo cÃ¡lido del tile */
  box-shadow:
    0 10px 25px rgba(0, 0, 0, 0.25),
    inset 0 -6px 10px rgba(0, 0, 0, 0.1),
    inset 0 6px 10px rgba(255, 255, 255, 0.5);
  display: grid;
  place-items: center;
  animation: brand-bob 1.8s ease-in-out infinite;
}

.brand-logo {
  width: 84px;
  height: 84px;
  object-fit: contain;
  filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.2));
}

.brand-shine {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0.35) 50%,
    rgba(255, 255, 255, 0) 100%
  );
  transform: translateX(-120%);
  animation: brand-shimmer 1.8s ease-in-out infinite;
}

.brand-micro-drop {
  width: 10px;
  height: 14px;
  border-radius: 8px 8px 12px 12px;
  background: #6b2107; /* tono mÃ¡s oscuro de la marca */
  opacity: 0.85;
  filter: drop-shadow(0 2px 1px rgba(0,0,0,0.2));
  animation: micro-drop 1.8s ease-in-out infinite;
}

.brand-loader-text {
  color: #fff7ed; /* naranja claro para contraste */
  font-weight: 600;
  letter-spacing: 0.2px;
}

/* Padding para bottom navigation estilo MercadoLibre */
@media (max-width: 768px) {
  body {
    /* Altura del bottom nav + safe area inferior para iOS Safari */
    padding-bottom: calc(64px + env(safe-area-inset-bottom, 0px));
  }
  
  /* Safe area para dispositivos con notch - Bottom navigation */
  .safe-area-bottom {
    /* Usar bottom en lugar de padding-bottom para posicionamiento correcto */
    bottom: env(safe-area-inset-bottom, 0px);
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }
  
  /* Safe area superior para header en iOS Safari */
  .safe-area-top {
    top: env(safe-area-inset-top, 0px);
    padding-top: env(safe-area-inset-top, 0px);
  }
}
