<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Trending Searches Component</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .trending-item {
        padding: 12px;
        margin: 8px 0;
        background: #f8f9fa;
        border-radius: 6px;
        border-left: 4px solid #ea5a17;
        cursor: pointer;
        transition: all 0.2s;
      }
      .trending-item:hover {
        background: #e9ecef;
        transform: translateX(4px);
      }
      .trending-query {
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
      }
      .trending-meta {
        font-size: 12px;
        color: #666;
      }
      .loading {
        text-align: center;
        color: #666;
        padding: 20px;
      }
      .error {
        background: #ffebee;
        color: #c62828;
        padding: 15px;
        border-radius: 6px;
        margin: 10px 0;
      }
      .success {
        background: #e8f5e9;
        color: #2e7d32;
        padding: 15px;
        border-radius: 6px;
        margin: 10px 0;
      }
      button {
        padding: 12px 24px;
        margin: 8px;
        cursor: pointer;
        background: #ea5a17;
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        transition: background 0.2s;
      }
      button:hover {
        background: #d14910;
      }
      .stats {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîç Test Trending Searches</h1>
      <p>
        Este test verifica si el endpoint de trending searches funciona correctamente y simula c√≥mo
        deber√≠a verse en el componente React.
      </p>

      <button onclick="loadTrendingSearches()">üöÄ Cargar Trending Searches</button>
      <button onclick="simulateReactQuery()">‚öõÔ∏è Simular React Query</button>
      <button onclick="testWithLogs()">üìù Test con Logs Detallados</button>

      <div id="stats" class="stats" style="display: none">
        <h3>üìä Estad√≠sticas</h3>
        <div id="statsContent"></div>
      </div>

      <div id="results"></div>

      <div id="trending-container" style="display: none">
        <h3>üî• Trending Searches</h3>
        <div id="trending-list"></div>
      </div>
    </div>

    <script>
      let trendingData = null

      async function loadTrendingSearches() {
        const resultsDiv = document.getElementById('results')
        const trendingContainer = document.getElementById('trending-container')
        const trendingList = document.getElementById('trending-list')

        resultsDiv.innerHTML = '<div class="loading">üîÑ Cargando trending searches...</div>'
        trendingContainer.style.display = 'none'

        try {
          console.log('üî• Iniciando carga de trending searches...')

          const response = await fetch('http://localhost:3000/api/search/trending?limit=6')
          console.log('üî• Response status:', response.status)
          console.log('üî• Response headers:', Object.fromEntries(response.headers.entries()))

          const data = await response.json()
          console.log('üî• Response data:', data)

          trendingData = data

          if (response.ok && data.success && data.data?.trending) {
            const trending = data.data.trending

            resultsDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ Trending Searches Cargadas Exitosamente</h3>
                            <p><strong>Total:</strong> ${trending.length} b√∫squedas</p>
                            <p><strong>√öltima actualizaci√≥n:</strong> ${new Date(data.data.lastUpdated).toLocaleString()}</p>
                        </div>
                    `

            // Mostrar trending searches
            trendingList.innerHTML = trending
              .map(
                item => `
                        <div class="trending-item" onclick="selectTrending('${item.query}')">
                            <div class="trending-query">${item.query}</div>
                            <div class="trending-meta">
                                ${item.count} b√∫squedas ‚Ä¢ ${item.category} ‚Ä¢ ${item.type}
                            </div>
                        </div>
                    `
              )
              .join('')

            trendingContainer.style.display = 'block'

            // Mostrar estad√≠sticas
            showStats(trending)
          } else {
            resultsDiv.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Error en la respuesta</h3>
                            <p><strong>Status:</strong> ${response.status}</p>
                            <p><strong>Success:</strong> ${data.success}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `
          }
        } catch (error) {
          console.error('‚ùå Error cargando trending searches:', error)
          resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error de Red</h3>
                        <p>${error.message}</p>
                        <p>Verifica que el servidor est√© corriendo en http://localhost:3000</p>
                    </div>
                `
        }
      }

      function showStats(trending) {
        const statsDiv = document.getElementById('stats')
        const statsContent = document.getElementById('statsContent')

        const categories = {}
        const types = {}
        let totalCount = 0

        trending.forEach(item => {
          categories[item.category] = (categories[item.category] || 0) + 1
          types[item.type] = (types[item.type] || 0) + 1
          totalCount += item.count
        })

        statsContent.innerHTML = `
                <p><strong>Total de b√∫squedas:</strong> ${totalCount}</p>
                <p><strong>Categor√≠as:</strong> ${Object.entries(categories)
                  .map(([k, v]) => `${k}: ${v}`)
                  .join(', ')}</p>
                <p><strong>Tipos:</strong> ${Object.entries(types)
                  .map(([k, v]) => `${k}: ${v}`)
                  .join(', ')}</p>
            `

        statsDiv.style.display = 'block'
      }

      function selectTrending(query) {
        console.log('üîç Trending seleccionada:', query)
        alert(
          `Trending seleccionada: "${query}"\n\nEn la aplicaci√≥n real, esto navegar√≠a a la p√°gina de b√∫squeda.`
        )
      }

      async function simulateReactQuery() {
        const resultsDiv = document.getElementById('results')

        resultsDiv.innerHTML =
          '<div class="loading">‚öõÔ∏è Simulando comportamiento de React Query...</div>'

        try {
          // Simular el comportamiento del hook useTrendingSearches
          console.log('‚öõÔ∏è Simulando useTrendingSearches hook...')

          const queryKey = ['search', 'trending']
          console.log('‚öõÔ∏è Query Key:', queryKey)

          const queryFn = async () => {
            const response = await fetch('http://localhost:3000/api/search/trending?limit=6')
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`)
            }
            return response.json()
          }

          console.log('‚öõÔ∏è Ejecutando queryFn...')
          const result = await queryFn()

          console.log('‚öõÔ∏è Resultado de queryFn:', result)

          if (result.success && result.data?.trending) {
            resultsDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ React Query Simulation Exitosa</h3>
                            <p>El hook useTrendingSearches deber√≠a funcionar correctamente.</p>
                            <p><strong>Datos recibidos:</strong> ${result.data.trending.length} trending searches</p>
                            <p><strong>Query Key:</strong> ${JSON.stringify(queryKey)}</p>
                        </div>
                    `
          } else {
            resultsDiv.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Problema en React Query Simulation</h3>
                            <p>Los datos no tienen el formato esperado.</p>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </div>
                    `
          }
        } catch (error) {
          console.error('‚ùå Error en simulaci√≥n React Query:', error)
          resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error en React Query Simulation</h3>
                        <p>${error.message}</p>
                    </div>
                `
        }
      }

      async function testWithLogs() {
        console.clear()
        console.log('üìù === INICIO TEST DETALLADO ===')

        const resultsDiv = document.getElementById('results')
        resultsDiv.innerHTML =
          '<div class="loading">üìù Ejecutando test con logs detallados...</div>'

        try {
          // Test 1: Verificar conectividad
          console.log('üìù Test 1: Verificando conectividad...')
          const healthCheck = await fetch('http://localhost:3000/api/health').catch(() => null)
          console.log('üìù Health check:', healthCheck ? 'OK' : 'FAILED')

          // Test 2: Llamada al endpoint
          console.log('üìù Test 2: Llamando al endpoint trending...')
          const startTime = performance.now()

          const response = await fetch('http://localhost:3000/api/search/trending?limit=6')
          const endTime = performance.now()

          console.log('üìù Response time:', `${(endTime - startTime).toFixed(2)}ms`)
          console.log('üìù Response status:', response.status)
          console.log('üìù Response ok:', response.ok)

          // Test 3: Parsear respuesta
          console.log('üìù Test 3: Parseando respuesta...')
          const data = await response.json()
          console.log('üìù Data structure:', {
            hasData: !!data.data,
            hasTrending: !!data.data?.trending,
            trendingLength: data.data?.trending?.length || 0,
            success: data.success,
          })

          // Test 4: Validar estructura
          console.log('üìù Test 4: Validando estructura...')
          const isValid =
            data.success &&
            data.data &&
            Array.isArray(data.data.trending) &&
            data.data.trending.length > 0

          console.log('üìù Estructura v√°lida:', isValid)

          if (isValid) {
            console.log('üìù Primer trending item:', data.data.trending[0])
          }

          resultsDiv.innerHTML = `
                    <div class="${isValid ? 'success' : 'error'}">
                        <h3>${isValid ? '‚úÖ' : '‚ùå'} Test Detallado Completado</h3>
                        <p><strong>Tiempo de respuesta:</strong> ${(endTime - startTime).toFixed(2)}ms</p>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Estructura v√°lida:</strong> ${isValid ? 'S√≠' : 'No'}</p>
                        <p><strong>Trending items:</strong> ${data.data?.trending?.length || 0}</p>
                        <p><em>Revisa la consola del navegador para logs detallados</em></p>
                    </div>
                `

          console.log('üìù === FIN TEST DETALLADO ===')
        } catch (error) {
          console.error('üìù Error en test detallado:', error)
          resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error en Test Detallado</h3>
                        <p>${error.message}</p>
                    </div>
                `
        }
      }

      // Auto-load al cargar la p√°gina
      window.addEventListener('load', () => {
        console.log('üî• P√°gina cargada, listo para tests')
      })
    </script>
  </body>
</html>
