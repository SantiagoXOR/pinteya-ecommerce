a3a1bdbf2c8f416c34239076ef6452de
// ===================================
// TESTS: SearchAutocompleteIntegrated - Integración completa
// ===================================
"use strict";
// Mocks
jest.mock('next/navigation', ()=>({
        useRouter: jest.fn()
    }));
jest.mock('@/lib/api/products', ()=>({
        searchProducts: jest.fn()
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _jsxruntime = require("react/jsx-runtime");
const _react = /*#__PURE__*/ _interop_require_default(require("react"));
const _react1 = require("@testing-library/react");
const _userevent = /*#__PURE__*/ _interop_require_default(require("@testing-library/user-event"));
const _navigation = require("next/navigation");
const _products = require("../../../lib/api/products");
const _SearchAutocompleteIntegrated = require("../../../components/ui/SearchAutocompleteIntegrated");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const mockPush = jest.fn();
const mockSearchProducts = _products.searchProducts;
beforeEach(()=>{
    jest.clearAllMocks();
    _navigation.useRouter.mockReturnValue({
        push: mockPush
    });
    // Mock localStorage
    Object.defineProperty(window, 'localStorage', {
        value: {
            getItem: jest.fn(()=>null),
            setItem: jest.fn(),
            removeItem: jest.fn(),
            clear: jest.fn()
        },
        writable: true
    });
});
describe('SearchAutocompleteIntegrated', ()=>{
    it('should render with default props', ()=>{
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_SearchAutocompleteIntegrated.SearchAutocompleteIntegrated, {}));
        expect(_react1.screen.getByRole('combobox')).toBeInTheDocument();
        expect(_react1.screen.getByPlaceholderText('Busco productos de pinturería...')).toBeInTheDocument();
    });
    it('should integrate with useSearch hook and show suggestions', async ()=>{
        const mockResponse = {
            success: true,
            data: [
                {
                    id: '1',
                    name: 'Pintura Látex Blanca',
                    category: {
                        name: 'Pinturas'
                    },
                    images: {
                        previews: [
                            '/test.jpg'
                        ]
                    },
                    stock: 10
                },
                {
                    id: '2',
                    name: 'Pintura Esmalte Azul',
                    category: {
                        name: 'Pinturas'
                    },
                    images: {
                        previews: [
                            '/test2.jpg'
                        ]
                    },
                    stock: 5
                }
            ],
            pagination: {
                total: 2,
                page: 1,
                limit: 6,
                totalPages: 1
            }
        };
        mockSearchProducts.mockResolvedValue(mockResponse);
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_SearchAutocompleteIntegrated.SearchAutocompleteIntegrated, {
            debounceMs: 100
        }));
        const input = _react1.screen.getByRole('combobox');
        await _userevent.default.type(input, 'pintura');
        // Esperar a que aparezcan las sugerencias
        await (0, _react1.waitFor)(()=>{
            expect(_react1.screen.getByText('Pintura Látex Blanca')).toBeInTheDocument();
            expect(_react1.screen.getByText('Pintura Esmalte Azul')).toBeInTheDocument();
        }, {
            timeout: 1000
        });
        // Verificar que se llamó a la API
        expect(mockSearchProducts).toHaveBeenCalledWith('pintura', 6);
    });
    it('should execute search on Enter key', async ()=>{
        const onSearchExecuted = jest.fn();
        const mockResponse = {
            success: true,
            data: [
                {
                    id: '1',
                    name: 'Test Product',
                    category: {
                        name: 'Test'
                    }
                }
            ],
            pagination: {
                total: 1,
                page: 1,
                limit: 12,
                totalPages: 1
            }
        };
        mockSearchProducts.mockResolvedValue(mockResponse);
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_SearchAutocompleteIntegrated.SearchAutocompleteIntegrated, {
            onSearchExecuted: onSearchExecuted,
            debounceMs: 100
        }));
        const input = _react1.screen.getByRole('combobox');
        await _userevent.default.type(input, 'test query');
        await _userevent.default.keyboard('{Enter}');
        await (0, _react1.waitFor)(()=>{
            expect(mockPush).toHaveBeenCalledWith('/search?q=test%20query');
        });
    });
    it('should handle suggestion selection', async ()=>{
        const onSuggestionSelected = jest.fn();
        const mockResponse = {
            success: true,
            data: [
                {
                    id: '1',
                    name: 'Test Product',
                    category: {
                        name: 'Test Category'
                    },
                    images: {
                        previews: [
                            '/test.jpg'
                        ]
                    },
                    stock: 10
                }
            ],
            pagination: {
                total: 1,
                page: 1,
                limit: 6,
                totalPages: 1
            }
        };
        mockSearchProducts.mockResolvedValue(mockResponse);
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_SearchAutocompleteIntegrated.SearchAutocompleteIntegrated, {
            onSuggestionSelected: onSuggestionSelected,
            debounceMs: 100
        }));
        const input = _react1.screen.getByRole('combobox');
        await _userevent.default.type(input, 'test');
        await (0, _react1.waitFor)(()=>{
            expect(_react1.screen.getByText('Test Product')).toBeInTheDocument();
        });
        await _userevent.default.click(_react1.screen.getByText('Test Product'));
        expect(onSuggestionSelected).toHaveBeenCalledWith(expect.objectContaining({
            title: 'Test Product',
            type: 'product'
        }));
    });
    it('should clear search when clear button is clicked', async ()=>{
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_SearchAutocompleteIntegrated.SearchAutocompleteIntegrated, {}));
        const input = _react1.screen.getByRole('combobox');
        await _userevent.default.type(input, 'test query');
        // Buscar el botón de limpiar
        const clearButton = _react1.screen.getByLabelText('Clear search');
        await _userevent.default.click(clearButton);
        expect(input).toHaveValue('');
    });
    it('should show loading state during search', async ()=>{
        // Mock para simular búsqueda lenta
        mockSearchProducts.mockImplementation(()=>new Promise((resolve)=>setTimeout(()=>resolve({
                        success: true,
                        data: [],
                        pagination: {
                            total: 0,
                            page: 1,
                            limit: 6,
                            totalPages: 0
                        }
                    }), 1000)));
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_SearchAutocompleteIntegrated.SearchAutocompleteIntegrated, {
            debounceMs: 50
        }));
        const input = _react1.screen.getByRole('combobox');
        await _userevent.default.type(input, 'test');
        // Verificar que aparece el spinner de carga
        await (0, _react1.waitFor)(()=>{
            const spinner = document.querySelector('.animate-spin');
            expect(spinner).toBeInTheDocument();
        });
    });
    it('should handle API errors gracefully', async ()=>{
        mockSearchProducts.mockRejectedValue(new Error('API Error'));
        (0, _react1.render)(/*#__PURE__*/ (0, _jsxruntime.jsx)(_SearchAutocompleteIntegrated.SearchAutocompleteIntegrated, {
            debounceMs: 50
        }));
        const input = _react1.screen.getByRole('combobox');
        await _userevent.default.type(input, 'test');
        await (0, _react1.waitFor)(()=>{
            expect(mockSearchProducts).toHaveBeenCalled();
        });
        // El componente no debería crashear y debería mostrar estado sin resultados
        expect(input).toBeInTheDocument();
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcX190ZXN0c19fXFxjb21wb25lbnRzXFx1aVxcU2VhcmNoQXV0b2NvbXBsZXRlSW50ZWdyYXRlZC50ZXN0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBURVNUUzogU2VhcmNoQXV0b2NvbXBsZXRlSW50ZWdyYXRlZCAtIEludGVncmFjacOzbiBjb21wbGV0YVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgcmVuZGVyLCBzY3JlZW4sIHdhaXRGb3IgfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0JztcclxuaW1wb3J0IHVzZXJFdmVudCBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3VzZXItZXZlbnQnO1xyXG5pbXBvcnQgeyB1c2VSb3V0ZXIgfSBmcm9tICduZXh0L25hdmlnYXRpb24nO1xyXG5pbXBvcnQgeyBzZWFyY2hQcm9kdWN0cyB9IGZyb20gJ0AvbGliL2FwaS9wcm9kdWN0cyc7XHJcbmltcG9ydCB7IFNlYXJjaEF1dG9jb21wbGV0ZUludGVncmF0ZWQgfSBmcm9tICdAL2NvbXBvbmVudHMvdWkvU2VhcmNoQXV0b2NvbXBsZXRlSW50ZWdyYXRlZCc7XHJcblxyXG4vLyBNb2Nrc1xyXG5qZXN0Lm1vY2soJ25leHQvbmF2aWdhdGlvbicsICgpID0+ICh7XHJcbiAgdXNlUm91dGVyOiBqZXN0LmZuKCksXHJcbn0pKTtcclxuXHJcbmplc3QubW9jaygnQC9saWIvYXBpL3Byb2R1Y3RzJywgKCkgPT4gKHtcclxuICBzZWFyY2hQcm9kdWN0czogamVzdC5mbigpLFxyXG59KSk7XHJcblxyXG5jb25zdCBtb2NrUHVzaCA9IGplc3QuZm4oKTtcclxuY29uc3QgbW9ja1NlYXJjaFByb2R1Y3RzID0gc2VhcmNoUHJvZHVjdHMgYXMgamVzdC5Nb2NrZWRGdW5jdGlvbjx0eXBlb2Ygc2VhcmNoUHJvZHVjdHM+O1xyXG5cclxuYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgKHVzZVJvdXRlciBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICBwdXNoOiBtb2NrUHVzaCxcclxuICB9KTtcclxuICBcclxuICAvLyBNb2NrIGxvY2FsU3RvcmFnZVxyXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdsb2NhbFN0b3JhZ2UnLCB7XHJcbiAgICB2YWx1ZToge1xyXG4gICAgICBnZXRJdGVtOiBqZXN0LmZuKCgpID0+IG51bGwpLFxyXG4gICAgICBzZXRJdGVtOiBqZXN0LmZuKCksXHJcbiAgICAgIHJlbW92ZUl0ZW06IGplc3QuZm4oKSxcclxuICAgICAgY2xlYXI6IGplc3QuZm4oKSxcclxuICAgIH0sXHJcbiAgICB3cml0YWJsZTogdHJ1ZSxcclxuICB9KTtcclxufSk7XHJcblxyXG5kZXNjcmliZSgnU2VhcmNoQXV0b2NvbXBsZXRlSW50ZWdyYXRlZCcsICgpID0+IHtcclxuICBpdCgnc2hvdWxkIHJlbmRlciB3aXRoIGRlZmF1bHQgcHJvcHMnLCAoKSA9PiB7XHJcbiAgICByZW5kZXIoPFNlYXJjaEF1dG9jb21wbGV0ZUludGVncmF0ZWQgLz4pO1xyXG4gICAgXHJcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5Um9sZSgnY29tYm9ib3gnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlQbGFjZWhvbGRlclRleHQoJ0J1c2NvIHByb2R1Y3RvcyBkZSBwaW50dXJlcsOtYS4uLicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGludGVncmF0ZSB3aXRoIHVzZVNlYXJjaCBob29rIGFuZCBzaG93IHN1Z2dlc3Rpb25zJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgbW9ja1Jlc3BvbnNlID0ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiBbXHJcbiAgICAgICAgeyBcclxuICAgICAgICAgIGlkOiAnMScsIFxyXG4gICAgICAgICAgbmFtZTogJ1BpbnR1cmEgTMOhdGV4IEJsYW5jYScsIFxyXG4gICAgICAgICAgY2F0ZWdvcnk6IHsgbmFtZTogJ1BpbnR1cmFzJyB9LFxyXG4gICAgICAgICAgaW1hZ2VzOiB7IHByZXZpZXdzOiBbJy90ZXN0LmpwZyddIH0sXHJcbiAgICAgICAgICBzdG9jazogMTBcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgXHJcbiAgICAgICAgICBpZDogJzInLCBcclxuICAgICAgICAgIG5hbWU6ICdQaW50dXJhIEVzbWFsdGUgQXp1bCcsIFxyXG4gICAgICAgICAgY2F0ZWdvcnk6IHsgbmFtZTogJ1BpbnR1cmFzJyB9LFxyXG4gICAgICAgICAgaW1hZ2VzOiB7IHByZXZpZXdzOiBbJy90ZXN0Mi5qcGcnXSB9LFxyXG4gICAgICAgICAgc3RvY2s6IDVcclxuICAgICAgICB9LFxyXG4gICAgICBdLFxyXG4gICAgICBwYWdpbmF0aW9uOiB7IHRvdGFsOiAyLCBwYWdlOiAxLCBsaW1pdDogNiwgdG90YWxQYWdlczogMSB9LFxyXG4gICAgfTtcclxuXHJcbiAgICBtb2NrU2VhcmNoUHJvZHVjdHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3BvbnNlKTtcclxuXHJcbiAgICByZW5kZXIoPFNlYXJjaEF1dG9jb21wbGV0ZUludGVncmF0ZWQgZGVib3VuY2VNcz17MTAwfSAvPik7XHJcbiAgICBcclxuICAgIGNvbnN0IGlucHV0ID0gc2NyZWVuLmdldEJ5Um9sZSgnY29tYm9ib3gnKTtcclxuICAgIFxyXG4gICAgYXdhaXQgdXNlckV2ZW50LnR5cGUoaW5wdXQsICdwaW50dXJhJyk7XHJcbiAgICBcclxuICAgIC8vIEVzcGVyYXIgYSBxdWUgYXBhcmV6Y2FuIGxhcyBzdWdlcmVuY2lhc1xyXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KCdQaW50dXJhIEzDoXRleCBCbGFuY2EnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJ1BpbnR1cmEgRXNtYWx0ZSBBenVsJykpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICB9LCB7IHRpbWVvdXQ6IDEwMDAgfSk7XHJcblxyXG4gICAgLy8gVmVyaWZpY2FyIHF1ZSBzZSBsbGFtw7MgYSBsYSBBUElcclxuICAgIGV4cGVjdChtb2NrU2VhcmNoUHJvZHVjdHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwaW50dXJhJywgNik7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgZXhlY3V0ZSBzZWFyY2ggb24gRW50ZXIga2V5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3Qgb25TZWFyY2hFeGVjdXRlZCA9IGplc3QuZm4oKTtcclxuICAgIGNvbnN0IG1vY2tSZXNwb25zZSA9IHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YTogW3sgaWQ6ICcxJywgbmFtZTogJ1Rlc3QgUHJvZHVjdCcsIGNhdGVnb3J5OiB7IG5hbWU6ICdUZXN0JyB9IH1dLFxyXG4gICAgICBwYWdpbmF0aW9uOiB7IHRvdGFsOiAxLCBwYWdlOiAxLCBsaW1pdDogMTIsIHRvdGFsUGFnZXM6IDEgfSxcclxuICAgIH07XHJcblxyXG4gICAgbW9ja1NlYXJjaFByb2R1Y3RzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXNwb25zZSk7XHJcblxyXG4gICAgcmVuZGVyKFxyXG4gICAgICA8U2VhcmNoQXV0b2NvbXBsZXRlSW50ZWdyYXRlZCBcclxuICAgICAgICBvblNlYXJjaEV4ZWN1dGVkPXtvblNlYXJjaEV4ZWN1dGVkfVxyXG4gICAgICAgIGRlYm91bmNlTXM9ezEwMH1cclxuICAgICAgLz5cclxuICAgICk7XHJcbiAgICBcclxuICAgIGNvbnN0IGlucHV0ID0gc2NyZWVuLmdldEJ5Um9sZSgnY29tYm9ib3gnKTtcclxuICAgIFxyXG4gICAgYXdhaXQgdXNlckV2ZW50LnR5cGUoaW5wdXQsICd0ZXN0IHF1ZXJ5Jyk7XHJcbiAgICBhd2FpdCB1c2VyRXZlbnQua2V5Ym9hcmQoJ3tFbnRlcn0nKTtcclxuICAgIFxyXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChtb2NrUHVzaCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy9zZWFyY2g/cT10ZXN0JTIwcXVlcnknKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGhhbmRsZSBzdWdnZXN0aW9uIHNlbGVjdGlvbicsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IG9uU3VnZ2VzdGlvblNlbGVjdGVkID0gamVzdC5mbigpO1xyXG4gICAgY29uc3QgbW9ja1Jlc3BvbnNlID0ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiBbXHJcbiAgICAgICAgeyBcclxuICAgICAgICAgIGlkOiAnMScsIFxyXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgUHJvZHVjdCcsIFxyXG4gICAgICAgICAgY2F0ZWdvcnk6IHsgbmFtZTogJ1Rlc3QgQ2F0ZWdvcnknIH0sXHJcbiAgICAgICAgICBpbWFnZXM6IHsgcHJldmlld3M6IFsnL3Rlc3QuanBnJ10gfSxcclxuICAgICAgICAgIHN0b2NrOiAxMFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF0sXHJcbiAgICAgIHBhZ2luYXRpb246IHsgdG90YWw6IDEsIHBhZ2U6IDEsIGxpbWl0OiA2LCB0b3RhbFBhZ2VzOiAxIH0sXHJcbiAgICB9O1xyXG5cclxuICAgIG1vY2tTZWFyY2hQcm9kdWN0cy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzcG9uc2UpO1xyXG5cclxuICAgIHJlbmRlcihcclxuICAgICAgPFNlYXJjaEF1dG9jb21wbGV0ZUludGVncmF0ZWQgXHJcbiAgICAgICAgb25TdWdnZXN0aW9uU2VsZWN0ZWQ9e29uU3VnZ2VzdGlvblNlbGVjdGVkfVxyXG4gICAgICAgIGRlYm91bmNlTXM9ezEwMH1cclxuICAgICAgLz5cclxuICAgICk7XHJcbiAgICBcclxuICAgIGNvbnN0IGlucHV0ID0gc2NyZWVuLmdldEJ5Um9sZSgnY29tYm9ib3gnKTtcclxuICAgIFxyXG4gICAgYXdhaXQgdXNlckV2ZW50LnR5cGUoaW5wdXQsICd0ZXN0Jyk7XHJcbiAgICBcclxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xyXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnVGVzdCBQcm9kdWN0JykpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhd2FpdCB1c2VyRXZlbnQuY2xpY2soc2NyZWVuLmdldEJ5VGV4dCgnVGVzdCBQcm9kdWN0JykpO1xyXG4gICAgXHJcbiAgICBleHBlY3Qob25TdWdnZXN0aW9uU2VsZWN0ZWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgdGl0bGU6ICdUZXN0IFByb2R1Y3QnLFxyXG4gICAgICAgIHR5cGU6ICdwcm9kdWN0J1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBjbGVhciBzZWFyY2ggd2hlbiBjbGVhciBidXR0b24gaXMgY2xpY2tlZCcsIGFzeW5jICgpID0+IHtcclxuICAgIHJlbmRlcig8U2VhcmNoQXV0b2NvbXBsZXRlSW50ZWdyYXRlZCAvPik7XHJcbiAgICBcclxuICAgIGNvbnN0IGlucHV0ID0gc2NyZWVuLmdldEJ5Um9sZSgnY29tYm9ib3gnKTtcclxuICAgIFxyXG4gICAgYXdhaXQgdXNlckV2ZW50LnR5cGUoaW5wdXQsICd0ZXN0IHF1ZXJ5Jyk7XHJcbiAgICBcclxuICAgIC8vIEJ1c2NhciBlbCBib3TDs24gZGUgbGltcGlhclxyXG4gICAgY29uc3QgY2xlYXJCdXR0b24gPSBzY3JlZW4uZ2V0QnlMYWJlbFRleHQoJ0NsZWFyIHNlYXJjaCcpO1xyXG4gICAgYXdhaXQgdXNlckV2ZW50LmNsaWNrKGNsZWFyQnV0dG9uKTtcclxuICAgIFxyXG4gICAgZXhwZWN0KGlucHV0KS50b0hhdmVWYWx1ZSgnJyk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgc2hvdyBsb2FkaW5nIHN0YXRlIGR1cmluZyBzZWFyY2gnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBNb2NrIHBhcmEgc2ltdWxhciBiw7pzcXVlZGEgbGVudGFcclxuICAgIG1vY2tTZWFyY2hQcm9kdWN0cy5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gXHJcbiAgICAgIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dCgoKSA9PiByZXNvbHZlKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGRhdGE6IFtdLFxyXG4gICAgICAgIHBhZ2luYXRpb246IHsgdG90YWw6IDAsIHBhZ2U6IDEsIGxpbWl0OiA2LCB0b3RhbFBhZ2VzOiAwIH0sXHJcbiAgICAgIH0pLCAxMDAwKSlcclxuICAgICk7XHJcblxyXG4gICAgcmVuZGVyKDxTZWFyY2hBdXRvY29tcGxldGVJbnRlZ3JhdGVkIGRlYm91bmNlTXM9ezUwfSAvPik7XHJcbiAgICBcclxuICAgIGNvbnN0IGlucHV0ID0gc2NyZWVuLmdldEJ5Um9sZSgnY29tYm9ib3gnKTtcclxuICAgIFxyXG4gICAgYXdhaXQgdXNlckV2ZW50LnR5cGUoaW5wdXQsICd0ZXN0Jyk7XHJcbiAgICBcclxuICAgIC8vIFZlcmlmaWNhciBxdWUgYXBhcmVjZSBlbCBzcGlubmVyIGRlIGNhcmdhXHJcbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hbmltYXRlLXNwaW4nKTtcclxuICAgICAgZXhwZWN0KHNwaW5uZXIpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBoYW5kbGUgQVBJIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgbW9ja1NlYXJjaFByb2R1Y3RzLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQVBJIEVycm9yJykpO1xyXG5cclxuICAgIHJlbmRlcig8U2VhcmNoQXV0b2NvbXBsZXRlSW50ZWdyYXRlZCBkZWJvdW5jZU1zPXs1MH0gLz4pO1xyXG4gICAgXHJcbiAgICBjb25zdCBpbnB1dCA9IHNjcmVlbi5nZXRCeVJvbGUoJ2NvbWJvYm94Jyk7XHJcbiAgICBcclxuICAgIGF3YWl0IHVzZXJFdmVudC50eXBlKGlucHV0LCAndGVzdCcpO1xyXG4gICAgXHJcbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcclxuICAgICAgZXhwZWN0KG1vY2tTZWFyY2hQcm9kdWN0cykudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gRWwgY29tcG9uZW50ZSBubyBkZWJlcsOtYSBjcmFzaGVhciB5IGRlYmVyw61hIG1vc3RyYXIgZXN0YWRvIHNpbiByZXN1bHRhZG9zXHJcbiAgICBleHBlY3QoaW5wdXQpLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJ1c2VSb3V0ZXIiLCJmbiIsInNlYXJjaFByb2R1Y3RzIiwibW9ja1B1c2giLCJtb2NrU2VhcmNoUHJvZHVjdHMiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsIm1vY2tSZXR1cm5WYWx1ZSIsInB1c2giLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsIndpbmRvdyIsInZhbHVlIiwiZ2V0SXRlbSIsInNldEl0ZW0iLCJyZW1vdmVJdGVtIiwiY2xlYXIiLCJ3cml0YWJsZSIsImRlc2NyaWJlIiwiaXQiLCJyZW5kZXIiLCJTZWFyY2hBdXRvY29tcGxldGVJbnRlZ3JhdGVkIiwiZXhwZWN0Iiwic2NyZWVuIiwiZ2V0QnlSb2xlIiwidG9CZUluVGhlRG9jdW1lbnQiLCJnZXRCeVBsYWNlaG9sZGVyVGV4dCIsIm1vY2tSZXNwb25zZSIsInN1Y2Nlc3MiLCJkYXRhIiwiaWQiLCJuYW1lIiwiY2F0ZWdvcnkiLCJpbWFnZXMiLCJwcmV2aWV3cyIsInN0b2NrIiwicGFnaW5hdGlvbiIsInRvdGFsIiwicGFnZSIsImxpbWl0IiwidG90YWxQYWdlcyIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiZGVib3VuY2VNcyIsImlucHV0IiwidXNlckV2ZW50IiwidHlwZSIsIndhaXRGb3IiLCJnZXRCeVRleHQiLCJ0aW1lb3V0IiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJvblNlYXJjaEV4ZWN1dGVkIiwia2V5Ym9hcmQiLCJvblN1Z2dlc3Rpb25TZWxlY3RlZCIsImNsaWNrIiwib2JqZWN0Q29udGFpbmluZyIsInRpdGxlIiwiY2xlYXJCdXR0b24iLCJnZXRCeUxhYmVsVGV4dCIsInRvSGF2ZVZhbHVlIiwibW9ja0ltcGxlbWVudGF0aW9uIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Iiwic3Bpbm5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIm1vY2tSZWplY3RlZFZhbHVlIiwiRXJyb3IiLCJ0b0hhdmVCZWVuQ2FsbGVkIl0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMsNkRBQTZEO0FBQzdELHNDQUFzQzs7QUFTdEMsUUFBUTtBQUNSQSxLQUFLQyxJQUFJLENBQUMsbUJBQW1CLElBQU8sQ0FBQTtRQUNsQ0MsV0FBV0YsS0FBS0csRUFBRTtJQUNwQixDQUFBO0FBRUFILEtBQUtDLElBQUksQ0FBQyxzQkFBc0IsSUFBTyxDQUFBO1FBQ3JDRyxnQkFBZ0JKLEtBQUtHLEVBQUU7SUFDekIsQ0FBQTs7Ozs7OERBZGtCO3dCQUNzQjtrRUFDbEI7NEJBQ0k7MEJBQ0s7OENBQ2M7Ozs7OztBQVc3QyxNQUFNRSxXQUFXTCxLQUFLRyxFQUFFO0FBQ3hCLE1BQU1HLHFCQUFxQkYsd0JB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