20158384fa45cc5dafdb56715dfe62c9
/**
 * Tests para las validaciones de seguridad avanzadas
 * Verifica permisos granulares y contexto de seguridad
 */ "use strict";
// Mock de Clerk
jest.mock('@clerk/nextjs/server', ()=>({
        clerkClient: jest.fn(()=>({
                users: {
                    getUser: jest.fn()
                }
            }))
    }));
// Mock de Supabase
jest.mock('@/lib/supabase', ()=>({
        supabaseAdmin: {
            from: jest.fn(()=>({
                    insert: jest.fn(()=>({
                            error: null
                        })),
                    select: jest.fn(()=>({
                            eq: jest.fn(()=>({
                                    gte: jest.fn(()=>({
                                            not: jest.fn(()=>({
                                                    data: [],
                                                    error: null
                                                }))
                                        }))
                                }))
                        }))
                }))
        }
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _securityvalidations = require("../lib/auth/security-validations");
const _server = require("@clerk/nextjs/server");
describe('Validaciones de Seguridad', ()=>{
    let mockClerkClient;
    beforeEach(()=>{
        mockClerkClient = _server.clerkClient;
        jest.clearAllMocks();
    });
    describe('getPermissionsByRole', ()=>{
        it('debe retornar permisos completos para admin', ()=>{
            const permissions = (0, _securityvalidations.getPermissionsByRole)('admin');
            expect(permissions.isAdmin).toBe(true);
            expect(permissions.canDeleteProducts).toBe(true);
            expect(permissions.canManageUsers).toBe(true);
            expect(permissions.canAccessAdmin).toBe(true);
        });
        it('debe retornar permisos limitados para moderator', ()=>{
            const permissions = (0, _securityvalidations.getPermissionsByRole)('moderator');
            expect(permissions.isAdmin).toBe(false);
            expect(permissions.isModerator).toBe(true);
            expect(permissions.canDeleteProducts).toBe(false);
            expect(permissions.canManageUsers).toBe(false);
            expect(permissions.canAccessAdmin).toBe(true);
        });
        it('debe retornar permisos básicos para manager', ()=>{
            const permissions = (0, _securityvalidations.getPermissionsByRole)('manager');
            expect(permissions.isAdmin).toBe(false);
            expect(permissions.isModerator).toBe(false);
            expect(permissions.canDeleteProducts).toBe(false);
            expect(permissions.canAccessAdmin).toBe(true);
            expect(permissions.canViewAnalytics).toBe(true);
        });
        it('debe retornar sin permisos para user', ()=>{
            const permissions = (0, _securityvalidations.getPermissionsByRole)('user');
            expect(permissions.isAdmin).toBe(false);
            expect(permissions.canAccessAdmin).toBe(false);
            expect(permissions.canReadProducts).toBe(false);
        });
        it('debe retornar permisos de user para rol desconocido', ()=>{
            const permissions = (0, _securityvalidations.getPermissionsByRole)('unknown_role');
            expect(permissions.isAdmin).toBe(false);
            expect(permissions.canAccessAdmin).toBe(false);
        });
    });
    describe('isValidAdminRole', ()=>{
        it('debe validar roles administrativos', ()=>{
            expect((0, _securityvalidations.isValidAdminRole)('admin')).toBe(true);
            expect((0, _securityvalidations.isValidAdminRole)('moderator')).toBe(true);
            expect((0, _securityvalidations.isValidAdminRole)('manager')).toBe(true);
        });
        it('debe rechazar roles no administrativos', ()=>{
            expect((0, _securityvalidations.isValidAdminRole)('user')).toBe(false);
            expect((0, _securityvalidations.isValidAdminRole)('guest')).toBe(false);
            expect((0, _securityvalidations.isValidAdminRole)('')).toBe(false);
        });
    });
    describe('hasPermission', ()=>{
        it('debe verificar permisos individuales correctamente', ()=>{
            const adminPermissions = (0, _securityvalidations.getPermissionsByRole)('admin');
            const userPermissions = (0, _securityvalidations.getPermissionsByRole)('user');
            expect((0, _securityvalidations.hasPermission)(adminPermissions, 'canDeleteProducts')).toBe(true);
            expect((0, _securityvalidations.hasPermission)(userPermissions, 'canDeleteProducts')).toBe(false);
        });
    });
    describe('hasAnyPermission', ()=>{
        it('debe verificar que al menos un permiso esté presente', ()=>{
            const moderatorPermissions = (0, _securityvalidations.getPermissionsByRole)('moderator');
            expect((0, _securityvalidations.hasAnyPermission)(moderatorPermissions, [
                'canDeleteProducts',
                'canWriteProducts'
            ])).toBe(true);
            expect((0, _securityvalidations.hasAnyPermission)(moderatorPermissions, [
                'canDeleteProducts',
                'canManageUsers'
            ])).toBe(false);
        });
    });
    describe('hasAllPermissions', ()=>{
        it('debe verificar que todos los permisos estén presentes', ()=>{
            const adminPermissions = (0, _securityvalidations.getPermissionsByRole)('admin');
            const moderatorPermissions = (0, _securityvalidations.getPermissionsByRole)('moderator');
            expect((0, _securityvalidations.hasAllPermissions)(adminPermissions, [
                'canReadProducts',
                'canWriteProducts'
            ])).toBe(true);
            expect((0, _securityvalidations.hasAllPermissions)(moderatorPermissions, [
                'canReadProducts',
                'canDeleteProducts'
            ])).toBe(false);
        });
    });
    describe('getSecurityContext', ()=>{
        it('debe obtener contexto de seguridad completo', async ()=>{
            const mockUser = {
                id: 'user_123',
                publicMetadata: {
                    role: 'admin',
                    department: 'IT',
                    isActive: true
                },
                emailAddresses: [
                    {
                        verification: {
                            status: 'verified'
                        }
                    }
                ]
            };
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(mockUser)
                }
            });
            const mockRequest = {
                headers: {
                    get: jest.fn().mockImplementation((key)=>{
                        if (key === 'x-forwarded-for') return '192.168.1.1';
                        if (key === 'user-agent') return 'Test Browser';
                        return null;
                    })
                }
            };
            const context = await (0, _securityvalidations.getSecurityContext)('user_123', mockRequest);
            expect(context).toBeDefined();
            expect(context?.userId).toBe('user_123');
            expect(context?.userRole).toBe('admin');
            expect(context?.permissions.isAdmin).toBe(true);
            expect(context?.metadata.emailVerified).toBe(true);
            expect(context?.ipAddress).toBe('192.168.1.1');
            expect(context?.userAgent).toBe('Test Browser');
        });
        it('debe manejar usuario no encontrado', async ()=>{
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(null)
                }
            });
            const context = await (0, _securityvalidations.getSecurityContext)('user_not_found');
            expect(context).toBeNull();
        });
        it('debe manejar errores de Clerk', async ()=>{
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockRejectedValue(new Error('Clerk error'))
                }
            });
            const context = await (0, _securityvalidations.getSecurityContext)('user_error');
            expect(context).toBeNull();
        });
    });
    describe('validateSecurityContext', ()=>{
        beforeEach(()=>{
            const mockUser = {
                id: 'user_123',
                publicMetadata: {
                    role: 'admin',
                    isActive: true
                },
                emailAddresses: [
                    {
                        verification: {
                            status: 'verified'
                        }
                    }
                ]
            };
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(mockUser)
                }
            });
        });
        it('debe validar contexto exitosamente para admin', async ()=>{
            const result = await (0, _securityvalidations.validateSecurityContext)('user_123', 'PRODUCT_DELETE', [
                'canDeleteProducts'
            ]);
            expect(result.valid).toBe(true);
            expect(result.context).toBeDefined();
            expect(result.context?.permissions.canDeleteProducts).toBe(true);
        });
        it('debe rechazar permisos insuficientes', async ()=>{
            const mockUser = {
                id: 'user_123',
                publicMetadata: {
                    role: 'user',
                    isActive: true
                },
                emailAddresses: [
                    {
                        verification: {
                            status: 'verified'
                        }
                    }
                ]
            };
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(mockUser)
                }
            });
            const result = await (0, _securityvalidations.validateSecurityContext)('user_123', 'PRODUCT_DELETE', [
                'canDeleteProducts'
            ]);
            expect(result.valid).toBe(false);
            expect(result.code).toBe('INSUFFICIENT_PERMISSIONS');
            expect(result.severity).toBe('high');
        });
        it('debe rechazar usuario inactivo', async ()=>{
            const mockUser = {
                id: 'user_123',
                publicMetadata: {
                    role: 'admin',
                    isActive: false
                },
                emailAddresses: [
                    {
                        verification: {
                            status: 'verified'
                        }
                    }
                ]
            };
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(mockUser)
                }
            });
            const result = await (0, _securityvalidations.validateSecurityContext)('user_123', 'PRODUCT_READ', [
                'canReadProducts'
            ]);
            expect(result.valid).toBe(false);
            expect(result.code).toBe('USER_INACTIVE');
            expect(result.severity).toBe('medium');
        });
    });
    describe('validateProductPermissions', ()=>{
        beforeEach(()=>{
            const mockUser = {
                id: 'user_123',
                publicMetadata: {
                    role: 'admin',
                    isActive: true
                },
                emailAddresses: [
                    {
                        verification: {
                            status: 'verified'
                        }
                    }
                ]
            };
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(mockUser)
                }
            });
        });
        it('debe validar permisos de lectura', async ()=>{
            const result = await (0, _securityvalidations.validateProductPermissions)('user_123', 'read');
            expect(result.valid).toBe(true);
        });
        it('debe validar permisos de creación', async ()=>{
            const result = await (0, _securityvalidations.validateProductPermissions)('user_123', 'create');
            expect(result.valid).toBe(true);
        });
        it('debe validar permisos de eliminación', async ()=>{
            const result = await (0, _securityvalidations.validateProductPermissions)('user_123', 'delete');
            expect(result.valid).toBe(true);
        });
    });
    describe('withSecurityValidation wrapper', ()=>{
        it('debe crear wrapper funcional', ()=>{
            const mockHandler = jest.fn();
            const wrappedHandler = (0, _securityvalidations.withSecurityValidation)([
                'canReadProducts'
            ], 'PRODUCT_READ')(mockHandler);
            expect(typeof wrappedHandler).toBe('function');
        });
        it('debe rechazar request sin userId', async ()=>{
            const mockHandler = jest.fn();
            const wrappedHandler = (0, _securityvalidations.withSecurityValidation)([
                'canReadProducts'
            ], 'PRODUCT_READ')(mockHandler);
            const mockRequest = {
                headers: {
                    get: jest.fn().mockReturnValue(null)
                }
            };
            const mockResponse = {
                status: jest.fn().mockReturnThis(),
                json: jest.fn()
            };
            await wrappedHandler(mockRequest, mockResponse);
            expect(mockResponse.status).toHaveBeenCalledWith(401);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                error: 'Usuario no autenticado',
                code: 'AUTH_REQUIRED'
            });
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcX190ZXN0c19fXFxzZWN1cml0eS12YWxpZGF0aW9ucy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgcGFyYSBsYXMgdmFsaWRhY2lvbmVzIGRlIHNlZ3VyaWRhZCBhdmFuemFkYXNcbiAqIFZlcmlmaWNhIHBlcm1pc29zIGdyYW51bGFyZXMgeSBjb250ZXh0byBkZSBzZWd1cmlkYWRcbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QgfSBmcm9tICduZXh0JztcblxuLy8gTW9jayBkZSBDbGVya1xuamVzdC5tb2NrKCdAY2xlcmsvbmV4dGpzL3NlcnZlcicsICgpID0+ICh7XG4gIGNsZXJrQ2xpZW50OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgdXNlcnM6IHtcbiAgICAgIGdldFVzZXI6IGplc3QuZm4oKVxuICAgIH1cbiAgfSkpXG59KSk7XG5cbi8vIE1vY2sgZGUgU3VwYWJhc2Vcbmplc3QubW9jaygnQC9saWIvc3VwYWJhc2UnLCAoKSA9PiAoe1xuICBzdXBhYmFzZUFkbWluOiB7XG4gICAgZnJvbTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgaW5zZXJ0OiBqZXN0LmZuKCgpID0+ICh7IGVycm9yOiBudWxsIH0pKSxcbiAgICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICAgIGd0ZTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICAgICAgbm90OiBqZXN0LmZuKCgpID0+ICh7IGRhdGE6IFtdLCBlcnJvcjogbnVsbCB9KSlcbiAgICAgICAgICB9KSlcbiAgICAgICAgfSkpXG4gICAgICB9KSlcbiAgICB9KSlcbiAgfVxufSkpO1xuXG5pbXBvcnQge1xuICBnZXRQZXJtaXNzaW9uc0J5Um9sZSxcbiAgaXNWYWxpZEFkbWluUm9sZSxcbiAgaGFzUGVybWlzc2lvbixcbiAgaGFzQW55UGVybWlzc2lvbixcbiAgaGFzQWxsUGVybWlzc2lvbnMsXG4gIGdldFNlY3VyaXR5Q29udGV4dCxcbiAgdmFsaWRhdGVTZWN1cml0eUNvbnRleHQsXG4gIHZhbGlkYXRlUHJvZHVjdFBlcm1pc3Npb25zLFxuICB3aXRoU2VjdXJpdHlWYWxpZGF0aW9uXG59IGZyb20gJ0AvbGliL2F1dGgvc2VjdXJpdHktdmFsaWRhdGlvbnMnO1xuaW1wb3J0IHsgY2xlcmtDbGllbnQgfSBmcm9tICdAY2xlcmsvbmV4dGpzL3NlcnZlcic7XG5cbmRlc2NyaWJlKCdWYWxpZGFjaW9uZXMgZGUgU2VndXJpZGFkJywgKCkgPT4ge1xuICBsZXQgbW9ja0NsZXJrQ2xpZW50OiBqZXN0Lk1vY2tlZEZ1bmN0aW9uPHR5cGVvZiBjbGVya0NsaWVudD47XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja0NsZXJrQ2xpZW50ID0gY2xlcmtDbGllbnQgYXMgamVzdC5Nb2NrZWRGdW5jdGlvbjx0eXBlb2YgY2xlcmtDbGllbnQ+O1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UGVybWlzc2lvbnNCeVJvbGUnLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgcmV0b3JuYXIgcGVybWlzb3MgY29tcGxldG9zIHBhcmEgYWRtaW4nLCAoKSA9PiB7XG4gICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IGdldFBlcm1pc3Npb25zQnlSb2xlKCdhZG1pbicpO1xuICAgICAgXG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuaXNBZG1pbikudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5jYW5EZWxldGVQcm9kdWN0cykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5jYW5NYW5hZ2VVc2VycykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5jYW5BY2Nlc3NBZG1pbikudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJldG9ybmFyIHBlcm1pc29zIGxpbWl0YWRvcyBwYXJhIG1vZGVyYXRvcicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlcm1pc3Npb25zID0gZ2V0UGVybWlzc2lvbnNCeVJvbGUoJ21vZGVyYXRvcicpO1xuICAgICAgXG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuaXNBZG1pbikudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuaXNNb2RlcmF0b3IpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuY2FuRGVsZXRlUHJvZHVjdHMpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zLmNhbk1hbmFnZVVzZXJzKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5jYW5BY2Nlc3NBZG1pbikudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJldG9ybmFyIHBlcm1pc29zIGLDoXNpY29zIHBhcmEgbWFuYWdlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlcm1pc3Npb25zID0gZ2V0UGVybWlzc2lvbnNCeVJvbGUoJ21hbmFnZXInKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zLmlzQWRtaW4pLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zLmlzTW9kZXJhdG9yKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5jYW5EZWxldGVQcm9kdWN0cykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuY2FuQWNjZXNzQWRtaW4pLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuY2FuVmlld0FuYWx5dGljcykudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJldG9ybmFyIHNpbiBwZXJtaXNvcyBwYXJhIHVzZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IGdldFBlcm1pc3Npb25zQnlSb2xlKCd1c2VyJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5pc0FkbWluKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5jYW5BY2Nlc3NBZG1pbikudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuY2FuUmVhZFByb2R1Y3RzKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJldG9ybmFyIHBlcm1pc29zIGRlIHVzZXIgcGFyYSByb2wgZGVzY29ub2NpZG8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IGdldFBlcm1pc3Npb25zQnlSb2xlKCd1bmtub3duX3JvbGUnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zLmlzQWRtaW4pLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zLmNhbkFjY2Vzc0FkbWluKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2lzVmFsaWRBZG1pblJvbGUnLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgdmFsaWRhciByb2xlcyBhZG1pbmlzdHJhdGl2b3MnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaXNWYWxpZEFkbWluUm9sZSgnYWRtaW4nKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkQWRtaW5Sb2xlKCdtb2RlcmF0b3InKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkQWRtaW5Sb2xlKCdtYW5hZ2VyJykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSByZWNoYXphciByb2xlcyBubyBhZG1pbmlzdHJhdGl2b3MnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaXNWYWxpZEFkbWluUm9sZSgndXNlcicpKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkQWRtaW5Sb2xlKCdndWVzdCcpKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkQWRtaW5Sb2xlKCcnKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdoYXNQZXJtaXNzaW9uJywgKCkgPT4ge1xuICAgIGl0KCdkZWJlIHZlcmlmaWNhciBwZXJtaXNvcyBpbmRpdmlkdWFsZXMgY29ycmVjdGFtZW50ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGFkbWluUGVybWlzc2lvbnMgPSBnZXRQZXJtaXNzaW9uc0J5Um9sZSgnYWRtaW4nKTtcbiAgICAgIGNvbnN0IHVzZXJQZXJtaXNzaW9ucyA9IGdldFBlcm1pc3Npb25zQnlSb2xlKCd1c2VyJyk7XG5cbiAgICAgIGV4cGVjdChoYXNQZXJtaXNzaW9uKGFkbWluUGVybWlzc2lvbnMsICdjYW5EZWxldGVQcm9kdWN0cycpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGhhc1Blcm1pc3Npb24odXNlclBlcm1pc3Npb25zLCAnY2FuRGVsZXRlUHJvZHVjdHMnKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdoYXNBbnlQZXJtaXNzaW9uJywgKCkgPT4ge1xuICAgIGl0KCdkZWJlIHZlcmlmaWNhciBxdWUgYWwgbWVub3MgdW4gcGVybWlzbyBlc3TDqSBwcmVzZW50ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vZGVyYXRvclBlcm1pc3Npb25zID0gZ2V0UGVybWlzc2lvbnNCeVJvbGUoJ21vZGVyYXRvcicpO1xuXG4gICAgICBleHBlY3QoaGFzQW55UGVybWlzc2lvbihtb2RlcmF0b3JQZXJtaXNzaW9ucywgWydjYW5EZWxldGVQcm9kdWN0cycsICdjYW5Xcml0ZVByb2R1Y3RzJ10pKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGhhc0FueVBlcm1pc3Npb24obW9kZXJhdG9yUGVybWlzc2lvbnMsIFsnY2FuRGVsZXRlUHJvZHVjdHMnLCAnY2FuTWFuYWdlVXNlcnMnXSkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaGFzQWxsUGVybWlzc2lvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgdmVyaWZpY2FyIHF1ZSB0b2RvcyBsb3MgcGVybWlzb3MgZXN0w6luIHByZXNlbnRlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGFkbWluUGVybWlzc2lvbnMgPSBnZXRQZXJtaXNzaW9uc0J5Um9sZSgnYWRtaW4nKTtcbiAgICAgIGNvbnN0IG1vZGVyYXRvclBlcm1pc3Npb25zID0gZ2V0UGVybWlzc2lvbnNCeVJvbGUoJ21vZGVyYXRvcicpO1xuXG4gICAgICBleHBlY3QoaGFzQWxsUGVybWlzc2lvbnMoYWRtaW5QZXJtaXNzaW9ucywgWydjYW5SZWFkUHJvZHVjdHMnLCAnY2FuV3JpdGVQcm9kdWN0cyddKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChoYXNBbGxQZXJtaXNzaW9ucyhtb2RlcmF0b3JQZXJtaXNzaW9ucywgWydjYW5SZWFkUHJvZHVjdHMnLCAnY2FuRGVsZXRlUHJvZHVjdHMnXSkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U2VjdXJpdHlDb250ZXh0JywgKCkgPT4ge1xuICAgIGl0KCdkZWJlIG9idGVuZXIgY29udGV4dG8gZGUgc2VndXJpZGFkIGNvbXBsZXRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAndXNlcl8xMjMnLFxuICAgICAgICBwdWJsaWNNZXRhZGF0YToge1xuICAgICAgICAgIHJvbGU6ICdhZG1pbicsXG4gICAgICAgICAgZGVwYXJ0bWVudDogJ0lUJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbEFkZHJlc3NlczogW3tcbiAgICAgICAgICB2ZXJpZmljYXRpb246IHsgc3RhdHVzOiAndmVyaWZpZWQnIH1cbiAgICAgICAgfV1cbiAgICAgIH07XG5cbiAgICAgIG1vY2tDbGVya0NsaWVudC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB1c2Vyczoge1xuICAgICAgICAgIGdldFVzZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcilcbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5KSA9PiB7XG4gICAgICAgICAgICBpZiAoa2V5ID09PSAneC1mb3J3YXJkZWQtZm9yJykgcmV0dXJuICcxOTIuMTY4LjEuMSc7XG4gICAgICAgICAgICBpZiAoa2V5ID09PSAndXNlci1hZ2VudCcpIHJldHVybiAnVGVzdCBCcm93c2VyJztcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBjb25zdCBjb250ZXh0ID0gYXdhaXQgZ2V0U2VjdXJpdHlDb250ZXh0KCd1c2VyXzEyMycsIG1vY2tSZXF1ZXN0KTtcblxuICAgICAgZXhwZWN0KGNvbnRleHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoY29udGV4dD8udXNlcklkKS50b0JlKCd1c2VyXzEyMycpO1xuICAgICAgZXhwZWN0KGNvbnRleHQ/LnVzZXJSb2xlKS50b0JlKCdhZG1pbicpO1xuICAgICAgZXhwZWN0KGNvbnRleHQ/LnBlcm1pc3Npb25zLmlzQWRtaW4pLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY29udGV4dD8ubWV0YWRhdGEuZW1haWxWZXJpZmllZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChjb250ZXh0Py5pcEFkZHJlc3MpLnRvQmUoJzE5Mi4xNjguMS4xJyk7XG4gICAgICBleHBlY3QoY29udGV4dD8udXNlckFnZW50KS50b0JlKCdUZXN0IEJyb3dzZXInKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIG1hbmVqYXIgdXN1YXJpbyBubyBlbmNvbnRyYWRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NsZXJrQ2xpZW50Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHVzZXJzOiB7XG4gICAgICAgICAgZ2V0VXNlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpXG4gICAgICAgIH1cbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgY29udGV4dCA9IGF3YWl0IGdldFNlY3VyaXR5Q29udGV4dCgndXNlcl9ub3RfZm91bmQnKTtcblxuICAgICAgZXhwZWN0KGNvbnRleHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSBtYW5lamFyIGVycm9yZXMgZGUgQ2xlcmsnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQ2xlcmtDbGllbnQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgdXNlcnM6IHtcbiAgICAgICAgICBnZXRVc2VyOiBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdDbGVyayBlcnJvcicpKVxuICAgICAgICB9XG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IGNvbnRleHQgPSBhd2FpdCBnZXRTZWN1cml0eUNvbnRleHQoJ3VzZXJfZXJyb3InKTtcblxuICAgICAgZXhwZWN0KGNvbnRleHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZVNlY3VyaXR5Q29udGV4dCcsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogJ3VzZXJfMTIzJyxcbiAgICAgICAgcHVibGljTWV0YWRhdGE6IHtcbiAgICAgICAgICByb2xlOiAnYWRtaW4nLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsQWRkcmVzc2VzOiBbe1xuICAgICAgICAgIHZlcmlmaWNhdGlvbjogeyBzdGF0dXM6ICd2ZXJpZmllZCcgfVxuICAgICAgICB9XVxuICAgICAgfTtcblxuICAgICAgbW9ja0NsZXJrQ2xpZW50Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHVzZXJzOiB7XG4gICAgICAgICAgZ2V0VXNlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKVxuICAgICAgICB9XG4gICAgICB9IGFzIGFueSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSB2YWxpZGFyIGNvbnRleHRvIGV4aXRvc2FtZW50ZSBwYXJhIGFkbWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVTZWN1cml0eUNvbnRleHQoXG4gICAgICAgICd1c2VyXzEyMycsXG4gICAgICAgICdQUk9EVUNUX0RFTEVURScsXG4gICAgICAgIFsnY2FuRGVsZXRlUHJvZHVjdHMnXVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29udGV4dCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29udGV4dD8ucGVybWlzc2lvbnMuY2FuRGVsZXRlUHJvZHVjdHMpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSByZWNoYXphciBwZXJtaXNvcyBpbnN1ZmljaWVudGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAndXNlcl8xMjMnLFxuICAgICAgICBwdWJsaWNNZXRhZGF0YToge1xuICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbEFkZHJlc3NlczogW3tcbiAgICAgICAgICB2ZXJpZmljYXRpb246IHsgc3RhdHVzOiAndmVyaWZpZWQnIH1cbiAgICAgICAgfV1cbiAgICAgIH07XG5cbiAgICAgIG1vY2tDbGVya0NsaWVudC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB1c2Vyczoge1xuICAgICAgICAgIGdldFVzZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcilcbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZVNlY3VyaXR5Q29udGV4dChcbiAgICAgICAgJ3VzZXJfMTIzJyxcbiAgICAgICAgJ1BST0RVQ1RfREVMRVRFJyxcbiAgICAgICAgWydjYW5EZWxldGVQcm9kdWN0cyddXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29kZSkudG9CZSgnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnNldmVyaXR5KS50b0JlKCdoaWdoJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSByZWNoYXphciB1c3VhcmlvIGluYWN0aXZvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAndXNlcl8xMjMnLFxuICAgICAgICBwdWJsaWNNZXRhZGF0YToge1xuICAgICAgICAgIHJvbGU6ICdhZG1pbicsXG4gICAgICAgICAgaXNBY3RpdmU6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsQWRkcmVzc2VzOiBbe1xuICAgICAgICAgIHZlcmlmaWNhdGlvbjogeyBzdGF0dXM6ICd2ZXJpZmllZCcgfVxuICAgICAgICB9XVxuICAgICAgfTtcblxuICAgICAgbW9ja0NsZXJrQ2xpZW50Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHVzZXJzOiB7XG4gICAgICAgICAgZ2V0VXNlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKVxuICAgICAgICB9XG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlU2VjdXJpdHlDb250ZXh0KFxuICAgICAgICAndXNlcl8xMjMnLFxuICAgICAgICAnUFJPRFVDVF9SRUFEJyxcbiAgICAgICAgWydjYW5SZWFkUHJvZHVjdHMnXVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvZGUpLnRvQmUoJ1VTRVJfSU5BQ1RJVkUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2V2ZXJpdHkpLnRvQmUoJ21lZGl1bScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVQcm9kdWN0UGVybWlzc2lvbnMnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgICAgaWQ6ICd1c2VyXzEyMycsXG4gICAgICAgIHB1YmxpY01ldGFkYXRhOiB7XG4gICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbEFkZHJlc3NlczogW3tcbiAgICAgICAgICB2ZXJpZmljYXRpb246IHsgc3RhdHVzOiAndmVyaWZpZWQnIH1cbiAgICAgICAgfV1cbiAgICAgIH07XG5cbiAgICAgIG1vY2tDbGVya0NsaWVudC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB1c2Vyczoge1xuICAgICAgICAgIGdldFVzZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcilcbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgdmFsaWRhciBwZXJtaXNvcyBkZSBsZWN0dXJhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVQcm9kdWN0UGVybWlzc2lvbnMoJ3VzZXJfMTIzJywgJ3JlYWQnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHZhbGlkYXIgcGVybWlzb3MgZGUgY3JlYWNpw7NuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVQcm9kdWN0UGVybWlzc2lvbnMoJ3VzZXJfMTIzJywgJ2NyZWF0ZScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgdmFsaWRhciBwZXJtaXNvcyBkZSBlbGltaW5hY2nDs24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZVByb2R1Y3RQZXJtaXNzaW9ucygndXNlcl8xMjMnLCAnZGVsZXRlJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd3aXRoU2VjdXJpdHlWYWxpZGF0aW9uIHdyYXBwZXInLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgY3JlYXIgd3JhcHBlciBmdW5jaW9uYWwnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrSGFuZGxlciA9IGplc3QuZm4oKTtcbiAgICAgIGNvbnN0IHdyYXBwZWRIYW5kbGVyID0gd2l0aFNlY3VyaXR5VmFsaWRhdGlvbihbJ2NhblJlYWRQcm9kdWN0cyddLCAnUFJPRFVDVF9SRUFEJykobW9ja0hhbmRsZXIpO1xuXG4gICAgICBleHBlY3QodHlwZW9mIHdyYXBwZWRIYW5kbGVyKS50b0JlKCdmdW5jdGlvbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgcmVjaGF6YXIgcmVxdWVzdCBzaW4gdXNlcklkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0hhbmRsZXIgPSBqZXN0LmZuKCk7XG4gICAgICBjb25zdCB3cmFwcGVkSGFuZGxlciA9IHdpdGhTZWN1cml0eVZhbGlkYXRpb24oWydjYW5SZWFkUHJvZHVjdHMnXSwgJ1BST0RVQ1RfUkVBRCcpKG1vY2tIYW5kbGVyKTtcblxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobnVsbClcbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXNwb25zZSA9IHtcbiAgICAgICAgc3RhdHVzOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAganNvbjogamVzdC5mbigpXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB3cmFwcGVkSGFuZGxlcihtb2NrUmVxdWVzdCwgbW9ja1Jlc3BvbnNlKTtcblxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMSk7XG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnVXN1YXJpbyBubyBhdXRlbnRpY2FkbycsXG4gICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJ1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJjbGVya0NsaWVudCIsImZuIiwidXNlcnMiLCJnZXRVc2VyIiwic3VwYWJhc2VBZG1pbiIsImZyb20iLCJpbnNlcnQiLCJlcnJvciIsInNlbGVjdCIsImVxIiwiZ3RlIiwibm90IiwiZGF0YSIsImRlc2NyaWJlIiwibW9ja0NsZXJrQ2xpZW50IiwiYmVmb3JlRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJpdCIsInBlcm1pc3Npb25zIiwiZ2V0UGVybWlzc2lvbnNCeVJvbGUiLCJleHBlY3QiLCJpc0FkbWluIiwidG9CZSIsImNhbkRlbGV0ZVByb2R1Y3RzIiwiY2FuTWFuYWdlVXNlcnMiLCJjYW5BY2Nlc3NBZG1pbiIsImlzTW9kZXJhdG9yIiwiY2FuVmlld0FuYWx5dGljcyIsImNhblJlYWRQcm9kdWN0cyIsImlzVmFsaWRBZG1pblJvbGUiLCJhZG1pblBlcm1pc3Npb25zIiwidXNlclBlcm1pc3Npb25zIiwiaGFzUGVybWlzc2lvbiIsIm1vZGVyYXRvclBlcm1pc3Npb25zIiwiaGFzQW55UGVybWlzc2lvbiIsImhhc0FsbFBlcm1pc3Npb25zIiwibW9ja1VzZXIiLCJpZCIsInB1YmxpY01ldGFkYXRhIiwicm9sZSIsImRlcGFydG1lbnQiLCJpc0FjdGl2ZSIsImVtYWlsQWRkcmVzc2VzIiwidmVyaWZpY2F0aW9uIiwic3RhdHVzIiwibW9ja1JldHVyblZhbHVlIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJtb2NrUmVxdWVzdCIsImhlYWRlcnMiLCJnZXQiLCJtb2NrSW1wbGVtZW50YXRpb24iLCJrZXkiLCJjb250ZXh0IiwiZ2V0U2VjdXJpdHlDb250ZXh0IiwidG9CZURlZmluZWQiLCJ1c2VySWQiLCJ1c2VyUm9sZSIsIm1ldGFkYXRhIiwiZW1haWxWZXJpZmllZCIsImlwQWRkcmVzcyIsInVzZXJBZ2VudCIsInRvQmVOdWxsIiwibW9ja1JlamVjdGVkVmFsdWUiLCJFcnJvciIsInJlc3VsdCIsInZhbGlkYXRlU2VjdXJpdHlDb250ZXh0IiwidmFsaWQiLCJjb2RlIiwic2V2ZXJpdHkiLCJ2YWxpZGF0ZVByb2R1Y3RQZXJtaXNzaW9ucyIsIm1vY2tIYW5kbGVyIiwid3JhcHBlZEhhbmRsZXIiLCJ3aXRoU2VjdXJpdHlWYWxpZGF0aW9uIiwibW9ja1Jlc3BvbnNlIiwibW9ja1JldHVyblRoaXMiLCJqc29uIiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJzdWNjZXNzIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0M7QUFLRCxnQkFBZ0I7QUFDaEJBLEtBQUtDLElBQUksQ0FB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