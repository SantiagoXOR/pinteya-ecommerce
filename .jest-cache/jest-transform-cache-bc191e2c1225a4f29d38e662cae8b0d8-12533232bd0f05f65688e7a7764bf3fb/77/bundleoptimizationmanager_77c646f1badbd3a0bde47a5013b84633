84aca6351ce2ef9be48da85bd7a77a7f
// ===================================
// BUNDLE OPTIMIZATION MANAGER
// ===================================
// Sistema avanzado de optimización de bundles para Pinteya E-commerce
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "BundleOptimizationManager", {
    enumerable: true,
    get: function() {
        return BundleOptimizationManager;
    }
});
const _fs = require("fs");
const _path = /*#__PURE__*/ _interop_require_default(require("path"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
class BundleOptimizationManager {
    constructor(){
        this.analysisCache = new Map();
        this.config = this.getDefaultConfig();
    }
    static getInstance() {
        if (!BundleOptimizationManager.instance) {
            BundleOptimizationManager.instance = new BundleOptimizationManager();
        }
        return BundleOptimizationManager.instance;
    }
    // ===================================
    // CONFIGURACIÓN
    // ===================================
    getDefaultConfig() {
        return {
            maxChunkSize: 250 * 1024,
            maxFirstLoadSize: 128 * 1024,
            enableTreeShaking: true,
            enableCodeSplitting: true,
            enableCompression: true,
            enableLazyLoading: true,
            performanceBudgets: {
                maxBundleSize: 500 * 1024,
                maxFirstLoadJS: 128 * 1024,
                maxCSS: 50 * 1024,
                maxImages: 200 * 1024,
                warningThreshold: 0.8,
                errorThreshold: 1.0
            }
        };
    }
    updateConfig(newConfig) {
        this.config = {
            ...this.config,
            ...newConfig
        };
    }
    // ===================================
    // ANÁLISIS DE BUNDLES
    // ===================================
    async analyzeBundles(buildPath = '.next') {
        const cacheKey = `${buildPath}-${Date.now()}`;
        if (this.analysisCache.has(cacheKey)) {
            return this.analysisCache.get(cacheKey);
        }
        try {
            const analysis = await this.performBundleAnalysis(buildPath);
            this.analysisCache.set(cacheKey, analysis);
            // Limpiar cache antiguo
            if (this.analysisCache.size > 5) {
                const firstKey = this.analysisCache.keys().next().value;
                this.analysisCache.delete(firstKey);
            }
            return analysis;
        } catch (error) {
            console.error('Error analyzing bundles:', error);
            throw new Error(`Bundle analysis failed: ${error instanceof Error ? error.message : 'Unknown error'}`);
        }
    }
    async performBundleAnalysis(buildPath) {
        const staticPath = _path.default.join(buildPath, 'static');
        const chunks = await this.analyzeChunks(staticPath);
        const dependencies = await this.analyzeDependencies();
        const performance = this.calculatePerformanceMetrics(chunks);
        const recommendations = this.generateRecommendations(chunks, dependencies, performance);
        const totalSize = chunks.reduce((sum, chunk)=>sum + chunk.size, 0);
        const gzippedSize = chunks.reduce((sum, chunk)=>sum + chunk.gzippedSize, 0);
        return {
            totalSize,
            gzippedSize,
            chunks,
            dependencies,
            recommendations,
            performance
        };
    }
    async analyzeChunks(staticPath) {
        const chunks = [];
        try {
            // Simular análisis de chunks (en implementación real usaríamos webpack-bundle-analyzer)
            const mockChunks = [
                {
                    name: 'main',
                    size: 85 * 1024,
                    gzippedSize: 28 * 1024,
                    type: 'app',
                    loadPriority: 'critical'
                },
                {
                    name: 'vendors',
                    size: 180 * 1024,
                    gzippedSize: 65 * 1024,
                    type: 'vendor',
                    loadPriority: 'critical'
                },
                {
                    name: 'admin',
                    size: 120 * 1024,
                    gzippedSize: 42 * 1024,
                    type: 'dynamic',
                    loadPriority: 'medium'
                }
            ];
            for (const mockChunk of mockChunks){
                chunks.push({
                    ...mockChunk,
                    modules: await this.analyzeChunkModules(mockChunk.name)
                });
            }
        } catch (error) {
            console.warn('Could not analyze chunks from filesystem, using mock data');
        }
        return chunks;
    }
    async analyzeChunkModules(chunkName) {
        // Simular análisis de módulos
        return [
            {
                name: `${chunkName}-module-1`,
                size: 15 * 1024,
                path: `src/components/${chunkName}`,
                imports: [
                    'react',
                    'next'
                ],
                exports: [
                    'default'
                ],
                isTreeShakeable: true
            }
        ];
    }
    async analyzeDependencies() {
        try {
            const packageJsonPath = _path.default.join(process.cwd(), 'package.json');
            const packageJson = JSON.parse(await _fs.promises.readFile(packageJsonPath, 'utf-8'));
            const dependencies = {
                ...packageJson.dependencies,
                ...packageJson.devDependencies
            };
            return Object.entries(dependencies).map(([name, version])=>({
                    name,
                    version: version,
                    size: this.estimateDependencySize(name),
                    usage: this.analyzeDependencyUsage(name),
                    alternatives: this.suggestAlternatives(name),
                    optimizationPotential: this.calculateOptimizationPotential(name)
                }));
        } catch (error) {
            console.warn('Could not analyze dependencies:', error);
            return [];
        }
    }
    estimateDependencySize(name) {
        // Estimaciones basadas en dependencias comunes
        const sizeMap = {
            react: 45 * 1024,
            'react-dom': 130 * 1024,
            next: 200 * 1024,
            'framer-motion': 180 * 1024,
            recharts: 250 * 1024,
            'maplibre-gl': 400 * 1024,
            'lodash-es': 70 * 1024,
            '@radix-ui/react-dialog': 25 * 1024
        };
        return sizeMap[name] || 20 * 1024 // Default 20KB
        ;
    }
    analyzeDependencyUsage(name) {
        const criticalDeps = [
            'react',
            'react-dom',
            'next'
        ];
        const importantDeps = [
            '@supabase/supabase-js',
            'zod',
            'next-auth'
        ];
        if (criticalDeps.includes(name)) {
            return 'critical';
        }
        if (importantDeps.includes(name)) {
            return 'important';
        }
        return 'optional';
    }
    suggestAlternatives(name) {
        const alternatives = {
            'lodash-es': [
                'ramda',
                'native-methods'
            ],
            moment: [
                'date-fns',
                'dayjs'
            ],
            recharts: [
                'chart.js',
                'victory'
            ],
            'framer-motion': [
                'react-spring',
                'lottie-react'
            ]
        };
        return alternatives[name] || [];
    }
    calculateOptimizationPotential(name) {
        // Porcentaje de optimización potencial
        const optimizationMap = {
            'lodash-es': 60,
            'framer-motion': 40,
            recharts: 50,
            'maplibre-gl': 30
        };
        return optimizationMap[name] || 10;
    }
    calculatePerformanceMetrics(chunks) {
        const firstLoadJS = chunks.filter((chunk)=>chunk.loadPriority === 'critical').reduce((sum, chunk)=>sum + chunk.size, 0);
        const totalJS = chunks.reduce((sum, chunk)=>sum + chunk.size, 0);
        // Calcular score basado en performance budgets
        const score = this.calculatePerformanceScore(firstLoadJS, totalJS);
        const grade = this.getPerformanceGrade(score);
        return {
            firstLoadJS,
            totalJS,
            css: 25 * 1024,
            images: 150 * 1024,
            fonts: 30 * 1024,
            other: 20 * 1024,
            score,
            grade
        };
    }
    calculatePerformanceScore(firstLoadJS, totalJS) {
        const { performanceBudgets } = this.config;
        const firstLoadRatio = firstLoadJS / performanceBudgets.maxFirstLoadJS;
        const totalRatio = totalJS / performanceBudgets.maxBundleSize;
        const penalty = Math.max(firstLoadRatio - 1, 0) + Math.max(totalRatio - 1, 0);
        return Math.max(100 - penalty * 50, 0);
    }
    getPerformanceGrade(score) {
        if (score >= 90) {
            return 'A';
        }
        if (score >= 80) {
            return 'B';
        }
        if (score >= 70) {
            return 'C';
        }
        if (score >= 60) {
            return 'D';
        }
        return 'F';
    }
    generateRecommendations(chunks, dependencies, performance) {
        const recommendations = [];
        // Recomendaciones basadas en tamaño de chunks
        const largeChunks = chunks.filter((chunk)=>chunk.size > this.config.maxChunkSize);
        for (const chunk of largeChunks){
            recommendations.push({
                type: 'code-splitting',
                priority: 'high',
                description: `Chunk '${chunk.name}' es demasiado grande (${Math.round(chunk.size / 1024)}KB)`,
                estimatedSavings: chunk.size * 0.3,
                implementation: `Dividir ${chunk.name} en chunks más pequeños usando dynamic imports`,
                effort: 'medium'
            });
        }
        // Recomendaciones basadas en dependencias
        const heavyDeps = dependencies.filter((dep)=>dep.size > 100 * 1024 && dep.optimizationPotential > 30);
        for (const dep of heavyDeps){
            recommendations.push({
                type: 'dependency-replacement',
                priority: 'medium',
                description: `Dependencia '${dep.name}' es pesada y tiene potencial de optimización`,
                estimatedSavings: dep.size * (dep.optimizationPotential / 100),
                implementation: `Considerar alternativas: ${dep.alternatives?.join(', ') || 'tree shaking'}`,
                effort: 'high'
            });
        }
        // Recomendaciones basadas en performance
        if (performance.firstLoadJS > this.config.performanceBudgets.maxFirstLoadJS) {
            recommendations.push({
                type: 'lazy-loading',
                priority: 'critical',
                description: 'First Load JS excede el presupuesto de performance',
                estimatedSavings: performance.firstLoadJS - this.config.performanceBudgets.maxFirstLoadJS,
                implementation: 'Implementar lazy loading para componentes no críticos',
                effort: 'low'
            });
        }
        return recommendations.sort((a, b)=>{
            const priorityOrder = {
                critical: 4,
                high: 3,
                medium: 2,
                low: 1
            };
            return priorityOrder[b.priority] - priorityOrder[a.priority];
        });
    }
    // ===================================
    // OPTIMIZACIONES AUTOMÁTICAS
    // ===================================
    async applyOptimizations(recommendations) {
        for (const recommendation of recommendations){
            if (recommendation.effort === 'low') {
                await this.applyLowEffortOptimization(recommendation);
            }
        }
    }
    async applyLowEffortOptimization(recommendation) {
        switch(recommendation.type){
            case 'lazy-loading':
                await this.implementLazyLoading();
                break;
            case 'compression':
                await this.enableCompression();
                break;
            default:
                console.log(`Optimization ${recommendation.type} requires manual implementation`);
        }
    }
    async implementLazyLoading() {
        // Implementar lazy loading automático para componentes pesados
        console.log('Implementing automatic lazy loading...');
    }
    async enableCompression() {
        // Habilitar compresión automática
        console.log('Enabling compression...');
    }
    // ===================================
    // REPORTES Y MÉTRICAS
    // ===================================
    generateOptimizationReport(analysis) {
        const report = `
# Bundle Optimization Report

## Performance Metrics
- **Score**: ${analysis.performance.score}/100 (Grade: ${analysis.performance.grade})
- **First Load JS**: ${Math.round(analysis.performance.firstLoadJS / 1024)}KB
- **Total JS**: ${Math.round(analysis.performance.totalJS / 1024)}KB
- **Total Bundle Size**: ${Math.round(analysis.totalSize / 1024)}KB
- **Gzipped Size**: ${Math.round(analysis.gzippedSize / 1024)}KB

## Chunks Analysis
${analysis.chunks.map((chunk)=>`
- **${chunk.name}**: ${Math.round(chunk.size / 1024)}KB (${chunk.type}, ${chunk.loadPriority} priority)
`).join('')}

## Top Recommendations
${analysis.recommendations.slice(0, 5).map((rec, i)=>`
${i + 1}. **${rec.type}** (${rec.priority} priority)
   - ${rec.description}
   - Estimated savings: ${Math.round(rec.estimatedSavings / 1024)}KB
   - Implementation: ${rec.implementation}
`).join('')}

## Dependencies Analysis
- **Total Dependencies**: ${analysis.dependencies.length}
- **Heavy Dependencies**: ${analysis.dependencies.filter((d)=>d.size > 100 * 1024).length}
- **Optimization Potential**: ${Math.round(analysis.dependencies.reduce((sum, d)=>sum + d.optimizationPotential, 0) / analysis.dependencies.length)}%
`;
        return report;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxvcHRpbWl6YXRpb25cXGJ1bmRsZS1vcHRpbWl6YXRpb24tbWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQlVORExFIE9QVElNSVpBVElPTiBNQU5BR0VSXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gU2lzdGVtYSBhdmFuemFkbyBkZSBvcHRpbWl6YWNpw7NuIGRlIGJ1bmRsZXMgcGFyYSBQaW50ZXlhIEUtY29tbWVyY2VcblxuaW1wb3J0IHsgcHJvbWlzZXMgYXMgZnMgfSBmcm9tICdmcydcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBJTlRFUkZBQ0VTIFkgVElQT1Ncbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnVuZGxlQW5hbHlzaXMge1xuICB0b3RhbFNpemU6IG51bWJlclxuICBnemlwcGVkU2l6ZTogbnVtYmVyXG4gIGNodW5rczogQ2h1bmtJbmZvW11cbiAgZGVwZW5kZW5jaWVzOiBEZXBlbmRlbmN5SW5mb1tdXG4gIHJlY29tbWVuZGF0aW9uczogT3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25bXVxuICBwZXJmb3JtYW5jZTogUGVyZm9ybWFuY2VNZXRyaWNzXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2h1bmtJbmZvIHtcbiAgbmFtZTogc3RyaW5nXG4gIHNpemU6IG51bWJlclxuICBnemlwcGVkU2l6ZTogbnVtYmVyXG4gIG1vZHVsZXM6IE1vZHVsZUluZm9bXVxuICB0eXBlOiAndmVuZG9yJyB8ICdhcHAnIHwgJ3NoYXJlZCcgfCAnZHluYW1pYydcbiAgbG9hZFByaW9yaXR5OiAnY3JpdGljYWwnIHwgJ2hpZ2gnIHwgJ21lZGl1bScgfCAnbG93J1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1vZHVsZUluZm8ge1xuICBuYW1lOiBzdHJpbmdcbiAgc2l6ZTogbnVtYmVyXG4gIHBhdGg6IHN0cmluZ1xuICBpbXBvcnRzOiBzdHJpbmdbXVxuICBleHBvcnRzOiBzdHJpbmdbXVxuICBpc1RyZWVTaGFrZWFibGU6IGJvb2xlYW5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBEZXBlbmRlbmN5SW5mbyB7XG4gIG5hbWU6IHN0cmluZ1xuICB2ZXJzaW9uOiBzdHJpbmdcbiAgc2l6ZTogbnVtYmVyXG4gIHVzYWdlOiAnY3JpdGljYWwnIHwgJ2ltcG9ydGFudCcgfCAnb3B0aW9uYWwnIHwgJ3VudXNlZCdcbiAgYWx0ZXJuYXRpdmVzPzogc3RyaW5nW11cbiAgb3B0aW1pemF0aW9uUG90ZW50aWFsOiBudW1iZXJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbiB7XG4gIHR5cGU6XG4gICAgfCAnY29kZS1zcGxpdHRpbmcnXG4gICAgfCAndHJlZS1zaGFraW5nJ1xuICAgIHwgJ2RlcGVuZGVuY3ktcmVwbGFjZW1lbnQnXG4gICAgfCAnbGF6eS1sb2FkaW5nJ1xuICAgIHwgJ2NvbXByZXNzaW9uJ1xuICBwcmlvcml0eTogJ2NyaXRpY2FsJyB8ICdoaWdoJyB8ICdtZWRpdW0nIHwgJ2xvdydcbiAgZGVzY3JpcHRpb246IHN0cmluZ1xuICBlc3RpbWF0ZWRTYXZpbmdzOiBudW1iZXJcbiAgaW1wbGVtZW50YXRpb246IHN0cmluZ1xuICBlZmZvcnQ6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZU1ldHJpY3Mge1xuICBmaXJzdExvYWRKUzogbnVtYmVyXG4gIHRvdGFsSlM6IG51bWJlclxuICBjc3M6IG51bWJlclxuICBpbWFnZXM6IG51bWJlclxuICBmb250czogbnVtYmVyXG4gIG90aGVyOiBudW1iZXJcbiAgc2NvcmU6IG51bWJlclxuICBncmFkZTogJ0EnIHwgJ0InIHwgJ0MnIHwgJ0QnIHwgJ0YnXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnVuZGxlT3B0aW1pemF0aW9uQ29uZmlnIHtcbiAgbWF4Q2h1bmtTaXplOiBudW1iZXJcbiAgbWF4Rmlyc3RMb2FkU2l6ZTogbnVtYmVyXG4gIGVuYWJsZVRyZWVTaGFraW5nOiBib29sZWFuXG4gIGVuYWJsZUNvZGVTcGxpdHRpbmc6IGJvb2xlYW5cbiAgZW5hYmxlQ29tcHJlc3Npb246IGJvb2xlYW5cbiAgZW5hYmxlTGF6eUxvYWRpbmc6IGJvb2xlYW5cbiAgcGVyZm9ybWFuY2VCdWRnZXRzOiBQZXJmb3JtYW5jZUJ1ZGdldHNcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZUJ1ZGdldHMge1xuICBtYXhCdW5kbGVTaXplOiBudW1iZXJcbiAgbWF4Rmlyc3RMb2FkSlM6IG51bWJlclxuICBtYXhDU1M6IG51bWJlclxuICBtYXhJbWFnZXM6IG51bWJlclxuICB3YXJuaW5nVGhyZXNob2xkOiBudW1iZXJcbiAgZXJyb3JUaHJlc2hvbGQ6IG51bWJlclxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQlVORExFIE9QVElNSVpBVElPTiBNQU5BR0VSXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY2xhc3MgQnVuZGxlT3B0aW1pemF0aW9uTWFuYWdlciB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBCdW5kbGVPcHRpbWl6YXRpb25NYW5hZ2VyXG4gIHByaXZhdGUgY29uZmlnOiBCdW5kbGVPcHRpbWl6YXRpb25Db25maWdcbiAgcHJpdmF0ZSBhbmFseXNpc0NhY2hlOiBNYXA8c3RyaW5nLCBCdW5kbGVBbmFseXNpcz4gPSBuZXcgTWFwKClcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY29uZmlnID0gdGhpcy5nZXREZWZhdWx0Q29uZmlnKClcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogQnVuZGxlT3B0aW1pemF0aW9uTWFuYWdlciB7XG4gICAgaWYgKCFCdW5kbGVPcHRpbWl6YXRpb25NYW5hZ2VyLmluc3RhbmNlKSB7XG4gICAgICBCdW5kbGVPcHRpbWl6YXRpb25NYW5hZ2VyLmluc3RhbmNlID0gbmV3IEJ1bmRsZU9wdGltaXphdGlvbk1hbmFnZXIoKVxuICAgIH1cbiAgICByZXR1cm4gQnVuZGxlT3B0aW1pemF0aW9uTWFuYWdlci5pbnN0YW5jZVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQ09ORklHVVJBQ0nDk05cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBwcml2YXRlIGdldERlZmF1bHRDb25maWcoKTogQnVuZGxlT3B0aW1pemF0aW9uQ29uZmlnIHtcbiAgICByZXR1cm4ge1xuICAgICAgbWF4Q2h1bmtTaXplOiAyNTAgKiAxMDI0LCAvLyAyNTBLQlxuICAgICAgbWF4Rmlyc3RMb2FkU2l6ZTogMTI4ICogMTAyNCwgLy8gMTI4S0JcbiAgICAgIGVuYWJsZVRyZWVTaGFraW5nOiB0cnVlLFxuICAgICAgZW5hYmxlQ29kZVNwbGl0dGluZzogdHJ1ZSxcbiAgICAgIGVuYWJsZUNvbXByZXNzaW9uOiB0cnVlLFxuICAgICAgZW5hYmxlTGF6eUxvYWRpbmc6IHRydWUsXG4gICAgICBwZXJmb3JtYW5jZUJ1ZGdldHM6IHtcbiAgICAgICAgbWF4QnVuZGxlU2l6ZTogNTAwICogMTAyNCwgLy8gNTAwS0JcbiAgICAgICAgbWF4Rmlyc3RMb2FkSlM6IDEyOCAqIDEwMjQsIC8vIDEyOEtCXG4gICAgICAgIG1heENTUzogNTAgKiAxMDI0LCAvLyA1MEtCXG4gICAgICAgIG1heEltYWdlczogMjAwICogMTAyNCwgLy8gMjAwS0JcbiAgICAgICAgd2FybmluZ1RocmVzaG9sZDogMC44LCAvLyA4MCVcbiAgICAgICAgZXJyb3JUaHJlc2hvbGQ6IDEuMCwgLy8gMTAwJVxuICAgICAgfSxcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlQ29uZmlnKG5ld0NvbmZpZzogUGFydGlhbDxCdW5kbGVPcHRpbWl6YXRpb25Db25maWc+KTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcgPSB7IC4uLnRoaXMuY29uZmlnLCAuLi5uZXdDb25maWcgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQU7DgUxJU0lTIERFIEJVTkRMRVNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBwdWJsaWMgYXN5bmMgYW5hbHl6ZUJ1bmRsZXMoYnVpbGRQYXRoOiBzdHJpbmcgPSAnLm5leHQnKTogUHJvbWlzZTxCdW5kbGVBbmFseXNpcz4ge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gYCR7YnVpbGRQYXRofS0ke0RhdGUubm93KCl9YFxuXG4gICAgaWYgKHRoaXMuYW5hbHlzaXNDYWNoZS5oYXMoY2FjaGVLZXkpKSB7XG4gICAgICByZXR1cm4gdGhpcy5hbmFseXNpc0NhY2hlLmdldChjYWNoZUtleSkhXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFuYWx5c2lzID0gYXdhaXQgdGhpcy5wZXJmb3JtQnVuZGxlQW5hbHlzaXMoYnVpbGRQYXRoKVxuICAgICAgdGhpcy5hbmFseXNpc0NhY2hlLnNldChjYWNoZUtleSwgYW5hbHlzaXMpXG5cbiAgICAgIC8vIExpbXBpYXIgY2FjaGUgYW50aWd1b1xuICAgICAgaWYgKHRoaXMuYW5hbHlzaXNDYWNoZS5zaXplID4gNSkge1xuICAgICAgICBjb25zdCBmaXJzdEtleSA9IHRoaXMuYW5hbHlzaXNDYWNoZS5rZXlzKCkubmV4dCgpLnZhbHVlXG4gICAgICAgIHRoaXMuYW5hbHlzaXNDYWNoZS5kZWxldGUoZmlyc3RLZXkpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhbmFseXNpc1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbmFseXppbmcgYnVuZGxlczonLCBlcnJvcilcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEJ1bmRsZSBhbmFseXNpcyBmYWlsZWQ6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YFxuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcGVyZm9ybUJ1bmRsZUFuYWx5c2lzKGJ1aWxkUGF0aDogc3RyaW5nKTogUHJvbWlzZTxCdW5kbGVBbmFseXNpcz4ge1xuICAgIGNvbnN0IHN0YXRpY1BhdGggPSBwYXRoLmpvaW4oYnVpbGRQYXRoLCAnc3RhdGljJylcbiAgICBjb25zdCBjaHVua3MgPSBhd2FpdCB0aGlzLmFuYWx5emVDaHVua3Moc3RhdGljUGF0aClcbiAgICBjb25zdCBkZXBlbmRlbmNpZXMgPSBhd2FpdCB0aGlzLmFuYWx5emVEZXBlbmRlbmNpZXMoKVxuICAgIGNvbnN0IHBlcmZvcm1hbmNlID0gdGhpcy5jYWxjdWxhdGVQZXJmb3JtYW5jZU1ldHJpY3MoY2h1bmtzKVxuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IHRoaXMuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoY2h1bmtzLCBkZXBlbmRlbmNpZXMsIHBlcmZvcm1hbmNlKVxuXG4gICAgY29uc3QgdG90YWxTaXplID0gY2h1bmtzLnJlZHVjZSgoc3VtLCBjaHVuaykgPT4gc3VtICsgY2h1bmsuc2l6ZSwgMClcbiAgICBjb25zdCBnemlwcGVkU2l6ZSA9IGNodW5rcy5yZWR1Y2UoKHN1bSwgY2h1bmspID0+IHN1bSArIGNodW5rLmd6aXBwZWRTaXplLCAwKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsU2l6ZSxcbiAgICAgIGd6aXBwZWRTaXplLFxuICAgICAgY2h1bmtzLFxuICAgICAgZGVwZW5kZW5jaWVzLFxuICAgICAgcmVjb21tZW5kYXRpb25zLFxuICAgICAgcGVyZm9ybWFuY2UsXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplQ2h1bmtzKHN0YXRpY1BhdGg6IHN0cmluZyk6IFByb21pc2U8Q2h1bmtJbmZvW10+IHtcbiAgICBjb25zdCBjaHVua3M6IENodW5rSW5mb1tdID0gW11cblxuICAgIHRyeSB7XG4gICAgICAvLyBTaW11bGFyIGFuw6FsaXNpcyBkZSBjaHVua3MgKGVuIGltcGxlbWVudGFjacOzbiByZWFsIHVzYXLDrWFtb3Mgd2VicGFjay1idW5kbGUtYW5hbHl6ZXIpXG4gICAgICBjb25zdCBtb2NrQ2h1bmtzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ21haW4nLFxuICAgICAgICAgIHNpemU6IDg1ICogMTAyNCxcbiAgICAgICAgICBnemlwcGVkU2l6ZTogMjggKiAxMDI0LFxuICAgICAgICAgIHR5cGU6ICdhcHAnIGFzIGNvbnN0LFxuICAgICAgICAgIGxvYWRQcmlvcml0eTogJ2NyaXRpY2FsJyBhcyBjb25zdCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICd2ZW5kb3JzJyxcbiAgICAgICAgICBzaXplOiAxODAgKiAxMDI0LFxuICAgICAgICAgIGd6aXBwZWRTaXplOiA2NSAqIDEwMjQsXG4gICAgICAgICAgdHlwZTogJ3ZlbmRvcicgYXMgY29uc3QsXG4gICAgICAgICAgbG9hZFByaW9yaXR5OiAnY3JpdGljYWwnIGFzIGNvbnN0LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2FkbWluJyxcbiAgICAgICAgICBzaXplOiAxMjAgKiAxMDI0LFxuICAgICAgICAgIGd6aXBwZWRTaXplOiA0MiAqIDEwMjQsXG4gICAgICAgICAgdHlwZTogJ2R5bmFtaWMnIGFzIGNvbnN0LFxuICAgICAgICAgIGxvYWRQcmlvcml0eTogJ21lZGl1bScgYXMgY29uc3QsXG4gICAgICAgIH0sXG4gICAgICBdXG5cbiAgICAgIGZvciAoY29uc3QgbW9ja0NodW5rIG9mIG1vY2tDaHVua3MpIHtcbiAgICAgICAgY2h1bmtzLnB1c2goe1xuICAgICAgICAgIC4uLm1vY2tDaHVuayxcbiAgICAgICAgICBtb2R1bGVzOiBhd2FpdCB0aGlzLmFuYWx5emVDaHVua01vZHVsZXMobW9ja0NodW5rLm5hbWUpLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBhbmFseXplIGNodW5rcyBmcm9tIGZpbGVzeXN0ZW0sIHVzaW5nIG1vY2sgZGF0YScpXG4gICAgfVxuXG4gICAgcmV0dXJuIGNodW5rc1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplQ2h1bmtNb2R1bGVzKGNodW5rTmFtZTogc3RyaW5nKTogUHJvbWlzZTxNb2R1bGVJbmZvW10+IHtcbiAgICAvLyBTaW11bGFyIGFuw6FsaXNpcyBkZSBtw7NkdWxvc1xuICAgIHJldHVybiBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6IGAke2NodW5rTmFtZX0tbW9kdWxlLTFgLFxuICAgICAgICBzaXplOiAxNSAqIDEwMjQsXG4gICAgICAgIHBhdGg6IGBzcmMvY29tcG9uZW50cy8ke2NodW5rTmFtZX1gLFxuICAgICAgICBpbXBvcnRzOiBbJ3JlYWN0JywgJ25leHQnXSxcbiAgICAgICAgZXhwb3J0czogWydkZWZhdWx0J10sXG4gICAgICAgIGlzVHJlZVNoYWtlYWJsZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgXVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplRGVwZW5kZW5jaWVzKCk6IFByb21pc2U8RGVwZW5kZW5jeUluZm9bXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYWNrYWdlSnNvblBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3BhY2thZ2UuanNvbicpXG4gICAgICBjb25zdCBwYWNrYWdlSnNvbiA9IEpTT04ucGFyc2UoYXdhaXQgZnMucmVhZEZpbGUocGFja2FnZUpzb25QYXRoLCAndXRmLTgnKSlcbiAgICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IHsgLi4ucGFja2FnZUpzb24uZGVwZW5kZW5jaWVzLCAuLi5wYWNrYWdlSnNvbi5kZXZEZXBlbmRlbmNpZXMgfVxuXG4gICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMoZGVwZW5kZW5jaWVzKS5tYXAoKFtuYW1lLCB2ZXJzaW9uXSkgPT4gKHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgdmVyc2lvbjogdmVyc2lvbiBhcyBzdHJpbmcsXG4gICAgICAgIHNpemU6IHRoaXMuZXN0aW1hdGVEZXBlbmRlbmN5U2l6ZShuYW1lKSxcbiAgICAgICAgdXNhZ2U6IHRoaXMuYW5hbHl6ZURlcGVuZGVuY3lVc2FnZShuYW1lKSxcbiAgICAgICAgYWx0ZXJuYXRpdmVzOiB0aGlzLnN1Z2dlc3RBbHRlcm5hdGl2ZXMobmFtZSksXG4gICAgICAgIG9wdGltaXphdGlvblBvdGVudGlhbDogdGhpcy5jYWxjdWxhdGVPcHRpbWl6YXRpb25Qb3RlbnRpYWwobmFtZSksXG4gICAgICB9KSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgYW5hbHl6ZSBkZXBlbmRlbmNpZXM6JywgZXJyb3IpXG4gICAgICByZXR1cm4gW11cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGVzdGltYXRlRGVwZW5kZW5jeVNpemUobmFtZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICAvLyBFc3RpbWFjaW9uZXMgYmFzYWRhcyBlbiBkZXBlbmRlbmNpYXMgY29tdW5lc1xuICAgIGNvbnN0IHNpemVNYXA6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgICByZWFjdDogNDUgKiAxMDI0LFxuICAgICAgJ3JlYWN0LWRvbSc6IDEzMCAqIDEwMjQsXG4gICAgICBuZXh0OiAyMDAgKiAxMDI0LFxuICAgICAgJ2ZyYW1lci1tb3Rpb24nOiAxODAgKiAxMDI0LFxuICAgICAgcmVjaGFydHM6IDI1MCAqIDEwMjQsXG4gICAgICAnbWFwbGlicmUtZ2wnOiA0MDAgKiAxMDI0LFxuICAgICAgJ2xvZGFzaC1lcyc6IDcwICogMTAyNCxcbiAgICAgICdAcmFkaXgtdWkvcmVhY3QtZGlhbG9nJzogMjUgKiAxMDI0LFxuICAgIH1cblxuICAgIHJldHVybiBzaXplTWFwW25hbWVdIHx8IDIwICogMTAyNCAvLyBEZWZhdWx0IDIwS0JcbiAgfVxuXG4gIHByaXZhdGUgYW5hbHl6ZURlcGVuZGVuY3lVc2FnZShuYW1lOiBzdHJpbmcpOiAnY3JpdGljYWwnIHwgJ2ltcG9ydGFudCcgfCAnb3B0aW9uYWwnIHwgJ3VudXNlZCcge1xuICAgIGNvbnN0IGNyaXRpY2FsRGVwcyA9IFsncmVhY3QnLCAncmVhY3QtZG9tJywgJ25leHQnXVxuICAgIGNvbnN0IGltcG9ydGFudERlcHMgPSBbJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcycsICd6b2QnLCAnbmV4dC1hdXRoJ11cblxuICAgIGlmIChjcml0aWNhbERlcHMuaW5jbHVkZXMobmFtZSkpIHtcbiAgICAgIHJldHVybiAnY3JpdGljYWwnXG4gICAgfVxuICAgIGlmIChpbXBvcnRhbnREZXBzLmluY2x1ZGVzKG5hbWUpKSB7XG4gICAgICByZXR1cm4gJ2ltcG9ydGFudCdcbiAgICB9XG4gICAgcmV0dXJuICdvcHRpb25hbCdcbiAgfVxuXG4gIHByaXZhdGUgc3VnZ2VzdEFsdGVybmF0aXZlcyhuYW1lOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgYWx0ZXJuYXRpdmVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4gPSB7XG4gICAgICAnbG9kYXNoLWVzJzogWydyYW1kYScsICduYXRpdmUtbWV0aG9kcyddLFxuICAgICAgbW9tZW50OiBbJ2RhdGUtZm5zJywgJ2RheWpzJ10sXG4gICAgICByZWNoYXJ0czogWydjaGFydC5qcycsICd2aWN0b3J5J10sXG4gICAgICAnZnJhbWVyLW1vdGlvbic6IFsncmVhY3Qtc3ByaW5nJywgJ2xvdHRpZS1yZWFjdCddLFxuICAgIH1cblxuICAgIHJldHVybiBhbHRlcm5hdGl2ZXNbbmFtZV0gfHwgW11cbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlT3B0aW1pemF0aW9uUG90ZW50aWFsKG5hbWU6IHN0cmluZyk6IG51bWJlciB7XG4gICAgLy8gUG9yY2VudGFqZSBkZSBvcHRpbWl6YWNpw7NuIHBvdGVuY2lhbFxuICAgIGNvbnN0IG9wdGltaXphdGlvbk1hcDogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHtcbiAgICAgICdsb2Rhc2gtZXMnOiA2MCwgLy8gVHJlZSBzaGFraW5nIHBvdGVudGlhbFxuICAgICAgJ2ZyYW1lci1tb3Rpb24nOiA0MCwgLy8gQ29kZSBzcGxpdHRpbmcgcG90ZW50aWFsXG4gICAgICByZWNoYXJ0czogNTAsIC8vIExhenkgbG9hZGluZyBwb3RlbnRpYWxcbiAgICAgICdtYXBsaWJyZS1nbCc6IDMwLCAvLyBDb21wcmVzc2lvbiBwb3RlbnRpYWxcbiAgICB9XG5cbiAgICByZXR1cm4gb3B0aW1pemF0aW9uTWFwW25hbWVdIHx8IDEwXG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVBlcmZvcm1hbmNlTWV0cmljcyhjaHVua3M6IENodW5rSW5mb1tdKTogUGVyZm9ybWFuY2VNZXRyaWNzIHtcbiAgICBjb25zdCBmaXJzdExvYWRKUyA9IGNodW5rc1xuICAgICAgLmZpbHRlcihjaHVuayA9PiBjaHVuay5sb2FkUHJpb3JpdHkgPT09ICdjcml0aWNhbCcpXG4gICAgICAucmVkdWNlKChzdW0sIGNodW5rKSA9PiBzdW0gKyBjaHVuay5zaXplLCAwKVxuXG4gICAgY29uc3QgdG90YWxKUyA9IGNodW5rcy5yZWR1Y2UoKHN1bSwgY2h1bmspID0+IHN1bSArIGNodW5rLnNpemUsIDApXG5cbiAgICAvLyBDYWxjdWxhciBzY29yZSBiYXNhZG8gZW4gcGVyZm9ybWFuY2UgYnVkZ2V0c1xuICAgIGNvbnN0IHNjb3JlID0gdGhpcy5jYWxjdWxhdGVQZXJmb3JtYW5jZVNjb3JlKGZpcnN0TG9hZEpTLCB0b3RhbEpTKVxuICAgIGNvbnN0IGdyYWRlID0gdGhpcy5nZXRQZXJmb3JtYW5jZUdyYWRlKHNjb3JlKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZpcnN0TG9hZEpTLFxuICAgICAgdG90YWxKUyxcbiAgICAgIGNzczogMjUgKiAxMDI0LCAvLyBFc3RpbWFkb1xuICAgICAgaW1hZ2VzOiAxNTAgKiAxMDI0LCAvLyBFc3RpbWFkb1xuICAgICAgZm9udHM6IDMwICogMTAyNCwgLy8gRXN0aW1hZG9cbiAgICAgIG90aGVyOiAyMCAqIDEwMjQsIC8vIEVzdGltYWRvXG4gICAgICBzY29yZSxcbiAgICAgIGdyYWRlLFxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlUGVyZm9ybWFuY2VTY29yZShmaXJzdExvYWRKUzogbnVtYmVyLCB0b3RhbEpTOiBudW1iZXIpOiBudW1iZXIge1xuICAgIGNvbnN0IHsgcGVyZm9ybWFuY2VCdWRnZXRzIH0gPSB0aGlzLmNvbmZpZ1xuXG4gICAgY29uc3QgZmlyc3RMb2FkUmF0aW8gPSBmaXJzdExvYWRKUyAvIHBlcmZvcm1hbmNlQnVkZ2V0cy5tYXhGaXJzdExvYWRKU1xuICAgIGNvbnN0IHRvdGFsUmF0aW8gPSB0b3RhbEpTIC8gcGVyZm9ybWFuY2VCdWRnZXRzLm1heEJ1bmRsZVNpemVcblxuICAgIGNvbnN0IHBlbmFsdHkgPSBNYXRoLm1heChmaXJzdExvYWRSYXRpbyAtIDEsIDApICsgTWF0aC5tYXgodG90YWxSYXRpbyAtIDEsIDApXG4gICAgcmV0dXJuIE1hdGgubWF4KDEwMCAtIHBlbmFsdHkgKiA1MCwgMClcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UGVyZm9ybWFuY2VHcmFkZShzY29yZTogbnVtYmVyKTogJ0EnIHwgJ0InIHwgJ0MnIHwgJ0QnIHwgJ0YnIHtcbiAgICBpZiAoc2NvcmUgPj0gOTApIHtcbiAgICAgIHJldHVybiAnQSdcbiAgICB9XG4gICAgaWYgKHNjb3JlID49IDgwKSB7XG4gICAgICByZXR1cm4gJ0InXG4gICAgfVxuICAgIGlmIChzY29yZSA+PSA3MCkge1xuICAgICAgcmV0dXJuICdDJ1xuICAgIH1cbiAgICBpZiAoc2NvcmUgPj0gNjApIHtcbiAgICAgIHJldHVybiAnRCdcbiAgICB9XG4gICAgcmV0dXJuICdGJ1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhcbiAgICBjaHVua3M6IENodW5rSW5mb1tdLFxuICAgIGRlcGVuZGVuY2llczogRGVwZW5kZW5jeUluZm9bXSxcbiAgICBwZXJmb3JtYW5jZTogUGVyZm9ybWFuY2VNZXRyaWNzXG4gICk6IE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uW10ge1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogT3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25bXSA9IFtdXG5cbiAgICAvLyBSZWNvbWVuZGFjaW9uZXMgYmFzYWRhcyBlbiB0YW1hw7FvIGRlIGNodW5rc1xuICAgIGNvbnN0IGxhcmdlQ2h1bmtzID0gY2h1bmtzLmZpbHRlcihjaHVuayA9PiBjaHVuay5zaXplID4gdGhpcy5jb25maWcubWF4Q2h1bmtTaXplKVxuICAgIGZvciAoY29uc3QgY2h1bmsgb2YgbGFyZ2VDaHVua3MpIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2NvZGUtc3BsaXR0aW5nJyxcbiAgICAgICAgcHJpb3JpdHk6ICdoaWdoJyxcbiAgICAgICAgZGVzY3JpcHRpb246IGBDaHVuayAnJHtjaHVuay5uYW1lfScgZXMgZGVtYXNpYWRvIGdyYW5kZSAoJHtNYXRoLnJvdW5kKGNodW5rLnNpemUgLyAxMDI0KX1LQilgLFxuICAgICAgICBlc3RpbWF0ZWRTYXZpbmdzOiBjaHVuay5zaXplICogMC4zLFxuICAgICAgICBpbXBsZW1lbnRhdGlvbjogYERpdmlkaXIgJHtjaHVuay5uYW1lfSBlbiBjaHVua3MgbcOhcyBwZXF1ZcOxb3MgdXNhbmRvIGR5bmFtaWMgaW1wb3J0c2AsXG4gICAgICAgIGVmZm9ydDogJ21lZGl1bScsXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIFJlY29tZW5kYWNpb25lcyBiYXNhZGFzIGVuIGRlcGVuZGVuY2lhc1xuICAgIGNvbnN0IGhlYXZ5RGVwcyA9IGRlcGVuZGVuY2llcy5maWx0ZXIoXG4gICAgICBkZXAgPT4gZGVwLnNpemUgPiAxMDAgKiAxMDI0ICYmIGRlcC5vcHRpbWl6YXRpb25Qb3RlbnRpYWwgPiAzMFxuICAgIClcbiAgICBmb3IgKGNvbnN0IGRlcCBvZiBoZWF2eURlcHMpIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2RlcGVuZGVuY3ktcmVwbGFjZW1lbnQnLFxuICAgICAgICBwcmlvcml0eTogJ21lZGl1bScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgRGVwZW5kZW5jaWEgJyR7ZGVwLm5hbWV9JyBlcyBwZXNhZGEgeSB0aWVuZSBwb3RlbmNpYWwgZGUgb3B0aW1pemFjacOzbmAsXG4gICAgICAgIGVzdGltYXRlZFNhdmluZ3M6IGRlcC5zaXplICogKGRlcC5vcHRpbWl6YXRpb25Qb3RlbnRpYWwgLyAxMDApLFxuICAgICAgICBpbXBsZW1lbnRhdGlvbjogYENvbnNpZGVyYXIgYWx0ZXJuYXRpdmFzOiAke2RlcC5hbHRlcm5hdGl2ZXM/LmpvaW4oJywgJykgfHwgJ3RyZWUgc2hha2luZyd9YCxcbiAgICAgICAgZWZmb3J0OiAnaGlnaCcsXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIFJlY29tZW5kYWNpb25lcyBiYXNhZGFzIGVuIHBlcmZvcm1hbmNlXG4gICAgaWYgKHBlcmZvcm1hbmNlLmZpcnN0TG9hZEpTID4gdGhpcy5jb25maWcucGVyZm9ybWFuY2VCdWRnZXRzLm1heEZpcnN0TG9hZEpTKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdsYXp5LWxvYWRpbmcnLFxuICAgICAgICBwcmlvcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdGaXJzdCBMb2FkIEpTIGV4Y2VkZSBlbCBwcmVzdXB1ZXN0byBkZSBwZXJmb3JtYW5jZScsXG4gICAgICAgIGVzdGltYXRlZFNhdmluZ3M6IHBlcmZvcm1hbmNlLmZpcnN0TG9hZEpTIC0gdGhpcy5jb25maWcucGVyZm9ybWFuY2VCdWRnZXRzLm1heEZpcnN0TG9hZEpTLFxuICAgICAgICBpbXBsZW1lbnRhdGlvbjogJ0ltcGxlbWVudGFyIGxhenkgbG9hZGluZyBwYXJhIGNvbXBvbmVudGVzIG5vIGNyw610aWNvcycsXG4gICAgICAgIGVmZm9ydDogJ2xvdycsXG4gICAgICB9KVxuICAgIH1cblxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgY29uc3QgcHJpb3JpdHlPcmRlciA9IHsgY3JpdGljYWw6IDQsIGhpZ2g6IDMsIG1lZGl1bTogMiwgbG93OiAxIH1cbiAgICAgIHJldHVybiBwcmlvcml0eU9yZGVyW2IucHJpb3JpdHldIC0gcHJpb3JpdHlPcmRlclthLnByaW9yaXR5XVxuICAgIH0pXG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBPUFRJTUlaQUNJT05FUyBBVVRPTcOBVElDQVNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBwdWJsaWMgYXN5bmMgYXBwbHlPcHRpbWl6YXRpb25zKHJlY29tbWVuZGF0aW9uczogT3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25bXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvciAoY29uc3QgcmVjb21tZW5kYXRpb24gb2YgcmVjb21tZW5kYXRpb25zKSB7XG4gICAgICBpZiAocmVjb21tZW5kYXRpb24uZWZmb3J0ID09PSAnbG93Jykge1xuICAgICAgICBhd2FpdCB0aGlzLmFwcGx5TG93RWZmb3J0T3B0aW1pemF0aW9uKHJlY29tbWVuZGF0aW9uKVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgYXBwbHlMb3dFZmZvcnRPcHRpbWl6YXRpb24oXG4gICAgcmVjb21tZW5kYXRpb246IE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHN3aXRjaCAocmVjb21tZW5kYXRpb24udHlwZSkge1xuICAgICAgY2FzZSAnbGF6eS1sb2FkaW5nJzpcbiAgICAgICAgYXdhaXQgdGhpcy5pbXBsZW1lbnRMYXp5TG9hZGluZygpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdjb21wcmVzc2lvbic6XG4gICAgICAgIGF3YWl0IHRoaXMuZW5hYmxlQ29tcHJlc3Npb24oKVxuICAgICAgICBicmVha1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29uc29sZS5sb2coYE9wdGltaXphdGlvbiAke3JlY29tbWVuZGF0aW9uLnR5cGV9IHJlcXVpcmVzIG1hbnVhbCBpbXBsZW1lbnRhdGlvbmApXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbXBsZW1lbnRMYXp5TG9hZGluZygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBJbXBsZW1lbnRhciBsYXp5IGxvYWRpbmcgYXV0b23DoXRpY28gcGFyYSBjb21wb25lbnRlcyBwZXNhZG9zXG4gICAgY29uc29sZS5sb2coJ0ltcGxlbWVudGluZyBhdXRvbWF0aWMgbGF6eSBsb2FkaW5nLi4uJylcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZW5hYmxlQ29tcHJlc3Npb24oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gSGFiaWxpdGFyIGNvbXByZXNpw7NuIGF1dG9tw6F0aWNhXG4gICAgY29uc29sZS5sb2coJ0VuYWJsaW5nIGNvbXByZXNzaW9uLi4uJylcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFJFUE9SVEVTIFkgTcOJVFJJQ0FTXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgcHVibGljIGdlbmVyYXRlT3B0aW1pemF0aW9uUmVwb3J0KGFuYWx5c2lzOiBCdW5kbGVBbmFseXNpcyk6IHN0cmluZyB7XG4gICAgY29uc3QgcmVwb3J0ID0gYFxuIyBCdW5kbGUgT3B0aW1pemF0aW9uIFJlcG9ydFxuXG4jIyBQZXJmb3JtYW5jZSBNZXRyaWNzXG4tICoqU2NvcmUqKjogJHthbmFseXNpcy5wZXJmb3JtYW5jZS5zY29yZX0vMTAwIChHcmFkZTogJHthbmFseXNpcy5wZXJmb3JtYW5jZS5ncmFkZX0pXG4tICoqRmlyc3QgTG9hZCBKUyoqOiAke01hdGgucm91bmQoYW5hbHlzaXMucGVyZm9ybWFuY2UuZmlyc3RMb2FkSlMgLyAxMDI0KX1LQlxuLSAqKlRvdGFsIEpTKio6ICR7TWF0aC5yb3VuZChhbmFseXNpcy5wZXJmb3JtYW5jZS50b3RhbEpTIC8gMTAyNCl9S0Jcbi0gKipUb3RhbCBCdW5kbGUgU2l6ZSoqOiAke01hdGgucm91bmQoYW5hbHlzaXMudG90YWxTaXplIC8gMTAyNCl9S0Jcbi0gKipHemlwcGVkIFNpemUqKjogJHtNYXRoLnJvdW5kKGFuYWx5c2lzLmd6aXBwZWRTaXplIC8gMTAyNCl9S0JcblxuIyMgQ2h1bmtzIEFuYWx5c2lzXG4ke2FuYWx5c2lzLmNodW5rc1xuICAubWFwKFxuICAgIGNodW5rID0+IGBcbi0gKioke2NodW5rLm5hbWV9Kio6ICR7TWF0aC5yb3VuZChjaHVuay5zaXplIC8gMTAyNCl9S0IgKCR7Y2h1bmsudHlwZX0sICR7Y2h1bmsubG9hZFByaW9yaXR5fSBwcmlvcml0eSlcbmBcbiAgKVxuICAuam9pbignJyl9XG5cbiMjIFRvcCBSZWNvbW1lbmRhdGlvbnNcbiR7YW5hbHlzaXMucmVjb21tZW5kYXRpb25zXG4gIC5zbGljZSgwLCA1KVxuICAubWFwKFxuICAgIChyZWMsIGkpID0+IGBcbiR7aSArIDF9LiAqKiR7cmVjLnR5cGV9KiogKCR7cmVjLnByaW9yaXR5fSBwcmlvcml0eSlcbiAgIC0gJHtyZWMuZGVzY3JpcHRpb259XG4gICAtIEVzdGltYXRlZCBzYXZpbmdzOiAke01hdGgucm91bmQocmVjLmVzdGltYXRlZFNhdmluZ3MgLyAxMDI0KX1LQlxuICAgLSBJbXBsZW1lbnRhdGlvbjogJHtyZWMuaW1wbGVtZW50YXRpb259XG5gXG4gIClcbiAgLmpvaW4oJycpfVxuXG4jIyBEZXBlbmRlbmNpZXMgQW5hbHlzaXNcbi0gKipUb3RhbCBEZXBlbmRlbmNpZXMqKjogJHthbmFseXNpcy5kZXBlbmRlbmNpZXMubGVuZ3RofVxuLSAqKkhlYXZ5IERlcGVuZGVuY2llcyoqOiAke2FuYWx5c2lzLmRlcGVuZGVuY2llcy5maWx0ZXIoZCA9PiBkLnNpemUgPiAxMDAgKiAxMDI0KS5sZW5ndGh9XG4tICoqT3B0aW1pemF0aW9uIFBvdGVudGlhbCoqOiAke01hdGgucm91bmQoYW5hbHlzaXMuZGVwZW5kZW5jaWVzLnJlZHVjZSgoc3VtLCBkKSA9PiBzdW0gKyBkLm9wdGltaXphdGlvblBvdGVudGlhbCwgMCkgLyBhbmFseXNpcy5kZXBlbmRlbmNpZXMubGVuZ3RoKX0lXG5gXG5cbiAgICByZXR1cm4gcmVwb3J0XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJCdW5kbGVPcHRpbWl6YXRpb25NYW5hZ2VyIiwiYW5hbHlzaXNDYWNoZSIsIk1hcCIsImNvbmZpZyIsImdldERlZmF1bHRDb25maWciLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwibWF4Q2h1bmtTaXplIiwibWF4Rmlyc3RMb2FkU2l6ZSIsImVuYWJsZVRyZWVTaGFraW5nIiwiZW5hYmxlQ29kZVNwbGl0dGluZyIsImVuYWJsZUNvbXByZXNzaW9uIiwiZW5hYmxlTGF6eUxvYWRpbmciLCJwZXJmb3JtYW5jZUJ1ZGdldHMiLCJtYXhCdW5kbGVTaXplIiwibWF4Rmlyc3RMb2FkSlMiLCJtYXhDU1MiLCJtYXhJbWFnZXMiLCJ3YXJuaW5nVGhyZXNob2xkIiwiZXJyb3JUaHJlc2hvbGQiLCJ1cGRhdGVDb25maWciLCJuZXdDb25maWciLCJhbmFseXplQnVuZGxlcyIsImJ1aWxkUGF0aCIsImNhY2hlS2V5IiwiRGF0ZSIsIm5vdyIsImhhcyIsImdldCIsImFuYWx5c2lzIiwicGVyZm9ybUJ1bmRsZUFuYWx5c2lzIiwic2V0Iiwic2l6ZSIsImZpcnN0S2V5Iiwia2V5cyIsIm5leHQiLCJ2YWx1ZSIsImRlbGV0ZSIsImVycm9yIiwiY29uc29sZSIsIkVycm9yIiwibWVzc2FnZSIsInN0YXRpY1BhdGgiLCJwYXRoIiwiam9pbiIsImNodW5rcyIsImFuYWx5emVDaHVua3MiLCJkZXBlbmRlbmNpZXMiLCJhbmFseXplRGVwZW5kZW5jaWVzIiwicGVyZm9ybWFuY2UiLCJjYWxjdWxhdGVQZXJmb3JtYW5jZU1ldHJpY3MiLCJyZWNvbW1lbmRhdGlvbnMiLCJnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyIsInRvdGFsU2l6ZSIsInJlZHVjZSIsInN1bSIsImNodW5rIiwiZ3ppcHBlZFNpemUiLCJtb2NrQ2h1bmtzIiwibmFtZSIsInR5cGUiLCJsb2FkUHJpb3JpdHkiLCJtb2NrQ2h1bmsiLCJwdXNoIiwibW9kdWxlcyIsImFuYWx5emVDaHVua01vZHVsZXMiLCJ3YXJuIiwiY2h1bmtOYW1lIiwiaW1wb3J0cyIsImV4cG9ydHMiLCJpc1RyZWVTaGFrZWFibGUiLCJwYWNrYWdlSnNvblBhdGgiLCJwcm9jZXNzIiwiY3dkIiwicGFja2FnZUpzb24iLCJKU09OIiwicGFyc2UiLCJmcyIsInJlYWRGaWxlIiwiZGV2RGVwZW5kZW5jaWVzIiwiT2JqZWN0IiwiZW50cmllcyIsIm1hcCIsInZlcnNpb24iLCJlc3RpbWF0ZURlcGVuZGVuY3lTaXplIiwidXNhZ2UiLCJhbmFseXplRGVwZW5kZW5jeVVzYWdlIiwiYWx0ZXJuYXRpdmVzIiwic3VnZ2VzdEFsdGVybmF0aXZlcyIsIm9wdGltaXphdGlvblBvdGVudGlhbCIsImNhbGN1bGF0ZU9wdGltaXphdGlvblBvdGVudGlhbCIsInNpemVNYXAiLCJyZWFjdCIsInJlY2hhcnRzIiwiY3JpdGljYWxEZXBzIiwiaW1wb3J0YW50RGVwcyIsImluY2x1ZGVzIiwibW9tZW50Iiwib3B0aW1pemF0aW9uTWFwIiwiZmlyc3RMb2FkSlMiLCJmaWx0ZXIiLCJ0b3RhbEpTIiwic2NvcmUiLCJjYWxjdWxhdGVQZXJmb3JtYW5jZVNjb3JlIiwiZ3JhZGUiLCJnZXRQZXJmb3JtYW5jZUdyYWRlIiwiY3NzIiwiaW1hZ2VzIiwiZm9udHMiLCJvdGhlciIsImZpcnN0TG9hZFJhdGlvIiwidG90YWxSYXRpbyIsInBlbmFsdHkiLCJNYXRoIiwibWF4IiwibGFyZ2VDaHVua3MiLCJwcmlvcml0eSIsImRlc2NyaXB0aW9uIiwicm91bmQiLCJlc3RpbWF0ZWRTYXZpbmdzIiwiaW1wbGVtZW50YXRpb24iLCJlZmZvcnQiLCJoZWF2eURlcHMiLCJkZXAiLCJzb3J0IiwiYSIsImIiLCJwcmlvcml0eU9yZGVyIiwiY3JpdGljYWwiLCJoaWdoIiwibWVkaXVtIiwibG93IiwiYXBwbHlPcHRpbWl6YXRpb25zIiwicmVjb21tZW5kYXRpb24iLCJhcHBseUxvd0VmZm9ydE9wdGltaXphdGlvbiIsImltcGxlbWVudExhenlMb2FkaW5nIiwibG9nIiwiZ2VuZXJhdGVPcHRpbWl6YXRpb25SZXBvcnQiLCJyZXBvcnQiLCJzbGljZSIsInJlYyIsImkiLCJsZW5ndGgiLCJkIl0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMsOEJBQThCO0FBQzlCLHNDQUFzQztBQUN0QyxzRUFBc0U7Ozs7OytCQTZGekRBOzs7ZUFBQUE7OztvQkEzRmtCOzZEQUNkOzs7Ozs7QUEwRlYsTUFBTUE7SUFLWCxhQUFzQjthQUZkQyxnQkFBNkMsSUFBSUM7UUFHdkQsSUFBSSxDQUFDQyxNQUFNLEdBQUcsSUFBSSxDQUFDQyxnQkFBZ0I7SUFDckM7SUFFQSxPQUFjQyxjQUF5QztRQUNyRCxJQUFJLENBQUNMLDBCQUEwQk0sUUFBUSxFQUFFO1lBQ3ZDTiwwQkFBMEJNLFFBQVEsR0FBRyxJQUFJTjtRQUMzQztRQUNBLE9BQU9BLDBCQUEwQk0sUUFBUTtJQUMzQztJQUVBLHNDQUFzQztJQUN0QyxnQkFBZ0I7SUFDaEIsc0NBQXNDO0lBRTlCRixtQkFBNkM7UUFDbkQsT0FBTztZQUNMRyxjQUFjLE1BQU07WUFDcEJDLGtCQUFr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