72c509cf0cd193f0cba7aa8b9077180e
// ===================================
// PINTEYA E-COMMERCE - API MONITORING SYSTEM
// Sistema de monitoreo para detectar problemas de renderizado y API
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get apiMonitoring () {
        return apiMonitoring;
    },
    get detectApiDiscrepancy () {
        return detectApiDiscrepancy;
    },
    get monitorApiCall () {
        return monitorApiCall;
    },
    get useApiMonitoring () {
        return useApiMonitoring;
    }
});
class ApiMonitoringService {
    constructor(){
        this.events = [];
        this.renderingIssues = [];
        this.sessionId = this.generateSessionId();
    }
    static getInstance() {
        if (!ApiMonitoringService.instance) {
            ApiMonitoringService.instance = new ApiMonitoringService();
        }
        return ApiMonitoringService.instance;
    }
    generateSessionId() {
        return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }
    /**
   * Registra una discrepancia entre datos de API y renderizado
   */ recordApiDiscrepancy(endpoint, expectedCount, actualCount) {
        const event = {
            timestamp: new Date().toISOString(),
            endpoint,
            expectedCount,
            actualCount,
            discrepancy: expectedCount - actualCount,
            userAgent: navigator.userAgent,
            sessionId: this.sessionId
        };
        this.events.push(event);
        // Log crÃ­tico si hay discrepancia significativa
        if (event.discrepancy > 0) {
            console.error('ðŸš¨ API Discrepancy Detected:', {
                endpoint: event.endpoint,
                expected: event.expectedCount,
                actual: event.actualCount,
                lost: event.discrepancy,
                percentage: (event.discrepancy / event.expectedCount * 100).toFixed(2) + '%'
            });
            // Enviar alerta si la discrepancia es mayor al 20%
            if (event.discrepancy / event.expectedCount > 0.2) {
                this.sendCriticalAlert(event);
            }
        }
        // Mantener solo los Ãºltimos 100 eventos
        if (this.events.length > 100) {
            this.events = this.events.slice(-100);
        }
    }
    /**
   * Registra un problema de renderizado
   */ recordRenderingIssue(component, expectedItems, renderedItems, filterCriteria, errorDetails) {
        const issue = {
            timestamp: new Date().toISOString(),
            component,
            expectedItems,
            renderedItems,
            filterCriteria,
            errorDetails
        };
        this.renderingIssues.push(issue);
        console.warn('âš ï¸ Rendering Issue Detected:', {
            component: issue.component,
            expected: issue.expectedItems,
            rendered: issue.renderedItems,
            filters: issue.filterCriteria,
            error: issue.errorDetails
        });
        // Mantener solo los Ãºltimos 50 problemas
        if (this.renderingIssues.length > 50) {
            this.renderingIssues = this.renderingIssues.slice(-50);
        }
    }
    /**
   * EnvÃ­a una alerta crÃ­tica (en producciÃ³n se enviarÃ­a a un servicio de monitoreo)
   */ sendCriticalAlert(event) {
        // En desarrollo, solo log
        if (process.env.NODE_ENV === 'development') {
            console.error('ðŸš¨ CRITICAL ALERT:', {
                message: 'Significant data loss detected',
                event,
                recommendation: 'Check API validation logic and data filtering'
            });
        }
    // En producciÃ³n, enviar a servicio de monitoreo
    // fetch('/api/monitoring/alerts', {
    //   method: 'POST',
    //   headers: { 'Content-Type': 'application/json' },
    //   body: JSON.stringify({ type: 'api_discrepancy', event })
    // }).catch(console.error);
    }
    /**
   * Obtiene estadÃ­sticas de monitoreo
   */ getMonitoringStats() {
        const criticalEvents = this.events.filter((e)=>e.discrepancy > 0).length;
        const totalDiscrepancy = this.events.reduce((sum, e)=>sum + Math.abs(e.discrepancy), 0);
        const averageDiscrepancy = this.events.length > 0 ? totalDiscrepancy / this.events.length : 0;
        return {
            totalEvents: this.events.length,
            totalIssues: this.renderingIssues.length,
            criticalEvents,
            averageDiscrepancy,
            recentEvents: this.events.slice(-10),
            recentIssues: this.renderingIssues.slice(-10)
        };
    }
    /**
   * Limpia los datos de monitoreo
   */ clearMonitoringData() {
        this.events = [];
        this.renderingIssues = [];
        console.log('ðŸ§¹ Monitoring data cleared');
    }
    /**
   * Exporta datos de monitoreo para anÃ¡lisis
   */ exportMonitoringData() {
        const data = {
            sessionId: this.sessionId,
            exportTimestamp: new Date().toISOString(),
            events: this.events,
            renderingIssues: this.renderingIssues,
            stats: this.getMonitoringStats()
        };
        return JSON.stringify(data, null, 2);
    }
}
const apiMonitoring = ApiMonitoringService.getInstance();
function useApiMonitoring() {
    return {
        recordDiscrepancy: apiMonitoring.recordApiDiscrepancy.bind(apiMonitoring),
        recordRenderingIssue: apiMonitoring.recordRenderingIssue.bind(apiMonitoring),
        getStats: apiMonitoring.getMonitoringStats.bind(apiMonitoring),
        clearData: apiMonitoring.clearMonitoringData.bind(apiMonitoring),
        exportData: apiMonitoring.exportMonitoringData.bind(apiMonitoring)
    };
}
function detectApiDiscrepancy(endpoint, apiResponse, renderedItems) {
    const expectedCount = apiResponse.total || apiResponse.count || apiResponse.length || 0;
    const actualCount = Array.isArray(renderedItems) ? renderedItems.length : 0;
    if (expectedCount !== actualCount) {
        apiMonitoring.recordApiDiscrepancy(endpoint, expectedCount, actualCount);
    }
}
function monitorApiCall(endpoint) {
    return function(target, propertyName, descriptor) {
        const method = descriptor.value;
        descriptor.value = async function(...args) {
            const startTime = Date.now();
            try {
                const result = await method.apply(this, args);
                // Si el resultado tiene datos paginados, verificar discrepancias
                if (result && typeof result === 'object') {
                    if ('data' in result && 'pagination' in result.data) {
                        const { data } = result;
                        detectApiDiscrepancy(endpoint, data.pagination, data.orders || data.items || []);
                    }
                }
                return result;
            } catch (error) {
                const duration = Date.now() - startTime;
                console.error(`API call failed for ${endpoint} after ${duration}ms:`, error);
                throw error;
            }
        };
        return descriptor;
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcdXRpbHNcXGFwaS1tb25pdG9yaW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBQSU5URVlBIEUtQ09NTUVSQ0UgLSBBUEkgTU9OSVRPUklORyBTWVNURU1cbi8vIFNpc3RlbWEgZGUgbW9uaXRvcmVvIHBhcmEgZGV0ZWN0YXIgcHJvYmxlbWFzIGRlIHJlbmRlcml6YWRvIHkgQVBJXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbnRlcmZhY2UgQXBpTW9uaXRvcmluZ0V2ZW50IHtcbiAgdGltZXN0YW1wOiBzdHJpbmdcbiAgZW5kcG9pbnQ6IHN0cmluZ1xuICBleHBlY3RlZENvdW50OiBudW1iZXJcbiAgYWN0dWFsQ291bnQ6IG51bWJlclxuICBkaXNjcmVwYW5jeTogbnVtYmVyXG4gIHVzZXJBZ2VudDogc3RyaW5nXG4gIHNlc3Npb25JZDogc3RyaW5nXG59XG5cbmludGVyZmFjZSBSZW5kZXJpbmdJc3N1ZSB7XG4gIHRpbWVzdGFtcDogc3RyaW5nXG4gIGNvbXBvbmVudDogc3RyaW5nXG4gIGV4cGVjdGVkSXRlbXM6IG51bWJlclxuICByZW5kZXJlZEl0ZW1zOiBudW1iZXJcbiAgZmlsdGVyQ3JpdGVyaWE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuICBlcnJvckRldGFpbHM/OiBzdHJpbmdcbn1cblxuY2xhc3MgQXBpTW9uaXRvcmluZ1NlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogQXBpTW9uaXRvcmluZ1NlcnZpY2VcbiAgcHJpdmF0ZSBldmVudHM6IEFwaU1vbml0b3JpbmdFdmVudFtdID0gW11cbiAgcHJpdmF0ZSByZW5kZXJpbmdJc3N1ZXM6IFJlbmRlcmluZ0lzc3VlW10gPSBbXVxuICBwcml2YXRlIHNlc3Npb25JZDogc3RyaW5nXG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5zZXNzaW9uSWQgPSB0aGlzLmdlbmVyYXRlU2Vzc2lvbklkKClcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBBcGlNb25pdG9yaW5nU2VydmljZSB7XG4gICAgaWYgKCFBcGlNb25pdG9yaW5nU2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgQXBpTW9uaXRvcmluZ1NlcnZpY2UuaW5zdGFuY2UgPSBuZXcgQXBpTW9uaXRvcmluZ1NlcnZpY2UoKVxuICAgIH1cbiAgICByZXR1cm4gQXBpTW9uaXRvcmluZ1NlcnZpY2UuaW5zdGFuY2VcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVTZXNzaW9uSWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYHNlc3Npb25fJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gXG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0cmEgdW5hIGRpc2NyZXBhbmNpYSBlbnRyZSBkYXRvcyBkZSBBUEkgeSByZW5kZXJpemFkb1xuICAgKi9cbiAgcmVjb3JkQXBpRGlzY3JlcGFuY3koZW5kcG9pbnQ6IHN0cmluZywgZXhwZWN0ZWRDb3VudDogbnVtYmVyLCBhY3R1YWxDb3VudDogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgZXZlbnQ6IEFwaU1vbml0b3JpbmdFdmVudCA9IHtcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgZW5kcG9pbnQsXG4gICAgICBleHBlY3RlZENvdW50LFxuICAgICAgYWN0dWFsQ291bnQsXG4gICAgICBkaXNjcmVwYW5jeTogZXhwZWN0ZWRDb3VudCAtIGFjdHVhbENvdW50LFxuICAgICAgdXNlckFnZW50OiBuYXZpZ2F0b3IudXNlckFnZW50LFxuICAgICAgc2Vzc2lvbklkOiB0aGlzLnNlc3Npb25JZCxcbiAgICB9XG5cbiAgICB0aGlzLmV2ZW50cy5wdXNoKGV2ZW50KVxuXG4gICAgLy8gTG9nIGNyw610aWNvIHNpIGhheSBkaXNjcmVwYW5jaWEgc2lnbmlmaWNhdGl2YVxuICAgIGlmIChldmVudC5kaXNjcmVwYW5jeSA+IDApIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ/CfmqggQVBJIERpc2NyZXBhbmN5IERldGVjdGVkOicsIHtcbiAgICAgICAgZW5kcG9pbnQ6IGV2ZW50LmVuZHBvaW50LFxuICAgICAgICBleHBlY3RlZDogZXZlbnQuZXhwZWN0ZWRDb3VudCxcbiAgICAgICAgYWN0dWFsOiBldmVudC5hY3R1YWxDb3VudCxcbiAgICAgICAgbG9zdDogZXZlbnQuZGlzY3JlcGFuY3ksXG4gICAgICAgIHBlcmNlbnRhZ2U6ICgoZXZlbnQuZGlzY3JlcGFuY3kgLyBldmVudC5leHBlY3RlZENvdW50KSAqIDEwMCkudG9GaXhlZCgyKSArICclJyxcbiAgICAgIH0pXG5cbiAgICAgIC8vIEVudmlhciBhbGVydGEgc2kgbGEgZGlzY3JlcGFuY2lhIGVzIG1heW9yIGFsIDIwJVxuICAgICAgaWYgKGV2ZW50LmRpc2NyZXBhbmN5IC8gZXZlbnQuZXhwZWN0ZWRDb3VudCA+IDAuMikge1xuICAgICAgICB0aGlzLnNlbmRDcml0aWNhbEFsZXJ0KGV2ZW50KVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE1hbnRlbmVyIHNvbG8gbG9zIMO6bHRpbW9zIDEwMCBldmVudG9zXG4gICAgaWYgKHRoaXMuZXZlbnRzLmxlbmd0aCA+IDEwMCkge1xuICAgICAgdGhpcy5ldmVudHMgPSB0aGlzLmV2ZW50cy5zbGljZSgtMTAwKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RyYSB1biBwcm9ibGVtYSBkZSByZW5kZXJpemFkb1xuICAgKi9cbiAgcmVjb3JkUmVuZGVyaW5nSXNzdWUoXG4gICAgY29tcG9uZW50OiBzdHJpbmcsXG4gICAgZXhwZWN0ZWRJdGVtczogbnVtYmVyLFxuICAgIHJlbmRlcmVkSXRlbXM6IG51bWJlcixcbiAgICBmaWx0ZXJDcml0ZXJpYT86IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgIGVycm9yRGV0YWlscz86IHN0cmluZ1xuICApOiB2b2lkIHtcbiAgICBjb25zdCBpc3N1ZTogUmVuZGVyaW5nSXNzdWUgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIGNvbXBvbmVudCxcbiAgICAgIGV4cGVjdGVkSXRlbXMsXG4gICAgICByZW5kZXJlZEl0ZW1zLFxuICAgICAgZmlsdGVyQ3JpdGVyaWEsXG4gICAgICBlcnJvckRldGFpbHMsXG4gICAgfVxuXG4gICAgdGhpcy5yZW5kZXJpbmdJc3N1ZXMucHVzaChpc3N1ZSlcblxuICAgIGNvbnNvbGUud2Fybign4pqg77iPIFJlbmRlcmluZyBJc3N1ZSBEZXRlY3RlZDonLCB7XG4gICAgICBjb21wb25lbnQ6IGlzc3VlLmNvbXBvbmVudCxcbiAgICAgIGV4cGVjdGVkOiBpc3N1ZS5leHBlY3RlZEl0ZW1zLFxuICAgICAgcmVuZGVyZWQ6IGlzc3VlLnJlbmRlcmVkSXRlbXMsXG4gICAgICBmaWx0ZXJzOiBpc3N1ZS5maWx0ZXJDcml0ZXJpYSxcbiAgICAgIGVycm9yOiBpc3N1ZS5lcnJvckRldGFpbHMsXG4gICAgfSlcblxuICAgIC8vIE1hbnRlbmVyIHNvbG8gbG9zIMO6bHRpbW9zIDUwIHByb2JsZW1hc1xuICAgIGlmICh0aGlzLnJlbmRlcmluZ0lzc3Vlcy5sZW5ndGggPiA1MCkge1xuICAgICAgdGhpcy5yZW5kZXJpbmdJc3N1ZXMgPSB0aGlzLnJlbmRlcmluZ0lzc3Vlcy5zbGljZSgtNTApXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVudsOtYSB1bmEgYWxlcnRhIGNyw610aWNhIChlbiBwcm9kdWNjacOzbiBzZSBlbnZpYXLDrWEgYSB1biBzZXJ2aWNpbyBkZSBtb25pdG9yZW8pXG4gICAqL1xuICBwcml2YXRlIHNlbmRDcml0aWNhbEFsZXJ0KGV2ZW50OiBBcGlNb25pdG9yaW5nRXZlbnQpOiB2b2lkIHtcbiAgICAvLyBFbiBkZXNhcnJvbGxvLCBzb2xvIGxvZ1xuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgICAgY29uc29sZS5lcnJvcign8J+aqCBDUklUSUNBTCBBTEVSVDonLCB7XG4gICAgICAgIG1lc3NhZ2U6ICdTaWduaWZpY2FudCBkYXRhIGxvc3MgZGV0ZWN0ZWQnLFxuICAgICAgICBldmVudCxcbiAgICAgICAgcmVjb21tZW5kYXRpb246ICdDaGVjayBBUEkgdmFsaWRhdGlvbiBsb2dpYyBhbmQgZGF0YSBmaWx0ZXJpbmcnLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBFbiBwcm9kdWNjacOzbiwgZW52aWFyIGEgc2VydmljaW8gZGUgbW9uaXRvcmVvXG4gICAgLy8gZmV0Y2goJy9hcGkvbW9uaXRvcmluZy9hbGVydHMnLCB7XG4gICAgLy8gICBtZXRob2Q6ICdQT1NUJyxcbiAgICAvLyAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxuICAgIC8vICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyB0eXBlOiAnYXBpX2Rpc2NyZXBhbmN5JywgZXZlbnQgfSlcbiAgICAvLyB9KS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnRpZW5lIGVzdGFkw61zdGljYXMgZGUgbW9uaXRvcmVvXG4gICAqL1xuICBnZXRNb25pdG9yaW5nU3RhdHMoKToge1xuICAgIHRvdGFsRXZlbnRzOiBudW1iZXJcbiAgICB0b3RhbElzc3VlczogbnVtYmVyXG4gICAgY3JpdGljYWxFdmVudHM6IG51bWJlclxuICAgIGF2ZXJhZ2VEaXNjcmVwYW5jeTogbnVtYmVyXG4gICAgcmVjZW50RXZlbnRzOiBBcGlNb25pdG9yaW5nRXZlbnRbXVxuICAgIHJlY2VudElzc3VlczogUmVuZGVyaW5nSXNzdWVbXVxuICB9IHtcbiAgICBjb25zdCBjcml0aWNhbEV2ZW50cyA9IHRoaXMuZXZlbnRzLmZpbHRlcihlID0+IGUuZGlzY3JlcGFuY3kgPiAwKS5sZW5ndGhcbiAgICBjb25zdCB0b3RhbERpc2NyZXBhbmN5ID0gdGhpcy5ldmVudHMucmVkdWNlKChzdW0sIGUpID0+IHN1bSArIE1hdGguYWJzKGUuZGlzY3JlcGFuY3kpLCAwKVxuICAgIGNvbnN0IGF2ZXJhZ2VEaXNjcmVwYW5jeSA9IHRoaXMuZXZlbnRzLmxlbmd0aCA+IDAgPyB0b3RhbERpc2NyZXBhbmN5IC8gdGhpcy5ldmVudHMubGVuZ3RoIDogMFxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsRXZlbnRzOiB0aGlzLmV2ZW50cy5sZW5ndGgsXG4gICAgICB0b3RhbElzc3VlczogdGhpcy5yZW5kZXJpbmdJc3N1ZXMubGVuZ3RoLFxuICAgICAgY3JpdGljYWxFdmVudHMsXG4gICAgICBhdmVyYWdlRGlzY3JlcGFuY3ksXG4gICAgICByZWNlbnRFdmVudHM6IHRoaXMuZXZlbnRzLnNsaWNlKC0xMCksXG4gICAgICByZWNlbnRJc3N1ZXM6IHRoaXMucmVuZGVyaW5nSXNzdWVzLnNsaWNlKC0xMCksXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIExpbXBpYSBsb3MgZGF0b3MgZGUgbW9uaXRvcmVvXG4gICAqL1xuICBjbGVhck1vbml0b3JpbmdEYXRhKCk6IHZvaWQge1xuICAgIHRoaXMuZXZlbnRzID0gW11cbiAgICB0aGlzLnJlbmRlcmluZ0lzc3VlcyA9IFtdXG4gICAgY29uc29sZS5sb2coJ/Cfp7kgTW9uaXRvcmluZyBkYXRhIGNsZWFyZWQnKVxuICB9XG5cbiAgLyoqXG4gICAqIEV4cG9ydGEgZGF0b3MgZGUgbW9uaXRvcmVvIHBhcmEgYW7DoWxpc2lzXG4gICAqL1xuICBleHBvcnRNb25pdG9yaW5nRGF0YSgpOiBzdHJpbmcge1xuICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICBzZXNzaW9uSWQ6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgZXhwb3J0VGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICBldmVudHM6IHRoaXMuZXZlbnRzLFxuICAgICAgcmVuZGVyaW5nSXNzdWVzOiB0aGlzLnJlbmRlcmluZ0lzc3VlcyxcbiAgICAgIHN0YXRzOiB0aGlzLmdldE1vbml0b3JpbmdTdGF0cygpLFxuICAgIH1cblxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKVxuICB9XG59XG5cbi8vIEluc3RhbmNpYSBzaW5nbGV0b25cbmV4cG9ydCBjb25zdCBhcGlNb25pdG9yaW5nID0gQXBpTW9uaXRvcmluZ1NlcnZpY2UuZ2V0SW5zdGFuY2UoKVxuXG4vLyBIb29rIHBhcmEgdXNhciBlbCBtb25pdG9yZW8gZW4gY29tcG9uZW50ZXMgUmVhY3RcbmV4cG9ydCBmdW5jdGlvbiB1c2VBcGlNb25pdG9yaW5nKCkge1xuICByZXR1cm4ge1xuICAgIHJlY29yZERpc2NyZXBhbmN5OiBhcGlNb25pdG9yaW5nLnJlY29yZEFwaURpc2NyZXBhbmN5LmJpbmQoYXBpTW9uaXRvcmluZyksXG4gICAgcmVjb3JkUmVuZGVyaW5nSXNzdWU6IGFwaU1vbml0b3JpbmcucmVjb3JkUmVuZGVyaW5nSXNzdWUuYmluZChhcGlNb25pdG9yaW5nKSxcbiAgICBnZXRTdGF0czogYXBpTW9uaXRvcmluZy5nZXRNb25pdG9yaW5nU3RhdHMuYmluZChhcGlNb25pdG9yaW5nKSxcbiAgICBjbGVhckRhdGE6IGFwaU1vbml0b3JpbmcuY2xlYXJNb25pdG9yaW5nRGF0YS5iaW5kKGFwaU1vbml0b3JpbmcpLFxuICAgIGV4cG9ydERhdGE6IGFwaU1vbml0b3JpbmcuZXhwb3J0TW9uaXRvcmluZ0RhdGEuYmluZChhcGlNb25pdG9yaW5nKSxcbiAgfVxufVxuXG4vLyBVdGlsaWRhZCBwYXJhIGRldGVjdGFyIGF1dG9tw6F0aWNhbWVudGUgZGlzY3JlcGFuY2lhc1xuZXhwb3J0IGZ1bmN0aW9uIGRldGVjdEFwaURpc2NyZXBhbmN5KFxuICBlbmRwb2ludDogc3RyaW5nLFxuICBhcGlSZXNwb25zZTogeyB0b3RhbD86IG51bWJlcjsgY291bnQ/OiBudW1iZXI7IGxlbmd0aD86IG51bWJlciB9LFxuICByZW5kZXJlZEl0ZW1zOiB1bmtub3duW11cbik6IHZvaWQge1xuICBjb25zdCBleHBlY3RlZENvdW50ID0gYXBpUmVzcG9uc2UudG90YWwgfHwgYXBpUmVzcG9uc2UuY291bnQgfHwgYXBpUmVzcG9uc2UubGVuZ3RoIHx8IDBcbiAgY29uc3QgYWN0dWFsQ291bnQgPSBBcnJheS5pc0FycmF5KHJlbmRlcmVkSXRlbXMpID8gcmVuZGVyZWRJdGVtcy5sZW5ndGggOiAwXG5cbiAgaWYgKGV4cGVjdGVkQ291bnQgIT09IGFjdHVhbENvdW50KSB7XG4gICAgYXBpTW9uaXRvcmluZy5yZWNvcmRBcGlEaXNjcmVwYW5jeShlbmRwb2ludCwgZXhwZWN0ZWRDb3VudCwgYWN0dWFsQ291bnQpXG4gIH1cbn1cblxuLy8gRGVjb3JhdG9yIHBhcmEgbW9uaXRvcmVhciBhdXRvbcOhdGljYW1lbnRlIGZ1bmNpb25lcyBkZSBBUElcbmV4cG9ydCBmdW5jdGlvbiBtb25pdG9yQXBpQ2FsbChlbmRwb2ludDogc3RyaW5nKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0OiB1bmtub3duLCBwcm9wZXJ0eU5hbWU6IHN0cmluZywgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yKSB7XG4gICAgY29uc3QgbWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZVxuXG4gICAgZGVzY3JpcHRvci52YWx1ZSA9IGFzeW5jIGZ1bmN0aW9uICguLi5hcmdzOiB1bmtub3duW10pIHtcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KClcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3MpXG5cbiAgICAgICAgLy8gU2kgZWwgcmVzdWx0YWRvIHRpZW5lIGRhdG9zIHBhZ2luYWRvcywgdmVyaWZpY2FyIGRpc2NyZXBhbmNpYXNcbiAgICAgICAgaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgIGlmICgnZGF0YScgaW4gcmVzdWx0ICYmICdwYWdpbmF0aW9uJyBpbiByZXN1bHQuZGF0YSkge1xuICAgICAgICAgICAgY29uc3QgeyBkYXRhIH0gPSByZXN1bHRcbiAgICAgICAgICAgIGRldGVjdEFwaURpc2NyZXBhbmN5KGVuZHBvaW50LCBkYXRhLnBhZ2luYXRpb24sIGRhdGEub3JkZXJzIHx8IGRhdGEuaXRlbXMgfHwgW10pXG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEFQSSBjYWxsIGZhaWxlZCBmb3IgJHtlbmRwb2ludH0gYWZ0ZXIgJHtkdXJhdGlvbn1tczpgLCBlcnJvcilcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZGVzY3JpcHRvclxuICB9XG59XG4iXSwibmFtZXMiOlsiYXBpTW9uaXRvcmluZyIsImRldGVjdEFwaURpc2NyZXBhbmN5IiwibW9uaXRvckFwaUNhbGwiLCJ1c2VBcGlNb25pdG9yaW5nIiwiQXBpTW9uaXRvcmluZ1NlcnZpY2UiLCJldmVudHMiLCJyZW5kZXJpbmdJc3N1ZXMiLCJzZXNzaW9uSWQiLCJnZW5lcmF0ZVNlc3Npb25JZCIsImdldEluc3RhbmNlIiwiaW5zdGFuY2UiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwicmVjb3JkQXBpRGlzY3JlcGFuY3kiLCJlbmRwb2ludCIsImV4cGVjdGVkQ291bnQiLCJhY3R1YWxDb3VudCIsImV2ZW50IiwidGltZXN0YW1wIiwidG9JU09TdHJpbmciLCJkaXNjcmVwYW5jeSIsInVzZXJBZ2VudCIsIm5hdmlnYXRvciIsInB1c2giLCJjb25zb2xlIiwiZXJyb3IiLCJleHBlY3RlZCIsImFjdHVhbCIsImxvc3QiLCJwZXJjZW50YWdlIiwidG9GaXhlZCIsInNlbmRDcml0aWNhbEFsZXJ0IiwibGVuZ3RoIiwic2xpY2UiLCJyZWNvcmRSZW5kZXJpbmdJc3N1ZSIsImNvbXBvbmVudCIsImV4cGVjdGVkSXRlbXMiLCJyZW5kZXJlZEl0ZW1zIiwiZmlsdGVyQ3JpdGVyaWEiLCJlcnJvckRldGFpbHMiLCJpc3N1ZSIsIndhcm4iLCJyZW5kZXJlZCIsImZpbHRlcnMiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJtZXNzYWdlIiwicmVjb21tZW5kYXRpb24iLCJnZXRNb25pdG9yaW5nU3RhdHMiLCJjcml0aWNhbEV2ZW50cyIsImZpbHRlciIsImUiLCJ0b3RhbERpc2NyZXBhbmN5IiwicmVkdWNlIiwic3VtIiwiYWJzIiwiYXZlcmFnZURpc2NyZXBhbmN5IiwidG90YWxFdmVudHMiLCJ0b3RhbElzc3VlcyIsInJlY2VudEV2ZW50cyIsInJlY2VudElzc3VlcyIsImNsZWFyTW9uaXRvcmluZ0RhdGEiLCJsb2ciLCJleHBvcnRNb25pdG9yaW5nRGF0YSIsImRhdGEiLCJleHBvcnRUaW1lc3RhbXAiLCJzdGF0cyIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZWNvcmREaXNjcmVwYW5jeSIsImJpbmQiLCJnZXRTdGF0cyIsImNsZWFyRGF0YSIsImV4cG9ydERhdGEiLCJhcGlSZXNwb25zZSIsInRvdGFsIiwiY291bnQiLCJBcnJheSIsImlzQXJyYXkiLCJ0YXJnZXQiLCJwcm9wZXJ0eU5hbWUiLCJkZXNjcmlwdG9yIiwibWV0aG9kIiwidmFsdWUiLCJhcmdzIiwic3RhcnRUaW1lIiwicmVzdWx0IiwiYXBwbHkiLCJwYWdpbmF0aW9uIiwib3JkZXJzIiwiaXRlbXMiLCJkdXJhdGlvbiJdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBQ3RDLDZDQUE2QztBQUM3QyxvRUFBb0U7QUFDcEUsc0NBQXNDOzs7Ozs7Ozs7Ozs7UUEyTHpCQTtlQUFBQTs7UUFjR0M7ZUFBQUE7O1FBY0FD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