097123d50d8403d12007d1af006f385b
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "useAdminDashboardStats", {
    enumerable: true,
    get: function() {
        return useAdminDashboardStats;
    }
});
const _react = require("react");
const _react1 = require("next-auth/react");
function useAdminDashboardStats() {
    const [stats, setStats] = (0, _react.useState)(null);
    const [loading, setLoading] = (0, _react.useState)(true);
    const [error, setError] = (0, _react.useState)(null);
    const { data: session } = (0, _react1.useSession)();
    (0, _react.useEffect)(()=>{
        fetchDashboardStats();
    }, []);
    const fetchDashboardStats = async ()=>{
        try {
            setLoading(true);
            setError(null);
            // NextAuth.js maneja las cookies de sesión automáticamente
            // No necesitamos obtener token manualmente
            // Hacer requests paralelos a diferentes APIs (con manejo de errores individual)
            const [productsResponse, ordersResponse, usersResponse] = await Promise.allSettled([
                fetch('/api/admin/products/stats', {
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                }),
                fetch('/api/admin/orders/stats', {
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                }),
                fetch('/api/admin/users/stats', {
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                })
            ]);
            // Procesar respuesta de productos
            let productStats = {
                totalProducts: 0,
                activeProducts: 0,
                lowStockProducts: 0,
                noStockProducts: 0
            };
            if (productsResponse.status === 'fulfilled' && productsResponse.value.ok) {
                const data = await productsResponse.value.json();
                if (data.success && data.stats) {
                    productStats = {
                        totalProducts: data.stats.total_products || 0,
                        activeProducts: data.stats.active_products || 0,
                        lowStockProducts: data.stats.low_stock_products || 0,
                        noStockProducts: data.stats.no_stock_products || 0
                    };
                }
            }
            // Procesar respuesta de órdenes (con fallback si no existe la API)
            let orderStats = {
                totalOrders: 0,
                pendingOrders: 0,
                completedOrders: 0,
                totalRevenue: 0,
                todayRevenue: 0
            };
            if (ordersResponse.status === 'fulfilled' && ordersResponse.value.ok) {
                const data = await ordersResponse.value.json();
                if (data.success && data.stats) {
                    orderStats = {
                        totalOrders: data.stats.total_orders || 0,
                        pendingOrders: data.stats.pending_orders || 0,
                        completedOrders: data.stats.completed_orders || 0,
                        totalRevenue: data.stats.total_revenue || 0,
                        todayRevenue: data.stats.today_revenue || 0
                    };
                }
            }
            // Procesar respuesta de usuarios (con fallback si no existe la API)
            let userStats = {
                totalUsers: 0,
                activeUsers: 0
            };
            if (usersResponse.status === 'fulfilled' && usersResponse.value.ok) {
                const data = await usersResponse.value.json();
                if (data.success && data.stats) {
                    userStats = {
                        totalUsers: data.stats.total_users || 0,
                        activeUsers: data.stats.active_users || 0
                    };
                }
            }
            // Combinar todas las estadísticas
            const combinedStats = {
                ...productStats,
                ...orderStats,
                ...userStats
            };
            setStats(combinedStats);
        } catch (err) {
            console.error('Error fetching dashboard stats:', err);
            const errorMessage = err instanceof Error ? err.message : 'Error desconocido';
            // No establecer error inmediatamente, intentar fallback primero
            console.log('Intentando fallback con API pública de productos...');
            // Fallback: obtener estadísticas básicas directamente de la API pública
            try {
                const response = await fetch('/api/products', {
                    credentials: 'include'
                });
                if (response.ok) {
                    const data = await response.json();
                    const products = data.data || [];
                    const totalProducts = products.length;
                    const withStock = products.filter((p)=>p.stock && p.stock > 0).length;
                    const lowStock = products.filter((p)=>p.stock && p.stock > 0 && p.stock <= 10).length;
                    const noStock = products.filter((p)=>!p.stock || p.stock === 0).length;
                    setStats({
                        totalProducts,
                        activeProducts: withStock,
                        lowStockProducts: lowStock,
                        noStockProducts: noStock,
                        totalOrders: 0,
                        pendingOrders: 0,
                        completedOrders: 0,
                        totalRevenue: 0,
                        todayRevenue: 0,
                        totalUsers: 0,
                        activeUsers: 0
                    });
                    // Solo mostrar warning, no error completo
                    setError(`Usando datos básicos: ${errorMessage}`);
                    console.log('Fallback exitoso con API pública');
                } else {
                    console.warn('API pública falló, usando datos estáticos');
                    // Fallback final con datos conocidos
                    setStats({
                        totalProducts: 53,
                        activeProducts: 53,
                        lowStockProducts: 4,
                        noStockProducts: 0,
                        totalOrders: 0,
                        pendingOrders: 0,
                        completedOrders: 0,
                        totalRevenue: 0,
                        todayRevenue: 0,
                        totalUsers: 0,
                        activeUsers: 0
                    });
                    setError(`Usando datos estáticos: ${errorMessage}`);
                }
            } catch (fallbackError) {
                console.error('Error en fallback:', fallbackError);
                // Fallback final con datos estáticos
                setStats({
                    totalProducts: 53,
                    activeProducts: 53,
                    lowStockProducts: 4,
                    noStockProducts: 0,
                    totalOrders: 0,
                    pendingOrders: 0,
                    completedOrders: 0,
                    totalRevenue: 0,
                    todayRevenue: 0,
                    totalUsers: 0,
                    activeUsers: 0
                });
                setError(`Fallback completo falló: ${errorMessage}`);
            }
        } finally{
            setLoading(false);
        }
    };
    const formatCurrency = (amount)=>{
        return new Intl.NumberFormat('es-AR', {
            style: 'currency',
            currency: 'ARS',
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        }).format(amount);
    };
    const calculateChange = (current, previous)=>{
        if (previous === 0) {
            return {
                value: '+100%',
                type: 'positive'
            };
        }
        const change = (current - previous) / previous * 100;
        const absChange = Math.abs(change);
        if (absChange < 1) {
            return {
                value: '0%',
                type: 'neutral'
            };
        }
        return {
            value: `${change > 0 ? '+' : ''}${change.toFixed(1)}%`,
            type: change > 0 ? 'positive' : 'negative'
        };
    };
    return {
        stats,
        loading,
        error,
        refetch: fetchDashboardStats,
        formatCurrency,
        calculateChange
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXGFkbWluXFx1c2VBZG1pbkRhc2hib2FyZFN0YXRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyB1c2VTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoL3JlYWN0JztcblxuaW50ZXJmYWNlIERhc2hib2FyZFN0YXRzIHtcbiAgdG90YWxQcm9kdWN0czogbnVtYmVyO1xuICBhY3RpdmVQcm9kdWN0czogbnVtYmVyO1xuICBsb3dTdG9ja1Byb2R1Y3RzOiBudW1iZXI7XG4gIG5vU3RvY2tQcm9kdWN0czogbnVtYmVyO1xuICB0b3RhbE9yZGVyczogbnVtYmVyO1xuICBwZW5kaW5nT3JkZXJzOiBudW1iZXI7XG4gIGNvbXBsZXRlZE9yZGVyczogbnVtYmVyO1xuICB0b3RhbFJldmVudWU6IG51bWJlcjtcbiAgdG9kYXlSZXZlbnVlOiBudW1iZXI7XG4gIHRvdGFsVXNlcnM6IG51bWJlcjtcbiAgYWN0aXZlVXNlcnM6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFF1aWNrU3RhdCB7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIHZhbHVlOiBzdHJpbmc7XG4gIGNoYW5nZTogc3RyaW5nO1xuICBjaGFuZ2VUeXBlOiAncG9zaXRpdmUnIHwgJ25lZ2F0aXZlJyB8ICduZXV0cmFsJztcbiAgaWNvbjogYW55O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXNlQWRtaW5EYXNoYm9hcmRTdGF0cygpIHtcbiAgY29uc3QgW3N0YXRzLCBzZXRTdGF0c10gPSB1c2VTdGF0ZTxEYXNoYm9hcmRTdGF0cyB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbbG9hZGluZywgc2V0TG9hZGluZ10gPSB1c2VTdGF0ZSh0cnVlKTtcbiAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcbiAgY29uc3QgeyBkYXRhOiBzZXNzaW9uIH0gPSB1c2VTZXNzaW9uKCk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBmZXRjaERhc2hib2FyZFN0YXRzKCk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBmZXRjaERhc2hib2FyZFN0YXRzID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBzZXRMb2FkaW5nKHRydWUpO1xuICAgICAgc2V0RXJyb3IobnVsbCk7XG5cbiAgICAgIC8vIE5leHRBdXRoLmpzIG1hbmVqYSBsYXMgY29va2llcyBkZSBzZXNpw7NuIGF1dG9tw6F0aWNhbWVudGVcbiAgICAgIC8vIE5vIG5lY2VzaXRhbW9zIG9idGVuZXIgdG9rZW4gbWFudWFsbWVudGVcblxuICAgICAgLy8gSGFjZXIgcmVxdWVzdHMgcGFyYWxlbG9zIGEgZGlmZXJlbnRlcyBBUElzIChjb24gbWFuZWpvIGRlIGVycm9yZXMgaW5kaXZpZHVhbClcbiAgICAgIGNvbnN0IFtwcm9kdWN0c1Jlc3BvbnNlLCBvcmRlcnNSZXNwb25zZSwgdXNlcnNSZXNwb25zZV0gPSBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoW1xuICAgICAgICBmZXRjaCgnL2FwaS9hZG1pbi9wcm9kdWN0cy9zdGF0cycsIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnXG4gICAgICAgIH0pLFxuICAgICAgICBmZXRjaCgnL2FwaS9hZG1pbi9vcmRlcnMvc3RhdHMnLCB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJ1xuICAgICAgICB9KSxcbiAgICAgICAgZmV0Y2goJy9hcGkvYWRtaW4vdXNlcnMvc3RhdHMnLCB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJ1xuICAgICAgICB9KVxuICAgICAgXSk7XG5cbiAgICAgIC8vIFByb2Nlc2FyIHJlc3B1ZXN0YSBkZSBwcm9kdWN0b3NcbiAgICAgIGxldCBwcm9kdWN0U3RhdHMgPSB7XG4gICAgICAgIHRvdGFsUHJvZHVjdHM6IDAsXG4gICAgICAgIGFjdGl2ZVByb2R1Y3RzOiAwLFxuICAgICAgICBsb3dTdG9ja1Byb2R1Y3RzOiAwLFxuICAgICAgICBub1N0b2NrUHJvZHVjdHM6IDBcbiAgICAgIH07XG5cbiAgICAgIGlmIChwcm9kdWN0c1Jlc3BvbnNlLnN0YXR1cyA9PT0gJ2Z1bGZpbGxlZCcgJiYgcHJvZHVjdHNSZXNwb25zZS52YWx1ZS5vaykge1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcHJvZHVjdHNSZXNwb25zZS52YWx1ZS5qc29uKCk7XG4gICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MgJiYgZGF0YS5zdGF0cykge1xuICAgICAgICAgIHByb2R1Y3RTdGF0cyA9IHtcbiAgICAgICAgICAgIHRvdGFsUHJvZHVjdHM6IGRhdGEuc3RhdHMudG90YWxfcHJvZHVjdHMgfHwgMCxcbiAgICAgICAgICAgIGFjdGl2ZVByb2R1Y3RzOiBkYXRhLnN0YXRzLmFjdGl2ZV9wcm9kdWN0cyB8fCAwLFxuICAgICAgICAgICAgbG93U3RvY2tQcm9kdWN0czogZGF0YS5zdGF0cy5sb3dfc3RvY2tfcHJvZHVjdHMgfHwgMCxcbiAgICAgICAgICAgIG5vU3RvY2tQcm9kdWN0czogZGF0YS5zdGF0cy5ub19zdG9ja19wcm9kdWN0cyB8fCAwXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBQcm9jZXNhciByZXNwdWVzdGEgZGUgw7NyZGVuZXMgKGNvbiBmYWxsYmFjayBzaSBubyBleGlzdGUgbGEgQVBJKVxuICAgICAgbGV0IG9yZGVyU3RhdHMgPSB7XG4gICAgICAgIHRvdGFsT3JkZXJzOiAwLFxuICAgICAgICBwZW5kaW5nT3JkZXJzOiAwLFxuICAgICAgICBjb21wbGV0ZWRPcmRlcnM6IDAsXG4gICAgICAgIHRvdGFsUmV2ZW51ZTogMCxcbiAgICAgICAgdG9kYXlSZXZlbnVlOiAwXG4gICAgICB9O1xuXG4gICAgICBpZiAob3JkZXJzUmVzcG9uc2Uuc3RhdHVzID09PSAnZnVsZmlsbGVkJyAmJiBvcmRlcnNSZXNwb25zZS52YWx1ZS5vaykge1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgb3JkZXJzUmVzcG9uc2UudmFsdWUuanNvbigpO1xuICAgICAgICBpZiAoZGF0YS5zdWNjZXNzICYmIGRhdGEuc3RhdHMpIHtcbiAgICAgICAgICBvcmRlclN0YXRzID0ge1xuICAgICAgICAgICAgdG90YWxPcmRlcnM6IGRhdGEuc3RhdHMudG90YWxfb3JkZXJzIHx8IDAsXG4gICAgICAgICAgICBwZW5kaW5nT3JkZXJzOiBkYXRhLnN0YXRzLnBlbmRpbmdfb3JkZXJzIHx8IDAsXG4gICAgICAgICAgICBjb21wbGV0ZWRPcmRlcnM6IGRhdGEuc3RhdHMuY29tcGxldGVkX29yZGVycyB8fCAwLFxuICAgICAgICAgICAgdG90YWxSZXZlbnVlOiBkYXRhLnN0YXRzLnRvdGFsX3JldmVudWUgfHwgMCxcbiAgICAgICAgICAgIHRvZGF5UmV2ZW51ZTogZGF0YS5zdGF0cy50b2RheV9yZXZlbnVlIHx8IDBcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFByb2Nlc2FyIHJlc3B1ZXN0YSBkZSB1c3VhcmlvcyAoY29uIGZhbGxiYWNrIHNpIG5vIGV4aXN0ZSBsYSBBUEkpXG4gICAgICBsZXQgdXNlclN0YXRzID0ge1xuICAgICAgICB0b3RhbFVzZXJzOiAwLFxuICAgICAgICBhY3RpdmVVc2VyczogMFxuICAgICAgfTtcblxuICAgICAgaWYgKHVzZXJzUmVzcG9uc2Uuc3RhdHVzID09PSAnZnVsZmlsbGVkJyAmJiB1c2Vyc1Jlc3BvbnNlLnZhbHVlLm9rKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB1c2Vyc1Jlc3BvbnNlLnZhbHVlLmpzb24oKTtcbiAgICAgICAgaWYgKGRhdGEuc3VjY2VzcyAmJiBkYXRhLnN0YXRzKSB7XG4gICAgICAgICAgdXNlclN0YXRzID0ge1xuICAgICAgICAgICAgdG90YWxVc2VyczogZGF0YS5zdGF0cy50b3RhbF91c2VycyB8fCAwLFxuICAgICAgICAgICAgYWN0aXZlVXNlcnM6IGRhdGEuc3RhdHMuYWN0aXZlX3VzZXJzIHx8IDBcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENvbWJpbmFyIHRvZGFzIGxhcyBlc3RhZMOtc3RpY2FzXG4gICAgICBjb25zdCBjb21iaW5lZFN0YXRzOiBEYXNoYm9hcmRTdGF0cyA9IHtcbiAgICAgICAgLi4ucHJvZHVjdFN0YXRzLFxuICAgICAgICAuLi5vcmRlclN0YXRzLFxuICAgICAgICAuLi51c2VyU3RhdHNcbiAgICAgIH07XG5cbiAgICAgIHNldFN0YXRzKGNvbWJpbmVkU3RhdHMpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgZGFzaGJvYXJkIHN0YXRzOicsIGVycik7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogJ0Vycm9yIGRlc2Nvbm9jaWRvJztcblxuICAgICAgLy8gTm8gZXN0YWJsZWNlciBlcnJvciBpbm1lZGlhdGFtZW50ZSwgaW50ZW50YXIgZmFsbGJhY2sgcHJpbWVyb1xuICAgICAgY29uc29sZS5sb2coJ0ludGVudGFuZG8gZmFsbGJhY2sgY29uIEFQSSBww7pibGljYSBkZSBwcm9kdWN0b3MuLi4nKTtcblxuICAgICAgLy8gRmFsbGJhY2s6IG9idGVuZXIgZXN0YWTDrXN0aWNhcyBiw6FzaWNhcyBkaXJlY3RhbWVudGUgZGUgbGEgQVBJIHDDumJsaWNhXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL3Byb2R1Y3RzJywge1xuICAgICAgICAgIGNyZWRlbnRpYWxzOiAnaW5jbHVkZSdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICBjb25zdCBwcm9kdWN0cyA9IGRhdGEuZGF0YSB8fCBbXTtcblxuICAgICAgICAgIGNvbnN0IHRvdGFsUHJvZHVjdHMgPSBwcm9kdWN0cy5sZW5ndGg7XG4gICAgICAgICAgY29uc3Qgd2l0aFN0b2NrID0gcHJvZHVjdHMuZmlsdGVyKChwOiBhbnkpID0+IHAuc3RvY2sgJiYgcC5zdG9jayA+IDApLmxlbmd0aDtcbiAgICAgICAgICBjb25zdCBsb3dTdG9jayA9IHByb2R1Y3RzLmZpbHRlcigocDogYW55KSA9PiBwLnN0b2NrICYmIHAuc3RvY2sgPiAwICYmIHAuc3RvY2sgPD0gMTApLmxlbmd0aDtcbiAgICAgICAgICBjb25zdCBub1N0b2NrID0gcHJvZHVjdHMuZmlsdGVyKChwOiBhbnkpID0+ICFwLnN0b2NrIHx8IHAuc3RvY2sgPT09IDApLmxlbmd0aDtcblxuICAgICAgICAgIHNldFN0YXRzKHtcbiAgICAgICAgICAgIHRvdGFsUHJvZHVjdHMsXG4gICAgICAgICAgICBhY3RpdmVQcm9kdWN0czogd2l0aFN0b2NrLFxuICAgICAgICAgICAgbG93U3RvY2tQcm9kdWN0czogbG93U3RvY2ssXG4gICAgICAgICAgICBub1N0b2NrUHJvZHVjdHM6IG5vU3RvY2ssXG4gICAgICAgICAgICB0b3RhbE9yZGVyczogMCxcbiAgICAgICAgICAgIHBlbmRpbmdPcmRlcnM6IDAsXG4gICAgICAgICAgICBjb21wbGV0ZWRPcmRlcnM6IDAsXG4gICAgICAgICAgICB0b3RhbFJldmVudWU6IDAsXG4gICAgICAgICAgICB0b2RheVJldmVudWU6IDAsXG4gICAgICAgICAgICB0b3RhbFVzZXJzOiAwLFxuICAgICAgICAgICAgYWN0aXZlVXNlcnM6IDBcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFNvbG8gbW9zdHJhciB3YXJuaW5nLCBubyBlcnJvciBjb21wbGV0b1xuICAgICAgICAgIHNldEVycm9yKGBVc2FuZG8gZGF0b3MgYsOhc2ljb3M6ICR7ZXJyb3JNZXNzYWdlfWApO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdGYWxsYmFjayBleGl0b3NvIGNvbiBBUEkgcMO6YmxpY2EnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0FQSSBww7pibGljYSBmYWxsw7MsIHVzYW5kbyBkYXRvcyBlc3TDoXRpY29zJyk7XG4gICAgICAgICAgLy8gRmFsbGJhY2sgZmluYWwgY29uIGRhdG9zIGNvbm9jaWRvc1xuICAgICAgICAgIHNldFN0YXRzKHtcbiAgICAgICAgICAgIHRvdGFsUHJvZHVjdHM6IDUzLFxuICAgICAgICAgICAgYWN0aXZlUHJvZHVjdHM6IDUzLFxuICAgICAgICAgICAgbG93U3RvY2tQcm9kdWN0czogNCxcbiAgICAgICAgICAgIG5vU3RvY2tQcm9kdWN0czogMCxcbiAgICAgICAgICAgIHRvdGFsT3JkZXJzOiAwLFxuICAgICAgICAgICAgcGVuZGluZ09yZGVyczogMCxcbiAgICAgICAgICAgIGNvbXBsZXRlZE9yZGVyczogMCxcbiAgICAgICAgICAgIHRvdGFsUmV2ZW51ZTogMCxcbiAgICAgICAgICAgIHRvZGF5UmV2ZW51ZTogMCxcbiAgICAgICAgICAgIHRvdGFsVXNlcnM6IDAsXG4gICAgICAgICAgICBhY3RpdmVVc2VyczogMFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHNldEVycm9yKGBVc2FuZG8gZGF0b3MgZXN0w6F0aWNvczogJHtlcnJvck1lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGZhbGxiYWNrRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gZmFsbGJhY2s6JywgZmFsbGJhY2tFcnJvcik7XG4gICAgICAgIC8vIEZhbGxiYWNrIGZpbmFsIGNvbiBkYXRvcyBlc3TDoXRpY29zXG4gICAgICAgIHNldFN0YXRzKHtcbiAgICAgICAgICB0b3RhbFByb2R1Y3RzOiA1MyxcbiAgICAgICAgICBhY3RpdmVQcm9kdWN0czogNTMsXG4gICAgICAgICAgbG93U3RvY2tQcm9kdWN0czogNCxcbiAgICAgICAgICBub1N0b2NrUHJvZHVjdHM6IDAsXG4gICAgICAgICAgdG90YWxPcmRlcnM6IDAsXG4gICAgICAgICAgcGVuZGluZ09yZGVyczogMCxcbiAgICAgICAgICBjb21wbGV0ZWRPcmRlcnM6IDAsXG4gICAgICAgICAgdG90YWxSZXZlbnVlOiAwLFxuICAgICAgICAgIHRvZGF5UmV2ZW51ZTogMCxcbiAgICAgICAgICB0b3RhbFVzZXJzOiAwLFxuICAgICAgICAgIGFjdGl2ZVVzZXJzOiAwXG4gICAgICAgIH0pO1xuICAgICAgICBzZXRFcnJvcihgRmFsbGJhY2sgY29tcGxldG8gZmFsbMOzOiAke2Vycm9yTWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9IGZpbmFsbHkge1xuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGZvcm1hdEN1cnJlbmN5ID0gKGFtb3VudDogbnVtYmVyKTogc3RyaW5nID0+IHtcbiAgICByZXR1cm4gbmV3IEludGwuTnVtYmVyRm9ybWF0KCdlcy1BUicsIHtcbiAgICAgIHN0eWxlOiAnY3VycmVuY3knLFxuICAgICAgY3VycmVuY3k6ICdBUlMnLFxuICAgICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAwLFxuICAgICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwXG4gICAgfSkuZm9ybWF0KGFtb3VudCk7XG4gIH07XG5cbiAgY29uc3QgY2FsY3VsYXRlQ2hhbmdlID0gKGN1cnJlbnQ6IG51bWJlciwgcHJldmlvdXM6IG51bWJlcik6IHsgdmFsdWU6IHN0cmluZzsgdHlwZTogJ3Bvc2l0aXZlJyB8ICduZWdhdGl2ZScgfCAnbmV1dHJhbCcgfSA9PiB7XG4gICAgaWYgKHByZXZpb3VzID09PSAwKSB7XG4gICAgICByZXR1cm4geyB2YWx1ZTogJysxMDAlJywgdHlwZTogJ3Bvc2l0aXZlJyB9O1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBjaGFuZ2UgPSAoKGN1cnJlbnQgLSBwcmV2aW91cykgLyBwcmV2aW91cykgKiAxMDA7XG4gICAgY29uc3QgYWJzQ2hhbmdlID0gTWF0aC5hYnMoY2hhbmdlKTtcbiAgICBcbiAgICBpZiAoYWJzQ2hhbmdlIDwgMSkge1xuICAgICAgcmV0dXJuIHsgdmFsdWU6ICcwJScsIHR5cGU6ICduZXV0cmFsJyB9O1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdmFsdWU6IGAke2NoYW5nZSA+IDAgPyAnKycgOiAnJ30ke2NoYW5nZS50b0ZpeGVkKDEpfSVgLFxuICAgICAgdHlwZTogY2hhbmdlID4gMCA/ICdwb3NpdGl2ZScgOiAnbmVnYXRpdmUnXG4gICAgfTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHN0YXRzLFxuICAgIGxvYWRpbmcsXG4gICAgZXJyb3IsXG4gICAgcmVmZXRjaDogZmV0Y2hEYXNoYm9hcmRTdGF0cyxcbiAgICBmb3JtYXRDdXJyZW5jeSxcbiAgICBjYWxjdWxhdGVDaGFuZ2VcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJ1c2VBZG1pbkRhc2hib2FyZFN0YXRzIiwic3RhdHMiLCJzZXRTdGF0cyIsInVzZVN0YXRlIiwibG9hZGluZyIsInNldExvYWRpbmciLCJlcnJvciIsInNldEVycm9yIiwiZGF0YSIsInNlc3Npb24iLCJ1c2VTZXNzaW9uIiwidXNlRWZmZWN0IiwiZmV0Y2hEYXNoYm9hcmRTdGF0cyIsInByb2R1Y3RzUmVzcG9uc2UiLCJvcmRlcnNSZXNwb25zZSIsInVzZXJzUmVzcG9uc2UiLCJQcm9taXNlIiwiYWxsU2V0dGxlZCIsImZldGNoIiwiaGVhZGVycyIsImNyZWRlbnRpYWxzIiwicHJvZHVjdFN0YXRzIiwidG90YWxQcm9kdWN0cyIsImFjdGl2ZVByb2R1Y3RzIiwibG93U3RvY2tQcm9kdWN0cyIsIm5vU3RvY2tQcm9kdWN0cyIsInN0YXR1cyIsInZhbHVlIiwib2siLCJqc29uIiwic3VjY2VzcyIsInRvdGFsX3Byb2R1Y3RzIiwiYWN0aXZlX3Byb2R1Y3RzIiwibG93X3N0b2NrX3Byb2R1Y3RzIiwibm9fc3RvY2tfcHJvZHVjdHMiLCJvcmRlclN0YXRzIiwidG90YWxPcmRlcnMiLCJwZW5kaW5nT3JkZXJzIiwiY29tcGxldGVkT3JkZXJzIiwidG90YWxSZXZlbnVlIiwidG9kYXlSZXZlbnVlIiwidG90YWxfb3JkZXJzIiwicGVuZGluZ19vcmRlcnMiLCJjb21wbGV0ZWRfb3JkZXJzIiwidG90YWxfcmV2ZW51ZSIsInRvZGF5X3JldmVudWUiLCJ1c2VyU3RhdHMiLCJ0b3RhbFVzZXJzIiwiYWN0aXZlVXNlcnMiLCJ0b3RhbF91c2VycyIsImFjdGl2ZV91c2VycyIsImNvbWJpbmVkU3RhdHMiLCJlcnIiLCJjb25zb2xlIiwiZXJyb3JNZXNzYWdlIiwiRXJyb3IiLCJtZXNzYWdlIiwibG9nIiwicmVzcG9uc2UiLCJwcm9kdWN0cyIsImxlbmd0aCIsIndpdGhTdG9jayIsImZpbHRlciIsInAiLCJzdG9jayIsImxvd1N0b2NrIiwibm9TdG9jayIsIndhcm4iLCJmYWxsYmFja0Vycm9yIiwiZm9ybWF0Q3VycmVuY3kiLCJhbW91bnQiLCJJbnRsIiwiTnVtYmVyRm9ybWF0Iiwic3R5bGUiLCJjdXJyZW5jeSIsIm1pbmltdW1GcmFjdGlvbkRpZ2l0cyIsIm1heGltdW1GcmFjdGlvbkRpZ2l0cyIsImZvcm1hdCIsImNhbGN1bGF0ZUNoYW5nZSIsImN1cnJlbnQiLCJwcmV2aW91cyIsInR5cGUiLCJjaGFuZ2UiLCJhYnNDaGFuZ2UiLCJNYXRoIiwiYWJzIiwidG9GaXhlZCIsInJlZmV0Y2giXSwibWFwcGluZ3MiOiI7Ozs7K0JBeUJnQkE7OztlQUFBQTs7O3VCQXpCb0I7d0JBQ1Q7QUF3QnBCLFNBQVNBO0lBQ2QsTUFBTSxDQUFDQyxPQUFPQyxTQUFTLEdBQUdDLElBQUFBLGVBQVEsRUFBd0I7SUFDMUQsTUFBTSxDQUFDQyxTQUFTQyxXQUFXLEdBQUdGLElBQUFBLGVBQVEsRUFBQztJQUN2QyxNQUFNLENBQUNHLE9BQU9DLFNBQVMsR0FBR0osSUFBQUEsZUFBUSxFQUFnQjtJQUNsRCxNQUFNLEVBQUVLLE1BQU1DLE9BQU8sRUFBRSxHQUFHQyxJQUFBQSxrQkFBVTtJQUVwQ0MsSUFBQUEsZ0JBQVMsRUFBQztRQUNSQztJQUNGLEdBQUcsRUFBRTtJQUVMLE1BQU1BLHNCQUFzQjtRQUMxQixJQUFJO1lBQ0ZQLFdBQVc7WUFDWEUsU0FBUztZQUVULDJEQUEyRDtZQUMzRCwyQ0FBMkM7WUFFM0MsZ0ZBQWdGO1lBQ2hGLE1BQU0sQ0FBQ00sa0JBQWtCQyxnQkFBZ0JDLGNBQWMsR0FBRyxNQUFNQyxRQUFRQyxVQUFVLENBQUM7Z0JBQ2pGQyxNQUFNLDZCQUE2QjtvQkFDakNDLFNBQVM7d0JBQ1AsZ0JBQWdCO29CQUNsQjtvQkFDQUMsYUFBYTtnQkFDZjtnQkFDQUYsTUFBTSwyQkFBMkI7b0JBQy9CQyxTQUFTO3dCQUNQLGdCQUFnQjtvQkFDbEI7b0JBQ0FDLGFBQWE7Z0JBQ2Y7Z0JBQ0FGLE1BQU0sMEJBQTBCO29CQUM5QkMsU0FBUzt3QkFDUCxnQkFBZ0I7b0JBQ2xCO29CQUNBQyxhQUFhO2dCQUNmO2FBQ0Q7WUFFRCxrQ0FBa0M7WUFDbEMsSUFBSUMsZUFBZTtnQkFDakJDLGVBQWU7Z0JBQ2ZDLGdCQUFnQjtnQkFDaEJDLGtCQUFrQjtnQkFDbEJDLGlCQUFpQjtZQUNuQjtZQUVBLElBQUlaLGlCQUFpQmEsTUFBTSxLQUFLLGVBQWViLGlCQUFpQmMsS0FBSyxDQUFDQyxFQUFFLEVBQUU7Z0JBQ3hFLE1BQU1wQixPQUFPLE1BQU1LLGlCQUFpQmMsS0FBSyxDQUFDRSxJQUFJO2dCQUM5QyxJQUFJckIsS0FBS3NCLE9BQU8sSUFBSXRCLEtBQUtQLEtBQUssRUFBRTtvQkFDOUJvQixlQUFlO3dCQUNiQyxlQUFlZCxLQUFLUCxLQUFLLENBQUM4QixjQUFjLElBQUk7d0JBQzVDUixnQkFBZ0JmLEtBQUtQLEtBQUssQ0FBQytCLGVBQWUsSUFBSTt3QkFDOUNSLGtCQUFrQmhCLEtBQUtQLEtBQUssQ0FBQ2dDLGtCQUFrQixJQUFJO3dCQUNuRFIsaUJBQWlCakIsS0FBS1AsS0FBSyxDQUFDaUMsaUJBQWlCLElBQUk7b0JBQ25EO2dCQUNGO1lBQ0Y7WUFFQSxtRUFBbUU7WUFDbkUsSUFBSUMsYUFBYTtnQkFDZkMsYUFBYTtnQkFDYkMsZUFBZTtnQkFDZkMsaUJBQWlCO2dCQUNqQkMsY0FBYztnQkFDZEMsY0FBYztZQUNoQjtZQUVBLElBQUkxQixlQUFlWSxNQUFNLEtBQUssZUFBZVosZUFBZWEsS0FBSyxDQUFDQyxFQUFFLEVBQUU7Z0JBQ3BFLE1BQU1wQixPQUFPLE1BQU1NLGVBQWVhLEtBQUssQ0FBQ0UsSUFBSTtnQkFDNUMsSUFBSXJCLEtBQUtzQixPQUFPLElBQUl0QixLQUFLUCxLQUFLLEVBQUU7b0JBQzlCa0MsYUFBYTt3QkFDWEMsYUFBYTVCLEtBQUtQLEtBQUssQ0FBQ3dDLFlBQVksSUFBSTt3QkFDeENKLGVBQWU3QixLQUFLUCxLQUFLLENBQUN5QyxjQUFjLElBQUk7d0JBQzVDSixpQkFBaUI5QixLQUFLUCxLQUFLLENBQUMwQyxnQkFBZ0IsSUFBSTt3QkFDaERKLGNBQWMvQixLQUFLUCxLQUFLLENBQUMyQyxhQUFhLElBQUk7d0JBQzFDSixjQUFjaEMsS0FBS1AsS0FBSyxDQUFDNEMsYUFBYSxJQUFJO29CQUM1QztnQkFDRjtZQUNGO1lBRUEsb0VBQW9FO1lBQ3BFLElBQUlDLFlBQVk7Z0JBQ2RDLFlBQVk7Z0JBQ1pDLGFBQWE7WUFDZjtZQUVBLElBQUlqQyxjQUFjVyxNQUFNLEtBQUssZUFBZVgsY0FBY1ksS0FBSyxDQUFDQyxFQUFFLEVBQUU7Z0JBQ2xFLE1BQU1wQixPQUFPLE1BQU1PLGNBQWNZLEtBQUssQ0FBQ0UsSUFBSTtnQkFDM0MsSUFBSXJCLEtBQUtzQixPQUFPLElBQUl0QixLQUFLUCxLQUFLLEVBQUU7b0JBQzlCNkMsWUFBWTt3QkFDVkMsWUFBWXZDLEtBQUtQLEtBQUssQ0FBQ2dELFdBQVcsSUFBSTt3QkFDdENELGFBQWF4QyxLQUFLUCxLQUFLLENBQUNpRCxZQUFZLElBQUk7b0JBQzFDO2dCQUNGO1lBQ0Y7WUFFQSxrQ0FBa0M7WUFDbEMsTUFBTUMsZ0JBQWdDO2dCQUNwQyxHQUFHOUIsWUFBWTtnQkFDZixHQUFHYyxVQUFVO2dCQUNiLEdBQUdXLFNBQVM7WUFDZDtZQUVBNUMsU0FBU2lEO1FBQ1gsRUFBRSxPQUFPQyxLQUFLO1lBQ1pDLFFBQVEvQyxLQUFLLENBQUMsbUNBQW1DOEM7WUFDakQsTUFBTUUsZUFBZUYsZUFBZUcsUUFBUUgsSUFBSUksT0FBTyxHQUFHO1lBRTFELGdFQUFnRTtZQUNoRUgsUUFBUUksR0FBRyxDQUFDO1lBRVosd0VBQXdFO1lBQ3hFLElBQUk7Z0JBQ0YsTUFBTUMsV0FBVyxNQUFNeEMsTUFBTSxpQkFBaUI7b0JBQzVDRSxhQUFhO2dCQUNmO2dCQUVBLElBQUlzQyxTQUFTOUIsRUFBRSxFQUFFO29CQUNmLE1BQU1wQixPQUFPLE1BQU1rRCxTQUFTN0IsSUFBSTtvQkFDaEMsTUFBTThCLFdBQVduRCxLQUFLQSxJQUFJLElBQUksRUFBRTtvQkFFaEMsTUFBTWMsZ0JBQWdCcUMsU0FBU0MsTUFBTTtvQkFDckMsTUFBTUMsWUFBWUYsU0FBU0csTUFBTSxDQUFDLENBQUNDLElBQVdBLEVBQUVDLEtBQUssSUFBSUQsRUFBRUMsS0FBSyxHQUFHLEdBQUdKLE1BQU07b0JBQzVFLE1BQU1LLFdBQVdOLFNBQVNHLE1BQU0sQ0FBQyxDQUFDQyxJQUFXQSxFQUFFQyxLQUFLLElBQUlELEVBQUVDLEtBQUssR0FBRyxLQUFLRCxFQUFFQyxLQUFLLElBQUksSUFBSUosTUFBTTtvQkFDNUYsTUFBTU0sVUFBVVAsU0FBU0csTUFBTSxDQUFDLENBQUNDLElBQVcsQ0FBQ0EsRUFBRUMsS0FBSyxJQUFJRCxFQUFFQyxLQUFLLEtBQUssR0FBR0osTUFBTTtvQkFFN0UxRCxTQUFTO3dCQUNQb0I7d0JBQ0FDLGdCQUFnQnNDO3dCQUNoQnJDLGtCQUFrQnlDO3dCQUNsQnhDLGlCQUFpQnlDO3dCQUNqQjlCLGFBQWE7d0JBQ2JDLGVBQWU7d0JBQ2ZDLGlCQUFpQjt3QkFDakJDLGNBQWM7d0JBQ2RDLGNBQWM7d0JBQ2RPLFlBQVk7d0JBQ1pDLGFBQWE7b0JBQ2Y7b0JBRUEsMENBQTBDO29CQUMxQ3pDLFNBQVMsQ0FBQyxzQkFBc0IsRUFBRStDLGNBQWM7b0JBQ2hERCxRQUFRSSxHQUFHLENBQUM7Z0JBQ2QsT0FBTztvQkFDTEosUUFBUWMsSUFBSSxDQUFDO29CQUNiLHFDQUFxQztvQkFDckNqRSxTQUFTO3dCQUNQb0IsZUFBZTt3QkFDZkMsZ0JBQWdCO3dCQUNoQkMsa0JBQWtCO3dCQUNsQkMsaUJBQWlCO3dCQUNqQlcsYUFBYTt3QkFDYkMsZUFBZTt3QkFDZkMsaUJBQWlCO3dCQUNqQkMsY0FBYzt3QkFDZEMsY0FBYzt3QkFDZE8sWUFBWTt3QkFDWkMsYUFBYTtvQkFDZjtvQkFDQXpDLFNBQVMsQ0FBQyx3QkFBd0IsRUFBRStDLGNBQWM7Z0JBQ3BEO1lBQ0YsRUFBRSxPQUFPYyxlQUFlO2dCQUN0QmYsUUFBUS9DLEtBQUssQ0FBQyxzQkFBc0I4RDtnQkFDcEMscUNBQXFDO2dCQUNyQ2xFLFNBQVM7b0JBQ1BvQixlQUFlO29CQUNmQyxnQkFBZ0I7b0JBQ2hCQyxrQkFBa0I7b0JBQ2xCQyxpQkFBaUI7b0JBQ2pCVyxhQUFhO29CQUNiQyxlQUFlO29CQUNmQyxpQkFBaUI7b0JBQ2pCQyxjQUFjO29CQUNkQyxjQUFjO29CQUNkTyxZQUFZO29CQUNaQyxhQUFhO2dCQUNmO2dCQUNBekMsU0FBUyxDQUFDLHlCQUF5QixFQUFFK0MsY0FBYztZQUNyRDtRQUNGLFNBQVU7WUFDUmpELFdBQVc7UUFDYjtJQUNGO0lBRUEsTUFBTWdFLGlCQUFpQixDQUFDQztRQUN0QixPQUFPLElBQUlDLEtBQUtDLFlBQVksQ0FBQyxTQUFTO1lBQ3BDQyxPQUFPO1lBQ1BDLFVBQVU7WUFDVkMsdUJBQXVCO1lBQ3ZCQyx1QkFBdUI7UUFDekIsR0FBR0MsTUFBTSxDQUFDUDtJQUNaO0lBRUEsTUFBTVEsa0JBQWtCLENBQUNDLFNBQWlCQztRQUN4QyxJQUFJQSxhQUFhLEdBQUc7WUFDbEIsT0FBTztnQkFBRXJELE9BQU87Z0JBQVNzRCxNQUFNO1lBQVc7UUFDNUM7UUFFQSxNQUFNQyxTQUFTLEFBQUVILENBQUFBLFVBQVVDLFFBQU8sSUFBS0EsV0FBWTtRQUNuRCxNQUFNRyxZQUFZQyxLQUFLQyxHQUFHLENBQUNIO1FBRTNCLElBQUlDLFlBQVksR0FBRztZQUNqQixPQUFPO2dCQUFFeEQsT0FBTztnQkFBTXNELE1BQU07WUFBVTtRQUN4QztRQUVBLE9BQU87WUFDTHRELE9BQU8sR0FBR3VELFNBQVMsSUFBSSxNQUFNLEtBQUtBLE9BQU9JLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0REwsTUFBTUMsU0FBUyxJQUFJLGFBQWE7UUFDbEM7SUFDRjtJQUVBLE9BQU87UUFDTGpGO1FBQ0FHO1FBQ0FFO1FBQ0FpRixTQUFTM0U7UUFDVHlEO1FBQ0FTO0lBQ0Y7QUFDRiJ9