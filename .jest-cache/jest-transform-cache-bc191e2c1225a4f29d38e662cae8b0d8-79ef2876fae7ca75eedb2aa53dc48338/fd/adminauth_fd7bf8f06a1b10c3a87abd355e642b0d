32a171646c2b84c00b5e654f3d8f536f
/**
 * Sistema de Autenticación y Autorización para Panel Administrativo
 * Implementa verificación de roles y permisos granulares
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    checkAdminAccess: function() {
        return checkAdminAccess;
    },
    checkAdminPermissions: function() {
        return checkAdminPermissions;
    },
    checkCRUDPermissions: function() {
        return checkCRUDPermissions;
    },
    getAuthFromApiRoute: function() {
        return getAuthFromApiRoute;
    },
    getAuthFromRouteHandler: function() {
        return getAuthFromRouteHandler;
    },
    getAuthenticatedUser: function() {
        return getAuthenticatedUser;
    },
    getRequestInfo: function() {
        return getRequestInfo;
    },
    getUnifiedAuth: function() {
        return getUnifiedAuth;
    },
    getUserProfile: function() {
        return getUserProfile;
    },
    hasAllPermissions: function() {
        return hasAllPermissions;
    },
    hasAnyPermission: function() {
        return hasAnyPermission;
    },
    hasPermission: function() {
        return hasPermission;
    },
    isAdmin: function() {
        return isAdmin;
    },
    isModeratorOrAdmin: function() {
        return isModeratorOrAdmin;
    },
    logAdminAccess: function() {
        return logAdminAccess;
    },
    logAdminAction: function() {
        return logAdminAction;
    },
    withAdminAuth: function() {
        return withAdminAuth;
    },
    withAdminAuthPages: function() {
        return withAdminAuthPages;
    }
});
const _server = require("@clerk/nextjs/server");
const _supabase = require("../supabase");
async function getAuthenticatedUser(request) {
    try {
        // Método 1: Usar getAuth oficial de Clerk para API Routes (PREFERIDO)
        if (request && 'query' in request) {
            // Es NextApiRequest (Pages Router)
            const { userId, sessionId } = (0, _server.getAuth)(request);
            if (userId) {
                console.log(`[AUTH] Usuario autenticado via getAuth: ${userId}`);
                return {
                    userId,
                    sessionId
                };
            }
        }
        // Método 2: Usar auth() para App Router Route Handlers
        if (!request || !('query' in request)) {
            try {
                const { userId, sessionId } = await (0, _server.auth)();
                if (userId) {
                    console.log(`[AUTH] Usuario autenticado via auth(): ${userId}`);
                    return {
                        userId,
                        sessionId
                    };
                }
            } catch (authError) {
                console.warn('[AUTH] Error usando auth():', authError);
            // Continuar con métodos fallback
            }
        }
        // Método 3: Fallback a headers (compatibilidad con implementación anterior)
        if (request && 'headers' in request) {
            const clerkUserId = request.headers.get?.('x-clerk-user-id') || request.headers['x-clerk-user-id'];
            if (clerkUserId) {
                console.warn('[AUTH] Usando header fallback para userId - considera migrar a getAuth()');
                return {
                    userId: clerkUserId
                };
            }
        }
        // Método 4: Fallback a JWT en cookies (último recurso)
        if (request && 'cookies' in request) {
            try {
                const sessionToken = request.cookies.get?.('__session')?.value || request.cookies['__session'];
                if (sessionToken) {
                    // Decodificar el JWT para obtener el userId
                    const payload = JSON.parse(atob(sessionToken.split('.')[1]));
                    if (payload.sub) {
                        console.warn('[AUTH] Usando JWT fallback para userId');
                        return {
                            userId: payload.sub
                        };
                    }
                }
            } catch (jwtError) {
                console.warn('[AUTH] Error decoding JWT:', jwtError);
            }
        }
        return {
            userId: null,
            error: 'No autorizado'
        };
    } catch (error) {
        console.error('[AUTH] Error getting authenticated user:', error);
        return {
            userId: null,
            error: 'Error de autenticación'
        };
    }
}
function getAuthFromApiRoute(req, res) {
    const { userId, sessionId, getToken } = (0, _server.getAuth)(req);
    if (!userId) {
        throw new Error('Usuario no autenticado');
    }
    console.log(`[AUTH] API Route autenticada: ${userId}`);
    return {
        userId,
        sessionId,
        getToken
    };
}
async function getAuthFromRouteHandler() {
    const { userId, sessionId, getToken } = await (0, _server.auth)();
    if (!userId) {
        throw new Error('Usuario no autenticado');
    }
    console.log(`[AUTH] Route Handler autenticado: ${userId}`);
    return {
        userId,
        sessionId,
        getToken
    };
}
async function getUnifiedAuth(request) {
    try {
        // Detectar si es API Route (Pages Router)
        if (request && 'query' in request) {
            try {
                return getAuthFromApiRoute(request, {});
            } catch (apiError) {
                console.warn('[AUTH] Error en API Route, usando fallback:', apiError);
                // Fallback a función original
                return await getAuthenticatedUser(request);
            }
        }
        // Detectar si es Route Handler (App Router) o sin request
        if (!request || !('query' in request)) {
            try {
                return await getAuthFromRouteHandler();
            } catch (routeError) {
                console.warn('[AUTH] Error en Route Handler, usando fallback:', routeError);
                // Fallback a función original
                return await getAuthenticatedUser(request);
            }
        }
        // Fallback a función original
        return await getAuthenticatedUser(request);
    } catch (error) {
        console.error('[AUTH] Error en getUnifiedAuth:', error);
        // En lugar de lanzar error, retornar resultado de fallback
        return await getAuthenticatedUser(request);
    }
}
async function getUserProfile(clerkUserId) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client not available');
        }
        // Primero obtener el perfil del usuario
        const { data: profile, error: profileError } = await _supabase.supabaseAdmin.from('user_profiles').select('*').eq('clerk_user_id', clerkUserId).eq('is_active', true).single();
        if (profileError) {
            console.error('Error fetching user profile:', profileError);
            return null;
        }
        if (!profile) {
            return null;
        }
        // Luego obtener el rol del usuario
        const { data: role, error: roleError } = await _supabase.supabaseAdmin.from('user_roles').select('*').eq('id', profile.role_id).single();
        if (roleError) {
            console.error('Error fetching user role:', roleError);
            return null;
        }
        // Combinar los datos
        const userProfile = {
            ...profile,
            user_roles: role
        };
        return userProfile;
    } catch (error) {
        console.error('Error in getUserProfile:', error);
        return null;
    }
}
async function checkAdminAccess(clerkUserId) {
    try {
        const profile = await getUserProfile(clerkUserId);
        if (!profile) {
            return {
                success: false,
                error: 'Perfil de usuario no encontrado',
                status: 404
            };
        }
        if (!profile.user_roles || !profile.is_active) {
            return {
                success: false,
                error: 'Rol de usuario no válido',
                status: 403
            };
        }
        // Verificar si tiene acceso al panel admin
        const hasAdminAccess = hasPermission(profile, [
            'admin_panel',
            'access'
        ]);
        if (!hasAdminAccess) {
            return {
                success: false,
                error: 'Acceso denegado al panel administrativo',
                status: 403
            };
        }
        return {
            success: true,
            user: profile
        };
    } catch (error) {
        console.error('Error in checkAdminAccess:', error);
        return {
            success: false,
            error: 'Error interno del servidor',
            status: 500
        };
    }
}
function hasPermission(userProfile, permissionPath) {
    try {
        if (!userProfile.user_roles || !userProfile.user_roles.permissions) {
            return false;
        }
        let current = userProfile.user_roles.permissions;
        for (const path of permissionPath){
            if (current[path] === undefined) {
                return false;
            }
            current = current[path];
        }
        // Manejar diferentes tipos de valores de permisos
        if (typeof current === 'boolean') {
            return current;
        }
        if (typeof current === 'string') {
            // Para permisos como "own", "own_limited", etc.
            return current !== 'false';
        }
        return false;
    } catch (error) {
        console.error('Error checking permission:', error);
        return false;
    }
}
function hasAnyPermission(userProfile, permissions) {
    return permissions.some((permission)=>hasPermission(userProfile, permission));
}
function hasAllPermissions(userProfile, permissions) {
    return permissions.every((permission)=>hasPermission(userProfile, permission));
}
function isAdmin(userProfile) {
    return userProfile.user_roles?.role_name === 'admin';
}
function isModeratorOrAdmin(userProfile) {
    const role = userProfile.user_roles?.role_name;
    return role === 'admin' || role === 'moderator';
}
async function checkAdminPermissions(requiredPermissions, request) {
    try {
        // 1. Verificar autenticación con Clerk usando métodos oficiales
        let userId;
        let sessionId;
        try {
            const authResult = await getUnifiedAuth(request);
            userId = authResult.userId;
            sessionId = authResult.sessionId;
        } catch (authError) {
            console.warn('[AUTH] Error en autenticación unificada, intentando fallback');
            const fallbackResult = await getAuthenticatedUser(request);
            if (!fallbackResult.userId) {
                return {
                    success: false,
                    error: fallbackResult.error || 'No autorizado',
                    status: 401
                };
            }
            userId = fallbackResult.userId;
            sessionId = fallbackResult.sessionId;
        }
        // 2. Verificar disponibilidad de Supabase
        if (!_supabase.supabaseAdmin) {
            return {
                success: false,
                error: 'Servicio administrativo no disponible',
                status: 503
            };
        }
        // 3. Verificar acceso administrativo
        const adminCheck = await checkAdminAccess(userId);
        if (!adminCheck.success) {
            return adminCheck;
        }
        const userProfile = adminCheck.user;
        // 4. Verificar permisos específicos si se proporcionan
        if (requiredPermissions && requiredPermissions.length > 0) {
            const hasRequiredPermissions = hasAnyPermission(userProfile, requiredPermissions);
            if (!hasRequiredPermissions) {
                return {
                    success: false,
                    error: 'Permisos insuficientes para esta operación',
                    status: 403
                };
            }
        }
        // 5. Registrar acceso en audit log (opcional)
        await logAdminAccess(userProfile.id, 'API_ACCESS');
        return {
            success: true,
            user: userProfile,
            supabase: _supabase.supabaseAdmin
        };
    } catch (error) {
        console.error('Error in checkAdminPermissions:', error);
        return {
            success: false,
            error: 'Error interno del servidor',
            status: 500
        };
    }
}
async function checkCRUDPermissions(resource, action, request) {
    const requiredPermissions = [
        [
            resource,
            action
        ]
    ];
    return checkAdminPermissions(requiredPermissions, request);
}
async function logAdminAccess(userProfileId, action, resourceType, resourceId, additionalData) {
    try {
        if (!_supabase.supabaseAdmin) return;
        await _supabase.supabaseAdmin.from('admin_audit_log').insert({
            user_id: userProfileId,
            action,
            resource_type: resourceType || 'system',
            resource_id: resourceId,
            new_values: additionalData ? JSON.stringify(additionalData) : null
        });
    } catch (error) {
        console.error('Error logging admin access:', error);
    // No lanzar error para no interrumpir el flujo principal
    }
}
async function logAdminAction(userProfileId, action, resourceType, resourceId, oldValues, newValues) {
    try {
        if (!_supabase.supabaseAdmin) return;
        await _supabase.supabaseAdmin.from('admin_audit_log').insert({
            user_id: userProfileId,
            action,
            resource_type: resourceType,
            resource_id: resourceId,
            old_values: oldValues ? JSON.stringify(oldValues) : null,
            new_values: newValues ? JSON.stringify(newValues) : null
        });
    } catch (error) {
        console.error('Error logging admin action:', error);
    }
}
function withAdminAuth(handler, requiredPermissions) {
    return async (request)=>{
        const authResult = await checkAdminPermissions(requiredPermissions, request);
        if (!authResult.success) {
            return new Response(JSON.stringify({
                success: false,
                error: authResult.error
            }), {
                status: authResult.status || 500,
                headers: {
                    'Content-Type': 'application/json'
                }
            });
        }
        return handler(request, {
            user: authResult.user,
            supabase: authResult.supabase
        });
    };
}
function withAdminAuthPages(handler, requiredPermissions) {
    return async (req, res)=>{
        const authResult = await checkAdminPermissions(requiredPermissions, req);
        if (!authResult.success) {
            return res.status(authResult.status || 500).json({
                success: false,
                error: authResult.error
            });
        }
        return handler(req, res, {
            user: authResult.user,
            supabase: authResult.supabase
        });
    };
}
function getRequestInfo(request) {
    if ('query' in request) {
        // NextApiRequest (Pages Router)
        const req = request;
        return {
            method: req.method || 'GET',
            url: req.url || 'unknown',
            userAgent: req.headers['user-agent'] || 'unknown',
            ip: req.headers['x-forwarded-for'] || req.headers['x-real-ip'] || req.connection?.remoteAddress || 'unknown'
        };
    } else {
        // NextRequest (App Router)
        const req = request;
        return {
            method: req.method,
            url: req.url,
            userAgent: req.headers.get('user-agent') || 'unknown',
            ip: req.headers.get('x-forwarded-for') || req.headers.get('x-real-ip') || 'unknown'
        };
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhdXRoXFxhZG1pbi1hdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2lzdGVtYSBkZSBBdXRlbnRpY2FjacOzbiB5IEF1dG9yaXphY2nDs24gcGFyYSBQYW5lbCBBZG1pbmlzdHJhdGl2b1xuICogSW1wbGVtZW50YSB2ZXJpZmljYWNpw7NuIGRlIHJvbGVzIHkgcGVybWlzb3MgZ3JhbnVsYXJlc1xuICovXG5cbmltcG9ydCB7IGF1dGgsIGN1cnJlbnRVc2VyLCBnZXRBdXRoIH0gZnJvbSAnQGNsZXJrL25leHRqcy9zZXJ2ZXInO1xuaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUSVBPUyBZIElOVEVSRkFDRVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlclByb2ZpbGUge1xuICBpZDogc3RyaW5nO1xuICBzdXBhYmFzZV91c2VyX2lkOiBzdHJpbmcgfCBudWxsO1xuICBjbGVya191c2VyX2lkOiBzdHJpbmcgfCBudWxsO1xuICBlbWFpbDogc3RyaW5nO1xuICBmaXJzdF9uYW1lOiBzdHJpbmcgfCBudWxsO1xuICBsYXN0X25hbWU6IHN0cmluZyB8IG51bGw7XG4gIHJvbGVfaWQ6IG51bWJlcjtcbiAgaXNfYWN0aXZlOiBib29sZWFuO1xuICBpc192ZXJpZmllZDogYm9vbGVhbjtcbiAgdXNlcl9yb2xlczoge1xuICAgIGlkOiBudW1iZXI7XG4gICAgcm9sZV9uYW1lOiBzdHJpbmc7XG4gICAgZGlzcGxheV9uYW1lOiBzdHJpbmc7XG4gICAgcGVybWlzc2lvbnM6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gICAgaXNfYWN0aXZlOiBib29sZWFuO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFkbWluQXV0aFJlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIHVzZXI/OiBVc2VyUHJvZmlsZTtcbiAgZXJyb3I/OiBzdHJpbmc7XG4gIHN0YXR1cz86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJtaXNzaW9uQ2hlY2sge1xuICByZXNvdXJjZTogc3RyaW5nO1xuICBhY3Rpb246IHN0cmluZztcbiAgdXNlcklkPzogc3RyaW5nO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRlVOQ0lPTkVTIERFIFZFUklGSUNBQ0nDk04gREUgQVVURU5USUNBQ0nDk05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogT2J0aWVuZSBlbCB1c3VhcmlvIGF1dGVudGljYWRvIHVzYW5kbyBtw6l0b2RvcyBvZmljaWFsZXMgZGUgQ2xlcmtcbiAqIE1hbnRpZW5lIGNvbXBhdGliaWxpZGFkIGNvbiBpbXBsZW1lbnRhY2nDs24gYW50ZXJpb3IgY29tbyBmYWxsYmFja1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXV0aGVudGljYXRlZFVzZXIoXG4gIHJlcXVlc3Q/OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0XG4pOiBQcm9taXNlPHsgdXNlcklkOiBzdHJpbmcgfCBudWxsOyBzZXNzaW9uSWQ/OiBzdHJpbmc7IGVycm9yPzogc3RyaW5nIH0+IHtcbiAgdHJ5IHtcbiAgICAvLyBNw6l0b2RvIDE6IFVzYXIgZ2V0QXV0aCBvZmljaWFsIGRlIENsZXJrIHBhcmEgQVBJIFJvdXRlcyAoUFJFRkVSSURPKVxuICAgIGlmIChyZXF1ZXN0ICYmICdxdWVyeScgaW4gcmVxdWVzdCkge1xuICAgICAgLy8gRXMgTmV4dEFwaVJlcXVlc3QgKFBhZ2VzIFJvdXRlcilcbiAgICAgIGNvbnN0IHsgdXNlcklkLCBzZXNzaW9uSWQgfSA9IGdldEF1dGgocmVxdWVzdCBhcyBOZXh0QXBpUmVxdWVzdCk7XG4gICAgICBpZiAodXNlcklkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbQVVUSF0gVXN1YXJpbyBhdXRlbnRpY2FkbyB2aWEgZ2V0QXV0aDogJHt1c2VySWR9YCk7XG4gICAgICAgIHJldHVybiB7IHVzZXJJZCwgc2Vzc2lvbklkIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTcOpdG9kbyAyOiBVc2FyIGF1dGgoKSBwYXJhIEFwcCBSb3V0ZXIgUm91dGUgSGFuZGxlcnNcbiAgICBpZiAoIXJlcXVlc3QgfHwgISgncXVlcnknIGluIHJlcXVlc3QpKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IHVzZXJJZCwgc2Vzc2lvbklkIH0gPSBhd2FpdCBhdXRoKCk7XG4gICAgICAgIGlmICh1c2VySWQpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgW0FVVEhdIFVzdWFyaW8gYXV0ZW50aWNhZG8gdmlhIGF1dGgoKTogJHt1c2VySWR9YCk7XG4gICAgICAgICAgcmV0dXJuIHsgdXNlcklkLCBzZXNzaW9uSWQgfTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoYXV0aEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignW0FVVEhdIEVycm9yIHVzYW5kbyBhdXRoKCk6JywgYXV0aEVycm9yKTtcbiAgICAgICAgLy8gQ29udGludWFyIGNvbiBtw6l0b2RvcyBmYWxsYmFja1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE3DqXRvZG8gMzogRmFsbGJhY2sgYSBoZWFkZXJzIChjb21wYXRpYmlsaWRhZCBjb24gaW1wbGVtZW50YWNpw7NuIGFudGVyaW9yKVxuICAgIGlmIChyZXF1ZXN0ICYmICdoZWFkZXJzJyBpbiByZXF1ZXN0KSB7XG4gICAgICBjb25zdCBjbGVya1VzZXJJZCA9IHJlcXVlc3QuaGVhZGVycy5nZXQ/LigneC1jbGVyay11c2VyLWlkJykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAocmVxdWVzdC5oZWFkZXJzIGFzIGFueSlbJ3gtY2xlcmstdXNlci1pZCddO1xuICAgICAgaWYgKGNsZXJrVXNlcklkKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignW0FVVEhdIFVzYW5kbyBoZWFkZXIgZmFsbGJhY2sgcGFyYSB1c2VySWQgLSBjb25zaWRlcmEgbWlncmFyIGEgZ2V0QXV0aCgpJyk7XG4gICAgICAgIHJldHVybiB7IHVzZXJJZDogY2xlcmtVc2VySWQgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBNw6l0b2RvIDQ6IEZhbGxiYWNrIGEgSldUIGVuIGNvb2tpZXMgKMO6bHRpbW8gcmVjdXJzbylcbiAgICBpZiAocmVxdWVzdCAmJiAnY29va2llcycgaW4gcmVxdWVzdCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvblRva2VuID0gcmVxdWVzdC5jb29raWVzLmdldD8uKCdfX3Nlc3Npb24nKT8udmFsdWUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocmVxdWVzdC5jb29raWVzIGFzIGFueSlbJ19fc2Vzc2lvbiddO1xuICAgICAgICBpZiAoc2Vzc2lvblRva2VuKSB7XG4gICAgICAgICAgLy8gRGVjb2RpZmljYXIgZWwgSldUIHBhcmEgb2J0ZW5lciBlbCB1c2VySWRcbiAgICAgICAgICBjb25zdCBwYXlsb2FkID0gSlNPTi5wYXJzZShhdG9iKHNlc3Npb25Ub2tlbi5zcGxpdCgnLicpWzFdKSk7XG4gICAgICAgICAgaWYgKHBheWxvYWQuc3ViKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tBVVRIXSBVc2FuZG8gSldUIGZhbGxiYWNrIHBhcmEgdXNlcklkJyk7XG4gICAgICAgICAgICByZXR1cm4geyB1c2VySWQ6IHBheWxvYWQuc3ViIH07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChqd3RFcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tBVVRIXSBFcnJvciBkZWNvZGluZyBKV1Q6Jywgand0RXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7IHVzZXJJZDogbnVsbCwgZXJyb3I6ICdObyBhdXRvcml6YWRvJyB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tBVVRIXSBFcnJvciBnZXR0aW5nIGF1dGhlbnRpY2F0ZWQgdXNlcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgdXNlcklkOiBudWxsLCBlcnJvcjogJ0Vycm9yIGRlIGF1dGVudGljYWNpw7NuJyB9O1xuICB9XG59XG5cbi8qKlxuICogTnVldmEgZnVuY2nDs24gZXNwZWPDrWZpY2EgcGFyYSBQYWdlcyBSb3V0ZXIgQVBJIFJvdXRlc1xuICogVXNhIGdldEF1dGgocmVxKSBvZmljaWFsIGRlIENsZXJrXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBdXRoRnJvbUFwaVJvdXRlKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XG4gIGNvbnN0IHsgdXNlcklkLCBzZXNzaW9uSWQsIGdldFRva2VuIH0gPSBnZXRBdXRoKHJlcSk7XG5cbiAgaWYgKCF1c2VySWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzdWFyaW8gbm8gYXV0ZW50aWNhZG8nKTtcbiAgfVxuXG4gIGNvbnNvbGUubG9nKGBbQVVUSF0gQVBJIFJvdXRlIGF1dGVudGljYWRhOiAke3VzZXJJZH1gKTtcbiAgcmV0dXJuIHsgdXNlcklkLCBzZXNzaW9uSWQsIGdldFRva2VuIH07XG59XG5cbi8qKlxuICogTnVldmEgZnVuY2nDs24gZXNwZWPDrWZpY2EgcGFyYSBBcHAgUm91dGVyIFJvdXRlIEhhbmRsZXJzXG4gKiBVc2EgYXV0aCgpIG9maWNpYWwgZGUgQ2xlcmtcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEF1dGhGcm9tUm91dGVIYW5kbGVyKCkge1xuICBjb25zdCB7IHVzZXJJZCwgc2Vzc2lvbklkLCBnZXRUb2tlbiB9ID0gYXdhaXQgYXV0aCgpO1xuXG4gIGlmICghdXNlcklkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVc3VhcmlvIG5vIGF1dGVudGljYWRvJyk7XG4gIH1cblxuICBjb25zb2xlLmxvZyhgW0FVVEhdIFJvdXRlIEhhbmRsZXIgYXV0ZW50aWNhZG86ICR7dXNlcklkfWApO1xuICByZXR1cm4geyB1c2VySWQsIHNlc3Npb25JZCwgZ2V0VG9rZW4gfTtcbn1cblxuLyoqXG4gKiBGdW5jacOzbiB1bmlmaWNhZGEgcXVlIGRldGVjdGEgYXV0b23DoXRpY2FtZW50ZSBlbCB0aXBvIGRlIHJ1dGFcbiAqIENvbiBtYW5lam8gcm9idXN0byBkZSBlcnJvcmVzIHkgZmFsbGJhY2tzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVbmlmaWVkQXV0aChyZXF1ZXN0PzogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdCkge1xuICB0cnkge1xuICAgIC8vIERldGVjdGFyIHNpIGVzIEFQSSBSb3V0ZSAoUGFnZXMgUm91dGVyKVxuICAgIGlmIChyZXF1ZXN0ICYmICdxdWVyeScgaW4gcmVxdWVzdCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGdldEF1dGhGcm9tQXBpUm91dGUocmVxdWVzdCBhcyBOZXh0QXBpUmVxdWVzdCwge30gYXMgTmV4dEFwaVJlc3BvbnNlKTtcbiAgICAgIH0gY2F0Y2ggKGFwaUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignW0FVVEhdIEVycm9yIGVuIEFQSSBSb3V0ZSwgdXNhbmRvIGZhbGxiYWNrOicsIGFwaUVycm9yKTtcbiAgICAgICAgLy8gRmFsbGJhY2sgYSBmdW5jacOzbiBvcmlnaW5hbFxuICAgICAgICByZXR1cm4gYXdhaXQgZ2V0QXV0aGVudGljYXRlZFVzZXIocmVxdWVzdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRGV0ZWN0YXIgc2kgZXMgUm91dGUgSGFuZGxlciAoQXBwIFJvdXRlcikgbyBzaW4gcmVxdWVzdFxuICAgIGlmICghcmVxdWVzdCB8fCAhKCdxdWVyeScgaW4gcmVxdWVzdCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBnZXRBdXRoRnJvbVJvdXRlSGFuZGxlcigpO1xuICAgICAgfSBjYXRjaCAocm91dGVFcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tBVVRIXSBFcnJvciBlbiBSb3V0ZSBIYW5kbGVyLCB1c2FuZG8gZmFsbGJhY2s6Jywgcm91dGVFcnJvcik7XG4gICAgICAgIC8vIEZhbGxiYWNrIGEgZnVuY2nDs24gb3JpZ2luYWxcbiAgICAgICAgcmV0dXJuIGF3YWl0IGdldEF1dGhlbnRpY2F0ZWRVc2VyKHJlcXVlc3QpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIGEgZnVuY2nDs24gb3JpZ2luYWxcbiAgICByZXR1cm4gYXdhaXQgZ2V0QXV0aGVudGljYXRlZFVzZXIocmVxdWVzdCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW0FVVEhdIEVycm9yIGVuIGdldFVuaWZpZWRBdXRoOicsIGVycm9yKTtcbiAgICAvLyBFbiBsdWdhciBkZSBsYW56YXIgZXJyb3IsIHJldG9ybmFyIHJlc3VsdGFkbyBkZSBmYWxsYmFja1xuICAgIHJldHVybiBhd2FpdCBnZXRBdXRoZW50aWNhdGVkVXNlcihyZXF1ZXN0KTtcbiAgfVxufVxuXG4vKipcbiAqIE9idGllbmUgZWwgcGVyZmlsIGNvbXBsZXRvIGRlbCB1c3VhcmlvIGRlc2RlIFN1cGFiYXNlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyUHJvZmlsZShjbGVya1VzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyUHJvZmlsZSB8IG51bGw+IHtcbiAgdHJ5IHtcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU3VwYWJhc2UgYWRtaW4gY2xpZW50IG5vdCBhdmFpbGFibGUnKTtcbiAgICB9XG5cbiAgICAvLyBQcmltZXJvIG9idGVuZXIgZWwgcGVyZmlsIGRlbCB1c3VhcmlvXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnY2xlcmtfdXNlcl9pZCcsIGNsZXJrVXNlcklkKVxuICAgICAgLmVxKCdpc19hY3RpdmUnLCB0cnVlKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKHByb2ZpbGVFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgdXNlciBwcm9maWxlOicsIHByb2ZpbGVFcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoIXByb2ZpbGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIEx1ZWdvIG9idGVuZXIgZWwgcm9sIGRlbCB1c3VhcmlvXG4gICAgY29uc3QgeyBkYXRhOiByb2xlLCBlcnJvcjogcm9sZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgndXNlcl9yb2xlcycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnaWQnLCBwcm9maWxlLnJvbGVfaWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAocm9sZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB1c2VyIHJvbGU6Jywgcm9sZUVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIENvbWJpbmFyIGxvcyBkYXRvc1xuICAgIGNvbnN0IHVzZXJQcm9maWxlOiBVc2VyUHJvZmlsZSA9IHtcbiAgICAgIC4uLnByb2ZpbGUsXG4gICAgICB1c2VyX3JvbGVzOiByb2xlXG4gICAgfTtcblxuICAgIHJldHVybiB1c2VyUHJvZmlsZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRVc2VyUHJvZmlsZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBWZXJpZmljYSBzaSB1biB1c3VhcmlvIHRpZW5lIGFjY2VzbyBhbCBwYW5lbCBhZG1pbmlzdHJhdGl2b1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tBZG1pbkFjY2VzcyhjbGVya1VzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxBZG1pbkF1dGhSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwcm9maWxlID0gYXdhaXQgZ2V0VXNlclByb2ZpbGUoY2xlcmtVc2VySWQpO1xuICAgIFxuICAgIGlmICghcHJvZmlsZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnUGVyZmlsIGRlIHVzdWFyaW8gbm8gZW5jb250cmFkbycsXG4gICAgICAgIHN0YXR1czogNDA0XG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmICghcHJvZmlsZS51c2VyX3JvbGVzIHx8ICFwcm9maWxlLmlzX2FjdGl2ZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnUm9sIGRlIHVzdWFyaW8gbm8gdsOhbGlkbycsXG4gICAgICAgIHN0YXR1czogNDAzXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIFZlcmlmaWNhciBzaSB0aWVuZSBhY2Nlc28gYWwgcGFuZWwgYWRtaW5cbiAgICBjb25zdCBoYXNBZG1pbkFjY2VzcyA9IGhhc1Blcm1pc3Npb24ocHJvZmlsZSwgWydhZG1pbl9wYW5lbCcsICdhY2Nlc3MnXSk7XG4gICAgXG4gICAgaWYgKCFoYXNBZG1pbkFjY2Vzcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQWNjZXNvIGRlbmVnYWRvIGFsIHBhbmVsIGFkbWluaXN0cmF0aXZvJyxcbiAgICAgICAgc3RhdHVzOiA0MDNcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB1c2VyOiBwcm9maWxlXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBjaGVja0FkbWluQWNjZXNzOicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyxcbiAgICAgIHN0YXR1czogNTAwXG4gICAgfTtcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRlVOQ0lPTkVTIERFIFZFUklGSUNBQ0nDk04gREUgUEVSTUlTT1Ncbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogVmVyaWZpY2Egc2kgdW4gdXN1YXJpbyB0aWVuZSB1biBwZXJtaXNvIGVzcGVjw61maWNvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoYXNQZXJtaXNzaW9uKFxuICB1c2VyUHJvZmlsZTogVXNlclByb2ZpbGUsXG4gIHBlcm1pc3Npb25QYXRoOiBzdHJpbmdbXVxuKTogYm9vbGVhbiB7XG4gIHRyeSB7XG4gICAgaWYgKCF1c2VyUHJvZmlsZS51c2VyX3JvbGVzIHx8ICF1c2VyUHJvZmlsZS51c2VyX3JvbGVzLnBlcm1pc3Npb25zKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgbGV0IGN1cnJlbnQ6IGFueSA9IHVzZXJQcm9maWxlLnVzZXJfcm9sZXMucGVybWlzc2lvbnM7XG4gICAgXG4gICAgZm9yIChjb25zdCBwYXRoIG9mIHBlcm1pc3Npb25QYXRoKSB7XG4gICAgICBpZiAoY3VycmVudFtwYXRoXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnQgPSBjdXJyZW50W3BhdGhdO1xuICAgIH1cblxuICAgIC8vIE1hbmVqYXIgZGlmZXJlbnRlcyB0aXBvcyBkZSB2YWxvcmVzIGRlIHBlcm1pc29zXG4gICAgaWYgKHR5cGVvZiBjdXJyZW50ID09PSAnYm9vbGVhbicpIHtcbiAgICAgIHJldHVybiBjdXJyZW50O1xuICAgIH1cbiAgICBcbiAgICBpZiAodHlwZW9mIGN1cnJlbnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAvLyBQYXJhIHBlcm1pc29zIGNvbW8gXCJvd25cIiwgXCJvd25fbGltaXRlZFwiLCBldGMuXG4gICAgICByZXR1cm4gY3VycmVudCAhPT0gJ2ZhbHNlJztcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgcGVybWlzc2lvbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogVmVyaWZpY2EgbcO6bHRpcGxlcyBwZXJtaXNvc1xuICovXG5leHBvcnQgZnVuY3Rpb24gaGFzQW55UGVybWlzc2lvbihcbiAgdXNlclByb2ZpbGU6IFVzZXJQcm9maWxlLFxuICBwZXJtaXNzaW9uczogc3RyaW5nW11bXVxuKTogYm9vbGVhbiB7XG4gIHJldHVybiBwZXJtaXNzaW9ucy5zb21lKHBlcm1pc3Npb24gPT4gaGFzUGVybWlzc2lvbih1c2VyUHJvZmlsZSwgcGVybWlzc2lvbikpO1xufVxuXG4vKipcbiAqIFZlcmlmaWNhIHRvZG9zIGxvcyBwZXJtaXNvc1xuICovXG5leHBvcnQgZnVuY3Rpb24gaGFzQWxsUGVybWlzc2lvbnMoXG4gIHVzZXJQcm9maWxlOiBVc2VyUHJvZmlsZSxcbiAgcGVybWlzc2lvbnM6IHN0cmluZ1tdW11cbik6IGJvb2xlYW4ge1xuICByZXR1cm4gcGVybWlzc2lvbnMuZXZlcnkocGVybWlzc2lvbiA9PiBoYXNQZXJtaXNzaW9uKHVzZXJQcm9maWxlLCBwZXJtaXNzaW9uKSk7XG59XG5cbi8qKlxuICogVmVyaWZpY2Egc2kgZWwgdXN1YXJpbyBlcyBhZG1pbmlzdHJhZG9yXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0FkbWluKHVzZXJQcm9maWxlOiBVc2VyUHJvZmlsZSk6IGJvb2xlYW4ge1xuICByZXR1cm4gdXNlclByb2ZpbGUudXNlcl9yb2xlcz8ucm9sZV9uYW1lID09PSAnYWRtaW4nO1xufVxuXG4vKipcbiAqIFZlcmlmaWNhIHNpIGVsIHVzdWFyaW8gZXMgbW9kZXJhZG9yIG8gYWRtaW5pc3RyYWRvclxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNNb2RlcmF0b3JPckFkbWluKHVzZXJQcm9maWxlOiBVc2VyUHJvZmlsZSk6IGJvb2xlYW4ge1xuICBjb25zdCByb2xlID0gdXNlclByb2ZpbGUudXNlcl9yb2xlcz8ucm9sZV9uYW1lO1xuICByZXR1cm4gcm9sZSA9PT0gJ2FkbWluJyB8fCByb2xlID09PSAnbW9kZXJhdG9yJztcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1JRERMRVdBUkUgREUgQVVUT1JJWkFDScOTTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBNaWRkbGV3YXJlIHByaW5jaXBhbCBwYXJhIHZlcmlmaWNhciBwZXJtaXNvcyBhZG1pbmlzdHJhdGl2b3NcbiAqIEFjdHVhbGl6YWRvIHBhcmEgdXNhciBtw6l0b2RvcyBvZmljaWFsZXMgZGUgQ2xlcmtcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrQWRtaW5QZXJtaXNzaW9ucyhcbiAgcmVxdWlyZWRQZXJtaXNzaW9ucz86IHN0cmluZ1tdW10sXG4gIHJlcXVlc3Q/OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0XG4pOiBQcm9taXNlPEFkbWluQXV0aFJlc3VsdCAmIHsgc3VwYWJhc2U/OiB0eXBlb2Ygc3VwYWJhc2VBZG1pbiB9PiB7XG4gIHRyeSB7XG4gICAgLy8gMS4gVmVyaWZpY2FyIGF1dGVudGljYWNpw7NuIGNvbiBDbGVyayB1c2FuZG8gbcOpdG9kb3Mgb2ZpY2lhbGVzXG4gICAgbGV0IHVzZXJJZDogc3RyaW5nO1xuICAgIGxldCBzZXNzaW9uSWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgZ2V0VW5pZmllZEF1dGgocmVxdWVzdCk7XG4gICAgICB1c2VySWQgPSBhdXRoUmVzdWx0LnVzZXJJZDtcbiAgICAgIHNlc3Npb25JZCA9IGF1dGhSZXN1bHQuc2Vzc2lvbklkO1xuICAgIH0gY2F0Y2ggKGF1dGhFcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdbQVVUSF0gRXJyb3IgZW4gYXV0ZW50aWNhY2nDs24gdW5pZmljYWRhLCBpbnRlbnRhbmRvIGZhbGxiYWNrJyk7XG4gICAgICBjb25zdCBmYWxsYmFja1Jlc3VsdCA9IGF3YWl0IGdldEF1dGhlbnRpY2F0ZWRVc2VyKHJlcXVlc3QpO1xuICAgICAgaWYgKCFmYWxsYmFja1Jlc3VsdC51c2VySWQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogZmFsbGJhY2tSZXN1bHQuZXJyb3IgfHwgJ05vIGF1dG9yaXphZG8nLFxuICAgICAgICAgIHN0YXR1czogNDAxXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB1c2VySWQgPSBmYWxsYmFja1Jlc3VsdC51c2VySWQ7XG4gICAgICBzZXNzaW9uSWQgPSBmYWxsYmFja1Jlc3VsdC5zZXNzaW9uSWQ7XG4gICAgfVxuXG4gICAgLy8gMi4gVmVyaWZpY2FyIGRpc3BvbmliaWxpZGFkIGRlIFN1cGFiYXNlXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdTZXJ2aWNpbyBhZG1pbmlzdHJhdGl2byBubyBkaXNwb25pYmxlJyxcbiAgICAgICAgc3RhdHVzOiA1MDNcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gMy4gVmVyaWZpY2FyIGFjY2VzbyBhZG1pbmlzdHJhdGl2b1xuICAgIGNvbnN0IGFkbWluQ2hlY2sgPSBhd2FpdCBjaGVja0FkbWluQWNjZXNzKHVzZXJJZCk7XG4gICAgXG4gICAgaWYgKCFhZG1pbkNoZWNrLnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBhZG1pbkNoZWNrO1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXJQcm9maWxlID0gYWRtaW5DaGVjay51c2VyITtcblxuICAgIC8vIDQuIFZlcmlmaWNhciBwZXJtaXNvcyBlc3BlY8OtZmljb3Mgc2kgc2UgcHJvcG9yY2lvbmFuXG4gICAgaWYgKHJlcXVpcmVkUGVybWlzc2lvbnMgJiYgcmVxdWlyZWRQZXJtaXNzaW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBoYXNSZXF1aXJlZFBlcm1pc3Npb25zID0gaGFzQW55UGVybWlzc2lvbih1c2VyUHJvZmlsZSwgcmVxdWlyZWRQZXJtaXNzaW9ucyk7XG4gICAgICBcbiAgICAgIGlmICghaGFzUmVxdWlyZWRQZXJtaXNzaW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnUGVybWlzb3MgaW5zdWZpY2llbnRlcyBwYXJhIGVzdGEgb3BlcmFjacOzbicsXG4gICAgICAgICAgc3RhdHVzOiA0MDNcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyA1LiBSZWdpc3RyYXIgYWNjZXNvIGVuIGF1ZGl0IGxvZyAob3BjaW9uYWwpXG4gICAgYXdhaXQgbG9nQWRtaW5BY2Nlc3ModXNlclByb2ZpbGUuaWQsICdBUElfQUNDRVNTJyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHVzZXI6IHVzZXJQcm9maWxlLFxuICAgICAgc3VwYWJhc2U6IHN1cGFiYXNlQWRtaW5cbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGNoZWNrQWRtaW5QZXJtaXNzaW9uczonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicsXG4gICAgICBzdGF0dXM6IDUwMFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBNaWRkbGV3YXJlIGVzcGVjw61maWNvIHBhcmEgb3BlcmFjaW9uZXMgQ1JVRFxuICogQWN0dWFsaXphZG8gcGFyYSBzb3BvcnRhciB0YW50byBOZXh0UmVxdWVzdCBjb21vIE5leHRBcGlSZXF1ZXN0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0NSVURQZXJtaXNzaW9ucyhcbiAgcmVzb3VyY2U6IHN0cmluZyxcbiAgYWN0aW9uOiAnY3JlYXRlJyB8ICdyZWFkJyB8ICd1cGRhdGUnIHwgJ2RlbGV0ZScsXG4gIHJlcXVlc3Q/OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0XG4pOiBQcm9taXNlPEFkbWluQXV0aFJlc3VsdCAmIHsgc3VwYWJhc2U/OiB0eXBlb2Ygc3VwYWJhc2VBZG1pbiB9PiB7XG4gIGNvbnN0IHJlcXVpcmVkUGVybWlzc2lvbnMgPSBbW3Jlc291cmNlLCBhY3Rpb25dXTtcbiAgcmV0dXJuIGNoZWNrQWRtaW5QZXJtaXNzaW9ucyhyZXF1aXJlZFBlcm1pc3Npb25zLCByZXF1ZXN0KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZVTkNJT05FUyBERSBMT0dHSU5HIFkgQVVESVRPUsONQVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBSZWdpc3RyYSBhY2Nlc28gYWRtaW5pc3RyYXRpdm8gZW4gZWwgYXVkaXQgbG9nXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dBZG1pbkFjY2VzcyhcbiAgdXNlclByb2ZpbGVJZDogc3RyaW5nLFxuICBhY3Rpb246IHN0cmluZyxcbiAgcmVzb3VyY2VUeXBlPzogc3RyaW5nLFxuICByZXNvdXJjZUlkPzogc3RyaW5nLFxuICBhZGRpdGlvbmFsRGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbik6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGlmICghc3VwYWJhc2VBZG1pbikgcmV0dXJuO1xuXG4gICAgYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oJ2FkbWluX2F1ZGl0X2xvZycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgdXNlcl9pZDogdXNlclByb2ZpbGVJZCxcbiAgICAgICAgYWN0aW9uLFxuICAgICAgICByZXNvdXJjZV90eXBlOiByZXNvdXJjZVR5cGUgfHwgJ3N5c3RlbScsXG4gICAgICAgIHJlc291cmNlX2lkOiByZXNvdXJjZUlkLFxuICAgICAgICBuZXdfdmFsdWVzOiBhZGRpdGlvbmFsRGF0YSA/IEpTT04uc3RyaW5naWZ5KGFkZGl0aW9uYWxEYXRhKSA6IG51bGxcbiAgICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvZ2dpbmcgYWRtaW4gYWNjZXNzOicsIGVycm9yKTtcbiAgICAvLyBObyBsYW56YXIgZXJyb3IgcGFyYSBubyBpbnRlcnJ1bXBpciBlbCBmbHVqbyBwcmluY2lwYWxcbiAgfVxufVxuXG4vKipcbiAqIFJlZ2lzdHJhIGNhbWJpb3MgZW4gcmVjdXJzb3MgYWRtaW5pc3RyYXRpdm9zXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dBZG1pbkFjdGlvbihcbiAgdXNlclByb2ZpbGVJZDogc3RyaW5nLFxuICBhY3Rpb246IHN0cmluZyxcbiAgcmVzb3VyY2VUeXBlOiBzdHJpbmcsXG4gIHJlc291cmNlSWQ6IHN0cmluZyxcbiAgb2xkVmFsdWVzPzogYW55LFxuICBuZXdWYWx1ZXM/OiBhbnlcbik6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGlmICghc3VwYWJhc2VBZG1pbikgcmV0dXJuO1xuXG4gICAgYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oJ2FkbWluX2F1ZGl0X2xvZycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgdXNlcl9pZDogdXNlclByb2ZpbGVJZCxcbiAgICAgICAgYWN0aW9uLFxuICAgICAgICByZXNvdXJjZV90eXBlOiByZXNvdXJjZVR5cGUsXG4gICAgICAgIHJlc291cmNlX2lkOiByZXNvdXJjZUlkLFxuICAgICAgICBvbGRfdmFsdWVzOiBvbGRWYWx1ZXMgPyBKU09OLnN0cmluZ2lmeShvbGRWYWx1ZXMpIDogbnVsbCxcbiAgICAgICAgbmV3X3ZhbHVlczogbmV3VmFsdWVzID8gSlNPTi5zdHJpbmdpZnkobmV3VmFsdWVzKSA6IG51bGxcbiAgICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvZ2dpbmcgYWRtaW4gYWN0aW9uOicsIGVycm9yKTtcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVVRJTElEQURFUyBQQVJBIE5FWFQuSlMgQVBJIFJPVVRFU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBXcmFwcGVyIHBhcmEgQVBJIHJvdXRlcyBxdWUgcmVxdWllcmVuIGF1dGVudGljYWNpw7NuIGFkbWluIChBcHAgUm91dGVyKVxuICovXG5leHBvcnQgZnVuY3Rpb24gd2l0aEFkbWluQXV0aChcbiAgaGFuZGxlcjogKFxuICAgIHJlcXVlc3Q6IE5leHRSZXF1ZXN0LFxuICAgIGNvbnRleHQ6IHsgdXNlcjogVXNlclByb2ZpbGU7IHN1cGFiYXNlOiB0eXBlb2Ygc3VwYWJhc2VBZG1pbiB9XG4gICkgPT4gUHJvbWlzZTxSZXNwb25zZT4sXG4gIHJlcXVpcmVkUGVybWlzc2lvbnM/OiBzdHJpbmdbXVtdXG4pIHtcbiAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0OiBOZXh0UmVxdWVzdCk6IFByb21pc2U8UmVzcG9uc2U+ID0+IHtcbiAgICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgY2hlY2tBZG1pblBlcm1pc3Npb25zKHJlcXVpcmVkUGVybWlzc2lvbnMsIHJlcXVlc3QpO1xuXG4gICAgaWYgKCFhdXRoUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogYXV0aFJlc3VsdC5lcnJvclxuICAgICAgICB9KSxcbiAgICAgICAge1xuICAgICAgICAgIHN0YXR1czogYXV0aFJlc3VsdC5zdGF0dXMgfHwgNTAwLFxuICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGhhbmRsZXIocmVxdWVzdCwge1xuICAgICAgdXNlcjogYXV0aFJlc3VsdC51c2VyISxcbiAgICAgIHN1cGFiYXNlOiBhdXRoUmVzdWx0LnN1cGFiYXNlIVxuICAgIH0pO1xuICB9O1xufVxuXG4vKipcbiAqIFdyYXBwZXIgcGFyYSBQYWdlcyBSb3V0ZXIgQVBJIFJvdXRlcyBxdWUgcmVxdWllcmVuIGF1dGVudGljYWNpw7NuIGFkbWluXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoQWRtaW5BdXRoUGFnZXMoXG4gIGhhbmRsZXI6IChcbiAgICByZXE6IE5leHRBcGlSZXF1ZXN0LFxuICAgIHJlczogTmV4dEFwaVJlc3BvbnNlLFxuICAgIGNvbnRleHQ6IHsgdXNlcjogVXNlclByb2ZpbGU7IHN1cGFiYXNlOiB0eXBlb2Ygc3VwYWJhc2VBZG1pbiB9XG4gICkgPT4gUHJvbWlzZTx2b2lkPixcbiAgcmVxdWlyZWRQZXJtaXNzaW9ucz86IHN0cmluZ1tdW11cbikge1xuICByZXR1cm4gYXN5bmMgKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgY29uc3QgYXV0aFJlc3VsdCA9IGF3YWl0IGNoZWNrQWRtaW5QZXJtaXNzaW9ucyhyZXF1aXJlZFBlcm1pc3Npb25zLCByZXEpO1xuXG4gICAgaWYgKCFhdXRoUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKGF1dGhSZXN1bHQuc3RhdHVzIHx8IDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogYXV0aFJlc3VsdC5lcnJvclxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGhhbmRsZXIocmVxLCByZXMsIHtcbiAgICAgIHVzZXI6IGF1dGhSZXN1bHQudXNlciEsXG4gICAgICBzdXBhYmFzZTogYXV0aFJlc3VsdC5zdXBhYmFzZSFcbiAgICB9KTtcbiAgfTtcbn1cblxuLyoqXG4gKiBFeHRyYWUgaW5mb3JtYWNpw7NuIGRlIGxhIHJlcXVlc3QgcGFyYSBsb2dnaW5nXG4gKiBTb3BvcnRhIHRhbnRvIE5leHRSZXF1ZXN0IGNvbW8gTmV4dEFwaVJlcXVlc3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFJlcXVlc3RJbmZvKHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QpIHtcbiAgaWYgKCdxdWVyeScgaW4gcmVxdWVzdCkge1xuICAgIC8vIE5leHRBcGlSZXF1ZXN0IChQYWdlcyBSb3V0ZXIpXG4gICAgY29uc3QgcmVxID0gcmVxdWVzdCBhcyBOZXh0QXBpUmVxdWVzdDtcbiAgICByZXR1cm4ge1xuICAgICAgbWV0aG9kOiByZXEubWV0aG9kIHx8ICdHRVQnLFxuICAgICAgdXJsOiByZXEudXJsIHx8ICd1bmtub3duJyxcbiAgICAgIHVzZXJBZ2VudDogcmVxLmhlYWRlcnNbJ3VzZXItYWdlbnQnXSB8fCAndW5rbm93bicsXG4gICAgICBpcDogcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddIHx8XG4gICAgICAgICAgcmVxLmhlYWRlcnNbJ3gtcmVhbC1pcCddIHx8XG4gICAgICAgICAgcmVxLmNvbm5lY3Rpb24/LnJlbW90ZUFkZHJlc3MgfHxcbiAgICAgICAgICAndW5rbm93bidcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIC8vIE5leHRSZXF1ZXN0IChBcHAgUm91dGVyKVxuICAgIGNvbnN0IHJlcSA9IHJlcXVlc3QgYXMgTmV4dFJlcXVlc3Q7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcbiAgICAgIHVybDogcmVxLnVybCxcbiAgICAgIHVzZXJBZ2VudDogcmVxLmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JykgfHwgJ3Vua25vd24nLFxuICAgICAgaXA6IHJlcS5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtZm9yJykgfHxcbiAgICAgICAgICByZXEuaGVhZGVycy5nZXQoJ3gtcmVhbC1pcCcpIHx8XG4gICAgICAgICAgJ3Vua25vd24nXG4gICAgfTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImNoZWNrQWRtaW5BY2Nlc3MiLCJjaGVja0FkbWluUGVybWlzc2lvbnMiLCJjaGVja0NSVURQZXJtaXNzaW9ucyIsImdldEF1dGhGcm9tQXBpUm91dGUiLCJnZXRBdXRoRnJvbVJvdXRlSGFuZGxlciIsImdldEF1dGhlbnRpY2F0ZWRVc2VyIiwiZ2V0UmVxdWVzdEluZm8iLCJnZXRVbmlmaWVkQXV0aCIsImdldFVzZXJQcm9maWxlIiwiaGFzQWxsUGVybWlzc2lvbnMiLCJoYXNBbnlQZXJtaXNzaW9uIiwiaGFzUGVybWlzc2lvbiIsImlzQWRtaW4iLCJpc01vZGVyYXRvck9yQWRtaW4iLCJsb2dBZG1pbkFjY2VzcyIsImxvZ0FkbWluQWN0aW9uIiwid2l0aEFkbWluQXV0aCIsIndpdGhBZG1pbkF1dGhQYWdlcyIsInJlcXVlc3QiLCJ1c2VySWQiLCJzZXNzaW9uSWQiLCJnZXRBdXRoIiwiY29uc29sZSIsImxvZyIsImF1dGgiLCJhdXRoRXJyb3IiLCJ3YXJuIiwiY2xlcmtVc2VySWQiLCJoZWFkZXJzIiwiZ2V0Iiwic2Vzc2lvblRva2VuIiwiY29va2llcyIsInZhbHVlIiwicGF5bG9hZCIsIkpTT04iLCJwYXJzZSIsImF0b2IiLCJzcGxpdCIsInN1YiIsImp3dEVycm9yIiwiZXJyb3IiLCJyZXEiLCJyZXMiLCJnZXRUb2tlbiIsIkVycm9yIiwiYXBpRXJyb3IiLCJyb3V0ZUVycm9yIiwic3VwYWJhc2VBZG1pbiIsImRhdGEiLCJwcm9maWxlIiwicHJvZmlsZUVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwicm9sZSIsInJvbGVFcnJvciIsInJvbGVfaWQiLCJ1c2VyUHJvZmlsZSIsInVzZXJfcm9sZXMiLCJzdWNjZXNzIiwic3RhdHVzIiwiaXNfYWN0aXZlIiwiaGFzQWRtaW5BY2Nlc3MiLCJ1c2VyIiwicGVybWlzc2lvblBhdGgiLCJwZXJtaXNzaW9ucyIsImN1cnJlbnQiLCJwYXRoIiwidW5kZWZpbmVkIiwic29tZSIsInBlcm1pc3Npb24iLCJldmVyeSIsInJvbGVfbmFtZSIsInJlcXVpcmVkUGVybWlzc2lvbnMiLCJhdXRoUmVzdWx0IiwiZmFsbGJhY2tSZXN1bHQiLCJhZG1pbkNoZWNrIiwibGVuZ3RoIiwiaGFzUmVxdWlyZWRQZXJtaXNzaW9ucyIsImlkIiwic3VwYWJhc2UiLCJyZXNvdXJjZSIsImFjdGlvbiIsInVzZXJQcm9maWxlSWQiLCJyZXNvdXJjZVR5cGUiLCJyZXNvdXJjZUlkIiwiYWRkaXRpb25hbERhdGEiLCJpbnNlcnQiLCJ1c2VyX2lkIiwicmVzb3VyY2VfdHlwZSIsInJlc291cmNlX2lkIiwibmV3X3ZhbHVlcyIsInN0cmluZ2lmeSIsIm9sZFZhbHVlcyIsIm5ld1ZhbHVlcyIsIm9sZF92YWx1ZXMiLCJoYW5kbGVyIiwiUmVzcG9uc2UiLCJqc29uIiwibWV0aG9kIiwidXJsIiwidXNlckFnZW50IiwiaXAiLCJjb25uZWN0aW9uIiwicmVtb3RlQWRkcmVzcyJdLCJtYXBwaW5ncyI6IkFBQUE7OztDQUdDOzs7Ozs7Ozs7OztJQTJPcUJBLGdCQUFnQjtlQUFoQkE7O0lBa0lBQyxxQkFBcUI7ZUFBckJBOztJQWdGQUMsb0JBQW9CO2VBQXBCQTs7SUF2VU5DLG1CQUFtQjtlQUFuQkE7O0lBZU1DLHVCQUF1QjtlQUF2QkE7O0lBbEZBQyxvQkFBb0I7ZUFBcEJBOztJQXFoQk5DLGNBQWM7ZUFBZEE7O0lBcGJNQyxjQUFjO2VBQWRBOztJQW9DQUMsY0FBYztlQUFkQTs7SUF1Sk5DLGlCQUFpQjtlQUFqQkE7O0lBVkFDLGdCQUFnQjtlQUFoQkE7O0lBdENBQyxhQUFhO2VBQWJBOztJQTBEQUMsT0FBTztlQUFQQTs7SUFPQUMsa0JBQWtCO2VBQWxCQTs7SUE2R01DLGNBQWM7ZUFBZEE7O0lBNEJBQyxjQUFjO2VBQWRBOztJQWlDTkMsYUFBYTtlQUFiQTs7SUFpQ0FDLGtCQUFrQjtlQUFsQkE7Ozt3QkF6aUIyQjswQkFDYjtBQWdEdkIsZUFBZVoscUJBQ3BCYSxPQUFzQztJQUV0QyxJQUFJO1FBQ0Ysc0VBQXNFO1FBQ3RFLElBQUlBLFdBQVcsV0FBV0EsU0FBUztZQUNqQyxtQ0FBbUM7WUFDbkMsTUFBTSxFQUFFQyxNQUFNLEVBQUVDLFNBQVMsRUFBRSxHQUFHQyxJQUFBQSxlQUFPLEVBQUNIO1lBQ3RDLElBQUlDLFFBQVE7Z0JBQ1ZHLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLHdDQUF3QyxFQUFF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