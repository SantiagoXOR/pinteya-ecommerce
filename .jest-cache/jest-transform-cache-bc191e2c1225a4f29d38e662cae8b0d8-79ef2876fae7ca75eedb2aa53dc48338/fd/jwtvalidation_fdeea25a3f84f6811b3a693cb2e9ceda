cb3716f45f430f35ed165108fd08a21b
/**
 * Validaciones Avanzadas de JWT para Seguridad
 * Implementa verificación de integridad, autenticidad y validez de tokens
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get validateJWTIntegrity () {
        return validateJWTIntegrity;
    },
    get validateJWTPermissions () {
        return validateJWTPermissions;
    },
    get withJWTValidation () {
        return withJWTValidation;
    }
});
const _auth = require("../../auth");
// =====================================================
// CONFIGURACIÓN DE SEGURIDAD
// =====================================================
const JWT_SECURITY_CONFIG = {
    // Tiempo máximo de vida del token (24 horas)
    maxTokenAge: 24 * 60 * 60 * 1000,
    // Tiempo mínimo antes de expiración para considerar válido (5 minutos)
    minTimeBeforeExpiry: 5 * 60 * 1000,
    // Issuer esperado de Clerk
    expectedIssuer: process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY?.split('_')[1] || 'clerk',
    // Audience esperada
    expectedAudience: process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY || '',
    // Algoritmos permitidos
    allowedAlgorithms: [
        'RS256',
        'HS256'
    ],
    // Claims requeridos
    requiredClaims: [
        'sub',
        'iat',
        'exp',
        'iss',
        'aud'
    ]
};
async function validateJWTIntegrity(request) {
    try {
        let token = null;
        let payload = null;
        // NextAuth.js - Obtener sesión en lugar de token JWT
        if (request && 'query' in request) {
            // Pages Router - No soportado con NextAuth.js
            return {
                valid: false,
                error: 'Pages Router no soportado con NextAuth.js',
                code: 'NOT_SUPPORTED',
                severity: 'medium'
            };
        } else {
            // App Router - NextAuth.js
            try {
                const session = await (0, _auth.auth)();
                if (!session?.user) {
                    return {
                        valid: false,
                        error: 'Usuario no autenticado',
                        code: 'NOT_AUTHENTICATED',
                        severity: 'medium'
                    };
                }
                // Para NextAuth.js, consideramos válida la sesión si existe
                return {
                    valid: true,
                    payload: {
                        userId: session.user.id,
                        email: session.user.email,
                        name: session.user.name
                    },
                    claims: {
                        sub: session.user.id,
                        email: session.user.email
                    }
                };
            } catch (error) {
                return {
                    valid: false,
                    error: 'Error obteniendo sesión desde NextAuth.js',
                    code: 'SESSION_RETRIEVAL_ERROR',
                    severity: 'medium'
                };
            }
        }
        if (!token) {
            return {
                valid: false,
                error: 'Token JWT no encontrado',
                code: 'TOKEN_NOT_FOUND',
                severity: 'high'
            };
        }
        // Decodificar token (sin verificar firma - solo para inspección)
        try {
            const parts = token.split('.');
            if (parts.length !== 3) {
                return {
                    valid: false,
                    error: 'Formato de token JWT inválido',
                    code: 'INVALID_TOKEN_FORMAT',
                    severity: 'high'
                };
            }
            const header = JSON.parse(atob(parts[0]));
            payload = JSON.parse(atob(parts[1]));
            // Validar algoritmo
            if (!JWT_SECURITY_CONFIG.allowedAlgorithms.includes(header.alg)) {
                return {
                    valid: false,
                    error: `Algoritmo de token no permitido: ${header.alg}`,
                    code: 'INVALID_ALGORITHM',
                    severity: 'critical'
                };
            }
        } catch (decodeError) {
            return {
                valid: false,
                error: 'Error decodificando token JWT',
                code: 'TOKEN_DECODE_ERROR',
                severity: 'high'
            };
        }
        // Ejecutar verificaciones de seguridad
        const securityChecks = await performTokenSecurityChecks(payload, token);
        if (!securityChecks.signatureValid) {
            return {
                valid: false,
                error: 'Firma del token inválida',
                code: 'INVALID_SIGNATURE',
                severity: 'critical'
            };
        }
        if (!securityChecks.notExpired) {
            return {
                valid: false,
                error: 'Token expirado',
                code: 'TOKEN_EXPIRED',
                severity: 'high'
            };
        }
        if (!securityChecks.issuerValid) {
            return {
                valid: false,
                error: 'Issuer del token inválido',
                code: 'INVALID_ISSUER',
                severity: 'high'
            };
        }
        // Token válido
        return {
            valid: true,
            payload,
            details: {
                issuer: payload.iss,
                audience: payload.aud,
                expiresAt: payload.exp,
                issuedAt: payload.iat,
                notBefore: payload.nbf,
                subject: payload.sub,
                sessionId: payload.sid,
                metadata: payload.metadata
            }
        };
    } catch (error) {
        console.error('[JWT] Error en validación de integridad:', error);
        return {
            valid: false,
            error: 'Error interno en validación de JWT',
            code: 'VALIDATION_ERROR',
            severity: 'critical'
        };
    }
}
/**
 * Realiza verificaciones de seguridad específicas del token
 */ async function performTokenSecurityChecks(payload, token) {
    const now = Math.floor(Date.now() / 1000);
    return {
        // Verificar que el token no esté expirado
        notExpired: payload.exp && payload.exp > now,
        // Verificar notBefore si existe
        notBeforeValid: !payload.nbf || payload.nbf <= now,
        // Verificar issuer
        issuerValid: payload.iss && payload.iss.includes('clerk'),
        // Verificar audience
        audienceValid: payload.aud && typeof payload.aud === 'string',
        // Verificar subject (userId)
        subjectValid: payload.sub && typeof payload.sub === 'string',
        // Verificar metadata básica
        metadataValid: true,
        // Verificar sesión
        sessionValid: payload.sid && typeof payload.sid === 'string',
        // Nota: La verificación de firma la hace Clerk internamente
        signatureValid: true
    };
}
async function validateJWTPermissions(requiredRole, requiredPermissions = [], request) {
    try {
        const jwtValidation = await validateJWTIntegrity(request);
        if (!jwtValidation.valid) {
            return jwtValidation;
        }
        const payload = jwtValidation.payload;
        // Verificar rol en metadata
        const userRole = payload.metadata?.role || payload.role;
        if (requiredRole && userRole !== requiredRole) {
            return {
                valid: false,
                error: `Rol requerido: ${requiredRole}, rol actual: ${userRole}`,
                code: 'INSUFFICIENT_ROLE',
                severity: 'high'
            };
        }
        // Verificar permisos específicos si se proporcionan
        if (requiredPermissions.length > 0) {
            const userPermissions = payload.metadata?.permissions || [];
            const hasAllPermissions = requiredPermissions.every((permission)=>userPermissions.includes(permission));
            if (!hasAllPermissions) {
                return {
                    valid: false,
                    error: `Permisos insuficientes. Requeridos: ${requiredPermissions.join(', ')}`,
                    code: 'INSUFFICIENT_PERMISSIONS',
                    severity: 'high'
                };
            }
        }
        return {
            valid: true,
            payload,
            details: jwtValidation.details
        };
    } catch (error) {
        console.error('[JWT] Error en validación de permisos:', error);
        return {
            valid: false,
            error: 'Error interno en validación de permisos JWT',
            code: 'PERMISSION_VALIDATION_ERROR',
            severity: 'critical'
        };
    }
}
function withJWTValidation(requiredRole, requiredPermissions) {
    return function(handler) {
        return async (request, ...args)=>{
            try {
                // Validar integridad del JWT
                const jwtValidation = await validateJWTIntegrity(request);
                if (!jwtValidation.valid) {
                    const errorResponse = {
                        success: false,
                        error: jwtValidation.error,
                        code: jwtValidation.code,
                        severity: jwtValidation.severity
                    };
                    if ('query' in request) {
                        // Pages Router
                        const res = args[0];
                        return res.status(401).json(errorResponse);
                    } else {
                        // App Router
                        return new Response(JSON.stringify(errorResponse), {
                            status: 401,
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });
                    }
                }
                // Validar permisos si se especifican
                if (requiredRole || requiredPermissions) {
                    const permissionValidation = await validateJWTPermissions(requiredRole || '', requiredPermissions || [], request);
                    if (!permissionValidation.valid) {
                        const errorResponse = {
                            success: false,
                            error: permissionValidation.error,
                            code: permissionValidation.code,
                            severity: permissionValidation.severity
                        };
                        if ('query' in request) {
                            // Pages Router
                            const res = args[0];
                            return res.status(403).json(errorResponse);
                        } else {
                            // App Router
                            return new Response(JSON.stringify(errorResponse), {
                                status: 403,
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            });
                        }
                    }
                }
                // Añadir información del JWT al request
                request.jwtPayload = jwtValidation.payload;
                request.jwtDetails = jwtValidation.details;
                return handler(request, ...args);
            } catch (error) {
                console.error('[JWT] Error en middleware de validación:', error);
                const errorResponse = {
                    success: false,
                    error: 'Error interno en validación JWT',
                    code: 'JWT_MIDDLEWARE_ERROR'
                };
                if ('query' in request) {
                    // Pages Router
                    const res = args[0];
                    return res.status(500).json(errorResponse);
                } else {
                    // App Router
                    return new Response(JSON.stringify(errorResponse), {
                        status: 500,
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                }
            }
        };
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhdXRoXFxqd3QtdmFsaWRhdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFZhbGlkYWNpb25lcyBBdmFuemFkYXMgZGUgSldUIHBhcmEgU2VndXJpZGFkXG4gKiBJbXBsZW1lbnRhIHZlcmlmaWNhY2nDs24gZGUgaW50ZWdyaWRhZCwgYXV0ZW50aWNpZGFkIHkgdmFsaWRleiBkZSB0b2tlbnNcbiAqL1xuXG5pbXBvcnQgeyBhdXRoIH0gZnJvbSAnQC9hdXRoJztcbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCB9IGZyb20gJ25leHQnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVElQT1MgWSBJTlRFUkZBQ0VTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIEpXVFZhbGlkYXRpb25SZXN1bHQge1xuICB2YWxpZDogYm9vbGVhbjtcbiAgcGF5bG9hZD86IGFueTtcbiAgZXJyb3I/OiBzdHJpbmc7XG4gIGNvZGU/OiBzdHJpbmc7XG4gIHNldmVyaXR5PzogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCc7XG4gIGRldGFpbHM/OiB7XG4gICAgaXNzdWVyPzogc3RyaW5nO1xuICAgIGF1ZGllbmNlPzogc3RyaW5nO1xuICAgIGV4cGlyZXNBdD86IG51bWJlcjtcbiAgICBpc3N1ZWRBdD86IG51bWJlcjtcbiAgICBub3RCZWZvcmU/OiBudW1iZXI7XG4gICAgc3ViamVjdD86IHN0cmluZztcbiAgICBzZXNzaW9uSWQ/OiBzdHJpbmc7XG4gICAgbWV0YWRhdGE/OiBhbnk7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9rZW5TZWN1cml0eUNoZWNrcyB7XG4gIHNpZ25hdHVyZVZhbGlkOiBib29sZWFuO1xuICBub3RFeHBpcmVkOiBib29sZWFuO1xuICBub3RCZWZvcmVWYWxpZDogYm9vbGVhbjtcbiAgaXNzdWVyVmFsaWQ6IGJvb2xlYW47XG4gIGF1ZGllbmNlVmFsaWQ6IGJvb2xlYW47XG4gIHN1YmplY3RWYWxpZDogYm9vbGVhbjtcbiAgbWV0YWRhdGFWYWxpZDogYm9vbGVhbjtcbiAgc2Vzc2lvblZhbGlkOiBib29sZWFuO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09ORklHVVJBQ0nDk04gREUgU0VHVVJJREFEXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBKV1RfU0VDVVJJVFlfQ09ORklHID0ge1xuICAvLyBUaWVtcG8gbcOheGltbyBkZSB2aWRhIGRlbCB0b2tlbiAoMjQgaG9yYXMpXG4gIG1heFRva2VuQWdlOiAyNCAqIDYwICogNjAgKiAxMDAwLFxuICBcbiAgLy8gVGllbXBvIG3DrW5pbW8gYW50ZXMgZGUgZXhwaXJhY2nDs24gcGFyYSBjb25zaWRlcmFyIHbDoWxpZG8gKDUgbWludXRvcylcbiAgbWluVGltZUJlZm9yZUV4cGlyeTogNSAqIDYwICogMTAwMCxcbiAgXG4gIC8vIElzc3VlciBlc3BlcmFkbyBkZSBDbGVya1xuICBleHBlY3RlZElzc3VlcjogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQ0xFUktfUFVCTElTSEFCTEVfS0VZPy5zcGxpdCgnXycpWzFdIHx8ICdjbGVyaycsXG4gIFxuICAvLyBBdWRpZW5jZSBlc3BlcmFkYVxuICBleHBlY3RlZEF1ZGllbmNlOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19DTEVSS19QVUJMSVNIQUJMRV9LRVkgfHwgJycsXG4gIFxuICAvLyBBbGdvcml0bW9zIHBlcm1pdGlkb3NcbiAgYWxsb3dlZEFsZ29yaXRobXM6IFsnUlMyNTYnLCAnSFMyNTYnXSxcbiAgXG4gIC8vIENsYWltcyByZXF1ZXJpZG9zXG4gIHJlcXVpcmVkQ2xhaW1zOiBbJ3N1YicsICdpYXQnLCAnZXhwJywgJ2lzcycsICdhdWQnXVxufTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZVTkNJT05FUyBERSBWQUxJREFDScOTTiBERSBKV1Rcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogVmFsaWRhIGxhIGludGVncmlkYWQgeSBhdXRlbnRpY2lkYWQgZGUgdW4gdG9rZW4gSldUXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUpXVEludGVncml0eShcbiAgcmVxdWVzdD86IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3Rcbik6IFByb21pc2U8SldUVmFsaWRhdGlvblJlc3VsdD4ge1xuICB0cnkge1xuICAgIGxldCB0b2tlbjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgbGV0IHBheWxvYWQ6IGFueSA9IG51bGw7XG5cbiAgICAvLyBOZXh0QXV0aC5qcyAtIE9idGVuZXIgc2VzacOzbiBlbiBsdWdhciBkZSB0b2tlbiBKV1RcbiAgICBpZiAocmVxdWVzdCAmJiAncXVlcnknIGluIHJlcXVlc3QpIHtcbiAgICAgIC8vIFBhZ2VzIFJvdXRlciAtIE5vIHNvcG9ydGFkbyBjb24gTmV4dEF1dGguanNcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdQYWdlcyBSb3V0ZXIgbm8gc29wb3J0YWRvIGNvbiBOZXh0QXV0aC5qcycsXG4gICAgICAgIGNvZGU6ICdOT1RfU1VQUE9SVEVEJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdtZWRpdW0nXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBBcHAgUm91dGVyIC0gTmV4dEF1dGguanNcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKCk7XG4gICAgICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogJ1VzdWFyaW8gbm8gYXV0ZW50aWNhZG8nLFxuICAgICAgICAgICAgY29kZTogJ05PVF9BVVRIRU5USUNBVEVEJyxcbiAgICAgICAgICAgIHNldmVyaXR5OiAnbWVkaXVtJ1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgLy8gUGFyYSBOZXh0QXV0aC5qcywgY29uc2lkZXJhbW9zIHbDoWxpZGEgbGEgc2VzacOzbiBzaSBleGlzdGVcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgICBwYXlsb2FkOiB7XG4gICAgICAgICAgICB1c2VySWQ6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgIGVtYWlsOiBzZXNzaW9uLnVzZXIuZW1haWwsXG4gICAgICAgICAgICBuYW1lOiBzZXNzaW9uLnVzZXIubmFtZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2xhaW1zOiB7XG4gICAgICAgICAgICBzdWI6IHNlc3Npb24udXNlci5pZCxcbiAgICAgICAgICAgIGVtYWlsOiBzZXNzaW9uLnVzZXIuZW1haWxcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ0Vycm9yIG9idGVuaWVuZG8gc2VzacOzbiBkZXNkZSBOZXh0QXV0aC5qcycsXG4gICAgICAgICAgY29kZTogJ1NFU1NJT05fUkVUUklFVkFMX0VSUk9SJyxcbiAgICAgICAgICBzZXZlcml0eTogJ21lZGl1bSdcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnVG9rZW4gSldUIG5vIGVuY29udHJhZG8nLFxuICAgICAgICBjb2RlOiAnVE9LRU5fTk9UX0ZPVU5EJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBEZWNvZGlmaWNhciB0b2tlbiAoc2luIHZlcmlmaWNhciBmaXJtYSAtIHNvbG8gcGFyYSBpbnNwZWNjacOzbilcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGFydHMgPSB0b2tlbi5zcGxpdCgnLicpO1xuICAgICAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ0Zvcm1hdG8gZGUgdG9rZW4gSldUIGludsOhbGlkbycsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfVE9LRU5fRk9STUFUJyxcbiAgICAgICAgICBzZXZlcml0eTogJ2hpZ2gnXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGhlYWRlciA9IEpTT04ucGFyc2UoYXRvYihwYXJ0c1swXSkpO1xuICAgICAgcGF5bG9hZCA9IEpTT04ucGFyc2UoYXRvYihwYXJ0c1sxXSkpO1xuXG4gICAgICAvLyBWYWxpZGFyIGFsZ29yaXRtb1xuICAgICAgaWYgKCFKV1RfU0VDVVJJVFlfQ09ORklHLmFsbG93ZWRBbGdvcml0aG1zLmluY2x1ZGVzKGhlYWRlci5hbGcpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiBgQWxnb3JpdG1vIGRlIHRva2VuIG5vIHBlcm1pdGlkbzogJHtoZWFkZXIuYWxnfWAsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfQUxHT1JJVEhNJyxcbiAgICAgICAgICBzZXZlcml0eTogJ2NyaXRpY2FsJ1xuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgfSBjYXRjaCAoZGVjb2RlRXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdFcnJvciBkZWNvZGlmaWNhbmRvIHRva2VuIEpXVCcsXG4gICAgICAgIGNvZGU6ICdUT0tFTl9ERUNPREVfRVJST1InLFxuICAgICAgICBzZXZlcml0eTogJ2hpZ2gnXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIEVqZWN1dGFyIHZlcmlmaWNhY2lvbmVzIGRlIHNlZ3VyaWRhZFxuICAgIGNvbnN0IHNlY3VyaXR5Q2hlY2tzID0gYXdhaXQgcGVyZm9ybVRva2VuU2VjdXJpdHlDaGVja3MocGF5bG9hZCwgdG9rZW4pO1xuICAgIFxuICAgIGlmICghc2VjdXJpdHlDaGVja3Muc2lnbmF0dXJlVmFsaWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdGaXJtYSBkZWwgdG9rZW4gaW52w6FsaWRhJyxcbiAgICAgICAgY29kZTogJ0lOVkFMSURfU0lHTkFUVVJFJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdjcml0aWNhbCdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKCFzZWN1cml0eUNoZWNrcy5ub3RFeHBpcmVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnVG9rZW4gZXhwaXJhZG8nLFxuICAgICAgICBjb2RlOiAnVE9LRU5fRVhQSVJFRCcsXG4gICAgICAgIHNldmVyaXR5OiAnaGlnaCdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKCFzZWN1cml0eUNoZWNrcy5pc3N1ZXJWYWxpZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ0lzc3VlciBkZWwgdG9rZW4gaW52w6FsaWRvJyxcbiAgICAgICAgY29kZTogJ0lOVkFMSURfSVNTVUVSJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBUb2tlbiB2w6FsaWRvXG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgaXNzdWVyOiBwYXlsb2FkLmlzcyxcbiAgICAgICAgYXVkaWVuY2U6IHBheWxvYWQuYXVkLFxuICAgICAgICBleHBpcmVzQXQ6IHBheWxvYWQuZXhwLFxuICAgICAgICBpc3N1ZWRBdDogcGF5bG9hZC5pYXQsXG4gICAgICAgIG5vdEJlZm9yZTogcGF5bG9hZC5uYmYsXG4gICAgICAgIHN1YmplY3Q6IHBheWxvYWQuc3ViLFxuICAgICAgICBzZXNzaW9uSWQ6IHBheWxvYWQuc2lkLFxuICAgICAgICBtZXRhZGF0YTogcGF5bG9hZC5tZXRhZGF0YVxuICAgICAgfVxuICAgIH07XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbSldUXSBFcnJvciBlbiB2YWxpZGFjacOzbiBkZSBpbnRlZ3JpZGFkOicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGVuIHZhbGlkYWNpw7NuIGRlIEpXVCcsXG4gICAgICBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsXG4gICAgICBzZXZlcml0eTogJ2NyaXRpY2FsJ1xuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBSZWFsaXphIHZlcmlmaWNhY2lvbmVzIGRlIHNlZ3VyaWRhZCBlc3BlY8OtZmljYXMgZGVsIHRva2VuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1Ub2tlblNlY3VyaXR5Q2hlY2tzKFxuICBwYXlsb2FkOiBhbnksXG4gIHRva2VuOiBzdHJpbmdcbik6IFByb21pc2U8VG9rZW5TZWN1cml0eUNoZWNrcz4ge1xuICBjb25zdCBub3cgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTtcblxuICByZXR1cm4ge1xuICAgIC8vIFZlcmlmaWNhciBxdWUgZWwgdG9rZW4gbm8gZXN0w6kgZXhwaXJhZG9cbiAgICBub3RFeHBpcmVkOiBwYXlsb2FkLmV4cCAmJiBwYXlsb2FkLmV4cCA+IG5vdyxcbiAgICBcbiAgICAvLyBWZXJpZmljYXIgbm90QmVmb3JlIHNpIGV4aXN0ZVxuICAgIG5vdEJlZm9yZVZhbGlkOiAhcGF5bG9hZC5uYmYgfHwgcGF5bG9hZC5uYmYgPD0gbm93LFxuICAgIFxuICAgIC8vIFZlcmlmaWNhciBpc3N1ZXJcbiAgICBpc3N1ZXJWYWxpZDogcGF5bG9hZC5pc3MgJiYgcGF5bG9hZC5pc3MuaW5jbHVkZXMoJ2NsZXJrJyksXG4gICAgXG4gICAgLy8gVmVyaWZpY2FyIGF1ZGllbmNlXG4gICAgYXVkaWVuY2VWYWxpZDogcGF5bG9hZC5hdWQgJiYgdHlwZW9mIHBheWxvYWQuYXVkID09PSAnc3RyaW5nJyxcbiAgICBcbiAgICAvLyBWZXJpZmljYXIgc3ViamVjdCAodXNlcklkKVxuICAgIHN1YmplY3RWYWxpZDogcGF5bG9hZC5zdWIgJiYgdHlwZW9mIHBheWxvYWQuc3ViID09PSAnc3RyaW5nJyxcbiAgICBcbiAgICAvLyBWZXJpZmljYXIgbWV0YWRhdGEgYsOhc2ljYVxuICAgIG1ldGFkYXRhVmFsaWQ6IHRydWUsIC8vIENsZXJrIG1hbmVqYSBlc3RvIGludGVybmFtZW50ZVxuICAgIFxuICAgIC8vIFZlcmlmaWNhciBzZXNpw7NuXG4gICAgc2Vzc2lvblZhbGlkOiBwYXlsb2FkLnNpZCAmJiB0eXBlb2YgcGF5bG9hZC5zaWQgPT09ICdzdHJpbmcnLFxuICAgIFxuICAgIC8vIE5vdGE6IExhIHZlcmlmaWNhY2nDs24gZGUgZmlybWEgbGEgaGFjZSBDbGVyayBpbnRlcm5hbWVudGVcbiAgICBzaWduYXR1cmVWYWxpZDogdHJ1ZVxuICB9O1xufVxuXG4vKipcbiAqIFZhbGlkYSBwZXJtaXNvcyBlc3BlY8OtZmljb3MgZW4gZWwgdG9rZW4gSldUXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUpXVFBlcm1pc3Npb25zKFxuICByZXF1aXJlZFJvbGU6IHN0cmluZyxcbiAgcmVxdWlyZWRQZXJtaXNzaW9uczogc3RyaW5nW10gPSBbXSxcbiAgcmVxdWVzdD86IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3Rcbik6IFByb21pc2U8SldUVmFsaWRhdGlvblJlc3VsdD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGp3dFZhbGlkYXRpb24gPSBhd2FpdCB2YWxpZGF0ZUpXVEludGVncml0eShyZXF1ZXN0KTtcbiAgICBcbiAgICBpZiAoIWp3dFZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgIHJldHVybiBqd3RWYWxpZGF0aW9uO1xuICAgIH1cblxuICAgIGNvbnN0IHBheWxvYWQgPSBqd3RWYWxpZGF0aW9uLnBheWxvYWQ7XG4gICAgXG4gICAgLy8gVmVyaWZpY2FyIHJvbCBlbiBtZXRhZGF0YVxuICAgIGNvbnN0IHVzZXJSb2xlID0gcGF5bG9hZC5tZXRhZGF0YT8ucm9sZSB8fCBwYXlsb2FkLnJvbGU7XG4gICAgaWYgKHJlcXVpcmVkUm9sZSAmJiB1c2VyUm9sZSAhPT0gcmVxdWlyZWRSb2xlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiBgUm9sIHJlcXVlcmlkbzogJHtyZXF1aXJlZFJvbGV9LCByb2wgYWN0dWFsOiAke3VzZXJSb2xlfWAsXG4gICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUk9MRScsXG4gICAgICAgIHNldmVyaXR5OiAnaGlnaCdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gVmVyaWZpY2FyIHBlcm1pc29zIGVzcGVjw61maWNvcyBzaSBzZSBwcm9wb3JjaW9uYW5cbiAgICBpZiAocmVxdWlyZWRQZXJtaXNzaW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCB1c2VyUGVybWlzc2lvbnMgPSBwYXlsb2FkLm1ldGFkYXRhPy5wZXJtaXNzaW9ucyB8fCBbXTtcbiAgICAgIGNvbnN0IGhhc0FsbFBlcm1pc3Npb25zID0gcmVxdWlyZWRQZXJtaXNzaW9ucy5ldmVyeShcbiAgICAgICAgcGVybWlzc2lvbiA9PiB1c2VyUGVybWlzc2lvbnMuaW5jbHVkZXMocGVybWlzc2lvbilcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGlmICghaGFzQWxsUGVybWlzc2lvbnMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IGBQZXJtaXNvcyBpbnN1ZmljaWVudGVzLiBSZXF1ZXJpZG9zOiAke3JlcXVpcmVkUGVybWlzc2lvbnMuam9pbignLCAnKX1gLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIHNldmVyaXR5OiAnaGlnaCdcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICBwYXlsb2FkLFxuICAgICAgZGV0YWlsczogand0VmFsaWRhdGlvbi5kZXRhaWxzXG4gICAgfTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tKV1RdIEVycm9yIGVuIHZhbGlkYWNpw7NuIGRlIHBlcm1pc29zOicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGVuIHZhbGlkYWNpw7NuIGRlIHBlcm1pc29zIEpXVCcsXG4gICAgICBjb2RlOiAnUEVSTUlTU0lPTl9WQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgIHNldmVyaXR5OiAnY3JpdGljYWwnXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIE1pZGRsZXdhcmUgcGFyYSB2YWxpZGFjacOzbiBhdXRvbcOhdGljYSBkZSBKV1RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhKV1RWYWxpZGF0aW9uKFxuICByZXF1aXJlZFJvbGU/OiBzdHJpbmcsXG4gIHJlcXVpcmVkUGVybWlzc2lvbnM/OiBzdHJpbmdbXVxuKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoaGFuZGxlcjogRnVuY3Rpb24pIHtcbiAgICByZXR1cm4gYXN5bmMgKHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QsIC4uLmFyZ3M6IGFueVtdKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBWYWxpZGFyIGludGVncmlkYWQgZGVsIEpXVFxuICAgICAgICBjb25zdCBqd3RWYWxpZGF0aW9uID0gYXdhaXQgdmFsaWRhdGVKV1RJbnRlZ3JpdHkocmVxdWVzdCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIWp3dFZhbGlkYXRpb24udmFsaWQpIHtcbiAgICAgICAgICBjb25zdCBlcnJvclJlc3BvbnNlID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogand0VmFsaWRhdGlvbi5lcnJvcixcbiAgICAgICAgICAgIGNvZGU6IGp3dFZhbGlkYXRpb24uY29kZSxcbiAgICAgICAgICAgIHNldmVyaXR5OiBqd3RWYWxpZGF0aW9uLnNldmVyaXR5XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGlmICgncXVlcnknIGluIHJlcXVlc3QpIHtcbiAgICAgICAgICAgIC8vIFBhZ2VzIFJvdXRlclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXJnc1swXSBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEFwcCBSb3V0ZXJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoZXJyb3JSZXNwb25zZSksIHtcbiAgICAgICAgICAgICAgc3RhdHVzOiA0MDEsXG4gICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGFyIHBlcm1pc29zIHNpIHNlIGVzcGVjaWZpY2FuXG4gICAgICAgIGlmIChyZXF1aXJlZFJvbGUgfHwgcmVxdWlyZWRQZXJtaXNzaW9ucykge1xuICAgICAgICAgIGNvbnN0IHBlcm1pc3Npb25WYWxpZGF0aW9uID0gYXdhaXQgdmFsaWRhdGVKV1RQZXJtaXNzaW9ucyhcbiAgICAgICAgICAgIHJlcXVpcmVkUm9sZSB8fCAnJyxcbiAgICAgICAgICAgIHJlcXVpcmVkUGVybWlzc2lvbnMgfHwgW10sXG4gICAgICAgICAgICByZXF1ZXN0XG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoIXBlcm1pc3Npb25WYWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvclJlc3BvbnNlID0ge1xuICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgZXJyb3I6IHBlcm1pc3Npb25WYWxpZGF0aW9uLmVycm9yLFxuICAgICAgICAgICAgICBjb2RlOiBwZXJtaXNzaW9uVmFsaWRhdGlvbi5jb2RlLFxuICAgICAgICAgICAgICBzZXZlcml0eTogcGVybWlzc2lvblZhbGlkYXRpb24uc2V2ZXJpdHlcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICgncXVlcnknIGluIHJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgLy8gUGFnZXMgUm91dGVyXG4gICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGFyZ3NbMF0gYXMgYW55O1xuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBBcHAgUm91dGVyXG4gICAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoZXJyb3JSZXNwb25zZSksIHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IDQwMyxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBw7FhZGlyIGluZm9ybWFjacOzbiBkZWwgSldUIGFsIHJlcXVlc3RcbiAgICAgICAgKHJlcXVlc3QgYXMgYW55KS5qd3RQYXlsb2FkID0gand0VmFsaWRhdGlvbi5wYXlsb2FkO1xuICAgICAgICAocmVxdWVzdCBhcyBhbnkpLmp3dERldGFpbHMgPSBqd3RWYWxpZGF0aW9uLmRldGFpbHM7XG5cbiAgICAgICAgcmV0dXJuIGhhbmRsZXIocmVxdWVzdCwgLi4uYXJncyk7XG5cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tKV1RdIEVycm9yIGVuIG1pZGRsZXdhcmUgZGUgdmFsaWRhY2nDs246JywgZXJyb3IpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXJyb3JSZXNwb25zZSA9IHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ0Vycm9yIGludGVybm8gZW4gdmFsaWRhY2nDs24gSldUJyxcbiAgICAgICAgICBjb2RlOiAnSldUX01JRERMRVdBUkVfRVJST1InXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKCdxdWVyeScgaW4gcmVxdWVzdCkge1xuICAgICAgICAgIC8vIFBhZ2VzIFJvdXRlclxuICAgICAgICAgIGNvbnN0IHJlcyA9IGFyZ3NbMF0gYXMgYW55O1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbihlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBBcHAgUm91dGVyXG4gICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeShlcnJvclJlc3BvbnNlKSwge1xuICAgICAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJ2YWxpZGF0ZUpXVEludGVncml0eSIsInZhbGlkYXRlSldUUGVybWlzc2lvbnMiLCJ3aXRoSldUVmFsaWRhdGlvbiIsIkpXVF9TRUNVUklUWV9DT05GSUciLCJtYXhUb2tlbkFnZSIsIm1pblRpbWVCZWZvcmVFeHBpcnkiLCJleHBlY3RlZElzc3VlciIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19DTEVSS19QVUJMSVNIQUJMRV9LRVkiLCJzcGxpdCIsImV4cGVjdGVkQXVkaWVuY2UiLCJhbGxvd2VkQWxnb3JpdGhtcyIsInJlcXVpcmVkQ2xhaW1zIiwicmVxdWVzdCIsInRva2VuIiwicGF5bG9hZCIsInZhbGlkIiwiZXJyb3IiLCJjb2RlIiwic2V2ZXJpdHkiLCJzZXNzaW9uIiwiYXV0aCIsInVzZXIiLCJ1c2VySWQiLCJpZCIsImVtYWlsIiwibmFtZSIsImNsYWltcyIsInN1YiIsInBhcnRzIiwibGVuZ3RoIiwiaGVhZGVyIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsImluY2x1ZGVzIiwiYWxnIiwiZGVjb2RlRXJyb3IiLCJzZWN1cml0eUNoZWNrcyIsInBlcmZvcm1Ub2tlblNlY3VyaXR5Q2hlY2tzIiwic2lnbmF0dXJlVmFsaWQiLCJub3RFeHBpcmVkIiwiaXNzdWVyVmFsaWQiLCJkZXRhaWxzIiwiaXNzdWVyIiwiaXNzIiwiYXVkaWVuY2UiLCJhdWQiLCJleHBpcmVzQXQiLCJleHAiLCJpc3N1ZWRBdCIsImlhdCIsIm5vdEJlZm9yZSIsIm5iZiIsInN1YmplY3QiLCJzZXNzaW9uSWQiLCJzaWQiLCJtZXRhZGF0YSIsImNvbnNvbGUiLCJub3ciLCJNYXRoIiwiZmxvb3IiLCJEYXRlIiwibm90QmVmb3JlVmFsaWQiLCJhdWRpZW5jZVZhbGlkIiwic3ViamVjdFZhbGlkIiwibWV0YWRhdGFWYWxpZCIsInNlc3Npb25WYWxpZCIsInJlcXVpcmVkUm9sZSIsInJlcXVpcmVkUGVybWlzc2lvbnMiLCJqd3RWYWxpZGF0aW9uIiwidXNlclJvbGUiLCJyb2xlIiwidXNlclBlcm1pc3Npb25zIiwicGVybWlzc2lvbnMiLCJoYXNBbGxQZXJtaXNzaW9ucyIsImV2ZXJ5IiwicGVybWlzc2lvbiIsImpvaW4iLCJoYW5kbGVyIiwiYXJncyIsImVycm9yUmVzcG9uc2UiLCJzdWNjZXNzIiwicmVzIiwic3RhdHVzIiwianNvbiIsIlJlc3BvbnNlIiwic3RyaW5naWZ5IiwiaGVhZGVycyIsInBlcm1pc3Npb25WYWxpZGF0aW9uIiwiand0UGF5bG9hZCIsImp3dERldGFpbHMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Q0FHQzs7Ozs7Ozs7Ozs7UUFzRXFCQTtlQUFBQTs7UUE4TEFDO2VBQUFBOztRQThETkM7ZUFBQUE7OztzQkFoVUs7QUFxQ3JCLHdEQUF3RDtBQUN4RCw2QkFBNkI7QUFDN0Isd0RBQXdEO0FBRXhELE1BQU1DLHNCQUFzQjtJQUMxQiw2Q0FBNkM7SUFDN0NDLGFBQWEsS0FBSyxLQUFLLEtBQUs7SUFFNUIsdUVBQXVFO0lBQ3ZFQyxxQkFBcUIsSUFBSSxLQUFLO0lBRTlCLDJCQUEyQjtJQUMzQkMsZ0JBQWdCQyxRQUFRQyxHQUFHLENBQUNDLGlDQUFpQyxFQUFFQyxNQUFNLElBQUksQ0FBQyxFQUFFLElBQUk7SUFFaEYsb0JBQW9CO0lBQ3BCQyxrQkFBa0JKLFFBQVFDLEdBQUcsQ0FBQ0MsaUNBQWlDLElBQUk7SUFFbkUsd0JBQXdCO0lBQ3hCRyxtQkFBbUI7UUFBQztRQUFTO0tBQVE7SUFFckMsb0JBQW9CO0lBQ3BCQyxnQkFBZ0I7UUFBQztRQUFP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