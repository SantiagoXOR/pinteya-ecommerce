{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\useProducts.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - HOOK PARA PRODUCTOS\r\n// ===================================\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { Product } from '@/types/product';\r\nimport { ProductFilters, PaginatedResponse, ProductWithCategory } from '@/types/api';\r\nimport { getProducts } from '@/lib/api/products';\r\nimport { adaptApiProductsToLegacy, ExtendedProduct } from '@/lib/adapters/productAdapter';\r\n\r\ninterface UseProductsState {\r\n  products: ExtendedProduct[];\r\n  loading: boolean;\r\n  error: string | null;\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\ninterface UseProductsOptions {\r\n  initialFilters?: ProductFilters;\r\n  autoFetch?: boolean;\r\n}\r\n\r\nexport function useProducts(options: UseProductsOptions = {}) {\r\n  const { initialFilters = {}, autoFetch = true } = options;\r\n\r\n  // DEBUG: Log b√°sico para verificar que el hook se ejecuta\r\n  console.log('üîç HOOK useProducts EJECUT√ÅNDOSE');\r\n\r\n  const [state, setState] = useState<UseProductsState>({\r\n    products: [],\r\n    loading: false,\r\n    error: null,\r\n    pagination: {\r\n      page: 1,\r\n      limit: 12,\r\n      total: 0,\r\n      totalPages: 0,\r\n    },\r\n  });\r\n\r\n  const [filters, setFilters] = useState<ProductFilters>(initialFilters);\r\n\r\n  /**\r\n   * Obtiene productos desde la API\r\n   */\r\n  const fetchProducts = useCallback(async (newFilters?: ProductFilters) => {\r\n    setState(prev => ({ ...prev, loading: true, error: null }));\r\n\r\n    try {\r\n      const filtersToUse = newFilters || filters;\r\n      const response: PaginatedResponse<ProductWithCategory> = await getProducts(filtersToUse);\r\n\r\n      if (response.success) {\r\n        // DEBUG CR√çTICO: Log de datos antes del adaptador\r\n        const poximixProducts = response.data.filter(p => p.name?.includes('Poximix'));\r\n        if (poximixProducts.length > 0) {\r\n          console.log('üîç DEBUG CR√çTICO - DATOS ANTES DEL ADAPTADOR:', poximixProducts.map(p => ({\r\n            id: p.id,\r\n            name: p.name,\r\n            'contiene Poxipol': p.name?.includes('Poxipol')\r\n          })));\r\n        }\r\n\r\n        const adaptedProducts = adaptApiProductsToLegacy(response.data);\r\n\r\n        // DEBUG CR√çTICO: Log de datos despu√©s del adaptador\r\n        const adaptedPoximix = adaptedProducts.filter(p => p.title?.includes('Poximix'));\r\n        if (adaptedPoximix.length > 0) {\r\n          console.log('üîç DEBUG CR√çTICO - DATOS DESPU√âS DEL ADAPTADOR:', adaptedPoximix.map(p => ({\r\n            id: p.id,\r\n            title: p.title,\r\n            'contiene Poxipol': p.title?.includes('Poxipol')\r\n          })));\r\n        }\r\n\r\n        setState(prev => ({\r\n          ...prev,\r\n          products: adaptedProducts,\r\n          loading: false,\r\n          pagination: response.pagination,\r\n        }));\r\n      } else {\r\n        setState(prev => ({\r\n          ...prev,\r\n          loading: false,\r\n          error: response.error || 'Error obteniendo productos',\r\n        }));\r\n      }\r\n    } catch (error: any) {\r\n      setState(prev => ({\r\n        ...prev,\r\n        loading: false,\r\n        error: error.message || 'Error inesperado',\r\n      }));\r\n    }\r\n  }, [filters]);\r\n\r\n  /**\r\n   * Actualiza los filtros y obtiene productos\r\n   */\r\n  const updateFilters = useCallback((newFilters: Partial<ProductFilters>) => {\r\n    const updatedFilters = { ...filters, ...newFilters };\r\n    setFilters(updatedFilters);\r\n    fetchProducts(updatedFilters);\r\n  }, [filters, fetchProducts]);\r\n\r\n  /**\r\n   * Cambia la p√°gina\r\n   */\r\n  const changePage = useCallback((page: number) => {\r\n    updateFilters({ page });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Cambia el l√≠mite de productos por p√°gina\r\n   */\r\n  const changeLimit = useCallback((limit: number) => {\r\n    updateFilters({ limit, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Cambia el ordenamiento\r\n   */\r\n  const changeSorting = useCallback((sortBy: 'price' | 'name' | 'created_at', sortOrder: 'asc' | 'desc') => {\r\n    updateFilters({ sortBy, sortOrder, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Busca productos por t√©rmino\r\n   */\r\n  const searchProducts = useCallback((searchTerm: string) => {\r\n    updateFilters({ search: searchTerm, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Filtra por categor√≠a\r\n   */\r\n  const filterByCategory = useCallback((category: string) => {\r\n    updateFilters({ category, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Filtra por rango de precios\r\n   */\r\n  const filterByPriceRange = useCallback((priceMin?: number, priceMax?: number) => {\r\n    updateFilters({ priceMin, priceMax, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Limpia todos los filtros\r\n   */\r\n  const clearFilters = useCallback(() => {\r\n    const clearedFilters: ProductFilters = {\r\n      page: 1,\r\n      limit: filters.limit || 12,\r\n      sortBy: 'created_at',\r\n      sortOrder: 'desc',\r\n    };\r\n    setFilters(clearedFilters);\r\n    fetchProducts(clearedFilters);\r\n  }, [filters.limit, fetchProducts]);\r\n\r\n  /**\r\n   * Refresca los productos\r\n   */\r\n  const refresh = useCallback(() => {\r\n    fetchProducts();\r\n  }, [fetchProducts]);\r\n\r\n  // Auto-fetch al montar el componente\r\n  useEffect(() => {\r\n    if (autoFetch) {\r\n      fetchProducts();\r\n    }\r\n  }, [autoFetch, fetchProducts]);\r\n\r\n  return {\r\n    // Estado\r\n    products: state.products,\r\n    loading: state.loading,\r\n    error: state.error,\r\n    pagination: state.pagination,\r\n    filters,\r\n\r\n    // Acciones\r\n    fetchProducts,\r\n    updateFilters,\r\n    changePage,\r\n    changeLimit,\r\n    changeSorting,\r\n    searchProducts,\r\n    filterByCategory,\r\n    filterByPriceRange,\r\n    clearFilters,\r\n    refresh,\r\n\r\n    // Helpers\r\n    hasProducts: state.products.length > 0,\r\n    isEmpty: !state.loading && state.products.length === 0,\r\n    hasError: !!state.error,\r\n    hasNextPage: state.pagination.page < state.pagination.totalPages,\r\n    hasPrevPage: state.pagination.page > 1,\r\n  };\r\n}\r\n"],"names":["useProducts","options","initialFilters","autoFetch","console","log","state","setState","useState","products","loading","error","pagination","page","limit","total","totalPages","filters","setFilters","fetchProducts","useCallback","newFilters","prev","filtersToUse","response","getProducts","success","poximixProducts","data","filter","p","name","includes","length","map","id","adaptedProducts","adaptApiProductsToLegacy","adaptedPoximix","title","message","updateFilters","updatedFilters","changePage","changeLimit","changeSorting","sortBy","sortOrder","searchProducts","searchTerm","search","filterByCategory","category","filterByPriceRange","priceMin","priceMax","clearFilters","clearedFilters","refresh","useEffect","hasProducts","isEmpty","hasError","hasNextPage","hasPrevPage"],"mappings":"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"}