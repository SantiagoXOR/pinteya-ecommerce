5466ac6fe3c18714cf041691ec1b05cc
/**
 * Sistema de Rate Limiting para APIs
 * Implementa límites de velocidad para prevenir ataques de fuerza bruta
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    RATE_LIMIT_CONFIGS: function() {
        return RATE_LIMIT_CONFIGS;
    },
    checkRateLimit: function() {
        return checkRateLimit;
    },
    clearRateLimit: function() {
        return clearRateLimit;
    },
    getRateLimitStats: function() {
        return getRateLimitStats;
    },
    withAdminRateLimit: function() {
        return withAdminRateLimit;
    },
    withAuthRateLimit: function() {
        return withAuthRateLimit;
    },
    withPaymentRateLimit: function() {
        return withPaymentRateLimit;
    },
    withProductRateLimit: function() {
        return withProductRateLimit;
    },
    withRateLimit: function() {
        return withRateLimit;
    }
});
const RATE_LIMIT_CONFIGS = {
    // APIs de autenticación - muy restrictivo
    auth: {
        windowMs: 15 * 60 * 1000,
        maxRequests: 5,
        message: 'Demasiados intentos de autenticación. Intenta de nuevo en 15 minutos.'
    },
    // APIs admin - restrictivo
    admin: {
        windowMs: 5 * 60 * 1000,
        maxRequests: 30,
        message: 'Demasiadas requests administrativas. Intenta de nuevo en 5 minutos.'
    },
    // APIs de productos - moderado
    products: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 60,
        message: 'Demasiadas requests de productos. Intenta de nuevo en 1 minuto.'
    },
    // APIs de pagos - muy restrictivo
    payments: {
        windowMs: 10 * 60 * 1000,
        maxRequests: 10,
        message: 'Demasiadas requests de pagos. Intenta de nuevo en 10 minutos.'
    },
    // APIs generales - permisivo
    general: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 100,
        message: 'Demasiadas requests. Intenta de nuevo en 1 minuto.'
    }
};
// =====================================================
// ALMACENAMIENTO EN MEMORIA (Para desarrollo)
// =====================================================
const rateLimitStore = new Map();
// Limpiar entradas expiradas cada 5 minutos
setInterval(()=>{
    const now = Date.now();
    for (const [key, entry] of rateLimitStore.entries()){
        if (entry.resetTime < now) {
            rateLimitStore.delete(key);
        }
    }
}, 5 * 60 * 1000);
// =====================================================
// FUNCIONES DE RATE LIMITING
// =====================================================
/**
 * Genera una clave única para el rate limiting
 */ function generateRateLimitKey(request, prefix = 'default') {
    // Obtener IP del cliente
    let clientIP = 'unknown';
    if ('ip' in request && request.ip) {
        clientIP = request.ip;
    } else if ('headers' in request) {
        // Intentar obtener IP de headers
        const forwarded = getHeader(request, 'x-forwarded-for');
        const realIP = getHeader(request, 'x-real-ip');
        const cfIP = getHeader(request, 'cf-connecting-ip');
        clientIP = forwarded?.split(',')[0] || realIP || cfIP || 'unknown';
    }
    // Obtener User-Agent para mayor especificidad
    const userAgent = getHeader(request, 'user-agent') || 'unknown';
    const userAgentHash = hashString(userAgent);
    return `${prefix}:${clientIP}:${userAgentHash}`;
}
/**
 * Obtiene un header de manera compatible
 */ function getHeader(request, headerName) {
    if ('headers' in request && typeof request.headers.get === 'function') {
        return request.headers.get(headerName);
    } else if ('headers' in request) {
        const header = request.headers[headerName];
        return Array.isArray(header) ? header[0] : header || null;
    }
    return null;
}
/**
 * Hash simple para User-Agent
 */ function hashString(str) {
    let hash = 0;
    for(let i = 0; i < str.length; i++){
        const char = str.charCodeAt(i);
        hash = (hash << 5) - hash + char;
        hash = hash & hash; // Convertir a 32-bit integer
    }
    return Math.abs(hash).toString(36);
}
async function checkRateLimit(request, config, keyPrefix = 'api') {
    try {
        const now = Date.now();
        const key = config.keyGenerator ? config.keyGenerator(request) : generateRateLimitKey(request, keyPrefix);
        // Obtener entrada actual o crear nueva
        let entry = rateLimitStore.get(key);
        if (!entry || entry.resetTime < now) {
            // Crear nueva entrada
            entry = {
                count: 1,
                resetTime: now + config.windowMs,
                firstRequest: now
            };
            rateLimitStore.set(key, entry);
            return {
                allowed: true,
                limit: config.maxRequests,
                remaining: config.maxRequests - 1,
                resetTime: entry.resetTime
            };
        }
        // Incrementar contador
        entry.count++;
        rateLimitStore.set(key, entry);
        // Verificar si excede el límite
        if (entry.count > config.maxRequests) {
            const retryAfter = Math.ceil((entry.resetTime - now) / 1000);
            return {
                allowed: false,
                limit: config.maxRequests,
                remaining: 0,
                resetTime: entry.resetTime,
                retryAfter,
                error: config.message || 'Rate limit exceeded',
                code: 'RATE_LIMIT_EXCEEDED'
            };
        }
        return {
            allowed: true,
            limit: config.maxRequests,
            remaining: config.maxRequests - entry.count,
            resetTime: entry.resetTime
        };
    } catch (error) {
        console.error('[RATE_LIMIT] Error en verificación:', error);
        // En caso de error, permitir la request pero loggear
        return {
            allowed: true,
            limit: config.maxRequests,
            remaining: config.maxRequests,
            resetTime: Date.now() + config.windowMs,
            error: 'Error interno en rate limiting'
        };
    }
}
function withRateLimit(configName, customConfig) {
    const baseConfig = RATE_LIMIT_CONFIGS[configName];
    const config = {
        ...baseConfig,
        ...customConfig
    };
    return function(handler) {
        return async (request, ...args)=>{
            try {
                const rateLimitResult = await checkRateLimit(request, config, configName);
                // Añadir headers de rate limiting
                const headers = {
                    'X-RateLimit-Limit': rateLimitResult.limit.toString(),
                    'X-RateLimit-Remaining': rateLimitResult.remaining.toString(),
                    'X-RateLimit-Reset': Math.ceil(rateLimitResult.resetTime / 1000).toString()
                };
                if (rateLimitResult.retryAfter) {
                    headers['Retry-After'] = rateLimitResult.retryAfter.toString();
                }
                if (!rateLimitResult.allowed) {
                    const errorResponse = {
                        success: false,
                        error: rateLimitResult.error,
                        code: rateLimitResult.code,
                        rateLimit: {
                            limit: rateLimitResult.limit,
                            remaining: rateLimitResult.remaining,
                            resetTime: rateLimitResult.resetTime,
                            retryAfter: rateLimitResult.retryAfter
                        }
                    };
                    if ('query' in request) {
                        // Pages Router
                        const res = args[0];
                        Object.entries(headers).forEach(([key, value])=>{
                            res.setHeader(key, value);
                        });
                        return res.status(429).json(errorResponse);
                    } else {
                        // App Router
                        return new Response(JSON.stringify(errorResponse), {
                            status: 429,
                            headers: {
                                'Content-Type': 'application/json',
                                ...headers
                            }
                        });
                    }
                }
                // Añadir información de rate limiting al request
                request.rateLimit = rateLimitResult;
                // Ejecutar handler original
                const response = await handler(request, ...args);
                // Añadir headers a la respuesta si es posible
                if (response && typeof response.headers?.set === 'function') {
                    Object.entries(headers).forEach(([key, value])=>{
                        response.headers.set(key, value);
                    });
                }
                return response;
            } catch (error) {
                console.error('[RATE_LIMIT] Error en middleware:', error);
                return handler(request, ...args);
            }
        };
    };
}
function withAuthRateLimit() {
    return withRateLimit('auth');
}
function withAdminRateLimit() {
    return withRateLimit('admin');
}
function withProductRateLimit() {
    return withRateLimit('products');
}
function withPaymentRateLimit() {
    return withRateLimit('payments');
}
function clearRateLimit(key) {
    return rateLimitStore.delete(key);
}
function getRateLimitStats() {
    const now = Date.now();
    const entries = Array.from(rateLimitStore.values());
    const activeEntries = entries.filter((entry)=>entry.resetTime > now);
    return {
        totalKeys: rateLimitStore.size,
        activeEntries: activeEntries.length,
        oldestEntry: entries.length > 0 ? Math.min(...entries.map((e)=>e.firstRequest)) : null,
        newestEntry: entries.length > 0 ? Math.max(...entries.map((e)=>e.firstRequest)) : null
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhdXRoXFxyYXRlLWxpbWl0aW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2lzdGVtYSBkZSBSYXRlIExpbWl0aW5nIHBhcmEgQVBJc1xuICogSW1wbGVtZW50YSBsw61taXRlcyBkZSB2ZWxvY2lkYWQgcGFyYSBwcmV2ZW5pciBhdGFxdWVzIGRlIGZ1ZXJ6YSBicnV0YVxuICovXG5cbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCB9IGZyb20gJ25leHQnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVElQT1MgWSBJTlRFUkZBQ0VTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFJhdGVMaW1pdFJlc3VsdCB7XG4gIGFsbG93ZWQ6IGJvb2xlYW47XG4gIGxpbWl0OiBudW1iZXI7XG4gIHJlbWFpbmluZzogbnVtYmVyO1xuICByZXNldFRpbWU6IG51bWJlcjtcbiAgcmV0cnlBZnRlcj86IG51bWJlcjtcbiAgZXJyb3I/OiBzdHJpbmc7XG4gIGNvZGU/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmF0ZUxpbWl0Q29uZmlnIHtcbiAgd2luZG93TXM6IG51bWJlcjsgIC8vIFZlbnRhbmEgZGUgdGllbXBvIGVuIG1pbGlzZWd1bmRvc1xuICBtYXhSZXF1ZXN0czogbnVtYmVyOyAgLy8gTcOheGltbyBuw7ptZXJvIGRlIHJlcXVlc3RzIHBvciB2ZW50YW5hXG4gIGtleUdlbmVyYXRvcj86IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0KSA9PiBzdHJpbmc7XG4gIHNraXBTdWNjZXNzZnVsUmVxdWVzdHM/OiBib29sZWFuO1xuICBza2lwRmFpbGVkUmVxdWVzdHM/OiBib29sZWFuO1xuICBtZXNzYWdlPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJhdGVMaW1pdEVudHJ5IHtcbiAgY291bnQ6IG51bWJlcjtcbiAgcmVzZXRUaW1lOiBudW1iZXI7XG4gIGZpcnN0UmVxdWVzdDogbnVtYmVyO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09ORklHVVJBQ0lPTkVTIERFIFJBVEUgTElNSVRJTkdcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBjb25zdCBSQVRFX0xJTUlUX0NPTkZJR1MgPSB7XG4gIC8vIEFQSXMgZGUgYXV0ZW50aWNhY2nDs24gLSBtdXkgcmVzdHJpY3Rpdm9cbiAgYXV0aDoge1xuICAgIHdpbmRvd01zOiAxNSAqIDYwICogMTAwMCwgLy8gMTUgbWludXRvc1xuICAgIG1heFJlcXVlc3RzOiA1LCAvLyA1IGludGVudG9zIHBvciAxNSBtaW51dG9zXG4gICAgbWVzc2FnZTogJ0RlbWFzaWFkb3MgaW50ZW50b3MgZGUgYXV0ZW50aWNhY2nDs24uIEludGVudGEgZGUgbnVldm8gZW4gMTUgbWludXRvcy4nXG4gIH0sXG4gIFxuICAvLyBBUElzIGFkbWluIC0gcmVzdHJpY3Rpdm9cbiAgYWRtaW46IHtcbiAgICB3aW5kb3dNczogNSAqIDYwICogMTAwMCwgLy8gNSBtaW51dG9zXG4gICAgbWF4UmVxdWVzdHM6IDMwLCAvLyAzMCByZXF1ZXN0cyBwb3IgNSBtaW51dG9zXG4gICAgbWVzc2FnZTogJ0RlbWFzaWFkYXMgcmVxdWVzdHMgYWRtaW5pc3RyYXRpdmFzLiBJbnRlbnRhIGRlIG51ZXZvIGVuIDUgbWludXRvcy4nXG4gIH0sXG4gIFxuICAvLyBBUElzIGRlIHByb2R1Y3RvcyAtIG1vZGVyYWRvXG4gIHByb2R1Y3RzOiB7XG4gICAgd2luZG93TXM6IDEgKiA2MCAqIDEwMDAsIC8vIDEgbWludXRvXG4gICAgbWF4UmVxdWVzdHM6IDYwLCAvLyA2MCByZXF1ZXN0cyBwb3IgbWludXRvXG4gICAgbWVzc2FnZTogJ0RlbWFzaWFkYXMgcmVxdWVzdHMgZGUgcHJvZHVjdG9zLiBJbnRlbnRhIGRlIG51ZXZvIGVuIDEgbWludXRvLidcbiAgfSxcbiAgXG4gIC8vIEFQSXMgZGUgcGFnb3MgLSBtdXkgcmVzdHJpY3Rpdm9cbiAgcGF5bWVudHM6IHtcbiAgICB3aW5kb3dNczogMTAgKiA2MCAqIDEwMDAsIC8vIDEwIG1pbnV0b3NcbiAgICBtYXhSZXF1ZXN0czogMTAsIC8vIDEwIHJlcXVlc3RzIHBvciAxMCBtaW51dG9zXG4gICAgbWVzc2FnZTogJ0RlbWFzaWFkYXMgcmVxdWVzdHMgZGUgcGFnb3MuIEludGVudGEgZGUgbnVldm8gZW4gMTAgbWludXRvcy4nXG4gIH0sXG4gIFxuICAvLyBBUElzIGdlbmVyYWxlcyAtIHBlcm1pc2l2b1xuICBnZW5lcmFsOiB7XG4gICAgd2luZG93TXM6IDEgKiA2MCAqIDEwMDAsIC8vIDEgbWludXRvXG4gICAgbWF4UmVxdWVzdHM6IDEwMCwgLy8gMTAwIHJlcXVlc3RzIHBvciBtaW51dG9cbiAgICBtZXNzYWdlOiAnRGVtYXNpYWRhcyByZXF1ZXN0cy4gSW50ZW50YSBkZSBudWV2byBlbiAxIG1pbnV0by4nXG4gIH1cbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBTE1BQ0VOQU1JRU5UTyBFTiBNRU1PUklBIChQYXJhIGRlc2Fycm9sbG8pXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCByYXRlTGltaXRTdG9yZSA9IG5ldyBNYXA8c3RyaW5nLCBSYXRlTGltaXRFbnRyeT4oKTtcblxuLy8gTGltcGlhciBlbnRyYWRhcyBleHBpcmFkYXMgY2FkYSA1IG1pbnV0b3NcbnNldEludGVydmFsKCgpID0+IHtcbiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2YgcmF0ZUxpbWl0U3RvcmUuZW50cmllcygpKSB7XG4gICAgaWYgKGVudHJ5LnJlc2V0VGltZSA8IG5vdykge1xuICAgICAgcmF0ZUxpbWl0U3RvcmUuZGVsZXRlKGtleSk7XG4gICAgfVxuICB9XG59LCA1ICogNjAgKiAxMDAwKTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZVTkNJT05FUyBERSBSQVRFIExJTUlUSU5HXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdlbmVyYSB1bmEgY2xhdmUgw7puaWNhIHBhcmEgZWwgcmF0ZSBsaW1pdGluZ1xuICovXG5mdW5jdGlvbiBnZW5lcmF0ZVJhdGVMaW1pdEtleShcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdCxcbiAgcHJlZml4OiBzdHJpbmcgPSAnZGVmYXVsdCdcbik6IHN0cmluZyB7XG4gIC8vIE9idGVuZXIgSVAgZGVsIGNsaWVudGVcbiAgbGV0IGNsaWVudElQID0gJ3Vua25vd24nO1xuICBcbiAgaWYgKCdpcCcgaW4gcmVxdWVzdCAmJiByZXF1ZXN0LmlwKSB7XG4gICAgY2xpZW50SVAgPSByZXF1ZXN0LmlwO1xuICB9IGVsc2UgaWYgKCdoZWFkZXJzJyBpbiByZXF1ZXN0KSB7XG4gICAgLy8gSW50ZW50YXIgb2J0ZW5lciBJUCBkZSBoZWFkZXJzXG4gICAgY29uc3QgZm9yd2FyZGVkID0gZ2V0SGVhZGVyKHJlcXVlc3QsICd4LWZvcndhcmRlZC1mb3InKTtcbiAgICBjb25zdCByZWFsSVAgPSBnZXRIZWFkZXIocmVxdWVzdCwgJ3gtcmVhbC1pcCcpO1xuICAgIGNvbnN0IGNmSVAgPSBnZXRIZWFkZXIocmVxdWVzdCwgJ2NmLWNvbm5lY3RpbmctaXAnKTtcbiAgICBcbiAgICBjbGllbnRJUCA9IGZvcndhcmRlZD8uc3BsaXQoJywnKVswXSB8fCByZWFsSVAgfHwgY2ZJUCB8fCAndW5rbm93bic7XG4gIH1cblxuICAvLyBPYnRlbmVyIFVzZXItQWdlbnQgcGFyYSBtYXlvciBlc3BlY2lmaWNpZGFkXG4gIGNvbnN0IHVzZXJBZ2VudCA9IGdldEhlYWRlcihyZXF1ZXN0LCAndXNlci1hZ2VudCcpIHx8ICd1bmtub3duJztcbiAgY29uc3QgdXNlckFnZW50SGFzaCA9IGhhc2hTdHJpbmcodXNlckFnZW50KTtcblxuICByZXR1cm4gYCR7cHJlZml4fToke2NsaWVudElQfToke3VzZXJBZ2VudEhhc2h9YDtcbn1cblxuLyoqXG4gKiBPYnRpZW5lIHVuIGhlYWRlciBkZSBtYW5lcmEgY29tcGF0aWJsZVxuICovXG5mdW5jdGlvbiBnZXRIZWFkZXIoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QsXG4gIGhlYWRlck5hbWU6IHN0cmluZ1xuKTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmICgnaGVhZGVycycgaW4gcmVxdWVzdCAmJiB0eXBlb2YgcmVxdWVzdC5oZWFkZXJzLmdldCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiAocmVxdWVzdCBhcyBOZXh0UmVxdWVzdCkuaGVhZGVycy5nZXQoaGVhZGVyTmFtZSk7XG4gIH0gZWxzZSBpZiAoJ2hlYWRlcnMnIGluIHJlcXVlc3QpIHtcbiAgICBjb25zdCBoZWFkZXIgPSAocmVxdWVzdCBhcyBOZXh0QXBpUmVxdWVzdCkuaGVhZGVyc1toZWFkZXJOYW1lXTtcbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheShoZWFkZXIpID8gaGVhZGVyWzBdIDogaGVhZGVyIHx8IG51bGw7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogSGFzaCBzaW1wbGUgcGFyYSBVc2VyLUFnZW50XG4gKi9cbmZ1bmN0aW9uIGhhc2hTdHJpbmcoc3RyOiBzdHJpbmcpOiBzdHJpbmcge1xuICBsZXQgaGFzaCA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY2hhciA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoKSArIGNoYXI7XG4gICAgaGFzaCA9IGhhc2ggJiBoYXNoOyAvLyBDb252ZXJ0aXIgYSAzMi1iaXQgaW50ZWdlclxuICB9XG4gIHJldHVybiBNYXRoLmFicyhoYXNoKS50b1N0cmluZygzNik7XG59XG5cbi8qKlxuICogVmVyaWZpY2Egc2kgdW5hIHJlcXVlc3QgZXN0w6EgZGVudHJvIGRlIGxvcyBsw61taXRlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tSYXRlTGltaXQoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QsXG4gIGNvbmZpZzogUmF0ZUxpbWl0Q29uZmlnLFxuICBrZXlQcmVmaXg6IHN0cmluZyA9ICdhcGknXG4pOiBQcm9taXNlPFJhdGVMaW1pdFJlc3VsdD4ge1xuICB0cnkge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgY29uc3Qga2V5ID0gY29uZmlnLmtleUdlbmVyYXRvciBcbiAgICAgID8gY29uZmlnLmtleUdlbmVyYXRvcihyZXF1ZXN0KVxuICAgICAgOiBnZW5lcmF0ZVJhdGVMaW1pdEtleShyZXF1ZXN0LCBrZXlQcmVmaXgpO1xuXG4gICAgLy8gT2J0ZW5lciBlbnRyYWRhIGFjdHVhbCBvIGNyZWFyIG51ZXZhXG4gICAgbGV0IGVudHJ5ID0gcmF0ZUxpbWl0U3RvcmUuZ2V0KGtleSk7XG4gICAgXG4gICAgaWYgKCFlbnRyeSB8fCBlbnRyeS5yZXNldFRpbWUgPCBub3cpIHtcbiAgICAgIC8vIENyZWFyIG51ZXZhIGVudHJhZGFcbiAgICAgIGVudHJ5ID0ge1xuICAgICAgICBjb3VudDogMSxcbiAgICAgICAgcmVzZXRUaW1lOiBub3cgKyBjb25maWcud2luZG93TXMsXG4gICAgICAgIGZpcnN0UmVxdWVzdDogbm93XG4gICAgICB9O1xuICAgICAgcmF0ZUxpbWl0U3RvcmUuc2V0KGtleSwgZW50cnkpO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgICBsaW1pdDogY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgICByZW1haW5pbmc6IGNvbmZpZy5tYXhSZXF1ZXN0cyAtIDEsXG4gICAgICAgIHJlc2V0VGltZTogZW50cnkucmVzZXRUaW1lXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIEluY3JlbWVudGFyIGNvbnRhZG9yXG4gICAgZW50cnkuY291bnQrKztcbiAgICByYXRlTGltaXRTdG9yZS5zZXQoa2V5LCBlbnRyeSk7XG5cbiAgICAvLyBWZXJpZmljYXIgc2kgZXhjZWRlIGVsIGzDrW1pdGVcbiAgICBpZiAoZW50cnkuY291bnQgPiBjb25maWcubWF4UmVxdWVzdHMpIHtcbiAgICAgIGNvbnN0IHJldHJ5QWZ0ZXIgPSBNYXRoLmNlaWwoKGVudHJ5LnJlc2V0VGltZSAtIG5vdykgLyAxMDAwKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICAgIGxpbWl0OiBjb25maWcubWF4UmVxdWVzdHMsXG4gICAgICAgIHJlbWFpbmluZzogMCxcbiAgICAgICAgcmVzZXRUaW1lOiBlbnRyeS5yZXNldFRpbWUsXG4gICAgICAgIHJldHJ5QWZ0ZXIsXG4gICAgICAgIGVycm9yOiBjb25maWcubWVzc2FnZSB8fCAnUmF0ZSBsaW1pdCBleGNlZWRlZCcsXG4gICAgICAgIGNvZGU6ICdSQVRFX0xJTUlUX0VYQ0VFREVEJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgIGxpbWl0OiBjb25maWcubWF4UmVxdWVzdHMsXG4gICAgICByZW1haW5pbmc6IGNvbmZpZy5tYXhSZXF1ZXN0cyAtIGVudHJ5LmNvdW50LFxuICAgICAgcmVzZXRUaW1lOiBlbnRyeS5yZXNldFRpbWVcbiAgICB9O1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1JBVEVfTElNSVRdIEVycm9yIGVuIHZlcmlmaWNhY2nDs246JywgZXJyb3IpO1xuICAgIFxuICAgIC8vIEVuIGNhc28gZGUgZXJyb3IsIHBlcm1pdGlyIGxhIHJlcXVlc3QgcGVybyBsb2dnZWFyXG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICBsaW1pdDogY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgcmVtYWluaW5nOiBjb25maWcubWF4UmVxdWVzdHMsXG4gICAgICByZXNldFRpbWU6IERhdGUubm93KCkgKyBjb25maWcud2luZG93TXMsXG4gICAgICBlcnJvcjogJ0Vycm9yIGludGVybm8gZW4gcmF0ZSBsaW1pdGluZydcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogTWlkZGxld2FyZSBkZSByYXRlIGxpbWl0aW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoUmF0ZUxpbWl0KFxuICBjb25maWdOYW1lOiBrZXlvZiB0eXBlb2YgUkFURV9MSU1JVF9DT05GSUdTLFxuICBjdXN0b21Db25maWc/OiBQYXJ0aWFsPFJhdGVMaW1pdENvbmZpZz5cbikge1xuICBjb25zdCBiYXNlQ29uZmlnID0gUkFURV9MSU1JVF9DT05GSUdTW2NvbmZpZ05hbWVdO1xuICBjb25zdCBjb25maWcgPSB7IC4uLmJhc2VDb25maWcsIC4uLmN1c3RvbUNvbmZpZyB9O1xuXG4gIHJldHVybiBmdW5jdGlvbiAoaGFuZGxlcjogRnVuY3Rpb24pIHtcbiAgICByZXR1cm4gYXN5bmMgKHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QsIC4uLmFyZ3M6IGFueVtdKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByYXRlTGltaXRSZXN1bHQgPSBhd2FpdCBjaGVja1JhdGVMaW1pdChyZXF1ZXN0LCBjb25maWcsIGNvbmZpZ05hbWUpO1xuICAgICAgICBcbiAgICAgICAgLy8gQcOxYWRpciBoZWFkZXJzIGRlIHJhdGUgbGltaXRpbmdcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAgICAgICAnWC1SYXRlTGltaXQtTGltaXQnOiByYXRlTGltaXRSZXN1bHQubGltaXQudG9TdHJpbmcoKSxcbiAgICAgICAgICAnWC1SYXRlTGltaXQtUmVtYWluaW5nJzogcmF0ZUxpbWl0UmVzdWx0LnJlbWFpbmluZy50b1N0cmluZygpLFxuICAgICAgICAgICdYLVJhdGVMaW1pdC1SZXNldCc6IE1hdGguY2VpbChyYXRlTGltaXRSZXN1bHQucmVzZXRUaW1lIC8gMTAwMCkudG9TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChyYXRlTGltaXRSZXN1bHQucmV0cnlBZnRlcikge1xuICAgICAgICAgIGhlYWRlcnNbJ1JldHJ5LUFmdGVyJ10gPSByYXRlTGltaXRSZXN1bHQucmV0cnlBZnRlci50b1N0cmluZygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyYXRlTGltaXRSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgICAgIGNvbnN0IGVycm9yUmVzcG9uc2UgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiByYXRlTGltaXRSZXN1bHQuZXJyb3IsXG4gICAgICAgICAgICBjb2RlOiByYXRlTGltaXRSZXN1bHQuY29kZSxcbiAgICAgICAgICAgIHJhdGVMaW1pdDoge1xuICAgICAgICAgICAgICBsaW1pdDogcmF0ZUxpbWl0UmVzdWx0LmxpbWl0LFxuICAgICAgICAgICAgICByZW1haW5pbmc6IHJhdGVMaW1pdFJlc3VsdC5yZW1haW5pbmcsXG4gICAgICAgICAgICAgIHJlc2V0VGltZTogcmF0ZUxpbWl0UmVzdWx0LnJlc2V0VGltZSxcbiAgICAgICAgICAgICAgcmV0cnlBZnRlcjogcmF0ZUxpbWl0UmVzdWx0LnJldHJ5QWZ0ZXJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgaWYgKCdxdWVyeScgaW4gcmVxdWVzdCkge1xuICAgICAgICAgICAgLy8gUGFnZXMgUm91dGVyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhcmdzWzBdIGFzIGFueTtcbiAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGhlYWRlcnMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MjkpLmpzb24oZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEFwcCBSb3V0ZXJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoZXJyb3JSZXNwb25zZSksIHtcbiAgICAgICAgICAgICAgc3RhdHVzOiA0MjksXG4gICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgICAgIC4uLmhlYWRlcnNcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQcOxYWRpciBpbmZvcm1hY2nDs24gZGUgcmF0ZSBsaW1pdGluZyBhbCByZXF1ZXN0XG4gICAgICAgIChyZXF1ZXN0IGFzIGFueSkucmF0ZUxpbWl0ID0gcmF0ZUxpbWl0UmVzdWx0O1xuXG4gICAgICAgIC8vIEVqZWN1dGFyIGhhbmRsZXIgb3JpZ2luYWxcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBoYW5kbGVyKHJlcXVlc3QsIC4uLmFyZ3MpO1xuXG4gICAgICAgIC8vIEHDsWFkaXIgaGVhZGVycyBhIGxhIHJlc3B1ZXN0YSBzaSBlcyBwb3NpYmxlXG4gICAgICAgIGlmIChyZXNwb25zZSAmJiB0eXBlb2YgcmVzcG9uc2UuaGVhZGVycz8uc2V0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgT2JqZWN0LmVudHJpZXMoaGVhZGVycykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgICByZXNwb25zZS5oZWFkZXJzLnNldChrZXksIHZhbHVlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXNwb25zZTtcblxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW1JBVEVfTElNSVRdIEVycm9yIGVuIG1pZGRsZXdhcmU6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4gaGFuZGxlcihyZXF1ZXN0LCAuLi5hcmdzKTtcbiAgICAgIH1cbiAgICB9O1xuICB9O1xufVxuXG4vKipcbiAqIFJhdGUgbGltaXRpbmcgZXNwZWPDrWZpY28gcGFyYSBBUElzIGRlIGF1dGVudGljYWNpw7NuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoQXV0aFJhdGVMaW1pdCgpIHtcbiAgcmV0dXJuIHdpdGhSYXRlTGltaXQoJ2F1dGgnKTtcbn1cblxuLyoqXG4gKiBSYXRlIGxpbWl0aW5nIGVzcGVjw61maWNvIHBhcmEgQVBJcyBhZG1pblxuICovXG5leHBvcnQgZnVuY3Rpb24gd2l0aEFkbWluUmF0ZUxpbWl0KCkge1xuICByZXR1cm4gd2l0aFJhdGVMaW1pdCgnYWRtaW4nKTtcbn1cblxuLyoqXG4gKiBSYXRlIGxpbWl0aW5nIGVzcGVjw61maWNvIHBhcmEgQVBJcyBkZSBwcm9kdWN0b3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhQcm9kdWN0UmF0ZUxpbWl0KCkge1xuICByZXR1cm4gd2l0aFJhdGVMaW1pdCgncHJvZHVjdHMnKTtcbn1cblxuLyoqXG4gKiBSYXRlIGxpbWl0aW5nIGVzcGVjw61maWNvIHBhcmEgQVBJcyBkZSBwYWdvc1xuICovXG5leHBvcnQgZnVuY3Rpb24gd2l0aFBheW1lbnRSYXRlTGltaXQoKSB7XG4gIHJldHVybiB3aXRoUmF0ZUxpbWl0KCdwYXltZW50cycpO1xufVxuXG4vKipcbiAqIEZ1bmNpw7NuIHBhcmEgbGltcGlhciBtYW51YWxtZW50ZSBlbCByYXRlIGxpbWl0IGRlIHVuYSBjbGF2ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJSYXRlTGltaXQoa2V5OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIHJhdGVMaW1pdFN0b3JlLmRlbGV0ZShrZXkpO1xufVxuXG4vKipcbiAqIEZ1bmNpw7NuIHBhcmEgb2J0ZW5lciBlc3RhZMOtc3RpY2FzIGRlIHJhdGUgbGltaXRpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFJhdGVMaW1pdFN0YXRzKCk6IHtcbiAgdG90YWxLZXlzOiBudW1iZXI7XG4gIGFjdGl2ZUVudHJpZXM6IG51bWJlcjtcbiAgb2xkZXN0RW50cnk6IG51bWJlciB8IG51bGw7XG4gIG5ld2VzdEVudHJ5OiBudW1iZXIgfCBudWxsO1xufSB7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIGNvbnN0IGVudHJpZXMgPSBBcnJheS5mcm9tKHJhdGVMaW1pdFN0b3JlLnZhbHVlcygpKTtcbiAgY29uc3QgYWN0aXZlRW50cmllcyA9IGVudHJpZXMuZmlsdGVyKGVudHJ5ID0+IGVudHJ5LnJlc2V0VGltZSA+IG5vdyk7XG4gIFxuICByZXR1cm4ge1xuICAgIHRvdGFsS2V5czogcmF0ZUxpbWl0U3RvcmUuc2l6ZSxcbiAgICBhY3RpdmVFbnRyaWVzOiBhY3RpdmVFbnRyaWVzLmxlbmd0aCxcbiAgICBvbGRlc3RFbnRyeTogZW50cmllcy5sZW5ndGggPiAwID8gTWF0aC5taW4oLi4uZW50cmllcy5tYXAoZSA9PiBlLmZpcnN0UmVxdWVzdCkpIDogbnVsbCxcbiAgICBuZXdlc3RFbnRyeTogZW50cmllcy5sZW5ndGggPiAwID8gTWF0aC5tYXgoLi4uZW50cmllcy5tYXAoZSA9PiBlLmZpcnN0UmVxdWVzdCkpIDogbnVsbFxuICB9O1xufVxuIl0sIm5hbWVzIjpbIlJBVEVfTElNSVRfQ09ORklHUyIsImNoZWNrUmF0ZUxpbWl0IiwiY2xlYXJSYXRlTGltaXQiLCJnZXRSYXRlTGltaXRTdGF0cyIsIndpdGhBZG1pblJhdGVMaW1pdCIsIndpdGhBdXRoUmF0ZUxpbWl0Iiwid2l0aFBheW1lbnRSYXRlTGltaXQiLCJ3aXRoUHJvZHVjdFJhdGVMaW1pdCIsIndpdGhSYXRlTGltaXQiLCJhdXRoIiwid2luZG93TXMiLCJtYXhSZXF1ZXN0cyIsIm1lc3NhZ2UiLCJhZG1pbiIsInByb2R1Y3RzIiwicGF5bWVudHMiLCJnZW5lcmFsIiwicmF0ZUxpbWl0U3RvcmUiLCJNYXAiLCJzZXRJbnRlcnZhbCIsIm5vdyIsIkRhdGUiLCJrZXkiLCJlbnRyeSIsImVudHJpZXMiLCJyZXNldFRpbWUiLCJkZWxldGUiLCJnZW5lcmF0ZVJhdGVMaW1pdEtleSIsInJlcXVlc3QiLCJwcmVmaXgiLCJjbGllbnRJUCIsImlwIiwiZm9yd2FyZGVkIiwiZ2V0SGVhZGVyIiwicmVhbElQIiwiY2ZJUCIsInNwbGl0IiwidXNlckFnZW50IiwidXNlckFnZW50SGFzaCIsImhhc2hTdHJpbmciLCJoZWFkZXJOYW1lIiwiaGVhZGVycyIsImdldCIsImhlYWRlciIsIkFycmF5IiwiaXNBcnJheSIsInN0ciIsImhhc2giLCJpIiwibGVuZ3RoIiwiY2hhciIsImNoYXJDb2RlQXQiLCJNYXRoIiwiYWJzIiwidG9TdHJpbmciLCJjb25maWciLCJrZXlQcmVmaXgiLCJrZXlHZW5lcmF0b3IiLCJjb3VudCIsImZpcnN0UmVxdWVzdCIsInNldCIsImFsbG93ZWQiLCJsaW1pdCIsInJlbWFpbmluZyIsInJldHJ5QWZ0ZXIiLCJjZWlsIiwiZXJyb3IiLCJjb2RlIiwiY29uc29sZSIsImNvbmZpZ05hbWUiLCJjdXN0b21Db25maWciLCJiYXNlQ29uZmlnIiwiaGFuZGxlciIsImFyZ3MiLCJyYXRlTGltaXRSZXN1bHQiLCJlcnJvclJlc3BvbnNlIiwic3VjY2VzcyIsInJhdGVMaW1pdCIsInJlcyIsIk9iamVjdCIsImZvckVhY2giLCJ2YWx1ZSIsInNldEhlYWRlciIsInN0YXR1cyIsImpzb24iLCJSZXNwb25zZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXNwb25zZSIsImZyb20iLCJ2YWx1ZXMiLCJhY3RpdmVFbnRyaWVzIiwiZmlsdGVyIiwidG90YWxLZXlzIiwic2l6ZSIsIm9sZGVzdEVudHJ5IiwibWluIiwibWFwIiwiZSIsIm5ld2VzdEVudHJ5IiwibWF4Il0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0M7Ozs7Ozs7Ozs7O0lBc0NZQSxrQkFBa0I7ZUFBbEJBOztJQXFIU0MsY0FBYztlQUFkQTs7SUF1TE5DLGNBQWM7ZUFBZEE7O0lBT0FDLGlCQUFpQjtlQUFqQkE7O0lBNUJBQyxrQkFBa0I7ZUFBbEJBOztJQVBBQyxpQkFBaUI7ZUFBakJBOztJQXFCQUMsb0JBQW9CO2VBQXBCQTs7SUFQQUMsb0JBQW9CO2VBQXBCQTs7SUEvRkFDLGFBQWE7ZUFBYkE7OztBQS9MVCxNQUFNUixxQkFBcUI7SUFDaEMsMENBQTBDO0lBQzFDUyxNQUFNO1FBQ0pDLFVBQVUsS0FBSyxLQUFLO1FBQ3BCQyxhQUFhO1FBQ2JDLFNBQVM7SUFDWDtJQUVBLDJCQUEyQjtJQUMzQkMsT0FBTztRQUNMSCxVQUFVLElBQUksS0FBSztRQUNuQkMsYUFBYTtRQUNiQyxTQUFTO0lBQ1g7SUFFQSwrQkFBK0I7SUFDL0JFLFVBQVU7UUFDUkosVUFBVSxJQUFJLEtBQUs7UUFDbkJDLGFBQWE7UUFDYkMsU0FBUztJQUNYO0lBRUEsa0NBQWtDO0lBQ2xDRyxVQUFVO1FBQ1JMLFVBQVUsS0FBSyxLQUFLO1FBQ3BCQyxhQUFhO1FBQ2JDLFNBQVM7SUFDWDtJQUVBLDZCQUE2QjtJQUM3QkksU0FBUztRQUNQTixVQUFVLElBQUksS0FBSztRQUNuQkMsYUFBYTtRQUNiQyxTQUFTO0lBQ1g7QUFDRjtBQUVBLHdEQUF3RDtBQUN4RCw4Q0FBOEM7QUFDOUMs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