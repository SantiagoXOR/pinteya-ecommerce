e21eb8c93d8093f501042ffa9765254b
// ===================================
// HOOK: useRecentSearches - Gestión de búsquedas recientes con localStorage
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get default () {
        return _default;
    },
    get useRecentSearches () {
        return useRecentSearches;
    },
    get useRecentSearchesSimple () {
        return useRecentSearchesSimple;
    }
});
const _react = require("react");
const _jsonutils = require("../lib/json-utils");
const DEFAULT_OPTIONS = {
    maxSearches: 5,
    storageKey: 'pinteya-recent-searches',
    enablePersistence: true,
    filterDuplicates: true,
    expirationDays: 30
};
function useRecentSearches(options = {}) {
    const config = {
        ...DEFAULT_OPTIONS,
        ...options
    };
    const [recentSearches, setRecentSearches] = (0, _react.useState)([]);
    // Función para validar y limpiar una búsqueda
    const sanitizeSearch = (0, _react.useCallback)((search)=>{
        return search.trim().toLowerCase();
    }, []);
    // Función para verificar si los datos han expirado
    const isExpired = (0, _react.useCallback)((timestamp)=>{
        if (config.expirationDays === 0) return false;
        const maxAge = config.expirationDays * 24 * 60 * 60 * 1000;
        return Date.now() - timestamp > maxAge;
    }, [
        config.expirationDays
    ]);
    // Cargar búsquedas desde localStorage
    const loadFromStorage = (0, _react.useCallback)(()=>{
        if (!config.enablePersistence) {
            return [];
        }
        // Usar utilidad segura para cargar desde localStorage
        const result = (0, _jsonutils.safeLocalStorageGet)(config.storageKey);
        if (!result.success) {
            return [];
        }
        const data = result.data;
        // Verificar si es formato nuevo (con metadata)
        if (data && typeof data === 'object' && 'searches' in data && Array.isArray(data.searches)) {
            const persistedData = data;
            // Verificar expiración
            if (persistedData.timestamp && isExpired(persistedData.timestamp)) {
                // Limpiar datos expirados usando utilidad segura
                (0, _jsonutils.safeLocalStorageSet)(config.storageKey, {
                    searches: [],
                    timestamp: Date.now(),
                    version: '1.0'
                });
                return [];
            }
            return persistedData.searches.slice(0, config.maxSearches);
        }
        // Formato antiguo (array simple)
        if (Array.isArray(data)) {
            return data.slice(0, config.maxSearches);
        }
        return [];
    }, [
        config.enablePersistence,
        config.storageKey,
        config.maxSearches,
        isExpired
    ]);
    // Guardar búsquedas en localStorage
    const saveToStorage = (0, _react.useCallback)((searches)=>{
        if (!config.enablePersistence || typeof window === 'undefined') {
            return;
        }
        try {
            if (searches.length === 0) {
                localStorage.removeItem(config.storageKey);
                return;
            }
            const dataToStore = {
                searches: searches.slice(0, config.maxSearches),
                timestamp: Date.now(),
                version: '1.0.0'
            };
            localStorage.setItem(config.storageKey, JSON.stringify(dataToStore));
        } catch (error) {
            console.warn('Error saving recent searches to localStorage:', error);
        }
    }, [
        config.enablePersistence,
        config.storageKey,
        config.maxSearches
    ]);
    // Cargar búsquedas al inicializar
    (0, _react.useEffect)(()=>{
        const loaded = loadFromStorage();
        setRecentSearches(loaded);
    }, [
        loadFromStorage
    ]);
    // Agregar una nueva búsqueda
    const addSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        if (!sanitized || sanitized.length < 2) return;
        setRecentSearches((prev)=>{
            let updated = [
                ...prev
            ];
            // Remover duplicados si está habilitado
            if (config.filterDuplicates) {
                updated = updated.filter((s)=>sanitizeSearch(s) !== sanitized);
            }
            // Agregar al principio
            updated.unshift(search.trim());
            // Limitar al máximo configurado
            updated = updated.slice(0, config.maxSearches);
            // Guardar en localStorage
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        config.filterDuplicates,
        config.maxSearches,
        saveToStorage
    ]);
    // Remover una búsqueda específica
    const removeSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        setRecentSearches((prev)=>{
            const updated = prev.filter((s)=>sanitizeSearch(s) !== sanitized);
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        saveToStorage
    ]);
    // Limpiar todas las búsquedas
    const clearSearches = (0, _react.useCallback)(()=>{
        setRecentSearches([]);
        saveToStorage([]);
    }, [
        saveToStorage
    ]);
    // Verificar si una búsqueda existe
    const hasSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        return recentSearches.some((s)=>sanitizeSearch(s) === sanitized);
    }, [
        recentSearches,
        sanitizeSearch
    ]);
    // Obtener las N búsquedas más recientes
    const getRecentSearches = (0, _react.useCallback)((limit)=>{
        const actualLimit = limit ?? config.maxSearches;
        return recentSearches.slice(0, actualLimit);
    }, [
        recentSearches,
        config.maxSearches
    ]);
    // Mover una búsqueda al principio (reordenar)
    const moveToTop = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        setRecentSearches((prev)=>{
            const filtered = prev.filter((s)=>sanitizeSearch(s) !== sanitized);
            const existing = prev.find((s)=>sanitizeSearch(s) === sanitized);
            if (!existing) return prev;
            const updated = [
                existing,
                ...filtered
            ];
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        saveToStorage
    ]);
    return {
        recentSearches,
        addSearch,
        removeSearch,
        clearSearches,
        hasSearch,
        getRecentSearches,
        moveToTop
    };
}
function useRecentSearchesSimple(limit = 5) {
    const { getRecentSearches } = useRecentSearches({
        maxSearches: limit
    });
    return getRecentSearches();
}
const _default = useRecentSearches;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZVJlY2VudFNlYXJjaGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIT09LOiB1c2VSZWNlbnRTZWFyY2hlcyAtIEdlc3Rpw7NuIGRlIGLDunNxdWVkYXMgcmVjaWVudGVzIGNvbiBsb2NhbFN0b3JhZ2Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgc2FmZUxvY2FsU3RvcmFnZUdldCwgc2FmZUxvY2FsU3RvcmFnZVNldCwgU1RPUkFHRV9LRVlTIH0gZnJvbSAnQC9saWIvanNvbi11dGlscyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZW50U2VhcmNoZXNPcHRpb25zIHtcbiAgLyoqIE7Dum1lcm8gbcOheGltbyBkZSBiw7pzcXVlZGFzIHJlY2llbnRlcyBhIG1hbnRlbmVyICovXG4gIG1heFNlYXJjaGVzPzogbnVtYmVyO1xuICAvKiogQ2xhdmUgZGUgbG9jYWxTdG9yYWdlIHBhcmEgcGVyc2lzdGlyIGxhcyBiw7pzcXVlZGFzICovXG4gIHN0b3JhZ2VLZXk/OiBzdHJpbmc7XG4gIC8qKiBIYWJpbGl0YXIvZGVzaGFiaWxpdGFyIHBlcnNpc3RlbmNpYSBlbiBsb2NhbFN0b3JhZ2UgKi9cbiAgZW5hYmxlUGVyc2lzdGVuY2U/OiBib29sZWFuO1xuICAvKiogRmlsdHJhciBiw7pzcXVlZGFzIGR1cGxpY2FkYXMgKi9cbiAgZmlsdGVyRHVwbGljYXRlcz86IGJvb2xlYW47XG4gIC8qKiBUaWVtcG8gZGUgZXhwaXJhY2nDs24gZW4gZMOtYXMgKDAgPSBzaW4gZXhwaXJhY2nDs24pICovXG4gIGV4cGlyYXRpb25EYXlzPzogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlY2VudFNlYXJjaGVzUmV0dXJuIHtcbiAgLyoqIEFycmF5IGRlIGLDunNxdWVkYXMgcmVjaWVudGVzICovXG4gIHJlY2VudFNlYXJjaGVzOiBzdHJpbmdbXTtcbiAgLyoqIEFncmVnYXIgdW5hIG51ZXZhIGLDunNxdWVkYSAqL1xuICBhZGRTZWFyY2g6IChzZWFyY2g6IHN0cmluZykgPT4gdm9pZDtcbiAgLyoqIFJlbW92ZXIgdW5hIGLDunNxdWVkYSBlc3BlY8OtZmljYSAqL1xuICByZW1vdmVTZWFyY2g6IChzZWFyY2g6IHN0cmluZykgPT4gdm9pZDtcbiAgLyoqIExpbXBpYXIgdG9kYXMgbGFzIGLDunNxdWVkYXMgKi9cbiAgY2xlYXJTZWFyY2hlczogKCkgPT4gdm9pZDtcbiAgLyoqIFZlcmlmaWNhciBzaSB1bmEgYsO6c3F1ZWRhIGV4aXN0ZSAqL1xuICBoYXNTZWFyY2g6IChzZWFyY2g6IHN0cmluZykgPT4gYm9vbGVhbjtcbiAgLyoqIE9idGVuZXIgbGFzIE4gYsO6c3F1ZWRhcyBtw6FzIHJlY2llbnRlcyAqL1xuICBnZXRSZWNlbnRTZWFyY2hlczogKGxpbWl0PzogbnVtYmVyKSA9PiBzdHJpbmdbXTtcbiAgLyoqIFJlb3JkZW5hciBiw7pzcXVlZGFzIChtb3ZlciBhbCBwcmluY2lwaW8pICovXG4gIG1vdmVUb1RvcDogKHNlYXJjaDogc3RyaW5nKSA9PiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgUGVyc2lzdGVkU2VhcmNoRGF0YSB7XG4gIHNlYXJjaGVzOiBzdHJpbmdbXTtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIHZlcnNpb246IHN0cmluZztcbn1cblxuY29uc3QgREVGQVVMVF9PUFRJT05TOiBSZXF1aXJlZDxSZWNlbnRTZWFyY2hlc09wdGlvbnM+ID0ge1xuICBtYXhTZWFyY2hlczogNSxcbiAgc3RvcmFnZUtleTogJ3BpbnRleWEtcmVjZW50LXNlYXJjaGVzJyxcbiAgZW5hYmxlUGVyc2lzdGVuY2U6IHRydWUsXG4gIGZpbHRlckR1cGxpY2F0ZXM6IHRydWUsXG4gIGV4cGlyYXRpb25EYXlzOiAzMCwgLy8gMzAgZMOtYXMgZGUgZXhwaXJhY2nDs25cbn07XG5cbi8qKlxuICogSG9vayBwYXJhIGdlc3Rpb25hciBiw7pzcXVlZGFzIHJlY2llbnRlcyBjb24gcGVyc2lzdGVuY2lhIGVuIGxvY2FsU3RvcmFnZVxuICogXG4gKiBDYXJhY3RlcsOtc3RpY2FzOlxuICogLSBQZXJzaXN0ZW5jaWEgYXV0b23DoXRpY2EgZW4gbG9jYWxTdG9yYWdlXG4gKiAtIEzDrW1pdGUgY29uZmlndXJhYmxlIGRlIGLDunNxdWVkYXNcbiAqIC0gRmlsdHJhZG8gZGUgZHVwbGljYWRvc1xuICogLSBFeHBpcmFjacOzbiBhdXRvbcOhdGljYVxuICogLSBNYW5lam8gZGUgZXJyb3JlcyByb2J1c3RvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VSZWNlbnRTZWFyY2hlcyhvcHRpb25zOiBSZWNlbnRTZWFyY2hlc09wdGlvbnMgPSB7fSk6IFJlY2VudFNlYXJjaGVzUmV0dXJuIHtcbiAgY29uc3QgY29uZmlnID0geyAuLi5ERUZBVUxUX09QVElPTlMsIC4uLm9wdGlvbnMgfTtcbiAgY29uc3QgW3JlY2VudFNlYXJjaGVzLCBzZXRSZWNlbnRTZWFyY2hlc10gPSB1c2VTdGF0ZTxzdHJpbmdbXT4oW10pO1xuXG4gIC8vIEZ1bmNpw7NuIHBhcmEgdmFsaWRhciB5IGxpbXBpYXIgdW5hIGLDunNxdWVkYVxuICBjb25zdCBzYW5pdGl6ZVNlYXJjaCA9IHVzZUNhbGxiYWNrKChzZWFyY2g6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgcmV0dXJuIHNlYXJjaC50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgfSwgW10pO1xuXG4gIC8vIEZ1bmNpw7NuIHBhcmEgdmVyaWZpY2FyIHNpIGxvcyBkYXRvcyBoYW4gZXhwaXJhZG9cbiAgY29uc3QgaXNFeHBpcmVkID0gdXNlQ2FsbGJhY2soKHRpbWVzdGFtcDogbnVtYmVyKTogYm9vbGVhbiA9PiB7XG4gICAgaWYgKGNvbmZpZy5leHBpcmF0aW9uRGF5cyA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IG1heEFnZSA9IGNvbmZpZy5leHBpcmF0aW9uRGF5cyAqIDI0ICogNjAgKiA2MCAqIDEwMDA7XG4gICAgcmV0dXJuIERhdGUubm93KCkgLSB0aW1lc3RhbXAgPiBtYXhBZ2U7XG4gIH0sIFtjb25maWcuZXhwaXJhdGlvbkRheXNdKTtcblxuICAvLyBDYXJnYXIgYsO6c3F1ZWRhcyBkZXNkZSBsb2NhbFN0b3JhZ2VcbiAgY29uc3QgbG9hZEZyb21TdG9yYWdlID0gdXNlQ2FsbGJhY2soKCk6IHN0cmluZ1tdID0+IHtcbiAgICBpZiAoIWNvbmZpZy5lbmFibGVQZXJzaXN0ZW5jZSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIC8vIFVzYXIgdXRpbGlkYWQgc2VndXJhIHBhcmEgY2FyZ2FyIGRlc2RlIGxvY2FsU3RvcmFnZVxuICAgIGNvbnN0IHJlc3VsdCA9IHNhZmVMb2NhbFN0b3JhZ2VHZXQ8UGVyc2lzdGVkU2VhcmNoRGF0YSB8IHN0cmluZ1tdPihjb25maWcuc3RvcmFnZUtleSk7XG5cbiAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IHJlc3VsdC5kYXRhO1xuXG4gICAgLy8gVmVyaWZpY2FyIHNpIGVzIGZvcm1hdG8gbnVldm8gKGNvbiBtZXRhZGF0YSlcbiAgICBpZiAoZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgJ3NlYXJjaGVzJyBpbiBkYXRhICYmIEFycmF5LmlzQXJyYXkoZGF0YS5zZWFyY2hlcykpIHtcbiAgICAgIGNvbnN0IHBlcnNpc3RlZERhdGEgPSBkYXRhIGFzIFBlcnNpc3RlZFNlYXJjaERhdGE7XG5cbiAgICAgIC8vIFZlcmlmaWNhciBleHBpcmFjacOzblxuICAgICAgaWYgKHBlcnNpc3RlZERhdGEudGltZXN0YW1wICYmIGlzRXhwaXJlZChwZXJzaXN0ZWREYXRhLnRpbWVzdGFtcCkpIHtcbiAgICAgICAgLy8gTGltcGlhciBkYXRvcyBleHBpcmFkb3MgdXNhbmRvIHV0aWxpZGFkIHNlZ3VyYVxuICAgICAgICBzYWZlTG9jYWxTdG9yYWdlU2V0KGNvbmZpZy5zdG9yYWdlS2V5LCB7XG4gICAgICAgICAgc2VhcmNoZXM6IFtdLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICB2ZXJzaW9uOiAnMS4wJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcGVyc2lzdGVkRGF0YS5zZWFyY2hlcy5zbGljZSgwLCBjb25maWcubWF4U2VhcmNoZXMpO1xuICAgIH1cblxuICAgIC8vIEZvcm1hdG8gYW50aWd1byAoYXJyYXkgc2ltcGxlKVxuICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG4gICAgICByZXR1cm4gZGF0YS5zbGljZSgwLCBjb25maWcubWF4U2VhcmNoZXMpO1xuICAgIH1cblxuICAgIHJldHVybiBbXTtcbiAgfSwgW2NvbmZpZy5lbmFibGVQZXJzaXN0ZW5jZSwgY29uZmlnLnN0b3JhZ2VLZXksIGNvbmZpZy5tYXhTZWFyY2hlcywgaXNFeHBpcmVkXSk7XG5cbiAgLy8gR3VhcmRhciBiw7pzcXVlZGFzIGVuIGxvY2FsU3RvcmFnZVxuICBjb25zdCBzYXZlVG9TdG9yYWdlID0gdXNlQ2FsbGJhY2soKHNlYXJjaGVzOiBzdHJpbmdbXSk6IHZvaWQgPT4ge1xuICAgIGlmICghY29uZmlnLmVuYWJsZVBlcnNpc3RlbmNlIHx8IHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGlmIChzZWFyY2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oY29uZmlnLnN0b3JhZ2VLZXkpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRhdGFUb1N0b3JlOiBQZXJzaXN0ZWRTZWFyY2hEYXRhID0ge1xuICAgICAgICBzZWFyY2hlczogc2VhcmNoZXMuc2xpY2UoMCwgY29uZmlnLm1heFNlYXJjaGVzKSxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICB2ZXJzaW9uOiAnMS4wLjAnXG4gICAgICB9O1xuXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjb25maWcuc3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkoZGF0YVRvU3RvcmUpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBzYXZpbmcgcmVjZW50IHNlYXJjaGVzIHRvIGxvY2FsU3RvcmFnZTonLCBlcnJvcik7XG4gICAgfVxuICB9LCBbY29uZmlnLmVuYWJsZVBlcnNpc3RlbmNlLCBjb25maWcuc3RvcmFnZUtleSwgY29uZmlnLm1heFNlYXJjaGVzXSk7XG5cbiAgLy8gQ2FyZ2FyIGLDunNxdWVkYXMgYWwgaW5pY2lhbGl6YXJcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBsb2FkZWQgPSBsb2FkRnJvbVN0b3JhZ2UoKTtcbiAgICBzZXRSZWNlbnRTZWFyY2hlcyhsb2FkZWQpO1xuICB9LCBbbG9hZEZyb21TdG9yYWdlXSk7XG5cbiAgLy8gQWdyZWdhciB1bmEgbnVldmEgYsO6c3F1ZWRhXG4gIGNvbnN0IGFkZFNlYXJjaCA9IHVzZUNhbGxiYWNrKChzZWFyY2g6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplU2VhcmNoKHNlYXJjaCk7XG4gICAgaWYgKCFzYW5pdGl6ZWQgfHwgc2FuaXRpemVkLmxlbmd0aCA8IDIpIHJldHVybjtcblxuICAgIHNldFJlY2VudFNlYXJjaGVzKHByZXYgPT4ge1xuICAgICAgbGV0IHVwZGF0ZWQgPSBbLi4ucHJldl07XG5cbiAgICAgIC8vIFJlbW92ZXIgZHVwbGljYWRvcyBzaSBlc3TDoSBoYWJpbGl0YWRvXG4gICAgICBpZiAoY29uZmlnLmZpbHRlckR1cGxpY2F0ZXMpIHtcbiAgICAgICAgdXBkYXRlZCA9IHVwZGF0ZWQuZmlsdGVyKHMgPT4gc2FuaXRpemVTZWFyY2gocykgIT09IHNhbml0aXplZCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFncmVnYXIgYWwgcHJpbmNpcGlvXG4gICAgICB1cGRhdGVkLnVuc2hpZnQoc2VhcmNoLnRyaW0oKSk7XG5cbiAgICAgIC8vIExpbWl0YXIgYWwgbcOheGltbyBjb25maWd1cmFkb1xuICAgICAgdXBkYXRlZCA9IHVwZGF0ZWQuc2xpY2UoMCwgY29uZmlnLm1heFNlYXJjaGVzKTtcblxuICAgICAgLy8gR3VhcmRhciBlbiBsb2NhbFN0b3JhZ2VcbiAgICAgIHNhdmVUb1N0b3JhZ2UodXBkYXRlZCk7XG5cbiAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgIH0pO1xuICB9LCBbc2FuaXRpemVTZWFyY2gsIGNvbmZpZy5maWx0ZXJEdXBsaWNhdGVzLCBjb25maWcubWF4U2VhcmNoZXMsIHNhdmVUb1N0b3JhZ2VdKTtcblxuICAvLyBSZW1vdmVyIHVuYSBiw7pzcXVlZGEgZXNwZWPDrWZpY2FcbiAgY29uc3QgcmVtb3ZlU2VhcmNoID0gdXNlQ2FsbGJhY2soKHNlYXJjaDogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgY29uc3Qgc2FuaXRpemVkID0gc2FuaXRpemVTZWFyY2goc2VhcmNoKTtcbiAgICBcbiAgICBzZXRSZWNlbnRTZWFyY2hlcyhwcmV2ID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBwcmV2LmZpbHRlcihzID0+IHNhbml0aXplU2VhcmNoKHMpICE9PSBzYW5pdGl6ZWQpO1xuICAgICAgc2F2ZVRvU3RvcmFnZSh1cGRhdGVkKTtcbiAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgIH0pO1xuICB9LCBbc2FuaXRpemVTZWFyY2gsIHNhdmVUb1N0b3JhZ2VdKTtcblxuICAvLyBMaW1waWFyIHRvZGFzIGxhcyBiw7pzcXVlZGFzXG4gIGNvbnN0IGNsZWFyU2VhcmNoZXMgPSB1c2VDYWxsYmFjaygoKTogdm9pZCA9PiB7XG4gICAgc2V0UmVjZW50U2VhcmNoZXMoW10pO1xuICAgIHNhdmVUb1N0b3JhZ2UoW10pO1xuICB9LCBbc2F2ZVRvU3RvcmFnZV0pO1xuXG4gIC8vIFZlcmlmaWNhciBzaSB1bmEgYsO6c3F1ZWRhIGV4aXN0ZVxuICBjb25zdCBoYXNTZWFyY2ggPSB1c2VDYWxsYmFjaygoc2VhcmNoOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVNlYXJjaChzZWFyY2gpO1xuICAgIHJldHVybiByZWNlbnRTZWFyY2hlcy5zb21lKHMgPT4gc2FuaXRpemVTZWFyY2gocykgPT09IHNhbml0aXplZCk7XG4gIH0sIFtyZWNlbnRTZWFyY2hlcywgc2FuaXRpemVTZWFyY2hdKTtcblxuICAvLyBPYnRlbmVyIGxhcyBOIGLDunNxdWVkYXMgbcOhcyByZWNpZW50ZXNcbiAgY29uc3QgZ2V0UmVjZW50U2VhcmNoZXMgPSB1c2VDYWxsYmFjaygobGltaXQ/OiBudW1iZXIpOiBzdHJpbmdbXSA9PiB7XG4gICAgY29uc3QgYWN0dWFsTGltaXQgPSBsaW1pdCA/PyBjb25maWcubWF4U2VhcmNoZXM7XG4gICAgcmV0dXJuIHJlY2VudFNlYXJjaGVzLnNsaWNlKDAsIGFjdHVhbExpbWl0KTtcbiAgfSwgW3JlY2VudFNlYXJjaGVzLCBjb25maWcubWF4U2VhcmNoZXNdKTtcblxuICAvLyBNb3ZlciB1bmEgYsO6c3F1ZWRhIGFsIHByaW5jaXBpbyAocmVvcmRlbmFyKVxuICBjb25zdCBtb3ZlVG9Ub3AgPSB1c2VDYWxsYmFjaygoc2VhcmNoOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVNlYXJjaChzZWFyY2gpO1xuICAgIFxuICAgIHNldFJlY2VudFNlYXJjaGVzKHByZXYgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyZWQgPSBwcmV2LmZpbHRlcihzID0+IHNhbml0aXplU2VhcmNoKHMpICE9PSBzYW5pdGl6ZWQpO1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBwcmV2LmZpbmQocyA9PiBzYW5pdGl6ZVNlYXJjaChzKSA9PT0gc2FuaXRpemVkKTtcbiAgICAgIFxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIHByZXY7XG4gICAgICBcbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBbZXhpc3RpbmcsIC4uLmZpbHRlcmVkXTtcbiAgICAgIHNhdmVUb1N0b3JhZ2UodXBkYXRlZCk7XG4gICAgICByZXR1cm4gdXBkYXRlZDtcbiAgICB9KTtcbiAgfSwgW3Nhbml0aXplU2VhcmNoLCBzYXZlVG9TdG9yYWdlXSk7XG5cbiAgcmV0dXJuIHtcbiAgICByZWNlbnRTZWFyY2hlcyxcbiAgICBhZGRTZWFyY2gsXG4gICAgcmVtb3ZlU2VhcmNoLFxuICAgIGNsZWFyU2VhcmNoZXMsXG4gICAgaGFzU2VhcmNoLFxuICAgIGdldFJlY2VudFNlYXJjaGVzLFxuICAgIG1vdmVUb1RvcCxcbiAgfTtcbn1cblxuLyoqXG4gKiBIb29rIHNpbXBsaWZpY2FkbyBwYXJhIHNvbG8gb2J0ZW5lciBiw7pzcXVlZGFzIHJlY2llbnRlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlUmVjZW50U2VhcmNoZXNTaW1wbGUobGltaXQ6IG51bWJlciA9IDUpOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHsgZ2V0UmVjZW50U2VhcmNoZXMgfSA9IHVzZVJlY2VudFNlYXJjaGVzKHsgbWF4U2VhcmNoZXM6IGxpbWl0IH0pO1xuICByZXR1cm4gZ2V0UmVjZW50U2VhcmNoZXMoKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgdXNlUmVjZW50U2VhcmNoZXM7XG4iXSwibmFtZXMiOlsidXNlUmVjZW50U2VhcmNoZXMiLCJ1c2VSZWNlbnRTZWFyY2hlc1NpbXBsZSIsIkRFRkFVTFRfT1BUSU9OUyIsIm1heFNlYXJjaGVzIiwic3RvcmFnZUtleSIsImVuYWJsZVBlcnNpc3RlbmNlIiwiZmlsdGVyRHVwbGljYXRlcyIsImV4cGlyYXRpb25EYXlzIiwib3B0aW9ucyIsImNvbmZpZyIsInJlY2VudFNlYXJjaGVzIiwic2V0UmVjZW50U2VhcmNoZXMiLCJ1c2VTdGF0ZSIsInNhbml0aXplU2VhcmNoIiwidXNlQ2FsbGJhY2siLCJzZWFyY2giLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJpc0V4cGlyZWQiLCJ0aW1lc3RhbXAiLCJtYXhBZ2UiLCJEYXRlIiwibm93IiwibG9hZEZyb21TdG9yYWdlIiwicmVzdWx0Iiwic2FmZUxvY2FsU3RvcmFnZUdldCIsInN1Y2Nlc3MiLCJkYXRhIiwiQXJyYXkiLCJpc0FycmF5Iiwic2VhcmNoZXMiLCJwZXJzaXN0ZWREYXRhIiwic2FmZUxvY2FsU3RvcmFnZVNldCIsInZlcnNpb24iLCJzbGljZSIsInNhdmVUb1N0b3JhZ2UiLCJ3aW5kb3ciLCJsZW5ndGgiLCJsb2NhbFN0b3JhZ2UiLCJyZW1vdmVJdGVtIiwiZGF0YVRvU3RvcmUiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImVycm9yIiwiY29uc29sZSIsIndhcm4iLCJ1c2VFZmZlY3QiLCJsb2FkZWQiLCJhZGRTZWFyY2giLCJzYW5pdGl6ZWQiLCJwcmV2IiwidXBkYXRlZCIsImZpbHRlciIsInMiLCJ1bnNoaWZ0IiwicmVtb3ZlU2VhcmNoIiwiY2xlYXJTZWFyY2hlcyIsImhhc1NlYXJjaCIsInNvbWUiLCJnZXRSZWNlbnRTZWFyY2hlcyIsImxpbWl0IiwiYWN0dWFsTGltaXQiLCJtb3ZlVG9Ub3AiLCJmaWx0ZXJlZCIsImV4aXN0aW5nIiwiZmluZCJdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBQ3RDLDRFQUE0RTtBQUM1RSxzQ0FBc0M7Ozs7Ozs7Ozs7OztRQTRPdEM7ZUFBQTs7UUFqTGdCQTtlQUFBQTs7UUE0S0FDO2VBQUFBOzs7dUJBck9pQzsyQkFDc0I7QUFzQ3ZFLE1BQU1DLGtCQUFtRDtJQUN2REMsYUFBYTtJQUNiQyxZQUFZO0lBQ1pDLG1CQUFtQjtJQUNuQkMsa0JBQWtCO0lBQ2xCQyxnQkFB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