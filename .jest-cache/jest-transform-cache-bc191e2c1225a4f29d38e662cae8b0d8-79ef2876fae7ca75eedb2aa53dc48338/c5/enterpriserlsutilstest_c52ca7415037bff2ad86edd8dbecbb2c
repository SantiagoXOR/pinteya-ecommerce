d1ddc9f266c6a9a669401bcb1fd14fcb
/**
 * Tests para las Utilidades RLS Enterprise
 * Verifica que Row Level Security funciona correctamente con las utilidades enterprise
 */ // Mock de Supabase
"use strict";
jest.mock('@/lib/supabase', ()=>({
        supabaseAdmin: {
            from: jest.fn(()=>({
                    select: jest.fn(()=>({
                            eq: jest.fn(()=>({
                                    single: jest.fn()
                                }))
                        })),
                    insert: jest.fn(()=>({
                            select: jest.fn(()=>({
                                    single: jest.fn()
                                }))
                        }))
                }))
        }
    }));
// Mock de createClient de Supabase
jest.mock('@supabase/supabase-js', ()=>({
        createClient: jest.fn(()=>({
                from: jest.fn(()=>({
                        select: jest.fn(()=>({
                                eq: jest.fn(()=>({
                                        single: jest.fn()
                                    }))
                            }))
                    }))
            }))
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _enterpriserlsutils = require("../lib/auth/enterprise-rls-utils");
const _supabase = require("../lib/supabase");
const _supabasejs = require("@supabase/supabase-js");
describe('Utilidades RLS Enterprise', ()=>{
    let mockEnterpriseContext;
    beforeEach(()=>{
        jest.clearAllMocks();
        // Mock enterprise context
        mockEnterpriseContext = {
            userId: 'user_123',
            sessionId: 'sess_123',
            email: 'admin@test.com',
            role: 'admin',
            permissions: [
                'admin_access',
                'products_create',
                'products_read'
            ],
            sessionValid: true,
            securityLevel: 'critical',
            ipAddress: '127.0.0.1',
            userAgent: 'test-agent',
            supabase: _supabase.supabaseAdmin,
            validations: {
                jwtValid: true,
                csrfValid: true,
                rateLimitPassed: true,
                originValid: true
            }
        };
        // Mock Supabase admin response
        _supabase.supabaseAdmin.from.mockReturnValue({
            select: jest.fn().mockReturnValue({
                eq: jest.fn().mockReturnValue({
                    single: jest.fn().mockResolvedValue({
                        data: {
                            id: 'profile_123',
                            supabase_user_id: 'supabase_123',
                            clerk_user_id: 'user_123',
                            role_id: 1,
                            permissions: [
                                'admin_access',
                                'products_create'
                            ],
                            is_active: true,
                            user_roles: {
                                role_name: 'admin'
                            }
                        },
                        error: null
                    })
                })
            })
        });
    });
    describe('validateRLSContext', ()=>{
        it('debe validar contexto RLS para usuario admin', async ()=>{
            const result = await (0, _enterpriserlsutils.validateRLSContext)(mockEnterpriseContext);
            expect(result.valid).toBe(true);
            expect(result.context).toBeDefined();
            expect(result.context?.userId).toBe('user_123');
            expect(result.context?.role).toBe('admin');
            expect(result.context?.permissions).toContain('admin_access');
            expect(result.context?.isActive).toBe(true);
        });
        it('debe fallar si usuario está inactivo', async ()=>{
            _supabase.supabaseAdmin.from.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        single: jest.fn().mockResolvedValue({
                            data: {
                                id: 'profile_123',
                                is_active: false,
                                user_roles: {
                                    role_name: 'user'
                                }
                            },
                            error: null
                        })
                    })
                })
            });
            const result = await (0, _enterpriserlsutils.validateRLSContext)(mockEnterpriseContext);
            expect(result.valid).toBe(false);
            expect(result.error).toBe('Usuario inactivo o no encontrado');
            expect(result.code).toBe('USER_INACTIVE');
        });
        it('debe fallar si hay error en Supabase', async ()=>{
            _supabase.supabaseAdmin.from.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        single: jest.fn().mockResolvedValue({
                            data: null,
                            error: {
                                message: 'Database error'
                            }
                        })
                    })
                })
            });
            const result = await (0, _enterpriserlsutils.validateRLSContext)(mockEnterpriseContext);
            expect(result.valid).toBe(false);
            expect(result.error).toBe('Error obteniendo perfil de usuario');
            expect(result.code).toBe('PROFILE_ERROR');
        });
    });
    describe('createUserSupabaseClient', ()=>{
        it('debe crear cliente Supabase con contexto de usuario', ()=>{
            // Mock environment variables
            process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';
            process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'test-anon-key';
            const client = (0, _enterpriserlsutils.createUserSupabaseClient)('supabase_123', 'access-token');
            expect(client).toBeDefined();
            expect(_supabasejs.createClient).toHaveBeenCalledWith('https://test.supabase.co', 'test-anon-key', expect.objectContaining({
                auth: {
                    autoRefreshToken: false,
                    persistSession: false
                },
                global: {
                    headers: {
                        'X-User-ID': 'supabase_123',
                        'Authorization': 'Bearer access-token'
                    }
                }
            }));
        });
        it('debe retornar null si configuración no está disponible', ()=>{
            delete process.env.NEXT_PUBLIC_SUPABASE_URL;
            delete process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
            const client = (0, _enterpriserlsutils.createUserSupabaseClient)('supabase_123');
            expect(client).toBeNull();
        });
    });
    describe('executeWithRLS', ()=>{
        it('debe ejecutar consulta con RLS habilitado', async ()=>{
            const mockQueryFunction = jest.fn().mockResolvedValue({
                products: [
                    {
                        id: 1,
                        name: 'Test Product'
                    }
                ],
                total: 1
            });
            const result = await (0, _enterpriserlsutils.executeWithRLS)(mockEnterpriseContext, mockQueryFunction, {
                enforceRLS: true,
                auditLog: true
            });
            expect(result.success).toBe(true);
            expect(result.data).toBeDefined();
            expect(mockQueryFunction).toHaveBeenCalled();
        });
        it('debe usar cliente admin para bypass RLS si es admin', async ()=>{
            const mockQueryFunction = jest.fn().mockResolvedValue({
                data: 'test'
            });
            const result = await (0, _enterpriserlsutils.executeWithRLS)(mockEnterpriseContext, mockQueryFunction, {
                bypassRLS: true
            });
            expect(result.success).toBe(true);
            expect(mockQueryFunction).toHaveBeenCalledWith(_supabase.supabaseAdmin, expect.objectContaining({
                role: 'admin'
            }));
        });
        it('debe fallar si validación RLS falla', async ()=>{
            _supabase.supabaseAdmin.from.mockReturnValue({
                select: jest.fn().mockReturnValue({
                    eq: jest.fn().mockReturnValue({
                        single: jest.fn().mockResolvedValue({
                            data: null,
                            error: {
                                message: 'User not found'
                            }
                        })
                    })
                })
            });
            const mockQueryFunction = jest.fn();
            const result = await (0, _enterpriserlsutils.executeWithRLS)(mockEnterpriseContext, mockQueryFunction);
            expect(result.success).toBe(false);
            expect(result.error).toBe('Error obteniendo perfil de usuario');
            expect(mockQueryFunction).not.toHaveBeenCalled();
        });
    });
    describe('checkRLSPermission', ()=>{
        it('debe permitir acceso a admin siempre', ()=>{
            const rlsContext = {
                userId: 'user_123',
                role: 'admin',
                permissions: [],
                isActive: true
            };
            const hasPermission = (0, _enterpriserlsutils.checkRLSPermission)(rlsContext, 'any_permission');
            expect(hasPermission).toBe(true);
        });
        it('debe permitir acceso si usuario tiene permiso específico', ()=>{
            const rlsContext = {
                userId: 'user_123',
                role: 'user',
                permissions: [
                    'products_read'
                ],
                isActive: true
            };
            const hasPermission = (0, _enterpriserlsutils.checkRLSPermission)(rlsContext, 'products_read');
            expect(hasPermission).toBe(true);
        });
        it('debe permitir acceso si usuario es propietario del recurso', ()=>{
            const rlsContext = {
                userId: 'user_123',
                role: 'user',
                permissions: [],
                isActive: true
            };
            const hasPermission = (0, _enterpriserlsutils.checkRLSPermission)(rlsContext, 'edit_profile', 'user_123');
            expect(hasPermission).toBe(true);
        });
        it('debe denegar acceso si no tiene permisos', ()=>{
            const rlsContext = {
                userId: 'user_123',
                role: 'user',
                permissions: [
                    'basic_access'
                ],
                isActive: true
            };
            const hasPermission = (0, _enterpriserlsutils.checkRLSPermission)(rlsContext, 'admin_access');
            expect(hasPermission).toBe(false);
        });
    });
    describe('createRLSFilters', ()=>{
        it('debe crear filtros para user_profiles para usuario normal', ()=>{
            const rlsContext = {
                userId: 'user_123',
                role: 'user',
                permissions: [],
                isActive: true
            };
            const filters = (0, _enterpriserlsutils.createRLSFilters)(rlsContext, 'user_profiles');
            expect(filters).toEqual({
                clerk_user_id: 'user_123'
            });
        });
        it('debe crear filtros para products para usuario normal', ()=>{
            const rlsContext = {
                userId: 'user_123',
                role: 'user',
                permissions: [],
                isActive: true
            };
            const filters = (0, _enterpriserlsutils.createRLSFilters)(rlsContext, 'products');
            expect(filters).toEqual({
                is_active: true
            });
        });
        it('no debe crear filtros para admin', ()=>{
            const rlsContext = {
                userId: 'user_123',
                role: 'admin',
                permissions: [
                    'admin_access'
                ],
                isActive: true
            };
            const filters = (0, _enterpriserlsutils.createRLSFilters)(rlsContext, 'products');
            expect(filters).toEqual({});
        });
        it('debe crear filtros para orders para usuario normal', ()=>{
            const rlsContext = {
                userId: 'user_123',
                role: 'user',
                permissions: [],
                isActive: true
            };
            const filters = (0, _enterpriserlsutils.createRLSFilters)(rlsContext, 'orders');
            expect(filters).toEqual({
                user_id: 'user_123'
            });
        });
    });
    describe('withRLS middleware', ()=>{
        it('debe ejecutar handler si contexto enterprise está disponible', async ()=>{
            const mockRequest = {
                enterpriseAuth: mockEnterpriseContext
            };
            const mockResponse = {
                status: jest.fn(),
                json: jest.fn()
            };
            const mockHandler = jest.fn().mockResolvedValue({
                success: true
            });
            const middleware = (0, _enterpriserlsutils.withRLS)();
            const wrappedHandler = middleware(mockHandler);
            const result = await wrappedHandler(mockRequest, mockResponse);
            expect(mockHandler).toHaveBeenCalledWith(mockRequest, mockResponse);
            expect(mockRequest.rlsContext).toBeDefined();
        });
        it('debe retornar error si contexto enterprise no está disponible', async ()=>{
            const mockRequest = {};
            const mockResponse = {
                status: jest.fn().mockReturnThis(),
                json: jest.fn()
            };
            const mockHandler = jest.fn();
            const middleware = (0, _enterpriserlsutils.withRLS)();
            const wrappedHandler = middleware(mockHandler);
            await wrappedHandler(mockRequest, mockResponse);
            expect(mockHandler).not.toHaveBeenCalled();
            expect(mockResponse.status).toHaveBeenCalledWith(401);
            expect(mockResponse.json).toHaveBeenCalledWith(expect.objectContaining({
                success: false,
                error: 'Contexto enterprise no disponible',
                code: 'NO_ENTERPRISE_CONTEXT'
            }));
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcX190ZXN0c19fXFxlbnRlcnByaXNlLXJscy11dGlscy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgcGFyYSBsYXMgVXRpbGlkYWRlcyBSTFMgRW50ZXJwcmlzZVxuICogVmVyaWZpY2EgcXVlIFJvdyBMZXZlbCBTZWN1cml0eSBmdW5jaW9uYSBjb3JyZWN0YW1lbnRlIGNvbiBsYXMgdXRpbGlkYWRlcyBlbnRlcnByaXNlXG4gKi9cblxuLy8gTW9jayBkZSBTdXBhYmFzZVxuamVzdC5tb2NrKCdAL2xpYi9zdXBhYmFzZScsICgpID0+ICh7XG4gIHN1cGFiYXNlQWRtaW46IHtcbiAgICBmcm9tOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgZXE6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgICBzaW5nbGU6IGplc3QuZm4oKVxuICAgICAgICB9KSlcbiAgICAgIH0pKSxcbiAgICAgIGluc2VydDogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgICBzaW5nbGU6IGplc3QuZm4oKVxuICAgICAgICB9KSlcbiAgICAgIH0pKVxuICAgIH0pKVxuICB9XG59KSk7XG5cbi8vIE1vY2sgZGUgY3JlYXRlQ2xpZW50IGRlIFN1cGFiYXNlXG5qZXN0Lm1vY2soJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcycsICgpID0+ICh7XG4gIGNyZWF0ZUNsaWVudDogamVzdC5mbigoKSA9PiAoe1xuICAgIGZyb206IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgIHNlbGVjdDogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpXG4gICAgICAgIH0pKVxuICAgICAgfSkpXG4gICAgfSkpXG4gIH0pKVxufSkpO1xuXG5pbXBvcnQge1xuICB2YWxpZGF0ZVJMU0NvbnRleHQsXG4gIGNyZWF0ZVVzZXJTdXBhYmFzZUNsaWVudCxcbiAgZXhlY3V0ZVdpdGhSTFMsXG4gIGNoZWNrUkxTUGVybWlzc2lvbixcbiAgY3JlYXRlUkxTRmlsdGVycyxcbiAgd2l0aFJMU1xufSBmcm9tICdAL2xpYi9hdXRoL2VudGVycHJpc2UtcmxzLXV0aWxzJztcbmltcG9ydCB0eXBlIHsgRW50ZXJwcmlzZUF1dGhDb250ZXh0IH0gZnJvbSAnQC9saWIvYXV0aC9lbnRlcnByaXNlLWF1dGgtdXRpbHMnO1xuaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbmRlc2NyaWJlKCdVdGlsaWRhZGVzIFJMUyBFbnRlcnByaXNlJywgKCkgPT4ge1xuICBsZXQgbW9ja0VudGVycHJpc2VDb250ZXh0OiBFbnRlcnByaXNlQXV0aENvbnRleHQ7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG5cbiAgICAvLyBNb2NrIGVudGVycHJpc2UgY29udGV4dFxuICAgIG1vY2tFbnRlcnByaXNlQ29udGV4dCA9IHtcbiAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcbiAgICAgIHNlc3Npb25JZDogJ3Nlc3NfMTIzJyxcbiAgICAgIGVtYWlsOiAnYWRtaW5AdGVzdC5jb20nLFxuICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgIHBlcm1pc3Npb25zOiBbJ2FkbWluX2FjY2VzcycsICdwcm9kdWN0c19jcmVhdGUnLCAncHJvZHVjdHNfcmVhZCddLFxuICAgICAgc2Vzc2lvblZhbGlkOiB0cnVlLFxuICAgICAgc2VjdXJpdHlMZXZlbDogJ2NyaXRpY2FsJyxcbiAgICAgIGlwQWRkcmVzczogJzEyNy4wLjAuMScsXG4gICAgICB1c2VyQWdlbnQ6ICd0ZXN0LWFnZW50JyxcbiAgICAgIHN1cGFiYXNlOiBzdXBhYmFzZUFkbWluLFxuICAgICAgdmFsaWRhdGlvbnM6IHtcbiAgICAgICAgand0VmFsaWQ6IHRydWUsXG4gICAgICAgIGNzcmZWYWxpZDogdHJ1ZSxcbiAgICAgICAgcmF0ZUxpbWl0UGFzc2VkOiB0cnVlLFxuICAgICAgICBvcmlnaW5WYWxpZDogdHJ1ZVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBNb2NrIFN1cGFiYXNlIGFkbWluIHJlc3BvbnNlXG4gICAgKHN1cGFiYXNlQWRtaW4uZnJvbSBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBpZDogJ3Byb2ZpbGVfMTIzJyxcbiAgICAgICAgICAgICAgc3VwYWJhc2VfdXNlcl9pZDogJ3N1cGFiYXNlXzEyMycsXG4gICAgICAgICAgICAgIGNsZXJrX3VzZXJfaWQ6ICd1c2VyXzEyMycsXG4gICAgICAgICAgICAgIHJvbGVfaWQ6IDEsXG4gICAgICAgICAgICAgIHBlcm1pc3Npb25zOiBbJ2FkbWluX2FjY2VzcycsICdwcm9kdWN0c19jcmVhdGUnXSxcbiAgICAgICAgICAgICAgaXNfYWN0aXZlOiB0cnVlLFxuICAgICAgICAgICAgICB1c2VyX3JvbGVzOiB7IHJvbGVfbmFtZTogJ2FkbWluJyB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IG51bGxcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlUkxTQ29udGV4dCcsICgpID0+IHtcbiAgICBpdCgnZGViZSB2YWxpZGFyIGNvbnRleHRvIFJMUyBwYXJhIHVzdWFyaW8gYWRtaW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZVJMU0NvbnRleHQobW9ja0VudGVycHJpc2VDb250ZXh0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29udGV4dCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29udGV4dD8udXNlcklkKS50b0JlKCd1c2VyXzEyMycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb250ZXh0Py5yb2xlKS50b0JlKCdhZG1pbicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb250ZXh0Py5wZXJtaXNzaW9ucykudG9Db250YWluKCdhZG1pbl9hY2Nlc3MnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29udGV4dD8uaXNBY3RpdmUpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSBmYWxsYXIgc2kgdXN1YXJpbyBlc3TDoSBpbmFjdGl2bycsIGFzeW5jICgpID0+IHtcbiAgICAgIChzdXBhYmFzZUFkbWluLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGlkOiAncHJvZmlsZV8xMjMnLFxuICAgICAgICAgICAgICAgIGlzX2FjdGl2ZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgdXNlcl9yb2xlczogeyByb2xlX25hbWU6ICd1c2VyJyB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGVycm9yOiBudWxsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVSTFNDb250ZXh0KG1vY2tFbnRlcnByaXNlQ29udGV4dCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgnVXN1YXJpbyBpbmFjdGl2byBvIG5vIGVuY29udHJhZG8nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29kZSkudG9CZSgnVVNFUl9JTkFDVElWRScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgZmFsbGFyIHNpIGhheSBlcnJvciBlbiBTdXBhYmFzZScsIGFzeW5jICgpID0+IHtcbiAgICAgIChzdXBhYmFzZUFkbWluLmZyb20gYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIGVxOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ0RhdGFiYXNlIGVycm9yJyB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVSTFNDb250ZXh0KG1vY2tFbnRlcnByaXNlQ29udGV4dCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgnRXJyb3Igb2J0ZW5pZW5kbyBwZXJmaWwgZGUgdXN1YXJpbycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb2RlKS50b0JlKCdQUk9GSUxFX0VSUk9SJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVVc2VyU3VwYWJhc2VDbGllbnQnLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgY3JlYXIgY2xpZW50ZSBTdXBhYmFzZSBjb24gY29udGV4dG8gZGUgdXN1YXJpbycsICgpID0+IHtcbiAgICAgIC8vIE1vY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgPSAnaHR0cHM6Ly90ZXN0LnN1cGFiYXNlLmNvJztcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZID0gJ3Rlc3QtYW5vbi1rZXknO1xuXG4gICAgICBjb25zdCBjbGllbnQgPSBjcmVhdGVVc2VyU3VwYWJhc2VDbGllbnQoJ3N1cGFiYXNlXzEyMycsICdhY2Nlc3MtdG9rZW4nKTtcblxuICAgICAgZXhwZWN0KGNsaWVudCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChjcmVhdGVDbGllbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnaHR0cHM6Ly90ZXN0LnN1cGFiYXNlLmNvJyxcbiAgICAgICAgJ3Rlc3QtYW5vbi1rZXknLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgYXV0aDoge1xuICAgICAgICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXG4gICAgICAgICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2VcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdsb2JhbDoge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAnWC1Vc2VyLUlEJzogJ3N1cGFiYXNlXzEyMycsXG4gICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogJ0JlYXJlciBhY2Nlc3MtdG9rZW4nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJldG9ybmFyIG51bGwgc2kgY29uZmlndXJhY2nDs24gbm8gZXN0w6EgZGlzcG9uaWJsZScsICgpID0+IHtcbiAgICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XG4gICAgICBkZWxldGUgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVk7XG5cbiAgICAgIGNvbnN0IGNsaWVudCA9IGNyZWF0ZVVzZXJTdXBhYmFzZUNsaWVudCgnc3VwYWJhc2VfMTIzJyk7XG5cbiAgICAgIGV4cGVjdChjbGllbnQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdleGVjdXRlV2l0aFJMUycsICgpID0+IHtcbiAgICBpdCgnZGViZSBlamVjdXRhciBjb25zdWx0YSBjb24gUkxTIGhhYmlsaXRhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUXVlcnlGdW5jdGlvbiA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHByb2R1Y3RzOiBbeyBpZDogMSwgbmFtZTogJ1Rlc3QgUHJvZHVjdCcgfV0sXG4gICAgICAgIHRvdGFsOiAxXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXhlY3V0ZVdpdGhSTFMoXG4gICAgICAgIG1vY2tFbnRlcnByaXNlQ29udGV4dCxcbiAgICAgICAgbW9ja1F1ZXJ5RnVuY3Rpb24sXG4gICAgICAgIHsgZW5mb3JjZVJMUzogdHJ1ZSwgYXVkaXRMb2c6IHRydWUgfVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1vY2tRdWVyeUZ1bmN0aW9uKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSB1c2FyIGNsaWVudGUgYWRtaW4gcGFyYSBieXBhc3MgUkxTIHNpIGVzIGFkbWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1F1ZXJ5RnVuY3Rpb24gPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiAndGVzdCcgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4ZWN1dGVXaXRoUkxTKFxuICAgICAgICBtb2NrRW50ZXJwcmlzZUNvbnRleHQsXG4gICAgICAgIG1vY2tRdWVyeUZ1bmN0aW9uLFxuICAgICAgICB7IGJ5cGFzc1JMUzogdHJ1ZSB9XG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja1F1ZXJ5RnVuY3Rpb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBzdXBhYmFzZUFkbWluLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IHJvbGU6ICdhZG1pbicgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSBmYWxsYXIgc2kgdmFsaWRhY2nDs24gUkxTIGZhbGxhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKHN1cGFiYXNlQWRtaW4uZnJvbSBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBtb2NrUXVlcnlGdW5jdGlvbiA9IGplc3QuZm4oKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXhlY3V0ZVdpdGhSTFMoXG4gICAgICAgIG1vY2tFbnRlcnByaXNlQ29udGV4dCxcbiAgICAgICAgbW9ja1F1ZXJ5RnVuY3Rpb25cbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCdFcnJvciBvYnRlbmllbmRvIHBlcmZpbCBkZSB1c3VhcmlvJyk7XG4gICAgICBleHBlY3QobW9ja1F1ZXJ5RnVuY3Rpb24pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjaGVja1JMU1Blcm1pc3Npb24nLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgcGVybWl0aXIgYWNjZXNvIGEgYWRtaW4gc2llbXByZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJsc0NvbnRleHQgPSB7XG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcbiAgICAgICAgcm9sZTogJ2FkbWluJyBhcyBjb25zdCxcbiAgICAgICAgcGVybWlzc2lvbnM6IFtdLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgfTtcblxuICAgICAgY29uc3QgaGFzUGVybWlzc2lvbiA9IGNoZWNrUkxTUGVybWlzc2lvbihybHNDb250ZXh0LCAnYW55X3Blcm1pc3Npb24nKTtcblxuICAgICAgZXhwZWN0KGhhc1Blcm1pc3Npb24pLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSBwZXJtaXRpciBhY2Nlc28gc2kgdXN1YXJpbyB0aWVuZSBwZXJtaXNvIGVzcGVjw61maWNvJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmxzQ29udGV4dCA9IHtcbiAgICAgICAgdXNlcklkOiAndXNlcl8xMjMnLFxuICAgICAgICByb2xlOiAndXNlcicgYXMgY29uc3QsXG4gICAgICAgIHBlcm1pc3Npb25zOiBbJ3Byb2R1Y3RzX3JlYWQnXSxcbiAgICAgICAgaXNBY3RpdmU6IHRydWVcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGhhc1Blcm1pc3Npb24gPSBjaGVja1JMU1Blcm1pc3Npb24ocmxzQ29udGV4dCwgJ3Byb2R1Y3RzX3JlYWQnKTtcblxuICAgICAgZXhwZWN0KGhhc1Blcm1pc3Npb24pLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSBwZXJtaXRpciBhY2Nlc28gc2kgdXN1YXJpbyBlcyBwcm9waWV0YXJpbyBkZWwgcmVjdXJzbycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJsc0NvbnRleHQgPSB7XG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcbiAgICAgICAgcm9sZTogJ3VzZXInIGFzIGNvbnN0LFxuICAgICAgICBwZXJtaXNzaW9uczogW10sXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBoYXNQZXJtaXNzaW9uID0gY2hlY2tSTFNQZXJtaXNzaW9uKHJsc0NvbnRleHQsICdlZGl0X3Byb2ZpbGUnLCAndXNlcl8xMjMnKTtcblxuICAgICAgZXhwZWN0KGhhc1Blcm1pc3Npb24pLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSBkZW5lZ2FyIGFjY2VzbyBzaSBubyB0aWVuZSBwZXJtaXNvcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJsc0NvbnRleHQgPSB7XG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcbiAgICAgICAgcm9sZTogJ3VzZXInIGFzIGNvbnN0LFxuICAgICAgICBwZXJtaXNzaW9uczogWydiYXNpY19hY2Nlc3MnXSxcbiAgICAgICAgaXNBY3RpdmU6IHRydWVcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGhhc1Blcm1pc3Npb24gPSBjaGVja1JMU1Blcm1pc3Npb24ocmxzQ29udGV4dCwgJ2FkbWluX2FjY2VzcycpO1xuXG4gICAgICBleHBlY3QoaGFzUGVybWlzc2lvbikudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVSTFNGaWx0ZXJzJywgKCkgPT4ge1xuICAgIGl0KCdkZWJlIGNyZWFyIGZpbHRyb3MgcGFyYSB1c2VyX3Byb2ZpbGVzIHBhcmEgdXN1YXJpbyBub3JtYWwnLCAoKSA9PiB7XG4gICAgICBjb25zdCBybHNDb250ZXh0ID0ge1xuICAgICAgICB1c2VySWQ6ICd1c2VyXzEyMycsXG4gICAgICAgIHJvbGU6ICd1c2VyJyBhcyBjb25zdCxcbiAgICAgICAgcGVybWlzc2lvbnM6IFtdLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgfTtcblxuICAgICAgY29uc3QgZmlsdGVycyA9IGNyZWF0ZVJMU0ZpbHRlcnMocmxzQ29udGV4dCwgJ3VzZXJfcHJvZmlsZXMnKTtcblxuICAgICAgZXhwZWN0KGZpbHRlcnMpLnRvRXF1YWwoe1xuICAgICAgICBjbGVya191c2VyX2lkOiAndXNlcl8xMjMnXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIGNyZWFyIGZpbHRyb3MgcGFyYSBwcm9kdWN0cyBwYXJhIHVzdWFyaW8gbm9ybWFsJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmxzQ29udGV4dCA9IHtcbiAgICAgICAgdXNlcklkOiAndXNlcl8xMjMnLFxuICAgICAgICByb2xlOiAndXNlcicgYXMgY29uc3QsXG4gICAgICAgIHBlcm1pc3Npb25zOiBbXSxcbiAgICAgICAgaXNBY3RpdmU6IHRydWVcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGZpbHRlcnMgPSBjcmVhdGVSTFNGaWx0ZXJzKHJsc0NvbnRleHQsICdwcm9kdWN0cycpO1xuXG4gICAgICBleHBlY3QoZmlsdGVycykudG9FcXVhbCh7XG4gICAgICAgIGlzX2FjdGl2ZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnbm8gZGViZSBjcmVhciBmaWx0cm9zIHBhcmEgYWRtaW4nLCAoKSA9PiB7XG4gICAgICBjb25zdCBybHNDb250ZXh0ID0ge1xuICAgICAgICB1c2VySWQ6ICd1c2VyXzEyMycsXG4gICAgICAgIHJvbGU6ICdhZG1pbicgYXMgY29uc3QsXG4gICAgICAgIHBlcm1pc3Npb25zOiBbJ2FkbWluX2FjY2VzcyddLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgfTtcblxuICAgICAgY29uc3QgZmlsdGVycyA9IGNyZWF0ZVJMU0ZpbHRlcnMocmxzQ29udGV4dCwgJ3Byb2R1Y3RzJyk7XG5cbiAgICAgIGV4cGVjdChmaWx0ZXJzKS50b0VxdWFsKHt9KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIGNyZWFyIGZpbHRyb3MgcGFyYSBvcmRlcnMgcGFyYSB1c3VhcmlvIG5vcm1hbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJsc0NvbnRleHQgPSB7XG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcbiAgICAgICAgcm9sZTogJ3VzZXInIGFzIGNvbnN0LFxuICAgICAgICBwZXJtaXNzaW9uczogW10sXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBmaWx0ZXJzID0gY3JlYXRlUkxTRmlsdGVycyhybHNDb250ZXh0LCAnb3JkZXJzJyk7XG5cbiAgICAgIGV4cGVjdChmaWx0ZXJzKS50b0VxdWFsKHtcbiAgICAgICAgdXNlcl9pZDogJ3VzZXJfMTIzJ1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd3aXRoUkxTIG1pZGRsZXdhcmUnLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgZWplY3V0YXIgaGFuZGxlciBzaSBjb250ZXh0byBlbnRlcnByaXNlIGVzdMOhIGRpc3BvbmlibGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgZW50ZXJwcmlzZUF1dGg6IG1vY2tFbnRlcnByaXNlQ29udGV4dFxuICAgICAgfSBhcyBhbnk7XG4gICAgICBjb25zdCBtb2NrUmVzcG9uc2UgPSB7IHN0YXR1czogamVzdC5mbigpLCBqc29uOiBqZXN0LmZuKCkgfTtcbiAgICAgIGNvbnN0IG1vY2tIYW5kbGVyID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3VjY2VzczogdHJ1ZSB9KTtcblxuICAgICAgY29uc3QgbWlkZGxld2FyZSA9IHdpdGhSTFMoKTtcbiAgICAgIGNvbnN0IHdyYXBwZWRIYW5kbGVyID0gbWlkZGxld2FyZShtb2NrSGFuZGxlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdyYXBwZWRIYW5kbGVyKG1vY2tSZXF1ZXN0LCBtb2NrUmVzcG9uc2UpO1xuXG4gICAgICBleHBlY3QobW9ja0hhbmRsZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tSZXF1ZXN0LCBtb2NrUmVzcG9uc2UpO1xuICAgICAgZXhwZWN0KG1vY2tSZXF1ZXN0LnJsc0NvbnRleHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSByZXRvcm5hciBlcnJvciBzaSBjb250ZXh0byBlbnRlcnByaXNlIG5vIGVzdMOhIGRpc3BvbmlibGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHt9IGFzIGFueTtcbiAgICAgIGNvbnN0IG1vY2tSZXNwb25zZSA9IHsgXG4gICAgICAgIHN0YXR1czogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksIFxuICAgICAgICBqc29uOiBqZXN0LmZuKCkgXG4gICAgICB9O1xuICAgICAgY29uc3QgbW9ja0hhbmRsZXIgPSBqZXN0LmZuKCk7XG5cbiAgICAgIGNvbnN0IG1pZGRsZXdhcmUgPSB3aXRoUkxTKCk7XG4gICAgICBjb25zdCB3cmFwcGVkSGFuZGxlciA9IG1pZGRsZXdhcmUobW9ja0hhbmRsZXIpO1xuXG4gICAgICBhd2FpdCB3cmFwcGVkSGFuZGxlcihtb2NrUmVxdWVzdCwgbW9ja1Jlc3BvbnNlKTtcblxuICAgICAgZXhwZWN0KG1vY2tIYW5kbGVyKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMSk7XG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdDb250ZXh0byBlbnRlcnByaXNlIG5vIGRpc3BvbmlibGUnLFxuICAgICAgICAgIGNvZGU6ICdOT19FTlRFUlBSSVNFX0NPTlRFWFQnXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sIm5hbWVzIjpbImplc3QiLCJtb2NrIiwic3VwYWJhc2VBZG1pbiIsImZyb20iLCJmbiIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiaW5zZXJ0IiwiY3JlYXRlQ2xpZW50IiwiZGVzY3JpYmUiLCJtb2NrRW50ZXJwcmlzZUNvbnRleHQiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsInVzZXJJZCIsInNlc3Npb25JZCIsImVtYWlsIiwicm9sZSIsInBlcm1pc3Npb25zIiwic2Vzc2lvblZhbGlkIiwic2VjdXJpdHlMZXZlbCIsImlwQWRkcmVzcyIsInVzZXJBZ2VudCIsInN1cGFiYXNlIiwidmFsaWRhdGlvbnMiLCJqd3RWYWxpZCIsImNzcmZWYWxpZCIsInJhdGVMaW1pdFBhc3NlZCIsIm9yaWdpblZhbGlkIiwibW9ja1JldHVyblZhbHVlIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJkYXRhIiwiaWQiLCJzdXBhYmFzZV91c2VyX2lkIiwiY2xlcmtfdXNlcl9pZCIsInJvbGVfaWQiLCJpc19hY3RpdmUiLCJ1c2VyX3JvbGVzIiwicm9sZV9uYW1lIiwiZXJyb3IiLCJpdCIsInJlc3VsdCIsInZhbGlkYXRlUkxTQ29udGV4dCIsImV4cGVjdCIsInZhbGlkIiwidG9CZSIsImNvbnRleHQiLCJ0b0JlRGVmaW5lZCIsInRvQ29udGFpbiIsImlzQWN0aXZlIiwiY29kZSIsIm1lc3NhZ2UiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJjbGllbnQiLCJjcmVhdGVVc2VyU3VwYWJhc2VDbGllbnQiLCJ0b0hhdmVCZWVuQ2FsbGVkV2l0aCIsIm9iamVjdENvbnRhaW5pbmciLCJhdXRoIiwiYXV0b1JlZnJlc2hUb2tlbiIsInBlcnNpc3RTZXNzaW9uIiwiZ2xvYmFsIiwiaGVhZGVycyIsInRvQmVOdWxsIiwibW9ja1F1ZXJ5RnVuY3Rpb24iLCJwcm9kdWN0cyIsIm5hbWUiLCJ0b3RhbCIsImV4ZWN1dGVXaXRoUkxTIiwiZW5mb3JjZVJMUyIsImF1ZGl0TG9nIiwic3VjY2VzcyIsInRvSGF2ZUJlZW5DYWxsZWQiLCJieXBhc3NSTFMiLCJub3QiLCJybHNDb250ZXh0IiwiaGFzUGVybWlzc2lvbiIsImNoZWNrUkxTUGVybWlzc2lvbiIsImZpbHRlcnMiLCJjcmVhdGVSTFNGaWx0ZXJzIiwidG9FcXVhbCIsInVzZXJfaWQiLCJtb2NrUmVxdWVzdCIsImVudGVycHJpc2VBdXRoIiwibW9ja1Jlc3BvbnNlIiwic3RhdHVzIiwianNvbiIsIm1vY2tIYW5kbGVyIiwibWlkZGxld2FyZSIsIndpdGhSTFMiLCJ3cmFwcGVkSGFuZGxlciIsIm1vY2tSZXR1cm5UaGlzIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0MsR0FFRCxtQkFBbUI7O0FBQ25CQSxLQUFLQyxJQUFJLENBQUMsa0JBQWtCLElBQU8sQ0FBQTtRQUNqQ0MsZUFBZTtZQUNiQyxNQUFNSCxLQUFLSSxFQUFFLENBQUMsSUFBTyxDQUFBO29CQUNuQkMsUUFBUUwsS0FBS0ksRUFBRSxDQUFDLElBQU8sQ0FBQTs0QkFDckJFLElBQUlOLEtBQUtJLEVBQUUsQ0FBQyxJQUFPLENBQUE7b0NBQ2pCRyxRQUFRUCxLQUFLSSxFQUFFO2dDQUNqQixDQUFBO3dCQUNGLENBQUE7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