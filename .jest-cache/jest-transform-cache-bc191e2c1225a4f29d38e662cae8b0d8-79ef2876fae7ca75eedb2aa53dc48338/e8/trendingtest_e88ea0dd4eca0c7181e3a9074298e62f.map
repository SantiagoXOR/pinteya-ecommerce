{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\api\\trending.test.ts"],"sourcesContent":["// ===================================\n// PINTEYA E-COMMERCE - TEST API TRENDING SEARCHES\n// ===================================\n\nimport { NextRequest } from 'next/server';\nimport { GET } from '@/app/api/search/trending/route';\n\n// Mock Supabase\nconst mockSupabaseClient = {\n  from: jest.fn(() => ({\n    select: jest.fn(() => ({\n      eq: jest.fn(() => ({\n        eq: jest.fn(() => ({\n          gte: jest.fn(() => ({\n            not: jest.fn(() => ({\n              data: [],\n              error: null,\n            })),\n          })),\n        })),\n      })),\n    })),\n  })),\n};\n\njest.mock('@/lib/supabase', () => ({\n  getSupabaseClient: jest.fn(() => mockSupabaseClient),\n}));\n\ndescribe('API /api/search/trending', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should return trending searches successfully', async () => {\n    const request = new NextRequest('http://localhost:3000/api/search/trending');\n    \n    const response = await GET(request);\n    const data = await response.json();\n\n    expect(response.status).toBe(200);\n    expect(data.success).toBe(true);\n    expect(data.data).toBeDefined();\n    expect(data.data.trending).toBeDefined();\n    expect(Array.isArray(data.data.trending)).toBe(true);\n    expect(data.data.trending.length).toBeGreaterThan(0);\n  });\n\n  it('should return limited results when limit parameter is provided', async () => {\n    const request = new NextRequest('http://localhost:3000/api/search/trending?limit=3');\n    \n    const response = await GET(request);\n    const data = await response.json();\n\n    expect(response.status).toBe(200);\n    expect(data.data.trending.length).toBeLessThanOrEqual(3);\n  });\n\n  it('should return trending searches with correct structure', async () => {\n    const request = new NextRequest('http://localhost:3000/api/search/trending');\n    \n    const response = await GET(request);\n    const data = await response.json();\n\n    expect(data.data.trending[0]).toHaveProperty('id');\n    expect(data.data.trending[0]).toHaveProperty('query');\n    expect(data.data.trending[0]).toHaveProperty('count');\n    expect(data.data.trending[0]).toHaveProperty('href');\n    expect(data.data.trending[0]).toHaveProperty('type');\n    expect(data.data.trending[0].type).toBe('trending');\n  });\n\n  it('should handle category filtering', async () => {\n    const request = new NextRequest('http://localhost:3000/api/search/trending?category=pinturas');\n    \n    const response = await GET(request);\n    const data = await response.json();\n\n    expect(response.status).toBe(200);\n    expect(data.success).toBe(true);\n    // Should still return results (fallback data)\n    expect(data.data.trending.length).toBeGreaterThan(0);\n  });\n});\n"],"names":["jest","mock","getSupabaseClient","fn","mockSupabaseClient","from","select","eq","gte","not","data","error","describe","beforeEach","clearAllMocks","it","request","NextRequest","response","GET","json","expect","status","toBe","success","toBeDefined","trending","Array","isArray","length","toBeGreaterThan","toBeLessThanOrEqual","toHaveProperty","type"],"mappings":"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"}