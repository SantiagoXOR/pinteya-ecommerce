62b08d4ba25764a1a380f0e7aaa13110
// ===================================
// HOOK: useRecentSearches - Gestión de búsquedas recientes con localStorage
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    default: function() {
        return _default;
    },
    useRecentSearches: function() {
        return useRecentSearches;
    },
    useRecentSearchesSimple: function() {
        return useRecentSearchesSimple;
    }
});
const _react = require("react");
const DEFAULT_OPTIONS = {
    maxSearches: 5,
    storageKey: 'pinteya-recent-searches',
    enablePersistence: true,
    filterDuplicates: true,
    expirationDays: 30
};
function useRecentSearches(options = {}) {
    const config = {
        ...DEFAULT_OPTIONS,
        ...options
    };
    const [recentSearches, setRecentSearches] = (0, _react.useState)([]);
    // Función para validar y limpiar una búsqueda
    const sanitizeSearch = (0, _react.useCallback)((search)=>{
        return search.trim().toLowerCase();
    }, []);
    // Función para verificar si los datos han expirado
    const isExpired = (0, _react.useCallback)((timestamp)=>{
        if (config.expirationDays === 0) return false;
        const maxAge = config.expirationDays * 24 * 60 * 60 * 1000;
        return Date.now() - timestamp > maxAge;
    }, [
        config.expirationDays
    ]);
    // Cargar búsquedas desde localStorage
    const loadFromStorage = (0, _react.useCallback)(()=>{
        if (!config.enablePersistence || typeof window === 'undefined') {
            return [];
        }
        try {
            const stored = localStorage.getItem(config.storageKey);
            if (!stored) return [];
            // Intentar cargar formato nuevo (con metadata)
            try {
                const parsed = JSON.parse(stored);
                // Verificar estructura y expiración
                if (parsed.searches && Array.isArray(parsed.searches)) {
                    if (parsed.timestamp && isExpired(parsed.timestamp)) {
                        localStorage.removeItem(config.storageKey);
                        return [];
                    }
                    return parsed.searches.slice(0, config.maxSearches);
                }
            } catch  {
                // Fallback: intentar cargar formato antiguo (array simple)
                const parsed = JSON.parse(stored);
                if (Array.isArray(parsed)) {
                    return parsed.slice(0, config.maxSearches);
                }
            }
            return [];
        } catch (error) {
            console.warn('Error loading recent searches from localStorage:', error);
            // Limpiar localStorage corrupto
            try {
                localStorage.removeItem(config.storageKey);
            } catch (cleanupError) {
                console.warn('Error cleaning up corrupted localStorage:', cleanupError);
            }
            return [];
        }
    }, [
        config.enablePersistence,
        config.storageKey,
        config.maxSearches,
        isExpired
    ]);
    // Guardar búsquedas en localStorage
    const saveToStorage = (0, _react.useCallback)((searches)=>{
        if (!config.enablePersistence || typeof window === 'undefined') {
            return;
        }
        try {
            if (searches.length === 0) {
                localStorage.removeItem(config.storageKey);
                return;
            }
            const dataToStore = {
                searches: searches.slice(0, config.maxSearches),
                timestamp: Date.now(),
                version: '1.0.0'
            };
            localStorage.setItem(config.storageKey, JSON.stringify(dataToStore));
        } catch (error) {
            console.warn('Error saving recent searches to localStorage:', error);
        }
    }, [
        config.enablePersistence,
        config.storageKey,
        config.maxSearches
    ]);
    // Cargar búsquedas al inicializar
    (0, _react.useEffect)(()=>{
        const loaded = loadFromStorage();
        setRecentSearches(loaded);
    }, [
        loadFromStorage
    ]);
    // Agregar una nueva búsqueda
    const addSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        if (!sanitized || sanitized.length < 2) return;
        setRecentSearches((prev)=>{
            let updated = [
                ...prev
            ];
            // Remover duplicados si está habilitado
            if (config.filterDuplicates) {
                updated = updated.filter((s)=>sanitizeSearch(s) !== sanitized);
            }
            // Agregar al principio
            updated.unshift(search.trim());
            // Limitar al máximo configurado
            updated = updated.slice(0, config.maxSearches);
            // Guardar en localStorage
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        config.filterDuplicates,
        config.maxSearches,
        saveToStorage
    ]);
    // Remover una búsqueda específica
    const removeSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        setRecentSearches((prev)=>{
            const updated = prev.filter((s)=>sanitizeSearch(s) !== sanitized);
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        saveToStorage
    ]);
    // Limpiar todas las búsquedas
    const clearSearches = (0, _react.useCallback)(()=>{
        setRecentSearches([]);
        saveToStorage([]);
    }, [
        saveToStorage
    ]);
    // Verificar si una búsqueda existe
    const hasSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        return recentSearches.some((s)=>sanitizeSearch(s) === sanitized);
    }, [
        recentSearches,
        sanitizeSearch
    ]);
    // Obtener las N búsquedas más recientes
    const getRecentSearches = (0, _react.useCallback)((limit)=>{
        const actualLimit = limit ?? config.maxSearches;
        return recentSearches.slice(0, actualLimit);
    }, [
        recentSearches,
        config.maxSearches
    ]);
    // Mover una búsqueda al principio (reordenar)
    const moveToTop = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        setRecentSearches((prev)=>{
            const filtered = prev.filter((s)=>sanitizeSearch(s) !== sanitized);
            const existing = prev.find((s)=>sanitizeSearch(s) === sanitized);
            if (!existing) return prev;
            const updated = [
                existing,
                ...filtered
            ];
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        saveToStorage
    ]);
    return {
        recentSearches,
        addSearch,
        removeSearch,
        clearSearches,
        hasSearch,
        getRecentSearches,
        moveToTop
    };
}
function useRecentSearchesSimple(limit = 5) {
    const { getRecentSearches } = useRecentSearches({
        maxSearches: limit
    });
    return getRecentSearches();
}
const _default = useRecentSearches;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZVJlY2VudFNlYXJjaGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIT09LOiB1c2VSZWNlbnRTZWFyY2hlcyAtIEdlc3Rpw7NuIGRlIGLDunNxdWVkYXMgcmVjaWVudGVzIGNvbiBsb2NhbFN0b3JhZ2Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFJlY2VudFNlYXJjaGVzT3B0aW9ucyB7XG4gIC8qKiBOw7ptZXJvIG3DoXhpbW8gZGUgYsO6c3F1ZWRhcyByZWNpZW50ZXMgYSBtYW50ZW5lciAqL1xuICBtYXhTZWFyY2hlcz86IG51bWJlcjtcbiAgLyoqIENsYXZlIGRlIGxvY2FsU3RvcmFnZSBwYXJhIHBlcnNpc3RpciBsYXMgYsO6c3F1ZWRhcyAqL1xuICBzdG9yYWdlS2V5Pzogc3RyaW5nO1xuICAvKiogSGFiaWxpdGFyL2Rlc2hhYmlsaXRhciBwZXJzaXN0ZW5jaWEgZW4gbG9jYWxTdG9yYWdlICovXG4gIGVuYWJsZVBlcnNpc3RlbmNlPzogYm9vbGVhbjtcbiAgLyoqIEZpbHRyYXIgYsO6c3F1ZWRhcyBkdXBsaWNhZGFzICovXG4gIGZpbHRlckR1cGxpY2F0ZXM/OiBib29sZWFuO1xuICAvKiogVGllbXBvIGRlIGV4cGlyYWNpw7NuIGVuIGTDrWFzICgwID0gc2luIGV4cGlyYWNpw7NuKSAqL1xuICBleHBpcmF0aW9uRGF5cz86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZWNlbnRTZWFyY2hlc1JldHVybiB7XG4gIC8qKiBBcnJheSBkZSBiw7pzcXVlZGFzIHJlY2llbnRlcyAqL1xuICByZWNlbnRTZWFyY2hlczogc3RyaW5nW107XG4gIC8qKiBBZ3JlZ2FyIHVuYSBudWV2YSBiw7pzcXVlZGEgKi9cbiAgYWRkU2VhcmNoOiAoc2VhcmNoOiBzdHJpbmcpID0+IHZvaWQ7XG4gIC8qKiBSZW1vdmVyIHVuYSBiw7pzcXVlZGEgZXNwZWPDrWZpY2EgKi9cbiAgcmVtb3ZlU2VhcmNoOiAoc2VhcmNoOiBzdHJpbmcpID0+IHZvaWQ7XG4gIC8qKiBMaW1waWFyIHRvZGFzIGxhcyBiw7pzcXVlZGFzICovXG4gIGNsZWFyU2VhcmNoZXM6ICgpID0+IHZvaWQ7XG4gIC8qKiBWZXJpZmljYXIgc2kgdW5hIGLDunNxdWVkYSBleGlzdGUgKi9cbiAgaGFzU2VhcmNoOiAoc2VhcmNoOiBzdHJpbmcpID0+IGJvb2xlYW47XG4gIC8qKiBPYnRlbmVyIGxhcyBOIGLDunNxdWVkYXMgbcOhcyByZWNpZW50ZXMgKi9cbiAgZ2V0UmVjZW50U2VhcmNoZXM6IChsaW1pdD86IG51bWJlcikgPT4gc3RyaW5nW107XG4gIC8qKiBSZW9yZGVuYXIgYsO6c3F1ZWRhcyAobW92ZXIgYWwgcHJpbmNpcGlvKSAqL1xuICBtb3ZlVG9Ub3A6IChzZWFyY2g6IHN0cmluZykgPT4gdm9pZDtcbn1cblxuaW50ZXJmYWNlIFBlcnNpc3RlZFNlYXJjaERhdGEge1xuICBzZWFyY2hlczogc3RyaW5nW107XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICB2ZXJzaW9uOiBzdHJpbmc7XG59XG5cbmNvbnN0IERFRkFVTFRfT1BUSU9OUzogUmVxdWlyZWQ8UmVjZW50U2VhcmNoZXNPcHRpb25zPiA9IHtcbiAgbWF4U2VhcmNoZXM6IDUsXG4gIHN0b3JhZ2VLZXk6ICdwaW50ZXlhLXJlY2VudC1zZWFyY2hlcycsXG4gIGVuYWJsZVBlcnNpc3RlbmNlOiB0cnVlLFxuICBmaWx0ZXJEdXBsaWNhdGVzOiB0cnVlLFxuICBleHBpcmF0aW9uRGF5czogMzAsIC8vIDMwIGTDrWFzIGRlIGV4cGlyYWNpw7NuXG59O1xuXG4vKipcbiAqIEhvb2sgcGFyYSBnZXN0aW9uYXIgYsO6c3F1ZWRhcyByZWNpZW50ZXMgY29uIHBlcnNpc3RlbmNpYSBlbiBsb2NhbFN0b3JhZ2VcbiAqIFxuICogQ2FyYWN0ZXLDrXN0aWNhczpcbiAqIC0gUGVyc2lzdGVuY2lhIGF1dG9tw6F0aWNhIGVuIGxvY2FsU3RvcmFnZVxuICogLSBMw61taXRlIGNvbmZpZ3VyYWJsZSBkZSBiw7pzcXVlZGFzXG4gKiAtIEZpbHRyYWRvIGRlIGR1cGxpY2Fkb3NcbiAqIC0gRXhwaXJhY2nDs24gYXV0b23DoXRpY2FcbiAqIC0gTWFuZWpvIGRlIGVycm9yZXMgcm9idXN0b1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlUmVjZW50U2VhcmNoZXMob3B0aW9uczogUmVjZW50U2VhcmNoZXNPcHRpb25zID0ge30pOiBSZWNlbnRTZWFyY2hlc1JldHVybiB7XG4gIGNvbnN0IGNvbmZpZyA9IHsgLi4uREVGQVVMVF9PUFRJT05TLCAuLi5vcHRpb25zIH07XG4gIGNvbnN0IFtyZWNlbnRTZWFyY2hlcywgc2V0UmVjZW50U2VhcmNoZXNdID0gdXNlU3RhdGU8c3RyaW5nW10+KFtdKTtcblxuICAvLyBGdW5jacOzbiBwYXJhIHZhbGlkYXIgeSBsaW1waWFyIHVuYSBiw7pzcXVlZGFcbiAgY29uc3Qgc2FuaXRpemVTZWFyY2ggPSB1c2VDYWxsYmFjaygoc2VhcmNoOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICAgIHJldHVybiBzZWFyY2gudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gIH0sIFtdKTtcblxuICAvLyBGdW5jacOzbiBwYXJhIHZlcmlmaWNhciBzaSBsb3MgZGF0b3MgaGFuIGV4cGlyYWRvXG4gIGNvbnN0IGlzRXhwaXJlZCA9IHVzZUNhbGxiYWNrKCh0aW1lc3RhbXA6IG51bWJlcik6IGJvb2xlYW4gPT4ge1xuICAgIGlmIChjb25maWcuZXhwaXJhdGlvbkRheXMgPT09IDApIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBtYXhBZ2UgPSBjb25maWcuZXhwaXJhdGlvbkRheXMgKiAyNCAqIDYwICogNjAgKiAxMDAwO1xuICAgIHJldHVybiBEYXRlLm5vdygpIC0gdGltZXN0YW1wID4gbWF4QWdlO1xuICB9LCBbY29uZmlnLmV4cGlyYXRpb25EYXlzXSk7XG5cbiAgLy8gQ2FyZ2FyIGLDunNxdWVkYXMgZGVzZGUgbG9jYWxTdG9yYWdlXG4gIGNvbnN0IGxvYWRGcm9tU3RvcmFnZSA9IHVzZUNhbGxiYWNrKCgpOiBzdHJpbmdbXSA9PiB7XG4gICAgaWYgKCFjb25maWcuZW5hYmxlUGVyc2lzdGVuY2UgfHwgdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RvcmVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oY29uZmlnLnN0b3JhZ2VLZXkpO1xuICAgICAgaWYgKCFzdG9yZWQpIHJldHVybiBbXTtcblxuICAgICAgLy8gSW50ZW50YXIgY2FyZ2FyIGZvcm1hdG8gbnVldm8gKGNvbiBtZXRhZGF0YSlcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnNlZDogUGVyc2lzdGVkU2VhcmNoRGF0YSA9IEpTT04ucGFyc2Uoc3RvcmVkKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFZlcmlmaWNhciBlc3RydWN0dXJhIHkgZXhwaXJhY2nDs25cbiAgICAgICAgaWYgKHBhcnNlZC5zZWFyY2hlcyAmJiBBcnJheS5pc0FycmF5KHBhcnNlZC5zZWFyY2hlcykpIHtcbiAgICAgICAgICBpZiAocGFyc2VkLnRpbWVzdGFtcCAmJiBpc0V4cGlyZWQocGFyc2VkLnRpbWVzdGFtcCkpIHtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGNvbmZpZy5zdG9yYWdlS2V5KTtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHBhcnNlZC5zZWFyY2hlcy5zbGljZSgwLCBjb25maWcubWF4U2VhcmNoZXMpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gRmFsbGJhY2s6IGludGVudGFyIGNhcmdhciBmb3JtYXRvIGFudGlndW8gKGFycmF5IHNpbXBsZSlcbiAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShzdG9yZWQpO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwYXJzZWQpKSB7XG4gICAgICAgICAgcmV0dXJuIHBhcnNlZC5zbGljZSgwLCBjb25maWcubWF4U2VhcmNoZXMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBsb2FkaW5nIHJlY2VudCBzZWFyY2hlcyBmcm9tIGxvY2FsU3RvcmFnZTonLCBlcnJvcik7XG4gICAgICAvLyBMaW1waWFyIGxvY2FsU3RvcmFnZSBjb3JydXB0b1xuICAgICAgdHJ5IHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oY29uZmlnLnN0b3JhZ2VLZXkpO1xuICAgICAgfSBjYXRjaCAoY2xlYW51cEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignRXJyb3IgY2xlYW5pbmcgdXAgY29ycnVwdGVkIGxvY2FsU3RvcmFnZTonLCBjbGVhbnVwRXJyb3IpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfSwgW2NvbmZpZy5lbmFibGVQZXJzaXN0ZW5jZSwgY29uZmlnLnN0b3JhZ2VLZXksIGNvbmZpZy5tYXhTZWFyY2hlcywgaXNFeHBpcmVkXSk7XG5cbiAgLy8gR3VhcmRhciBiw7pzcXVlZGFzIGVuIGxvY2FsU3RvcmFnZVxuICBjb25zdCBzYXZlVG9TdG9yYWdlID0gdXNlQ2FsbGJhY2soKHNlYXJjaGVzOiBzdHJpbmdbXSk6IHZvaWQgPT4ge1xuICAgIGlmICghY29uZmlnLmVuYWJsZVBlcnNpc3RlbmNlIHx8IHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGlmIChzZWFyY2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oY29uZmlnLnN0b3JhZ2VLZXkpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRhdGFUb1N0b3JlOiBQZXJzaXN0ZWRTZWFyY2hEYXRhID0ge1xuICAgICAgICBzZWFyY2hlczogc2VhcmNoZXMuc2xpY2UoMCwgY29uZmlnLm1heFNlYXJjaGVzKSxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICB2ZXJzaW9uOiAnMS4wLjAnXG4gICAgICB9O1xuXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjb25maWcuc3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkoZGF0YVRvU3RvcmUpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBzYXZpbmcgcmVjZW50IHNlYXJjaGVzIHRvIGxvY2FsU3RvcmFnZTonLCBlcnJvcik7XG4gICAgfVxuICB9LCBbY29uZmlnLmVuYWJsZVBlcnNpc3RlbmNlLCBjb25maWcuc3RvcmFnZUtleSwgY29uZmlnLm1heFNlYXJjaGVzXSk7XG5cbiAgLy8gQ2FyZ2FyIGLDunNxdWVkYXMgYWwgaW5pY2lhbGl6YXJcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBsb2FkZWQgPSBsb2FkRnJvbVN0b3JhZ2UoKTtcbiAgICBzZXRSZWNlbnRTZWFyY2hlcyhsb2FkZWQpO1xuICB9LCBbbG9hZEZyb21TdG9yYWdlXSk7XG5cbiAgLy8gQWdyZWdhciB1bmEgbnVldmEgYsO6c3F1ZWRhXG4gIGNvbnN0IGFkZFNlYXJjaCA9IHVzZUNhbGxiYWNrKChzZWFyY2g6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplU2VhcmNoKHNlYXJjaCk7XG4gICAgaWYgKCFzYW5pdGl6ZWQgfHwgc2FuaXRpemVkLmxlbmd0aCA8IDIpIHJldHVybjtcblxuICAgIHNldFJlY2VudFNlYXJjaGVzKHByZXYgPT4ge1xuICAgICAgbGV0IHVwZGF0ZWQgPSBbLi4ucHJldl07XG5cbiAgICAgIC8vIFJlbW92ZXIgZHVwbGljYWRvcyBzaSBlc3TDoSBoYWJpbGl0YWRvXG4gICAgICBpZiAoY29uZmlnLmZpbHRlckR1cGxpY2F0ZXMpIHtcbiAgICAgICAgdXBkYXRlZCA9IHVwZGF0ZWQuZmlsdGVyKHMgPT4gc2FuaXRpemVTZWFyY2gocykgIT09IHNhbml0aXplZCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFncmVnYXIgYWwgcHJpbmNpcGlvXG4gICAgICB1cGRhdGVkLnVuc2hpZnQoc2VhcmNoLnRyaW0oKSk7XG5cbiAgICAgIC8vIExpbWl0YXIgYWwgbcOheGltbyBjb25maWd1cmFkb1xuICAgICAgdXBkYXRlZCA9IHVwZGF0ZWQuc2xpY2UoMCwgY29uZmlnLm1heFNlYXJjaGVzKTtcblxuICAgICAgLy8gR3VhcmRhciBlbiBsb2NhbFN0b3JhZ2VcbiAgICAgIHNhdmVUb1N0b3JhZ2UodXBkYXRlZCk7XG5cbiAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgIH0pO1xuICB9LCBbc2FuaXRpemVTZWFyY2gsIGNvbmZpZy5maWx0ZXJEdXBsaWNhdGVzLCBjb25maWcubWF4U2VhcmNoZXMsIHNhdmVUb1N0b3JhZ2VdKTtcblxuICAvLyBSZW1vdmVyIHVuYSBiw7pzcXVlZGEgZXNwZWPDrWZpY2FcbiAgY29uc3QgcmVtb3ZlU2VhcmNoID0gdXNlQ2FsbGJhY2soKHNlYXJjaDogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgY29uc3Qgc2FuaXRpemVkID0gc2FuaXRpemVTZWFyY2goc2VhcmNoKTtcbiAgICBcbiAgICBzZXRSZWNlbnRTZWFyY2hlcyhwcmV2ID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBwcmV2LmZpbHRlcihzID0+IHNhbml0aXplU2VhcmNoKHMpICE9PSBzYW5pdGl6ZWQpO1xuICAgICAgc2F2ZVRvU3RvcmFnZSh1cGRhdGVkKTtcbiAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgIH0pO1xuICB9LCBbc2FuaXRpemVTZWFyY2gsIHNhdmVUb1N0b3JhZ2VdKTtcblxuICAvLyBMaW1waWFyIHRvZGFzIGxhcyBiw7pzcXVlZGFzXG4gIGNvbnN0IGNsZWFyU2VhcmNoZXMgPSB1c2VDYWxsYmFjaygoKTogdm9pZCA9PiB7XG4gICAgc2V0UmVjZW50U2VhcmNoZXMoW10pO1xuICAgIHNhdmVUb1N0b3JhZ2UoW10pO1xuICB9LCBbc2F2ZVRvU3RvcmFnZV0pO1xuXG4gIC8vIFZlcmlmaWNhciBzaSB1bmEgYsO6c3F1ZWRhIGV4aXN0ZVxuICBjb25zdCBoYXNTZWFyY2ggPSB1c2VDYWxsYmFjaygoc2VhcmNoOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVNlYXJjaChzZWFyY2gpO1xuICAgIHJldHVybiByZWNlbnRTZWFyY2hlcy5zb21lKHMgPT4gc2FuaXRpemVTZWFyY2gocykgPT09IHNhbml0aXplZCk7XG4gIH0sIFtyZWNlbnRTZWFyY2hlcywgc2FuaXRpemVTZWFyY2hdKTtcblxuICAvLyBPYnRlbmVyIGxhcyBOIGLDunNxdWVkYXMgbcOhcyByZWNpZW50ZXNcbiAgY29uc3QgZ2V0UmVjZW50U2VhcmNoZXMgPSB1c2VDYWxsYmFjaygobGltaXQ/OiBudW1iZXIpOiBzdHJpbmdbXSA9PiB7XG4gICAgY29uc3QgYWN0dWFsTGltaXQgPSBsaW1pdCA/PyBjb25maWcubWF4U2VhcmNoZXM7XG4gICAgcmV0dXJuIHJlY2VudFNlYXJjaGVzLnNsaWNlKDAsIGFjdHVhbExpbWl0KTtcbiAgfSwgW3JlY2VudFNlYXJjaGVzLCBjb25maWcubWF4U2VhcmNoZXNdKTtcblxuICAvLyBNb3ZlciB1bmEgYsO6c3F1ZWRhIGFsIHByaW5jaXBpbyAocmVvcmRlbmFyKVxuICBjb25zdCBtb3ZlVG9Ub3AgPSB1c2VDYWxsYmFjaygoc2VhcmNoOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVNlYXJjaChzZWFyY2gpO1xuICAgIFxuICAgIHNldFJlY2VudFNlYXJjaGVzKHByZXYgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyZWQgPSBwcmV2LmZpbHRlcihzID0+IHNhbml0aXplU2VhcmNoKHMpICE9PSBzYW5pdGl6ZWQpO1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBwcmV2LmZpbmQocyA9PiBzYW5pdGl6ZVNlYXJjaChzKSA9PT0gc2FuaXRpemVkKTtcbiAgICAgIFxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIHByZXY7XG4gICAgICBcbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBbZXhpc3RpbmcsIC4uLmZpbHRlcmVkXTtcbiAgICAgIHNhdmVUb1N0b3JhZ2UodXBkYXRlZCk7XG4gICAgICByZXR1cm4gdXBkYXRlZDtcbiAgICB9KTtcbiAgfSwgW3Nhbml0aXplU2VhcmNoLCBzYXZlVG9TdG9yYWdlXSk7XG5cbiAgcmV0dXJuIHtcbiAgICByZWNlbnRTZWFyY2hlcyxcbiAgICBhZGRTZWFyY2gsXG4gICAgcmVtb3ZlU2VhcmNoLFxuICAgIGNsZWFyU2VhcmNoZXMsXG4gICAgaGFzU2VhcmNoLFxuICAgIGdldFJlY2VudFNlYXJjaGVzLFxuICAgIG1vdmVUb1RvcCxcbiAgfTtcbn1cblxuLyoqXG4gKiBIb29rIHNpbXBsaWZpY2FkbyBwYXJhIHNvbG8gb2J0ZW5lciBiw7pzcXVlZGFzIHJlY2llbnRlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlUmVjZW50U2VhcmNoZXNTaW1wbGUobGltaXQ6IG51bWJlciA9IDUpOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHsgZ2V0UmVjZW50U2VhcmNoZXMgfSA9IHVzZVJlY2VudFNlYXJjaGVzKHsgbWF4U2VhcmNoZXM6IGxpbWl0IH0pO1xuICByZXR1cm4gZ2V0UmVjZW50U2VhcmNoZXMoKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgdXNlUmVjZW50U2VhcmNoZXM7XG4iXSwibmFtZXMiOlsidXNlUmVjZW50U2VhcmNoZXMiLCJ1c2VSZWNlbnRTZWFyY2hlc1NpbXBsZSIsIkRFRkFVTFRfT1BUSU9OUyIsIm1heFNlYXJjaGVzIiwic3RvcmFnZUtleSIsImVuYWJsZVBlcnNpc3RlbmNlIiwiZmlsdGVyRHVwbGljYXRlcyIsImV4cGlyYXRpb25EYXlzIiwib3B0aW9ucyIsImNvbmZpZyIsInJlY2VudFNlYXJjaGVzIiwic2V0UmVjZW50U2VhcmNoZXMiLCJ1c2VTdGF0ZSIsInNhbml0aXplU2VhcmNoIiwidXNlQ2FsbGJhY2siLCJzZWFyY2giLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJpc0V4cGlyZWQiLCJ0aW1lc3RhbXAiLCJtYXhBZ2UiLCJEYXRlIiwibm93IiwibG9hZEZyb21TdG9yYWdlIiwid2luZG93Iiwic3RvcmVkIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInBhcnNlZCIsIkpTT04iLCJwYXJzZSIsInNlYXJjaGVzIiwiQXJyYXkiLCJpc0FycmF5IiwicmVtb3ZlSXRlbSIsInNsaWNlIiwiZXJyb3IiLCJjb25zb2xlIiwid2FybiIsImNsZWFudXBFcnJvciIsInNhdmVUb1N0b3JhZ2UiLCJsZW5ndGgiLCJkYXRhVG9TdG9yZSIsInZlcnNpb24iLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwidXNlRWZmZWN0IiwibG9hZGVkIiwiYWRkU2VhcmNoIiwic2FuaXRpemVkIiwicHJldiIsInVwZGF0ZWQiLCJmaWx0ZXIiLCJzIiwidW5zaGlmdCIsInJlbW92ZVNlYXJjaCIsImNsZWFyU2VhcmNoZXMiLCJoYXNTZWFyY2giLCJzb21lIiwiZ2V0UmVjZW50U2VhcmNoZXMiLCJsaW1pdCIsImFjdHVhbExpbWl0IiwibW92ZVRvVG9wIiwiZmlsdGVyZWQiLCJleGlzdGluZyIsImZpbmQiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0Qyw0RUFBNEU7QUFDNUUsc0NBQXNDOzs7Ozs7Ozs7Ozs7SUE2T3RDLE9BQWlDO2VBQWpDOztJQW5MZ0JBLGlCQUFpQjtl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