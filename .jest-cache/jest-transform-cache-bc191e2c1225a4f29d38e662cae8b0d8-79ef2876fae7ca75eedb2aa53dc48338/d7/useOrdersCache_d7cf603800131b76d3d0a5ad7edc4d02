e138928e00634c55a25467dd4641388c
// ===================================
// PINTEYA E-COMMERCE - ORDERS CACHE HOOK
// Hook especializado para manejo de cache de órdenes
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "useOrdersCache", {
    enumerable: true,
    get: function() {
        return useOrdersCache;
    }
});
const _react = require("react");
// Configuración de cache
const CACHE_CONFIG = {
    MAX_SIZE: 50,
    CLEANUP_INTERVAL: 10 * 60 * 1000,
    MIN_REQUEST_INTERVAL: 1000
};
// ===================================
// CACHE GLOBAL
// ===================================
// Cache compartido entre instancias del hook
const cache = new Map();
const pendingRequests = new Map();
const requestTimestamps = new Map();
// ===================================
// UTILIDADES DE CACHE
// ===================================
function getCacheKey(filters) {
    // Crear clave más estable ordenando las propiedades y normalizando valores
    const normalizedFilters = Object.keys(filters).sort().reduce((result, key)=>{
        const value = filters[key];
        // Normalizar valores para evitar claves duplicadas
        if (value !== undefined && value !== null && value !== '' && value !== 'all') {
            result[key] = value;
        }
        return result;
    }, {});
    return JSON.stringify(normalizedFilters);
}
function cleanupExpiredCache(cacheTimeout) {
    const now = Date.now();
    const expiredKeys = [];
    cache.forEach((entry, key)=>{
        if (now - entry.timestamp > cacheTimeout) {
            expiredKeys.push(key);
        }
    });
    expiredKeys.forEach((key)=>{
        cache.delete(key);
        requestTimestamps.delete(key);
    });
    // Limpiar cache si está muy grande
    if (cache.size > CACHE_CONFIG.MAX_SIZE) {
        const entries = Array.from(cache.entries());
        entries.sort((a, b)=>a[1].timestamp - b[1].timestamp);
        const toDelete = entries.slice(0, cache.size - CACHE_CONFIG.MAX_SIZE);
        toDelete.forEach(([key])=>{
            cache.delete(key);
            requestTimestamps.delete(key);
        });
    }
    if (process.env.NODE_ENV === 'development') {
        console.log('[useOrdersCache] Cache cleanup completed:', {
            expired: expiredKeys.length,
            currentSize: cache.size,
            maxSize: CACHE_CONFIG.MAX_SIZE
        });
    }
}
function useOrdersCache(options) {
    const lastCleanupRef = (0, _react.useRef)(Date.now());
    const getCachedData = (0, _react.useCallback)((filters)=>{
        if (!options.enableCache) return null;
        const key = getCacheKey(filters);
        const entry = cache.get(key);
        if (!entry) return null;
        const isExpired = Date.now() - entry.timestamp > options.cacheTimeout;
        if (isExpired) {
            cache.delete(key);
            requestTimestamps.delete(key);
            return null;
        }
        // Log de cache hit en desarrollo
        if (process.env.NODE_ENV === 'development') {
            console.log('[useOrdersCache] Cache hit:', {
                key: key.substring(0, 100) + '...',
                age: Date.now() - entry.timestamp,
                cacheSize: cache.size
            });
        }
        return entry.data;
    }, [
        options.enableCache,
        options.cacheTimeout
    ]);
    const setCachedData = (0, _react.useCallback)((filters, data)=>{
        if (!options.enableCache) return;
        const key = getCacheKey(filters);
        const requestId = Math.random().toString(36).substr(2, 9);
        cache.set(key, {
            data,
            timestamp: Date.now(),
            filters,
            requestId
        });
        requestTimestamps.set(key, Date.now());
        // Cleanup automático periódico
        const now = Date.now();
        if (now - lastCleanupRef.current > (options.cleanupInterval || CACHE_CONFIG.CLEANUP_INTERVAL)) {
            cleanupExpiredCache(options.cacheTimeout);
            lastCleanupRef.current = now;
        }
        if (process.env.NODE_ENV === 'development') {
            console.log('[useOrdersCache] Data cached:', {
                key: key.substring(0, 100) + '...',
                cacheSize: cache.size,
                requestId
            });
        }
    }, [
        options.enableCache,
        options.cacheTimeout,
        options.cleanupInterval
    ]);
    const clearCache = (0, _react.useCallback)(()=>{
        cache.clear();
        pendingRequests.clear();
        requestTimestamps.clear();
        if (process.env.NODE_ENV === 'development') {
            console.log('[useOrdersCache] Cache cleared');
        }
    }, []);
    const isRequestTooRecent = (0, _react.useCallback)((filters)=>{
        const key = getCacheKey(filters);
        const lastRequestTime = requestTimestamps.get(key);
        if (!lastRequestTime) return false;
        const timeSinceLastRequest = Date.now() - lastRequestTime;
        return timeSinceLastRequest < (options.minRequestInterval || CACHE_CONFIG.MIN_REQUEST_INTERVAL);
    }, [
        options.minRequestInterval
    ]);
    const setPendingRequest = (0, _react.useCallback)((filters, promise)=>{
        const key = getCacheKey(filters);
        pendingRequests.set(key, promise);
        // Limpiar cuando la promesa se resuelve
        promise.finally(()=>{
            pendingRequests.delete(key);
        });
    }, []);
    const getPendingRequest = (0, _react.useCallback)((filters)=>{
        const key = getCacheKey(filters);
        return pendingRequests.get(key) || null;
    }, []);
    const getCacheStats = (0, _react.useCallback)(()=>({
            size: cache.size,
            maxSize: options.maxSize || CACHE_CONFIG.MAX_SIZE,
            pendingRequests: pendingRequests.size
        }), [
        options.maxSize
    ]);
    return {
        getCachedData,
        setCachedData,
        clearCache,
        isRequestTooRecent,
        setPendingRequest,
        getPendingRequest,
        getCacheStats
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXGFkbWluXFx1c2VPcmRlcnNDYWNoZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUElOVEVZQSBFLUNPTU1FUkNFIC0gT1JERVJTIENBQ0hFIEhPT0tcbi8vIEhvb2sgZXNwZWNpYWxpemFkbyBwYXJhIG1hbmVqbyBkZSBjYWNoZSBkZSDDs3JkZW5lc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IFN0cmljdE9yZGVyc0xpc3RSZXNwb25zZSB9IGZyb20gJ0AvdHlwZXMvYXBpLXN0cmljdCc7XG5pbXBvcnQgeyBTdHJpY3RPcmRlckZpbHRlcnMgfSBmcm9tICcuL3VzZU9yZGVyc0VudGVycHJpc2VTdHJpY3QnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVElQT1MgWSBDT05GSUdVUkFDScOTTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW50ZXJmYWNlIENhY2hlRW50cnkge1xuICBkYXRhOiBTdHJpY3RPcmRlcnNMaXN0UmVzcG9uc2U7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBmaWx0ZXJzOiBTdHJpY3RPcmRlckZpbHRlcnM7XG4gIHJlcXVlc3RJZDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgQ2FjaGVPcHRpb25zIHtcbiAgZW5hYmxlQ2FjaGU6IGJvb2xlYW47XG4gIGNhY2hlVGltZW91dDogbnVtYmVyO1xuICBtYXhTaXplPzogbnVtYmVyO1xuICBjbGVhbnVwSW50ZXJ2YWw/OiBudW1iZXI7XG4gIG1pblJlcXVlc3RJbnRlcnZhbD86IG51bWJlcjtcbn1cblxuLy8gQ29uZmlndXJhY2nDs24gZGUgY2FjaGVcbmNvbnN0IENBQ0hFX0NPTkZJRyA9IHtcbiAgTUFYX1NJWkU6IDUwLFxuICBDTEVBTlVQX0lOVEVSVkFMOiAxMCAqIDYwICogMTAwMCwgLy8gMTAgbWludXRvc1xuICBNSU5fUkVRVUVTVF9JTlRFUlZBTDogMTAwMCwgLy8gMSBzZWd1bmRvIG3DrW5pbW8gZW50cmUgcGV0aWNpb25lcyBpZMOpbnRpY2FzXG59IGFzIGNvbnN0O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ0FDSEUgR0xPQkFMXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vLyBDYWNoZSBjb21wYXJ0aWRvIGVudHJlIGluc3RhbmNpYXMgZGVsIGhvb2tcbmNvbnN0IGNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIENhY2hlRW50cnk+KCk7XG5jb25zdCBwZW5kaW5nUmVxdWVzdHMgPSBuZXcgTWFwPHN0cmluZywgUHJvbWlzZTxhbnk+PigpO1xuY29uc3QgcmVxdWVzdFRpbWVzdGFtcHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVVRJTElEQURFUyBERSBDQUNIRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gZ2V0Q2FjaGVLZXkoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzKTogc3RyaW5nIHtcbiAgLy8gQ3JlYXIgY2xhdmUgbcOhcyBlc3RhYmxlIG9yZGVuYW5kbyBsYXMgcHJvcGllZGFkZXMgeSBub3JtYWxpemFuZG8gdmFsb3Jlc1xuICBjb25zdCBub3JtYWxpemVkRmlsdGVycyA9IE9iamVjdC5rZXlzKGZpbHRlcnMpXG4gICAgLnNvcnQoKVxuICAgIC5yZWR1Y2UoKHJlc3VsdCwga2V5KSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGZpbHRlcnNba2V5IGFzIGtleW9mIFN0cmljdE9yZGVyRmlsdGVyc107XG4gICAgICAvLyBOb3JtYWxpemFyIHZhbG9yZXMgcGFyYSBldml0YXIgY2xhdmVzIGR1cGxpY2FkYXNcbiAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSAnJyAmJiB2YWx1ZSAhPT0gJ2FsbCcpIHtcbiAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSwge30gYXMgYW55KTtcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG5vcm1hbGl6ZWRGaWx0ZXJzKTtcbn1cblxuZnVuY3Rpb24gY2xlYW51cEV4cGlyZWRDYWNoZShjYWNoZVRpbWVvdXQ6IG51bWJlcik6IHZvaWQge1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBjb25zdCBleHBpcmVkS2V5czogc3RyaW5nW10gPSBbXTtcbiAgXG4gIGNhY2hlLmZvckVhY2goKGVudHJ5LCBrZXkpID0+IHtcbiAgICBpZiAobm93IC0gZW50cnkudGltZXN0YW1wID4gY2FjaGVUaW1lb3V0KSB7XG4gICAgICBleHBpcmVkS2V5cy5wdXNoKGtleSk7XG4gICAgfVxuICB9KTtcbiAgXG4gIGV4cGlyZWRLZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICBjYWNoZS5kZWxldGUoa2V5KTtcbiAgICByZXF1ZXN0VGltZXN0YW1wcy5kZWxldGUoa2V5KTtcbiAgfSk7XG4gIFxuICAvLyBMaW1waWFyIGNhY2hlIHNpIGVzdMOhIG11eSBncmFuZGVcbiAgaWYgKGNhY2hlLnNpemUgPiBDQUNIRV9DT05GSUcuTUFYX1NJWkUpIHtcbiAgICBjb25zdCBlbnRyaWVzID0gQXJyYXkuZnJvbShjYWNoZS5lbnRyaWVzKCkpO1xuICAgIGVudHJpZXMuc29ydCgoYSwgYikgPT4gYVsxXS50aW1lc3RhbXAgLSBiWzFdLnRpbWVzdGFtcCk7XG4gICAgXG4gICAgY29uc3QgdG9EZWxldGUgPSBlbnRyaWVzLnNsaWNlKDAsIGNhY2hlLnNpemUgLSBDQUNIRV9DT05GSUcuTUFYX1NJWkUpO1xuICAgIHRvRGVsZXRlLmZvckVhY2goKFtrZXldKSA9PiB7XG4gICAgICBjYWNoZS5kZWxldGUoa2V5KTtcbiAgICAgIHJlcXVlc3RUaW1lc3RhbXBzLmRlbGV0ZShrZXkpO1xuICAgIH0pO1xuICB9XG4gIFxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICBjb25zb2xlLmxvZygnW3VzZU9yZGVyc0NhY2hlXSBDYWNoZSBjbGVhbnVwIGNvbXBsZXRlZDonLCB7XG4gICAgICBleHBpcmVkOiBleHBpcmVkS2V5cy5sZW5ndGgsXG4gICAgICBjdXJyZW50U2l6ZTogY2FjaGUuc2l6ZSxcbiAgICAgIG1heFNpemU6IENBQ0hFX0NPTkZJRy5NQVhfU0laRVxuICAgIH0pO1xuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIT09LIERFIENBQ0hFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzZU9yZGVyc0NhY2hlUmV0dXJuIHtcbiAgZ2V0Q2FjaGVkRGF0YTogKGZpbHRlcnM6IFN0cmljdE9yZGVyRmlsdGVycykgPT4gU3RyaWN0T3JkZXJzTGlzdFJlc3BvbnNlIHwgbnVsbDtcbiAgc2V0Q2FjaGVkRGF0YTogKGZpbHRlcnM6IFN0cmljdE9yZGVyRmlsdGVycywgZGF0YTogU3RyaWN0T3JkZXJzTGlzdFJlc3BvbnNlKSA9PiB2b2lkO1xuICBjbGVhckNhY2hlOiAoKSA9PiB2b2lkO1xuICBpc1JlcXVlc3RUb29SZWNlbnQ6IChmaWx0ZXJzOiBTdHJpY3RPcmRlckZpbHRlcnMpID0+IGJvb2xlYW47XG4gIHNldFBlbmRpbmdSZXF1ZXN0OiAoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzLCBwcm9taXNlOiBQcm9taXNlPGFueT4pID0+IHZvaWQ7XG4gIGdldFBlbmRpbmdSZXF1ZXN0OiAoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzKSA9PiBQcm9taXNlPGFueT4gfCBudWxsO1xuICBnZXRDYWNoZVN0YXRzOiAoKSA9PiB7IHNpemU6IG51bWJlcjsgbWF4U2l6ZTogbnVtYmVyOyBwZW5kaW5nUmVxdWVzdHM6IG51bWJlciB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXNlT3JkZXJzQ2FjaGUob3B0aW9uczogQ2FjaGVPcHRpb25zKTogVXNlT3JkZXJzQ2FjaGVSZXR1cm4ge1xuICBjb25zdCBsYXN0Q2xlYW51cFJlZiA9IHVzZVJlZjxudW1iZXI+KERhdGUubm93KCkpO1xuICBcbiAgY29uc3QgZ2V0Q2FjaGVkRGF0YSA9IHVzZUNhbGxiYWNrKChmaWx0ZXJzOiBTdHJpY3RPcmRlckZpbHRlcnMpOiBTdHJpY3RPcmRlcnNMaXN0UmVzcG9uc2UgfCBudWxsID0+IHtcbiAgICBpZiAoIW9wdGlvbnMuZW5hYmxlQ2FjaGUpIHJldHVybiBudWxsO1xuICAgIFxuICAgIGNvbnN0IGtleSA9IGdldENhY2hlS2V5KGZpbHRlcnMpO1xuICAgIGNvbnN0IGVudHJ5ID0gY2FjaGUuZ2V0KGtleSk7XG4gICAgXG4gICAgaWYgKCFlbnRyeSkgcmV0dXJuIG51bGw7XG4gICAgXG4gICAgY29uc3QgaXNFeHBpcmVkID0gRGF0ZS5ub3coKSAtIGVudHJ5LnRpbWVzdGFtcCA+IG9wdGlvbnMuY2FjaGVUaW1lb3V0O1xuICAgIGlmIChpc0V4cGlyZWQpIHtcbiAgICAgIGNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgcmVxdWVzdFRpbWVzdGFtcHMuZGVsZXRlKGtleSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgLy8gTG9nIGRlIGNhY2hlIGhpdCBlbiBkZXNhcnJvbGxvXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgICBjb25zb2xlLmxvZygnW3VzZU9yZGVyc0NhY2hlXSBDYWNoZSBoaXQ6JywgeyBcbiAgICAgICAga2V5OiBrZXkuc3Vic3RyaW5nKDAsIDEwMCkgKyAnLi4uJywgXG4gICAgICAgIGFnZTogRGF0ZS5ub3coKSAtIGVudHJ5LnRpbWVzdGFtcCxcbiAgICAgICAgY2FjaGVTaXplOiBjYWNoZS5zaXplIFxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBlbnRyeS5kYXRhO1xuICB9LCBbb3B0aW9ucy5lbmFibGVDYWNoZSwgb3B0aW9ucy5jYWNoZVRpbWVvdXRdKTtcbiAgXG4gIGNvbnN0IHNldENhY2hlZERhdGEgPSB1c2VDYWxsYmFjaygoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzLCBkYXRhOiBTdHJpY3RPcmRlcnNMaXN0UmVzcG9uc2UpOiB2b2lkID0+IHtcbiAgICBpZiAoIW9wdGlvbnMuZW5hYmxlQ2FjaGUpIHJldHVybjtcbiAgICBcbiAgICBjb25zdCBrZXkgPSBnZXRDYWNoZUtleShmaWx0ZXJzKTtcbiAgICBjb25zdCByZXF1ZXN0SWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG4gICAgXG4gICAgY2FjaGUuc2V0KGtleSwge1xuICAgICAgZGF0YSxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIGZpbHRlcnMsXG4gICAgICByZXF1ZXN0SWRcbiAgICB9KTtcbiAgICBcbiAgICByZXF1ZXN0VGltZXN0YW1wcy5zZXQoa2V5LCBEYXRlLm5vdygpKTtcbiAgICBcbiAgICAvLyBDbGVhbnVwIGF1dG9tw6F0aWNvIHBlcmnDs2RpY29cbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGlmIChub3cgLSBsYXN0Q2xlYW51cFJlZi5jdXJyZW50ID4gKG9wdGlvbnMuY2xlYW51cEludGVydmFsIHx8IENBQ0hFX0NPTkZJRy5DTEVBTlVQX0lOVEVSVkFMKSkge1xuICAgICAgY2xlYW51cEV4cGlyZWRDYWNoZShvcHRpb25zLmNhY2hlVGltZW91dCk7XG4gICAgICBsYXN0Q2xlYW51cFJlZi5jdXJyZW50ID0gbm93O1xuICAgIH1cbiAgICBcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbdXNlT3JkZXJzQ2FjaGVdIERhdGEgY2FjaGVkOicsIHtcbiAgICAgICAga2V5OiBrZXkuc3Vic3RyaW5nKDAsIDEwMCkgKyAnLi4uJyxcbiAgICAgICAgY2FjaGVTaXplOiBjYWNoZS5zaXplLFxuICAgICAgICByZXF1ZXN0SWRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwgW29wdGlvbnMuZW5hYmxlQ2FjaGUsIG9wdGlvbnMuY2FjaGVUaW1lb3V0LCBvcHRpb25zLmNsZWFudXBJbnRlcnZhbF0pO1xuICBcbiAgY29uc3QgY2xlYXJDYWNoZSA9IHVzZUNhbGxiYWNrKCgpOiB2b2lkID0+IHtcbiAgICBjYWNoZS5jbGVhcigpO1xuICAgIHBlbmRpbmdSZXF1ZXN0cy5jbGVhcigpO1xuICAgIHJlcXVlc3RUaW1lc3RhbXBzLmNsZWFyKCk7XG4gICAgXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgICBjb25zb2xlLmxvZygnW3VzZU9yZGVyc0NhY2hlXSBDYWNoZSBjbGVhcmVkJyk7XG4gICAgfVxuICB9LCBbXSk7XG4gIFxuICBjb25zdCBpc1JlcXVlc3RUb29SZWNlbnQgPSB1c2VDYWxsYmFjaygoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzKTogYm9vbGVhbiA9PiB7XG4gICAgY29uc3Qga2V5ID0gZ2V0Q2FjaGVLZXkoZmlsdGVycyk7XG4gICAgY29uc3QgbGFzdFJlcXVlc3RUaW1lID0gcmVxdWVzdFRpbWVzdGFtcHMuZ2V0KGtleSk7XG4gICAgXG4gICAgaWYgKCFsYXN0UmVxdWVzdFRpbWUpIHJldHVybiBmYWxzZTtcbiAgICBcbiAgICBjb25zdCB0aW1lU2luY2VMYXN0UmVxdWVzdCA9IERhdGUubm93KCkgLSBsYXN0UmVxdWVzdFRpbWU7XG4gICAgcmV0dXJuIHRpbWVTaW5jZUxhc3RSZXF1ZXN0IDwgKG9wdGlvbnMubWluUmVxdWVzdEludGVydmFsIHx8IENBQ0hFX0NPTkZJRy5NSU5fUkVRVUVTVF9JTlRFUlZBTCk7XG4gIH0sIFtvcHRpb25zLm1pblJlcXVlc3RJbnRlcnZhbF0pO1xuICBcbiAgY29uc3Qgc2V0UGVuZGluZ1JlcXVlc3QgPSB1c2VDYWxsYmFjaygoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzLCBwcm9taXNlOiBQcm9taXNlPGFueT4pOiB2b2lkID0+IHtcbiAgICBjb25zdCBrZXkgPSBnZXRDYWNoZUtleShmaWx0ZXJzKTtcbiAgICBwZW5kaW5nUmVxdWVzdHMuc2V0KGtleSwgcHJvbWlzZSk7XG4gICAgXG4gICAgLy8gTGltcGlhciBjdWFuZG8gbGEgcHJvbWVzYSBzZSByZXN1ZWx2ZVxuICAgIHByb21pc2UuZmluYWxseSgoKSA9PiB7XG4gICAgICBwZW5kaW5nUmVxdWVzdHMuZGVsZXRlKGtleSk7XG4gICAgfSk7XG4gIH0sIFtdKTtcbiAgXG4gIGNvbnN0IGdldFBlbmRpbmdSZXF1ZXN0ID0gdXNlQ2FsbGJhY2soKGZpbHRlcnM6IFN0cmljdE9yZGVyRmlsdGVycyk6IFByb21pc2U8YW55PiB8IG51bGwgPT4ge1xuICAgIGNvbnN0IGtleSA9IGdldENhY2hlS2V5KGZpbHRlcnMpO1xuICAgIHJldHVybiBwZW5kaW5nUmVxdWVzdHMuZ2V0KGtleSkgfHwgbnVsbDtcbiAgfSwgW10pO1xuICBcbiAgY29uc3QgZ2V0Q2FjaGVTdGF0cyA9IHVzZUNhbGxiYWNrKCgpID0+ICh7XG4gICAgc2l6ZTogY2FjaGUuc2l6ZSxcbiAgICBtYXhTaXplOiBvcHRpb25zLm1heFNpemUgfHwgQ0FDSEVfQ09ORklHLk1BWF9TSVpFLFxuICAgIHBlbmRpbmdSZXF1ZXN0czogcGVuZGluZ1JlcXVlc3RzLnNpemVcbiAgfSksIFtvcHRpb25zLm1heFNpemVdKTtcbiAgXG4gIHJldHVybiB7XG4gICAgZ2V0Q2FjaGVkRGF0YSxcbiAgICBzZXRDYWNoZWREYXRhLFxuICAgIGNsZWFyQ2FjaGUsXG4gICAgaXNSZXF1ZXN0VG9vUmVjZW50LFxuICAgIHNldFBlbmRpbmdSZXF1ZXN0LFxuICAgIGdldFBlbmRpbmdSZXF1ZXN0LFxuICAgIGdldENhY2hlU3RhdHNcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJ1c2VPcmRlcnNDYWNoZSIsIkNBQ0hFX0NPTkZJRyIsIk1BWF9TSVpFIiwiQ0xFQU5VUF9JTlRFUlZBTCIsIk1JTl9SRVFVRVNUX0lOVEVSVkFMIiwiY2FjaGUiLCJNYXAiLCJwZW5kaW5nUmVxdWVzdHMiLCJyZXF1ZXN0VGltZXN0YW1wcyIsImdldENhY2hlS2V5IiwiZmlsdGVycyIsIm5vcm1hbGl6ZWRGaWx0ZXJzIiwiT2JqZWN0Iiwia2V5cyIsInNvcnQiLCJyZWR1Y2UiLCJyZXN1bHQiLCJrZXkiLCJ2YWx1ZSIsInVuZGVmaW5lZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJjbGVhbnVwRXhwaXJlZENhY2hlIiwiY2FjaGVUaW1lb3V0Iiwibm93IiwiRGF0ZSIsImV4cGlyZWRLZXlzIiwiZm9yRWFjaCIsImVudHJ5IiwidGltZXN0YW1wIiwicHVzaCIsImRlbGV0ZSIsInNpemUiLCJlbnRyaWVzIiwiQXJyYXkiLCJmcm9tIiwiYSIsImIiLCJ0b0RlbGV0ZSIsInNsaWNlIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiY29uc29sZSIsImxvZyIsImV4cGlyZWQiLCJsZW5ndGgiLCJjdXJyZW50U2l6ZSIsIm1heFNpemUiLCJvcHRpb25zIiwibGFzdENsZWFudXBSZWYiLCJ1c2VSZWYiLCJnZXRDYWNoZWREYXRhIiwidXNlQ2FsbGJhY2siLCJlbmFibGVDYWNoZSIsImdldCIsImlzRXhwaXJlZCIsInN1YnN0cmluZyIsImFnZSIsImNhY2hlU2l6ZSIsImRhdGEiLCJzZXRDYWNoZWREYXRhIiwicmVxdWVzdElkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwic2V0IiwiY3VycmVudCIsImNsZWFudXBJbnRlcnZhbCIsImNsZWFyQ2FjaGUiLCJjbGVhciIsImlzUmVxdWVzdFRvb1JlY2VudCIsImxhc3RSZXF1ZXN0VGltZSIsInRpbWVTaW5jZUxhc3RSZXF1ZXN0IiwibWluUmVxdWVzdEludGVydmFsIiwic2V0UGVuZGluZ1JlcXVlc3QiLCJwcm9taXNlIiwiZmluYWxseSIsImdldFBlbmRpbmdSZXF1ZXN0IiwiZ2V0Q2FjaGVTdGF0cyJdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBQ3RDLHlDQUF5QztBQUN6QyxxREFBcUQ7QUFDckQsc0NBQXNDOzs7OzsrQkE4R3RCQTs7O2VBQUFBOzs7dUJBNUdvQjtBQXVCcEMseUJBQXlCO0FBQ3pCLE1BQU1DLGVBQWU7SUFDbkJDLFVBQVU7SUFDVkMsa0JBQWtCLEtBQUssS0FBSztJQUM1QkMsc0JBQXNCO0FBQ3hCO0FBRUEsc0NBQXNDO0FBQ3RDLGVBQWU7QUFDZixzQ0FBc0M7QUFFdEMsNkNBQTZDO0FBQzdDLE1BQU1DLFFBQVEsSUFBSUM7QUFDbEIsTUFBTUMsa0JBQWtCLElBQUlEO0FBQzVCLE1BQU1FLG9CQUFvQixJQUFJRjtBQUU5QixzQ0FBc0M7QUFDdEMsc0JBQXNCO0FBQ3RCLHNDQUFzQztBQUV0QyxTQUFTRyxZQUFZQyxPQUEyQjtJQUM5QywyRUFBMkU7SUFDM0UsTUFBTUMsb0JBQW9CQyxPQUFPQyxJQUFJLENBQUNILFNBQ25DSSxJQUFJLEdBQ0pDLE1BQU0sQ0FBQyxDQUFDQyxRQUFRQztRQUNmLE1BQU1DLFFBQVFSLE9BQU8sQ0FBQ08sSUFBZ0M7UUFDdEQsbURBQW1EO1FBQ25ELElBQUlDLFVBQVVDLGFBQWFELFVBQVUsUUFBUUEsVUFBVSxNQUFNQSxVQUFVLE9BQU87WUFDNUVGLE1BQU0sQ0FBQ0MsSUFBSSxHQUFHQztRQUNoQjtRQUNBLE9BQU9GO0lBQ1QsR0FBRyxDQUFDO0lBQ04sT0FBT0ksS0FBS0MsU0FBUyxDQUFDVjtBQUN4QjtBQUVBLFNBQVNXLG9CQUFvQkMsWUFBb0I7SUFDL0MsTUFBTUMsTUFBTUMsS0FBS0QsR0FBRztJQUNw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