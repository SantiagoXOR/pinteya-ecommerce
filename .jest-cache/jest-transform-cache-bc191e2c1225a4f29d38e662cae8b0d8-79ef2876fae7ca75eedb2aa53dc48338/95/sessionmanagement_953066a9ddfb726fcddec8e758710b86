7d324f304a36c5c5b6d2eab1173da6b6
/**
 * Sistema de Gestión Avanzada de Sesiones
 * Maneja sincronización entre Clerk y Supabase, invalidación automática y cleanup
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    cleanupExpiredSessions: function() {
        return cleanupExpiredSessions;
    },
    cleanupOldSessions: function() {
        return cleanupOldSessions;
    },
    createSession: function() {
        return createSession;
    },
    getSessionInfo: function() {
        return getSessionInfo;
    },
    getSessionStats: function() {
        return getSessionStats;
    },
    getUserSessions: function() {
        return getUserSessions;
    },
    invalidateAllUserSessions: function() {
        return invalidateAllUserSessions;
    },
    invalidateSession: function() {
        return invalidateSession;
    },
    isSessionValid: function() {
        return isSessionValid;
    },
    startSessionCleanup: function() {
        return startSessionCleanup;
    },
    stopSessionCleanup: function() {
        return stopSessionCleanup;
    },
    syncSessionsWithClerk: function() {
        return syncSessionsWithClerk;
    },
    updateSession: function() {
        return updateSession;
    },
    updateSessionActivity: function() {
        return updateSessionActivity;
    }
});
const _server = require("@clerk/nextjs/server");
const _supabase = require("../supabase");
const _securityaudit = require("./security-audit");
const _cachemanager = require("../cache-manager");
// =====================================================
// CONFIGURACIÓN
// =====================================================
const SESSION_CONFIG = {
    maxSessionsPerUser: 5,
    sessionTimeout: 24 * 60 * 60 * 1000,
    cleanupInterval: 60 * 60 * 1000,
    maxInactiveTime: 2 * 60 * 60 * 1000,
    cacheTimeout: 10 * 60 * 1000 // 10 minutos
};
// =====================================================
// FUNCIONES DE UTILIDAD
// =====================================================
/**
 * Extrae información del dispositivo desde User-Agent
 */ function parseDeviceInfo(userAgent) {
    if (!userAgent) {
        return {
            type: 'unknown'
        };
    }
    const ua = userAgent.toLowerCase();
    // Detectar tipo de dispositivo
    let type = 'desktop';
    if (ua.includes('mobile')) type = 'mobile';
    else if (ua.includes('tablet') || ua.includes('ipad')) type = 'tablet';
    // Detectar OS
    let os;
    if (ua.includes('windows')) os = 'Windows';
    else if (ua.includes('mac')) os = 'macOS';
    else if (ua.includes('linux')) os = 'Linux';
    else if (ua.includes('android')) os = 'Android';
    else if (ua.includes('ios') || ua.includes('iphone')) os = 'iOS';
    // Detectar browser
    let browser;
    if (ua.includes('chrome')) browser = 'Chrome';
    else if (ua.includes('firefox')) browser = 'Firefox';
    else if (ua.includes('safari')) browser = 'Safari';
    else if (ua.includes('edge')) browser = 'Edge';
    return {
        type,
        os,
        browser
    };
}
/**
 * Genera ID único para sesión
 */ function generateSessionId() {
    return `sess_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
}
/**
 * Calcula fecha de expiración
 */ function calculateExpirationDate() {
    return new Date(Date.now() + SESSION_CONFIG.sessionTimeout).toISOString();
}
async function createSession(userId, clerkSessionId, request) {
    try {
        console.log(`[SESSION] Creando sesión para usuario ${userId}`);
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        // Extraer información de la request
        const ipAddress = request?.headers.get('x-forwarded-for') || request?.headers.get('x-real-ip') || 'unknown';
        const userAgent = request?.headers.get('user-agent') || 'unknown';
        const deviceInfo = parseDeviceInfo(userAgent);
        // Verificar límite de sesiones por usuario
        const { data: existingSessions, error: countError } = await _supabase.supabaseAdmin.from('user_sessions').select('id').eq('user_id', userId).eq('status', 'active');
        if (countError) {
            throw new Error(`Error verificando sesiones existentes: ${countError.message}`);
        }
        // Si hay demasiadas sesiones, eliminar las más antiguas
        if (existingSessions && existingSessions.length >= SESSION_CONFIG.maxSessionsPerUser) {
            console.log(`[SESSION] Usuario ${userId} tiene ${existingSessions.length} sesiones, limpiando...`);
            await cleanupOldSessions(userId, SESSION_CONFIG.maxSessionsPerUser - 1);
        }
        // Crear nueva sesión
        const sessionData = {
            user_id: userId,
            clerk_session_id: clerkSessionId,
            status: 'active',
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
            expires_at: calculateExpirationDate(),
            last_activity: new Date().toISOString(),
            ip_address: ipAddress,
            user_agent: userAgent,
            device_info: deviceInfo,
            metadata: {
                login_method: 'clerk',
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                session_duration: 0
            }
        };
        const { data: newSession, error: insertError } = await _supabase.supabaseAdmin.from('user_sessions').insert(sessionData).select('*').single();
        if (insertError) {
            throw new Error(`Error creando sesión: ${insertError.message}`);
        }
        // Log evento de seguridad
        await (0, _securityaudit.logSecurityEvent)({
            user_id: userId,
            event_type: 'AUTH_SUCCESS',
            event_category: 'authentication',
            severity: 'low',
            description: 'Nueva sesión creada',
            metadata: {
                session_id: newSession.id,
                clerk_session_id: clerkSessionId,
                device_info: deviceInfo,
                ip_address: ipAddress
            }
        });
        // Invalidar cache de sesiones del usuario
        const cache = _cachemanager.CacheManager.getInstance();
        await cache.delete(_cachemanager.CACHE_CONFIGS.USER_SESSION, `sessions_${userId}`);
        return {
            success: true,
            action: 'created',
            sessionId: newSession.id,
            details: {
                sessionData: newSession
            }
        };
    } catch (error) {
        console.error('[SESSION] Error creando sesión:', error);
        await (0, _securityaudit.logSecurityEvent)({
            user_id: userId,
            event_type: 'SECURITY_VIOLATION',
            event_category: 'authentication',
            severity: 'medium',
            description: 'Error creando sesión',
            metadata: {
                error: error.message,
                clerk_session_id: clerkSessionId
            }
        });
        return {
            success: false,
            action: 'error',
            error: error.message
        };
    }
}
async function updateSession(clerkSessionId, updates) {
    try {
        console.log(`[SESSION] Actualizando sesión ${clerkSessionId}`);
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const updateData = {
            ...updates,
            updated_at: new Date().toISOString(),
            last_activity: new Date().toISOString()
        };
        const { data: updatedSession, error: updateError } = await _supabase.supabaseAdmin.from('user_sessions').update(updateData).eq('clerk_session_id', clerkSessionId).eq('status', 'active').select('*').single();
        if (updateError) {
            if (updateError.code === 'PGRST116') {
                return {
                    success: false,
                    action: 'error',
                    error: 'Sesión no encontrada o inactiva'
                };
            }
            throw new Error(`Error actualizando sesión: ${updateError.message}`);
        }
        // Invalidar cache
        const cache = _cachemanager.CacheManager.getInstance();
        await cache.delete(_cachemanager.CACHE_CONFIGS.USER_SESSION, `sessions_${updatedSession.user_id}`);
        return {
            success: true,
            action: 'updated',
            sessionId: updatedSession.id,
            details: {
                sessionData: updatedSession
            }
        };
    } catch (error) {
        console.error('[SESSION] Error actualizando sesión:', error);
        return {
            success: false,
            action: 'error',
            error: error.message
        };
    }
}
async function cleanupOldSessions(userId, keepCount = SESSION_CONFIG.maxSessionsPerUser - 1) {
    try {
        console.log(`[SESSION] Limpiando sesiones antiguas para usuario ${userId}`);
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        // Obtener sesiones activas ordenadas por última actividad
        const { data: sessions, error: fetchError } = await _supabase.supabaseAdmin.from('user_sessions').select('*').eq('user_id', userId).eq('status', 'active').order('last_activity', {
            ascending: false
        });
        if (fetchError) {
            throw new Error(`Error obteniendo sesiones: ${fetchError.message}`);
        }
        if (!sessions || sessions.length <= keepCount) {
            return {
                success: true,
                cleaned: 0,
                errors: 0,
                details: {
                    expired: 0,
                    orphaned: 0,
                    invalid: 0
                }
            };
        }
        // Sesiones a eliminar (las más antiguas)
        const sessionsToRemove = sessions.slice(keepCount);
        let cleaned = 0;
        let errors = 0;
        for (const session of sessionsToRemove){
            try {
                const { error: deleteError } = await _supabase.supabaseAdmin.from('user_sessions').update({
                    status: 'expired',
                    updated_at: new Date().toISOString(),
                    metadata: {
                        ...session.metadata,
                        expired_at: new Date().toISOString(),
                        expired_reason: 'max_sessions_exceeded'
                    }
                }).eq('id', session.id);
                if (deleteError) {
                    console.error(`[SESSION] Error eliminando sesión ${session.id}:`, deleteError);
                    errors++;
                } else {
                    cleaned++;
                }
            } catch (error) {
                console.error(`[SESSION] Error procesando sesión ${session.id}:`, error);
                errors++;
            }
        }
        // Invalidar cache
        const cache = _cachemanager.CacheManager.getInstance();
        await cache.delete(_cachemanager.CACHE_CONFIGS.USER_SESSION, `sessions_${userId}`);
        return {
            success: errors === 0,
            cleaned,
            errors,
            details: {
                expired: cleaned,
                orphaned: 0,
                invalid: 0
            }
        };
    } catch (error) {
        console.error('[SESSION] Error en cleanup de sesiones:', error);
        return {
            success: false,
            cleaned: 0,
            errors: 1,
            details: {
                expired: 0,
                orphaned: 0,
                invalid: 0
            }
        };
    }
}
async function cleanupExpiredSessions() {
    try {
        console.log('[SESSION] Iniciando cleanup global de sesiones expiradas');
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const now = new Date().toISOString();
        const inactiveThreshold = new Date(Date.now() - SESSION_CONFIG.maxInactiveTime).toISOString();
        // Buscar sesiones expiradas o inactivas
        const { data: expiredSessions, error: fetchError } = await _supabase.supabaseAdmin.from('user_sessions').select('*').eq('status', 'active').or(`expires_at.lt.${now},last_activity.lt.${inactiveThreshold}`);
        if (fetchError) {
            throw new Error(`Error obteniendo sesiones expiradas: ${fetchError.message}`);
        }
        if (!expiredSessions || expiredSessions.length === 0) {
            return {
                success: true,
                cleaned: 0,
                errors: 0,
                details: {
                    expired: 0,
                    orphaned: 0,
                    invalid: 0
                }
            };
        }
        console.log(`[SESSION] Encontradas ${expiredSessions.length} sesiones para limpiar`);
        let expired = 0;
        let orphaned = 0;
        let invalid = 0;
        let errors = 0;
        for (const session of expiredSessions){
            try {
                // Verificar si la sesión existe en Clerk
                let isOrphaned = false;
                try {
                    const client = await (0, _server.clerkClient)();
                    await client.sessions.getSession(session.clerk_session_id);
                } catch (clerkError) {
                    // Sesión no existe en Clerk, es huérfana
                    isOrphaned = true;
                }
                const reason = isOrphaned ? 'orphaned' : session.expires_at < now ? 'expired' : 'inactive';
                const { error: updateError } = await _supabase.supabaseAdmin.from('user_sessions').update({
                    status: reason === 'orphaned' ? 'invalid' : 'expired',
                    updated_at: new Date().toISOString(),
                    metadata: {
                        ...session.metadata,
                        cleanup_at: new Date().toISOString(),
                        cleanup_reason: reason
                    }
                }).eq('id', session.id);
                if (updateError) {
                    console.error(`[SESSION] Error actualizando sesión ${session.id}:`, updateError);
                    errors++;
                } else {
                    if (reason === 'orphaned') orphaned++;
                    else if (reason === 'expired') expired++;
                    else invalid++;
                    // Log evento de limpieza
                    await (0, _securityaudit.logSecurityEvent)({
                        user_id: session.user_id,
                        event_type: 'ADMIN_ACTION',
                        event_category: 'admin_operations',
                        severity: 'low',
                        description: `Sesión limpiada: ${reason}`,
                        metadata: {
                            session_id: session.id,
                            clerk_session_id: session.clerk_session_id,
                            cleanup_reason: reason
                        }
                    });
                }
            } catch (error) {
                console.error(`[SESSION] Error procesando sesión ${session.id}:`, error);
                errors++;
            }
        }
        console.log(`[SESSION] Cleanup completado: ${expired + orphaned + invalid} sesiones limpiadas, ${errors} errores`);
        return {
            success: errors === 0,
            cleaned: expired + orphaned + invalid,
            errors,
            details: {
                expired,
                orphaned,
                invalid
            }
        };
    } catch (error) {
        console.error('[SESSION] Error en cleanup global:', error);
        return {
            success: false,
            cleaned: 0,
            errors: 1,
            details: {
                expired: 0,
                orphaned: 0,
                invalid: 0
            }
        };
    }
}
async function syncSessionsWithClerk(userId) {
    try {
        console.log(`[SESSION] Sincronizando sesiones de Clerk para usuario ${userId}`);
        const client = await (0, _server.clerkClient)();
        const clerkSessions = await client.users.getUserList({
            userId: [
                userId
            ]
        });
        if (!clerkSessions || clerkSessions.length === 0) {
            return {
                success: false,
                action: 'error',
                error: 'Usuario no encontrado en Clerk'
            };
        }
        const user = clerkSessions[0];
        const activeSessions = user.sessions?.filter((s)=>s.status === 'active') || [];
        // Obtener sesiones de Supabase
        const { data: supabaseSessions, error: fetchError } = await _supabase.supabaseAdmin.from('user_sessions').select('*').eq('user_id', userId).eq('status', 'active');
        if (fetchError) {
            throw new Error(`Error obteniendo sesiones de Supabase: ${fetchError.message}`);
        }
        const supabaseSessionIds = new Set(supabaseSessions?.map((s)=>s.clerk_session_id) || []);
        const clerkSessionIds = new Set(activeSessions.map((s)=>s.id));
        // Invalidar sesiones que no existen en Clerk
        const orphanedSessions = supabaseSessions?.filter((s)=>!clerkSessionIds.has(s.clerk_session_id)) || [];
        for (const session of orphanedSessions){
            await invalidateSession(session.clerk_session_id, 'clerk_sync_orphaned');
        }
        // Crear sesiones que existen en Clerk pero no en Supabase
        const missingSessions = activeSessions.filter((s)=>!supabaseSessionIds.has(s.id));
        for (const session of missingSessions){
            await createSession(userId, session.id);
        }
        return {
            success: true,
            action: 'updated',
            details: {
                orphaned_cleaned: orphanedSessions.length,
                missing_created: missingSessions.length,
                total_active: activeSessions.length
            }
        };
    } catch (error) {
        console.error('[SESSION] Error sincronizando con Clerk:', error);
        return {
            success: false,
            action: 'error',
            error: error.message
        };
    }
}
async function getUserSessions(userId) {
    try {
        const cache = _cachemanager.CacheManager.getInstance();
        const cacheKey = `sessions_${userId}`;
        // Intentar obtener desde cache
        const cached = await cache.get(_cachemanager.CACHE_CONFIGS.USER_SESSION, cacheKey);
        if (cached) {
            return cached;
        }
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const { data: sessions, error } = await _supabase.supabaseAdmin.from('user_sessions').select('*').eq('user_id', userId).eq('status', 'active').order('last_activity', {
            ascending: false
        });
        if (error) {
            throw new Error(`Error obteniendo sesiones: ${error.message}`);
        }
        const sessionsData = sessions || [];
        // Guardar en cache
        await cache.set(_cachemanager.CACHE_CONFIGS.USER_SESSION, cacheKey, sessionsData);
        return sessionsData;
    } catch (error) {
        console.error('[SESSION] Error obteniendo sesiones de usuario:', error);
        return [];
    }
}
async function getSessionInfo(clerkSessionId) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const { data: session, error } = await _supabase.supabaseAdmin.from('user_sessions').select('*').eq('clerk_session_id', clerkSessionId).single();
        if (error) {
            if (error.code === 'PGRST116') {
                return null; // Sesión no encontrada
            }
            throw new Error(`Error obteniendo sesión: ${error.message}`);
        }
        return session;
    } catch (error) {
        console.error('[SESSION] Error obteniendo información de sesión:', error);
        return null;
    }
}
async function isSessionValid(clerkSessionId) {
    try {
        const session = await getSessionInfo(clerkSessionId);
        if (!session || session.status !== 'active') {
            return false;
        }
        const now = new Date();
        const expiresAt = new Date(session.expires_at);
        const lastActivity = new Date(session.last_activity);
        const maxInactive = new Date(now.getTime() - SESSION_CONFIG.maxInactiveTime);
        // Verificar expiración y actividad
        if (expiresAt < now || lastActivity < maxInactive) {
            // Invalidar sesión automáticamente
            await invalidateSession(clerkSessionId, 'auto_expired');
            return false;
        }
        return true;
    } catch (error) {
        console.error('[SESSION] Error verificando validez de sesión:', error);
        return false;
    }
}
async function updateSessionActivity(clerkSessionId, metadata) {
    try {
        const updateData = {
            last_activity: new Date().toISOString()
        };
        if (metadata) {
            const session = await getSessionInfo(clerkSessionId);
            if (session) {
                updateData.metadata = {
                    ...session.metadata,
                    ...metadata
                };
            }
        }
        const result = await updateSession(clerkSessionId, updateData);
        return result.success;
    } catch (error) {
        console.error('[SESSION] Error actualizando actividad de sesión:', error);
        return false;
    }
}
async function invalidateAllUserSessions(userId, reason = 'security_action') {
    try {
        console.log(`[SESSION] Invalidando todas las sesiones del usuario ${userId}`);
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const { data: sessions, error: fetchError } = await _supabase.supabaseAdmin.from('user_sessions').select('*').eq('user_id', userId).eq('status', 'active');
        if (fetchError) {
            throw new Error(`Error obteniendo sesiones: ${fetchError.message}`);
        }
        if (!sessions || sessions.length === 0) {
            return {
                success: true,
                cleaned: 0,
                errors: 0,
                details: {
                    expired: 0,
                    orphaned: 0,
                    invalid: 0
                }
            };
        }
        let cleaned = 0;
        let errors = 0;
        for (const session of sessions){
            const result = await invalidateSession(session.clerk_session_id, reason);
            if (result.success) {
                cleaned++;
            } else {
                errors++;
            }
        }
        // Log acción administrativa
        await (0, _securityaudit.logAdminAction)(userId, 'INVALIDATE_ALL_SESSIONS', 'user_sessions', {
            userId,
            userRole: 'system',
            permissions: {},
            metadata: {
                source: 'session_management'
            }
        }, {
            reason,
            sessions_invalidated: cleaned,
            errors
        });
        return {
            success: errors === 0,
            cleaned,
            errors,
            details: {
                expired: 0,
                orphaned: 0,
                invalid: cleaned
            }
        };
    } catch (error) {
        console.error('[SESSION] Error invalidando todas las sesiones:', error);
        return {
            success: false,
            cleaned: 0,
            errors: 1,
            details: {
                expired: 0,
                orphaned: 0,
                invalid: 0
            }
        };
    }
}
async function getSessionStats() {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const { data: sessions, error } = await _supabase.supabaseAdmin.from('user_sessions').select('status, device_info');
        if (error) {
            throw new Error(`Error obteniendo estadísticas: ${error.message}`);
        }
        const stats = {
            total: sessions?.length || 0,
            active: 0,
            expired: 0,
            revoked: 0,
            invalid: 0,
            byDevice: {}
        };
        sessions?.forEach((session)=>{
            // Contar por status
            switch(session.status){
                case 'active':
                    stats.active++;
                    break;
                case 'expired':
                    stats.expired++;
                    break;
                case 'revoked':
                    stats.revoked++;
                    break;
                case 'invalid':
                    stats.invalid++;
                    break;
            }
            // Contar por dispositivo
            const deviceType = session.device_info?.type || 'unknown';
            stats.byDevice[deviceType] = (stats.byDevice[deviceType] || 0) + 1;
        });
        return stats;
    } catch (error) {
        console.error('[SESSION] Error obteniendo estadísticas:', error);
        return {
            total: 0,
            active: 0,
            expired: 0,
            revoked: 0,
            invalid: 0,
            byDevice: {}
        };
    }
}
function startSessionCleanup() {
    console.log('[SESSION] Iniciando cleanup automático de sesiones');
    return setInterval(async ()=>{
        try {
            const result = await cleanupExpiredSessions();
            if (result.cleaned > 0) {
                console.log(`[SESSION] Cleanup automático: ${result.cleaned} sesiones limpiadas`);
            }
        } catch (error) {
            console.error('[SESSION] Error en cleanup automático:', error);
        }
    }, SESSION_CONFIG.cleanupInterval);
}
function stopSessionCleanup(intervalId) {
    clearInterval(intervalId);
    console.log('[SESSION] Cleanup automático detenido');
}
async function invalidateSession(clerkSessionId, reason = 'manual_logout') {
    try {
        console.log(`[SESSION] Invalidando sesión ${clerkSessionId} - Razón: ${reason}`);
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const { data: invalidatedSession, error: updateError } = await _supabase.supabaseAdmin.from('user_sessions').update({
            status: 'revoked',
            updated_at: new Date().toISOString(),
            metadata: {
                revoked_at: new Date().toISOString(),
                revoked_reason: reason
            }
        }).eq('clerk_session_id', clerkSessionId).select('*').single();
        if (updateError) {
            if (updateError.code === 'PGRST116') {
                return {
                    success: true,
                    action: 'found_existing',
                    details: {
                        message: 'Sesión ya invalidada o no encontrada'
                    }
                };
            }
            throw new Error(`Error invalidando sesión: ${updateError.message}`);
        }
        // Log evento de seguridad
        await (0, _securityaudit.logSecurityEvent)({
            user_id: invalidatedSession.user_id,
            event_type: 'AUTH_SUCCESS',
            event_category: 'authentication',
            severity: 'low',
            description: 'Sesión invalidada',
            metadata: {
                session_id: invalidatedSession.id,
                clerk_session_id: clerkSessionId,
                reason
            }
        });
        // Invalidar cache
        const cache = _cachemanager.CacheManager.getInstance();
        await cache.delete(_cachemanager.CACHE_CONFIGS.USER_SESSION, `sessions_${invalidatedSession.user_id}`);
        return {
            success: true,
            action: 'deleted',
            sessionId: invalidatedSession.id,
            details: {
                sessionData: invalidatedSession
            }
        };
    } catch (error) {
        console.error('[SESSION] Error invalidando sesión:', error);
        return {
            success: false,
            action: 'error',
            error: error.message
        };
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhdXRoXFxzZXNzaW9uLW1hbmFnZW1lbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTaXN0ZW1hIGRlIEdlc3Rpw7NuIEF2YW56YWRhIGRlIFNlc2lvbmVzXG4gKiBNYW5lamEgc2luY3Jvbml6YWNpw7NuIGVudHJlIENsZXJrIHkgU3VwYWJhc2UsIGludmFsaWRhY2nDs24gYXV0b23DoXRpY2EgeSBjbGVhbnVwXG4gKi9cblxuaW1wb3J0IHsgY2xlcmtDbGllbnQgfSBmcm9tICdAY2xlcmsvbmV4dGpzL3NlcnZlcic7XG5pbXBvcnQgeyBzdXBhYmFzZUFkbWluIH0gZnJvbSAnQC9saWIvc3VwYWJhc2UnO1xuaW1wb3J0IHsgbG9nU2VjdXJpdHlFdmVudCwgbG9nQWRtaW5BY3Rpb24gfSBmcm9tICcuL3NlY3VyaXR5LWF1ZGl0JztcbmltcG9ydCB7IENhY2hlTWFuYWdlciwgQ0FDSEVfQ09ORklHUyB9IGZyb20gJ0AvbGliL2NhY2hlLW1hbmFnZXInO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVElQT1MgWSBJTlRFUkZBQ0VTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb25EYXRhIHtcbiAgaWQ6IHN0cmluZztcbiAgdXNlcl9pZDogc3RyaW5nO1xuICBjbGVya19zZXNzaW9uX2lkOiBzdHJpbmc7XG4gIHN0YXR1czogU2Vzc2lvblN0YXR1cztcbiAgY3JlYXRlZF9hdDogc3RyaW5nO1xuICB1cGRhdGVkX2F0OiBzdHJpbmc7XG4gIGV4cGlyZXNfYXQ6IHN0cmluZztcbiAgbGFzdF9hY3Rpdml0eTogc3RyaW5nO1xuICBpcF9hZGRyZXNzPzogc3RyaW5nO1xuICB1c2VyX2FnZW50Pzogc3RyaW5nO1xuICBkZXZpY2VfaW5mbz86IERldmljZUluZm87XG4gIG1ldGFkYXRhPzogU2Vzc2lvbk1ldGFkYXRhO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIERldmljZUluZm8ge1xuICB0eXBlOiAnZGVza3RvcCcgfCAnbW9iaWxlJyB8ICd0YWJsZXQnIHwgJ3Vua25vd24nO1xuICBvcz86IHN0cmluZztcbiAgYnJvd3Nlcj86IHN0cmluZztcbiAgdmVyc2lvbj86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uTWV0YWRhdGEge1xuICBsb2dpbl9tZXRob2Q/OiBzdHJpbmc7XG4gIGxvY2F0aW9uPzogc3RyaW5nO1xuICB0aW1lem9uZT86IHN0cmluZztcbiAgbGFuZ3VhZ2U/OiBzdHJpbmc7XG4gIGZlYXR1cmVzX3VzZWQ/OiBzdHJpbmdbXTtcbiAgbGFzdF9wYWdlPzogc3RyaW5nO1xuICBzZXNzaW9uX2R1cmF0aW9uPzogbnVtYmVyO1xufVxuXG5leHBvcnQgdHlwZSBTZXNzaW9uU3RhdHVzID0gJ2FjdGl2ZScgfCAnZXhwaXJlZCcgfCAncmV2b2tlZCcgfCAnaW52YWxpZCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2Vzc2lvblN5bmNSZXN1bHQge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICBhY3Rpb246ICdjcmVhdGVkJyB8ICd1cGRhdGVkJyB8ICdkZWxldGVkJyB8ICdmb3VuZF9leGlzdGluZycgfCAnZXJyb3InO1xuICBzZXNzaW9uSWQ/OiBzdHJpbmc7XG4gIGVycm9yPzogc3RyaW5nO1xuICBkZXRhaWxzPzogUmVjb3JkPHN0cmluZywgYW55Pjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uQ2xlYW51cFJlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGNsZWFuZWQ6IG51bWJlcjtcbiAgZXJyb3JzOiBudW1iZXI7XG4gIGRldGFpbHM6IHtcbiAgICBleHBpcmVkOiBudW1iZXI7XG4gICAgb3JwaGFuZWQ6IG51bWJlcjtcbiAgICBpbnZhbGlkOiBudW1iZXI7XG4gIH07XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDT05GSUdVUkFDScOTTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuY29uc3QgU0VTU0lPTl9DT05GSUcgPSB7XG4gIG1heFNlc3Npb25zUGVyVXNlcjogNSxcbiAgc2Vzc2lvblRpbWVvdXQ6IDI0ICogNjAgKiA2MCAqIDEwMDAsIC8vIDI0IGhvcmFzXG4gIGNsZWFudXBJbnRlcnZhbDogNjAgKiA2MCAqIDEwMDAsIC8vIDEgaG9yYVxuICBtYXhJbmFjdGl2ZVRpbWU6IDIgKiA2MCAqIDYwICogMTAwMCwgLy8gMiBob3Jhc1xuICBjYWNoZVRpbWVvdXQ6IDEwICogNjAgKiAxMDAwIC8vIDEwIG1pbnV0b3Ncbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBGVU5DSU9ORVMgREUgVVRJTElEQURcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogRXh0cmFlIGluZm9ybWFjacOzbiBkZWwgZGlzcG9zaXRpdm8gZGVzZGUgVXNlci1BZ2VudFxuICovXG5mdW5jdGlvbiBwYXJzZURldmljZUluZm8odXNlckFnZW50Pzogc3RyaW5nKTogRGV2aWNlSW5mbyB7XG4gIGlmICghdXNlckFnZW50KSB7XG4gICAgcmV0dXJuIHsgdHlwZTogJ3Vua25vd24nIH07XG4gIH1cblxuICBjb25zdCB1YSA9IHVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO1xuICBcbiAgLy8gRGV0ZWN0YXIgdGlwbyBkZSBkaXNwb3NpdGl2b1xuICBsZXQgdHlwZTogRGV2aWNlSW5mb1sndHlwZSddID0gJ2Rlc2t0b3AnO1xuICBpZiAodWEuaW5jbHVkZXMoJ21vYmlsZScpKSB0eXBlID0gJ21vYmlsZSc7XG4gIGVsc2UgaWYgKHVhLmluY2x1ZGVzKCd0YWJsZXQnKSB8fCB1YS5pbmNsdWRlcygnaXBhZCcpKSB0eXBlID0gJ3RhYmxldCc7XG5cbiAgLy8gRGV0ZWN0YXIgT1NcbiAgbGV0IG9zOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGlmICh1YS5pbmNsdWRlcygnd2luZG93cycpKSBvcyA9ICdXaW5kb3dzJztcbiAgZWxzZSBpZiAodWEuaW5jbHVkZXMoJ21hYycpKSBvcyA9ICdtYWNPUyc7XG4gIGVsc2UgaWYgKHVhLmluY2x1ZGVzKCdsaW51eCcpKSBvcyA9ICdMaW51eCc7XG4gIGVsc2UgaWYgKHVhLmluY2x1ZGVzKCdhbmRyb2lkJykpIG9zID0gJ0FuZHJvaWQnO1xuICBlbHNlIGlmICh1YS5pbmNsdWRlcygnaW9zJykgfHwgdWEuaW5jbHVkZXMoJ2lwaG9uZScpKSBvcyA9ICdpT1MnO1xuXG4gIC8vIERldGVjdGFyIGJyb3dzZXJcbiAgbGV0IGJyb3dzZXI6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgaWYgKHVhLmluY2x1ZGVzKCdjaHJvbWUnKSkgYnJvd3NlciA9ICdDaHJvbWUnO1xuICBlbHNlIGlmICh1YS5pbmNsdWRlcygnZmlyZWZveCcpKSBicm93c2VyID0gJ0ZpcmVmb3gnO1xuICBlbHNlIGlmICh1YS5pbmNsdWRlcygnc2FmYXJpJykpIGJyb3dzZXIgPSAnU2FmYXJpJztcbiAgZWxzZSBpZiAodWEuaW5jbHVkZXMoJ2VkZ2UnKSkgYnJvd3NlciA9ICdFZGdlJztcblxuICByZXR1cm4geyB0eXBlLCBvcywgYnJvd3NlciB9O1xufVxuXG4vKipcbiAqIEdlbmVyYSBJRCDDum5pY28gcGFyYSBzZXNpw7NuXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlU2Vzc2lvbklkKCk6IHN0cmluZyB7XG4gIHJldHVybiBgc2Vzc18ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XG59XG5cbi8qKlxuICogQ2FsY3VsYSBmZWNoYSBkZSBleHBpcmFjacOzblxuICovXG5mdW5jdGlvbiBjYWxjdWxhdGVFeHBpcmF0aW9uRGF0ZSgpOiBzdHJpbmcge1xuICByZXR1cm4gbmV3IERhdGUoRGF0ZS5ub3coKSArIFNFU1NJT05fQ09ORklHLnNlc3Npb25UaW1lb3V0KS50b0lTT1N0cmluZygpO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRlVOQ0lPTkVTIFBSSU5DSVBBTEVTIERFIEdFU1RJw5NOIERFIFNFU0lPTkVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIENyZWEgdW5hIG51ZXZhIHNlc2nDs24gZW4gU3VwYWJhc2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVNlc3Npb24oXG4gIHVzZXJJZDogc3RyaW5nLFxuICBjbGVya1Nlc3Npb25JZDogc3RyaW5nLFxuICByZXF1ZXN0PzogUmVxdWVzdFxuKTogUHJvbWlzZTxTZXNzaW9uU3luY1Jlc3VsdD4ge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBbU0VTU0lPTl0gQ3JlYW5kbyBzZXNpw7NuIHBhcmEgdXN1YXJpbyAke3VzZXJJZH1gKTtcblxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm8gZGlzcG9uaWJsZScpO1xuICAgIH1cblxuICAgIC8vIEV4dHJhZXIgaW5mb3JtYWNpw7NuIGRlIGxhIHJlcXVlc3RcbiAgICBjb25zdCBpcEFkZHJlc3MgPSByZXF1ZXN0Py5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtZm9yJykgfHwgXG4gICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Py5oZWFkZXJzLmdldCgneC1yZWFsLWlwJykgfHwgXG4gICAgICAgICAgICAgICAgICAgICAndW5rbm93bic7XG4gICAgY29uc3QgdXNlckFnZW50ID0gcmVxdWVzdD8uaGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKSB8fCAndW5rbm93bic7XG4gICAgY29uc3QgZGV2aWNlSW5mbyA9IHBhcnNlRGV2aWNlSW5mbyh1c2VyQWdlbnQpO1xuXG4gICAgLy8gVmVyaWZpY2FyIGzDrW1pdGUgZGUgc2VzaW9uZXMgcG9yIHVzdWFyaW9cbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nU2Vzc2lvbnMsIGVycm9yOiBjb3VudEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgndXNlcl9zZXNzaW9ucycpXG4gICAgICAuc2VsZWN0KCdpZCcpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKTtcblxuICAgIGlmIChjb3VudEVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIHZlcmlmaWNhbmRvIHNlc2lvbmVzIGV4aXN0ZW50ZXM6ICR7Y291bnRFcnJvci5tZXNzYWdlfWApO1xuICAgIH1cblxuICAgIC8vIFNpIGhheSBkZW1hc2lhZGFzIHNlc2lvbmVzLCBlbGltaW5hciBsYXMgbcOhcyBhbnRpZ3Vhc1xuICAgIGlmIChleGlzdGluZ1Nlc3Npb25zICYmIGV4aXN0aW5nU2Vzc2lvbnMubGVuZ3RoID49IFNFU1NJT05fQ09ORklHLm1heFNlc3Npb25zUGVyVXNlcikge1xuICAgICAgY29uc29sZS5sb2coYFtTRVNTSU9OXSBVc3VhcmlvICR7dXNlcklkfSB0aWVuZSAke2V4aXN0aW5nU2Vzc2lvbnMubGVuZ3RofSBzZXNpb25lcywgbGltcGlhbmRvLi4uYCk7XG4gICAgICBhd2FpdCBjbGVhbnVwT2xkU2Vzc2lvbnModXNlcklkLCBTRVNTSU9OX0NPTkZJRy5tYXhTZXNzaW9uc1BlclVzZXIgLSAxKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhciBudWV2YSBzZXNpw7NuXG4gICAgY29uc3Qgc2Vzc2lvbkRhdGE6IE9taXQ8U2Vzc2lvbkRhdGEsICdpZCc+ID0ge1xuICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgY2xlcmtfc2Vzc2lvbl9pZDogY2xlcmtTZXNzaW9uSWQsXG4gICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgZXhwaXJlc19hdDogY2FsY3VsYXRlRXhwaXJhdGlvbkRhdGUoKSxcbiAgICAgIGxhc3RfYWN0aXZpdHk6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIGlwX2FkZHJlc3M6IGlwQWRkcmVzcyxcbiAgICAgIHVzZXJfYWdlbnQ6IHVzZXJBZ2VudCxcbiAgICAgIGRldmljZV9pbmZvOiBkZXZpY2VJbmZvLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgbG9naW5fbWV0aG9kOiAnY2xlcmsnLFxuICAgICAgICB0aW1lem9uZTogSW50bC5EYXRlVGltZUZvcm1hdCgpLnJlc29sdmVkT3B0aW9ucygpLnRpbWVab25lLFxuICAgICAgICBzZXNzaW9uX2R1cmF0aW9uOiAwXG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IHsgZGF0YTogbmV3U2Vzc2lvbiwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgndXNlcl9zZXNzaW9ucycpXG4gICAgICAuaW5zZXJ0KHNlc3Npb25EYXRhKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgY3JlYW5kbyBzZXNpw7NuOiAke2luc2VydEVycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuXG4gICAgLy8gTG9nIGV2ZW50byBkZSBzZWd1cmlkYWRcbiAgICBhd2FpdCBsb2dTZWN1cml0eUV2ZW50KHtcbiAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgIGV2ZW50X3R5cGU6ICdBVVRIX1NVQ0NFU1MnLFxuICAgICAgZXZlbnRfY2F0ZWdvcnk6ICdhdXRoZW50aWNhdGlvbicsXG4gICAgICBzZXZlcml0eTogJ2xvdycsXG4gICAgICBkZXNjcmlwdGlvbjogJ051ZXZhIHNlc2nDs24gY3JlYWRhJyxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIHNlc3Npb25faWQ6IG5ld1Nlc3Npb24uaWQsXG4gICAgICAgIGNsZXJrX3Nlc3Npb25faWQ6IGNsZXJrU2Vzc2lvbklkLFxuICAgICAgICBkZXZpY2VfaW5mbzogZGV2aWNlSW5mbyxcbiAgICAgICAgaXBfYWRkcmVzczogaXBBZGRyZXNzXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBJbnZhbGlkYXIgY2FjaGUgZGUgc2VzaW9uZXMgZGVsIHVzdWFyaW9cbiAgICBjb25zdCBjYWNoZSA9IENhY2hlTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgIGF3YWl0IGNhY2hlLmRlbGV0ZShDQUNIRV9DT05GSUdTLlVTRVJfU0VTU0lPTiwgYHNlc3Npb25zXyR7dXNlcklkfWApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBhY3Rpb246ICdjcmVhdGVkJyxcbiAgICAgIHNlc3Npb25JZDogbmV3U2Vzc2lvbi5pZCxcbiAgICAgIGRldGFpbHM6IHsgc2Vzc2lvbkRhdGE6IG5ld1Nlc3Npb24gfVxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1NFU1NJT05dIEVycm9yIGNyZWFuZG8gc2VzacOzbjonLCBlcnJvcik7XG4gICAgXG4gICAgYXdhaXQgbG9nU2VjdXJpdHlFdmVudCh7XG4gICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICBldmVudF90eXBlOiAnU0VDVVJJVFlfVklPTEFUSU9OJyxcbiAgICAgIGV2ZW50X2NhdGVnb3J5OiAnYXV0aGVudGljYXRpb24nLFxuICAgICAgc2V2ZXJpdHk6ICdtZWRpdW0nLFxuICAgICAgZGVzY3JpcHRpb246ICdFcnJvciBjcmVhbmRvIHNlc2nDs24nLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIGNsZXJrX3Nlc3Npb25faWQ6IGNsZXJrU2Vzc2lvbklkXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBhY3Rpb246ICdlcnJvcicsXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBBY3R1YWxpemEgdW5hIHNlc2nDs24gZXhpc3RlbnRlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVTZXNzaW9uKFxuICBjbGVya1Nlc3Npb25JZDogc3RyaW5nLFxuICB1cGRhdGVzOiBQYXJ0aWFsPFNlc3Npb25EYXRhPlxuKTogUHJvbWlzZTxTZXNzaW9uU3luY1Jlc3VsdD4ge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBbU0VTU0lPTl0gQWN0dWFsaXphbmRvIHNlc2nDs24gJHtjbGVya1Nlc3Npb25JZH1gKTtcblxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm8gZGlzcG9uaWJsZScpO1xuICAgIH1cblxuICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7XG4gICAgICAuLi51cGRhdGVzLFxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgbGFzdF9hY3Rpdml0eTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfTtcblxuICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFNlc3Npb24sIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oJ3VzZXJfc2Vzc2lvbnMnKVxuICAgICAgLnVwZGF0ZSh1cGRhdGVEYXRhKVxuICAgICAgLmVxKCdjbGVya19zZXNzaW9uX2lkJywgY2xlcmtTZXNzaW9uSWQpXG4gICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAodXBkYXRlRXJyb3IpIHtcbiAgICAgIGlmICh1cGRhdGVFcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgYWN0aW9uOiAnZXJyb3InLFxuICAgICAgICAgIGVycm9yOiAnU2VzacOzbiBubyBlbmNvbnRyYWRhIG8gaW5hY3RpdmEnXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGFjdHVhbGl6YW5kbyBzZXNpw7NuOiAke3VwZGF0ZUVycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuXG4gICAgLy8gSW52YWxpZGFyIGNhY2hlXG4gICAgY29uc3QgY2FjaGUgPSBDYWNoZU1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICBhd2FpdCBjYWNoZS5kZWxldGUoQ0FDSEVfQ09ORklHUy5VU0VSX1NFU1NJT04sIGBzZXNzaW9uc18ke3VwZGF0ZWRTZXNzaW9uLnVzZXJfaWR9YCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGFjdGlvbjogJ3VwZGF0ZWQnLFxuICAgICAgc2Vzc2lvbklkOiB1cGRhdGVkU2Vzc2lvbi5pZCxcbiAgICAgIGRldGFpbHM6IHsgc2Vzc2lvbkRhdGE6IHVwZGF0ZWRTZXNzaW9uIH1cbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTRVNTSU9OXSBFcnJvciBhY3R1YWxpemFuZG8gc2VzacOzbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgYWN0aW9uOiAnZXJyb3InLFxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogTGltcGlhIHNlc2lvbmVzIGFudGlndWFzIGRlIHVuIHVzdWFyaW9cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBPbGRTZXNzaW9ucyhcbiAgdXNlcklkOiBzdHJpbmcsXG4gIGtlZXBDb3VudDogbnVtYmVyID0gU0VTU0lPTl9DT05GSUcubWF4U2Vzc2lvbnNQZXJVc2VyIC0gMVxuKTogUHJvbWlzZTxTZXNzaW9uQ2xlYW51cFJlc3VsdD4ge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBbU0VTU0lPTl0gTGltcGlhbmRvIHNlc2lvbmVzIGFudGlndWFzIHBhcmEgdXN1YXJpbyAke3VzZXJJZH1gKTtcblxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm8gZGlzcG9uaWJsZScpO1xuICAgIH1cblxuICAgIC8vIE9idGVuZXIgc2VzaW9uZXMgYWN0aXZhcyBvcmRlbmFkYXMgcG9yIMO6bHRpbWEgYWN0aXZpZGFkXG4gICAgY29uc3QgeyBkYXRhOiBzZXNzaW9ucywgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKCd1c2VyX3Nlc3Npb25zJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgLmVxKCdzdGF0dXMnLCAnYWN0aXZlJylcbiAgICAgIC5vcmRlcignbGFzdF9hY3Rpdml0eScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcblxuICAgIGlmIChmZXRjaEVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIG9idGVuaWVuZG8gc2VzaW9uZXM6ICR7ZmV0Y2hFcnJvci5tZXNzYWdlfWApO1xuICAgIH1cblxuICAgIGlmICghc2Vzc2lvbnMgfHwgc2Vzc2lvbnMubGVuZ3RoIDw9IGtlZXBDb3VudCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgY2xlYW5lZDogMCxcbiAgICAgICAgZXJyb3JzOiAwLFxuICAgICAgICBkZXRhaWxzOiB7IGV4cGlyZWQ6IDAsIG9ycGhhbmVkOiAwLCBpbnZhbGlkOiAwIH1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gU2VzaW9uZXMgYSBlbGltaW5hciAobGFzIG3DoXMgYW50aWd1YXMpXG4gICAgY29uc3Qgc2Vzc2lvbnNUb1JlbW92ZSA9IHNlc3Npb25zLnNsaWNlKGtlZXBDb3VudCk7XG4gICAgbGV0IGNsZWFuZWQgPSAwO1xuICAgIGxldCBlcnJvcnMgPSAwO1xuXG4gICAgZm9yIChjb25zdCBzZXNzaW9uIG9mIHNlc3Npb25zVG9SZW1vdmUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgZXJyb3I6IGRlbGV0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAgICAgLmZyb20oJ3VzZXJfc2Vzc2lvbnMnKVxuICAgICAgICAgIC51cGRhdGUoe1xuICAgICAgICAgICAgc3RhdHVzOiAnZXhwaXJlZCcsXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICAuLi5zZXNzaW9uLm1ldGFkYXRhLFxuICAgICAgICAgICAgICBleHBpcmVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgIGV4cGlyZWRfcmVhc29uOiAnbWF4X3Nlc3Npb25zX2V4Y2VlZGVkJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmVxKCdpZCcsIHNlc3Npb24uaWQpO1xuXG4gICAgICAgIGlmIChkZWxldGVFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFtTRVNTSU9OXSBFcnJvciBlbGltaW5hbmRvIHNlc2nDs24gJHtzZXNzaW9uLmlkfTpgLCBkZWxldGVFcnJvcik7XG4gICAgICAgICAgZXJyb3JzKys7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2xlYW5lZCsrO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBbU0VTU0lPTl0gRXJyb3IgcHJvY2VzYW5kbyBzZXNpw7NuICR7c2Vzc2lvbi5pZH06YCwgZXJyb3IpO1xuICAgICAgICBlcnJvcnMrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBJbnZhbGlkYXIgY2FjaGVcbiAgICBjb25zdCBjYWNoZSA9IENhY2hlTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuICAgIGF3YWl0IGNhY2hlLmRlbGV0ZShDQUNIRV9DT05GSUdTLlVTRVJfU0VTU0lPTiwgYHNlc3Npb25zXyR7dXNlcklkfWApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGVycm9ycyA9PT0gMCxcbiAgICAgIGNsZWFuZWQsXG4gICAgICBlcnJvcnMsXG4gICAgICBkZXRhaWxzOiB7IGV4cGlyZWQ6IGNsZWFuZWQsIG9ycGhhbmVkOiAwLCBpbnZhbGlkOiAwIH1cbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTRVNTSU9OXSBFcnJvciBlbiBjbGVhbnVwIGRlIHNlc2lvbmVzOicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBjbGVhbmVkOiAwLFxuICAgICAgZXJyb3JzOiAxLFxuICAgICAgZGV0YWlsczogeyBleHBpcmVkOiAwLCBvcnBoYW5lZDogMCwgaW52YWxpZDogMCB9XG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIENsZWFudXAgZ2xvYmFsIGRlIHNlc2lvbmVzIGV4cGlyYWRhc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW51cEV4cGlyZWRTZXNzaW9ucygpOiBQcm9taXNlPFNlc3Npb25DbGVhbnVwUmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ1tTRVNTSU9OXSBJbmljaWFuZG8gY2xlYW51cCBnbG9iYWwgZGUgc2VzaW9uZXMgZXhwaXJhZGFzJyk7XG5cbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU3VwYWJhc2UgYWRtaW4gY2xpZW50IG5vIGRpc3BvbmlibGUnKTtcbiAgICB9XG5cbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgY29uc3QgaW5hY3RpdmVUaHJlc2hvbGQgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gU0VTU0lPTl9DT05GSUcubWF4SW5hY3RpdmVUaW1lKS50b0lTT1N0cmluZygpO1xuXG4gICAgLy8gQnVzY2FyIHNlc2lvbmVzIGV4cGlyYWRhcyBvIGluYWN0aXZhc1xuICAgIGNvbnN0IHsgZGF0YTogZXhwaXJlZFNlc3Npb25zLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oJ3VzZXJfc2Vzc2lvbnMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKVxuICAgICAgLm9yKGBleHBpcmVzX2F0Lmx0LiR7bm93fSxsYXN0X2FjdGl2aXR5Lmx0LiR7aW5hY3RpdmVUaHJlc2hvbGR9YCk7XG5cbiAgICBpZiAoZmV0Y2hFcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBvYnRlbmllbmRvIHNlc2lvbmVzIGV4cGlyYWRhczogJHtmZXRjaEVycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuXG4gICAgaWYgKCFleHBpcmVkU2Vzc2lvbnMgfHwgZXhwaXJlZFNlc3Npb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgY2xlYW5lZDogMCxcbiAgICAgICAgZXJyb3JzOiAwLFxuICAgICAgICBkZXRhaWxzOiB7IGV4cGlyZWQ6IDAsIG9ycGhhbmVkOiAwLCBpbnZhbGlkOiAwIH1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYFtTRVNTSU9OXSBFbmNvbnRyYWRhcyAke2V4cGlyZWRTZXNzaW9ucy5sZW5ndGh9IHNlc2lvbmVzIHBhcmEgbGltcGlhcmApO1xuXG4gICAgbGV0IGV4cGlyZWQgPSAwO1xuICAgIGxldCBvcnBoYW5lZCA9IDA7XG4gICAgbGV0IGludmFsaWQgPSAwO1xuICAgIGxldCBlcnJvcnMgPSAwO1xuXG4gICAgZm9yIChjb25zdCBzZXNzaW9uIG9mIGV4cGlyZWRTZXNzaW9ucykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVmVyaWZpY2FyIHNpIGxhIHNlc2nDs24gZXhpc3RlIGVuIENsZXJrXG4gICAgICAgIGxldCBpc09ycGhhbmVkID0gZmFsc2U7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgY2xlcmtDbGllbnQoKTtcbiAgICAgICAgICBhd2FpdCBjbGllbnQuc2Vzc2lvbnMuZ2V0U2Vzc2lvbihzZXNzaW9uLmNsZXJrX3Nlc3Npb25faWQpO1xuICAgICAgICB9IGNhdGNoIChjbGVya0Vycm9yKSB7XG4gICAgICAgICAgLy8gU2VzacOzbiBubyBleGlzdGUgZW4gQ2xlcmssIGVzIGh1w6lyZmFuYVxuICAgICAgICAgIGlzT3JwaGFuZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVhc29uID0gaXNPcnBoYW5lZCA/ICdvcnBoYW5lZCcgOlxuICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb24uZXhwaXJlc19hdCA8IG5vdyA/ICdleHBpcmVkJyA6ICdpbmFjdGl2ZSc7XG5cbiAgICAgICAgY29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgICAuZnJvbSgndXNlcl9zZXNzaW9ucycpXG4gICAgICAgICAgLnVwZGF0ZSh7XG4gICAgICAgICAgICBzdGF0dXM6IHJlYXNvbiA9PT0gJ29ycGhhbmVkJyA/ICdpbnZhbGlkJyA6ICdleHBpcmVkJyxcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICAgIC4uLnNlc3Npb24ubWV0YWRhdGEsXG4gICAgICAgICAgICAgIGNsZWFudXBfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgY2xlYW51cF9yZWFzb246IHJlYXNvblxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmVxKCdpZCcsIHNlc3Npb24uaWQpO1xuXG4gICAgICAgIGlmICh1cGRhdGVFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFtTRVNTSU9OXSBFcnJvciBhY3R1YWxpemFuZG8gc2VzacOzbiAke3Nlc3Npb24uaWR9OmAsIHVwZGF0ZUVycm9yKTtcbiAgICAgICAgICBlcnJvcnMrKztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAocmVhc29uID09PSAnb3JwaGFuZWQnKSBvcnBoYW5lZCsrO1xuICAgICAgICAgIGVsc2UgaWYgKHJlYXNvbiA9PT0gJ2V4cGlyZWQnKSBleHBpcmVkKys7XG4gICAgICAgICAgZWxzZSBpbnZhbGlkKys7XG5cbiAgICAgICAgICAvLyBMb2cgZXZlbnRvIGRlIGxpbXBpZXphXG4gICAgICAgICAgYXdhaXQgbG9nU2VjdXJpdHlFdmVudCh7XG4gICAgICAgICAgICB1c2VyX2lkOiBzZXNzaW9uLnVzZXJfaWQsXG4gICAgICAgICAgICBldmVudF90eXBlOiAnQURNSU5fQUNUSU9OJyxcbiAgICAgICAgICAgIGV2ZW50X2NhdGVnb3J5OiAnYWRtaW5fb3BlcmF0aW9ucycsXG4gICAgICAgICAgICBzZXZlcml0eTogJ2xvdycsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYFNlc2nDs24gbGltcGlhZGE6ICR7cmVhc29ufWAsXG4gICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICBzZXNzaW9uX2lkOiBzZXNzaW9uLmlkLFxuICAgICAgICAgICAgICBjbGVya19zZXNzaW9uX2lkOiBzZXNzaW9uLmNsZXJrX3Nlc3Npb25faWQsXG4gICAgICAgICAgICAgIGNsZWFudXBfcmVhc29uOiByZWFzb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgW1NFU1NJT05dIEVycm9yIHByb2Nlc2FuZG8gc2VzacOzbiAke3Nlc3Npb24uaWR9OmAsIGVycm9yKTtcbiAgICAgICAgZXJyb3JzKys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYFtTRVNTSU9OXSBDbGVhbnVwIGNvbXBsZXRhZG86ICR7ZXhwaXJlZCArIG9ycGhhbmVkICsgaW52YWxpZH0gc2VzaW9uZXMgbGltcGlhZGFzLCAke2Vycm9yc30gZXJyb3Jlc2ApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGVycm9ycyA9PT0gMCxcbiAgICAgIGNsZWFuZWQ6IGV4cGlyZWQgKyBvcnBoYW5lZCArIGludmFsaWQsXG4gICAgICBlcnJvcnMsXG4gICAgICBkZXRhaWxzOiB7IGV4cGlyZWQsIG9ycGhhbmVkLCBpbnZhbGlkIH1cbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTRVNTSU9OXSBFcnJvciBlbiBjbGVhbnVwIGdsb2JhbDonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgY2xlYW5lZDogMCxcbiAgICAgIGVycm9yczogMSxcbiAgICAgIGRldGFpbHM6IHsgZXhwaXJlZDogMCwgb3JwaGFuZWQ6IDAsIGludmFsaWQ6IDAgfVxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBTaW5jcm9uaXphIHNlc2lvbmVzIGVudHJlIENsZXJrIHkgU3VwYWJhc2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN5bmNTZXNzaW9uc1dpdGhDbGVyayh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8U2Vzc2lvblN5bmNSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhgW1NFU1NJT05dIFNpbmNyb25pemFuZG8gc2VzaW9uZXMgZGUgQ2xlcmsgcGFyYSB1c3VhcmlvICR7dXNlcklkfWApO1xuXG4gICAgY29uc3QgY2xpZW50ID0gYXdhaXQgY2xlcmtDbGllbnQoKTtcbiAgICBjb25zdCBjbGVya1Nlc3Npb25zID0gYXdhaXQgY2xpZW50LnVzZXJzLmdldFVzZXJMaXN0KHtcbiAgICAgIHVzZXJJZDogW3VzZXJJZF1cbiAgICB9KTtcblxuICAgIGlmICghY2xlcmtTZXNzaW9ucyB8fCBjbGVya1Nlc3Npb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGFjdGlvbjogJ2Vycm9yJyxcbiAgICAgICAgZXJyb3I6ICdVc3VhcmlvIG5vIGVuY29udHJhZG8gZW4gQ2xlcmsnXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXIgPSBjbGVya1Nlc3Npb25zWzBdO1xuICAgIGNvbnN0IGFjdGl2ZVNlc3Npb25zID0gdXNlci5zZXNzaW9ucz8uZmlsdGVyKHMgPT4gcy5zdGF0dXMgPT09ICdhY3RpdmUnKSB8fCBbXTtcblxuICAgIC8vIE9idGVuZXIgc2VzaW9uZXMgZGUgU3VwYWJhc2VcbiAgICBjb25zdCB7IGRhdGE6IHN1cGFiYXNlU2Vzc2lvbnMsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgndXNlcl9zZXNzaW9ucycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgIC5lcSgnc3RhdHVzJywgJ2FjdGl2ZScpO1xuXG4gICAgaWYgKGZldGNoRXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3Igb2J0ZW5pZW5kbyBzZXNpb25lcyBkZSBTdXBhYmFzZTogJHtmZXRjaEVycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuXG4gICAgY29uc3Qgc3VwYWJhc2VTZXNzaW9uSWRzID0gbmV3IFNldChcbiAgICAgIHN1cGFiYXNlU2Vzc2lvbnM/Lm1hcChzID0+IHMuY2xlcmtfc2Vzc2lvbl9pZCkgfHwgW11cbiAgICApO1xuICAgIGNvbnN0IGNsZXJrU2Vzc2lvbklkcyA9IG5ldyBTZXQoYWN0aXZlU2Vzc2lvbnMubWFwKHMgPT4gcy5pZCkpO1xuXG4gICAgLy8gSW52YWxpZGFyIHNlc2lvbmVzIHF1ZSBubyBleGlzdGVuIGVuIENsZXJrXG4gICAgY29uc3Qgb3JwaGFuZWRTZXNzaW9ucyA9IHN1cGFiYXNlU2Vzc2lvbnM/LmZpbHRlcihcbiAgICAgIHMgPT4gIWNsZXJrU2Vzc2lvbklkcy5oYXMocy5jbGVya19zZXNzaW9uX2lkKVxuICAgICkgfHwgW107XG5cbiAgICBmb3IgKGNvbnN0IHNlc3Npb24gb2Ygb3JwaGFuZWRTZXNzaW9ucykge1xuICAgICAgYXdhaXQgaW52YWxpZGF0ZVNlc3Npb24oc2Vzc2lvbi5jbGVya19zZXNzaW9uX2lkLCAnY2xlcmtfc3luY19vcnBoYW5lZCcpO1xuICAgIH1cblxuICAgIC8vIENyZWFyIHNlc2lvbmVzIHF1ZSBleGlzdGVuIGVuIENsZXJrIHBlcm8gbm8gZW4gU3VwYWJhc2VcbiAgICBjb25zdCBtaXNzaW5nU2Vzc2lvbnMgPSBhY3RpdmVTZXNzaW9ucy5maWx0ZXIoXG4gICAgICBzID0+ICFzdXBhYmFzZVNlc3Npb25JZHMuaGFzKHMuaWQpXG4gICAgKTtcblxuICAgIGZvciAoY29uc3Qgc2Vzc2lvbiBvZiBtaXNzaW5nU2Vzc2lvbnMpIHtcbiAgICAgIGF3YWl0IGNyZWF0ZVNlc3Npb24odXNlcklkLCBzZXNzaW9uLmlkKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGFjdGlvbjogJ3VwZGF0ZWQnLFxuICAgICAgZGV0YWlsczoge1xuICAgICAgICBvcnBoYW5lZF9jbGVhbmVkOiBvcnBoYW5lZFNlc3Npb25zLmxlbmd0aCxcbiAgICAgICAgbWlzc2luZ19jcmVhdGVkOiBtaXNzaW5nU2Vzc2lvbnMubGVuZ3RoLFxuICAgICAgICB0b3RhbF9hY3RpdmU6IGFjdGl2ZVNlc3Npb25zLmxlbmd0aFxuICAgICAgfVxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1NFU1NJT05dIEVycm9yIHNpbmNyb25pemFuZG8gY29uIENsZXJrOicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBhY3Rpb246ICdlcnJvcicsXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgIH07XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZVTkNJT05FUyBERSBDT05TVUxUQSBZIFVUSUxJREFERVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogT2J0aWVuZSBzZXNpb25lcyBhY3RpdmFzIGRlIHVuIHVzdWFyaW9cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJTZXNzaW9ucyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8U2Vzc2lvbkRhdGFbXT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNhY2hlID0gQ2FjaGVNYW5hZ2VyLmdldEluc3RhbmNlKCk7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgc2Vzc2lvbnNfJHt1c2VySWR9YDtcblxuICAgIC8vIEludGVudGFyIG9idGVuZXIgZGVzZGUgY2FjaGVcbiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCBjYWNoZS5nZXQoQ0FDSEVfQ09ORklHUy5VU0VSX1NFU1NJT04sIGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkIGFzIFNlc3Npb25EYXRhW107XG4gICAgfVxuXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGFkbWluIGNsaWVudCBubyBkaXNwb25pYmxlJyk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBkYXRhOiBzZXNzaW9ucywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKCd1c2VyX3Nlc3Npb25zJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgICAgLmVxKCdzdGF0dXMnLCAnYWN0aXZlJylcbiAgICAgIC5vcmRlcignbGFzdF9hY3Rpdml0eScsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBvYnRlbmllbmRvIHNlc2lvbmVzOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuXG4gICAgY29uc3Qgc2Vzc2lvbnNEYXRhID0gc2Vzc2lvbnMgfHwgW107XG5cbiAgICAvLyBHdWFyZGFyIGVuIGNhY2hlXG4gICAgYXdhaXQgY2FjaGUuc2V0KENBQ0hFX0NPTkZJR1MuVVNFUl9TRVNTSU9OLCBjYWNoZUtleSwgc2Vzc2lvbnNEYXRhKTtcblxuICAgIHJldHVybiBzZXNzaW9uc0RhdGE7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1NFU1NJT05dIEVycm9yIG9idGVuaWVuZG8gc2VzaW9uZXMgZGUgdXN1YXJpbzonLCBlcnJvcik7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbi8qKlxuICogT2J0aWVuZSBpbmZvcm1hY2nDs24gZGUgdW5hIHNlc2nDs24gZXNwZWPDrWZpY2FcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlc3Npb25JbmZvKGNsZXJrU2Vzc2lvbklkOiBzdHJpbmcpOiBQcm9taXNlPFNlc3Npb25EYXRhIHwgbnVsbD4ge1xuICB0cnkge1xuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm8gZGlzcG9uaWJsZScpO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YTogc2Vzc2lvbiwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKCd1c2VyX3Nlc3Npb25zJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCdjbGVya19zZXNzaW9uX2lkJywgY2xlcmtTZXNzaW9uSWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XG4gICAgICAgIHJldHVybiBudWxsOyAvLyBTZXNpw7NuIG5vIGVuY29udHJhZGFcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3Igb2J0ZW5pZW5kbyBzZXNpw7NuOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlc3Npb247XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1NFU1NJT05dIEVycm9yIG9idGVuaWVuZG8gaW5mb3JtYWNpw7NuIGRlIHNlc2nDs246JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8qKlxuICogVmVyaWZpY2Egc2kgdW5hIHNlc2nDs24gZXMgdsOhbGlkYVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaXNTZXNzaW9uVmFsaWQoY2xlcmtTZXNzaW9uSWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uSW5mbyhjbGVya1Nlc3Npb25JZCk7XG5cbiAgICBpZiAoIXNlc3Npb24gfHwgc2Vzc2lvbi5zdGF0dXMgIT09ICdhY3RpdmUnKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZShzZXNzaW9uLmV4cGlyZXNfYXQpO1xuICAgIGNvbnN0IGxhc3RBY3Rpdml0eSA9IG5ldyBEYXRlKHNlc3Npb24ubGFzdF9hY3Rpdml0eSk7XG4gICAgY29uc3QgbWF4SW5hY3RpdmUgPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gU0VTU0lPTl9DT05GSUcubWF4SW5hY3RpdmVUaW1lKTtcblxuICAgIC8vIFZlcmlmaWNhciBleHBpcmFjacOzbiB5IGFjdGl2aWRhZFxuICAgIGlmIChleHBpcmVzQXQgPCBub3cgfHwgbGFzdEFjdGl2aXR5IDwgbWF4SW5hY3RpdmUpIHtcbiAgICAgIC8vIEludmFsaWRhciBzZXNpw7NuIGF1dG9tw6F0aWNhbWVudGVcbiAgICAgIGF3YWl0IGludmFsaWRhdGVTZXNzaW9uKGNsZXJrU2Vzc2lvbklkLCAnYXV0b19leHBpcmVkJyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1NFU1NJT05dIEVycm9yIHZlcmlmaWNhbmRvIHZhbGlkZXogZGUgc2VzacOzbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogQWN0dWFsaXphIGxhIMO6bHRpbWEgYWN0aXZpZGFkIGRlIHVuYSBzZXNpw7NuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVTZXNzaW9uQWN0aXZpdHkoXG4gIGNsZXJrU2Vzc2lvbklkOiBzdHJpbmcsXG4gIG1ldGFkYXRhPzogUGFydGlhbDxTZXNzaW9uTWV0YWRhdGE+XG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1cGRhdGVEYXRhOiBQYXJ0aWFsPFNlc3Npb25EYXRhPiA9IHtcbiAgICAgIGxhc3RfYWN0aXZpdHk6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH07XG5cbiAgICBpZiAobWV0YWRhdGEpIHtcbiAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uSW5mbyhjbGVya1Nlc3Npb25JZCk7XG4gICAgICBpZiAoc2Vzc2lvbikge1xuICAgICAgICB1cGRhdGVEYXRhLm1ldGFkYXRhID0ge1xuICAgICAgICAgIC4uLnNlc3Npb24ubWV0YWRhdGEsXG4gICAgICAgICAgLi4ubWV0YWRhdGFcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGRhdGVTZXNzaW9uKGNsZXJrU2Vzc2lvbklkLCB1cGRhdGVEYXRhKTtcbiAgICByZXR1cm4gcmVzdWx0LnN1Y2Nlc3M7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1NFU1NJT05dIEVycm9yIGFjdHVhbGl6YW5kbyBhY3RpdmlkYWQgZGUgc2VzacOzbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogSW52YWxpZGEgdG9kYXMgbGFzIHNlc2lvbmVzIGRlIHVuIHVzdWFyaW9cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGludmFsaWRhdGVBbGxVc2VyU2Vzc2lvbnMoXG4gIHVzZXJJZDogc3RyaW5nLFxuICByZWFzb246IHN0cmluZyA9ICdzZWN1cml0eV9hY3Rpb24nXG4pOiBQcm9taXNlPFNlc3Npb25DbGVhbnVwUmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYFtTRVNTSU9OXSBJbnZhbGlkYW5kbyB0b2RhcyBsYXMgc2VzaW9uZXMgZGVsIHVzdWFyaW8gJHt1c2VySWR9YCk7XG5cbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU3VwYWJhc2UgYWRtaW4gY2xpZW50IG5vIGRpc3BvbmlibGUnKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IHNlc3Npb25zLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oJ3VzZXJfc2Vzc2lvbnMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKTtcblxuICAgIGlmIChmZXRjaEVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIG9idGVuaWVuZG8gc2VzaW9uZXM6ICR7ZmV0Y2hFcnJvci5tZXNzYWdlfWApO1xuICAgIH1cblxuICAgIGlmICghc2Vzc2lvbnMgfHwgc2Vzc2lvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBjbGVhbmVkOiAwLFxuICAgICAgICBlcnJvcnM6IDAsXG4gICAgICAgIGRldGFpbHM6IHsgZXhwaXJlZDogMCwgb3JwaGFuZWQ6IDAsIGludmFsaWQ6IDAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBsZXQgY2xlYW5lZCA9IDA7XG4gICAgbGV0IGVycm9ycyA9IDA7XG5cbiAgICBmb3IgKGNvbnN0IHNlc3Npb24gb2Ygc2Vzc2lvbnMpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGludmFsaWRhdGVTZXNzaW9uKHNlc3Npb24uY2xlcmtfc2Vzc2lvbl9pZCwgcmVhc29uKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBjbGVhbmVkKys7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlcnJvcnMrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBMb2cgYWNjacOzbiBhZG1pbmlzdHJhdGl2YVxuICAgIGF3YWl0IGxvZ0FkbWluQWN0aW9uKFxuICAgICAgdXNlcklkLFxuICAgICAgJ0lOVkFMSURBVEVfQUxMX1NFU1NJT05TJyxcbiAgICAgICd1c2VyX3Nlc3Npb25zJyxcbiAgICAgIHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICB1c2VyUm9sZTogJ3N5c3RlbScsXG4gICAgICAgIHBlcm1pc3Npb25zOiB7fSxcbiAgICAgICAgbWV0YWRhdGE6IHsgc291cmNlOiAnc2Vzc2lvbl9tYW5hZ2VtZW50JyB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICByZWFzb24sXG4gICAgICAgIHNlc3Npb25zX2ludmFsaWRhdGVkOiBjbGVhbmVkLFxuICAgICAgICBlcnJvcnNcbiAgICAgIH1cbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGVycm9ycyA9PT0gMCxcbiAgICAgIGNsZWFuZWQsXG4gICAgICBlcnJvcnMsXG4gICAgICBkZXRhaWxzOiB7IGV4cGlyZWQ6IDAsIG9ycGhhbmVkOiAwLCBpbnZhbGlkOiBjbGVhbmVkIH1cbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTRVNTSU9OXSBFcnJvciBpbnZhbGlkYW5kbyB0b2RhcyBsYXMgc2VzaW9uZXM6JywgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGNsZWFuZWQ6IDAsXG4gICAgICBlcnJvcnM6IDEsXG4gICAgICBkZXRhaWxzOiB7IGV4cGlyZWQ6IDAsIG9ycGhhbmVkOiAwLCBpbnZhbGlkOiAwIH1cbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogT2J0aWVuZSBlc3RhZMOtc3RpY2FzIGRlIHNlc2lvbmVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZXNzaW9uU3RhdHMoKTogUHJvbWlzZTx7XG4gIHRvdGFsOiBudW1iZXI7XG4gIGFjdGl2ZTogbnVtYmVyO1xuICBleHBpcmVkOiBudW1iZXI7XG4gIHJldm9rZWQ6IG51bWJlcjtcbiAgaW52YWxpZDogbnVtYmVyO1xuICBieURldmljZTogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbn0+IHtcbiAgdHJ5IHtcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU3VwYWJhc2UgYWRtaW4gY2xpZW50IG5vIGRpc3BvbmlibGUnKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IHNlc3Npb25zLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oJ3VzZXJfc2Vzc2lvbnMnKVxuICAgICAgLnNlbGVjdCgnc3RhdHVzLCBkZXZpY2VfaW5mbycpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIG9idGVuaWVuZG8gZXN0YWTDrXN0aWNhczogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXRzID0ge1xuICAgICAgdG90YWw6IHNlc3Npb25zPy5sZW5ndGggfHwgMCxcbiAgICAgIGFjdGl2ZTogMCxcbiAgICAgIGV4cGlyZWQ6IDAsXG4gICAgICByZXZva2VkOiAwLFxuICAgICAgaW52YWxpZDogMCxcbiAgICAgIGJ5RGV2aWNlOiB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+XG4gICAgfTtcblxuICAgIHNlc3Npb25zPy5mb3JFYWNoKHNlc3Npb24gPT4ge1xuICAgICAgLy8gQ29udGFyIHBvciBzdGF0dXNcbiAgICAgIHN3aXRjaCAoc2Vzc2lvbi5zdGF0dXMpIHtcbiAgICAgICAgY2FzZSAnYWN0aXZlJzpcbiAgICAgICAgICBzdGF0cy5hY3RpdmUrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZXhwaXJlZCc6XG4gICAgICAgICAgc3RhdHMuZXhwaXJlZCsrO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdyZXZva2VkJzpcbiAgICAgICAgICBzdGF0cy5yZXZva2VkKys7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2ludmFsaWQnOlxuICAgICAgICAgIHN0YXRzLmludmFsaWQrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgLy8gQ29udGFyIHBvciBkaXNwb3NpdGl2b1xuICAgICAgY29uc3QgZGV2aWNlVHlwZSA9IHNlc3Npb24uZGV2aWNlX2luZm8/LnR5cGUgfHwgJ3Vua25vd24nO1xuICAgICAgc3RhdHMuYnlEZXZpY2VbZGV2aWNlVHlwZV0gPSAoc3RhdHMuYnlEZXZpY2VbZGV2aWNlVHlwZV0gfHwgMCkgKyAxO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN0YXRzO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTRVNTSU9OXSBFcnJvciBvYnRlbmllbmRvIGVzdGFkw61zdGljYXM6JywgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICB0b3RhbDogMCxcbiAgICAgIGFjdGl2ZTogMCxcbiAgICAgIGV4cGlyZWQ6IDAsXG4gICAgICByZXZva2VkOiAwLFxuICAgICAgaW52YWxpZDogMCxcbiAgICAgIGJ5RGV2aWNlOiB7fVxuICAgIH07XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZVTkNJT05FUyBERSBJTklDSUFMSVpBQ0nDk04gWSBDTEVBTlVQIEFVVE9Nw4FUSUNPXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEluaWNpYSBlbCBjbGVhbnVwIGF1dG9tw6F0aWNvIGRlIHNlc2lvbmVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdGFydFNlc3Npb25DbGVhbnVwKCk6IE5vZGVKUy5UaW1lb3V0IHtcbiAgY29uc29sZS5sb2coJ1tTRVNTSU9OXSBJbmljaWFuZG8gY2xlYW51cCBhdXRvbcOhdGljbyBkZSBzZXNpb25lcycpO1xuXG4gIHJldHVybiBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsZWFudXBFeHBpcmVkU2Vzc2lvbnMoKTtcbiAgICAgIGlmIChyZXN1bHQuY2xlYW5lZCA+IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coYFtTRVNTSU9OXSBDbGVhbnVwIGF1dG9tw6F0aWNvOiAke3Jlc3VsdC5jbGVhbmVkfSBzZXNpb25lcyBsaW1waWFkYXNgKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW1NFU1NJT05dIEVycm9yIGVuIGNsZWFudXAgYXV0b23DoXRpY286JywgZXJyb3IpO1xuICAgIH1cbiAgfSwgU0VTU0lPTl9DT05GSUcuY2xlYW51cEludGVydmFsKTtcbn1cblxuLyoqXG4gKiBEZXRpZW5lIGVsIGNsZWFudXAgYXV0b23DoXRpY29cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0b3BTZXNzaW9uQ2xlYW51cChpbnRlcnZhbElkOiBOb2RlSlMuVGltZW91dCk6IHZvaWQge1xuICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xuICBjb25zb2xlLmxvZygnW1NFU1NJT05dIENsZWFudXAgYXV0b23DoXRpY28gZGV0ZW5pZG8nKTtcbn1cblxuLyoqXG4gKiBJbnZhbGlkYSB1bmEgc2VzacOzbiBlc3BlY8OtZmljYVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW52YWxpZGF0ZVNlc3Npb24oXG4gIGNsZXJrU2Vzc2lvbklkOiBzdHJpbmcsXG4gIHJlYXNvbjogc3RyaW5nID0gJ21hbnVhbF9sb2dvdXQnXG4pOiBQcm9taXNlPFNlc3Npb25TeW5jUmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYFtTRVNTSU9OXSBJbnZhbGlkYW5kbyBzZXNpw7NuICR7Y2xlcmtTZXNzaW9uSWR9IC0gUmF6w7NuOiAke3JlYXNvbn1gKTtcblxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm8gZGlzcG9uaWJsZScpO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YTogaW52YWxpZGF0ZWRTZXNzaW9uLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKCd1c2VyX3Nlc3Npb25zJylcbiAgICAgIC51cGRhdGUoe1xuICAgICAgICBzdGF0dXM6ICdyZXZva2VkJyxcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHJldm9rZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICByZXZva2VkX3JlYXNvbjogcmVhc29uXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuZXEoJ2NsZXJrX3Nlc3Npb25faWQnLCBjbGVya1Nlc3Npb25JZClcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XG4gICAgICBpZiAodXBkYXRlRXJyb3IuY29kZSA9PT0gJ1BHUlNUMTE2Jykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgYWN0aW9uOiAnZm91bmRfZXhpc3RpbmcnLFxuICAgICAgICAgIGRldGFpbHM6IHsgbWVzc2FnZTogJ1Nlc2nDs24geWEgaW52YWxpZGFkYSBvIG5vIGVuY29udHJhZGEnIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgaW52YWxpZGFuZG8gc2VzacOzbjogJHt1cGRhdGVFcnJvci5tZXNzYWdlfWApO1xuICAgIH1cblxuICAgIC8vIExvZyBldmVudG8gZGUgc2VndXJpZGFkXG4gICAgYXdhaXQgbG9nU2VjdXJpdHlFdmVudCh7XG4gICAgICB1c2VyX2lkOiBpbnZhbGlkYXRlZFNlc3Npb24udXNlcl9pZCxcbiAgICAgIGV2ZW50X3R5cGU6ICdBVVRIX1NVQ0NFU1MnLFxuICAgICAgZXZlbnRfY2F0ZWdvcnk6ICdhdXRoZW50aWNhdGlvbicsXG4gICAgICBzZXZlcml0eTogJ2xvdycsXG4gICAgICBkZXNjcmlwdGlvbjogJ1Nlc2nDs24gaW52YWxpZGFkYScsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBzZXNzaW9uX2lkOiBpbnZhbGlkYXRlZFNlc3Npb24uaWQsXG4gICAgICAgIGNsZXJrX3Nlc3Npb25faWQ6IGNsZXJrU2Vzc2lvbklkLFxuICAgICAgICByZWFzb25cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEludmFsaWRhciBjYWNoZVxuICAgIGNvbnN0IGNhY2hlID0gQ2FjaGVNYW5hZ2VyLmdldEluc3RhbmNlKCk7XG4gICAgYXdhaXQgY2FjaGUuZGVsZXRlKENBQ0hFX0NPTkZJR1MuVVNFUl9TRVNTSU9OLCBgc2Vzc2lvbnNfJHtpbnZhbGlkYXRlZFNlc3Npb24udXNlcl9pZH1gKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgYWN0aW9uOiAnZGVsZXRlZCcsXG4gICAgICBzZXNzaW9uSWQ6IGludmFsaWRhdGVkU2Vzc2lvbi5pZCxcbiAgICAgIGRldGFpbHM6IHsgc2Vzc2lvbkRhdGE6IGludmFsaWRhdGVkU2Vzc2lvbiB9XG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbU0VTU0lPTl0gRXJyb3IgaW52YWxpZGFuZG8gc2VzacOzbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgYWN0aW9uOiAnZXJyb3InLFxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICB9O1xuICB9XG59XG4iXSwibmFtZXMiOlsiY2xlYW51cEV4cGlyZWRTZXNzaW9ucyIsImNsZWFudXBPbGRTZXNzaW9ucyIsImNyZWF0ZVNlc3Npb24iLCJnZXRTZXNzaW9uSW5mbyIsImdldFNlc3Npb25TdGF0cyIsImdldFVzZXJTZXNzaW9ucyIsImludmFsaWRhdGVBbGxVc2VyU2Vzc2lvbnMiLCJpbnZhbGlkYXRlU2Vzc2lvbiIsImlzU2Vzc2lvblZhbGlkIiwic3RhcnRTZXNzaW9uQ2xlYW51cCIsInN0b3BTZXNzaW9uQ2xlYW51cCIsInN5bmNTZXNzaW9uc1dpdGhDbGVyayIsInVwZGF0ZVNlc3Npb24iLCJ1cGRhdGVTZXNzaW9uQWN0aXZpdHkiLCJTRVNTSU9OX0NPTkZJRyIsIm1heFNlc3Npb25zUGVyVXNlciIsInNlc3Npb25UaW1lb3V0IiwiY2xlYW51cEludGVydmFsIiwibWF4SW5hY3RpdmVUaW1lIiwiY2FjaGVUaW1lb3V0IiwicGFyc2VEZXZpY2VJbmZvIiwidXNlckFnZW50IiwidHlwZSIsInVhIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsIm9zIiwiYnJvd3NlciIsImdlbmVyYXRlU2Vzc2lvbklkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsImNhbGN1bGF0ZUV4cGlyYXRpb25EYXRlIiwidG9JU09TdHJpbmciLCJ1c2VySWQiLCJjbGVya1Nlc3Npb25JZCIsInJlcXVlc3QiLCJjb25zb2xlIiwibG9nIiwic3VwYWJhc2VBZG1pbiIsIkVycm9yIiwiaXBBZGRyZXNzIiwiaGVhZGVycyIsImdldCIsImRldmljZUluZm8iLCJkYXRhIiwiZXhpc3RpbmdTZXNzaW9ucyIsImVycm9yIiwiY291bnRFcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsIm1lc3NhZ2UiLCJsZW5ndGgiLCJzZXNzaW9uRGF0YSIsInVzZXJfaWQiLCJjbGVya19zZXNzaW9uX2lkIiwic3RhdHVzIiwiY3JlYXRlZF9hdCIsInVwZGF0ZWRfYXQiLCJleHBpcmVzX2F0IiwibGFzdF9hY3Rpdml0eSIsImlwX2FkZHJlc3MiLCJ1c2VyX2FnZW50IiwiZGV2aWNlX2luZm8iLCJtZXRhZGF0YSIsImxvZ2luX21ldGhvZCIsInRpbWV6b25lIiwiSW50bCIsIkRhdGVUaW1lRm9ybWF0IiwicmVzb2x2ZWRPcHRpb25zIiwidGltZVpvbmUiLCJzZXNzaW9uX2R1cmF0aW9uIiwibmV3U2Vzc2lvbiIsImluc2VydEVycm9yIiwiaW5zZXJ0Iiwic2luZ2xlIiwibG9nU2VjdXJpdHlFdmVudCIsImV2ZW50X3R5cGUiLCJldmVudF9jYXRlZ29yeSIsInNldmVyaXR5IiwiZGVzY3JpcHRpb24iLCJzZXNzaW9uX2lkIiwiaWQiLCJjYWNoZSIsIkNhY2hlTWFuYWdlciIsImdldEluc3RhbmNlIiwiZGVsZXRlIiwiQ0FDSEVfQ09ORklHUyIsIlVTRVJfU0VTU0lPTiIsInN1Y2Nlc3MiLCJhY3Rpb24iLCJzZXNzaW9uSWQiLCJkZXRhaWxzIiwidXBkYXRlcyIsInVwZGF0ZURhdGEiLCJ1cGRhdGVkU2Vzc2lvbiIsInVwZGF0ZUVycm9yIiwidXBkYXRlIiwiY29kZSIsImtlZXBDb3VudCIsInNlc3Npb25zIiwiZmV0Y2hFcnJvciIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiY2xlYW5lZCIsImVycm9ycyIsImV4cGlyZWQiLCJvcnBoYW5lZCIsImludmFsaWQiLCJzZXNzaW9uc1RvUmVtb3ZlIiwic2xpY2UiLCJzZXNzaW9uIiwiZGVsZXRlRXJyb3IiLCJleHBpcmVkX2F0IiwiZXhwaXJlZF9yZWFzb24iLCJpbmFjdGl2ZVRocmVzaG9sZCIsImV4cGlyZWRTZXNzaW9ucyIsIm9yIiwiaXNPcnBoYW5lZCIsImNsaWVudCIsImNsZXJrQ2xpZW50IiwiZ2V0U2Vzc2lvbiIsImNsZXJrRXJyb3IiLCJyZWFzb24iLCJjbGVhbnVwX2F0IiwiY2xlYW51cF9yZWFzb24iLCJjbGVya1Nlc3Npb25zIiwidXNlcnMiLCJnZXRVc2VyTGlzdCIsInVzZXIiLCJhY3RpdmVTZXNzaW9ucyIsImZpbHRlciIsInMiLCJzdXBhYmFzZVNlc3Npb25zIiwic3VwYWJhc2VTZXNzaW9uSWRzIiwiU2V0IiwibWFwIiwiY2xlcmtTZXNzaW9uSWRzIiwib3JwaGFuZWRTZXNzaW9ucyIsImhhcyIsIm1pc3NpbmdTZXNzaW9ucyIsIm9ycGhhbmVkX2NsZWFuZWQiLCJtaXNzaW5nX2NyZWF0ZWQiLCJ0b3RhbF9hY3RpdmUiLCJjYWNoZUtleSIsImNhY2hlZCIsInNlc3Npb25zRGF0YSIsInNldCIsImV4cGlyZXNBdCIsImxhc3RBY3Rpdml0eSIsIm1heEluYWN0aXZlIiwiZ2V0VGltZSIsInJlc3VsdCIsImxvZ0FkbWluQWN0aW9uIiwidXNlclJvbGUiLCJwZXJtaXNzaW9ucyIsInNvdXJjZSIsInNlc3Npb25zX2ludmFsaWRhdGVkIiwic3RhdHMiLCJ0b3RhbCIsImFjdGl2ZSIsInJldm9rZWQiLCJieURldmljZSIsImZvckVhY2giLCJkZXZpY2VUeXBlIiwic2V0SW50ZXJ2YWwiLCJpbnRlcnZhbElkIiwiY2xlYXJJbnRlcnZhbCIsImludmFsaWRhdGVkU2Vzc2lvbiIsInJldm9rZWRfYXQiLCJyZXZva2VkX3JlYXNvbiJdLCJtYXBwaW5ncyI6IkFBQUE7OztDQUdDOzs7Ozs7Ozs7OztJQTZZcUJBLHNCQUFzQjtlQUF0QkE7O0lBeEZBQyxrQkFBa0I7ZUFBbEJBOztJQS9LQUMsYUFBYTtlQUFiQTs7SUFvZkFDLGNBQWM7ZUFBZEE7O0lBeUtBQyxlQUFlO2VBQWZBOztJQWxOQUMsZUFBZTtlQUFmQTs7SUFrSUFDLHlCQUF5QjtlQUF6QkE7O0lBbUxBQyxpQkFBaUI7ZUFBakJBOztJQS9PQUMsY0FBYztlQUFkQTs7SUFxTk5DLG1CQUFtQjtlQUFuQkE7O0lBa0JBQyxrQkFBa0I7ZUFBbEJBOztJQTdYTUMscUJBQXFCO2VBQXJCQTs7SUF2UUFDLGFBQWE7ZUFBYkE7O0lBMmJBQyxxQkFBcUI7ZUFBckJBOzs7d0JBbnJCTTswQkFDRTsrQkFDbUI7OEJBQ0w7QUEyRDVDLHdEQUF3RDtBQUN4RCxnQkFBZ0I7QUFDaEIsd0RBQXdEO0FBRXhELE1BQU1DLGlCQUFpQjtJQUNyQkMsb0JBQW9CO0lBQ3BCQyxnQkFBZ0IsS0FBSyxLQUFLLEtBQUs7SUFDL0JDLGlCQUFpQixLQUFLLEtBQUs7SUFDM0JD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