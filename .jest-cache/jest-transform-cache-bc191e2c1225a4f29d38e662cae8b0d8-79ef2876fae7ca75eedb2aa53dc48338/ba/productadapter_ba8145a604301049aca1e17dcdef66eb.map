{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\lib\\adapters\\product-adapter.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - ADAPTADOR DE PRODUCTOS\r\n// ===================================\r\n\r\nimport { Product } from '@/types/product';\r\nimport { ProductWithCategory } from '@/types/api';\r\n\r\n/**\r\n * Convierte un producto de la API al formato esperado por los componentes\r\n * @param apiProduct - Producto desde la API\r\n * @returns Product - Producto en formato de componente\r\n */\r\nexport function adaptApiProductToComponent(apiProduct: ProductWithCategory): Product {\r\n  // Mapear correctamente las imágenes desde la estructura de BD a la estructura de componentes\r\n  const images = apiProduct.images || {};\r\n\r\n  return {\r\n    id: apiProduct.id,\r\n    title: apiProduct.name,\r\n    reviews: Math.floor(Math.random() * 50) + 1, // Temporal: generar reviews aleatorias\r\n    price: apiProduct.price,\r\n    discountedPrice: apiProduct.discounted_price || apiProduct.price,\r\n    imgs: {\r\n      // Mapear desde la estructura real de la BD: { main, gallery, thumbnail }\r\n      thumbnails: images.thumbnail ? [images.thumbnail] : ['/images/products/placeholder.svg'],\r\n      previews: images.main ? [images.main] : (images.gallery?.[0] ? [images.gallery[0]] : ['/images/products/placeholder.svg']),\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Convierte una lista de productos de la API al formato de componentes\r\n * @param apiProducts - Lista de productos desde la API\r\n * @returns Product[] - Lista de productos en formato de componente\r\n */\r\nexport function adaptApiProductsToComponents(apiProducts: ProductWithCategory[]): Product[] {\r\n  return apiProducts.map(adaptApiProductToComponent);\r\n}\r\n\r\n/**\r\n * Convierte un producto de componente al formato de la API\r\n * @param componentProduct - Producto en formato de componente\r\n * @returns Partial<ProductWithCategory> - Producto en formato de API\r\n */\r\nexport function adaptComponentProductToApi(componentProduct: Product): Partial<ProductWithCategory> {\r\n  return {\r\n    id: componentProduct.id,\r\n    name: componentProduct.title,\r\n    price: componentProduct.price,\r\n    discounted_price: componentProduct.discountedPrice !== componentProduct.price \r\n      ? componentProduct.discountedPrice \r\n      : null,\r\n    images: componentProduct.imgs,\r\n    stock: 50, // Valor por defecto\r\n  };\r\n}\r\n\r\n/**\r\n * Verifica si un producto tiene descuento\r\n * @param product - Producto\r\n * @returns boolean\r\n */\r\nexport function hasDiscount(product: Product | ProductWithCategory): boolean {\r\n  if ('discountedPrice' in product) {\r\n    return product.discountedPrice < product.price;\r\n  }\r\n  if ('discounted_price' in product) {\r\n    return product.discounted_price !== null && product.discounted_price < product.price;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Calcula el porcentaje de descuento\r\n * @param product - Producto\r\n * @returns number - Porcentaje de descuento\r\n */\r\nexport function getDiscountPercentage(product: Product | ProductWithCategory): number {\r\n  let originalPrice: number;\r\n  let discountedPrice: number;\r\n\r\n  if ('discountedPrice' in product) {\r\n    originalPrice = product.price;\r\n    discountedPrice = product.discountedPrice;\r\n  } else {\r\n    originalPrice = product.price;\r\n    discountedPrice = product.discounted_price || product.price;\r\n  }\r\n\r\n  if (discountedPrice >= originalPrice) {\r\n    return 0;\r\n  }\r\n\r\n  return Math.round(((originalPrice - discountedPrice) / originalPrice) * 100);\r\n}\r\n\r\n/**\r\n * Obtiene el precio final del producto (con descuento si aplica)\r\n * @param product - Producto\r\n * @returns number - Precio final\r\n */\r\nexport function getFinalPrice(product: Product | ProductWithCategory): number {\r\n  if ('discountedPrice' in product) {\r\n    return product.discountedPrice;\r\n  }\r\n  return product.discounted_price ?? product.price;\r\n}\r\n\r\n/**\r\n * Obtiene la imagen principal del producto\r\n * @param product - Producto\r\n * @returns string - URL de la imagen\r\n */\r\nexport function getMainImage(product: Product | ProductWithCategory): string {\r\n  if ('imgs' in product && product.imgs?.previews?.[0]) {\r\n    return product.imgs.previews[0];\r\n  }\r\n  if ('images' in product && product.images?.previews?.[0]) {\r\n    return product.images.previews[0];\r\n  }\r\n  return '/images/products/placeholder.svg';\r\n}\r\n\r\n/**\r\n * Valida y obtiene una URL de imagen válida, manejando cadenas vacías y undefined\r\n * @param imageUrl - URL de imagen a validar\r\n * @param fallback - URL de fallback (por defecto: placeholder)\r\n * @returns string - URL de imagen válida\r\n */\r\nexport function getValidImageUrl(imageUrl: string | undefined | null, fallback: string = '/images/products/placeholder.svg'): string {\r\n  // Verificar si la imagen existe y no es una cadena vacía o solo espacios\r\n  if (imageUrl && typeof imageUrl === 'string' && imageUrl.trim() !== '') {\r\n    return imageUrl.trim();\r\n  }\r\n  return fallback;\r\n}\r\n\r\n/**\r\n * Obtiene la imagen thumbnail del producto con validación robusta\r\n * @param product - Producto\r\n * @returns string - URL de la imagen thumbnail válida\r\n */\r\nexport function getThumbnailImage(product: Product | ProductWithCategory): string {\r\n  let imageUrl: string | undefined;\r\n\r\n  if ('imgs' in product && product.imgs?.thumbnails?.[0]) {\r\n    imageUrl = product.imgs.thumbnails[0];\r\n  } else if ('images' in product && product.images?.thumbnails?.[0]) {\r\n    imageUrl = product.images.thumbnails[0];\r\n  }\r\n\r\n  return getValidImageUrl(imageUrl);\r\n}\r\n\r\n/**\r\n * Obtiene la imagen preview del producto con validación robusta\r\n * @param product - Producto\r\n * @returns string - URL de la imagen preview válida\r\n */\r\nexport function getPreviewImage(product: Product | ProductWithCategory): string {\r\n  let imageUrl: string | undefined;\r\n\r\n  if ('imgs' in product && product.imgs?.previews?.[0]) {\r\n    imageUrl = product.imgs.previews[0];\r\n  } else if ('images' in product && product.images?.previews?.[0]) {\r\n    imageUrl = product.images.previews[0];\r\n  }\r\n\r\n  return getValidImageUrl(imageUrl);\r\n}\r\n\r\n/**\r\n * Formatea el precio para mostrar en pesos argentinos\r\n * @param price - Precio\r\n * @returns string - Precio formateado\r\n */\r\nexport function formatPrice(price: number): string {\r\n  return new Intl.NumberFormat('es-AR', {\r\n    style: 'currency',\r\n    currency: 'ARS',\r\n    minimumFractionDigits: 0,\r\n    maximumFractionDigits: 0,\r\n  }).format(price);\r\n}\r\n\r\n/**\r\n * Genera un slug a partir del nombre del producto\r\n * @param name - Nombre del producto\r\n * @returns string - Slug\r\n */\r\nexport function generateSlug(name: string): string {\r\n  return name\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '') // Remover acentos\r\n    .replace(/[^a-z0-9\\s-]/g, '') // Remover caracteres especiales\r\n    .replace(/\\s+/g, '-') // Reemplazar espacios con guiones\r\n    .replace(/-+/g, '-') // Remover guiones múltiples\r\n    .replace(/^-|-$/g, ''); // Remover guiones al inicio y final\r\n}\r\n"],"names":["adaptApiProductToComponent","adaptApiProductsToComponents","adaptComponentProductToApi","formatPrice","generateSlug","getDiscountPercentage","getFinalPrice","getMainImage","getPreviewImage","getThumbnailImage","getValidImageUrl","hasDiscount","apiProduct","images","id","title","name","reviews","Math","floor","random","price","discountedPrice","discounted_price","imgs","thumbnails","thumbnail","previews","main","gallery","apiProducts","map","componentProduct","stock","product","originalPrice","round","imageUrl","fallback","trim","Intl","NumberFormat","style","currency","minimumFractionDigits","maximumFractionDigits","format","toLowerCase","normalize","replace"],"mappings":"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"}