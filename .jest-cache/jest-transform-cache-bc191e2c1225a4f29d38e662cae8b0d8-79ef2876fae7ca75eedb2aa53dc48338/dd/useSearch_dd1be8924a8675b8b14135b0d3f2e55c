0bb7b7c0fa74b3f76f722b293964abca
// ===================================
// HOOK: useSearch - Sistema de b√∫squeda centralizado
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    default: function() {
        return _default;
    },
    useSearch: function() {
        return useSearch;
    }
});
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _navigation = require("next/navigation");
const _usedebounce = require("use-debounce");
const _products = require("../lib/api/products");
const _useSearchErrorHandler = require("./useSearchErrorHandler");
const _useSearchToast = require("./useSearchToast");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
// ===================================
// B√öSQUEDAS TRENDING POR DEFECTO
// ===================================
const defaultTrendingSearches = [
    {
        id: "trending-1",
        type: "trending",
        title: "Pintura l√°tex",
        href: "/search?q=pintura+latex"
    },
    {
        id: "trending-2",
        type: "trending",
        title: "Sherwin Williams",
        href: "/search?q=sherwin+williams"
    },
    {
        id: "trending-3",
        type: "trending",
        title: "Rodillos premium",
        href: "/search?q=rodillos+premium"
    },
    {
        id: "trending-4",
        type: "trending",
        title: "Pinceles",
        href: "/search?q=pinceles"
    }
];
function useSearch(options = {}) {
    const { debounceMs = 150, maxSuggestions = 8, searchLimit = 12, saveRecentSearches = true, onSearch, onSuggestionSelect } = options;
    const router = (0, _navigation.useRouter)();
    const debounceRef = (0, _react.useRef)();
    const safetyTimeoutRef = (0, _react.useRef)(); // Timeout de seguridad para evitar loading permanente
    const optionsRef = (0, _react.useRef)(options); // Ref para opciones estables
    const recentSearchesRef = (0, _react.useRef)([]); // Ref para b√∫squedas recientes
    // Hooks para manejo de errores y toast notifications
    const errorHandler = (0, _useSearchErrorHandler.useSearchErrorHandler)({
        onError: (error)=>{
            console.error('Error de b√∫squeda:', error);
        },
        onRetrySuccess: ()=>{
            toastHandler.showRetrySuccessToast();
        },
        onRetryFailed: (error, attempts)=>{
            toastHandler.showRetryFailedToast(attempts);
        }
    });
    const toastHandler = (0, _useSearchToast.useSearchToast)({
        defaultDuration: 4000,
        maxToasts: 2
    });
    // Actualizar ref cuando cambien las opciones
    optionsRef.current = options;
    // Estado principal
    const [state, setState] = (0, _react.useState)({
        query: '',
        results: [],
        suggestions: [],
        isLoading: false,
        error: null,
        hasSearched: false
    });
    const [recentSearches, setRecentSearches] = (0, _react.useState)([]);
    // Sincronizar referencia con estado para evitar dependencias en useCallback
    _react.default.useEffect(()=>{
        recentSearchesRef.current = recentSearches;
    }, [
        recentSearches
    ]);
    // ===================================
    // FUNCIONES AUXILIARES SIMPLIFICADAS
    // ===================================
    // ===================================
    // FUNCIONES PRINCIPALES CON USE-DEBOUNCE
    // ===================================
    /**
   * Funci√≥n de b√∫squeda interna optimizada
   */ const performSearch = (0, _react.useCallback)(async (searchQuery)=>{
        console.log('üîç useSearch: performSearch ejecutando para:', searchQuery);
        // Limpiar timeout de seguridad anterior
        if (safetyTimeoutRef.current) {
            clearTimeout(safetyTimeoutRef.current);
        }
        // Si la query est√° vac√≠a, mostrar sugerencias por defecto
        if (!searchQuery.trim()) {
            console.log('üîç useSearch: Query vac√≠a, mostrando sugerencias por defecto');
            const defaultSuggestions = [
                ...defaultTrendingSearches.slice(0, 4),
                ...recentSearchesRef.current.slice(0, 3).map((search, index)=>({
                        id: `recent-${index}`,
                        type: 'recent',
                        title: search,
                        href: `/search?q=${encodeURIComponent(search)}`
                    }))
            ].slice(0, maxSuggestions);
            setState((prev)=>({
                    ...prev,
                    query: searchQuery,
                    suggestions: defaultSuggestions,
                    isLoading: false
                }));
            return;
        }
        // Timeout de seguridad para evitar loading permanente (5 segundos)
        safetyTimeoutRef.current = setTimeout(()=>{
            console.log('‚ö†Ô∏è useSearch: Timeout de seguridad activado - reseteando loading state');
            setState((prev)=>({
                    ...prev,
                    isLoading: false,
                    error: 'Tiempo de espera agotado. Intenta nuevamente.'
                }));
        }, 5000);
        // Ejecutar b√∫squeda directamente (el debounce se maneja en searchWithDebounce)
        try {
            console.log('üîç useSearch: Iniciando b√∫squeda para:', searchQuery);
            const response = await (0, _products.searchProducts)(searchQuery, maxSuggestions);
            console.log('üì¶ useSearch: Respuesta de b√∫squeda:', response);
            // Limpiar timeout de seguridad ya que la API respondi√≥
            if (safetyTimeoutRef.current) {
                clearTimeout(safetyTimeoutRef.current);
            }
            if (response.success && response.data && Array.isArray(response.data)) {
                const productSuggestions = response.data.map((product)=>({
                        id: `product-${product.id}`,
                        type: 'product',
                        title: product.name,
                        subtitle: product.category?.name || 'Sin categor√≠a',
                        image: product.images?.previews?.[0] || '/images/products/placeholder.jpg',
                        badge: product.stock > 0 ? 'En stock' : 'Sin stock',
                        href: `/shop-details/${product.id}`
                    }));
                console.log('‚úÖ useSearch: Sugerencias generadas:', productSuggestions.length);
                setState((prev)=>({
                        ...prev,
                        query: searchQuery,
                        suggestions: productSuggestions,
                        isLoading: false,
                        error: null
                    }));
            } else {
                console.log('‚ö†Ô∏è useSearch: Sin resultados o respuesta no exitosa');
                setState((prev)=>({
                        ...prev,
                        query: searchQuery,
                        suggestions: [],
                        isLoading: false,
                        error: response.error || 'No se encontraron resultados'
                    }));
            }
        } catch (error) {
            console.error('‚ùå useSearch: Error en b√∫squeda:', error);
            // Limpiar timeout de seguridad
            if (safetyTimeoutRef.current) {
                clearTimeout(safetyTimeoutRef.current);
            }
            setState((prev)=>({
                    ...prev,
                    query: searchQuery,
                    suggestions: [],
                    isLoading: false,
                    error: 'Error en la b√∫squeda. Intenta nuevamente.'
                }));
        }
    }, [
        maxSuggestions
    ]); // Solo maxSuggestions es necesario como dependencia
    /**
   * Funci√≥n de b√∫squeda con debounce optimizado usando use-debounce
   */ const searchWithDebounce = (0, _usedebounce.useDebouncedCallback)((searchQuery)=>{
        console.log('üîç useSearch: searchWithDebounce (use-debounce) llamado con:', searchQuery);
        // Actualizar estado de loading inmediatamente
        setState((prev)=>({
                ...prev,
                isLoading: !!searchQuery.trim(),
                error: null
            }));
        // Ejecutar b√∫squeda
        performSearch(searchQuery);
    }, debounceMs, {
        maxWait: 2000,
        leading: false,
        trailing: true
    });
    /**
   * Ejecuta una b√∫squeda completa y navega a resultados
   */ const executeSearch = (0, _react.useCallback)(async (searchQuery, category)=>{
        if (!searchQuery.trim()) return;
        try {
            setState((prev)=>({
                    ...prev,
                    isLoading: true,
                    error: null
                }));
            // Guardar en historial
            if (saveRecentSearches && searchQuery.trim()) {
                const updated = [
                    searchQuery.trim(),
                    ...recentSearchesRef.current.filter((s)=>s !== searchQuery.trim())
                ].slice(0, 5);
                setRecentSearches(updated);
                try {
                    localStorage.setItem('pinteya-recent-searches', JSON.stringify(updated));
                } catch (error) {
                    console.warn('Error guardando b√∫squeda reciente:', error);
                }
            }
            // Realizar b√∫squeda con manejo robusto de errores
            const response = await errorHandler.executeWithRetry(()=>(0, _products.searchProducts)(searchQuery.trim(), searchLimit), `b√∫squeda de "${searchQuery.trim()}"`);
            if (response.success && response.data) {
                const resultCount = response.data.length;
                setState((prev)=>({
                        ...prev,
                        results: response.data || [],
                        isLoading: false,
                        hasSearched: true,
                        error: null
                    }));
                // Limpiar errores previos
                errorHandler.clearError();
                // Mostrar toast de √©xito si hay resultados
                if (resultCount > 0) {
                    toastHandler.showSuccessToast(searchQuery.trim(), resultCount);
                } else {
                    toastHandler.showNoResultsToast(searchQuery.trim());
                }
                // Callback personalizado
                optionsRef.current.onSearch?.(searchQuery.trim(), response.data || []);
                // Navegar a resultados
                const searchParams = new URLSearchParams();
                searchParams.set('q', searchQuery.trim());
                if (category) {
                    searchParams.set('category', category);
                }
                router.push(`/search?${searchParams.toString()}`);
            } else {
                const errorMessage = response.error || 'No se encontraron resultados';
                setState((prev)=>({
                        ...prev,
                        results: [],
                        isLoading: false,
                        hasSearched: true,
                        error: errorMessage
                    }));
                // Mostrar toast de advertencia para respuestas sin √©xito
                toastHandler.showWarningToast('B√∫squeda sin resultados', errorMessage);
            }
        } catch (error) {
            console.error('‚ùå Error ejecutando b√∫squeda:', error);
            // Manejar error con el error handler
            const searchError = errorHandler.handleError(error);
            setState((prev)=>({
                    ...prev,
                    results: [],
                    isLoading: false,
                    hasSearched: true,
                    error: searchError.message
                }));
            // Mostrar toast de error
            toastHandler.showErrorToast(searchError, errorHandler.retryCount, ()=>{
                executeSearch(searchQuery.trim(), category);
            });
        }
    }, [
        searchLimit,
        saveRecentSearches,
        router,
        errorHandler,
        toastHandler
    ]); // Remover recentSearches de dependencias para evitar bucle infinito
    /**
   * Maneja la selecci√≥n de una sugerencia
   */ const selectSuggestion = (0, _react.useCallback)((suggestion)=>{
        // Guardar en historial si es producto o categor√≠a
        if ((suggestion.type === 'product' || suggestion.type === 'category') && saveRecentSearches) {
            const updated = [
                suggestion.title,
                ...recentSearchesRef.current.filter((s)=>s !== suggestion.title)
            ].slice(0, 5);
            setRecentSearches(updated);
            try {
                localStorage.setItem('pinteya-recent-searches', JSON.stringify(updated));
            } catch (error) {
                console.warn('Error guardando b√∫squeda reciente:', error);
            }
        }
        // Actualizar estado
        setState((prev)=>({
                ...prev,
                query: suggestion.title
            }));
        // Callback personalizado
        optionsRef.current.onSuggestionSelect?.(suggestion);
        // Navegar
        router.push(suggestion.href);
    }, [
        saveRecentSearches,
        router
    ]); // Remover recentSearches de dependencias para evitar bucle infinito
    /**
   * Limpia el estado de b√∫squeda
   */ const clearSearch = (0, _react.useCallback)(()=>{
        console.log('üßπ useSearch: clearSearch llamado');
        // Limpiar todos los timeouts
        if (debounceRef.current) {
            clearTimeout(debounceRef.current);
        }
        if (safetyTimeoutRef.current) {
            clearTimeout(safetyTimeoutRef.current);
        }
        // Resetear estado completamente (sin sugerencias por defecto para tests)
        setState({
            query: '',
            results: [],
            suggestions: [],
            isLoading: false,
            error: null,
            hasSearched: false
        });
    }, []); // Remover dependencia circular
    /**
   * Inicializa el hook (cargar b√∫squedas recientes)
   */ const initialize = (0, _react.useCallback)(()=>{
        if (saveRecentSearches) {
            try {
                const stored = localStorage.getItem('pinteya-recent-searches');
                if (stored && stored.trim() !== '' && stored !== '""' && stored !== "''") {
                    // Validar que no est√© corrupto
                    if (stored.includes('""') && stored.length < 5) {
                        console.warn('Detected corrupted recent searches data, cleaning up');
                        localStorage.removeItem('pinteya-recent-searches');
                        return;
                    }
                    const parsed = JSON.parse(stored);
                    // Verificar que sea un array v√°lido
                    if (Array.isArray(parsed)) {
                        setRecentSearches(parsed);
                    } else {
                        console.warn('Invalid recent searches format, resetting');
                        localStorage.removeItem('pinteya-recent-searches');
                    }
                }
            } catch (error) {
                console.warn('Error cargando b√∫squedas recientes:', error);
                // Limpiar datos corruptos
                localStorage.removeItem('pinteya-recent-searches');
            }
        }
    }, [
        saveRecentSearches
    ]);
    // ===================================
    // CLEANUP
    // ===================================
    const cleanup = (0, _react.useCallback)(()=>{
        // Cancelar debounce de use-debounce
        searchWithDebounce.cancel();
        // Limpiar timeouts manuales restantes
        if (debounceRef.current) {
            clearTimeout(debounceRef.current);
        }
        if (safetyTimeoutRef.current) {
            clearTimeout(safetyTimeoutRef.current);
        }
    }, [
        searchWithDebounce
    ]);
    // ===================================
    // RETURN
    // ===================================
    return {
        // Estado
        ...state,
        recentSearches,
        // Estado de errores y toasts
        searchError: errorHandler.currentError,
        isRetrying: errorHandler.isRetrying,
        retryCount: errorHandler.retryCount,
        toasts: toastHandler.toasts,
        // Funciones principales
        searchWithDebounce,
        executeSearch,
        selectSuggestion,
        clearSearch,
        initialize,
        cleanup,
        // Funciones de manejo de errores
        clearError: errorHandler.clearError,
        retryManually: errorHandler.retryManually,
        // Funciones de toast
        removeToast: toastHandler.removeToast,
        clearToasts: toastHandler.clearToasts
    };
}
const _default = useSearch;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZVNlYXJjaC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBIT09LOiB1c2VTZWFyY2ggLSBTaXN0ZW1hIGRlIGLDunNxdWVkYSBjZW50cmFsaXphZG9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSwgdXNlQ2FsbGJhY2ssIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSAnbmV4dC9uYXZpZ2F0aW9uJztcclxuaW1wb3J0IHsgdXNlRGVib3VuY2VkQ2FsbGJhY2sgfSBmcm9tICd1c2UtZGVib3VuY2UnO1xyXG5pbXBvcnQgeyBzZWFyY2hQcm9kdWN0cyB9IGZyb20gJ0AvbGliL2FwaS9wcm9kdWN0cyc7XHJcbmltcG9ydCB7IFByb2R1Y3RXaXRoQ2F0ZWdvcnkgfSBmcm9tICdAL3R5cGVzL2FwaSc7XHJcbmltcG9ydCB7IHVzZVNlYXJjaEVycm9ySGFuZGxlciB9IGZyb20gJy4vdXNlU2VhcmNoRXJyb3JIYW5kbGVyJztcclxuaW1wb3J0IHsgdXNlU2VhcmNoVG9hc3QgfSBmcm9tICcuL3VzZVNlYXJjaFRvYXN0JztcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIFRJUE9TXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaFN0YXRlIHtcclxuICBxdWVyeTogc3RyaW5nO1xyXG4gIHJlc3VsdHM6IFByb2R1Y3RXaXRoQ2F0ZWdvcnlbXTtcclxuICBzdWdnZXN0aW9uczogU2VhcmNoU3VnZ2VzdGlvbltdO1xyXG4gIGlzTG9hZGluZzogYm9vbGVhbjtcclxuICBlcnJvcjogc3RyaW5nIHwgbnVsbDtcclxuICBoYXNTZWFyY2hlZDogYm9vbGVhbjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hTdWdnZXN0aW9uIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHR5cGU6ICdwcm9kdWN0JyB8ICdjYXRlZ29yeScgfCAncmVjZW50JyB8ICd0cmVuZGluZyc7XHJcbiAgdGl0bGU6IHN0cmluZztcclxuICBzdWJ0aXRsZT86IHN0cmluZztcclxuICBpbWFnZT86IHN0cmluZztcclxuICBiYWRnZT86IHN0cmluZztcclxuICBocmVmOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVXNlU2VhcmNoT3B0aW9ucyB7XHJcbiAgLyoqIFRpZW1wbyBkZSBkZWJvdW5jZSBlbiBtaWxpc2VndW5kb3MgKi9cclxuICBkZWJvdW5jZU1zPzogbnVtYmVyO1xyXG4gIC8qKiBOw7ptZXJvIG3DoXhpbW8gZGUgc3VnZXJlbmNpYXMgKi9cclxuICBtYXhTdWdnZXN0aW9ucz86IG51bWJlcjtcclxuICAvKiogTMOtbWl0ZSBkZSByZXN1bHRhZG9zIGRlIGLDunNxdWVkYSAqL1xyXG4gIHNlYXJjaExpbWl0PzogbnVtYmVyO1xyXG4gIC8qKiBHdWFyZGFyIGLDunNxdWVkYXMgcmVjaWVudGVzICovXHJcbiAgc2F2ZVJlY2VudFNlYXJjaGVzPzogYm9vbGVhbjtcclxuICAvKiogQ2FsbGJhY2sgY3VhbmRvIHNlIHJlYWxpemEgdW5hIGLDunNxdWVkYSAqL1xyXG4gIG9uU2VhcmNoPzogKHF1ZXJ5OiBzdHJpbmcsIHJlc3VsdHM6IFByb2R1Y3RXaXRoQ2F0ZWdvcnlbXSkgPT4gdm9pZDtcclxuICAvKiogQ2FsbGJhY2sgY3VhbmRvIHNlIHNlbGVjY2lvbmEgdW5hIHN1Z2VyZW5jaWEgKi9cclxuICBvblN1Z2dlc3Rpb25TZWxlY3Q/OiAoc3VnZ2VzdGlvbjogU2VhcmNoU3VnZ2VzdGlvbikgPT4gdm9pZDtcclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gQsOaU1FVRURBUyBUUkVORElORyBQT1IgREVGRUNUT1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuY29uc3QgZGVmYXVsdFRyZW5kaW5nU2VhcmNoZXM6IFNlYXJjaFN1Z2dlc3Rpb25bXSA9IFtcclxuICB7XHJcbiAgICBpZDogXCJ0cmVuZGluZy0xXCIsXHJcbiAgICB0eXBlOiBcInRyZW5kaW5nXCIsXHJcbiAgICB0aXRsZTogXCJQaW50dXJhIGzDoXRleFwiLFxyXG4gICAgaHJlZjogXCIvc2VhcmNoP3E9cGludHVyYStsYXRleFwiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgaWQ6IFwidHJlbmRpbmctMlwiLFxyXG4gICAgdHlwZTogXCJ0cmVuZGluZ1wiLFxyXG4gICAgdGl0bGU6IFwiU2hlcndpbiBXaWxsaWFtc1wiLFxyXG4gICAgaHJlZjogXCIvc2VhcmNoP3E9c2hlcndpbit3aWxsaWFtc1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgaWQ6IFwidHJlbmRpbmctM1wiLFxyXG4gICAgdHlwZTogXCJ0cmVuZGluZ1wiLFxyXG4gICAgdGl0bGU6IFwiUm9kaWxsb3MgcHJlbWl1bVwiLFxyXG4gICAgaHJlZjogXCIvc2VhcmNoP3E9cm9kaWxsb3MrcHJlbWl1bVwiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgaWQ6IFwidHJlbmRpbmctNFwiLFxyXG4gICAgdHlwZTogXCJ0cmVuZGluZ1wiLFxyXG4gICAgdGl0bGU6IFwiUGluY2VsZXNcIixcclxuICAgIGhyZWY6IFwiL3NlYXJjaD9xPXBpbmNlbGVzXCIsXHJcbiAgfSxcclxuXTtcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEhPT0sgUFJJTkNJUEFMXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXNlU2VhcmNoKG9wdGlvbnM6IFVzZVNlYXJjaE9wdGlvbnMgPSB7fSkge1xyXG4gIGNvbnN0IHtcclxuICAgIGRlYm91bmNlTXMgPSAxNTAsXHJcbiAgICBtYXhTdWdnZXN0aW9ucyA9IDgsXHJcbiAgICBzZWFyY2hMaW1pdCA9IDEyLFxyXG4gICAgc2F2ZVJlY2VudFNlYXJjaGVzID0gdHJ1ZSxcclxuICAgIG9uU2VhcmNoLFxyXG4gICAgb25TdWdnZXN0aW9uU2VsZWN0XHJcbiAgfSA9IG9wdGlvbnM7XHJcblxyXG4gIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpO1xyXG4gIGNvbnN0IGRlYm91bmNlUmVmID0gdXNlUmVmPE5vZGVKUy5UaW1lb3V0PigpO1xyXG4gIGNvbnN0IHNhZmV0eVRpbWVvdXRSZWYgPSB1c2VSZWY8Tm9kZUpTLlRpbWVvdXQ+KCk7IC8vIFRpbWVvdXQgZGUgc2VndXJpZGFkIHBhcmEgZXZpdGFyIGxvYWRpbmcgcGVybWFuZW50ZVxyXG4gIGNvbnN0IG9wdGlvbnNSZWYgPSB1c2VSZWYob3B0aW9ucyk7IC8vIFJlZiBwYXJhIG9wY2lvbmVzIGVzdGFibGVzXHJcbiAgY29uc3QgcmVjZW50U2VhcmNoZXNSZWYgPSB1c2VSZWY8c3RyaW5nW10+KFtdKTsgLy8gUmVmIHBhcmEgYsO6c3F1ZWRhcyByZWNpZW50ZXNcclxuXHJcbiAgLy8gSG9va3MgcGFyYSBtYW5lam8gZGUgZXJyb3JlcyB5IHRvYXN0IG5vdGlmaWNhdGlvbnNcclxuICBjb25zdCBlcnJvckhhbmRsZXIgPSB1c2VTZWFyY2hFcnJvckhhbmRsZXIoe1xyXG4gICAgb25FcnJvcjogKGVycm9yKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRlIGLDunNxdWVkYTonLCBlcnJvcik7XHJcbiAgICB9LFxyXG4gICAgb25SZXRyeVN1Y2Nlc3M6ICgpID0+IHtcclxuICAgICAgdG9hc3RIYW5kbGVyLnNob3dSZXRyeVN1Y2Nlc3NUb2FzdCgpO1xyXG4gICAgfSxcclxuICAgIG9uUmV0cnlGYWlsZWQ6IChlcnJvciwgYXR0ZW1wdHMpID0+IHtcclxuICAgICAgdG9hc3RIYW5kbGVyLnNob3dSZXRyeUZhaWxlZFRvYXN0KGF0dGVtcHRzKTtcclxuICAgIH0sXHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IHRvYXN0SGFuZGxlciA9IHVzZVNlYXJjaFRvYXN0KHtcclxuICAgIGRlZmF1bHREdXJhdGlvbjogNDAwMCxcclxuICAgIG1heFRvYXN0czogMixcclxuICB9KTtcclxuXHJcbiAgLy8gQWN0dWFsaXphciByZWYgY3VhbmRvIGNhbWJpZW4gbGFzIG9wY2lvbmVzXHJcbiAgb3B0aW9uc1JlZi5jdXJyZW50ID0gb3B0aW9ucztcclxuXHJcbiAgLy8gRXN0YWRvIHByaW5jaXBhbFxyXG4gIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gdXNlU3RhdGU8U2VhcmNoU3RhdGU+KHtcclxuICAgIHF1ZXJ5OiAnJyxcclxuICAgIHJlc3VsdHM6IFtdLFxyXG4gICAgc3VnZ2VzdGlvbnM6IFtdLFxyXG4gICAgaXNMb2FkaW5nOiBmYWxzZSxcclxuICAgIGVycm9yOiBudWxsLFxyXG4gICAgaGFzU2VhcmNoZWQ6IGZhbHNlLFxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBbcmVjZW50U2VhcmNoZXMsIHNldFJlY2VudFNlYXJjaGVzXSA9IHVzZVN0YXRlPHN0cmluZ1tdPihbXSk7XHJcblxyXG4gIC8vIFNpbmNyb25pemFyIHJlZmVyZW5jaWEgY29uIGVzdGFkbyBwYXJhIGV2aXRhciBkZXBlbmRlbmNpYXMgZW4gdXNlQ2FsbGJhY2tcclxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgcmVjZW50U2VhcmNoZXNSZWYuY3VycmVudCA9IHJlY2VudFNlYXJjaGVzO1xyXG4gIH0sIFtyZWNlbnRTZWFyY2hlc10pO1xyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gIC8vIEZVTkNJT05FUyBBVVhJTElBUkVTIFNJTVBMSUZJQ0FEQVNcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gIC8vIEZVTkNJT05FUyBQUklOQ0lQQUxFUyBDT04gVVNFLURFQk9VTkNFXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgLyoqXHJcbiAgICogRnVuY2nDs24gZGUgYsO6c3F1ZWRhIGludGVybmEgb3B0aW1pemFkYVxyXG4gICAqL1xyXG4gIGNvbnN0IHBlcmZvcm1TZWFyY2ggPSB1c2VDYWxsYmFjayhhc3luYyAoc2VhcmNoUXVlcnk6IHN0cmluZykgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ/CflI0gdXNlU2VhcmNoOiBwZXJmb3JtU2VhcmNoIGVqZWN1dGFuZG8gcGFyYTonLCBzZWFyY2hRdWVyeSk7XHJcblxyXG4gICAgLy8gTGltcGlhciB0aW1lb3V0IGRlIHNlZ3VyaWRhZCBhbnRlcmlvclxyXG4gICAgaWYgKHNhZmV0eVRpbWVvdXRSZWYuY3VycmVudCkge1xyXG4gICAgICBjbGVhclRpbWVvdXQoc2FmZXR5VGltZW91dFJlZi5jdXJyZW50KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTaSBsYSBxdWVyeSBlc3TDoSB2YWPDrWEsIG1vc3RyYXIgc3VnZXJlbmNpYXMgcG9yIGRlZmVjdG9cclxuICAgIGlmICghc2VhcmNoUXVlcnkudHJpbSgpKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIHVzZVNlYXJjaDogUXVlcnkgdmFjw61hLCBtb3N0cmFuZG8gc3VnZXJlbmNpYXMgcG9yIGRlZmVjdG8nKTtcclxuICAgICAgY29uc3QgZGVmYXVsdFN1Z2dlc3Rpb25zID0gW1xyXG4gICAgICAgIC4uLmRlZmF1bHRUcmVuZGluZ1NlYXJjaGVzLnNsaWNlKDAsIDQpLFxyXG4gICAgICAgIC4uLnJlY2VudFNlYXJjaGVzUmVmLmN1cnJlbnQuc2xpY2UoMCwgMykubWFwKChzZWFyY2gsIGluZGV4KSA9PiAoe1xyXG4gICAgICAgICAgaWQ6IGByZWNlbnQtJHtpbmRleH1gLFxyXG4gICAgICAgICAgdHlwZTogJ3JlY2VudCcgYXMgY29uc3QsXHJcbiAgICAgICAgICB0aXRsZTogc2VhcmNoLFxyXG4gICAgICAgICAgaHJlZjogYC9zZWFyY2g/cT0ke2VuY29kZVVSSUNvbXBvbmVudChzZWFyY2gpfWAsXHJcbiAgICAgICAgfSkpXHJcbiAgICAgIF0uc2xpY2UoMCwgbWF4U3VnZ2VzdGlvbnMpO1xyXG5cclxuICAgICAgc2V0U3RhdGUocHJldiA9PiAoe1xyXG4gICAgICAgIC4uLnByZXYsXHJcbiAgICAgICAgcXVlcnk6IHNlYXJjaFF1ZXJ5LFxyXG4gICAgICAgIHN1Z2dlc3Rpb25zOiBkZWZhdWx0U3VnZ2VzdGlvbnMsXHJcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcclxuICAgICAgfSkpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVGltZW91dCBkZSBzZWd1cmlkYWQgcGFyYSBldml0YXIgbG9hZGluZyBwZXJtYW5lbnRlICg1IHNlZ3VuZG9zKVxyXG4gICAgc2FmZXR5VGltZW91dFJlZi5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfimqDvuI8gdXNlU2VhcmNoOiBUaW1lb3V0IGRlIHNlZ3VyaWRhZCBhY3RpdmFkbyAtIHJlc2V0ZWFuZG8gbG9hZGluZyBzdGF0ZScpO1xyXG4gICAgICBzZXRTdGF0ZShwcmV2ID0+ICh7XHJcbiAgICAgICAgLi4ucHJldixcclxuICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnVGllbXBvIGRlIGVzcGVyYSBhZ290YWRvLiBJbnRlbnRhIG51ZXZhbWVudGUuJyxcclxuICAgICAgfSkpO1xyXG4gICAgfSwgNTAwMCk7XHJcblxyXG4gICAgLy8gRWplY3V0YXIgYsO6c3F1ZWRhIGRpcmVjdGFtZW50ZSAoZWwgZGVib3VuY2Ugc2UgbWFuZWphIGVuIHNlYXJjaFdpdGhEZWJvdW5jZSlcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIHVzZVNlYXJjaDogSW5pY2lhbmRvIGLDunNxdWVkYSBwYXJhOicsIHNlYXJjaFF1ZXJ5KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2VhcmNoUHJvZHVjdHMoc2VhcmNoUXVlcnksIG1heFN1Z2dlc3Rpb25zKTtcclxuICAgICAgY29uc29sZS5sb2coJ/Cfk6YgdXNlU2VhcmNoOiBSZXNwdWVzdGEgZGUgYsO6c3F1ZWRhOicsIHJlc3BvbnNlKTtcclxuXHJcbiAgICAgIC8vIExpbXBpYXIgdGltZW91dCBkZSBzZWd1cmlkYWQgeWEgcXVlIGxhIEFQSSByZXNwb25kacOzXHJcbiAgICAgIGlmIChzYWZldHlUaW1lb3V0UmVmLmN1cnJlbnQpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQoc2FmZXR5VGltZW91dFJlZi5jdXJyZW50KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgICBpZiAocmVzcG9uc2Uuc3VjY2VzcyAmJiByZXNwb25zZS5kYXRhICYmIEFycmF5LmlzQXJyYXkocmVzcG9uc2UuZGF0YSkpIHtcclxuICAgICAgICAgIGNvbnN0IHByb2R1Y3RTdWdnZXN0aW9ucyA9IHJlc3BvbnNlLmRhdGEubWFwKHByb2R1Y3QgPT4gKHtcclxuICAgICAgICAgICAgaWQ6IGBwcm9kdWN0LSR7cHJvZHVjdC5pZH1gLFxyXG4gICAgICAgICAgICB0eXBlOiAncHJvZHVjdCcgYXMgY29uc3QsXHJcbiAgICAgICAgICAgIHRpdGxlOiBwcm9kdWN0Lm5hbWUsXHJcbiAgICAgICAgICAgIHN1YnRpdGxlOiBwcm9kdWN0LmNhdGVnb3J5Py5uYW1lIHx8ICdTaW4gY2F0ZWdvcsOtYScsXHJcbiAgICAgICAgICAgIGltYWdlOiBwcm9kdWN0LmltYWdlcz8ucHJldmlld3M/LlswXSB8fCAnL2ltYWdlcy9wcm9kdWN0cy9wbGFjZWhvbGRlci5qcGcnLFxyXG4gICAgICAgICAgICBiYWRnZTogcHJvZHVjdC5zdG9jayA+IDAgPyAnRW4gc3RvY2snIDogJ1NpbiBzdG9jaycsXHJcbiAgICAgICAgICAgIGhyZWY6IGAvc2hvcC1kZXRhaWxzLyR7cHJvZHVjdC5pZH1gLFxyXG4gICAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgdXNlU2VhcmNoOiBTdWdlcmVuY2lhcyBnZW5lcmFkYXM6JywgcHJvZHVjdFN1Z2dlc3Rpb25zLmxlbmd0aCk7XHJcblxyXG4gICAgICAgICAgc2V0U3RhdGUocHJldiA9PiAoe1xyXG4gICAgICAgICAgICAuLi5wcmV2LFxyXG4gICAgICAgICAgICBxdWVyeTogc2VhcmNoUXVlcnksIC8vIEFjdHVhbGl6YXIgcXVlcnkgY3VhbmRvIGhheSByZXN1bHRhZG9zIGV4aXRvc29zXHJcbiAgICAgICAgICAgIHN1Z2dlc3Rpb25zOiBwcm9kdWN0U3VnZ2VzdGlvbnMsXHJcbiAgICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXHJcbiAgICAgICAgICAgIGVycm9yOiBudWxsLFxyXG4gICAgICAgICAgfSkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygn4pqg77iPIHVzZVNlYXJjaDogU2luIHJlc3VsdGFkb3MgbyByZXNwdWVzdGEgbm8gZXhpdG9zYScpO1xyXG4gICAgICAgICAgc2V0U3RhdGUocHJldiA9PiAoe1xyXG4gICAgICAgICAgICAuLi5wcmV2LFxyXG4gICAgICAgICAgICBxdWVyeTogc2VhcmNoUXVlcnksIC8vIEFjdHVhbGl6YXIgcXVlcnkgaW5jbHVzbyBjdWFuZG8gbm8gaGF5IHJlc3VsdGFkb3NcclxuICAgICAgICAgICAgc3VnZ2VzdGlvbnM6IFtdLFxyXG4gICAgICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxyXG4gICAgICAgICAgICBlcnJvcjogcmVzcG9uc2UuZXJyb3IgfHwgJ05vIHNlIGVuY29udHJhcm9uIHJlc3VsdGFkb3MnLFxyXG4gICAgICAgICAgfSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgdXNlU2VhcmNoOiBFcnJvciBlbiBiw7pzcXVlZGE6JywgZXJyb3IpO1xyXG5cclxuICAgICAgICAvLyBMaW1waWFyIHRpbWVvdXQgZGUgc2VndXJpZGFkXHJcbiAgICAgICAgaWYgKHNhZmV0eVRpbWVvdXRSZWYuY3VycmVudCkge1xyXG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHNhZmV0eVRpbWVvdXRSZWYuY3VycmVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXRTdGF0ZShwcmV2ID0+ICh7XHJcbiAgICAgICAgICAuLi5wcmV2LFxyXG4gICAgICAgICAgcXVlcnk6IHNlYXJjaFF1ZXJ5LCAvLyBBY3R1YWxpemFyIHF1ZXJ5IGluY2x1c28gZW4gY2FzbyBkZSBlcnJvclxyXG4gICAgICAgICAgc3VnZ2VzdGlvbnM6IFtdLFxyXG4gICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcclxuICAgICAgICAgIGVycm9yOiAnRXJyb3IgZW4gbGEgYsO6c3F1ZWRhLiBJbnRlbnRhIG51ZXZhbWVudGUuJyxcclxuICAgICAgICB9KSk7XHJcbiAgICAgIH1cclxuICB9LCBbbWF4U3VnZ2VzdGlvbnNdKTsgLy8gU29sbyBtYXhTdWdnZXN0aW9ucyBlcyBuZWNlc2FyaW8gY29tbyBkZXBlbmRlbmNpYVxyXG5cclxuICAvKipcclxuICAgKiBGdW5jacOzbiBkZSBiw7pzcXVlZGEgY29uIGRlYm91bmNlIG9wdGltaXphZG8gdXNhbmRvIHVzZS1kZWJvdW5jZVxyXG4gICAqL1xyXG4gIGNvbnN0IHNlYXJjaFdpdGhEZWJvdW5jZSA9IHVzZURlYm91bmNlZENhbGxiYWNrKFxyXG4gICAgKHNlYXJjaFF1ZXJ5OiBzdHJpbmcpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coJ/CflI0gdXNlU2VhcmNoOiBzZWFyY2hXaXRoRGVib3VuY2UgKHVzZS1kZWJvdW5jZSkgbGxhbWFkbyBjb246Jywgc2VhcmNoUXVlcnkpO1xyXG5cclxuICAgICAgLy8gQWN0dWFsaXphciBlc3RhZG8gZGUgbG9hZGluZyBpbm1lZGlhdGFtZW50ZVxyXG4gICAgICBzZXRTdGF0ZShwcmV2ID0+ICh7XHJcbiAgICAgICAgLi4ucHJldixcclxuICAgICAgICBpc0xvYWRpbmc6ICEhc2VhcmNoUXVlcnkudHJpbSgpLFxyXG4gICAgICAgIGVycm9yOiBudWxsLFxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICAvLyBFamVjdXRhciBiw7pzcXVlZGFcclxuICAgICAgcGVyZm9ybVNlYXJjaChzZWFyY2hRdWVyeSk7XHJcbiAgICB9LFxyXG4gICAgZGVib3VuY2VNcyxcclxuICAgIHtcclxuICAgICAgbWF4V2FpdDogMjAwMCxcclxuICAgICAgbGVhZGluZzogZmFsc2UsXHJcbiAgICAgIHRyYWlsaW5nOiB0cnVlLFxyXG4gICAgfVxyXG4gICk7XHJcblxyXG4gIC8qKlxyXG4gICAqIEVqZWN1dGEgdW5hIGLDunNxdWVkYSBjb21wbGV0YSB5IG5hdmVnYSBhIHJlc3VsdGFkb3NcclxuICAgKi9cclxuICBjb25zdCBleGVjdXRlU2VhcmNoID0gdXNlQ2FsbGJhY2soYXN5bmMgKHNlYXJjaFF1ZXJ5OiBzdHJpbmcsIGNhdGVnb3J5Pzogc3RyaW5nKSA9PiB7XHJcbiAgICBpZiAoIXNlYXJjaFF1ZXJ5LnRyaW0oKSkgcmV0dXJuO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIHNldFN0YXRlKHByZXYgPT4gKHsgLi4ucHJldiwgaXNMb2FkaW5nOiB0cnVlLCBlcnJvcjogbnVsbCB9KSk7XHJcblxyXG4gICAgICAvLyBHdWFyZGFyIGVuIGhpc3RvcmlhbFxyXG4gICAgICBpZiAoc2F2ZVJlY2VudFNlYXJjaGVzICYmIHNlYXJjaFF1ZXJ5LnRyaW0oKSkge1xyXG4gICAgICAgIGNvbnN0IHVwZGF0ZWQgPSBbXHJcbiAgICAgICAgICBzZWFyY2hRdWVyeS50cmltKCksXHJcbiAgICAgICAgICAuLi5yZWNlbnRTZWFyY2hlc1JlZi5jdXJyZW50LmZpbHRlcihzID0+IHMgIT09IHNlYXJjaFF1ZXJ5LnRyaW0oKSlcclxuICAgICAgICBdLnNsaWNlKDAsIDUpO1xyXG5cclxuICAgICAgICBzZXRSZWNlbnRTZWFyY2hlcyh1cGRhdGVkKTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3BpbnRleWEtcmVjZW50LXNlYXJjaGVzJywgSlNPTi5zdHJpbmdpZnkodXBkYXRlZCkpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0Vycm9yIGd1YXJkYW5kbyBiw7pzcXVlZGEgcmVjaWVudGU6JywgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gUmVhbGl6YXIgYsO6c3F1ZWRhIGNvbiBtYW5lam8gcm9idXN0byBkZSBlcnJvcmVzXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZXJyb3JIYW5kbGVyLmV4ZWN1dGVXaXRoUmV0cnkoXHJcbiAgICAgICAgKCkgPT4gc2VhcmNoUHJvZHVjdHMoc2VhcmNoUXVlcnkudHJpbSgpLCBzZWFyY2hMaW1pdCksXHJcbiAgICAgICAgYGLDunNxdWVkYSBkZSBcIiR7c2VhcmNoUXVlcnkudHJpbSgpfVwiYFxyXG4gICAgICApO1xyXG5cclxuICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MgJiYgcmVzcG9uc2UuZGF0YSkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdENvdW50ID0gcmVzcG9uc2UuZGF0YS5sZW5ndGg7XHJcblxyXG4gICAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcclxuICAgICAgICAgIC4uLnByZXYsXHJcbiAgICAgICAgICByZXN1bHRzOiByZXNwb25zZS5kYXRhIHx8IFtdLFxyXG4gICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcclxuICAgICAgICAgIGhhc1NlYXJjaGVkOiB0cnVlLFxyXG4gICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICAvLyBMaW1waWFyIGVycm9yZXMgcHJldmlvc1xyXG4gICAgICAgIGVycm9ySGFuZGxlci5jbGVhckVycm9yKCk7XHJcblxyXG4gICAgICAgIC8vIE1vc3RyYXIgdG9hc3QgZGUgw6l4aXRvIHNpIGhheSByZXN1bHRhZG9zXHJcbiAgICAgICAgaWYgKHJlc3VsdENvdW50ID4gMCkge1xyXG4gICAgICAgICAgdG9hc3RIYW5kbGVyLnNob3dTdWNjZXNzVG9hc3Qoc2VhcmNoUXVlcnkudHJpbSgpLCByZXN1bHRDb3VudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRvYXN0SGFuZGxlci5zaG93Tm9SZXN1bHRzVG9hc3Qoc2VhcmNoUXVlcnkudHJpbSgpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENhbGxiYWNrIHBlcnNvbmFsaXphZG9cclxuICAgICAgICBvcHRpb25zUmVmLmN1cnJlbnQub25TZWFyY2g/LihzZWFyY2hRdWVyeS50cmltKCksIHJlc3BvbnNlLmRhdGEgfHwgW10pO1xyXG5cclxuICAgICAgICAvLyBOYXZlZ2FyIGEgcmVzdWx0YWRvc1xyXG4gICAgICAgIGNvbnN0IHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTtcclxuICAgICAgICBzZWFyY2hQYXJhbXMuc2V0KCdxJywgc2VhcmNoUXVlcnkudHJpbSgpKTtcclxuICAgICAgICBpZiAoY2F0ZWdvcnkpIHtcclxuICAgICAgICAgIHNlYXJjaFBhcmFtcy5zZXQoJ2NhdGVnb3J5JywgY2F0ZWdvcnkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcm91dGVyLnB1c2goYC9zZWFyY2g/JHtzZWFyY2hQYXJhbXMudG9TdHJpbmcoKX1gKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSByZXNwb25zZS5lcnJvciB8fCAnTm8gc2UgZW5jb250cmFyb24gcmVzdWx0YWRvcyc7XHJcblxyXG4gICAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcclxuICAgICAgICAgIC4uLnByZXYsXHJcbiAgICAgICAgICByZXN1bHRzOiBbXSxcclxuICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXHJcbiAgICAgICAgICBoYXNTZWFyY2hlZDogdHJ1ZSxcclxuICAgICAgICAgIGVycm9yOiBlcnJvck1lc3NhZ2UsXHJcbiAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICAvLyBNb3N0cmFyIHRvYXN0IGRlIGFkdmVydGVuY2lhIHBhcmEgcmVzcHVlc3RhcyBzaW4gw6l4aXRvXHJcbiAgICAgICAgdG9hc3RIYW5kbGVyLnNob3dXYXJuaW5nVG9hc3QoJ0LDunNxdWVkYSBzaW4gcmVzdWx0YWRvcycsIGVycm9yTWVzc2FnZSk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBlamVjdXRhbmRvIGLDunNxdWVkYTonLCBlcnJvcik7XHJcblxyXG4gICAgICAvLyBNYW5lamFyIGVycm9yIGNvbiBlbCBlcnJvciBoYW5kbGVyXHJcbiAgICAgIGNvbnN0IHNlYXJjaEVycm9yID0gZXJyb3JIYW5kbGVyLmhhbmRsZUVycm9yKGVycm9yKTtcclxuXHJcbiAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcclxuICAgICAgICAuLi5wcmV2LFxyXG4gICAgICAgIHJlc3VsdHM6IFtdLFxyXG4gICAgICAgIGlzTG9hZGluZzogZmFsc2UsXHJcbiAgICAgICAgaGFzU2VhcmNoZWQ6IHRydWUsXHJcbiAgICAgICAgZXJyb3I6IHNlYXJjaEVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIC8vIE1vc3RyYXIgdG9hc3QgZGUgZXJyb3JcclxuICAgICAgdG9hc3RIYW5kbGVyLnNob3dFcnJvclRvYXN0KHNlYXJjaEVycm9yLCBlcnJvckhhbmRsZXIucmV0cnlDb3VudCwgKCkgPT4ge1xyXG4gICAgICAgIGV4ZWN1dGVTZWFyY2goc2VhcmNoUXVlcnkudHJpbSgpLCBjYXRlZ29yeSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0sIFtzZWFyY2hMaW1pdCwgc2F2ZVJlY2VudFNlYXJjaGVzLCByb3V0ZXIsIGVycm9ySGFuZGxlciwgdG9hc3RIYW5kbGVyXSk7IC8vIFJlbW92ZXIgcmVjZW50U2VhcmNoZXMgZGUgZGVwZW5kZW5jaWFzIHBhcmEgZXZpdGFyIGJ1Y2xlIGluZmluaXRvXHJcblxyXG4gIC8qKlxyXG4gICAqIE1hbmVqYSBsYSBzZWxlY2Npw7NuIGRlIHVuYSBzdWdlcmVuY2lhXHJcbiAgICovXHJcbiAgY29uc3Qgc2VsZWN0U3VnZ2VzdGlvbiA9IHVzZUNhbGxiYWNrKChzdWdnZXN0aW9uOiBTZWFyY2hTdWdnZXN0aW9uKSA9PiB7XHJcbiAgICAvLyBHdWFyZGFyIGVuIGhpc3RvcmlhbCBzaSBlcyBwcm9kdWN0byBvIGNhdGVnb3LDrWFcclxuICAgIGlmICgoc3VnZ2VzdGlvbi50eXBlID09PSAncHJvZHVjdCcgfHwgc3VnZ2VzdGlvbi50eXBlID09PSAnY2F0ZWdvcnknKSAmJiBzYXZlUmVjZW50U2VhcmNoZXMpIHtcclxuICAgICAgY29uc3QgdXBkYXRlZCA9IFtcclxuICAgICAgICBzdWdnZXN0aW9uLnRpdGxlLFxyXG4gICAgICAgIC4uLnJlY2VudFNlYXJjaGVzUmVmLmN1cnJlbnQuZmlsdGVyKHMgPT4gcyAhPT0gc3VnZ2VzdGlvbi50aXRsZSlcclxuICAgICAgXS5zbGljZSgwLCA1KTtcclxuXHJcbiAgICAgIHNldFJlY2VudFNlYXJjaGVzKHVwZGF0ZWQpO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwaW50ZXlhLXJlY2VudC1zZWFyY2hlcycsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWQpKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ0Vycm9yIGd1YXJkYW5kbyBiw7pzcXVlZGEgcmVjaWVudGU6JywgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWN0dWFsaXphciBlc3RhZG9cclxuICAgIHNldFN0YXRlKHByZXYgPT4gKHtcclxuICAgICAgLi4ucHJldixcclxuICAgICAgcXVlcnk6IHN1Z2dlc3Rpb24udGl0bGUsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgLy8gQ2FsbGJhY2sgcGVyc29uYWxpemFkb1xyXG4gICAgb3B0aW9uc1JlZi5jdXJyZW50Lm9uU3VnZ2VzdGlvblNlbGVjdD8uKHN1Z2dlc3Rpb24pO1xyXG5cclxuICAgIC8vIE5hdmVnYXJcclxuICAgIHJvdXRlci5wdXNoKHN1Z2dlc3Rpb24uaHJlZik7XHJcbiAgfSwgW3NhdmVSZWNlbnRTZWFyY2hlcywgcm91dGVyXSk7IC8vIFJlbW92ZXIgcmVjZW50U2VhcmNoZXMgZGUgZGVwZW5kZW5jaWFzIHBhcmEgZXZpdGFyIGJ1Y2xlIGluZmluaXRvXHJcblxyXG4gIC8qKlxyXG4gICAqIExpbXBpYSBlbCBlc3RhZG8gZGUgYsO6c3F1ZWRhXHJcbiAgICovXHJcbiAgY29uc3QgY2xlYXJTZWFyY2ggPSB1c2VDYWxsYmFjaygoKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygn8J+nuSB1c2VTZWFyY2g6IGNsZWFyU2VhcmNoIGxsYW1hZG8nKTtcclxuXHJcbiAgICAvLyBMaW1waWFyIHRvZG9zIGxvcyB0aW1lb3V0c1xyXG4gICAgaWYgKGRlYm91bmNlUmVmLmN1cnJlbnQpIHtcclxuICAgICAgY2xlYXJUaW1lb3V0KGRlYm91bmNlUmVmLmN1cnJlbnQpO1xyXG4gICAgfVxyXG4gICAgaWYgKHNhZmV0eVRpbWVvdXRSZWYuY3VycmVudCkge1xyXG4gICAgICBjbGVhclRpbWVvdXQoc2FmZXR5VGltZW91dFJlZi5jdXJyZW50KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZXNldGVhciBlc3RhZG8gY29tcGxldGFtZW50ZSAoc2luIHN1Z2VyZW5jaWFzIHBvciBkZWZlY3RvIHBhcmEgdGVzdHMpXHJcbiAgICBzZXRTdGF0ZSh7XHJcbiAgICAgIHF1ZXJ5OiAnJyxcclxuICAgICAgcmVzdWx0czogW10sXHJcbiAgICAgIHN1Z2dlc3Rpb25zOiBbXSxcclxuICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgIGhhc1NlYXJjaGVkOiBmYWxzZSxcclxuICAgIH0pO1xyXG4gIH0sIFtdKTsgLy8gUmVtb3ZlciBkZXBlbmRlbmNpYSBjaXJjdWxhclxyXG5cclxuICAvKipcclxuICAgKiBJbmljaWFsaXphIGVsIGhvb2sgKGNhcmdhciBiw7pzcXVlZGFzIHJlY2llbnRlcylcclxuICAgKi9cclxuICBjb25zdCBpbml0aWFsaXplID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xyXG4gICAgaWYgKHNhdmVSZWNlbnRTZWFyY2hlcykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHN0b3JlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwaW50ZXlhLXJlY2VudC1zZWFyY2hlcycpO1xyXG4gICAgICAgIGlmIChzdG9yZWQgJiYgc3RvcmVkLnRyaW0oKSAhPT0gJycgJiYgc3RvcmVkICE9PSAnXCJcIicgJiYgc3RvcmVkICE9PSBcIicnXCIpIHtcclxuICAgICAgICAgIC8vIFZhbGlkYXIgcXVlIG5vIGVzdMOpIGNvcnJ1cHRvXHJcbiAgICAgICAgICBpZiAoc3RvcmVkLmluY2x1ZGVzKCdcIlwiJykgJiYgc3RvcmVkLmxlbmd0aCA8IDUpIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKCdEZXRlY3RlZCBjb3JydXB0ZWQgcmVjZW50IHNlYXJjaGVzIGRhdGEsIGNsZWFuaW5nIHVwJyk7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdwaW50ZXlhLXJlY2VudC1zZWFyY2hlcycpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShzdG9yZWQpO1xyXG4gICAgICAgICAgLy8gVmVyaWZpY2FyIHF1ZSBzZWEgdW4gYXJyYXkgdsOhbGlkb1xyXG4gICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyc2VkKSkge1xyXG4gICAgICAgICAgICBzZXRSZWNlbnRTZWFyY2hlcyhwYXJzZWQpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKCdJbnZhbGlkIHJlY2VudCBzZWFyY2hlcyBmb3JtYXQsIHJlc2V0dGluZycpO1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncGludGV5YS1yZWNlbnQtc2VhcmNoZXMnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKCdFcnJvciBjYXJnYW5kbyBiw7pzcXVlZGFzIHJlY2llbnRlczonLCBlcnJvcik7XHJcbiAgICAgICAgLy8gTGltcGlhciBkYXRvcyBjb3JydXB0b3NcclxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncGludGV5YS1yZWNlbnQtc2VhcmNoZXMnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0sIFtzYXZlUmVjZW50U2VhcmNoZXNdKTtcclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBDTEVBTlVQXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgY29uc3QgY2xlYW51cCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcclxuICAgIC8vIENhbmNlbGFyIGRlYm91bmNlIGRlIHVzZS1kZWJvdW5jZVxyXG4gICAgc2VhcmNoV2l0aERlYm91bmNlLmNhbmNlbCgpO1xyXG5cclxuICAgIC8vIExpbXBpYXIgdGltZW91dHMgbWFudWFsZXMgcmVzdGFudGVzXHJcbiAgICBpZiAoZGVib3VuY2VSZWYuY3VycmVudCkge1xyXG4gICAgICBjbGVhclRpbWVvdXQoZGVib3VuY2VSZWYuY3VycmVudCk7XHJcbiAgICB9XHJcbiAgICBpZiAoc2FmZXR5VGltZW91dFJlZi5jdXJyZW50KSB7XHJcbiAgICAgIGNsZWFyVGltZW91dChzYWZldHlUaW1lb3V0UmVmLmN1cnJlbnQpO1xyXG4gICAgfVxyXG4gIH0sIFtzZWFyY2hXaXRoRGVib3VuY2VdKTtcclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBSRVRVUk5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgLy8gRXN0YWRvXHJcbiAgICAuLi5zdGF0ZSxcclxuICAgIHJlY2VudFNlYXJjaGVzLFxyXG5cclxuICAgIC8vIEVzdGFkbyBkZSBlcnJvcmVzIHkgdG9hc3RzXHJcbiAgICBzZWFyY2hFcnJvcjogZXJyb3JIYW5kbGVyLmN1cnJlbnRFcnJvcixcclxuICAgIGlzUmV0cnlpbmc6IGVycm9ySGFuZGxlci5pc1JldHJ5aW5nLFxyXG4gICAgcmV0cnlDb3VudDogZXJyb3JIYW5kbGVyLnJldHJ5Q291bnQsXHJcbiAgICB0b2FzdHM6IHRvYXN0SGFuZGxlci50b2FzdHMsXHJcblxyXG4gICAgLy8gRnVuY2lvbmVzIHByaW5jaXBhbGVzXHJcbiAgICBzZWFyY2hXaXRoRGVib3VuY2UsXHJcbiAgICBleGVjdXRlU2VhcmNoLFxyXG4gICAgc2VsZWN0U3VnZ2VzdGlvbixcclxuICAgIGNsZWFyU2VhcmNoLFxyXG4gICAgaW5pdGlhbGl6ZSxcclxuICAgIGNsZWFudXAsXHJcblxyXG4gICAgLy8gRnVuY2lvbmVzIGRlIG1hbmVqbyBkZSBlcnJvcmVzXHJcbiAgICBjbGVhckVycm9yOiBlcnJvckhhbmRsZXIuY2xlYXJFcnJvcixcclxuICAgIHJldHJ5TWFudWFsbHk6IGVycm9ySGFuZGxlci5yZXRyeU1hbnVhbGx5LFxyXG5cclxuICAgIC8vIEZ1bmNpb25lcyBkZSB0b2FzdFxyXG4gICAgcmVtb3ZlVG9hc3Q6IHRvYXN0SGFuZGxlci5yZW1vdmVUb2FzdCxcclxuICAgIGNsZWFyVG9hc3RzOiB0b2FzdEhhbmRsZXIuY2xlYXJUb2FzdHMsXHJcbiAgfTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlU2VhcmNoO1xyXG4iXSwibmFtZXMiOlsidXNlU2VhcmNoIiwiZGVmYXVsdFRyZW5kaW5nU2VhcmNoZXMiLCJpZCIsInR5cGUiLCJ0aXRsZSIsImhyZWYiLCJvcHRpb25zIiwiZGVib3VuY2VNcyIsIm1heFN1Z2dlc3Rpb25zIiwic2VhcmNoTGltaXQiLCJzYXZlUmVjZW50U2VhcmNoZXMiLCJvblNlYXJjaCIsIm9uU3VnZ2VzdGlvblNlbGVjdCIsInJvdXRlciIsInVzZVJvdXRlciIsImRlYm91bmNlUmVmIiwidXNlUmVmIiwic2FmZXR5VGltZW91dFJlZiIsIm9wdGlvbnNSZWYiLCJyZWNlbnRTZWFyY2hlc1JlZiIsImVycm9ySGFuZGxlciIsInVzZVNlYXJjaEVycm9ySGFuZGxlciIsIm9uRXJyb3IiLCJlcnJvciIsImNvbnNvbGUiLCJvblJldHJ5U3VjY2VzcyIsInRvYXN0SGFuZGxlciIsInNob3dSZXRyeVN1Y2Nlc3NUb2FzdCIsIm9uUmV0cnlGYWlsZWQiLCJhdHRlbXB0cyIsInNob3dSZXRyeUZhaWxlZFRvYXN0IiwidXNlU2VhcmNoVG9hc3QiLCJkZWZhdWx0RHVyYXRpb24iLCJtYXhUb2FzdHMiLCJjdXJyZW50Iiwic3RhdGUiLCJzZXRTdGF0ZSIsInVzZVN0YXRlIiwicXVlcnkiLCJyZXN1bHRzIiwic3VnZ2VzdGlvbnMiLCJpc0xvYWRpbmciLCJoYXNTZWFyY2hlZCIsInJlY2VudFNlYXJjaGVzIiwic2V0UmVjZW50U2VhcmNoZXMiLCJSZWFjdCIsInVzZUVmZmVjdCIsInBlcmZvcm1TZWFyY2giLCJ1c2VDYWxsYmFjayIsInNlYXJjaFF1ZXJ5IiwibG9nIiwiY2xlYXJUaW1lb3V0IiwidHJpbSIsImRlZmF1bHRTdWdnZXN0aW9ucyIsInNsaWNlIiwibWFwIiwic2VhcmNoIiwiaW5kZXgiLCJlbmNvZGVVUklDb21wb25lbnQiLCJwcmV2Iiwic2V0VGltZW91dCIsInJlc3BvbnNlIiwic2VhcmNoUHJvZHVjdHMiLCJzdWNjZXNzIiwiZGF0YSIsIkFycmF5IiwiaXNBcnJheSIsInByb2R1Y3RTdWdnZXN0aW9ucyIsInByb2R1Y3QiLCJuYW1lIiwic3VidGl0bGUiLCJjYXRlZ29yeSIsImltYWdlIiwiaW1hZ2VzIiwicHJldmlld3MiLCJiYWRnZSIsInN0b2NrIiwibGVuZ3RoIiwic2VhcmNoV2l0aERlYm91bmNlIiwidXNlRGVib3VuY2VkQ2FsbGJhY2siLCJtYXhXYWl0IiwibGVhZGluZyIsInRyYWlsaW5nIiwiZXhlY3V0ZVNlYXJjaCIsInVwZGF0ZWQiLCJmaWx0ZXIiLCJzIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ3YXJuIiwiZXhlY3V0ZVdpdGhSZXRyeSIsInJlc3VsdENvdW50IiwiY2xlYXJFcnJvciIsInNob3dTdWNjZXNzVG9hc3QiLCJzaG93Tm9SZXN1bHRzVG9hc3QiLCJzZWFyY2hQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJzZXQiLCJwdXNoIiwidG9TdHJpbmciLCJlcnJvck1lc3NhZ2UiLCJzaG93V2FybmluZ1RvYXN0Iiwic2VhcmNoRXJyb3IiLCJoYW5kbGVFcnJvciIsIm1lc3NhZ2UiLCJzaG93RXJyb3JUb2FzdCIsInJldHJ5Q291bnQiLCJzZWxlY3RTdWdnZXN0aW9uIiwic3VnZ2VzdGlvbiIsImNsZWFyU2VhcmNoIiwiaW5pdGlhbGl6ZSIsInN0b3JlZCIsImdldEl0ZW0iLCJpbmNsdWRlcyIsInJlbW92ZUl0ZW0iLCJwYXJzZWQiLCJwYXJzZSIsImNsZWFudXAiLCJjYW5jZWwiLCJjdXJyZW50RXJyb3IiLCJpc1JldHJ5aW5nIiwidG9hc3RzIiwicmV0cnlNYW51YWxseSIsInJlbW92ZVRvYXN0IiwiY2xlYXJUb2FzdHMiXSwibWFwcGlu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