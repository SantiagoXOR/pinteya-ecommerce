04e6a22d327250ad6d81555634f8e427
// ===================================
// HOOK: useRecentSearches - Gestión de búsquedas recientes con localStorage
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    default: function() {
        return _default;
    },
    useRecentSearches: function() {
        return useRecentSearches;
    },
    useRecentSearchesSimple: function() {
        return useRecentSearchesSimple;
    }
});
const _react = require("react");
const _jsonutils = require("../lib/json-utils");
const DEFAULT_OPTIONS = {
    maxSearches: 5,
    storageKey: 'pinteya-recent-searches',
    enablePersistence: true,
    filterDuplicates: true,
    expirationDays: 30
};
function useRecentSearches(options = {}) {
    const config = {
        ...DEFAULT_OPTIONS,
        ...options
    };
    const [recentSearches, setRecentSearches] = (0, _react.useState)([]);
    // Función para validar y limpiar una búsqueda
    const sanitizeSearch = (0, _react.useCallback)((search)=>{
        return search.trim().toLowerCase();
    }, []);
    // Función para verificar si los datos han expirado
    const isExpired = (0, _react.useCallback)((timestamp)=>{
        if (config.expirationDays === 0) return false;
        const maxAge = config.expirationDays * 24 * 60 * 60 * 1000;
        return Date.now() - timestamp > maxAge;
    }, [
        config.expirationDays
    ]);
    // Cargar búsquedas desde localStorage
    const loadFromStorage = (0, _react.useCallback)(()=>{
        if (!config.enablePersistence) {
            return [];
        }
        // Usar utilidad segura para cargar desde localStorage
        const result = (0, _jsonutils.safeLocalStorageGet)(config.storageKey);
        if (!result.success) {
            return [];
        }
        const data = result.data;
        // Verificar si es formato nuevo (con metadata)
        if (data && typeof data === 'object' && 'searches' in data && Array.isArray(data.searches)) {
            const persistedData = data;
            // Verificar expiración
            if (persistedData.timestamp && isExpired(persistedData.timestamp)) {
                // Limpiar datos expirados usando utilidad segura
                (0, _jsonutils.safeLocalStorageSet)(config.storageKey, {
                    searches: [],
                    timestamp: Date.now(),
                    version: '1.0'
                });
                return [];
            }
            return persistedData.searches.slice(0, config.maxSearches);
        }
        // Formato antiguo (array simple)
        if (Array.isArray(data)) {
            return data.slice(0, config.maxSearches);
        }
        return [];
    }, [
        config.enablePersistence,
        config.storageKey,
        config.maxSearches,
        isExpired
    ]);
    // Guardar búsquedas en localStorage
    const saveToStorage = (0, _react.useCallback)((searches)=>{
        if (!config.enablePersistence || typeof window === 'undefined') {
            return;
        }
        try {
            if (searches.length === 0) {
                localStorage.removeItem(config.storageKey);
                return;
            }
            const dataToStore = {
                searches: searches.slice(0, config.maxSearches),
                timestamp: Date.now(),
                version: '1.0.0'
            };
            localStorage.setItem(config.storageKey, JSON.stringify(dataToStore));
        } catch (error) {
            console.warn('Error saving recent searches to localStorage:', error);
        }
    }, [
        config.enablePersistence,
        config.storageKey,
        config.maxSearches
    ]);
    // Cargar búsquedas al inicializar
    (0, _react.useEffect)(()=>{
        const loaded = loadFromStorage();
        setRecentSearches(loaded);
    }, [
        loadFromStorage
    ]);
    // Agregar una nueva búsqueda
    const addSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        if (!sanitized || sanitized.length < 2) return;
        setRecentSearches((prev)=>{
            let updated = [
                ...prev
            ];
            // Remover duplicados si está habilitado
            if (config.filterDuplicates) {
                updated = updated.filter((s)=>sanitizeSearch(s) !== sanitized);
            }
            // Agregar al principio
            updated.unshift(search.trim());
            // Limitar al máximo configurado
            updated = updated.slice(0, config.maxSearches);
            // Guardar en localStorage
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        config.filterDuplicates,
        config.maxSearches,
        saveToStorage
    ]);
    // Remover una búsqueda específica
    const removeSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        setRecentSearches((prev)=>{
            const updated = prev.filter((s)=>sanitizeSearch(s) !== sanitized);
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        saveToStorage
    ]);
    // Limpiar todas las búsquedas
    const clearSearches = (0, _react.useCallback)(()=>{
        setRecentSearches([]);
        saveToStorage([]);
    }, [
        saveToStorage
    ]);
    // Verificar si una búsqueda existe
    const hasSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        return recentSearches.some((s)=>sanitizeSearch(s) === sanitized);
    }, [
        recentSearches,
        sanitizeSearch
    ]);
    // Obtener las N búsquedas más recientes
    const getRecentSearches = (0, _react.useCallback)((limit)=>{
        const actualLimit = limit ?? config.maxSearches;
        return recentSearches.slice(0, actualLimit);
    }, [
        recentSearches,
        config.maxSearches
    ]);
    // Mover una búsqueda al principio (reordenar)
    const moveToTop = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        setRecentSearches((prev)=>{
            const filtered = prev.filter((s)=>sanitizeSearch(s) !== sanitized);
            const existing = prev.find((s)=>sanitizeSearch(s) === sanitized);
            if (!existing) return prev;
            const updated = [
                existing,
                ...filtered
            ];
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        saveToStorage
    ]);
    return {
        recentSearches,
        addSearch,
        removeSearch,
        clearSearches,
        hasSearch,
        getRecentSearches,
        moveToTop
    };
}
function useRecentSearchesSimple(limit = 5) {
    const { getRecentSearches } = useRecentSearches({
        maxSearches: limit
    });
    return getRecentSearches();
}
const _default = useRecentSearches;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZVJlY2VudFNlYXJjaGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIT09LOiB1c2VSZWNlbnRTZWFyY2hlcyAtIEdlc3Rpw7NuIGRlIGLDunNxdWVkYXMgcmVjaWVudGVzIGNvbiBsb2NhbFN0b3JhZ2Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgc2FmZUxvY2FsU3RvcmFnZUdldCwgc2FmZUxvY2FsU3RvcmFnZVNldCwgU1RPUkFHRV9LRVlTIH0gZnJvbSAnQC9saWIvanNvbi11dGlscyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZW50U2VhcmNoZXNPcHRpb25zIHtcbiAgLyoqIE7Dum1lcm8gbcOheGltbyBkZSBiw7pzcXVlZGFzIHJlY2llbnRlcyBhIG1hbnRlbmVyICovXG4gIG1heFNlYXJjaGVzPzogbnVtYmVyO1xuICAvKiogQ2xhdmUgZGUgbG9jYWxTdG9yYWdlIHBhcmEgcGVyc2lzdGlyIGxhcyBiw7pzcXVlZGFzICovXG4gIHN0b3JhZ2VLZXk/OiBzdHJpbmc7XG4gIC8qKiBIYWJpbGl0YXIvZGVzaGFiaWxpdGFyIHBlcnNpc3RlbmNpYSBlbiBsb2NhbFN0b3JhZ2UgKi9cbiAgZW5hYmxlUGVyc2lzdGVuY2U/OiBib29sZWFuO1xuICAvKiogRmlsdHJhciBiw7pzcXVlZGFzIGR1cGxpY2FkYXMgKi9cbiAgZmlsdGVyRHVwbGljYXRlcz86IGJvb2xlYW47XG4gIC8qKiBUaWVtcG8gZGUgZXhwaXJhY2nDs24gZW4gZMOtYXMgKDAgPSBzaW4gZXhwaXJhY2nDs24pICovXG4gIGV4cGlyYXRpb25EYXlzPzogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlY2VudFNlYXJjaGVzUmV0dXJuIHtcbiAgLyoqIEFycmF5IGRlIGLDunNxdWVkYXMgcmVjaWVudGVzICovXG4gIHJlY2VudFNlYXJjaGVzOiBzdHJpbmdbXTtcbiAgLyoqIEFncmVnYXIgdW5hIG51ZXZhIGLDunNxdWVkYSAqL1xuICBhZGRTZWFyY2g6IChzZWFyY2g6IHN0cmluZykgPT4gdm9pZDtcbiAgLyoqIFJlbW92ZXIgdW5hIGLDunNxdWVkYSBlc3BlY8OtZmljYSAqL1xuICByZW1vdmVTZWFyY2g6IChzZWFyY2g6IHN0cmluZykgPT4gdm9pZDtcbiAgLyoqIExpbXBpYXIgdG9kYXMgbGFzIGLDunNxdWVkYXMgKi9cbiAgY2xlYXJTZWFyY2hlczogKCkgPT4gdm9pZDtcbiAgLyoqIFZlcmlmaWNhciBzaSB1bmEgYsO6c3F1ZWRhIGV4aXN0ZSAqL1xuICBoYXNTZWFyY2g6IChzZWFyY2g6IHN0cmluZykgPT4gYm9vbGVhbjtcbiAgLyoqIE9idGVuZXIgbGFzIE4gYsO6c3F1ZWRhcyBtw6FzIHJlY2llbnRlcyAqL1xuICBnZXRSZWNlbnRTZWFyY2hlczogKGxpbWl0PzogbnVtYmVyKSA9PiBzdHJpbmdbXTtcbiAgLyoqIFJlb3JkZW5hciBiw7pzcXVlZGFzIChtb3ZlciBhbCBwcmluY2lwaW8pICovXG4gIG1vdmVUb1RvcDogKHNlYXJjaDogc3RyaW5nKSA9PiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgUGVyc2lzdGVkU2VhcmNoRGF0YSB7XG4gIHNlYXJjaGVzOiBzdHJpbmdbXTtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIHZlcnNpb246IHN0cmluZztcbn1cblxuY29uc3QgREVGQVVMVF9PUFRJT05TOiBSZXF1aXJlZDxSZWNlbnRTZWFyY2hlc09wdGlvbnM+ID0ge1xuICBtYXhTZWFyY2hlczogNSxcbiAgc3RvcmFnZUtleTogJ3BpbnRleWEtcmVjZW50LXNlYXJjaGVzJyxcbiAgZW5hYmxlUGVyc2lzdGVuY2U6IHRydWUsXG4gIGZpbHRlckR1cGxpY2F0ZXM6IHRydWUsXG4gIGV4cGlyYXRpb25EYXlzOiAzMCwgLy8gMzAgZMOtYXMgZGUgZXhwaXJhY2nDs25cbn07XG5cbi8qKlxuICogSG9vayBwYXJhIGdlc3Rpb25hciBiw7pzcXVlZGFzIHJlY2llbnRlcyBjb24gcGVyc2lzdGVuY2lhIGVuIGxvY2FsU3RvcmFnZVxuICogXG4gKiBDYXJhY3RlcsOtc3RpY2FzOlxuICogLSBQZXJzaXN0ZW5jaWEgYXV0b23DoXRpY2EgZW4gbG9jYWxTdG9yYWdlXG4gKiAtIEzDrW1pdGUgY29uZmlndXJhYmxlIGRlIGLDunNxdWVkYXNcbiAqIC0gRmlsdHJhZG8gZGUgZHVwbGljYWRvc1xuICogLSBFeHBpcmFjacOzbiBhdXRvbcOhdGljYVxuICogLSBNYW5lam8gZGUgZXJyb3JlcyByb2J1c3RvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VSZWNlbnRTZWFyY2hlcyhvcHRpb25zOiBSZWNlbnRTZWFyY2hlc09wdGlvbnMgPSB7fSk6IFJlY2VudFNlYXJjaGVzUmV0dXJuIHtcbiAgY29uc3QgY29uZmlnID0geyAuLi5ERUZBVUxUX09QVElPTlMsIC4uLm9wdGlvbnMgfTtcbiAgY29uc3QgW3JlY2VudFNlYXJjaGVzLCBzZXRSZWNlbnRTZWFyY2hlc10gPSB1c2VTdGF0ZTxzdHJpbmdbXT4oW10pO1xuXG4gIC8vIEZ1bmNpw7NuIHBhcmEgdmFsaWRhciB5IGxpbXBpYXIgdW5hIGLDunNxdWVkYVxuICBjb25zdCBzYW5pdGl6ZVNlYXJjaCA9IHVzZUNhbGxiYWNrKChzZWFyY2g6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgcmV0dXJuIHNlYXJjaC50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgfSwgW10pO1xuXG4gIC8vIEZ1bmNpw7NuIHBhcmEgdmVyaWZpY2FyIHNpIGxvcyBkYXRvcyBoYW4gZXhwaXJhZG9cbiAgY29uc3QgaXNFeHBpcmVkID0gdXNlQ2FsbGJhY2soKHRpbWVzdGFtcDogbnVtYmVyKTogYm9vbGVhbiA9PiB7XG4gICAgaWYgKGNvbmZpZy5leHBpcmF0aW9uRGF5cyA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IG1heEFnZSA9IGNvbmZpZy5leHBpcmF0aW9uRGF5cyAqIDI0ICogNjAgKiA2MCAqIDEwMDA7XG4gICAgcmV0dXJuIERhdGUubm93KCkgLSB0aW1lc3RhbXAgPiBtYXhBZ2U7XG4gIH0sIFtjb25maWcuZXhwaXJhdGlvbkRheXNdKTtcblxuICAvLyBDYXJnYXIgYsO6c3F1ZWRhcyBkZXNkZSBsb2NhbFN0b3JhZ2VcbiAgY29uc3QgbG9hZEZyb21TdG9yYWdlID0gdXNlQ2FsbGJhY2soKCk6IHN0cmluZ1tdID0+IHtcbiAgICBpZiAoIWNvbmZpZy5lbmFibGVQZXJzaXN0ZW5jZSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIC8vIFVzYXIgdXRpbGlkYWQgc2VndXJhIHBhcmEgY2FyZ2FyIGRlc2RlIGxvY2FsU3RvcmFnZVxuICAgIGNvbnN0IHJlc3VsdCA9IHNhZmVMb2NhbFN0b3JhZ2VHZXQ8UGVyc2lzdGVkU2VhcmNoRGF0YSB8IHN0cmluZ1tdPihjb25maWcuc3RvcmFnZUtleSk7XG5cbiAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IHJlc3VsdC5kYXRhO1xuXG4gICAgLy8gVmVyaWZpY2FyIHNpIGVzIGZvcm1hdG8gbnVldm8gKGNvbiBtZXRhZGF0YSlcbiAgICBpZiAoZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgJ3NlYXJjaGVzJyBpbiBkYXRhICYmIEFycmF5LmlzQXJyYXkoZGF0YS5zZWFyY2hlcykpIHtcbiAgICAgIGNvbnN0IHBlcnNpc3RlZERhdGEgPSBkYXRhIGFzIFBlcnNpc3RlZFNlYXJjaERhdGE7XG5cbiAgICAgIC8vIFZlcmlmaWNhciBleHBpcmFjacOzblxuICAgICAgaWYgKHBlcnNpc3RlZERhdGEudGltZXN0YW1wICYmIGlzRXhwaXJlZChwZXJzaXN0ZWREYXRhLnRpbWVzdGFtcCkpIHtcbiAgICAgICAgLy8gTGltcGlhciBkYXRvcyBleHBpcmFkb3MgdXNhbmRvIHV0aWxpZGFkIHNlZ3VyYVxuICAgICAgICBzYWZlTG9jYWxTdG9yYWdlU2V0KGNvbmZpZy5zdG9yYWdlS2V5LCB7XG4gICAgICAgICAgc2VhcmNoZXM6IFtdLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICB2ZXJzaW9uOiAnMS4wJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcGVyc2lzdGVkRGF0YS5zZWFyY2hlcy5zbGljZSgwLCBjb25maWcubWF4U2VhcmNoZXMpO1xuICAgIH1cblxuICAgIC8vIEZvcm1hdG8gYW50aWd1byAoYXJyYXkgc2ltcGxlKVxuICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG4gICAgICByZXR1cm4gZGF0YS5zbGljZSgwLCBjb25maWcubWF4U2VhcmNoZXMpO1xuICAgIH1cblxuICAgIHJldHVybiBbXTtcbiAgfSwgW2NvbmZpZy5lbmFibGVQZXJzaXN0ZW5jZSwgY29uZmlnLnN0b3JhZ2VLZXksIGNvbmZpZy5tYXhTZWFyY2hlcywgaXNFeHBpcmVkXSk7XG5cbiAgLy8gR3VhcmRhciBiw7pzcXVlZGFzIGVuIGxvY2FsU3RvcmFnZVxuICBjb25zdCBzYXZlVG9TdG9yYWdlID0gdXNlQ2FsbGJhY2soKHNlYXJjaGVzOiBzdHJpbmdbXSk6IHZvaWQgPT4ge1xuICAgIGlmICghY29uZmlnLmVuYWJsZVBlcnNpc3RlbmNlIHx8IHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGlmIChzZWFyY2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oY29uZmlnLnN0b3JhZ2VLZXkpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRhdGFUb1N0b3JlOiBQZXJzaXN0ZWRTZWFyY2hEYXRhID0ge1xuICAgICAgICBzZWFyY2hlczogc2VhcmNoZXMuc2xpY2UoMCwgY29uZmlnLm1heFNlYXJjaGVzKSxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICB2ZXJzaW9uOiAnMS4wLjAnXG4gICAgICB9O1xuXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjb25maWcuc3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkoZGF0YVRvU3RvcmUpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBzYXZpbmcgcmVjZW50IHNlYXJjaGVzIHRvIGxvY2FsU3RvcmFnZTonLCBlcnJvcik7XG4gICAgfVxuICB9LCBbY29uZmlnLmVuYWJsZVBlcnNpc3RlbmNlLCBjb25maWcuc3RvcmFnZUtleSwgY29uZmlnLm1heFNlYXJjaGVzXSk7XG5cbiAgLy8gQ2FyZ2FyIGLDunNxdWVkYXMgYWwgaW5pY2lhbGl6YXJcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBsb2FkZWQgPSBsb2FkRnJvbVN0b3JhZ2UoKTtcbiAgICBzZXRSZWNlbnRTZWFyY2hlcyhsb2FkZWQpO1xuICB9LCBbbG9hZEZyb21TdG9yYWdlXSk7XG5cbiAgLy8gQWdyZWdhciB1bmEgbnVldmEgYsO6c3F1ZWRhXG4gIGNvbnN0IGFkZFNlYXJjaCA9IHVzZUNhbGxiYWNrKChzZWFyY2g6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplU2VhcmNoKHNlYXJjaCk7XG4gICAgaWYgKCFzYW5pdGl6ZWQgfHwgc2FuaXRpemVkLmxlbmd0aCA8IDIpIHJldHVybjtcblxuICAgIHNldFJlY2VudFNlYXJjaGVzKHByZXYgPT4ge1xuICAgICAgbGV0IHVwZGF0ZWQgPSBbLi4ucHJldl07XG5cbiAgICAgIC8vIFJlbW92ZXIgZHVwbGljYWRvcyBzaSBlc3TDoSBoYWJpbGl0YWRvXG4gICAgICBpZiAoY29uZmlnLmZpbHRlckR1cGxpY2F0ZXMpIHtcbiAgICAgICAgdXBkYXRlZCA9IHVwZGF0ZWQuZmlsdGVyKHMgPT4gc2FuaXRpemVTZWFyY2gocykgIT09IHNhbml0aXplZCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFncmVnYXIgYWwgcHJpbmNpcGlvXG4gICAgICB1cGRhdGVkLnVuc2hpZnQoc2VhcmNoLnRyaW0oKSk7XG5cbiAgICAgIC8vIExpbWl0YXIgYWwgbcOheGltbyBjb25maWd1cmFkb1xuICAgICAgdXBkYXRlZCA9IHVwZGF0ZWQuc2xpY2UoMCwgY29uZmlnLm1heFNlYXJjaGVzKTtcblxuICAgICAgLy8gR3VhcmRhciBlbiBsb2NhbFN0b3JhZ2VcbiAgICAgIHNhdmVUb1N0b3JhZ2UodXBkYXRlZCk7XG5cbiAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgIH0pO1xuICB9LCBbc2FuaXRpemVTZWFyY2gsIGNvbmZpZy5maWx0ZXJEdXBsaWNhdGVzLCBjb25maWcubWF4U2VhcmNoZXMsIHNhdmVUb1N0b3JhZ2VdKTtcblxuICAvLyBSZW1vdmVyIHVuYSBiw7pzcXVlZGEgZXNwZWPDrWZpY2FcbiAgY29uc3QgcmVtb3ZlU2VhcmNoID0gdXNlQ2FsbGJhY2soKHNlYXJjaDogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgY29uc3Qgc2FuaXRpemVkID0gc2FuaXRpemVTZWFyY2goc2VhcmNoKTtcbiAgICBcbiAgICBzZXRSZWNlbnRTZWFyY2hlcyhwcmV2ID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBwcmV2LmZpbHRlcihzID0+IHNhbml0aXplU2VhcmNoKHMpICE9PSBzYW5pdGl6ZWQpO1xuICAgICAgc2F2ZVRvU3RvcmFnZSh1cGRhdGVkKTtcbiAgICAgIHJldHVybiB1cGRhdGVkO1xuICAgIH0pO1xuICB9LCBbc2FuaXRpemVTZWFyY2gsIHNhdmVUb1N0b3JhZ2VdKTtcblxuICAvLyBMaW1waWFyIHRvZGFzIGxhcyBiw7pzcXVlZGFzXG4gIGNvbnN0IGNsZWFyU2VhcmNoZXMgPSB1c2VDYWxsYmFjaygoKTogdm9pZCA9PiB7XG4gICAgc2V0UmVjZW50U2VhcmNoZXMoW10pO1xuICAgIHNhdmVUb1N0b3JhZ2UoW10pO1xuICB9LCBbc2F2ZVRvU3RvcmFnZV0pO1xuXG4gIC8vIFZlcmlmaWNhciBzaSB1bmEgYsO6c3F1ZWRhIGV4aXN0ZVxuICBjb25zdCBoYXNTZWFyY2ggPSB1c2VDYWxsYmFjaygoc2VhcmNoOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVNlYXJjaChzZWFyY2gpO1xuICAgIHJldHVybiByZWNlbnRTZWFyY2hlcy5zb21lKHMgPT4gc2FuaXRpemVTZWFyY2gocykgPT09IHNhbml0aXplZCk7XG4gIH0sIFtyZWNlbnRTZWFyY2hlcywgc2FuaXRpemVTZWFyY2hdKTtcblxuICAvLyBPYnRlbmVyIGxhcyBOIGLDunNxdWVkYXMgbcOhcyByZWNpZW50ZXNcbiAgY29uc3QgZ2V0UmVjZW50U2VhcmNoZXMgPSB1c2VDYWxsYmFjaygobGltaXQ/OiBudW1iZXIpOiBzdHJpbmdbXSA9PiB7XG4gICAgY29uc3QgYWN0dWFsTGltaXQgPSBsaW1pdCA/PyBjb25maWcubWF4U2VhcmNoZXM7XG4gICAgcmV0dXJuIHJlY2VudFNlYXJjaGVzLnNsaWNlKDAsIGFjdHVhbExpbWl0KTtcbiAgfSwgW3JlY2VudFNlYXJjaGVzLCBjb25maWcubWF4U2VhcmNoZXNdKTtcblxuICAvLyBNb3ZlciB1bmEgYsO6c3F1ZWRhIGFsIHByaW5jaXBpbyAocmVvcmRlbmFyKVxuICBjb25zdCBtb3ZlVG9Ub3AgPSB1c2VDYWxsYmFjaygoc2VhcmNoOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVNlYXJjaChzZWFyY2gpO1xuICAgIFxuICAgIHNldFJlY2VudFNlYXJjaGVzKHByZXYgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyZWQgPSBwcmV2LmZpbHRlcihzID0+IHNhbml0aXplU2VhcmNoKHMpICE9PSBzYW5pdGl6ZWQpO1xuICAgICAgY29uc3QgZXhpc3RpbmcgPSBwcmV2LmZpbmQocyA9PiBzYW5pdGl6ZVNlYXJjaChzKSA9PT0gc2FuaXRpemVkKTtcbiAgICAgIFxuICAgICAgaWYgKCFleGlzdGluZykgcmV0dXJuIHByZXY7XG4gICAgICBcbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBbZXhpc3RpbmcsIC4uLmZpbHRlcmVkXTtcbiAgICAgIHNhdmVUb1N0b3JhZ2UodXBkYXRlZCk7XG4gICAgICByZXR1cm4gdXBkYXRlZDtcbiAgICB9KTtcbiAgfSwgW3Nhbml0aXplU2VhcmNoLCBzYXZlVG9TdG9yYWdlXSk7XG5cbiAgcmV0dXJuIHtcbiAgICByZWNlbnRTZWFyY2hlcyxcbiAgICBhZGRTZWFyY2gsXG4gICAgcmVtb3ZlU2VhcmNoLFxuICAgIGNsZWFyU2VhcmNoZXMsXG4gICAgaGFzU2VhcmNoLFxuICAgIGdldFJlY2VudFNlYXJjaGVzLFxuICAgIG1vdmVUb1RvcCxcbiAgfTtcbn1cblxuLyoqXG4gKiBIb29rIHNpbXBsaWZpY2FkbyBwYXJhIHNvbG8gb2J0ZW5lciBiw7pzcXVlZGFzIHJlY2llbnRlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlUmVjZW50U2VhcmNoZXNTaW1wbGUobGltaXQ6IG51bWJlciA9IDUpOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHsgZ2V0UmVjZW50U2VhcmNoZXMgfSA9IHVzZVJlY2VudFNlYXJjaGVzKHsgbWF4U2VhcmNoZXM6IGxpbWl0IH0pO1xuICByZXR1cm4gZ2V0UmVjZW50U2VhcmNoZXMoKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgdXNlUmVjZW50U2VhcmNoZXM7XG4iXSwibmFtZXMiOlsidXNlUmVjZW50U2VhcmNoZXMiLCJ1c2VSZWNlbnRTZWFyY2hlc1NpbXBsZSIsIkRFRkFVTFRfT1BUSU9OUyIsIm1heFNlYXJjaGVzIiwic3RvcmFnZUtleSIsImVuYWJsZVBlcnNpc3RlbmNlIiwiZmlsdGVyRHVwbGljYXRlcyIsImV4cGlyYXRpb25EYXlzIiwib3B0aW9ucyIsImNvbmZpZyIsInJlY2VudFNlYXJjaGVzIiwic2V0UmVjZW50U2VhcmNoZXMiLCJ1c2VTdGF0ZSIsInNhbml0aXplU2VhcmNoIiwidXNlQ2FsbGJhY2siLCJzZWFyY2giLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJpc0V4cGlyZWQiLCJ0aW1lc3RhbXAiLCJtYXhBZ2UiLCJEYXRlIiwibm93IiwibG9hZEZyb21TdG9yYWdlIiwicmVzdWx0Iiwic2FmZUxvY2FsU3RvcmFnZUdldCIsInN1Y2Nlc3MiLCJkYXRhIiwiQXJyYXkiLCJpc0FycmF5Iiwic2VhcmNoZXMiLCJwZXJzaXN0ZWREYXRhIiwic2FmZUxvY2FsU3RvcmFnZVNldCIsInZlcnNpb24iLCJzbGljZSIsInNhdmVUb1N0b3JhZ2UiLCJ3aW5kb3ciLCJsZW5ndGgiLCJsb2NhbFN0b3JhZ2UiLCJyZW1vdmVJdGVtIiwiZGF0YVRvU3RvcmUiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImVycm9yIiwiY29uc29sZSIsIndhcm4iLCJ1c2VFZmZlY3QiLCJsb2FkZWQiLCJhZGRTZWFyY2giLCJzYW5pdGl6ZWQiLCJwcmV2IiwidXBkYXRlZCIsImZpbHRlciIsInMiLCJ1bnNoaWZ0IiwicmVtb3ZlU2VhcmNoIiwiY2xlYXJTZWFyY2hlcyIsImhhc1NlYXJjaCIsInNvbWUiLCJnZXRSZWNlbnRTZWFyY2hlcyIsImxpbWl0IiwiYWN0dWFsTGltaXQiLCJtb3ZlVG9Ub3AiLCJmaWx0ZXJlZCIsImV4aXN0aW5nIiwiZmluZCJdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBQ3RDLDRFQUE0RTtBQUM1RSxzQ0FBc0M7Ozs7Ozs7Ozs7OztJQTRPdEMsT0FBaUM7ZUFBakM7O0lBakxnQkEsaUJBQWlCO2VBQWpCQTs7SUE0S0FDLHVCQUF1QjtlQUF2QkE7Ozt1QkFyT2lDOzJCQUNzQjtBQXNDdkUsTUFBTUMsa0JBQW1EO0lBQ3ZEQyxhQUFhO0lBQ2JDLFlBQVk7SUFDWkMsbUJBQW1CO0lB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