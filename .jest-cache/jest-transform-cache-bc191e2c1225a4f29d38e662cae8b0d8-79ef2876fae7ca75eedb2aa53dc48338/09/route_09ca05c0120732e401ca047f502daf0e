12f49720750602fb83030467fdae288c
// ===================================
// PINTEYA E-COMMERCE - API DE ÓRDENES DE USUARIO
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "GET", {
    enumerable: true,
    get: function() {
        return GET;
    }
});
const _server = require("next/server");
const _supabase = require("../../../../lib/supabase");
const _server1 = require("@clerk/nextjs/server");
async function GET(request) {
    try {
        // Verificar que el cliente administrativo esté disponible
        if (!_supabase.supabaseAdmin) {
            console.error('Cliente administrativo de Supabase no disponible en GET /api/user/orders');
            return _server.NextResponse.json({
                error: 'Servicio de base de datos no disponible'
            }, {
                status: 503
            });
        }
        // Autenticación con Clerk
        const { userId } = await (0, _server1.auth)();
        if (!userId) {
            const errorResponse = {
                data: null,
                success: false,
                error: 'Usuario no autenticado'
            };
            return _server.NextResponse.json(errorResponse, {
                status: 401
            });
        }
        const { searchParams } = new URL(request.url);
        const page = parseInt(searchParams.get('page') || '1');
        const limit = parseInt(searchParams.get('limit') || '10');
        const status = searchParams.get('status');
        // Obtener usuario primero
        let { data: user } = await _supabase.supabaseAdmin.from('users').select('id').eq('clerk_id', userId).single();
        if (!user) {
            // Crear usuario demo si no existe
            const { data: newUser, error: createError } = await _supabase.supabaseAdmin.from('users').insert([
                {
                    clerk_id: userId,
                    email: 'usuario@demo.com',
                    name: 'Usuario Demo'
                }
            ]).select('id').single();
            if (createError) {
                console.error('Error al crear usuario demo:', createError);
                return _server.NextResponse.json({
                    error: 'Error al obtener usuario'
                }, {
                    status: 500
                });
            }
            if (!newUser) {
                console.error('Error: newUser es null después de la inserción');
                return _server.NextResponse.json({
                    error: 'Error al crear usuario'
                }, {
                    status: 500
                });
            }
            // Crear algunas órdenes demo para el usuario
            await createDemoOrders(newUser.id);
            // Usar el nuevo usuario
            user = newUser;
        }
        // Construir query base
        let query = _supabase.supabaseAdmin.from('orders').select(`
        *,
        order_items (
          id,
          quantity,
          price,
          products (
            id,
            name,
            images
          )
        )
      `).eq('user_id', user.id);
        // Filtrar por status si se especifica
        if (status && status !== 'all') {
            query = query.eq('status', status);
        }
        // Aplicar paginación y ordenamiento
        const from = (page - 1) * limit;
        const to = from + limit - 1;
        const { data: orders, error, count } = await query.order('created_at', {
            ascending: false
        }).range(from, to);
        if (error) {
            console.error('Error al obtener órdenes:', error);
            return _server.NextResponse.json({
                error: 'Error al obtener órdenes'
            }, {
                status: 500
            });
        }
        // Calcular estadísticas
        const { data: stats } = await _supabase.supabaseAdmin.from('orders').select('status, total').eq('user_id', user.id);
        const statistics = {
            total_orders: stats?.length || 0,
            total_spent: stats?.reduce((sum, order)=>sum + parseFloat(order.total), 0) || 0,
            pending_orders: stats?.filter((order)=>order.status === 'pending').length || 0,
            completed_orders: stats?.filter((order)=>order.status === 'delivered').length || 0
        };
        return _server.NextResponse.json({
            success: true,
            orders: orders || [],
            pagination: {
                page,
                limit,
                total: count || 0,
                pages: Math.ceil((count || 0) / limit)
            },
            statistics
        });
    } catch (error) {
        console.error('Error en GET /api/user/orders:', error);
        return _server.NextResponse.json({
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}
// ===================================
// Función auxiliar para crear órdenes demo
// ===================================
async function createDemoOrders(userId) {
    if (!_supabase.supabaseAdmin) return;
    try {
        // Obtener algunos productos para las órdenes demo
        const { data: products } = await _supabase.supabaseAdmin.from('products').select('id, name, price').limit(5);
        if (!products || products.length === 0) return;
        // Crear órdenes demo
        const demoOrders = [
            {
                user_id: userId,
                total: 15000.00,
                status: 'delivered',
                payment_id: 'demo_payment_1',
                shipping_address: {
                    name: 'Usuario Demo',
                    street: 'Av. Corrientes 1234',
                    city: 'Buenos Aires',
                    postal_code: '1043',
                    country: 'Argentina'
                }
            },
            {
                user_id: userId,
                total: 8500.00,
                status: 'shipped',
                payment_id: 'demo_payment_2',
                shipping_address: {
                    name: 'Usuario Demo',
                    street: 'Av. Corrientes 1234',
                    city: 'Buenos Aires',
                    postal_code: '1043',
                    country: 'Argentina'
                }
            },
            {
                user_id: userId,
                total: 12300.00,
                status: 'pending',
                payment_id: 'demo_payment_3',
                shipping_address: {
                    name: 'Usuario Demo',
                    street: 'Av. Corrientes 1234',
                    city: 'Buenos Aires',
                    postal_code: '1043',
                    country: 'Argentina'
                }
            }
        ];
        const { data: createdOrders } = await _supabase.supabaseAdmin.from('orders').insert(demoOrders).select();
        // Crear items para cada orden
        if (createdOrders && products.length >= 2) {
            for (const order of createdOrders){
                const orderItems = [
                    {
                        order_id: order.id,
                        product_id: products[0].id,
                        quantity: 2,
                        price: products[0].price
                    },
                    {
                        order_id: order.id,
                        product_id: products[1].id,
                        quantity: 1,
                        price: products[1].price
                    }
                ];
                await _supabase.supabaseAdmin.from('order_items').insert(orderItems);
            }
        }
    } catch (error) {
        console.error('Error al crear órdenes demo:', error);
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXHVzZXJcXG9yZGVyc1xccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gUElOVEVZQSBFLUNPTU1FUkNFIC0gQVBJIERFIMOTUkRFTkVTIERFIFVTVUFSSU9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICdAL2xpYi9zdXBhYmFzZSc7XHJcbmltcG9ydCB7IGF1dGggfSBmcm9tICdAY2xlcmsvbmV4dGpzL3NlcnZlcic7XHJcbmltcG9ydCB7IEFwaVJlc3BvbnNlIH0gZnJvbSAnQC90eXBlcy9hcGknO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gR0VUIC0gT2J0ZW5lciDDs3JkZW5lcyBkZWwgdXN1YXJpb1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIFZlcmlmaWNhciBxdWUgZWwgY2xpZW50ZSBhZG1pbmlzdHJhdGl2byBlc3TDqSBkaXNwb25pYmxlXHJcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcclxuICAgICAgY29uc29sZS5lcnJvcignQ2xpZW50ZSBhZG1pbmlzdHJhdGl2byBkZSBTdXBhYmFzZSBubyBkaXNwb25pYmxlIGVuIEdFVCAvYXBpL3VzZXIvb3JkZXJzJyk7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAnU2VydmljaW8gZGUgYmFzZSBkZSBkYXRvcyBubyBkaXNwb25pYmxlJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA1MDMgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEF1dGVudGljYWNpw7NuIGNvbiBDbGVya1xyXG4gICAgY29uc3QgeyB1c2VySWQgfSA9IGF3YWl0IGF1dGgoKTtcclxuICAgIGlmICghdXNlcklkKSB7XHJcbiAgICAgIGNvbnN0IGVycm9yUmVzcG9uc2U6IEFwaVJlc3BvbnNlPG51bGw+ID0ge1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdVc3VhcmlvIG5vIGF1dGVudGljYWRvJyxcclxuICAgICAgfTtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGVycm9yUmVzcG9uc2UsIHsgc3RhdHVzOiA0MDEgfSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XHJcbiAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldCgncGFnZScpIHx8ICcxJyk7XHJcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzEwJyk7XHJcbiAgICBjb25zdCBzdGF0dXMgPSBzZWFyY2hQYXJhbXMuZ2V0KCdzdGF0dXMnKTtcclxuXHJcbiAgICAvLyBPYnRlbmVyIHVzdWFyaW8gcHJpbWVyb1xyXG4gICAgbGV0IHsgZGF0YTogdXNlciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgndXNlcnMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgIC5lcSgnY2xlcmtfaWQnLCB1c2VySWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgLy8gQ3JlYXIgdXN1YXJpbyBkZW1vIHNpIG5vIGV4aXN0ZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IG5ld1VzZXIsIGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCd1c2VycycpXHJcbiAgICAgICAgLmluc2VydChbXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIGNsZXJrX2lkOiB1c2VySWQsXHJcbiAgICAgICAgICAgIGVtYWlsOiAndXN1YXJpb0BkZW1vLmNvbScsXHJcbiAgICAgICAgICAgIG5hbWU6ICdVc3VhcmlvIERlbW8nLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICBdKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICBpZiAoY3JlYXRlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjcmVhciB1c3VhcmlvIGRlbW86JywgY3JlYXRlRXJyb3IpO1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICAgIHsgZXJyb3I6ICdFcnJvciBhbCBvYnRlbmVyIHVzdWFyaW8nIH0sXHJcbiAgICAgICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIW5ld1VzZXIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvcjogbmV3VXNlciBlcyBudWxsIGRlc3B1w6lzIGRlIGxhIGluc2VyY2nDs24nKTtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICB7IGVycm9yOiAnRXJyb3IgYWwgY3JlYXIgdXN1YXJpbycgfSxcclxuICAgICAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENyZWFyIGFsZ3VuYXMgw7NyZGVuZXMgZGVtbyBwYXJhIGVsIHVzdWFyaW9cclxuICAgICAgYXdhaXQgY3JlYXRlRGVtb09yZGVycyhuZXdVc2VyLmlkKTtcclxuXHJcbiAgICAgIC8vIFVzYXIgZWwgbnVldm8gdXN1YXJpb1xyXG4gICAgICB1c2VyID0gbmV3VXNlcjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDb25zdHJ1aXIgcXVlcnkgYmFzZVxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnb3JkZXJzJylcclxuICAgICAgLnNlbGVjdChgXHJcbiAgICAgICAgKixcclxuICAgICAgICBvcmRlcl9pdGVtcyAoXHJcbiAgICAgICAgICBpZCxcclxuICAgICAgICAgIHF1YW50aXR5LFxyXG4gICAgICAgICAgcHJpY2UsXHJcbiAgICAgICAgICBwcm9kdWN0cyAoXHJcbiAgICAgICAgICAgIGlkLFxyXG4gICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICBpbWFnZXNcclxuICAgICAgICAgIClcclxuICAgICAgICApXHJcbiAgICAgIGApXHJcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpO1xyXG5cclxuICAgIC8vIEZpbHRyYXIgcG9yIHN0YXR1cyBzaSBzZSBlc3BlY2lmaWNhXHJcbiAgICBpZiAoc3RhdHVzICYmIHN0YXR1cyAhPT0gJ2FsbCcpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc3RhdHVzJywgc3RhdHVzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBcGxpY2FyIHBhZ2luYWNpw7NuIHkgb3JkZW5hbWllbnRvXHJcbiAgICBjb25zdCBmcm9tID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xyXG4gICAgY29uc3QgdG8gPSBmcm9tICsgbGltaXQgLSAxO1xyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogb3JkZXJzLCBlcnJvciwgY291bnQgfSA9IGF3YWl0IHF1ZXJ5XHJcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAucmFuZ2UoZnJvbSwgdG8pO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBvYnRlbmVyIMOzcmRlbmVzOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6ICdFcnJvciBhbCBvYnRlbmVyIMOzcmRlbmVzJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhbGN1bGFyIGVzdGFkw61zdGljYXNcclxuICAgIGNvbnN0IHsgZGF0YTogc3RhdHMgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ29yZGVycycpXHJcbiAgICAgIC5zZWxlY3QoJ3N0YXR1cywgdG90YWwnKVxyXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKTtcclxuXHJcbiAgICBjb25zdCBzdGF0aXN0aWNzID0ge1xyXG4gICAgICB0b3RhbF9vcmRlcnM6IHN0YXRzPy5sZW5ndGggfHwgMCxcclxuICAgICAgdG90YWxfc3BlbnQ6IHN0YXRzPy5yZWR1Y2UoKHN1bSwgb3JkZXIpID0+IHN1bSArIHBhcnNlRmxvYXQob3JkZXIudG90YWwpLCAwKSB8fCAwLFxyXG4gICAgICBwZW5kaW5nX29yZGVyczogc3RhdHM/LmZpbHRlcihvcmRlciA9PiBvcmRlci5zdGF0dXMgPT09ICdwZW5kaW5nJykubGVuZ3RoIHx8IDAsXHJcbiAgICAgIGNvbXBsZXRlZF9vcmRlcnM6IHN0YXRzPy5maWx0ZXIob3JkZXIgPT4gb3JkZXIuc3RhdHVzID09PSAnZGVsaXZlcmVkJykubGVuZ3RoIHx8IDAsXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIG9yZGVyczogb3JkZXJzIHx8IFtdLFxyXG4gICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgcGFnZSxcclxuICAgICAgICBsaW1pdCxcclxuICAgICAgICB0b3RhbDogY291bnQgfHwgMCxcclxuICAgICAgICBwYWdlczogTWF0aC5jZWlsKChjb3VudCB8fCAwKSAvIGxpbWl0KSxcclxuICAgICAgfSxcclxuICAgICAgc3RhdGlzdGljcyxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlbiBHRVQgL2FwaS91c2VyL29yZGVyczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gRnVuY2nDs24gYXV4aWxpYXIgcGFyYSBjcmVhciDDs3JkZW5lcyBkZW1vXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZURlbW9PcmRlcnModXNlcklkOiBzdHJpbmcpIHtcclxuICBpZiAoIXN1cGFiYXNlQWRtaW4pIHJldHVybjtcclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIE9idGVuZXIgYWxndW5vcyBwcm9kdWN0b3MgcGFyYSBsYXMgw7NyZGVuZXMgZGVtb1xyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9kdWN0cyB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgncHJvZHVjdHMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgbmFtZSwgcHJpY2UnKVxyXG4gICAgICAubGltaXQoNSk7XHJcblxyXG4gICAgaWYgKCFwcm9kdWN0cyB8fCBwcm9kdWN0cy5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcbiAgICAvLyBDcmVhciDDs3JkZW5lcyBkZW1vXHJcbiAgICBjb25zdCBkZW1vT3JkZXJzID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgIHRvdGFsOiAxNTAwMC4wMCxcclxuICAgICAgICBzdGF0dXM6ICdkZWxpdmVyZWQnLFxyXG4gICAgICAgIHBheW1lbnRfaWQ6ICdkZW1vX3BheW1lbnRfMScsXHJcbiAgICAgICAgc2hpcHBpbmdfYWRkcmVzczoge1xyXG4gICAgICAgICAgbmFtZTogJ1VzdWFyaW8gRGVtbycsXHJcbiAgICAgICAgICBzdHJlZXQ6ICdBdi4gQ29ycmllbnRlcyAxMjM0JyxcclxuICAgICAgICAgIGNpdHk6ICdCdWVub3MgQWlyZXMnLFxyXG4gICAgICAgICAgcG9zdGFsX2NvZGU6ICcxMDQzJyxcclxuICAgICAgICAgIGNvdW50cnk6ICdBcmdlbnRpbmEnXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgIHRvdGFsOiA4NTAwLjAwLFxyXG4gICAgICAgIHN0YXR1czogJ3NoaXBwZWQnLFxyXG4gICAgICAgIHBheW1lbnRfaWQ6ICdkZW1vX3BheW1lbnRfMicsXHJcbiAgICAgICAgc2hpcHBpbmdfYWRkcmVzczoge1xyXG4gICAgICAgICAgbmFtZTogJ1VzdWFyaW8gRGVtbycsXHJcbiAgICAgICAgICBzdHJlZXQ6ICdBdi4gQ29ycmllbnRlcyAxMjM0JyxcclxuICAgICAgICAgIGNpdHk6ICdCdWVub3MgQWlyZXMnLFxyXG4gICAgICAgICAgcG9zdGFsX2NvZGU6ICcxMDQzJyxcclxuICAgICAgICAgIGNvdW50cnk6ICdBcmdlbnRpbmEnXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgIHRvdGFsOiAxMjMwMC4wMCxcclxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgICAgICBwYXltZW50X2lkOiAnZGVtb19wYXltZW50XzMnLFxyXG4gICAgICAgIHNoaXBwaW5nX2FkZHJlc3M6IHtcclxuICAgICAgICAgIG5hbWU6ICdVc3VhcmlvIERlbW8nLFxyXG4gICAgICAgICAgc3RyZWV0OiAnQXYuIENvcnJpZW50ZXMgMTIzNCcsXHJcbiAgICAgICAgICBjaXR5OiAnQnVlbm9zIEFpcmVzJyxcclxuICAgICAgICAgIHBvc3RhbF9jb2RlOiAnMTA0MycsXHJcbiAgICAgICAgICBjb3VudHJ5OiAnQXJnZW50aW5hJ1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgXTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IGNyZWF0ZWRPcmRlcnMgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ29yZGVycycpXHJcbiAgICAgIC5pbnNlcnQoZGVtb09yZGVycylcclxuICAgICAgLnNlbGVjdCgpO1xyXG5cclxuICAgIC8vIENyZWFyIGl0ZW1zIHBhcmEgY2FkYSBvcmRlblxyXG4gICAgaWYgKGNyZWF0ZWRPcmRlcnMgJiYgcHJvZHVjdHMubGVuZ3RoID49IDIpIHtcclxuICAgICAgZm9yIChjb25zdCBvcmRlciBvZiBjcmVhdGVkT3JkZXJzKSB7XHJcbiAgICAgICAgY29uc3Qgb3JkZXJJdGVtcyA9IFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgb3JkZXJfaWQ6IG9yZGVyLmlkLFxyXG4gICAgICAgICAgICBwcm9kdWN0X2lkOiBwcm9kdWN0c1swXS5pZCxcclxuICAgICAgICAgICAgcXVhbnRpdHk6IDIsXHJcbiAgICAgICAgICAgIHByaWNlOiBwcm9kdWN0c1swXS5wcmljZVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgb3JkZXJfaWQ6IG9yZGVyLmlkLFxyXG4gICAgICAgICAgICBwcm9kdWN0X2lkOiBwcm9kdWN0c1sxXS5pZCxcclxuICAgICAgICAgICAgcXVhbnRpdHk6IDEsXHJcbiAgICAgICAgICAgIHByaWNlOiBwcm9kdWN0c1sxXS5wcmljZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAgIC5mcm9tKCdvcmRlcl9pdGVtcycpXHJcbiAgICAgICAgICAuaW5zZXJ0KG9yZGVySXRlbXMpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIGNyZWFyIMOzcmRlbmVzIGRlbW86JywgZXJyb3IpO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiR0VUIiwicmVxdWVzdCIsInN1cGFiYXNlQWRtaW4iLCJjb25zb2xlIiwiZXJyb3IiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwic3RhdHVzIiwidXNlcklkIiwiYXV0aCIsImVycm9yUmVzcG9uc2UiLCJkYXRhIiwic3VjY2VzcyIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInBhZ2UiLCJwYXJzZUludCIsImdldCIsImxpbWl0IiwidXNlciIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsIm5ld1VzZXIiLCJjcmVhdGVFcnJvciIsImluc2VydCIsImNsZXJrX2lkIiwiZW1haWwiLCJuYW1lIiwiY3JlYXRlRGVtb09yZGVycyIsImlkIiwicXVlcnkiLCJ0byIsIm9yZGVycyIsImNvdW50Iiwib3JkZXIiLCJhc2NlbmRpbmciLCJyYW5nZSIsInN0YXRzIiwic3RhdGlzdGljcyIsInRvdGFsX29yZGVycyIsImxlbmd0aCIsInRvdGFsX3NwZW50IiwicmVkdWNlIiwic3VtIiwicGFyc2VGbG9hdCIsInRvdGFsIiwicGVuZGluZ19vcmRlcnMiLCJmaWx0ZXIiLCJjb21wbGV0ZWRfb3JkZXJzIiwicGFnaW5hdGlvbiIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJwcm9kdWN0cyIsImRlbW9PcmRlcnMiLCJ1c2VyX2lkIiwicGF5bWVudF9pZCIsInNoaXBwaW5nX2FkZHJlc3MiLCJzdHJlZXQiLCJjaXR5IiwicG9zdGFsX2NvZGUiLCJjb3VudHJ5IiwiY3JlYXRlZE9yZGVycyIsIm9yZGVySXRlbXMiLCJvcmRlcl9pZCIsInByb2R1Y3RfaWQiLCJxdWFudGl0eSIsInByaWNlIl0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMsaURBQWlEO0FBQ2pELHNDQUFzQzs7Ozs7K0JBVWhCQTs7O2VBQUFBOzs7d0JBUm9COzBCQUNaO3lCQUNUO0FBTWQsZUFBZUEsSUFBSUMsT0FBb0I7SUFDNUMsSUFBSTtRQUNGLDBEQUEwRDtRQUMxRCxJQUFJLENBQUNDLHVCQUFhLEVBQUU7WUFDbEJDLFFBQVFDLEtBQUssQ0FBQztZQUNkLE9BQU9DLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7Z0JBQUVGLE9BQU87WUFBMEMsR0FDbkQ7Z0JBQUVHLFFBQVE7WUFBSTtRQUVsQjtRQUVBLDBCQUEwQjtRQUMxQixNQUFNLEVBQUVDLE1BQU0sRUFBRSxHQUFHLE1BQU1DLElBQUFBLGFBQUk7UUFDN0IsSUFBSSxDQUFDRCxRQUFRO1lBQ1gsTUFBTUUsZ0JBQW1DO2dCQUN2Q0MsTUFBTTtnQkFDTkMsU0FBUztnQkFDVFIsT0FBTztZQUNUO1lBQ0EsT0FBT0Msb0JBQVksQ0FBQ0MsSUFBSSxDQUFDSSxlQUFlO2dCQUFFSCxRQUFRO1lBQUk7UUFDeEQ7UUFDQSxNQUFNLEVBQUVNLFlBQVksRUFBRSxHQUFHLElBQUlDLElBQUliLFFBQVFjLEdBQUc7UUFDNUMsTUFBTUMsT0FBT0MsU0FBU0osYUFBYUssR0FBRyxDQUFDLFdBQVc7UUFDbEQsTUFBTUMsUUFBUUYsU0FBU0osYUFBYUssR0FBRyxDQUFDLFlBQVk7UUFDcEQsTUFBTVgsU0FBU00sYUFBYUssR0FBRyxDQUFDO1FBRWhDLDBCQUEwQjtRQUMxQixJQUFJLEVBQUVQLE1BQU1TLElBQUksRUFBRSxHQUFHLE1BQU1sQix1QkFBYSxDQUNyQ21CLElBQUksQ0FBQyxTQUNMQyxNQUFNLENBQUMsTUFDUEMsRUFBRSxDQUFDLFlBQVlmLFFBQ2ZnQixNQUFNO1FBRVQsSUFB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