5f56af49b9f38becb7ecae42052a1af8
// ===================================
// PINTEYA E-COMMERCE - API DE ÓRDENES DE USUARIO
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "GET", {
    enumerable: true,
    get: function() {
        return GET;
    }
});
const _server = require("next/server");
const _supabase = require("../../../../lib/supabase");
async function GET(request) {
    try {
        // Verificar que el cliente administrativo esté disponible
        if (!_supabase.supabaseAdmin) {
            console.error('Cliente administrativo de Supabase no disponible en GET /api/user/orders');
            return _server.NextResponse.json({
                error: 'Servicio de base de datos no disponible'
            }, {
                status: 503
            });
        }
        // Obtener parámetros de consulta
        const { searchParams } = new URL(request.url);
        const page = parseInt(searchParams.get('page') || '1');
        const limit = parseInt(searchParams.get('limit') || '10');
        const status = searchParams.get('status');
        // Para demo, usar un usuario fijo o crear uno temporal
        const demoUserId = 'demo-user-123';
        // Obtener usuario primero
        let { data: user } = await _supabase.supabaseAdmin.from('users').select('id').eq('clerk_id', demoUserId).single();
        if (!user) {
            // Crear usuario demo si no existe
            const { data: newUser, error: createError } = await _supabase.supabaseAdmin.from('users').insert([
                {
                    clerk_id: demoUserId,
                    email: 'usuario@demo.com',
                    name: 'Usuario Demo'
                }
            ]).select('id').single();
            if (createError) {
                console.error('Error al crear usuario demo:', createError);
                return _server.NextResponse.json({
                    error: 'Error al obtener usuario'
                }, {
                    status: 500
                });
            }
            if (!newUser) {
                console.error('Error: newUser es null después de la inserción');
                return _server.NextResponse.json({
                    error: 'Error al crear usuario'
                }, {
                    status: 500
                });
            }
            // Crear algunas órdenes demo para el usuario
            await createDemoOrders(newUser.id);
            // Usar el nuevo usuario
            user = newUser;
        }
        // Construir query base
        let query = _supabase.supabaseAdmin.from('orders').select(`
        *,
        order_items (
          id,
          quantity,
          price,
          products (
            id,
            name,
            images
          )
        )
      `).eq('user_id', user.id);
        // Filtrar por status si se especifica
        if (status && status !== 'all') {
            query = query.eq('status', status);
        }
        // Aplicar paginación y ordenamiento
        const from = (page - 1) * limit;
        const to = from + limit - 1;
        const { data: orders, error, count } = await query.order('created_at', {
            ascending: false
        }).range(from, to);
        if (error) {
            console.error('Error al obtener órdenes:', error);
            return _server.NextResponse.json({
                error: 'Error al obtener órdenes'
            }, {
                status: 500
            });
        }
        // Calcular estadísticas
        const { data: stats } = await _supabase.supabaseAdmin.from('orders').select('status, total').eq('user_id', user.id);
        const statistics = {
            total_orders: stats?.length || 0,
            total_spent: stats?.reduce((sum, order)=>sum + parseFloat(order.total), 0) || 0,
            pending_orders: stats?.filter((order)=>order.status === 'pending').length || 0,
            completed_orders: stats?.filter((order)=>order.status === 'delivered').length || 0
        };
        return _server.NextResponse.json({
            success: true,
            data: orders || [],
            pagination: {
                page,
                limit,
                total: count || 0,
                pages: Math.ceil((count || 0) / limit)
            },
            statistics
        });
    } catch (error) {
        console.error('Error en GET /api/user/orders:', error);
        return _server.NextResponse.json({
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}
// ===================================
// Función auxiliar para crear órdenes demo
// ===================================
async function createDemoOrders(userId) {
    if (!_supabase.supabaseAdmin) return;
    try {
        // Obtener algunos productos para las órdenes demo
        const { data: products } = await _supabase.supabaseAdmin.from('products').select('id, name, price').limit(5);
        if (!products || products.length === 0) return;
        // Crear órdenes demo
        const demoOrders = [
            {
                user_id: userId,
                total: 15000.00,
                status: 'delivered',
                payment_id: 'demo_payment_1',
                shipping_address: {
                    name: 'Usuario Demo',
                    street: 'Av. Corrientes 1234',
                    city: 'Buenos Aires',
                    postal_code: '1043',
                    country: 'Argentina'
                }
            },
            {
                user_id: userId,
                total: 8500.00,
                status: 'shipped',
                payment_id: 'demo_payment_2',
                shipping_address: {
                    name: 'Usuario Demo',
                    street: 'Av. Corrientes 1234',
                    city: 'Buenos Aires',
                    postal_code: '1043',
                    country: 'Argentina'
                }
            },
            {
                user_id: userId,
                total: 12300.00,
                status: 'pending',
                payment_id: 'demo_payment_3',
                shipping_address: {
                    name: 'Usuario Demo',
                    street: 'Av. Corrientes 1234',
                    city: 'Buenos Aires',
                    postal_code: '1043',
                    country: 'Argentina'
                }
            }
        ];
        const { data: createdOrders } = await _supabase.supabaseAdmin.from('orders').insert(demoOrders).select();
        // Crear items para cada orden
        if (createdOrders && products.length >= 2) {
            for (const order of createdOrders){
                const orderItems = [
                    {
                        order_id: order.id,
                        product_id: products[0].id,
                        quantity: 2,
                        price: products[0].price
                    },
                    {
                        order_id: order.id,
                        product_id: products[1].id,
                        quantity: 1,
                        price: products[1].price
                    }
                ];
                await _supabase.supabaseAdmin.from('order_items').insert(orderItems);
            }
        }
    } catch (error) {
        console.error('Error al crear órdenes demo:', error);
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXHVzZXJcXG9yZGVyc1xccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gUElOVEVZQSBFLUNPTU1FUkNFIC0gQVBJIERFIMOTUkRFTkVTIERFIFVTVUFSSU9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICdAL2xpYi9zdXBhYmFzZSc7XHJcbmltcG9ydCB7IGF1dGggfSBmcm9tICdAL2F1dGgnO1xyXG5pbXBvcnQgeyBBcGlSZXNwb25zZSB9IGZyb20gJ0AvdHlwZXMvYXBpJztcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEdFVCAtIE9idGVuZXIgw7NyZGVuZXMgZGVsIHVzdWFyaW9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBWZXJpZmljYXIgcXVlIGVsIGNsaWVudGUgYWRtaW5pc3RyYXRpdm8gZXN0w6kgZGlzcG9uaWJsZVxyXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NsaWVudGUgYWRtaW5pc3RyYXRpdm8gZGUgU3VwYWJhc2Ugbm8gZGlzcG9uaWJsZSBlbiBHRVQgL2FwaS91c2VyL29yZGVycycpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ1NlcnZpY2lvIGRlIGJhc2UgZGUgZGF0b3Mgbm8gZGlzcG9uaWJsZScgfSxcclxuICAgICAgICB7IHN0YXR1czogNTAzIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBPYnRlbmVyIHBhcsOhbWV0cm9zIGRlIGNvbnN1bHRhXHJcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XHJcbiAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldCgncGFnZScpIHx8ICcxJyk7XHJcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzEwJyk7XHJcbiAgICBjb25zdCBzdGF0dXMgPSBzZWFyY2hQYXJhbXMuZ2V0KCdzdGF0dXMnKTtcclxuXHJcbiAgICAvLyBQYXJhIGRlbW8sIHVzYXIgdW4gdXN1YXJpbyBmaWpvIG8gY3JlYXIgdW5vIHRlbXBvcmFsXHJcbiAgICBjb25zdCBkZW1vVXNlcklkID0gJ2RlbW8tdXNlci0xMjMnO1xyXG5cclxuICAgIC8vIE9idGVuZXIgdXN1YXJpbyBwcmltZXJvXHJcbiAgICBsZXQgeyBkYXRhOiB1c2VyIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VycycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgLmVxKCdjbGVya19pZCcsIGRlbW9Vc2VySWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgLy8gQ3JlYXIgdXN1YXJpbyBkZW1vIHNpIG5vIGV4aXN0ZVxyXG4gICAgICBjb25zdCB7IGRhdGE6IG5ld1VzZXIsIGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCd1c2VycycpXHJcbiAgICAgICAgLmluc2VydChbXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIGNsZXJrX2lkOiBkZW1vVXNlcklkLFxyXG4gICAgICAgICAgICBlbWFpbDogJ3VzdWFyaW9AZGVtby5jb20nLFxyXG4gICAgICAgICAgICBuYW1lOiAnVXN1YXJpbyBEZW1vJyxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgXSlcclxuICAgICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGNyZWF0ZUVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY3JlYXIgdXN1YXJpbyBkZW1vOicsIGNyZWF0ZUVycm9yKTtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICB7IGVycm9yOiAnRXJyb3IgYWwgb2J0ZW5lciB1c3VhcmlvJyB9LFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFuZXdVc2VyKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3I6IG5ld1VzZXIgZXMgbnVsbCBkZXNwdcOpcyBkZSBsYSBpbnNlcmNpw7NuJyk7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgICAgeyBlcnJvcjogJ0Vycm9yIGFsIGNyZWFyIHVzdWFyaW8nIH0sXHJcbiAgICAgICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDcmVhciBhbGd1bmFzIMOzcmRlbmVzIGRlbW8gcGFyYSBlbCB1c3VhcmlvXHJcbiAgICAgIGF3YWl0IGNyZWF0ZURlbW9PcmRlcnMobmV3VXNlci5pZCk7XHJcblxyXG4gICAgICAvLyBVc2FyIGVsIG51ZXZvIHVzdWFyaW9cclxuICAgICAgdXNlciA9IG5ld1VzZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29uc3RydWlyIHF1ZXJ5IGJhc2VcclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ29yZGVycycpXHJcbiAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgICosXHJcbiAgICAgICAgb3JkZXJfaXRlbXMgKFxyXG4gICAgICAgICAgaWQsXHJcbiAgICAgICAgICBxdWFudGl0eSxcclxuICAgICAgICAgIHByaWNlLFxyXG4gICAgICAgICAgcHJvZHVjdHMgKFxyXG4gICAgICAgICAgICBpZCxcclxuICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgaW1hZ2VzXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKVxyXG4gICAgICBgKVxyXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKTtcclxuXHJcbiAgICAvLyBGaWx0cmFyIHBvciBzdGF0dXMgc2kgc2UgZXNwZWNpZmljYVxyXG4gICAgaWYgKHN0YXR1cyAmJiBzdGF0dXMgIT09ICdhbGwnKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3N0YXR1cycsIHN0YXR1cyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQXBsaWNhciBwYWdpbmFjacOzbiB5IG9yZGVuYW1pZW50b1xyXG4gICAgY29uc3QgZnJvbSA9IChwYWdlIC0gMSkgKiBsaW1pdDtcclxuICAgIGNvbnN0IHRvID0gZnJvbSArIGxpbWl0IC0gMTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IG9yZGVycywgZXJyb3IsIGNvdW50IH0gPSBhd2FpdCBxdWVyeVxyXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgLnJhbmdlKGZyb20sIHRvKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgb2J0ZW5lciDDs3JkZW5lczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAnRXJyb3IgYWwgb2J0ZW5lciDDs3JkZW5lcycgfSxcclxuICAgICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDYWxjdWxhciBlc3RhZMOtc3RpY2FzXHJcbiAgICBjb25zdCB7IGRhdGE6IHN0YXRzIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdvcmRlcnMnKVxyXG4gICAgICAuc2VsZWN0KCdzdGF0dXMsIHRvdGFsJylcclxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlci5pZCk7XHJcblxyXG4gICAgY29uc3Qgc3RhdGlzdGljcyA9IHtcclxuICAgICAgdG90YWxfb3JkZXJzOiBzdGF0cz8ubGVuZ3RoIHx8IDAsXHJcbiAgICAgIHRvdGFsX3NwZW50OiBzdGF0cz8ucmVkdWNlKChzdW0sIG9yZGVyKSA9PiBzdW0gKyBwYXJzZUZsb2F0KG9yZGVyLnRvdGFsKSwgMCkgfHwgMCxcclxuICAgICAgcGVuZGluZ19vcmRlcnM6IHN0YXRzPy5maWx0ZXIob3JkZXIgPT4gb3JkZXIuc3RhdHVzID09PSAncGVuZGluZycpLmxlbmd0aCB8fCAwLFxyXG4gICAgICBjb21wbGV0ZWRfb3JkZXJzOiBzdGF0cz8uZmlsdGVyKG9yZGVyID0+IG9yZGVyLnN0YXR1cyA9PT0gJ2RlbGl2ZXJlZCcpLmxlbmd0aCB8fCAwLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiBvcmRlcnMgfHwgW10sXHJcbiAgICAgIHBhZ2luYXRpb246IHtcclxuICAgICAgICBwYWdlLFxyXG4gICAgICAgIGxpbWl0LFxyXG4gICAgICAgIHRvdGFsOiBjb3VudCB8fCAwLFxyXG4gICAgICAgIHBhZ2VzOiBNYXRoLmNlaWwoKGNvdW50IHx8IDApIC8gbGltaXQpLFxyXG4gICAgICB9LFxyXG4gICAgICBzdGF0aXN0aWNzLFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIEdFVCAvYXBpL3VzZXIvb3JkZXJzOicsIGVycm9yKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBlcnJvcjogJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBGdW5jacOzbiBhdXhpbGlhciBwYXJhIGNyZWFyIMOzcmRlbmVzIGRlbW9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlRGVtb09yZGVycyh1c2VySWQ6IHN0cmluZykge1xyXG4gIGlmICghc3VwYWJhc2VBZG1pbikgcmV0dXJuO1xyXG5cclxuICB0cnkge1xyXG4gICAgLy8gT2J0ZW5lciBhbGd1bm9zIHByb2R1Y3RvcyBwYXJhIGxhcyDDs3JkZW5lcyBkZW1vXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2R1Y3RzIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdwcm9kdWN0cycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBuYW1lLCBwcmljZScpXHJcbiAgICAgIC5saW1pdCg1KTtcclxuXHJcbiAgICBpZiAoIXByb2R1Y3RzIHx8IHByb2R1Y3RzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG5cclxuICAgIC8vIENyZWFyIMOzcmRlbmVzIGRlbW9cclxuICAgIGNvbnN0IGRlbW9PcmRlcnMgPSBbXHJcbiAgICAgIHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgdG90YWw6IDE1MDAwLjAwLFxyXG4gICAgICAgIHN0YXR1czogJ2RlbGl2ZXJlZCcsXHJcbiAgICAgICAgcGF5bWVudF9pZDogJ2RlbW9fcGF5bWVudF8xJyxcclxuICAgICAgICBzaGlwcGluZ19hZGRyZXNzOiB7XHJcbiAgICAgICAgICBuYW1lOiAnVXN1YXJpbyBEZW1vJyxcclxuICAgICAgICAgIHN0cmVldDogJ0F2LiBDb3JyaWVudGVzIDEyMzQnLFxyXG4gICAgICAgICAgY2l0eTogJ0J1ZW5vcyBBaXJlcycsXHJcbiAgICAgICAgICBwb3N0YWxfY29kZTogJzEwNDMnLFxyXG4gICAgICAgICAgY291bnRyeTogJ0FyZ2VudGluYSdcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgdG90YWw6IDg1MDAuMDAsXHJcbiAgICAgICAgc3RhdHVzOiAnc2hpcHBlZCcsXHJcbiAgICAgICAgcGF5bWVudF9pZDogJ2RlbW9fcGF5bWVudF8yJyxcclxuICAgICAgICBzaGlwcGluZ19hZGRyZXNzOiB7XHJcbiAgICAgICAgICBuYW1lOiAnVXN1YXJpbyBEZW1vJyxcclxuICAgICAgICAgIHN0cmVldDogJ0F2LiBDb3JyaWVudGVzIDEyMzQnLFxyXG4gICAgICAgICAgY2l0eTogJ0J1ZW5vcyBBaXJlcycsXHJcbiAgICAgICAgICBwb3N0YWxfY29kZTogJzEwNDMnLFxyXG4gICAgICAgICAgY291bnRyeTogJ0FyZ2VudGluYSdcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgdG90YWw6IDEyMzAwLjAwLFxyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIHBheW1lbnRfaWQ6ICdkZW1vX3BheW1lbnRfMycsXHJcbiAgICAgICAgc2hpcHBpbmdfYWRkcmVzczoge1xyXG4gICAgICAgICAgbmFtZTogJ1VzdWFyaW8gRGVtbycsXHJcbiAgICAgICAgICBzdHJlZXQ6ICdBdi4gQ29ycmllbnRlcyAxMjM0JyxcclxuICAgICAgICAgIGNpdHk6ICdCdWVub3MgQWlyZXMnLFxyXG4gICAgICAgICAgcG9zdGFsX2NvZGU6ICcxMDQzJyxcclxuICAgICAgICAgIGNvdW50cnk6ICdBcmdlbnRpbmEnXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICBdO1xyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogY3JlYXRlZE9yZGVycyB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnb3JkZXJzJylcclxuICAgICAgLmluc2VydChkZW1vT3JkZXJzKVxyXG4gICAgICAuc2VsZWN0KCk7XHJcblxyXG4gICAgLy8gQ3JlYXIgaXRlbXMgcGFyYSBjYWRhIG9yZGVuXHJcbiAgICBpZiAoY3JlYXRlZE9yZGVycyAmJiBwcm9kdWN0cy5sZW5ndGggPj0gMikge1xyXG4gICAgICBmb3IgKGNvbnN0IG9yZGVyIG9mIGNyZWF0ZWRPcmRlcnMpIHtcclxuICAgICAgICBjb25zdCBvcmRlckl0ZW1zID0gW1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBvcmRlcl9pZDogb3JkZXIuaWQsXHJcbiAgICAgICAgICAgIHByb2R1Y3RfaWQ6IHByb2R1Y3RzWzBdLmlkLFxyXG4gICAgICAgICAgICBxdWFudGl0eTogMixcclxuICAgICAgICAgICAgcHJpY2U6IHByb2R1Y3RzWzBdLnByaWNlXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBvcmRlcl9pZDogb3JkZXIuaWQsXHJcbiAgICAgICAgICAgIHByb2R1Y3RfaWQ6IHByb2R1Y3RzWzFdLmlkLFxyXG4gICAgICAgICAgICBxdWFudGl0eTogMSxcclxuICAgICAgICAgICAgcHJpY2U6IHByb2R1Y3RzWzFdLnByaWNlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgLmZyb20oJ29yZGVyX2l0ZW1zJylcclxuICAgICAgICAgIC5pbnNlcnQob3JkZXJJdGVtcyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY3JlYXIgw7NyZGVuZXMgZGVtbzonLCBlcnJvcik7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJHRVQiLCJyZXF1ZXN0Iiwic3VwYWJhc2VBZG1pbiIsImNvbnNvbGUiLCJlcnJvciIsIk5leHRSZXNwb25zZSIsImpzb24iLCJzdGF0dXMiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJwYWdlIiwicGFyc2VJbnQiLCJnZXQiLCJsaW1pdCIsImRlbW9Vc2VySWQiLCJkYXRhIiwidXNlciIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsIm5ld1VzZXIiLCJjcmVhdGVFcnJvciIsImluc2VydCIsImNsZXJrX2lkIiwiZW1haWwiLCJuYW1lIiwiY3JlYXRlRGVtb09yZGVycyIsImlkIiwicXVlcnkiLCJ0byIsIm9yZGVycyIsImNvdW50Iiwib3JkZXIiLCJhc2NlbmRpbmciLCJyYW5nZSIsInN0YXRzIiwic3RhdGlzdGljcyIsInRvdGFsX29yZGVycyIsImxlbmd0aCIsInRvdGFsX3NwZW50IiwicmVkdWNlIiwic3VtIiwicGFyc2VGbG9hdCIsInRvdGFsIiwicGVuZGluZ19vcmRlcnMiLCJmaWx0ZXIiLCJjb21wbGV0ZWRfb3JkZXJzIiwic3VjY2VzcyIsInBhZ2luYXRpb24iLCJwYWdlcyIsIk1hdGgiLCJjZWlsIiwidXNlcklkIiwicHJvZHVjdHMiLCJkZW1vT3JkZXJzIiwidXNlcl9pZCIsInBheW1lbnRfaWQiLCJzaGlwcGluZ19hZGRyZXNzIiwic3RyZWV0IiwiY2l0eSIsInBvc3RhbF9jb2RlIiwiY291bnRyeSIsImNyZWF0ZWRPcmRlcnMiLCJvcmRlckl0ZW1zIiwib3JkZXJfaWQiLCJwcm9kdWN0X2lkIiwicXVhbnRpdHkiLCJwcmljZSJdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBQ3RDLGlEQUFpRDtBQUNqRCxzQ0FBc0M7Ozs7OytCQVVoQkE7OztlQUFBQTs7O3dCQVJvQjswQkFDWjtBQU92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