{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\admin\\useTrackingEvents.ts"],"sourcesContent":["// =====================================================\n// HOOK: TRACKING EVENTS ENTERPRISE\n// Descripción: Hook para gestión de eventos de tracking tiempo real\n// Basado en: Patrones TanStack Query + WebSocket simulation\n// =====================================================\n\n'use client';\n\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useState, useCallback, useEffect } from 'react';\nimport { toast } from 'sonner';\nimport { \n  TrackingEvent,\n  CreateTrackingEventRequest,\n  Shipment,\n  UseTrackingEventsReturn \n} from '@/types/logistics';\n\n// =====================================================\n// CONFIGURACIÓN DE QUERIES\n// =====================================================\n\nconst TRACKING_QUERY_KEY = ['admin', 'logistics', 'tracking'];\nconst REAL_TIME_REFETCH_INTERVAL = 30000; // 30 segundos\n\n// =====================================================\n// FUNCIONES DE API\n// =====================================================\n\nasync function fetchTrackingEvents(shipmentId: number): Promise<{\n  shipment: Shipment;\n  tracking_events: TrackingEvent[];\n}> {\n  const response = await fetch(`/api/admin/logistics/tracking/${shipmentId}`, {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json',\n    }\n  });\n  \n  if (!response.ok) {\n    const errorData = await response.json().catch(() => ({}));\n    throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);\n  }\n  \n  const result = await response.json();\n  return result.data;\n}\n\nasync function createTrackingEvent(\n  shipmentId: number, \n  data: Omit<CreateTrackingEventRequest, 'shipment_id'>\n): Promise<TrackingEvent> {\n  const response = await fetch(`/api/admin/logistics/tracking/${shipmentId}`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(data)\n  });\n  \n  if (!response.ok) {\n    const errorData = await response.json().catch(() => ({}));\n    throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);\n  }\n  \n  const result = await response.json();\n  return result.data;\n}\n\nasync function bulkCreateTrackingEvents(\n  shipmentId: number,\n  events: Omit<CreateTrackingEventRequest, 'shipment_id'>[]\n): Promise<TrackingEvent[]> {\n  const response = await fetch(`/api/admin/logistics/tracking/${shipmentId}`, {\n    method: 'PUT',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({ events })\n  });\n  \n  if (!response.ok) {\n    const errorData = await response.json().catch(() => ({}));\n    throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);\n  }\n  \n  const result = await response.json();\n  return result.data;\n}\n\n// =====================================================\n// HOOK PRINCIPAL: useTrackingEvents\n// =====================================================\n\nexport function useTrackingEvents(\n  shipmentId: number,\n  options?: {\n    enabled?: boolean;\n    refetchInterval?: number;\n    realTime?: boolean;\n  }\n): UseTrackingEventsReturn {\n  const queryClient = useQueryClient();\n  \n  const queryKey = [...TRACKING_QUERY_KEY, shipmentId];\n  \n  const {\n    data,\n    isLoading,\n    error,\n    refetch\n  } = useQuery({\n    queryKey,\n    queryFn: () => fetchTrackingEvents(shipmentId),\n    enabled: options?.enabled ?? true,\n    refetchInterval: options?.realTime \n      ? (options?.refetchInterval ?? REAL_TIME_REFETCH_INTERVAL)\n      : false,\n    staleTime: options?.realTime ? 10000 : 60000,\n    retry: 3,\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000)\n  });\n  \n  return {\n    data: data?.tracking_events,\n    shipment: data?.shipment,\n    isLoading,\n    error: error as Error | null,\n    refetch\n  };\n}\n\n// =====================================================\n// HOOK: useCreateTrackingEvent\n// =====================================================\n\nexport function useCreateTrackingEvent(shipmentId: number) {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: (data: Omit<CreateTrackingEventRequest, 'shipment_id'>) => \n      createTrackingEvent(shipmentId, data),\n    onSuccess: (newEvent) => {\n      // Actualizar cache de tracking events\n      const queryKey = [...TRACKING_QUERY_KEY, shipmentId];\n      \n      queryClient.setQueryData(queryKey, (oldData: any) => {\n        if (!oldData) return oldData;\n        \n        return {\n          ...oldData,\n          tracking_events: [newEvent, ...oldData.tracking_events]\n        };\n      });\n      \n      // Invalidar cache relacionado\n      queryClient.invalidateQueries({ queryKey: ['admin', 'logistics', 'shipments'] });\n      queryClient.invalidateQueries({ queryKey: ['admin', 'logistics', 'dashboard'] });\n      \n      toast.success('Evento de tracking agregado', {\n        description: newEvent.description\n      });\n    },\n    onError: (error: Error) => {\n      toast.error('Error al agregar evento', {\n        description: error.message\n      });\n    }\n  });\n}\n\n// =====================================================\n// HOOK: useBulkTrackingEvents\n// =====================================================\n\nexport function useBulkTrackingEvents(shipmentId: number) {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: (events: Omit<CreateTrackingEventRequest, 'shipment_id'>[]) => \n      bulkCreateTrackingEvents(shipmentId, events),\n    onSuccess: (newEvents) => {\n      // Actualizar cache\n      const queryKey = [...TRACKING_QUERY_KEY, shipmentId];\n      \n      queryClient.setQueryData(queryKey, (oldData: any) => {\n        if (!oldData) return oldData;\n        \n        return {\n          ...oldData,\n          tracking_events: [...newEvents, ...oldData.tracking_events]\n        };\n      });\n      \n      // Invalidar cache relacionado\n      queryClient.invalidateQueries({ queryKey: ['admin', 'logistics', 'shipments'] });\n      queryClient.invalidateQueries({ queryKey: ['admin', 'logistics', 'dashboard'] });\n      \n      toast.success(`${newEvents.length} eventos agregados exitosamente`);\n    },\n    onError: (error: Error) => {\n      toast.error('Error al agregar eventos', {\n        description: error.message\n      });\n    }\n  });\n}\n\n// =====================================================\n// HOOK: useTrackingTimeline\n// =====================================================\n\nexport function useTrackingTimeline(shipmentId: number) {\n  const { data: events, shipment, isLoading, error } = useTrackingEvents(shipmentId, {\n    realTime: true\n  });\n  \n  // Procesar eventos para timeline\n  const timelineEvents = events?.map(event => ({\n    ...event,\n    isCompleted: true,\n    isCurrent: false,\n    isPending: false\n  })).sort((a, b) => \n    new Date(a.occurred_at).getTime() - new Date(b.occurred_at).getTime()\n  ) || [];\n  \n  // Determinar estado actual\n  const currentStatus = shipment?.status;\n  const lastEvent = timelineEvents[timelineEvents.length - 1];\n  \n  // Estados esperados del timeline\n  const expectedStates = [\n    { status: 'pending', label: 'Pendiente', description: 'Envío creado' },\n    { status: 'confirmed', label: 'Confirmado', description: 'Envío confirmado' },\n    { status: 'picked_up', label: 'Recolectado', description: 'Recolectado por courier' },\n    { status: 'in_transit', label: 'En tránsito', description: 'En camino' },\n    { status: 'out_for_delivery', label: 'En reparto', description: 'Salió para entrega' },\n    { status: 'delivered', label: 'Entregado', description: 'Entregado exitosamente' }\n  ];\n  \n  const timelineStates = expectedStates.map(state => {\n    const hasEvent = timelineEvents.some(event => event.status === state.status);\n    const isCurrent = currentStatus === state.status;\n    const isCompleted = hasEvent && !isCurrent;\n    const isPending = !hasEvent && !isCurrent;\n    \n    return {\n      ...state,\n      hasEvent,\n      isCurrent,\n      isCompleted,\n      isPending,\n      event: timelineEvents.find(event => event.status === state.status)\n    };\n  });\n  \n  return {\n    events: timelineEvents,\n    timelineStates,\n    shipment,\n    currentStatus,\n    lastEvent,\n    isLoading,\n    error,\n    progress: {\n      completed: timelineStates.filter(state => state.isCompleted).length,\n      total: timelineStates.length,\n      percentage: (timelineStates.filter(state => state.isCompleted).length / timelineStates.length) * 100\n    }\n  };\n}\n\n// =====================================================\n// HOOK: useRealTimeTracking\n// =====================================================\n\nexport function useRealTimeTracking(shipmentId: number) {\n  const [isRealTimeEnabled, setIsRealTimeEnabled] = useState(false);\n  const [lastUpdate, setLastUpdate] = useState<Date | null>(null);\n  \n  const { data: events, refetch } = useTrackingEvents(shipmentId, {\n    realTime: isRealTimeEnabled,\n    refetchInterval: 15000 // 15 segundos para tiempo real\n  });\n  \n  // Simular notificaciones de nuevos eventos\n  useEffect(() => {\n    if (events && events.length > 0) {\n      setLastUpdate(new Date());\n    }\n  }, [events]);\n  \n  const enableRealTime = useCallback(() => {\n    setIsRealTimeEnabled(true);\n    toast.info('Tracking en tiempo real activado');\n  }, []);\n  \n  const disableRealTime = useCallback(() => {\n    setIsRealTimeEnabled(false);\n    toast.info('Tracking en tiempo real desactivado');\n  }, []);\n  \n  const forceRefresh = useCallback(async () => {\n    await refetch();\n    setLastUpdate(new Date());\n    toast.success('Tracking actualizado');\n  }, [refetch]);\n  \n  return {\n    events,\n    isRealTimeEnabled,\n    lastUpdate,\n    enableRealTime,\n    disableRealTime,\n    forceRefresh\n  };\n}\n\n// =====================================================\n// HOOK: useTrackingAnalytics\n// =====================================================\n\nexport function useTrackingAnalytics(shipmentId: number) {\n  const { data: events, shipment } = useTrackingEvents(shipmentId);\n  \n  if (!events || !shipment) {\n    return null;\n  }\n  \n  // Calcular métricas\n  const totalEvents = events.length;\n  const uniqueLocations = [...new Set(events.map(e => e.location).filter(Boolean))].length;\n  \n  // Tiempo entre eventos\n  const eventTimes = events\n    .map(e => new Date(e.occurred_at).getTime())\n    .sort((a, b) => a - b);\n  \n  const averageTimeBetweenEvents = eventTimes.length > 1\n    ? eventTimes.slice(1).reduce((acc, time, index) => {\n        return acc + (time - eventTimes[index]);\n      }, 0) / (eventTimes.length - 1)\n    : 0;\n  \n  // Tiempo total de tránsito\n  const firstEvent = events[events.length - 1]; // Más antiguo\n  const lastEvent = events[0]; // Más reciente\n  \n  const totalTransitTime = firstEvent && lastEvent\n    ? new Date(lastEvent.occurred_at).getTime() - new Date(firstEvent.occurred_at).getTime()\n    : 0;\n  \n  // Velocidad promedio (si hay ubicaciones)\n  const eventsWithLocation = events.filter(e => e.latitude && e.longitude);\n  let averageSpeed = 0;\n  \n  if (eventsWithLocation.length > 1) {\n    // Calcular distancia total aproximada entre puntos\n    // (implementación simplificada)\n    averageSpeed = uniqueLocations / (totalTransitTime / (1000 * 60 * 60)); // km/h aproximado\n  }\n  \n  return {\n    totalEvents,\n    uniqueLocations,\n    averageTimeBetweenEvents: averageTimeBetweenEvents / (1000 * 60), // minutos\n    totalTransitTime: totalTransitTime / (1000 * 60 * 60), // horas\n    averageSpeed: Math.round(averageSpeed * 10) / 10,\n    eventsWithLocation: eventsWithLocation.length,\n    locationCoverage: eventsWithLocation.length / totalEvents * 100\n  };\n}\n\n// =====================================================\n// TIPOS EXTENDIDOS\n// =====================================================\n\nexport interface UseTrackingEventsExtendedReturn extends UseTrackingEventsReturn {\n  shipment?: Shipment;\n}\n"],"names":["useBulkTrackingEvents","useCreateTrackingEvent","useRealTimeTracking","useTrackingAnalytics","useTrackingEvents","useTrackingTimeline","TRACKING_QUERY_KEY","REAL_TIME_REFETCH_INTERVAL","fetchTrackingEvents","shipmentId","response","fetch","method","headers","ok","errorData","json","catch","Error","error","status","statusText","result","data","createTrackingEvent","body","JSON","stringify","bulkCreateTrackingEvents","events","options","queryClient","useQueryClient","queryKey","isLoading","refetch","useQuery","queryFn","enabled","refetchInterval","realTime","staleTime","retry","retryDelay","attemptIndex","Math","min","tracking_events","shipment","useMutation","mutationFn","onSuccess","newEvent","setQueryData","oldData","invalidateQueries","toast","success","description","onError","message","newEvents","length","timelineEvents","map","event","isCompleted","isCurrent","isPending","sort","a","b","Date","occurred_at","getTime","currentStatus","lastEvent","expectedStates","label","timelineStates","state","hasEvent","some","find","progress","completed","filter","total","percentage","isRealTimeEnabled","setIsRealTimeEnabled","useState","lastUpdate","setLastUpdate","useEffect","enableRealTime","useCallback","info","disableRealTime","forceRefresh","totalEvents","uniqueLocations","Set","e","location","Boolean","eventTimes","averageTimeBetweenEvents","slice","reduce","acc","time","index","firstEvent","totalTransitTime","eventsWithLocation","latitude","longitude","averageSpeed","round","locationCoverage"],"mappings":"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"}