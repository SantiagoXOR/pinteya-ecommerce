4ef11181e6ef56973ad415a2ecf75ae6
// 游빍 Enterprise Unit Tests - Product Images API
"use strict";
jest.mock('@supabase/supabase-js', ()=>({
        createClient: jest.fn(()=>mockSupabaseGlobal || {
                from: jest.fn(()=>({
                        select: jest.fn(()=>({
                                eq: jest.fn(()=>({
                                        single: jest.fn(),
                                        order: jest.fn(()=>({
                                                order: jest.fn()
                                            }))
                                    }))
                            })),
                        insert: jest.fn(()=>({
                                select: jest.fn(()=>({
                                        single: jest.fn()
                                    }))
                            })),
                        update: jest.fn(()=>({
                                eq: jest.fn(()=>({
                                        neq: jest.fn()
                                    }))
                            }))
                    })),
                storage: {
                    from: jest.fn(()=>({
                            upload: mockStorageUpload,
                            getPublicUrl: mockStorageGetPublicUrl,
                            remove: mockStorageRemove
                        }))
                }
            })
    }));
// Mock middleware
jest.mock('@/lib/api/middleware-composer', ()=>({
        composeMiddlewares: jest.fn((...middlewares)=>(handler)=>handler)
    }));
jest.mock('@/lib/api/error-handler', ()=>({
        withErrorHandler: jest.fn((handler)=>handler),
        ApiError: class ApiError extends Error {
            constructor(message, statusCode = 500){
                super(message), this.statusCode = statusCode;
            }
        },
        ValidationError: class ValidationError extends Error {
            constructor(message, details){
                super(message), this.details = details;
                this.name = 'ValidationError';
                this.details = details;
            }
        },
        NotFoundError: class NotFoundError extends Error {
            constructor(resource){
                super(`${resource} no encontrado`);
                this.name = 'NotFoundError';
            }
        }
    }));
jest.mock('@/lib/api/api-logger', ()=>({
        withApiLogging: jest.fn((handler)=>handler),
        logAdminAction: jest.fn()
    }));
jest.mock('@/lib/auth/api-auth-middleware', ()=>({
        withAdminAuth: jest.fn(()=>(handler)=>handler)
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _route = require("../route");
// Mock Supabase Storage
const mockStorageUpload = jest.fn();
const mockStorageGetPublicUrl = jest.fn();
const mockStorageRemove = jest.fn();
// Global mock for createClient - will be configured per test
let mockSupabaseGlobal;
describe('/api/admin/products/[id]/images - Enterprise API Tests', ()=>{
    // UUIDs v치lidos para testing
    const TEST_PRODUCT_ID = '550e8400-e29b-41d4-a716-446655440000';
    const TEST_IMAGE_ID = '550e8400-e29b-41d4-a716-446655440001';
    let mockSupabase;
    let mockRequest;
    // Helper function to create consistent mock chains
    const createMockChain = (finalResult)=>({
            select: jest.fn().mockReturnValue({
                eq: jest.fn().mockReturnValue({
                    order: jest.fn().mockReturnValue({
                        order: jest.fn().mockResolvedValue(finalResult)
                    }),
                    single: jest.fn().mockResolvedValue(finalResult)
                })
            }),
            insert: jest.fn().mockReturnValue({
                select: jest.fn().mockReturnValue({
                    single: jest.fn().mockResolvedValue(finalResult)
                })
            }),
            update: jest.fn().mockReturnValue({
                eq: jest.fn().mockReturnValue({
                    neq: jest.fn().mockResolvedValue(finalResult)
                })
            })
        });
    beforeEach(()=>{
        jest.clearAllMocks();
        // Create a simple mock that will be configured per test
        mockSupabase = {
            from: jest.fn(),
            storage: {
                from: jest.fn(()=>({
                        upload: mockStorageUpload,
                        getPublicUrl: mockStorageGetPublicUrl,
                        remove: mockStorageRemove
                    }))
            }
        };
        // Set the global mock to use our local mock
        mockSupabaseGlobal = mockSupabase;
        mockRequest = {
            supabase: mockSupabase,
            user: {
                id: 'test-user-id'
            }
        };
        // Reset storage mocks
        mockStorageUpload.mockReset();
        mockStorageGetPublicUrl.mockReset();
        mockStorageRemove.mockReset();
        // Configure default storage mock responses
        mockStorageRemove.mockResolvedValue({
            error: null
        });
        mockStorageRemove.mockReset();
    });
    describe('GET /api/admin/products/[id]/images', ()=>{
        it('should return product images successfully', async ()=>{
            const mockImages = [
                {
                    id: 'image-1',
                    url: 'https://example.com/image1.jpg',
                    alt_text: 'Image 1',
                    is_primary: true,
                    display_order: 0
                },
                {
                    id: 'image-2',
                    url: 'https://example.com/image2.jpg',
                    alt_text: 'Image 2',
                    is_primary: false,
                    display_order: 1
                }
            ];
            // Configure the mock to return data directly
            mockSupabase.from.mockReturnValue(createMockChain({
                data: mockImages,
                error: null
            }));
            const response = await (0, _route.GET)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            });
            const responseData = await response.json();
            // Debug logs removed - test working correctly
            expect(response.status).toBe(200);
            expect(responseData.success).toBe(true);
            expect(responseData.data).toHaveLength(2);
            expect(responseData.data[0].is_primary).toBe(true);
        });
        it('should handle empty images list', async ()=>{
            mockSupabase.from.mockReturnValue(createMockChain({
                data: [],
                error: null
            }));
            const response = await (0, _route.GET)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            });
            const responseData = await response.json();
            expect(response.status).toBe(200);
            expect(responseData.success).toBe(true);
            expect(responseData.data).toHaveLength(0);
        });
        it('should validate product ID format', async ()=>{
            await expect((0, _route.GET)(mockRequest, {
                params: {
                    id: 'invalid-uuid'
                }
            })).rejects.toThrow('ID de producto inv치lido');
        });
        it('should handle database errors', async ()=>{
            mockSupabase.from.mockReturnValue(createMockChain({
                data: null,
                error: {
                    message: 'Database error'
                }
            }));
            await expect((0, _route.GET)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            })).rejects.toThrow('Error al obtener im치genes');
        });
    });
    describe('POST /api/admin/products/[id]/images', ()=>{
        let mockFile;
        let mockFormData;
        beforeEach(()=>{
            // Create mock file
            mockFile = new File([
                'test content'
            ], 'test-image.jpg', {
                type: 'image/jpeg'
            });
            // Create mock FormData
            mockFormData = new FormData();
            mockFormData.append('file', mockFile);
            mockFormData.append('alt_text', 'Test image');
            mockFormData.append('is_primary', 'true');
            // Mock request.formData()
            mockRequest.formData = jest.fn().mockResolvedValue(mockFormData);
            // Mock product exists check using new methodology
            mockSupabase.from.mockReturnValue(createMockChain({
                data: {
                    id: TEST_PRODUCT_ID,
                    name: 'Test Product'
                },
                error: null
            }));
        });
        it('should upload image successfully', async ()=>{
            // Mock storage upload
            mockStorageUpload.mockResolvedValue({
                data: {
                    path: `products/${TEST_PRODUCT_ID}/123_test-image.jpg`
                },
                error: null
            });
            mockStorageGetPublicUrl.mockReturnValue({
                data: {
                    publicUrl: 'https://storage.example.com/test-image.jpg'
                }
            });
            // Mock database insert
            const mockImageRecord = {
                id: 'new-image-id',
                product_id: TEST_PRODUCT_ID,
                url: 'https://storage.example.com/test-image.jpg',
                alt_text: 'Test image',
                is_primary: true
            };
            mockSupabase.from().insert().select().single.mockResolvedValue({
                data: mockImageRecord,
                error: null
            });
            // Mock update other images to not primary
            mockSupabase.from().update().eq().neq.mockResolvedValue({
                error: null
            });
            const response = await (0, _route.POST)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            });
            const responseData = await response.json();
            expect(response.status).toBe(201);
            expect(responseData.success).toBe(true);
            expect(responseData.data.url).toBe('https://storage.example.com/test-image.jpg');
            expect(responseData.message).toBe('Imagen subida exitosamente');
            // Verify storage upload was called
            expect(mockStorageUpload).toHaveBeenCalledWith(expect.stringContaining(`products/${TEST_PRODUCT_ID}/`), mockFile, expect.objectContaining({
                cacheControl: '3600',
                upsert: false
            }));
        });
        it('should validate file type', async ()=>{
            const invalidFile = new File([
                'test'
            ], 'test.txt', {
                type: 'text/plain'
            });
            mockFormData.set('file', invalidFile);
            await expect((0, _route.POST)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            })).rejects.toThrow('Tipo de archivo no permitido');
        });
        it('should validate file size', async ()=>{
            // Create a large file (6MB)
            const largeContent = new Array(6 * 1024 * 1024).fill('a').join('');
            const largeFile = new File([
                largeContent
            ], 'large.jpg', {
                type: 'image/jpeg'
            });
            mockFormData.set('file', largeFile);
            await expect((0, _route.POST)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            })).rejects.toThrow('El archivo es demasiado grande');
        });
        it('should handle missing file', async ()=>{
            mockFormData.delete('file');
            await expect((0, _route.POST)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            })).rejects.toThrow('No se proporcion칩 archivo');
        });
        it('should handle product not found', async ()=>{
            // Use valid UUID but configure mock to return product not found
            mockSupabase.from.mockReturnValue(createMockChain({
                data: null,
                error: {
                    message: 'Product not found'
                }
            }));
            await expect((0, _route.POST)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            })).rejects.toThrow('Producto no encontrado');
        });
        it('should handle storage upload errors', async ()=>{
            mockStorageUpload.mockResolvedValue({
                data: null,
                error: {
                    message: 'Storage error'
                }
            });
            await expect((0, _route.POST)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            })).rejects.toThrow('Error al subir imagen');
        });
        it('should cleanup storage on database insert failure', async ()=>{
            // Mock successful storage upload
            mockStorageUpload.mockResolvedValue({
                data: {
                    path: `products/${TEST_PRODUCT_ID}/test-image.jpg`
                },
                error: null
            });
            mockStorageGetPublicUrl.mockReturnValue({
                data: {
                    publicUrl: 'https://storage.example.com/test-image.jpg'
                }
            });
            // Mock database insert failure using new methodology
            mockSupabase.from.mockReturnValue(createMockChain({
                data: null,
                error: {
                    message: 'Database error'
                }
            }));
            await expect((0, _route.POST)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            })).rejects.toThrow('Error al guardar imagen en base de datos');
            // Verify cleanup was attempted
            expect(mockStorageRemove).toHaveBeenCalledWith([
                `products/${TEST_PRODUCT_ID}/test-image.jpg`
            ]);
        });
        it('should update other images when setting as primary', async ()=>{
            mockStorageUpload.mockResolvedValue({
                data: {
                    path: 'test-path'
                },
                error: null
            });
            mockStorageGetPublicUrl.mockReturnValue({
                data: {
                    publicUrl: 'https://example.com/image.jpg'
                }
            });
            const mockImageRecord = {
                id: 'new-image-id',
                is_primary: true
            };
            mockSupabase.from().insert().select().single.mockResolvedValue({
                data: mockImageRecord,
                error: null
            });
            await (0, _route.POST)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            });
            // Verify other images were updated to not primary
            expect(mockSupabase.from().update).toHaveBeenCalledWith({
                is_primary: false
            });
        });
        it('should generate unique filename', async ()=>{
            mockStorageUpload.mockResolvedValue({
                data: {
                    path: 'test-path'
                },
                error: null
            });
            mockStorageGetPublicUrl.mockReturnValue({
                data: {
                    publicUrl: 'https://example.com/image.jpg'
                }
            });
            mockSupabase.from().insert().select().single.mockResolvedValue({
                data: {
                    id: 'test-id'
                },
                error: null
            });
            await (0, _route.POST)(mockRequest, {
                params: {
                    id: TEST_PRODUCT_ID
                }
            });
            // Verify filename includes product ID and timestamp
            const uploadCall = mockStorageUpload.mock.calls[0];
            const filename = uploadCall[0];
            expect(filename).toContain(`products/${TEST_PRODUCT_ID}/`);
            expect(filename).toContain('test-image.jpg');
        });
    });
    describe('File Validation', ()=>{
        const validTypes = [
            'image/jpeg',
            'image/jpg',
            'image/png',
            'image/webp'
        ];
        const invalidTypes = [
            'text/plain',
            'application/pdf',
            'video/mp4'
        ];
        validTypes.forEach((type)=>{
            it(`should accept ${type} files`, async ()=>{
                const file = new File([
                    'content'
                ], 'test.jpg', {
                    type
                });
                const formData = new FormData();
                formData.append('file', file);
                mockRequest.formData = jest.fn().mockResolvedValue(formData);
                mockSupabase.from.mockReturnValue(createMockChain({
                    data: {
                        id: TEST_PRODUCT_ID
                    },
                    error: null
                }));
                mockStorageUpload.mockResolvedValue({
                    data: {
                        path: 'test-path'
                    },
                    error: null
                });
                mockStorageGetPublicUrl.mockReturnValue({
                    data: {
                        publicUrl: 'https://example.com/image.jpg'
                    }
                });
                mockSupabase.from().insert().select().single.mockResolvedValue({
                    data: {
                        id: 'test-id'
                    },
                    error: null
                });
                const response = await (0, _route.POST)(mockRequest, {
                    params: {
                        id: TEST_PRODUCT_ID
                    }
                });
                expect(response.status).toBe(201);
            });
        });
        invalidTypes.forEach((type)=>{
            it(`should reject ${type} files`, async ()=>{
                const file = new File([
                    'content'
                ], 'test.txt', {
                    type
                });
                const formData = new FormData();
                formData.append('file', file);
                mockRequest.formData = jest.fn().mockResolvedValue(formData);
                mockSupabase.from.mockReturnValue(createMockChain({
                    data: {
                        id: TEST_PRODUCT_ID
                    },
                    error: null
                }));
                await expect((0, _route.POST)(mockRequest, {
                    params: {
                        id: TEST_PRODUCT_ID
                    }
                })).rejects.toThrow('Tipo de archivo no permitido');
            });
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXGFkbWluXFxwcm9kdWN0c1xcW2lkXVxcaW1hZ2VzXFxfX3Rlc3RzX19cXHJvdXRlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8g8J+nqiBFbnRlcnByaXNlIFVuaXQgVGVzdHMgLSBQcm9kdWN0IEltYWdlcyBBUElcblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBHRVQsIFBPU1QgfSBmcm9tICcuLi9yb3V0ZSc7XG5cbi8vIE1vY2sgU3VwYWJhc2UgU3RvcmFnZVxuY29uc3QgbW9ja1N0b3JhZ2VVcGxvYWQgPSBqZXN0LmZuKCk7XG5jb25zdCBtb2NrU3RvcmFnZUdldFB1YmxpY1VybCA9IGplc3QuZm4oKTtcbmNvbnN0IG1vY2tTdG9yYWdlUmVtb3ZlID0gamVzdC5mbigpO1xuXG4vLyBHbG9iYWwgbW9jayBmb3IgY3JlYXRlQ2xpZW50IC0gd2lsbCBiZSBjb25maWd1cmVkIHBlciB0ZXN0XG5sZXQgbW9ja1N1cGFiYXNlR2xvYmFsOiBhbnk7XG5cbmplc3QubW9jaygnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJywgKCkgPT4gKHtcbiAgY3JlYXRlQ2xpZW50OiBqZXN0LmZuKCgpID0+IG1vY2tTdXBhYmFzZUdsb2JhbCB8fCB7XG4gICAgZnJvbTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCksXG4gICAgICAgICAgb3JkZXI6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgICAgIG9yZGVyOiBqZXN0LmZuKCksXG4gICAgICAgICAgfSkpLFxuICAgICAgICB9KSksXG4gICAgICB9KSksXG4gICAgICBpbnNlcnQ6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCksXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKSxcbiAgICAgIHVwZGF0ZTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICBlcTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICAgIG5lcTogamVzdC5mbigpLFxuICAgICAgICB9KSksXG4gICAgICB9KSksXG4gICAgfSkpLFxuICAgIHN0b3JhZ2U6IHtcbiAgICAgIGZyb206IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgdXBsb2FkOiBtb2NrU3RvcmFnZVVwbG9hZCxcbiAgICAgICAgZ2V0UHVibGljVXJsOiBtb2NrU3RvcmFnZUdldFB1YmxpY1VybCxcbiAgICAgICAgcmVtb3ZlOiBtb2NrU3RvcmFnZVJlbW92ZSxcbiAgICAgIH0pKSxcbiAgICB9LFxuICB9KSxcbn0pKTtcblxuLy8gTW9jayBtaWRkbGV3YXJlXG5qZXN0Lm1vY2soJ0AvbGliL2FwaS9taWRkbGV3YXJlLWNvbXBvc2VyJywgKCkgPT4gKHtcbiAgY29tcG9zZU1pZGRsZXdhcmVzOiBqZXN0LmZuKCguLi5taWRkbGV3YXJlcykgPT4gKGhhbmRsZXIpID0+IGhhbmRsZXIpLFxufSkpO1xuXG5qZXN0Lm1vY2soJ0AvbGliL2FwaS9lcnJvci1oYW5kbGVyJywgKCkgPT4gKHtcbiAgd2l0aEVycm9ySGFuZGxlcjogamVzdC5mbigoaGFuZGxlcikgPT4gaGFuZGxlciksXG4gIEFwaUVycm9yOiBjbGFzcyBBcGlFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcsIHB1YmxpYyBzdGF0dXNDb2RlOiBudW1iZXIgPSA1MDApIHtcbiAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgIH1cbiAgfSxcbiAgVmFsaWRhdGlvbkVycm9yOiBjbGFzcyBWYWxpZGF0aW9uRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nLCBwdWJsaWMgZGV0YWlscz86IGFueSkge1xuICAgICAgc3VwZXIobWVzc2FnZSk7XG4gICAgICB0aGlzLm5hbWUgPSAnVmFsaWRhdGlvbkVycm9yJztcbiAgICAgIHRoaXMuZGV0YWlscyA9IGRldGFpbHM7XG4gICAgfVxuICB9LFxuICBOb3RGb3VuZEVycm9yOiBjbGFzcyBOb3RGb3VuZEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKHJlc291cmNlOiBzdHJpbmcpIHtcbiAgICAgIHN1cGVyKGAke3Jlc291cmNlfSBubyBlbmNvbnRyYWRvYCk7XG4gICAgICB0aGlzLm5hbWUgPSAnTm90Rm91bmRFcnJvcic7XG4gICAgfVxuICB9LFxufSkpO1xuXG5qZXN0Lm1vY2soJ0AvbGliL2FwaS9hcGktbG9nZ2VyJywgKCkgPT4gKHtcbiAgd2l0aEFwaUxvZ2dpbmc6IGplc3QuZm4oKGhhbmRsZXIpID0+IGhhbmRsZXIpLFxuICBsb2dBZG1pbkFjdGlvbjogamVzdC5mbigpLFxufSkpO1xuXG5qZXN0Lm1vY2soJ0AvbGliL2F1dGgvYXBpLWF1dGgtbWlkZGxld2FyZScsICgpID0+ICh7XG4gIHdpdGhBZG1pbkF1dGg6IGplc3QuZm4oKCkgPT4gKGhhbmRsZXIpID0+IGhhbmRsZXIpLFxufSkpO1xuXG5kZXNjcmliZSgnL2FwaS9hZG1pbi9wcm9kdWN0cy9baWRdL2ltYWdlcyAtIEVudGVycHJpc2UgQVBJIFRlc3RzJywgKCkgPT4ge1xuICAvLyBVVUlEcyB2w6FsaWRvcyBwYXJhIHRlc3RpbmdcbiAgY29uc3QgVEVTVF9QUk9EVUNUX0lEID0gJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCc7XG4gIGNvbnN0IFRFU1RfSU1BR0VfSUQgPSAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAxJztcblxuICBsZXQgbW9ja1N1cGFiYXNlOiBhbnk7XG4gIGxldCBtb2NrUmVxdWVzdDogYW55O1xuXG4gIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgY29uc2lzdGVudCBtb2NrIGNoYWluc1xuICBjb25zdCBjcmVhdGVNb2NrQ2hhaW4gPSAoZmluYWxSZXN1bHQ6IGFueSkgPT4gKHtcbiAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgZXE6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBvcmRlcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgb3JkZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShmaW5hbFJlc3VsdClcbiAgICAgICAgfSksXG4gICAgICAgIHNpbmdsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKGZpbmFsUmVzdWx0KVxuICAgICAgfSlcbiAgICB9KSxcbiAgICBpbnNlcnQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgc2luZ2xlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZmluYWxSZXN1bHQpXG4gICAgICB9KVxuICAgIH0pLFxuICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIG5lcTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKGZpbmFsUmVzdWx0KVxuICAgICAgfSlcbiAgICB9KVxuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcblxuICAgIC8vIENyZWF0ZSBhIHNpbXBsZSBtb2NrIHRoYXQgd2lsbCBiZSBjb25maWd1cmVkIHBlciB0ZXN0XG4gICAgbW9ja1N1cGFiYXNlID0ge1xuICAgICAgZnJvbTogamVzdC5mbigpLFxuICAgICAgc3RvcmFnZToge1xuICAgICAgICBmcm9tOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgICAgdXBsb2FkOiBtb2NrU3RvcmFnZVVwbG9hZCxcbiAgICAgICAgICBnZXRQdWJsaWNVcmw6IG1vY2tTdG9yYWdlR2V0UHVibGljVXJsLFxuICAgICAgICAgIHJlbW92ZTogbW9ja1N0b3JhZ2VSZW1vdmUsXG4gICAgICAgIH0pKSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIC8vIFNldCB0aGUgZ2xvYmFsIG1vY2sgdG8gdXNlIG91ciBsb2NhbCBtb2NrXG4gICAgbW9ja1N1cGFiYXNlR2xvYmFsID0gbW9ja1N1cGFiYXNlO1xuXG4gICAgbW9ja1JlcXVlc3QgPSB7XG4gICAgICBzdXBhYmFzZTogbW9ja1N1cGFiYXNlLFxuICAgICAgdXNlcjogeyBpZDogJ3Rlc3QtdXNlci1pZCcgfSxcbiAgICB9IGFzIGFueTtcblxuICAgIC8vIFJlc2V0IHN0b3JhZ2UgbW9ja3NcbiAgICBtb2NrU3RvcmFnZVVwbG9hZC5tb2NrUmVzZXQoKTtcbiAgICBtb2NrU3RvcmFnZUdldFB1YmxpY1VybC5tb2NrUmVzZXQoKTtcbiAgICBtb2NrU3RvcmFnZVJlbW92ZS5tb2NrUmVzZXQoKTtcblxuICAgIC8vIENvbmZpZ3VyZSBkZWZhdWx0IHN0b3JhZ2UgbW9jayByZXNwb25zZXNcbiAgICBtb2NrU3RvcmFnZVJlbW92ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGVycm9yOiBudWxsIH0pO1xuICAgIG1vY2tTdG9yYWdlUmVtb3ZlLm1vY2tSZXNldCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9hcGkvYWRtaW4vcHJvZHVjdHMvW2lkXS9pbWFnZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvZHVjdCBpbWFnZXMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ltYWdlcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnaW1hZ2UtMScsXG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZTEuanBnJyxcbiAgICAgICAgICBhbHRfdGV4dDogJ0ltYWdlIDEnLFxuICAgICAgICAgIGlzX3ByaW1hcnk6IHRydWUsXG4gICAgICAgICAgZGlzcGxheV9vcmRlcjogMCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnaW1hZ2UtMicsXG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZTIuanBnJyxcbiAgICAgICAgICBhbHRfdGV4dDogJ0ltYWdlIDInLFxuICAgICAgICAgIGlzX3ByaW1hcnk6IGZhbHNlLFxuICAgICAgICAgIGRpc3BsYXlfb3JkZXI6IDEsXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICAvLyBDb25maWd1cmUgdGhlIG1vY2sgdG8gcmV0dXJuIGRhdGEgZGlyZWN0bHlcbiAgICAgIG1vY2tTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZShjcmVhdGVNb2NrQ2hhaW4oe1xuICAgICAgICBkYXRhOiBtb2NrSW1hZ2VzLFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0pKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBHRVQobW9ja1JlcXVlc3QsIHsgcGFyYW1zOiB7IGlkOiBURVNUX1BST0RVQ1RfSUQgfSB9KTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgLy8gRGVidWcgbG9ncyByZW1vdmVkIC0gdGVzdCB3b3JraW5nIGNvcnJlY3RseVxuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLmRhdGEpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuZGF0YVswXS5pc19wcmltYXJ5KS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgaW1hZ2VzIGxpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoY3JlYXRlTW9ja0NoYWluKHtcbiAgICAgICAgZGF0YTogW10sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSkpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEdFVChtb2NrUmVxdWVzdCwgeyBwYXJhbXM6IHsgaWQ6IFRFU1RfUFJPRFVDVF9JRCB9IH0pO1xuICAgICAgY29uc3QgcmVzcG9uc2VEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLmRhdGEpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcHJvZHVjdCBJRCBmb3JtYXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIEdFVChtb2NrUmVxdWVzdCwgeyBwYXJhbXM6IHsgaWQ6ICdpbnZhbGlkLXV1aWQnIH0gfSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdJRCBkZSBwcm9kdWN0byBpbnbDoWxpZG8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZShjcmVhdGVNb2NrQ2hhaW4oe1xuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnRGF0YWJhc2UgZXJyb3InIH0sXG4gICAgICB9KSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgR0VUKG1vY2tSZXF1ZXN0LCB7IHBhcmFtczogeyBpZDogVEVTVF9QUk9EVUNUX0lEIH0gfSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdFcnJvciBhbCBvYnRlbmVyIGltw6FnZW5lcycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUE9TVCAvYXBpL2FkbWluL3Byb2R1Y3RzL1tpZF0vaW1hZ2VzJywgKCkgPT4ge1xuICAgIGxldCBtb2NrRmlsZTogRmlsZTtcbiAgICBsZXQgbW9ja0Zvcm1EYXRhOiBGb3JtRGF0YTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIG1vY2sgZmlsZVxuICAgICAgbW9ja0ZpbGUgPSBuZXcgRmlsZShbJ3Rlc3QgY29udGVudCddLCAndGVzdC1pbWFnZS5qcGcnLCB7XG4gICAgICAgIHR5cGU6ICdpbWFnZS9qcGVnJyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDcmVhdGUgbW9jayBGb3JtRGF0YVxuICAgICAgbW9ja0Zvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBtb2NrRm9ybURhdGEuYXBwZW5kKCdmaWxlJywgbW9ja0ZpbGUpO1xuICAgICAgbW9ja0Zvcm1EYXRhLmFwcGVuZCgnYWx0X3RleHQnLCAnVGVzdCBpbWFnZScpO1xuICAgICAgbW9ja0Zvcm1EYXRhLmFwcGVuZCgnaXNfcHJpbWFyeScsICd0cnVlJyk7XG5cbiAgICAgIC8vIE1vY2sgcmVxdWVzdC5mb3JtRGF0YSgpXG4gICAgICBtb2NrUmVxdWVzdC5mb3JtRGF0YSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRm9ybURhdGEpO1xuXG4gICAgICAvLyBNb2NrIHByb2R1Y3QgZXhpc3RzIGNoZWNrIHVzaW5nIG5ldyBtZXRob2RvbG9neVxuICAgICAgbW9ja1N1cGFiYXNlLmZyb20ubW9ja1JldHVyblZhbHVlKGNyZWF0ZU1vY2tDaGFpbih7XG4gICAgICAgIGRhdGE6IHsgaWQ6IFRFU1RfUFJPRFVDVF9JRCwgbmFtZTogJ1Rlc3QgUHJvZHVjdCcgfSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9KSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwbG9hZCBpbWFnZSBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHN0b3JhZ2UgdXBsb2FkXG4gICAgICBtb2NrU3RvcmFnZVVwbG9hZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgcGF0aDogYHByb2R1Y3RzLyR7VEVTVF9QUk9EVUNUX0lEfS8xMjNfdGVzdC1pbWFnZS5qcGdgIH0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSk7XG5cbiAgICAgIG1vY2tTdG9yYWdlR2V0UHVibGljVXJsLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgcHVibGljVXJsOiAnaHR0cHM6Ly9zdG9yYWdlLmV4YW1wbGUuY29tL3Rlc3QtaW1hZ2UuanBnJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIE1vY2sgZGF0YWJhc2UgaW5zZXJ0XG4gICAgICBjb25zdCBtb2NrSW1hZ2VSZWNvcmQgPSB7XG4gICAgICAgIGlkOiAnbmV3LWltYWdlLWlkJyxcbiAgICAgICAgcHJvZHVjdF9pZDogVEVTVF9QUk9EVUNUX0lELFxuICAgICAgICB1cmw6ICdodHRwczovL3N0b3JhZ2UuZXhhbXBsZS5jb20vdGVzdC1pbWFnZS5qcGcnLFxuICAgICAgICBhbHRfdGV4dDogJ1Rlc3QgaW1hZ2UnLFxuICAgICAgICBpc19wcmltYXJ5OiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgbW9ja1N1cGFiYXNlLmZyb20oKS5pbnNlcnQoKS5zZWxlY3QoKS5zaW5nbGUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiBtb2NrSW1hZ2VSZWNvcmQsXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIE1vY2sgdXBkYXRlIG90aGVyIGltYWdlcyB0byBub3QgcHJpbWFyeVxuICAgICAgbW9ja1N1cGFiYXNlLmZyb20oKS51cGRhdGUoKS5lcSgpLm5lcS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUE9TVChtb2NrUmVxdWVzdCwgeyBwYXJhbXM6IHsgaWQ6IFRFU1RfUFJPRFVDVF9JRCB9IH0pO1xuICAgICAgY29uc3QgcmVzcG9uc2VEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMSk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLmRhdGEudXJsKS50b0JlKCdodHRwczovL3N0b3JhZ2UuZXhhbXBsZS5jb20vdGVzdC1pbWFnZS5qcGcnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEubWVzc2FnZSkudG9CZSgnSW1hZ2VuIHN1YmlkYSBleGl0b3NhbWVudGUnKTtcblxuICAgICAgLy8gVmVyaWZ5IHN0b3JhZ2UgdXBsb2FkIHdhcyBjYWxsZWRcbiAgICAgIGV4cGVjdChtb2NrU3RvcmFnZVVwbG9hZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKGBwcm9kdWN0cy8ke1RFU1RfUFJPRFVDVF9JRH0vYCksXG4gICAgICAgIG1vY2tGaWxlLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgY2FjaGVDb250cm9sOiAnMzYwMCcsXG4gICAgICAgICAgdXBzZXJ0OiBmYWxzZSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGZpbGUgdHlwZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRGaWxlID0gbmV3IEZpbGUoWyd0ZXN0J10sICd0ZXN0LnR4dCcsIHsgdHlwZTogJ3RleHQvcGxhaW4nIH0pO1xuICAgICAgbW9ja0Zvcm1EYXRhLnNldCgnZmlsZScsIGludmFsaWRGaWxlKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBQT1NUKG1vY2tSZXF1ZXN0LCB7IHBhcmFtczogeyBpZDogVEVTVF9QUk9EVUNUX0lEIH0gfSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdUaXBvIGRlIGFyY2hpdm8gbm8gcGVybWl0aWRvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGZpbGUgc2l6ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBhIGxhcmdlIGZpbGUgKDZNQilcbiAgICAgIGNvbnN0IGxhcmdlQ29udGVudCA9IG5ldyBBcnJheSg2ICogMTAyNCAqIDEwMjQpLmZpbGwoJ2EnKS5qb2luKCcnKTtcbiAgICAgIGNvbnN0IGxhcmdlRmlsZSA9IG5ldyBGaWxlKFtsYXJnZUNvbnRlbnRdLCAnbGFyZ2UuanBnJywgeyB0eXBlOiAnaW1hZ2UvanBlZycgfSk7XG4gICAgICBtb2NrRm9ybURhdGEuc2V0KCdmaWxlJywgbGFyZ2VGaWxlKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBQT1NUKG1vY2tSZXF1ZXN0LCB7IHBhcmFtczogeyBpZDogVEVTVF9QUk9EVUNUX0lEIH0gfSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdFbCBhcmNoaXZvIGVzIGRlbWFzaWFkbyBncmFuZGUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgZmlsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tGb3JtRGF0YS5kZWxldGUoJ2ZpbGUnKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBQT1NUKG1vY2tSZXF1ZXN0LCB7IHBhcmFtczogeyBpZDogVEVTVF9QUk9EVUNUX0lEIH0gfSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdObyBzZSBwcm9wb3JjaW9uw7MgYXJjaGl2bycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcHJvZHVjdCBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBVc2UgdmFsaWQgVVVJRCBidXQgY29uZmlndXJlIG1vY2sgdG8gcmV0dXJuIHByb2R1Y3Qgbm90IGZvdW5kXG4gICAgICBtb2NrU3VwYWJhc2UuZnJvbS5tb2NrUmV0dXJuVmFsdWUoY3JlYXRlTW9ja0NoYWluKHtcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ1Byb2R1Y3Qgbm90IGZvdW5kJyB9LFxuICAgICAgfSkpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIFBPU1QobW9ja1JlcXVlc3QsIHsgcGFyYW1zOiB7IGlkOiBURVNUX1BST0RVQ1RfSUQgfSB9KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ1Byb2R1Y3RvIG5vIGVuY29udHJhZG8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHN0b3JhZ2UgdXBsb2FkIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTdG9yYWdlVXBsb2FkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ1N0b3JhZ2UgZXJyb3InIH0sXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBQT1NUKG1vY2tSZXF1ZXN0LCB7IHBhcmFtczogeyBpZDogVEVTVF9QUk9EVUNUX0lEIH0gfSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdFcnJvciBhbCBzdWJpciBpbWFnZW4nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2xlYW51cCBzdG9yYWdlIG9uIGRhdGFiYXNlIGluc2VydCBmYWlsdXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBzdWNjZXNzZnVsIHN0b3JhZ2UgdXBsb2FkXG4gICAgICBtb2NrU3RvcmFnZVVwbG9hZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgcGF0aDogYHByb2R1Y3RzLyR7VEVTVF9QUk9EVUNUX0lEfS90ZXN0LWltYWdlLmpwZ2AgfSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgbW9ja1N0b3JhZ2VHZXRQdWJsaWNVcmwubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgZGF0YTogeyBwdWJsaWNVcmw6ICdodHRwczovL3N0b3JhZ2UuZXhhbXBsZS5jb20vdGVzdC1pbWFnZS5qcGcnIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gTW9jayBkYXRhYmFzZSBpbnNlcnQgZmFpbHVyZSB1c2luZyBuZXcgbWV0aG9kb2xvZ3lcbiAgICAgIG1vY2tTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZShjcmVhdGVNb2NrQ2hhaW4oe1xuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICBlcnJvcjogeyBtZXNzYWdlOiAnRGF0YWJhc2UgZXJyb3InIH0sXG4gICAgICB9KSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgUE9TVChtb2NrUmVxdWVzdCwgeyBwYXJhbXM6IHsgaWQ6IFRFU1RfUFJPRFVDVF9JRCB9IH0pXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnRXJyb3IgYWwgZ3VhcmRhciBpbWFnZW4gZW4gYmFzZSBkZSBkYXRvcycpO1xuXG4gICAgICAvLyBWZXJpZnkgY2xlYW51cCB3YXMgYXR0ZW1wdGVkXG4gICAgICBleHBlY3QobW9ja1N0b3JhZ2VSZW1vdmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFtgcHJvZHVjdHMvJHtURVNUX1BST0RVQ1RfSUR9L3Rlc3QtaW1hZ2UuanBnYF0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgb3RoZXIgaW1hZ2VzIHdoZW4gc2V0dGluZyBhcyBwcmltYXJ5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1N0b3JhZ2VVcGxvYWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiB7IHBhdGg6ICd0ZXN0LXBhdGgnIH0sXG4gICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgfSk7XG5cbiAgICAgIG1vY2tTdG9yYWdlR2V0UHVibGljVXJsLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgcHVibGljVXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZS5qcGcnIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbW9ja0ltYWdlUmVjb3JkID0ge1xuICAgICAgICBpZDogJ25ldy1pbWFnZS1pZCcsXG4gICAgICAgIGlzX3ByaW1hcnk6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBtb2NrU3VwYWJhc2UuZnJvbSgpLmluc2VydCgpLnNlbGVjdCgpLnNpbmdsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IG1vY2tJbWFnZVJlY29yZCxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgUE9TVChtb2NrUmVxdWVzdCwgeyBwYXJhbXM6IHsgaWQ6IFRFU1RfUFJPRFVDVF9JRCB9IH0pO1xuXG4gICAgICAvLyBWZXJpZnkgb3RoZXIgaW1hZ2VzIHdlcmUgdXBkYXRlZCB0byBub3QgcHJpbWFyeVxuICAgICAgZXhwZWN0KG1vY2tTdXBhYmFzZS5mcm9tKCkudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IGlzX3ByaW1hcnk6IGZhbHNlIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSB1bmlxdWUgZmlsZW5hbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3RvcmFnZVVwbG9hZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgcGF0aDogJ3Rlc3QtcGF0aCcgfSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgbW9ja1N0b3JhZ2VHZXRQdWJsaWNVcmwubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgZGF0YTogeyBwdWJsaWNVcmw6ICdodHRwczovL2V4YW1wbGUuY29tL2ltYWdlLmpwZycgfSxcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrU3VwYWJhc2UuZnJvbSgpLmluc2VydCgpLnNlbGVjdCgpLnNpbmdsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgaWQ6ICd0ZXN0LWlkJyB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBQT1NUKG1vY2tSZXF1ZXN0LCB7IHBhcmFtczogeyBpZDogVEVTVF9QUk9EVUNUX0lEIH0gfSk7XG5cbiAgICAgIC8vIFZlcmlmeSBmaWxlbmFtZSBpbmNsdWRlcyBwcm9kdWN0IElEIGFuZCB0aW1lc3RhbXBcbiAgICAgIGNvbnN0IHVwbG9hZENhbGwgPSBtb2NrU3RvcmFnZVVwbG9hZC5tb2NrLmNhbGxzWzBdO1xuICAgICAgY29uc3QgZmlsZW5hbWUgPSB1cGxvYWRDYWxsWzBdO1xuICAgICAgXG4gICAgICBleHBlY3QoZmlsZW5hbWUpLnRvQ29udGFpbihgcHJvZHVjdHMvJHtURVNUX1BST0RVQ1RfSUR9L2ApO1xuICAgICAgZXhwZWN0KGZpbGVuYW1lKS50b0NvbnRhaW4oJ3Rlc3QtaW1hZ2UuanBnJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdGaWxlIFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgdmFsaWRUeXBlcyA9IFsnaW1hZ2UvanBlZycsICdpbWFnZS9qcGcnLCAnaW1hZ2UvcG5nJywgJ2ltYWdlL3dlYnAnXTtcbiAgICBjb25zdCBpbnZhbGlkVHlwZXMgPSBbJ3RleHQvcGxhaW4nLCAnYXBwbGljYXRpb24vcGRmJywgJ3ZpZGVvL21wNCddO1xuXG4gICAgdmFsaWRUeXBlcy5mb3JFYWNoKHR5cGUgPT4ge1xuICAgICAgaXQoYHNob3VsZCBhY2NlcHQgJHt0eXBlfSBmaWxlc2AsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZmlsZSA9IG5ldyBGaWxlKFsnY29udGVudCddLCAndGVzdC5qcGcnLCB7IHR5cGUgfSk7XG4gICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUpO1xuICAgICAgICBcbiAgICAgICAgbW9ja1JlcXVlc3QuZm9ybURhdGEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZm9ybURhdGEpO1xuXG4gICAgICAgIG1vY2tTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZShjcmVhdGVNb2NrQ2hhaW4oe1xuICAgICAgICAgIGRhdGE6IHsgaWQ6IFRFU1RfUFJPRFVDVF9JRCB9LFxuICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICB9KSk7XG5cbiAgICAgICAgbW9ja1N0b3JhZ2VVcGxvYWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIGRhdGE6IHsgcGF0aDogJ3Rlc3QtcGF0aCcgfSxcbiAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbW9ja1N0b3JhZ2VHZXRQdWJsaWNVcmwubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICBkYXRhOiB7IHB1YmxpY1VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vaW1hZ2UuanBnJyB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBtb2NrU3VwYWJhc2UuZnJvbSgpLmluc2VydCgpLnNlbGVjdCgpLnNpbmdsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgZGF0YTogeyBpZDogJ3Rlc3QtaWQnIH0sXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUE9TVChtb2NrUmVxdWVzdCwgeyBwYXJhbXM6IHsgaWQ6IFRFU1RfUFJPRFVDVF9JRCB9IH0pO1xuICAgICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGludmFsaWRUeXBlcy5mb3JFYWNoKHR5cGUgPT4ge1xuICAgICAgaXQoYHNob3VsZCByZWplY3QgJHt0eXBlfSBmaWxlc2AsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZmlsZSA9IG5ldyBGaWxlKFsnY29udGVudCddLCAndGVzdC50eHQnLCB7IHR5cGUgfSk7XG4gICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUpO1xuICAgICAgICBcbiAgICAgICAgbW9ja1JlcXVlc3QuZm9ybURhdGEgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZm9ybURhdGEpO1xuXG4gICAgICAgIG1vY2tTdXBhYmFzZS5mcm9tLm1vY2tSZXR1cm5WYWx1ZShjcmVhdGVNb2NrQ2hhaW4oe1xuICAgICAgICAgIGRhdGE6IHsgaWQ6IFRFU1RfUFJPRFVDVF9JRCB9LFxuICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICB9KSk7XG5cbiAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgIFBPU1QobW9ja1JlcXVlc3QsIHsgcGFyYW1zOiB7IGlkOiBURVNUX1BST0RVQ1RfSUQgfSB9KVxuICAgICAgICApLnJlamVjdHMudG9UaHJvdygnVGlwbyBkZSBhcmNoaXZvIG5vIHBlcm1pdGlkbycpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJjcmVhdGVDbGllbnQiLCJmbiIsIm1vY2tTdXBhYmFzZUdsb2JhbCIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsIm9yZGVyIiwiaW5zZXJ0IiwidXBkYXRlIiwibmVxIiwic3RvcmFnZSIsInVwbG9hZCIsIm1vY2tTdG9yYWdlVXBsb2FkIiwiZ2V0UHVibGljVXJsIiwibW9ja1N0b3JhZ2VHZXRQdWJsaWNVcmwiLCJyZW1vdmUiLCJtb2NrU3RvcmFnZVJlbW92ZSIsImNvbXBvc2VNaWRkbGV3YXJlcyIsIm1pZGRsZXdhcmVzIiwiaGFuZGxlciIsIndpdGhFcnJvckhhbmRsZXIiLCJBcGlFcnJvciIsIkVycm9yIiwibWVzc2FnZSIsInN0YXR1c0NvZGUiLCJWYWxpZGF0aW9uRXJyb3IiLCJkZXRhaWxzIiwibmFtZSIsIk5vdEZvdW5kRXJyb3IiLCJyZXNvdXJjZSIsIndpdGhBcGlMb2dnaW5nIiwibG9nQWRtaW5BY3Rpb24iLCJ3aXRoQWRtaW5BdXRoIiwiZGVzY3JpYmUiLCJURVNUX1BST0RVQ1RfSUQiLCJURVNUX0lNQUdFX0lEIiwibW9ja1N1cGFiYXNlIiwibW9ja1JlcXVlc3QiLCJjcmVhdGVNb2NrQ2hhaW4iLCJmaW5hbFJlc3VsdCIsIm1vY2tSZXR1cm5WYWx1ZSIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiYmVmb3JlRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJzdXBhYmFzZSIsInVzZXIiLCJpZCIsIm1vY2tSZXNldCIsImVycm9yIiwiaXQiLCJtb2NrSW1hZ2VzIiwidXJsIiwiYWx0X3RleHQiLCJpc19wcmltYXJ5IiwiZGlzcGxheV9vcmRlciIsImRhdGEiLCJyZXNwb25zZSIsIkdFVCIsInBhcmFtcyIsInJlc3BvbnNlRGF0YSIsImpzb24iLCJleHBlY3QiLCJzdGF0dXMiLCJ0b0JlIiwic3VjY2VzcyIsInRvSGF2ZUxlbmd0aCIsInJlamVjdHMiLCJ0b1Rocm93IiwibW9ja0ZpbGUiLCJtb2NrRm9ybURhdGEiLCJGaWxlIiwidHlwZSIsIkZvcm1EYXRhIiwiYXBwZW5kIiwiZm9ybURhdGEiLCJwYXRoIiwicHVibGljVXJsIiwibW9ja0ltYWdlUmVjb3JkIiwicHJvZHVjdF9pZCIsIlBPU1QiLCJ0b0hhdmVCZWVuQ2FsbGVkV2l0aCIsInN0cmluZ0NvbnRhaW5pbmciLCJvYmplY3RDb250YWluaW5nIiwiY2FjaGVDb250cm9sIiwidXBzZXJ0IiwiaW52YWxpZEZpbGUiLCJzZXQiLCJsYXJnZUNvbnRlbnQiLCJBcnJheSIsImZpbGwiLCJqb2luIiwibGFyZ2VGaWxlIiwiZGVsZXRlIiwidXBsb2FkQ2FsbCIsImNhbGxzIiwiZmlsZW5hbWUiLCJ0b0NvbnRhaW4iLCJ2YWxpZFR5cGVzIiwiaW52YWxpZFR5cGVzIiwiZm9yRWFjaCIsImZpbGUiXSwibWFwcGluZ3MiOiJBQUFBLGdEQUFnRDs7QUFhaERBLEtBQUtDLElBQUksQ0FBQyx5QkFBeUIsSUFBTyxDQUFBO1FBQ3hDQyxjQUFjRixLQUFLRyxFQUFFLENBQUMsSUFBTUMsc0JBQXNCO2dCQUNoREMsTUFBTUwsS0FBS0csRUFBRSxDQUFDLElBQU8sQ0FBQTt3QkFDbkJHLFFBQVFOLEtBQUtHLEVBQUUsQ0FBQyxJQUFPLENBQUE7Z0NBQ3JCSSxJQUFJUCxLQUFLRyxFQUFFLENBQUMsSUFBTyxDQUFBO3dDQUNqQkssUUFBUVIsS0FBS0csRUFBRTt3Q0FDZk0sT0FBT1QsS0FBS0csRUFBRSxDQUFDLElBQU8sQ0FBQTtnREFDcEJNLE9BQU9ULEtBQUtHLEVBQUU7NENBQ2hCLENBQUE7b0NBQ0YsQ0FBQTs0QkFDRixDQUFBO3dCQUNBTyxRQUFRVixLQUFLRyxFQUFFLENBQUMsSUFBTyxDQUFBO2dDQUNyQkcsUUFBUU4sS0FBS0csRUFBRSxDQUFDLElBQU8sQ0FBQTt3Q0FDckJLLFFBQVFSLEtBQUtHLEVBQUU7b0NBQ2pCLENBQUE7NEJBQ0YsQ0FBQTt3QkFDQVEsUUFBUVgsS0FBS0csRUFBRSxDQUFDLElBQU8sQ0FBQTtnQ0FDckJJLElBQUlQLEtBQUtHLEVBQUUsQ0FBQyxJQUFPLENBQUE7d0NBQ2pCUyxLQUFLWixLQUFLRyxFQUFFO29DQUNkLENBQUE7NEJBQ0YsQ0FBQTtvQkFDRixDQUFBO2dCQUNBVSxTQUFTO29CQUNQUixNQUFNTCxLQUFLRyxFQUFFLENBQUMsSUFBTyxDQUFBOzRCQUNuQlcsUUFBUUM7NEJBQ1JDLGNBQWNDOzRCQUNkQyxRQUFRQzt3QkFDVixDQUFBO2dCQUNGO1lBQ0Y7SUFDRixDQUFBO0FBRUEsa0JBQWtCO0FBQ2xCbkIsS0FBS0MsSUFBSSxDQUFDLGlDQUFpQyxJQUFPLENBQUE7UUFDaERtQixvQkFBb0JwQixL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