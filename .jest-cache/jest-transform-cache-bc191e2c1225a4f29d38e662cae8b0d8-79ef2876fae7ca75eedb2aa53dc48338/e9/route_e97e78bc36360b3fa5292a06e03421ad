dc2b6f405ed4ac12cadee1fbdc7f1d36
// ===================================
// PINTEYA E-COMMERCE - MERCADOPAGO METRICS API
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get GET () {
        return GET;
    },
    get POST () {
        return POST;
    }
});
const _server = require("next/server");
const _auth = require("../../../../../auth");
const _metrics = require("../../../../../lib/metrics");
const _redis = require("../../../../../lib/redis");
const _logger = require("../../../../../lib/logger");
async function GET(request) {
    try {
        // Verificar autenticación
        const session = await (0, _auth.auth)();
        if (!session?.user) {
            return _server.NextResponse.json({
                success: false,
                error: 'No autorizado'
            }, {
                status: 401
            });
        }
        // TODO: Verificar rol de admin
        // const isAdmin = await checkUserRole(userId);
        // if (!isAdmin) {
        //   return NextResponse.json(
        //     { success: false, error: 'Acceso denegado' },
        //     { status: 403 }
        //   );
        // }
        _logger.logger.info(_logger.LogCategory.API, 'Fetching MercadoPago metrics', {
            userId
        });
        // Obtener métricas del sistema
        const metrics = await _metrics.metricsCollector.getMercadoPagoMetrics();
        const redisStatus = await (0, _redis.isRedisAvailable)();
        // Calcular métricas en tiempo real
        const totalRequests = metrics.payment_creation.requests.total + metrics.payment_queries.requests.total + metrics.webhook_processing.requests.total;
        const totalSuccess = metrics.payment_creation.requests.success + metrics.payment_queries.requests.success + metrics.webhook_processing.requests.success;
        const totalErrors = metrics.payment_creation.requests.error + metrics.payment_queries.requests.error + metrics.webhook_processing.requests.error;
        const successRate = totalRequests > 0 ? totalSuccess / totalRequests * 100 : 100;
        const errorRate = totalRequests > 0 ? totalErrors / totalRequests * 100 : 0;
        // Calcular tiempo de respuesta promedio ponderado
        const avgResponseTime = (metrics.payment_creation.response_times.avg * metrics.payment_creation.requests.total + metrics.payment_queries.response_times.avg * metrics.payment_queries.requests.total + metrics.webhook_processing.response_times.avg * metrics.webhook_processing.requests.total) / (totalRequests || 1);
        // Generar alertas basadas en umbrales
        const alerts = [];
        if (errorRate > 5) {
            alerts.push({
                type: 'error',
                message: `Tasa de error alta: ${errorRate.toFixed(1)}%`,
                timestamp: new Date().toISOString()
            });
        }
        if (avgResponseTime > 3000) {
            alerts.push({
                type: 'warning',
                message: `Tiempo de respuesta alto: ${avgResponseTime.toFixed(0)}ms`,
                timestamp: new Date().toISOString()
            });
        }
        if (!redisStatus) {
            alerts.push({
                type: 'warning',
                message: 'Redis desconectado - usando fallback en memoria',
                timestamp: new Date().toISOString()
            });
        }
        // Preparar respuesta
        const response = {
            success: true,
            data: {
                realTimeMetrics: {
                    totalRequests,
                    successRate: Math.round(successRate * 100) / 100,
                    errorRate: Math.round(errorRate * 100) / 100,
                    averageResponseTime: Math.round(avgResponseTime),
                    rateLimitHits: metrics.payment_creation.requests.rate_limited + metrics.payment_queries.requests.rate_limited + metrics.webhook_processing.requests.rate_limited,
                    retryAttempts: metrics.payment_creation.retry_stats.total_retries + metrics.payment_queries.retry_stats.total_retries + metrics.webhook_processing.retry_stats.total_retries
                },
                endpointMetrics: {
                    createPreference: {
                        requests: metrics.payment_creation.requests.total,
                        successRate: metrics.payment_creation.requests.total > 0 ? metrics.payment_creation.requests.success / metrics.payment_creation.requests.total * 100 : 100,
                        averageResponseTime: Math.round(metrics.payment_creation.response_times.avg),
                        errorCount: metrics.payment_creation.requests.error
                    },
                    webhook: {
                        requests: metrics.webhook_processing.requests.total,
                        successRate: metrics.webhook_processing.requests.total > 0 ? metrics.webhook_processing.requests.success / metrics.webhook_processing.requests.total * 100 : 100,
                        averageResponseTime: Math.round(metrics.webhook_processing.response_times.avg),
                        errorCount: metrics.webhook_processing.requests.error
                    },
                    paymentQuery: {
                        requests: metrics.payment_queries.requests.total,
                        successRate: metrics.payment_queries.requests.total > 0 ? metrics.payment_queries.requests.success / metrics.payment_queries.requests.total * 100 : 100,
                        averageResponseTime: Math.round(metrics.payment_queries.response_times.avg),
                        errorCount: metrics.payment_queries.requests.error
                    }
                },
                systemHealth: {
                    redisStatus: redisStatus ? 'connected' : 'disconnected',
                    lastUpdate: new Date().toISOString(),
                    uptime: process.uptime()
                },
                alerts
            }
        };
        _logger.logger.info(_logger.LogCategory.API, 'MercadoPago metrics retrieved successfully');
        return _server.NextResponse.json(response);
    } catch (error) {
        _logger.logger.error(_logger.LogCategory.API, 'Error fetching MercadoPago metrics', error);
        return _server.NextResponse.json({
            success: false,
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        // Verificar autenticación
        const session = await (0, _auth.auth)();
        if (!session?.user) {
            return _server.NextResponse.json({
                success: false,
                error: 'No autorizado'
            }, {
                status: 401
            });
        }
        _logger.logger.info(_logger.LogCategory.API, 'Resetting MercadoPago metrics', {
            userId
        });
        // TODO: Implementar reset de métricas
        // await metricsCollector.resetMetrics();
        return _server.NextResponse.json({
            success: true,
            message: 'Métricas reiniciadas correctamente'
        });
    } catch (error) {
        _logger.logger.error(_logger.LogCategory.API, 'Error resetting MercadoPago metrics', error);
        return _server.NextResponse.json({
            success: false,
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXGFkbWluXFxtZXJjYWRvcGFnb1xcbWV0cmljc1xccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gUElOVEVZQSBFLUNPTU1FUkNFIC0gTUVSQ0FET1BBR08gTUVUUklDUyBBUElcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGF1dGggfSBmcm9tICdAL2F1dGgnO1xyXG5pbXBvcnQgeyBtZXRyaWNzQ29sbGVjdG9yIH0gZnJvbSAnQC9saWIvbWV0cmljcyc7XHJcbmltcG9ydCB7IGlzUmVkaXNBdmFpbGFibGUgfSBmcm9tICdAL2xpYi9yZWRpcyc7XHJcbmltcG9ydCB7IGxvZ2dlciwgTG9nQ2F0ZWdvcnkgfSBmcm9tICdAL2xpYi9sb2dnZXInO1xyXG5cclxuLy8gVGlwb3MgcGFyYSBsYSByZXNwdWVzdGEgZGUgbcOpdHJpY2FzXHJcbmludGVyZmFjZSBNZXRyaWNzUmVzcG9uc2Uge1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZGF0YT86IHtcclxuICAgIHJlYWxUaW1lTWV0cmljczoge1xyXG4gICAgICB0b3RhbFJlcXVlc3RzOiBudW1iZXI7XHJcbiAgICAgIHN1Y2Nlc3NSYXRlOiBudW1iZXI7XHJcbiAgICAgIGVycm9yUmF0ZTogbnVtYmVyO1xyXG4gICAgICBhdmVyYWdlUmVzcG9uc2VUaW1lOiBudW1iZXI7XHJcbiAgICAgIHJhdGVMaW1pdEhpdHM6IG51bWJlcjtcclxuICAgICAgcmV0cnlBdHRlbXB0czogbnVtYmVyO1xyXG4gICAgfTtcclxuICAgIGVuZHBvaW50TWV0cmljczoge1xyXG4gICAgICBjcmVhdGVQcmVmZXJlbmNlOiBFbmRwb2ludE1ldHJpYztcclxuICAgICAgd2ViaG9vazogRW5kcG9pbnRNZXRyaWM7XHJcbiAgICAgIHBheW1lbnRRdWVyeTogRW5kcG9pbnRNZXRyaWM7XHJcbiAgICB9O1xyXG4gICAgc3lzdGVtSGVhbHRoOiB7XHJcbiAgICAgIHJlZGlzU3RhdHVzOiAnY29ubmVjdGVkJyB8ICdkaXNjb25uZWN0ZWQnO1xyXG4gICAgICBsYXN0VXBkYXRlOiBzdHJpbmc7XHJcbiAgICAgIHVwdGltZTogbnVtYmVyO1xyXG4gICAgfTtcclxuICAgIGFsZXJ0czogQWxlcnRbXTtcclxuICB9O1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgRW5kcG9pbnRNZXRyaWMge1xyXG4gIHJlcXVlc3RzOiBudW1iZXI7XHJcbiAgc3VjY2Vzc1JhdGU6IG51bWJlcjtcclxuICBhdmVyYWdlUmVzcG9uc2VUaW1lOiBudW1iZXI7XHJcbiAgZXJyb3JDb3VudDogbnVtYmVyO1xyXG4gIGxhc3RFcnJvcj86IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIEFsZXJ0IHtcclxuICB0eXBlOiAnd2FybmluZycgfCAnZXJyb3InIHwgJ2luZm8nO1xyXG4gIG1lc3NhZ2U6IHN0cmluZztcclxuICB0aW1lc3RhbXA6IHN0cmluZztcclxuICBlbmRwb2ludD86IHN0cmluZztcclxufVxyXG5cclxuLyoqXHJcbiAqIEdFVCAvYXBpL2FkbWluL21lcmNhZG9wYWdvL21ldHJpY3NcclxuICogT2J0aWVuZSBtw6l0cmljYXMgZW4gdGllbXBvIHJlYWwgZGUgTWVyY2Fkb1BhZ29cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBWZXJpZmljYXIgYXV0ZW50aWNhY2nDs25cclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKCk7XHJcbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gYXV0b3JpemFkbycgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUT0RPOiBWZXJpZmljYXIgcm9sIGRlIGFkbWluXHJcbiAgICAvLyBjb25zdCBpc0FkbWluID0gYXdhaXQgY2hlY2tVc2VyUm9sZSh1c2VySWQpO1xyXG4gICAgLy8gaWYgKCFpc0FkbWluKSB7XHJcbiAgICAvLyAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgIC8vICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0FjY2VzbyBkZW5lZ2FkbycgfSxcclxuICAgIC8vICAgICB7IHN0YXR1czogNDAzIH1cclxuICAgIC8vICAgKTtcclxuICAgIC8vIH1cclxuXHJcbiAgICBsb2dnZXIuaW5mbyhMb2dDYXRlZ29yeS5BUEksICdGZXRjaGluZyBNZXJjYWRvUGFnbyBtZXRyaWNzJywgeyB1c2VySWQgfSk7XHJcblxyXG4gICAgLy8gT2J0ZW5lciBtw6l0cmljYXMgZGVsIHNpc3RlbWFcclxuICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCBtZXRyaWNzQ29sbGVjdG9yLmdldE1lcmNhZG9QYWdvTWV0cmljcygpO1xyXG4gICAgY29uc3QgcmVkaXNTdGF0dXMgPSBhd2FpdCBpc1JlZGlzQXZhaWxhYmxlKCk7XHJcblxyXG4gICAgLy8gQ2FsY3VsYXIgbcOpdHJpY2FzIGVuIHRpZW1wbyByZWFsXHJcbiAgICBjb25zdCB0b3RhbFJlcXVlc3RzID0gbWV0cmljcy5wYXltZW50X2NyZWF0aW9uLnJlcXVlc3RzLnRvdGFsICsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzLnBheW1lbnRfcXVlcmllcy5yZXF1ZXN0cy50b3RhbCArIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljcy53ZWJob29rX3Byb2Nlc3NpbmcucmVxdWVzdHMudG90YWw7XHJcblxyXG4gICAgY29uc3QgdG90YWxTdWNjZXNzID0gbWV0cmljcy5wYXltZW50X2NyZWF0aW9uLnJlcXVlc3RzLnN1Y2Nlc3MgKyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljcy5wYXltZW50X3F1ZXJpZXMucmVxdWVzdHMuc3VjY2VzcyArIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzLndlYmhvb2tfcHJvY2Vzc2luZy5yZXF1ZXN0cy5zdWNjZXNzO1xyXG5cclxuICAgIGNvbnN0IHRvdGFsRXJyb3JzID0gbWV0cmljcy5wYXltZW50X2NyZWF0aW9uLnJlcXVlc3RzLmVycm9yICsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljcy5wYXltZW50X3F1ZXJpZXMucmVxdWVzdHMuZXJyb3IgKyBcclxuICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzLndlYmhvb2tfcHJvY2Vzc2luZy5yZXF1ZXN0cy5lcnJvcjtcclxuXHJcbiAgICBjb25zdCBzdWNjZXNzUmF0ZSA9IHRvdGFsUmVxdWVzdHMgPiAwID8gKHRvdGFsU3VjY2VzcyAvIHRvdGFsUmVxdWVzdHMpICogMTAwIDogMTAwO1xyXG4gICAgY29uc3QgZXJyb3JSYXRlID0gdG90YWxSZXF1ZXN0cyA+IDAgPyAodG90YWxFcnJvcnMgLyB0b3RhbFJlcXVlc3RzKSAqIDEwMCA6IDA7XHJcblxyXG4gICAgLy8gQ2FsY3VsYXIgdGllbXBvIGRlIHJlc3B1ZXN0YSBwcm9tZWRpbyBwb25kZXJhZG9cclxuICAgIGNvbnN0IGF2Z1Jlc3BvbnNlVGltZSA9IChcclxuICAgICAgbWV0cmljcy5wYXltZW50X2NyZWF0aW9uLnJlc3BvbnNlX3RpbWVzLmF2ZyAqIG1ldHJpY3MucGF5bWVudF9jcmVhdGlvbi5yZXF1ZXN0cy50b3RhbCArXHJcbiAgICAgIG1ldHJpY3MucGF5bWVudF9xdWVyaWVzLnJlc3BvbnNlX3RpbWVzLmF2ZyAqIG1ldHJpY3MucGF5bWVudF9xdWVyaWVzLnJlcXVlc3RzLnRvdGFsICtcclxuICAgICAgbWV0cmljcy53ZWJob29rX3Byb2Nlc3NpbmcucmVzcG9uc2VfdGltZXMuYXZnICogbWV0cmljcy53ZWJob29rX3Byb2Nlc3NpbmcucmVxdWVzdHMudG90YWxcclxuICAgICkgLyAodG90YWxSZXF1ZXN0cyB8fCAxKTtcclxuXHJcbiAgICAvLyBHZW5lcmFyIGFsZXJ0YXMgYmFzYWRhcyBlbiB1bWJyYWxlc1xyXG4gICAgY29uc3QgYWxlcnRzOiBBbGVydFtdID0gW107XHJcblxyXG4gICAgaWYgKGVycm9yUmF0ZSA+IDUpIHtcclxuICAgICAgYWxlcnRzLnB1c2goe1xyXG4gICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgbWVzc2FnZTogYFRhc2EgZGUgZXJyb3IgYWx0YTogJHtlcnJvclJhdGUudG9GaXhlZCgxKX0lYCxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGF2Z1Jlc3BvbnNlVGltZSA+IDMwMDApIHtcclxuICAgICAgYWxlcnRzLnB1c2goe1xyXG4gICAgICAgIHR5cGU6ICd3YXJuaW5nJyxcclxuICAgICAgICBtZXNzYWdlOiBgVGllbXBvIGRlIHJlc3B1ZXN0YSBhbHRvOiAke2F2Z1Jlc3BvbnNlVGltZS50b0ZpeGVkKDApfW1zYCxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFyZWRpc1N0YXR1cykge1xyXG4gICAgICBhbGVydHMucHVzaCh7XHJcbiAgICAgICAgdHlwZTogJ3dhcm5pbmcnLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdSZWRpcyBkZXNjb25lY3RhZG8gLSB1c2FuZG8gZmFsbGJhY2sgZW4gbWVtb3JpYScsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFByZXBhcmFyIHJlc3B1ZXN0YVxyXG4gICAgY29uc3QgcmVzcG9uc2U6IE1ldHJpY3NSZXNwb25zZSA9IHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIHJlYWxUaW1lTWV0cmljczoge1xyXG4gICAgICAgICAgdG90YWxSZXF1ZXN0cyxcclxuICAgICAgICAgIHN1Y2Nlc3NSYXRlOiBNYXRoLnJvdW5kKHN1Y2Nlc3NSYXRlICogMTAwKSAvIDEwMCxcclxuICAgICAgICAgIGVycm9yUmF0ZTogTWF0aC5yb3VuZChlcnJvclJhdGUgKiAxMDApIC8gMTAwLFxyXG4gICAgICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZTogTWF0aC5yb3VuZChhdmdSZXNwb25zZVRpbWUpLFxyXG4gICAgICAgICAgcmF0ZUxpbWl0SGl0czogbWV0cmljcy5wYXltZW50X2NyZWF0aW9uLnJlcXVlc3RzLnJhdGVfbGltaXRlZCArIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzLnBheW1lbnRfcXVlcmllcy5yZXF1ZXN0cy5yYXRlX2xpbWl0ZWQgKyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljcy53ZWJob29rX3Byb2Nlc3NpbmcucmVxdWVzdHMucmF0ZV9saW1pdGVkLFxyXG4gICAgICAgICAgcmV0cnlBdHRlbXB0czogbWV0cmljcy5wYXltZW50X2NyZWF0aW9uLnJldHJ5X3N0YXRzLnRvdGFsX3JldHJpZXMgKyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljcy5wYXltZW50X3F1ZXJpZXMucmV0cnlfc3RhdHMudG90YWxfcmV0cmllcyArIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzLndlYmhvb2tfcHJvY2Vzc2luZy5yZXRyeV9zdGF0cy50b3RhbF9yZXRyaWVzLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW5kcG9pbnRNZXRyaWNzOiB7XHJcbiAgICAgICAgICBjcmVhdGVQcmVmZXJlbmNlOiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3RzOiBtZXRyaWNzLnBheW1lbnRfY3JlYXRpb24ucmVxdWVzdHMudG90YWwsXHJcbiAgICAgICAgICAgIHN1Y2Nlc3NSYXRlOiBtZXRyaWNzLnBheW1lbnRfY3JlYXRpb24ucmVxdWVzdHMudG90YWwgPiAwID8gXHJcbiAgICAgICAgICAgICAgKG1ldHJpY3MucGF5bWVudF9jcmVhdGlvbi5yZXF1ZXN0cy5zdWNjZXNzIC8gbWV0cmljcy5wYXltZW50X2NyZWF0aW9uLnJlcXVlc3RzLnRvdGFsKSAqIDEwMCA6IDEwMCxcclxuICAgICAgICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZTogTWF0aC5yb3VuZChtZXRyaWNzLnBheW1lbnRfY3JlYXRpb24ucmVzcG9uc2VfdGltZXMuYXZnKSxcclxuICAgICAgICAgICAgZXJyb3JDb3VudDogbWV0cmljcy5wYXltZW50X2NyZWF0aW9uLnJlcXVlc3RzLmVycm9yLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHdlYmhvb2s6IHtcclxuICAgICAgICAgICAgcmVxdWVzdHM6IG1ldHJpY3Mud2ViaG9va19wcm9jZXNzaW5nLnJlcXVlc3RzLnRvdGFsLFxyXG4gICAgICAgICAgICBzdWNjZXNzUmF0ZTogbWV0cmljcy53ZWJob29rX3Byb2Nlc3NpbmcucmVxdWVzdHMudG90YWwgPiAwID8gXHJcbiAgICAgICAgICAgICAgKG1ldHJpY3Mud2ViaG9va19wcm9jZXNzaW5nLnJlcXVlc3RzLnN1Y2Nlc3MgLyBtZXRyaWNzLndlYmhvb2tfcHJvY2Vzc2luZy5yZXF1ZXN0cy50b3RhbCkgKiAxMDAgOiAxMDAsXHJcbiAgICAgICAgICAgIGF2ZXJhZ2VSZXNwb25zZVRpbWU6IE1hdGgucm91bmQobWV0cmljcy53ZWJob29rX3Byb2Nlc3NpbmcucmVzcG9uc2VfdGltZXMuYXZnKSxcclxuICAgICAgICAgICAgZXJyb3JDb3VudDogbWV0cmljcy53ZWJob29rX3Byb2Nlc3NpbmcucmVxdWVzdHMuZXJyb3IsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgcGF5bWVudFF1ZXJ5OiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3RzOiBtZXRyaWNzLnBheW1lbnRfcXVlcmllcy5yZXF1ZXN0cy50b3RhbCxcclxuICAgICAgICAgICAgc3VjY2Vzc1JhdGU6IG1ldHJpY3MucGF5bWVudF9xdWVyaWVzLnJlcXVlc3RzLnRvdGFsID4gMCA/IFxyXG4gICAgICAgICAgICAgIChtZXRyaWNzLnBheW1lbnRfcXVlcmllcy5yZXF1ZXN0cy5zdWNjZXNzIC8gbWV0cmljcy5wYXltZW50X3F1ZXJpZXMucmVxdWVzdHMudG90YWwpICogMTAwIDogMTAwLFxyXG4gICAgICAgICAgICBhdmVyYWdlUmVzcG9uc2VUaW1lOiBNYXRoLnJvdW5kKG1ldHJpY3MucGF5bWVudF9xdWVyaWVzLnJlc3BvbnNlX3RpbWVzLmF2ZyksXHJcbiAgICAgICAgICAgIGVycm9yQ291bnQ6IG1ldHJpY3MucGF5bWVudF9xdWVyaWVzLnJlcXVlc3RzLmVycm9yLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHN5c3RlbUhlYWx0aDoge1xyXG4gICAgICAgICAgcmVkaXNTdGF0dXM6IHJlZGlzU3RhdHVzID8gJ2Nvbm5lY3RlZCcgOiAnZGlzY29ubmVjdGVkJyxcclxuICAgICAgICAgIGxhc3RVcGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIHVwdGltZTogcHJvY2Vzcy51cHRpbWUoKSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGFsZXJ0cyxcclxuICAgICAgfSxcclxuICAgIH07XHJcblxyXG4gICAgbG9nZ2VyLmluZm8oTG9nQ2F0ZWdvcnkuQVBJLCAnTWVyY2Fkb1BhZ28gbWV0cmljcyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5Jyk7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3BvbnNlKTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGxvZ2dlci5lcnJvcihMb2dDYXRlZ29yeS5BUEksICdFcnJvciBmZXRjaGluZyBNZXJjYWRvUGFnbyBtZXRyaWNzJywgZXJyb3IgYXMgRXJyb3IpO1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiAnRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3InLFxyXG4gICAgICB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogUE9TVCAvYXBpL2FkbWluL21lcmNhZG9wYWdvL21ldHJpY3NcclxuICogUmVpbmljaWEgbGFzIG3DqXRyaWNhcyBkZSBNZXJjYWRvUGFnb1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBWZXJpZmljYXIgYXV0ZW50aWNhY2nDs25cclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKCk7XHJcbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gYXV0b3JpemFkbycgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBsb2dnZXIuaW5mbyhMb2dDYXRlZ29yeS5BUEksICdSZXNldHRpbmcgTWVyY2Fkb1BhZ28gbWV0cmljcycsIHsgdXNlcklkIH0pO1xyXG5cclxuICAgIC8vIFRPRE86IEltcGxlbWVudGFyIHJlc2V0IGRlIG3DqXRyaWNhc1xyXG4gICAgLy8gYXdhaXQgbWV0cmljc0NvbGxlY3Rvci5yZXNldE1ldHJpY3MoKTtcclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBtZXNzYWdlOiAnTcOpdHJpY2FzIHJlaW5pY2lhZGFzIGNvcnJlY3RhbWVudGUnLFxyXG4gICAgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXIuZXJyb3IoTG9nQ2F0ZWdvcnkuQVBJLCAnRXJyb3IgcmVzZXR0aW5nIE1lcmNhZG9QYWdvIG1ldHJpY3MnLCBlcnJvciBhcyBFcnJvcik7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicsXHJcbiAgICAgIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkdFVCIsIlBPU1QiLCJyZXF1ZXN0Iiwic2Vzc2lvbiIsImF1dGgiLCJ1c2VyIiwiTmV4dFJlc3BvbnNlIiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsInN0YXR1cyIsImxvZ2dlciIsImluZm8iLCJMb2dDYXRlZ29yeSIsIkFQSSIsInVzZXJJZCIsIm1ldHJpY3MiLCJtZXRyaWNzQ29sbGVjdG9yIiwiZ2V0TWVyY2Fkb1BhZ29NZXRyaWNzIiwicmVkaXNTdGF0dXMiLCJpc1JlZGlzQXZhaWxhYmxlIiwidG90YWxSZXF1ZXN0cyIsInBheW1lbnRfY3JlYXRpb24iLCJyZXF1ZXN0cyIsInRvdGFsIiwicGF5bWVudF9xdWVyaWVzIiwid2ViaG9va19wcm9jZXNzaW5nIiwidG90YWxTdWNjZXNzIiwidG90YWxFcnJvcnMiLCJzdWNjZXNzUmF0ZSIsImVycm9yUmF0ZSIsImF2Z1Jlc3BvbnNlVGltZSIsInJlc3BvbnNlX3RpbWVzIiwiYXZnIiwiYWxlcnRzIiwicHVzaCIsInR5cGUiLCJtZXNzYWdlIiwidG9GaXhlZCIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInJlc3BvbnNlIiwiZGF0YSIsInJlYWxUaW1lTWV0cmljcyIsIk1hdGgiLCJyb3VuZCIsImF2ZXJhZ2VSZXNwb25zZVRpbWUiLCJyYXRlTGltaXRIaXRzIiwicmF0ZV9saW1pdGVkIiwicmV0cnlBdHRlbXB0cyIsInJldHJ5X3N0YXRzIiwidG90YWxfcmV0cmllcyIsImVuZHBvaW50TWV0cmljcyIsImNyZWF0ZVByZWZlcmVuY2UiLCJlcnJvckNvdW50Iiwid2ViaG9vayIsInBheW1lbnRRdWVyeSIsInN5c3RlbUhlYWx0aCIsImxhc3RVcGRhdGUiLCJ1cHRpbWUiLCJwcm9jZXNzIl0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMsK0NBQStDO0FBQy9DLHNDQUFzQzs7Ozs7Ozs7Ozs7O1FBc0RoQkE7ZUFBQUE7O1FBaUpBQztlQUFBQTs7O3dCQXJNb0I7c0JBQ3JCO3lCQUNZO3VCQUNBO3dCQUNHO0FBZ0Q3QixlQUFlRCxJQUFJRSxPQUFvQjtJQUM1QyxJQUFJO1FBQ0YsMEJBQTBCO1FBQzFCLE1BQU1DLFVBQVUsTUFBTUMsSUFBQUEsVUFBSTtRQUMxQixJQUFJLENBQUNELFNBQVNFLE1BQU07WUFDbEIsT0FBT0Msb0JBQVksQ0FBQ0MsSUFBSSxDQUN0QjtnQkFBRUMsU0FBUztnQkFBT0MsT0FBTztZQUFnQixHQUN6QztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsK0JBQStCO1FBQy9CLCtDQUErQztRQUMvQyxrQkFBa0I7UUFDbEIsOEJBQThCO1FBQzlCLG9EQUFvRDtRQUNwRCxzQkFBc0I7UUFDdEIsT0FBTztRQUNQLElBQUk7UUFFSkMsY0FBTSxDQUFDQyxJQUFJLENBQUNDLG1CQUFXLENBQUNDLEdBQUcsRUFBRSxnQ0FBZ0M7WUFBRUM7UUFBTztRQUV0RSwrQkFBK0I7UUFDL0IsTUFB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