{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\useProducts.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - HOOK PARA PRODUCTOS\r\n// ===================================\r\n\r\nimport { useState, useEffect, useCallback, useMemo, useRef } from 'react';\r\nimport { Product } from '@/types/product';\r\nimport { ProductFilters, PaginatedResponse, ProductWithCategory } from '@/types/api';\r\nimport { getProducts } from '@/lib/api/products';\r\nimport { adaptApiProductsToLegacy, ExtendedProduct } from '@/lib/adapters/productAdapter';\r\n\r\ninterface UseProductsState {\r\n  products: ExtendedProduct[];\r\n  loading: boolean;\r\n  error: string | null;\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\ninterface UseProductsOptions {\r\n  initialFilters?: ProductFilters;\r\n  autoFetch?: boolean;\r\n}\r\n\r\nexport function useProducts(options: UseProductsOptions = {}) {\r\n  const { initialFilters = {}, autoFetch = true } = options;\r\n\r\n  // Referencias para evitar re-renders innecesarios\r\n  const abortControllerRef = useRef<AbortController | null>(null);\r\n  const lastRequestRef = useRef<string>('');\r\n\r\n  // DEBUG: Log b√°sico para verificar que el hook se ejecuta (solo en desarrollo)\r\n  if (process.env.NODE_ENV === 'development') {\r\n  }\r\n\r\n  const [state, setState] = useState<UseProductsState>({\r\n    products: [],\r\n    loading: false,\r\n    error: null,\r\n    pagination: {\r\n      page: 1,\r\n      limit: 12,\r\n      total: 0,\r\n      totalPages: 0,\r\n    },\r\n  });\r\n\r\n  const [filters, setFilters] = useState<ProductFilters>(initialFilters);\r\n\r\n  /**\r\n   * Obtiene productos desde la API con optimizaciones de performance\r\n   */\r\n  const fetchProducts = useCallback(async (newFilters?: ProductFilters) => {\r\n    // Cancelar request anterior si existe\r\n    if (abortControllerRef.current) {\r\n      abortControllerRef.current.abort();\r\n    }\r\n\r\n    // Crear nuevo AbortController\r\n    abortControllerRef.current = new AbortController();\r\n    const signal = abortControllerRef.current.signal;\r\n\r\n    const filtersToUse = newFilters || filters;\r\n\r\n    // Crear clave √∫nica para el request\r\n    const requestKey = JSON.stringify(filtersToUse);\r\n\r\n    // Evitar requests duplicados\r\n    if (requestKey === lastRequestRef.current) {\r\n      return;\r\n    }\r\n\r\n    lastRequestRef.current = requestKey;\r\n\r\n    setState(prev => ({ ...prev, loading: true, error: null }));\r\n\r\n    try {\r\n      const response: PaginatedResponse<ProductWithCategory> = await getProducts(filtersToUse);\r\n\r\n      // Verificar si el request fue cancelado\r\n      if (signal.aborted) {\r\n        return;\r\n      }\r\n\r\n      if (response.success) {\r\n        // DEBUG CR√çTICO: Log de datos antes del adaptador (solo en desarrollo)\r\n        if (process.env.NODE_ENV === 'development') {\r\n          const poximixProducts = response.data.filter(p => p.name?.includes('Poximix'));\r\n          if (poximixProducts.length > 0) {\r\n            console.log('üîç DEBUG CR√çTICO - DATOS ANTES DEL ADAPTADOR:', poximixProducts.map(p => ({\r\n              id: p.id,\r\n              name: p.name,\r\n              'contiene Poxipol': p.name?.includes('Poxipol')\r\n            })));\r\n          }\r\n        }\r\n\r\n        const adaptedProducts = adaptApiProductsToLegacy(response.data);\r\n\r\n        // DEBUG CR√çTICO: Log de datos despu√©s del adaptador (solo en desarrollo)\r\n        if (process.env.NODE_ENV === 'development') {\r\n          const adaptedPoximix = adaptedProducts.filter(p => p.title?.includes('Poximix'));\r\n          if (adaptedPoximix.length > 0) {\r\n            console.log('üîç DEBUG CR√çTICO - DATOS DESPU√âS DEL ADAPTADOR:', adaptedPoximix.map(p => ({\r\n              id: p.id,\r\n              title: p.title,\r\n              'contiene Poxipol': p.title?.includes('Poxipol')\r\n            })));\r\n          }\r\n        }\r\n\r\n        setState(prev => ({\r\n          ...prev,\r\n          products: adaptedProducts,\r\n          loading: false,\r\n          pagination: response.pagination,\r\n        }));\r\n      } else {\r\n        setState(prev => ({\r\n          ...prev,\r\n          loading: false,\r\n          error: response.error || 'Error obteniendo productos',\r\n        }));\r\n      }\r\n    } catch (error: any) {\r\n      // Ignorar errores de cancelaci√≥n\r\n      if (error.name === 'AbortError') {\r\n        return;\r\n      }\r\n\r\n      setState(prev => ({\r\n        ...prev,\r\n        loading: false,\r\n        error: error.message || 'Error inesperado',\r\n      }));\r\n    }\r\n  }, [filters]);\r\n\r\n  /**\r\n   * Actualiza los filtros y obtiene productos\r\n   */\r\n  const updateFilters = useCallback((newFilters: Partial<ProductFilters>) => {\r\n    const updatedFilters = { ...filters, ...newFilters };\r\n    setFilters(updatedFilters);\r\n    fetchProducts(updatedFilters);\r\n  }, [filters, fetchProducts]);\r\n\r\n  /**\r\n   * Cambia la p√°gina\r\n   */\r\n  const changePage = useCallback((page: number) => {\r\n    updateFilters({ page });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Cambia el l√≠mite de productos por p√°gina\r\n   */\r\n  const changeLimit = useCallback((limit: number) => {\r\n    updateFilters({ limit, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Cambia el ordenamiento\r\n   */\r\n  const changeSorting = useCallback((sortBy: 'price' | 'name' | 'created_at', sortOrder: 'asc' | 'desc') => {\r\n    updateFilters({ sortBy, sortOrder, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Busca productos por t√©rmino\r\n   */\r\n  const searchProducts = useCallback((searchTerm: string) => {\r\n    updateFilters({ search: searchTerm, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Filtra por categor√≠a\r\n   */\r\n  const filterByCategory = useCallback((category: string) => {\r\n    updateFilters({ category, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Filtra por rango de precios\r\n   */\r\n  const filterByPriceRange = useCallback((priceMin?: number, priceMax?: number) => {\r\n    updateFilters({ priceMin, priceMax, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Limpia todos los filtros\r\n   */\r\n  const clearFilters = useCallback(() => {\r\n    const clearedFilters: ProductFilters = {\r\n      page: 1,\r\n      limit: filters.limit || 12,\r\n      sortBy: 'created_at',\r\n      sortOrder: 'desc',\r\n    };\r\n    setFilters(clearedFilters);\r\n    fetchProducts(clearedFilters);\r\n  }, [filters.limit, fetchProducts]);\r\n\r\n  /**\r\n   * Refresca los productos\r\n   */\r\n  const refresh = useCallback(() => {\r\n    fetchProducts();\r\n  }, [fetchProducts]);\r\n\r\n  // Auto-fetch al montar el componente\r\n  useEffect(() => {\r\n    if (autoFetch) {\r\n      fetchProducts();\r\n    }\r\n  }, [autoFetch, fetchProducts]);\r\n\r\n  // Cleanup effect para cancelar requests pendientes\r\n  useEffect(() => {\r\n    return () => {\r\n      if (abortControllerRef.current) {\r\n        abortControllerRef.current.abort();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Memoized helpers para optimizar renders\r\n  const helpers = useMemo(() => ({\r\n    hasProducts: state.products.length > 0,\r\n    isEmpty: !state.loading && state.products.length === 0,\r\n    hasError: !!state.error,\r\n    hasNextPage: state.pagination.page < state.pagination.totalPages,\r\n    hasPrevPage: state.pagination.page > 1,\r\n  }), [state.products.length, state.loading, state.error, state.pagination.page, state.pagination.totalPages]);\r\n\r\n  return {\r\n    // Estado\r\n    products: state.products,\r\n    loading: state.loading,\r\n    error: state.error,\r\n    pagination: state.pagination,\r\n    filters,\r\n\r\n    // Acciones\r\n    fetchProducts,\r\n    updateFilters,\r\n    changePage,\r\n    changeLimit,\r\n    changeSorting,\r\n    searchProducts,\r\n    filterByCategory,\r\n    filterByPriceRange,\r\n    clearFilters,\r\n    refresh,\r\n\r\n    // Helpers memoizados\r\n    ...helpers,\r\n  };\r\n}\r\n"],"names":["useProducts","options","initialFilters","autoFetch","abortControllerRef","useRef","lastRequestRef","process","env","NODE_ENV","state","setState","useState","products","loading","error","pagination","page","limit","total","totalPages","filters","setFilters","fetchProducts","useCallback","newFilters","current","abort","AbortController","signal","filtersToUse","requestKey","JSON","stringify","prev","response","getProducts","aborted","success","poximixProducts","data","filter","p","name","includes","length","console","log","map","id","adaptedProducts","adaptApiProductsToLegacy","adaptedPoximix","title","message","updateFilters","updatedFilters","changePage","changeLimit","changeSorting","sortBy","sortOrder","searchProducts","searchTerm","search","filterByCategory","category","filterByPriceRange","priceMin","priceMax","clearFilters","clearedFilters","refresh","useEffect","helpers","useMemo","hasProducts","isEmpty","hasError","hasNextPage","hasPrevPage"],"mappings":"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"}