bfef702b05835d267c84044ec0382489
/**
 * Utilidades para manejo seguro de JSON
 * Previene errores de parsing con datos corruptos o malformados
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get STORAGE_KEYS () {
        return STORAGE_KEYS;
    },
    get cleanCorruptedLocalStorage () {
        return cleanCorruptedLocalStorage;
    },
    get initializeJsonSafety () {
        return initializeJsonSafety;
    },
    get safeApiResponseJson () {
        return safeApiResponseJson;
    },
    get safeJsonParse () {
        return safeJsonParse;
    },
    get safeJsonStringify () {
        return safeJsonStringify;
    },
    get safeLocalStorageGet () {
        return safeLocalStorageGet;
    },
    get safeLocalStorageSet () {
        return safeLocalStorageSet;
    }
});
function safeJsonParse(jsonString) {
    // Validaciones b√°sicas
    if (!jsonString) {
        return {
            success: false,
            data: null,
            error: 'JSON string is null or undefined'
        };
    }
    // Limpiar string
    const trimmed = jsonString.trim();
    // Detectar casos problem√°ticos
    if (trimmed === '' || trimmed === '""' || trimmed === "''" || trimmed === 'null' || trimmed === 'undefined') {
        return {
            success: false,
            data: null,
            error: 'JSON string is empty or invalid'
        };
    }
    // Detectar comillas dobles corruptas
    if (trimmed.includes('""') && trimmed.length < 5) {
        return {
            success: false,
            data: null,
            error: 'Detected corrupted JSON with empty quotes'
        };
    }
    // Intentar parsear
    try {
        const parsed = JSON.parse(trimmed);
        return {
            success: true,
            data: parsed,
            error: undefined
        };
    } catch (error) {
        return {
            success: false,
            data: null,
            error: error instanceof Error ? error.message : 'Unknown JSON parse error'
        };
    }
}
function safeJsonStringify(data, space) {
    try {
        const result = JSON.stringify(data, null, space);
        return {
            success: true,
            data: result,
            error: undefined
        };
    } catch (error) {
        // Intentar con replacer para objetos circulares
        try {
            const seen = new WeakSet();
            const result = JSON.stringify(data, (key, value)=>{
                if (typeof value === 'object' && value !== null) {
                    if (seen.has(value)) {
                        return '[Circular Reference]';
                    }
                    seen.add(value);
                }
                return value;
            }, space);
            return {
                success: true,
                data: result,
                error: undefined
            };
        } catch (fallbackError) {
            return {
                success: false,
                data: null,
                error: fallbackError instanceof Error ? fallbackError.message : 'Unknown JSON stringify error'
            };
        }
    }
}
function safeLocalStorageGet(key) {
    if (typeof window === 'undefined') {
        return {
            success: false,
            data: null,
            error: 'localStorage not available (SSR)'
        };
    }
    try {
        const stored = localStorage.getItem(key);
        if (!stored) {
            return {
                success: false,
                data: null,
                error: 'No data found in localStorage'
            };
        }
        return safeJsonParse(stored);
    } catch (error) {
        return {
            success: false,
            data: null,
            error: error instanceof Error ? error.message : 'localStorage access error'
        };
    }
}
function safeLocalStorageSet(key, data) {
    if (typeof window === 'undefined') {
        return {
            success: false,
            data: false,
            error: 'localStorage not available (SSR)'
        };
    }
    try {
        const stringifyResult = safeJsonStringify(data);
        if (!stringifyResult.success) {
            return {
                success: false,
                data: false,
                error: `Failed to stringify data: ${stringifyResult.error}`
            };
        }
        localStorage.setItem(key, stringifyResult.data);
        return {
            success: true,
            data: true,
            error: undefined
        };
    } catch (error) {
        return {
            success: false,
            data: false,
            error: error instanceof Error ? error.message : 'localStorage write error'
        };
    }
}
function cleanCorruptedLocalStorage(keys) {
    if (typeof window === 'undefined') {
        return 0;
    }
    let cleanedCount = 0;
    keys.forEach((key)=>{
        try {
            const stored = localStorage.getItem(key);
            if (stored) {
                const parseResult = safeJsonParse(stored);
                if (!parseResult.success) {
                    console.warn(`Cleaning corrupted localStorage key: ${key}`, parseResult.error);
                    localStorage.removeItem(key);
                    cleanedCount++;
                }
            }
        } catch (error) {
            console.warn(`Error checking localStorage key ${key}:`, error);
            localStorage.removeItem(key);
            cleanedCount++;
        }
    });
    return cleanedCount;
}
async function safeApiResponseJson(response) {
    const DEBUG_MODE = process.env.NODE_ENV === 'development';
    try {
        if (DEBUG_MODE) {}
        // Verificar que la respuesta sea v√°lida
        if (!response.ok) {
            // Try to get error details from response body
            let errorDetails = '';
            try {
                const errorText = await response.text();
                if (DEBUG_MODE) {}
                errorDetails = errorText ? ` - ${errorText}` : '';
            } catch (textError) {
                if (DEBUG_MODE) {
                    console.warn('Could not read error response body:', textError);
                }
            }
            return {
                success: false,
                data: null,
                error: `HTTP ${response.status}: ${response.statusText}${errorDetails}`
            };
        }
        // Obtener el texto primero
        const text = await response.text();
        if (DEBUG_MODE) {
            console.log('üìÑ Response text preview:', text.substring(0, 200) + (text.length > 200 ? '...' : ''));
        }
        // Parsear de forma segura
        const parseResult = safeJsonParse(text);
        if (DEBUG_MODE) {}
        return parseResult;
    } catch (error) {
        console.error('‚ùå safeApiResponseJson error:', error);
        return {
            success: false,
            data: null,
            error: error instanceof Error ? error.message : 'API response error'
        };
    }
}
const STORAGE_KEYS = {
    CART: 'pinteya-cart',
    RECENT_SEARCHES: 'pinteya-recent-searches',
    USER_PREFERENCES: 'pinteya-user-preferences',
    ANALYTICS: 'pinteya-analytics'
};
function initializeJsonSafety() {
    if (typeof window === 'undefined') return;
    const keysToCheck = Object.values(STORAGE_KEYS);
    const cleanedCount = cleanCorruptedLocalStorage(keysToCheck);
    if (cleanedCount > 0) {}
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxqc29uLXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVXRpbGlkYWRlcyBwYXJhIG1hbmVqbyBzZWd1cm8gZGUgSlNPTlxuICogUHJldmllbmUgZXJyb3JlcyBkZSBwYXJzaW5nIGNvbiBkYXRvcyBjb3JydXB0b3MgbyBtYWxmb3JtYWRvc1xuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgU2FmZUpzb25SZXN1bHQ8VD4ge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICBkYXRhOiBUIHwgbnVsbDtcbiAgZXJyb3I/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogUGFyc2VhIEpTT04gZGUgZm9ybWEgc2VndXJhLCBtYW5lamFuZG8gY2Fzb3MgZWRnZSB5IGRhdG9zIGNvcnJ1cHRvc1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2FmZUpzb25QYXJzZTxUID0gYW55Pihqc29uU3RyaW5nOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKTogU2FmZUpzb25SZXN1bHQ8VD4ge1xuICAvLyBWYWxpZGFjaW9uZXMgYsOhc2ljYXNcbiAgaWYgKCFqc29uU3RyaW5nKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZGF0YTogbnVsbCxcbiAgICAgIGVycm9yOiAnSlNPTiBzdHJpbmcgaXMgbnVsbCBvciB1bmRlZmluZWQnXG4gICAgfTtcbiAgfVxuXG4gIC8vIExpbXBpYXIgc3RyaW5nXG4gIGNvbnN0IHRyaW1tZWQgPSBqc29uU3RyaW5nLnRyaW0oKTtcbiAgXG4gIC8vIERldGVjdGFyIGNhc29zIHByb2JsZW3DoXRpY29zXG4gIGlmICh0cmltbWVkID09PSAnJyB8fCB0cmltbWVkID09PSAnXCJcIicgfHwgdHJpbW1lZCA9PT0gXCInJ1wiIHx8IHRyaW1tZWQgPT09ICdudWxsJyB8fCB0cmltbWVkID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGRhdGE6IG51bGwsXG4gICAgICBlcnJvcjogJ0pTT04gc3RyaW5nIGlzIGVtcHR5IG9yIGludmFsaWQnXG4gICAgfTtcbiAgfVxuXG4gIC8vIERldGVjdGFyIGNvbWlsbGFzIGRvYmxlcyBjb3JydXB0YXNcbiAgaWYgKHRyaW1tZWQuaW5jbHVkZXMoJ1wiXCInKSAmJiB0cmltbWVkLmxlbmd0aCA8IDUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBkYXRhOiBudWxsLFxuICAgICAgZXJyb3I6ICdEZXRlY3RlZCBjb3JydXB0ZWQgSlNPTiB3aXRoIGVtcHR5IHF1b3RlcydcbiAgICB9O1xuICB9XG5cbiAgLy8gSW50ZW50YXIgcGFyc2VhclxuICB0cnkge1xuICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UodHJpbW1lZCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBwYXJzZWQsXG4gICAgICBlcnJvcjogdW5kZWZpbmVkXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBkYXRhOiBudWxsLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gSlNPTiBwYXJzZSBlcnJvcidcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogU3RyaW5naWZ5IEpTT04gZGUgZm9ybWEgc2VndXJhLCBtYW5lamFuZG8gb2JqZXRvcyBjaXJjdWxhcmVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzYWZlSnNvblN0cmluZ2lmeShkYXRhOiBhbnksIHNwYWNlPzogbnVtYmVyKTogU2FmZUpzb25SZXN1bHQ8c3RyaW5nPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzdWx0ID0gSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgc3BhY2UpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgZXJyb3I6IHVuZGVmaW5lZFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgLy8gSW50ZW50YXIgY29uIHJlcGxhY2VyIHBhcmEgb2JqZXRvcyBjaXJjdWxhcmVzXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNlZW4gPSBuZXcgV2Vha1NldCgpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5zdHJpbmdpZnkoZGF0YSwgKGtleSwgdmFsdWUpID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICBpZiAoc2Vlbi5oYXModmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gJ1tDaXJjdWxhciBSZWZlcmVuY2VdJztcbiAgICAgICAgICB9XG4gICAgICAgICAgc2Vlbi5hZGQodmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH0sIHNwYWNlKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgICBlcnJvcjogdW5kZWZpbmVkXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGZhbGxiYWNrRXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICBlcnJvcjogZmFsbGJhY2tFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZmFsbGJhY2tFcnJvci5tZXNzYWdlIDogJ1Vua25vd24gSlNPTiBzdHJpbmdpZnkgZXJyb3InXG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIENhcmdhIGRhdG9zIGRlIGxvY2FsU3RvcmFnZSBkZSBmb3JtYSBzZWd1cmFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNhZmVMb2NhbFN0b3JhZ2VHZXQ8VCA9IGFueT4oa2V5OiBzdHJpbmcpOiBTYWZlSnNvblJlc3VsdDxUPiB7XG4gIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGRhdGE6IG51bGwsXG4gICAgICBlcnJvcjogJ2xvY2FsU3RvcmFnZSBub3QgYXZhaWxhYmxlIChTU1IpJ1xuICAgIH07XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHN0b3JlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgaWYgKCFzdG9yZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICBlcnJvcjogJ05vIGRhdGEgZm91bmQgaW4gbG9jYWxTdG9yYWdlJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2FmZUpzb25QYXJzZTxUPihzdG9yZWQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGRhdGE6IG51bGwsXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnbG9jYWxTdG9yYWdlIGFjY2VzcyBlcnJvcidcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogR3VhcmRhIGRhdG9zIGVuIGxvY2FsU3RvcmFnZSBkZSBmb3JtYSBzZWd1cmFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNhZmVMb2NhbFN0b3JhZ2VTZXQoa2V5OiBzdHJpbmcsIGRhdGE6IGFueSk6IFNhZmVKc29uUmVzdWx0PGJvb2xlYW4+IHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZGF0YTogZmFsc2UsXG4gICAgICBlcnJvcjogJ2xvY2FsU3RvcmFnZSBub3QgYXZhaWxhYmxlIChTU1IpJ1xuICAgIH07XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHN0cmluZ2lmeVJlc3VsdCA9IHNhZmVKc29uU3RyaW5naWZ5KGRhdGEpO1xuICAgIGlmICghc3RyaW5naWZ5UmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBkYXRhOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGBGYWlsZWQgdG8gc3RyaW5naWZ5IGRhdGE6ICR7c3RyaW5naWZ5UmVzdWx0LmVycm9yfWBcbiAgICAgIH07XG4gICAgfVxuXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBzdHJpbmdpZnlSZXN1bHQuZGF0YSEpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogdHJ1ZSxcbiAgICAgIGVycm9yOiB1bmRlZmluZWRcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGRhdGE6IGZhbHNlLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ2xvY2FsU3RvcmFnZSB3cml0ZSBlcnJvcidcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogTGltcGlhIGxvY2FsU3RvcmFnZSBkZSBkYXRvcyBjb3JydXB0b3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuQ29ycnVwdGVkTG9jYWxTdG9yYWdlKGtleXM6IHN0cmluZ1tdKTogbnVtYmVyIHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICBsZXQgY2xlYW5lZENvdW50ID0gMDtcblxuICBrZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RvcmVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgICAgIGlmIChzdG9yZWQpIHtcbiAgICAgICAgY29uc3QgcGFyc2VSZXN1bHQgPSBzYWZlSnNvblBhcnNlKHN0b3JlZCk7XG4gICAgICAgIGlmICghcGFyc2VSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgIGNvbnNvbGUud2FybihgQ2xlYW5pbmcgY29ycnVwdGVkIGxvY2FsU3RvcmFnZSBrZXk6ICR7a2V5fWAsIHBhcnNlUmVzdWx0LmVycm9yKTtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICAgICAgICAgIGNsZWFuZWRDb3VudCsrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihgRXJyb3IgY2hlY2tpbmcgbG9jYWxTdG9yYWdlIGtleSAke2tleX06YCwgZXJyb3IpO1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcbiAgICAgIGNsZWFuZWRDb3VudCsrO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIGNsZWFuZWRDb3VudDtcbn1cblxuLyoqXG4gKiBWYWxpZGEgcXVlIHVuYSByZXNwdWVzdGEgZGUgQVBJIHRlbmdhIEpTT04gdsOhbGlkb1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2FmZUFwaVJlc3BvbnNlSnNvbjxUID0gYW55PihyZXNwb25zZTogUmVzcG9uc2UpOiBQcm9taXNlPFNhZmVKc29uUmVzdWx0PFQ+PiB7XG4gIGNvbnN0IERFQlVHX01PREUgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JztcblxuICB0cnkge1xuICAgIGlmIChERUJVR19NT0RFKSB7XG4gICAgfVxuXG4gICAgLy8gVmVyaWZpY2FyIHF1ZSBsYSByZXNwdWVzdGEgc2VhIHbDoWxpZGFcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAvLyBUcnkgdG8gZ2V0IGVycm9yIGRldGFpbHMgZnJvbSByZXNwb25zZSBib2R5XG4gICAgICBsZXQgZXJyb3JEZXRhaWxzID0gJyc7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICAgIGlmIChERUJVR19NT0RFKSB7XG4gICAgICAgIH1cbiAgICAgICAgZXJyb3JEZXRhaWxzID0gZXJyb3JUZXh0ID8gYCAtICR7ZXJyb3JUZXh0fWAgOiAnJztcbiAgICAgIH0gY2F0Y2ggKHRleHRFcnJvcikge1xuICAgICAgICBpZiAoREVCVUdfTU9ERSkge1xuICAgICAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IHJlYWQgZXJyb3IgcmVzcG9uc2UgYm9keTonLCB0ZXh0RXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICBlcnJvcjogYEhUVFAgJHtyZXNwb25zZS5zdGF0dXN9OiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9JHtlcnJvckRldGFpbHN9YFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBPYnRlbmVyIGVsIHRleHRvIHByaW1lcm9cbiAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgIGlmIChERUJVR19NT0RFKSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+ThCBSZXNwb25zZSB0ZXh0IHByZXZpZXc6JywgdGV4dC5zdWJzdHJpbmcoMCwgMjAwKSArICh0ZXh0Lmxlbmd0aCA+IDIwMCA/ICcuLi4nIDogJycpKTtcbiAgICB9XG5cbiAgICAvLyBQYXJzZWFyIGRlIGZvcm1hIHNlZ3VyYVxuICAgIGNvbnN0IHBhcnNlUmVzdWx0ID0gc2FmZUpzb25QYXJzZTxUPih0ZXh0KTtcbiAgICBpZiAoREVCVUdfTU9ERSkge1xuICAgIH1cblxuICAgIHJldHVybiBwYXJzZVJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgc2FmZUFwaVJlc3BvbnNlSnNvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZGF0YTogbnVsbCxcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdBUEkgcmVzcG9uc2UgZXJyb3InXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIENvbnN0YW50ZXMgcGFyYSBrZXlzIGRlIGxvY2FsU3RvcmFnZSBjb211bmVzXG4gKi9cbmV4cG9ydCBjb25zdCBTVE9SQUdFX0tFWVMgPSB7XG4gIENBUlQ6ICdwaW50ZXlhLWNhcnQnLFxuICBSRUNFTlRfU0VBUkNIRVM6ICdwaW50ZXlhLXJlY2VudC1zZWFyY2hlcycsXG4gIFVTRVJfUFJFRkVSRU5DRVM6ICdwaW50ZXlhLXVzZXItcHJlZmVyZW5jZXMnLFxuICBBTkFMWVRJQ1M6ICdwaW50ZXlhLWFuYWx5dGljcycsXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIEZ1bmNpw7NuIGRlIGluaWNpYWxpemFjacOzbiBwYXJhIGxpbXBpYXIgbG9jYWxTdG9yYWdlIGNvcnJ1cHRvIGFsIGNhcmdhciBsYSBhcHBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVKc29uU2FmZXR5KCk6IHZvaWQge1xuICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjtcblxuICBjb25zdCBrZXlzVG9DaGVjayA9IE9iamVjdC52YWx1ZXMoU1RPUkFHRV9LRVlTKTtcbiAgY29uc3QgY2xlYW5lZENvdW50ID0gY2xlYW5Db3JydXB0ZWRMb2NhbFN0b3JhZ2Uoa2V5c1RvQ2hlY2spO1xuICBcbiAgaWYgKGNsZWFuZWRDb3VudCA+IDApIHtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlNUT1JBR0VfS0VZUyIsImNsZWFuQ29ycnVwdGVkTG9jYWxTdG9yYWdlIiwiaW5pdGlhbGl6ZUpzb25TYWZldHkiLCJzYWZlQXBpUmVzcG9uc2VKc29uIiwic2FmZUpzb25QYXJzZSIsInNhZmVKc29uU3RyaW5naWZ5Iiwic2FmZUxvY2FsU3RvcmFnZUdldCIsInNhZmVMb2NhbFN0b3JhZ2VTZXQiLCJqc29uU3RyaW5nIiwic3VjY2VzcyIsImRhdGEiLCJlcnJvciIsInRyaW1tZWQiLCJ0cmltIiwiaW5jbHVkZXMiLCJsZW5ndGgiLCJwYXJzZWQiLCJKU09OIiwicGFyc2UiLCJ1bmRlZmluZWQiLCJFcnJvciIsIm1lc3NhZ2UiLCJzcGFjZSIsInJlc3VsdCIsInN0cmluZ2lmeSIsInNlZW4iLCJXZWFrU2V0Iiwia2V5IiwidmFsdWUiLCJoYXMiLCJhZGQiLCJmYWxsYmFja0Vycm9yIiwid2luZG93Iiwic3RvcmVkIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInN0cmluZ2lmeVJlc3VsdCIsInNldEl0ZW0iLCJrZXlzIiwiY2xlYW5lZENvdW50IiwiZm9yRWFjaCIsInBhcnNlUmVzdWx0IiwiY29uc29sZSIsIndhcm4iLCJyZW1vdmVJdGVtIiwicmVzcG9uc2UiLCJERUJVR19NT0RFIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwib2siLCJlcnJvckRldGFpbHMiLCJlcnJvclRleHQiLCJ0ZXh0IiwidGV4dEVycm9yIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsImxvZyIsInN1YnN0cmluZyIsIkNBUlQiLCJSRUNFTlRfU0VBUkNIRVMiLCJVU0VSX1BSRUZFUkVOQ0VTIiwiQU5BTFlUSUNTIiwia2V5c1RvQ2hlY2siLCJPYmplY3QiLCJ2YWx1ZXMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Q0FHQzs7Ozs7Ozs7Ozs7UUFnUVlBO2VBQUFBOztRQXJGR0M7ZUFBQUE7O1FBK0ZBQztlQUFBQTs7UUFoRU1DO2VBQUFBOztRQS9MTkM7ZUFBQUE7O1FBbURBQztlQUFBQTs7UUF3Q0FDO2VBQUFBOztRQWdDQUM7ZUFBQUE7OztBQTNIVCxTQUFTSCxjQUF1QkksVUFBcUM7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