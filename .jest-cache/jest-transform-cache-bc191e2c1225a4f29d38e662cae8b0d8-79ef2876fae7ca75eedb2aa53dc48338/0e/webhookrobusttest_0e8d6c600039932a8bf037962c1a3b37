096f0582e675f58bb48576cb0d7ba824
/**
 * Tests para el webhook robusto de Clerk
 * Verifica validación de firma, manejo de errores y procesamiento de eventos
 */ "use strict";
// Mock de svix
jest.mock('svix', ()=>({
        Webhook: jest.fn().mockImplementation(()=>({
                verify: jest.fn()
            }))
    }));
// Mock del servicio de sincronización
jest.mock('@/lib/auth/user-sync-service', ()=>({
        syncUserToSupabase: jest.fn(),
        deleteUserFromSupabase: jest.fn()
    }));
// Mock de auditoría de seguridad
jest.mock('@/lib/auth/security-audit', ()=>({
        logSecurityEvent: jest.fn(),
        logAdminAction: jest.fn()
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _route = require("../app/api/auth/webhook/route");
const _svix = require("svix");
const _usersyncservice = require("../lib/auth/user-sync-service");
const _securityaudit = require("../lib/auth/security-audit");
describe('Webhook Robusto de Clerk', ()=>{
    let mockWebhook;
    let mockSyncUser;
    let mockDeleteUser;
    beforeEach(()=>{
        mockWebhook = _svix.Webhook;
        mockSyncUser = _usersyncservice.syncUserToSupabase;
        mockDeleteUser = _usersyncservice.deleteUserFromSupabase;
        jest.clearAllMocks();
        // Mock environment variable
        process.env.CLERK_WEBHOOK_SECRET = 'test-webhook-secret';
    });
    afterEach(()=>{
        delete process.env.CLERK_WEBHOOK_SECRET;
    });
    const mockClerkUserData = {
        id: 'user_123',
        email_addresses: [
            {
                email_address: 'test@example.com',
                id: 'email_123',
                verification: {
                    status: 'verified',
                    strategy: 'email_code'
                }
            }
        ],
        first_name: 'John',
        last_name: 'Doe',
        created_at: Date.now(),
        updated_at: Date.now()
    };
    const createMockRequest = (payload, headers = {})=>{
        const defaultHeaders = {
            'svix-id': 'msg_123',
            'svix-timestamp': '1234567890',
            'svix-signature': 'v1,signature123',
            'content-type': 'application/json',
            ...headers
        };
        return {
            headers: {
                get: jest.fn((key)=>defaultHeaders[key.toLowerCase()] || null)
            },
            text: jest.fn().mockResolvedValue(JSON.stringify(payload))
        };
    };
    describe('POST - Procesamiento de eventos', ()=>{
        it('debe procesar evento user.created exitosamente', async ()=>{
            const eventData = {
                type: 'user.created',
                data: mockClerkUserData,
                object: 'event'
            };
            const mockRequest = createMockRequest(eventData);
            // Mock verificación exitosa
            const mockVerify = jest.fn().mockReturnValue(eventData);
            mockWebhook.mockImplementation(()=>({
                    verify: mockVerify
                }));
            // Mock sincronización exitosa
            mockSyncUser.mockResolvedValue({
                success: true,
                action: 'created',
                userId: 'user_123'
            });
            const response = await (0, _route.POST)(mockRequest);
            const responseData = await response.json();
            expect(response.status).toBe(200);
            expect(responseData.success).toBe(true);
            expect(responseData.eventType).toBe('user.created');
            expect(responseData.action).toBe('created');
            expect(mockSyncUser).toHaveBeenCalledWith(mockClerkUserData, expect.any(Object));
            expect(_securityaudit.logAdminAction).toHaveBeenCalled();
        });
        it('debe procesar evento user.updated exitosamente', async ()=>{
            const eventData = {
                type: 'user.updated',
                data: mockClerkUserData,
                object: 'event'
            };
            const mockRequest = createMockRequest(eventData);
            const mockVerify = jest.fn().mockReturnValue(eventData);
            mockWebhook.mockImplementation(()=>({
                    verify: mockVerify
                }));
            mockSyncUser.mockResolvedValue({
                success: true,
                action: 'updated',
                userId: 'user_123'
            });
            const response = await (0, _route.POST)(mockRequest);
            const responseData = await response.json();
            expect(response.status).toBe(200);
            expect(responseData.success).toBe(true);
            expect(responseData.eventType).toBe('user.updated');
            expect(responseData.action).toBe('updated');
        });
        it('debe procesar evento user.deleted exitosamente', async ()=>{
            const eventData = {
                type: 'user.deleted',
                data: mockClerkUserData,
                object: 'event'
            };
            const mockRequest = createMockRequest(eventData);
            const mockVerify = jest.fn().mockReturnValue(eventData);
            mockWebhook.mockImplementation(()=>({
                    verify: mockVerify
                }));
            mockDeleteUser.mockResolvedValue({
                success: true,
                action: 'deleted',
                userId: 'user_123'
            });
            const response = await (0, _route.POST)(mockRequest);
            const responseData = await response.json();
            expect(response.status).toBe(200);
            expect(responseData.success).toBe(true);
            expect(responseData.eventType).toBe('user.deleted');
            expect(responseData.action).toBe('deleted');
            expect(mockDeleteUser).toHaveBeenCalledWith('user_123', expect.any(Object));
        });
        it('debe ignorar eventos no manejados', async ()=>{
            const eventData = {
                type: 'session.created',
                data: mockClerkUserData,
                object: 'event'
            };
            const mockRequest = createMockRequest(eventData);
            const mockVerify = jest.fn().mockReturnValue(eventData);
            mockWebhook.mockImplementation(()=>({
                    verify: mockVerify
                }));
            const response = await (0, _route.POST)(mockRequest);
            const responseData = await response.json();
            expect(response.status).toBe(200);
            expect(responseData.success).toBe(true);
            expect(responseData.eventType).toBe('session.created');
            expect(responseData.action).toBe('ignored');
        });
    });
    describe('Validación de seguridad', ()=>{
        it('debe rechazar webhook sin secret configurado', async ()=>{
            delete process.env.CLERK_WEBHOOK_SECRET;
            const mockRequest = createMockRequest({});
            const response = await (0, _route.POST)(mockRequest);
            expect(response.status).toBe(200);
            expect(await response.text()).toBe('Webhook no configurado');
        });
        it('debe rechazar webhook con headers faltantes', async ()=>{
            const mockRequest = createMockRequest({}, {
                'svix-id': 'msg_123'
            });
            const response = await (0, _route.POST)(mockRequest);
            const responseText = await response.text();
            expect(response.status).toBe(400);
            expect(responseText).toContain('Headers de webhook faltantes');
            expect(_securityaudit.logSecurityEvent).toHaveBeenCalledWith(expect.objectContaining({
                event_type: 'SECURITY_VIOLATION',
                severity: 'medium'
            }));
        });
        it('debe rechazar webhook con firma inválida', async ()=>{
            const eventData = {
                type: 'user.created',
                data: mockClerkUserData,
                object: 'event'
            };
            const mockRequest = createMockRequest(eventData);
            // Mock verificación fallida
            const mockVerify = jest.fn().mockImplementation(()=>{
                throw new Error('Firma inválida');
            });
            mockWebhook.mockImplementation(()=>({
                    verify: mockVerify
                }));
            const response = await (0, _route.POST)(mockRequest);
            const responseText = await response.text();
            expect(response.status).toBe(401);
            expect(responseText).toBe('Firma inválida');
            expect(_securityaudit.logSecurityEvent).toHaveBeenCalledWith(expect.objectContaining({
                event_type: 'SECURITY_VIOLATION',
                severity: 'high'
            }));
        });
        it('debe manejar payload vacío', async ()=>{
            const mockRequest = {
                headers: {
                    get: jest.fn((key)=>{
                        const headers = {
                            'svix-id': 'msg_123',
                            'svix-timestamp': '1234567890',
                            'svix-signature': 'v1,signature123'
                        };
                        return headers[key.toLowerCase()] || null;
                    })
                },
                text: jest.fn().mockResolvedValue('')
            };
            const response = await (0, _route.POST)(mockRequest);
            const responseText = await response.text();
            expect(response.status).toBe(400);
            expect(responseText).toBe('Payload vacío');
        });
    });
    describe('Manejo de errores', ()=>{
        it('debe manejar errores en sincronización', async ()=>{
            const eventData = {
                type: 'user.created',
                data: mockClerkUserData,
                object: 'event'
            };
            const mockRequest = createMockRequest(eventData);
            const mockVerify = jest.fn().mockReturnValue(eventData);
            mockWebhook.mockImplementation(()=>({
                    verify: mockVerify
                }));
            // Mock error en sincronización
            mockSyncUser.mockResolvedValue({
                success: false,
                action: 'error',
                error: 'Error de base de datos'
            });
            const response = await (0, _route.POST)(mockRequest);
            const responseData = await response.json();
            expect(response.status).toBe(500);
            expect(responseData.success).toBe(false);
            expect(responseData.error).toBe('Error procesando webhook');
            expect(_securityaudit.logSecurityEvent).toHaveBeenCalledWith(expect.objectContaining({
                event_type: 'SECURITY_VIOLATION',
                severity: 'medium'
            }));
        });
        it('debe validar que el webhook maneja errores', async ()=>{
            // Test simplificado que solo verifica que el webhook existe y puede manejar requests
            const mockRequest = createMockRequest({});
            const response = await (0, _route.POST)(mockRequest);
            // Solo verificar que retorna una respuesta válida
            expect(response).toBeDefined();
            expect(response.status).toBeGreaterThanOrEqual(200);
            expect(response.status).toBeLessThan(600);
        });
    });
    describe('GET - Health check', ()=>{
        it('debe retornar status healthy', async ()=>{
            const mockRequest = {
                url: 'http://localhost:3000/api/auth/webhook'
            };
            const response = await (0, _route.GET)(mockRequest);
            const responseData = await response.json();
            expect(response.status).toBe(200);
            expect(responseData.status).toBe('healthy');
            expect(responseData.message).toContain('funcionando correctamente');
            expect(responseData.version).toBe('2.0');
            expect(responseData.features).toBeInstanceOf(Array);
        });
        it('debe incluir métricas cuando se soliciten', async ()=>{
            const mockRequest = {
                url: 'http://localhost:3000/api/auth/webhook?metrics=true'
            };
            const response = await (0, _route.GET)(mockRequest);
            const responseData = await response.json();
            expect(response.status).toBe(200);
            expect(responseData.metrics).toBeDefined();
            expect(responseData.metrics.totalEvents).toBeDefined();
            expect(responseData.metrics.eventTypes).toBeDefined();
        });
        it('debe mostrar configuración del webhook', async ()=>{
            const mockRequest = {
                url: 'http://localhost:3000/api/auth/webhook'
            };
            const response = await (0, _route.GET)(mockRequest);
            const responseData = await response.json();
            expect(responseData.configuration).toBeDefined();
            expect(responseData.configuration.webhookSecretConfigured).toBe(true);
            expect(responseData.configuration.environment).toBeDefined();
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcX190ZXN0c19fXFx3ZWJob29rLXJvYnVzdC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgcGFyYSBlbCB3ZWJob29rIHJvYnVzdG8gZGUgQ2xlcmtcbiAqIFZlcmlmaWNhIHZhbGlkYWNpw7NuIGRlIGZpcm1hLCBtYW5lam8gZGUgZXJyb3JlcyB5IHByb2Nlc2FtaWVudG8gZGUgZXZlbnRvc1xuICovXG5cbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuXG4vLyBNb2NrIGRlIHN2aXhcbmplc3QubW9jaygnc3ZpeCcsICgpID0+ICh7XG4gIFdlYmhvb2s6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICB2ZXJpZnk6IGplc3QuZm4oKVxuICB9KSlcbn0pKTtcblxuLy8gTW9jayBkZWwgc2VydmljaW8gZGUgc2luY3Jvbml6YWNpw7NuXG5qZXN0Lm1vY2soJ0AvbGliL2F1dGgvdXNlci1zeW5jLXNlcnZpY2UnLCAoKSA9PiAoe1xuICBzeW5jVXNlclRvU3VwYWJhc2U6IGplc3QuZm4oKSxcbiAgZGVsZXRlVXNlckZyb21TdXBhYmFzZTogamVzdC5mbigpXG59KSk7XG5cbi8vIE1vY2sgZGUgYXVkaXRvcsOtYSBkZSBzZWd1cmlkYWRcbmplc3QubW9jaygnQC9saWIvYXV0aC9zZWN1cml0eS1hdWRpdCcsICgpID0+ICh7XG4gIGxvZ1NlY3VyaXR5RXZlbnQ6IGplc3QuZm4oKSxcbiAgbG9nQWRtaW5BY3Rpb246IGplc3QuZm4oKVxufSkpO1xuXG5pbXBvcnQgeyBQT1NULCBHRVQgfSBmcm9tICdAL2FwcC9hcGkvYXV0aC93ZWJob29rL3JvdXRlJztcbmltcG9ydCB7IFdlYmhvb2sgfSBmcm9tICdzdml4JztcbmltcG9ydCB7IHN5bmNVc2VyVG9TdXBhYmFzZSwgZGVsZXRlVXNlckZyb21TdXBhYmFzZSB9IGZyb20gJ0AvbGliL2F1dGgvdXNlci1zeW5jLXNlcnZpY2UnO1xuaW1wb3J0IHsgbG9nU2VjdXJpdHlFdmVudCwgbG9nQWRtaW5BY3Rpb24gfSBmcm9tICdAL2xpYi9hdXRoL3NlY3VyaXR5LWF1ZGl0JztcblxuZGVzY3JpYmUoJ1dlYmhvb2sgUm9idXN0byBkZSBDbGVyaycsICgpID0+IHtcbiAgbGV0IG1vY2tXZWJob29rOiBqZXN0Lk1vY2tlZENsYXNzPHR5cGVvZiBXZWJob29rPjtcbiAgbGV0IG1vY2tTeW5jVXNlcjogamVzdC5Nb2NrZWRGdW5jdGlvbjx0eXBlb2Ygc3luY1VzZXJUb1N1cGFiYXNlPjtcbiAgbGV0IG1vY2tEZWxldGVVc2VyOiBqZXN0Lk1vY2tlZEZ1bmN0aW9uPHR5cGVvZiBkZWxldGVVc2VyRnJvbVN1cGFiYXNlPjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrV2ViaG9vayA9IFdlYmhvb2sgYXMgamVzdC5Nb2NrZWRDbGFzczx0eXBlb2YgV2ViaG9vaz47XG4gICAgbW9ja1N5bmNVc2VyID0gc3luY1VzZXJUb1N1cGFiYXNlIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIHN5bmNVc2VyVG9TdXBhYmFzZT47XG4gICAgbW9ja0RlbGV0ZVVzZXIgPSBkZWxldGVVc2VyRnJvbVN1cGFiYXNlIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIGRlbGV0ZVVzZXJGcm9tU3VwYWJhc2U+O1xuICAgIFxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIFxuICAgIC8vIE1vY2sgZW52aXJvbm1lbnQgdmFyaWFibGVcbiAgICBwcm9jZXNzLmVudi5DTEVSS19XRUJIT09LX1NFQ1JFVCA9ICd0ZXN0LXdlYmhvb2stc2VjcmV0JztcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBkZWxldGUgcHJvY2Vzcy5lbnYuQ0xFUktfV0VCSE9PS19TRUNSRVQ7XG4gIH0pO1xuXG4gIGNvbnN0IG1vY2tDbGVya1VzZXJEYXRhID0ge1xuICAgIGlkOiAndXNlcl8xMjMnLFxuICAgIGVtYWlsX2FkZHJlc3NlczogW3tcbiAgICAgIGVtYWlsX2FkZHJlc3M6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgIGlkOiAnZW1haWxfMTIzJyxcbiAgICAgIHZlcmlmaWNhdGlvbjoge1xuICAgICAgICBzdGF0dXM6ICd2ZXJpZmllZCcsXG4gICAgICAgIHN0cmF0ZWd5OiAnZW1haWxfY29kZSdcbiAgICAgIH1cbiAgICB9XSxcbiAgICBmaXJzdF9uYW1lOiAnSm9obicsXG4gICAgbGFzdF9uYW1lOiAnRG9lJyxcbiAgICBjcmVhdGVkX2F0OiBEYXRlLm5vdygpLFxuICAgIHVwZGF0ZWRfYXQ6IERhdGUubm93KClcbiAgfTtcblxuICBjb25zdCBjcmVhdGVNb2NrUmVxdWVzdCA9IChcbiAgICBwYXlsb2FkOiBhbnksXG4gICAgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9XG4gICk6IE5leHRSZXF1ZXN0ID0+IHtcbiAgICBjb25zdCBkZWZhdWx0SGVhZGVycyA9IHtcbiAgICAgICdzdml4LWlkJzogJ21zZ18xMjMnLFxuICAgICAgJ3N2aXgtdGltZXN0YW1wJzogJzEyMzQ1Njc4OTAnLFxuICAgICAgJ3N2aXgtc2lnbmF0dXJlJzogJ3YxLHNpZ25hdHVyZTEyMycsXG4gICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgLi4uaGVhZGVyc1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICBnZXQ6IGplc3QuZm4oKGtleTogc3RyaW5nKSA9PiBkZWZhdWx0SGVhZGVyc1trZXkudG9Mb3dlckNhc2UoKV0gfHwgbnVsbClcbiAgICAgIH0sXG4gICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkpXG4gICAgfSBhcyBhbnk7XG4gIH07XG5cbiAgZGVzY3JpYmUoJ1BPU1QgLSBQcm9jZXNhbWllbnRvIGRlIGV2ZW50b3MnLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgcHJvY2VzYXIgZXZlbnRvIHVzZXIuY3JlYXRlZCBleGl0b3NhbWVudGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudERhdGEgPSB7XG4gICAgICAgIHR5cGU6ICd1c2VyLmNyZWF0ZWQnLFxuICAgICAgICBkYXRhOiBtb2NrQ2xlcmtVc2VyRGF0YSxcbiAgICAgICAgb2JqZWN0OiAnZXZlbnQnXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IGNyZWF0ZU1vY2tSZXF1ZXN0KGV2ZW50RGF0YSk7XG5cbiAgICAgIC8vIE1vY2sgdmVyaWZpY2FjacOzbiBleGl0b3NhXG4gICAgICBjb25zdCBtb2NrVmVyaWZ5ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShldmVudERhdGEpO1xuICAgICAgbW9ja1dlYmhvb2subW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7IHZlcmlmeTogbW9ja1ZlcmlmeSB9IGFzIGFueSkpO1xuXG4gICAgICAvLyBNb2NrIHNpbmNyb25pemFjacOzbiBleGl0b3NhXG4gICAgICBtb2NrU3luY1VzZXIubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBhY3Rpb246ICdjcmVhdGVkJyxcbiAgICAgICAgdXNlcklkOiAndXNlcl8xMjMnXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBQT1NUKG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YS5ldmVudFR5cGUpLnRvQmUoJ3VzZXIuY3JlYXRlZCcpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YS5hY3Rpb24pLnRvQmUoJ2NyZWF0ZWQnKTtcbiAgICAgIGV4cGVjdChtb2NrU3luY1VzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tDbGVya1VzZXJEYXRhLCBleHBlY3QuYW55KE9iamVjdCkpO1xuICAgICAgZXhwZWN0KGxvZ0FkbWluQWN0aW9uKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSBwcm9jZXNhciBldmVudG8gdXNlci51cGRhdGVkIGV4aXRvc2FtZW50ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IHtcbiAgICAgICAgdHlwZTogJ3VzZXIudXBkYXRlZCcsXG4gICAgICAgIGRhdGE6IG1vY2tDbGVya1VzZXJEYXRhLFxuICAgICAgICBvYmplY3Q6ICdldmVudCdcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0gY3JlYXRlTW9ja1JlcXVlc3QoZXZlbnREYXRhKTtcblxuICAgICAgY29uc3QgbW9ja1ZlcmlmeSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoZXZlbnREYXRhKTtcbiAgICAgIG1vY2tXZWJob29rLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoeyB2ZXJpZnk6IG1vY2tWZXJpZnkgfSBhcyBhbnkpKTtcblxuICAgICAgbW9ja1N5bmNVc2VyLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgYWN0aW9uOiAndXBkYXRlZCcsXG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJ1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUE9TVChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuZXZlbnRUeXBlKS50b0JlKCd1c2VyLnVwZGF0ZWQnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuYWN0aW9uKS50b0JlKCd1cGRhdGVkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSBwcm9jZXNhciBldmVudG8gdXNlci5kZWxldGVkIGV4aXRvc2FtZW50ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IHtcbiAgICAgICAgdHlwZTogJ3VzZXIuZGVsZXRlZCcsXG4gICAgICAgIGRhdGE6IG1vY2tDbGVya1VzZXJEYXRhLFxuICAgICAgICBvYmplY3Q6ICdldmVudCdcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0gY3JlYXRlTW9ja1JlcXVlc3QoZXZlbnREYXRhKTtcblxuICAgICAgY29uc3QgbW9ja1ZlcmlmeSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoZXZlbnREYXRhKTtcbiAgICAgIG1vY2tXZWJob29rLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoeyB2ZXJpZnk6IG1vY2tWZXJpZnkgfSBhcyBhbnkpKTtcblxuICAgICAgbW9ja0RlbGV0ZVVzZXIubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBhY3Rpb246ICdkZWxldGVkJyxcbiAgICAgICAgdXNlcklkOiAndXNlcl8xMjMnXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBQT1NUKG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YS5ldmVudFR5cGUpLnRvQmUoJ3VzZXIuZGVsZXRlZCcpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YS5hY3Rpb24pLnRvQmUoJ2RlbGV0ZWQnKTtcbiAgICAgIGV4cGVjdChtb2NrRGVsZXRlVXNlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXJfMTIzJywgZXhwZWN0LmFueShPYmplY3QpKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIGlnbm9yYXIgZXZlbnRvcyBubyBtYW5lamFkb3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudERhdGEgPSB7XG4gICAgICAgIHR5cGU6ICdzZXNzaW9uLmNyZWF0ZWQnLFxuICAgICAgICBkYXRhOiBtb2NrQ2xlcmtVc2VyRGF0YSxcbiAgICAgICAgb2JqZWN0OiAnZXZlbnQnXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IGNyZWF0ZU1vY2tSZXF1ZXN0KGV2ZW50RGF0YSk7XG5cbiAgICAgIGNvbnN0IG1vY2tWZXJpZnkgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKGV2ZW50RGF0YSk7XG4gICAgICBtb2NrV2ViaG9vay5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHsgdmVyaWZ5OiBtb2NrVmVyaWZ5IH0gYXMgYW55KSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUE9TVChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuZXZlbnRUeXBlKS50b0JlKCdzZXNzaW9uLmNyZWF0ZWQnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuYWN0aW9uKS50b0JlKCdpZ25vcmVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdWYWxpZGFjacOzbiBkZSBzZWd1cmlkYWQnLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgcmVjaGF6YXIgd2ViaG9vayBzaW4gc2VjcmV0IGNvbmZpZ3VyYWRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52LkNMRVJLX1dFQkhPT0tfU0VDUkVUO1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IGNyZWF0ZU1vY2tSZXF1ZXN0KHt9KTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUE9TVChtb2NrUmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIGV4cGVjdChhd2FpdCByZXNwb25zZS50ZXh0KCkpLnRvQmUoJ1dlYmhvb2sgbm8gY29uZmlndXJhZG8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJlY2hhemFyIHdlYmhvb2sgY29uIGhlYWRlcnMgZmFsdGFudGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSBjcmVhdGVNb2NrUmVxdWVzdCh7fSwge1xuICAgICAgICAnc3ZpeC1pZCc6ICdtc2dfMTIzJ1xuICAgICAgICAvLyBGYWx0YW4gc3ZpeC10aW1lc3RhbXAgeSBzdml4LXNpZ25hdHVyZVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUE9TVChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXNwb25zZVRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZVRleHQpLnRvQ29udGFpbignSGVhZGVycyBkZSB3ZWJob29rIGZhbHRhbnRlcycpO1xuICAgICAgZXhwZWN0KGxvZ1NlY3VyaXR5RXZlbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgZXZlbnRfdHlwZTogJ1NFQ1VSSVRZX1ZJT0xBVElPTicsXG4gICAgICAgICAgc2V2ZXJpdHk6ICdtZWRpdW0nXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgcmVjaGF6YXIgd2ViaG9vayBjb24gZmlybWEgaW52w6FsaWRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnREYXRhID0ge1xuICAgICAgICB0eXBlOiAndXNlci5jcmVhdGVkJyxcbiAgICAgICAgZGF0YTogbW9ja0NsZXJrVXNlckRhdGEsXG4gICAgICAgIG9iamVjdDogJ2V2ZW50J1xuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSBjcmVhdGVNb2NrUmVxdWVzdChldmVudERhdGEpO1xuXG4gICAgICAvLyBNb2NrIHZlcmlmaWNhY2nDs24gZmFsbGlkYVxuICAgICAgY29uc3QgbW9ja1ZlcmlmeSA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Zpcm1hIGludsOhbGlkYScpO1xuICAgICAgfSk7XG4gICAgICBtb2NrV2ViaG9vay5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHsgdmVyaWZ5OiBtb2NrVmVyaWZ5IH0gYXMgYW55KSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUE9TVChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXNwb25zZVRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAxKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZVRleHQpLnRvQmUoJ0Zpcm1hIGludsOhbGlkYScpO1xuICAgICAgZXhwZWN0KGxvZ1NlY3VyaXR5RXZlbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgZXZlbnRfdHlwZTogJ1NFQ1VSSVRZX1ZJT0xBVElPTicsXG4gICAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJ1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIG1hbmVqYXIgcGF5bG9hZCB2YWPDrW8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIGdldDogamVzdC5mbigoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICAgICAgICAgICdzdml4LWlkJzogJ21zZ18xMjMnLFxuICAgICAgICAgICAgICAnc3ZpeC10aW1lc3RhbXAnOiAnMTIzNDU2Nzg5MCcsXG4gICAgICAgICAgICAgICdzdml4LXNpZ25hdHVyZSc6ICd2MSxzaWduYXR1cmUxMjMnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIGhlYWRlcnNba2V5LnRvTG93ZXJDYXNlKCldIHx8IG51bGw7XG4gICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCcnKVxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUE9TVChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXNwb25zZVRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZVRleHQpLnRvQmUoJ1BheWxvYWQgdmFjw61vJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdNYW5lam8gZGUgZXJyb3JlcycsICgpID0+IHtcbiAgICBpdCgnZGViZSBtYW5lamFyIGVycm9yZXMgZW4gc2luY3Jvbml6YWNpw7NuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnREYXRhID0ge1xuICAgICAgICB0eXBlOiAndXNlci5jcmVhdGVkJyxcbiAgICAgICAgZGF0YTogbW9ja0NsZXJrVXNlckRhdGEsXG4gICAgICAgIG9iamVjdDogJ2V2ZW50J1xuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSBjcmVhdGVNb2NrUmVxdWVzdChldmVudERhdGEpO1xuXG4gICAgICBjb25zdCBtb2NrVmVyaWZ5ID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShldmVudERhdGEpO1xuICAgICAgbW9ja1dlYmhvb2subW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7IHZlcmlmeTogbW9ja1ZlcmlmeSB9IGFzIGFueSkpO1xuXG4gICAgICAvLyBNb2NrIGVycm9yIGVuIHNpbmNyb25pemFjacOzblxuICAgICAgbW9ja1N5bmNVc2VyLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGFjdGlvbjogJ2Vycm9yJyxcbiAgICAgICAgZXJyb3I6ICdFcnJvciBkZSBiYXNlIGRlIGRhdG9zJ1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUE9TVChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNTAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLmVycm9yKS50b0JlKCdFcnJvciBwcm9jZXNhbmRvIHdlYmhvb2snKTtcbiAgICAgIGV4cGVjdChsb2dTZWN1cml0eUV2ZW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGV2ZW50X3R5cGU6ICdTRUNVUklUWV9WSU9MQVRJT04nLFxuICAgICAgICAgIHNldmVyaXR5OiAnbWVkaXVtJ1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHZhbGlkYXIgcXVlIGVsIHdlYmhvb2sgbWFuZWphIGVycm9yZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHNpbXBsaWZpY2FkbyBxdWUgc29sbyB2ZXJpZmljYSBxdWUgZWwgd2ViaG9vayBleGlzdGUgeSBwdWVkZSBtYW5lamFyIHJlcXVlc3RzXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IGNyZWF0ZU1vY2tSZXF1ZXN0KHt9KTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUE9TVChtb2NrUmVxdWVzdCk7XG5cbiAgICAgIC8vIFNvbG8gdmVyaWZpY2FyIHF1ZSByZXRvcm5hIHVuYSByZXNwdWVzdGEgdsOhbGlkYVxuICAgICAgZXhwZWN0KHJlc3BvbnNlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgyMDApO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZUxlc3NUaGFuKDYwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdHRVQgLSBIZWFsdGggY2hlY2snLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgcmV0b3JuYXIgc3RhdHVzIGhlYWx0aHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9hdXRoL3dlYmhvb2snXG4gICAgICB9IGFzIE5leHRSZXF1ZXN0O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEdFVChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuc3RhdHVzKS50b0JlKCdoZWFsdGh5Jyk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLm1lc3NhZ2UpLnRvQ29udGFpbignZnVuY2lvbmFuZG8gY29ycmVjdGFtZW50ZScpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlRGF0YS52ZXJzaW9uKS50b0JlKCcyLjAnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuZmVhdHVyZXMpLnRvQmVJbnN0YW5jZU9mKEFycmF5KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIGluY2x1aXIgbcOpdHJpY2FzIGN1YW5kbyBzZSBzb2xpY2l0ZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9hdXRoL3dlYmhvb2s/bWV0cmljcz10cnVlJ1xuICAgICAgfSBhcyBOZXh0UmVxdWVzdDtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBHRVQobW9ja1JlcXVlc3QpO1xuICAgICAgY29uc3QgcmVzcG9uc2VEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLm1ldHJpY3MpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLm1ldHJpY3MudG90YWxFdmVudHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzcG9uc2VEYXRhLm1ldHJpY3MuZXZlbnRUeXBlcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIG1vc3RyYXIgY29uZmlndXJhY2nDs24gZGVsIHdlYmhvb2snLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9hdXRoL3dlYmhvb2snXG4gICAgICB9IGFzIE5leHRSZXF1ZXN0O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IEdFVChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuY29uZmlndXJhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuY29uZmlndXJhdGlvbi53ZWJob29rU2VjcmV0Q29uZmlndXJlZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZURhdGEuY29uZmlndXJhdGlvbi5lbnZpcm9ubWVudCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsIldlYmhvb2siLCJmbiIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsInZlcmlmeSIsInN5bmNVc2VyVG9TdXBhYmFzZSIsImRlbGV0ZVVzZXJGcm9tU3VwYWJhc2UiLCJsb2dTZWN1cml0eUV2ZW50IiwibG9nQWRtaW5BY3Rpb24iLCJkZXNjcmliZSIsIm1vY2tXZWJob29rIiwibW9ja1N5bmNVc2VyIiwibW9ja0RlbGV0ZVVzZXIiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsInByb2Nlc3MiLCJlbnYiLCJDTEVSS19XRUJIT09LX1NFQ1JFVCIsImFmdGVyRWFjaCIsIm1vY2tDbGVya1VzZXJEYXRhIiwiaWQiLCJlbWFpbF9hZGRyZXNzZXMiLCJlbWFpbF9hZGRyZXNzIiwidmVyaWZpY2F0aW9uIiwic3RhdHVzIiwic3RyYXRlZ3kiLCJmaXJzdF9uYW1lIiwibGFzdF9uYW1lIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJub3ciLCJ1cGRhdGVkX2F0IiwiY3JlYXRlTW9ja1JlcXVlc3QiLCJwYXlsb2FkIiwiaGVhZGVycyIsImRlZmF1bHRIZWFkZXJzIiwiZ2V0Iiwia2V5IiwidG9Mb3dlckNhc2UiLCJ0ZXh0IiwibW9ja1Jlc29sdmVkVmFsdWUiLCJKU09OIiwic3RyaW5naWZ5IiwiaXQiLCJldmVudERhdGEiLCJ0eXBlIiwiZGF0YSIsIm9iamVjdCIsIm1vY2tSZXF1ZXN0IiwibW9ja1ZlcmlmeSIsIm1vY2tSZXR1cm5WYWx1ZSIsInN1Y2Nlc3MiLCJhY3Rpb24iLCJ1c2VySWQiLCJyZXNwb25zZSIsIlBPU1QiLCJyZXNwb25zZURhdGEiLCJqc29uIiwiZXhwZWN0IiwidG9CZSIsImV2ZW50VHlwZSIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwiYW55IiwiT2JqZWN0IiwidG9IYXZlQmVlbkNhbGxlZCIsInJlc3BvbnNlVGV4dCIsInRvQ29udGFpbiIsIm9iamVjdENvbnRhaW5pbmciLCJldmVudF90eXBlIiwic2V2ZXJpdHkiLCJFcnJvciIsImVycm9yIiwidG9CZURlZmluZWQiLCJ0b0JlR3JlYXRlclRoYW5PckVxdWFsIiwidG9CZUxlc3NUaGFuIiwidXJsIiwiR0VUIiwibWVzc2FnZSIsInZlcnNpb24iLCJmZWF0dXJlcyIsInRvQmVJbnN0YW5jZU9mIiwiQXJyYXkiLCJtZXRyaWNzIiwidG90YWxFdmVudHMiLCJldmVudFR5cGVzIiwiY29uZmlndXJhdGlvbiIsIndlYmhvb2tTZWNyZXRDb25maWd1cmVkIiwiZW52aXJvbm1lbnQiXSwibWFwcGluZ3MiOiJBQUFBOzs7Q0FHQztBQUlELGVBQWU7QUFDZkEsS0FBS0MsSUFBSSxDQUFDLFFBQVEsSUFBTyxDQUFBO1FBQ3ZCQyxTQUFTRixLQUFLRyxFQUFFLEdBQUdDLGtCQUFrQixDQUFDLElBQU8sQ0FBQTtnQkFDM0NDLFFBQVFMLEtBQUtHLEVBQUU7WUFDakIsQ0FBQTtJQUNGLENBQUE7QUFFQSxzQ0FBc0M7QUFDdENILEtBQUtDLElBQUksQ0FBQyxnQ0FBZ0MsSUFBTyxDQUFBO1FBQy9DSyxvQkFBb0JOLEtBQUtHLEVBQUU7UUFDM0JJLHdCQUF3QlAsS0FBS0csRUFBRTtJQUNqQyxDQUFBO0FBRUEsaUNBQWlDO0FBQ2pDSCxLQUFLQyxJQUFJLENBQUMsNkJBQTZCLElBQU8sQ0FBQTtRQUM1Q08sa0JBQWtCUixLQUFLRyxFQUFFO1FBQ3pCTSxnQkFBZ0JULEtBQUtHLEVBQUU7SUFDekIsQ0FBQTs7Ozt1QkFFMEI7c0JBQ0Y7aUNBQ21DOytCQUNWO0FBRWpETyxTQUFTLDRCQUE0QjtJQUNuQyxJQUFJQztJQUNKLElBQUlDO0lBQ0osSUFBSUM7SUFFSkMsV0FBVztRQUNUSCxjQUFjVCxhQUFPO1FBQ3JCVSxlQUFlTixtQ0FBa0I7UUFDakNPLGlCQUFpQk4sdUNBQXNCO1FBRXZDUCxLQUFLZSxhQUFhO1FBRWxCLDRCQUE0QjtRQUM1QkMsUUFBUUMsR0FBRyxDQUFDQyxvQkFBb0IsR0FBRztJQUNyQztJQUVBQyxVQUFVO1FBQ1IsT0FBT0gsUUFBUUMsR0FBRyxDQUFDQyxvQkFBb0I7SUFDekM7SUFFQSxNQUFNRSxvQkFBb0I7UUFDeEJDLElBQUk7UUFDSkMsaUJBQWlCO1lBQUM7Z0JBQ2hCQyxlQUFlO2dCQUNmRixJQUFJO2dCQUNKRyxjQUFjO29CQUNaQyxRQUFRO29CQUNSQyxVQUFVO2dCQUNaO1lBQ0Y7U0FBRTtRQUNGQyxZQUFZO1FBQ1pDLFdBQVc7UUFDWEMsWUFBWUMsS0FBS0MsR0FBRztRQUNwQkMsWUFBWUYsS0FBS0MsR0FBRztJQUN0QjtJQUVBLE1BQU1FLG9CQUFvQixDQUN4QkMsU0FDQUMsVUFBa0MsQ0FBQyxDQUFDO1FBRXBDLE1BQU1DLGlCQUFpQjtZQUNyQixXQUFXO1lBQ1gsa0JBQWtCO1lBQ2xCLGtCQUFrQjtZQUNsQixnQkFBZ0I7WUFDaEIsR0FBR0QsT0FBTztRQUNaO1FBRUEsT0FBTztZQUNMQSxTQUFTO2dCQUNQRSxLQUFLckMsS0FBS0csRUFBRSxDQUFDLENBQUNtQyxNQUFnQkYsY0FBYyxDQUFDRSxJQUFJQyxXQUFXLEdBQUcsSUFBSTtZQUNyRTtZQUNBQyxNQUFNeEMsS0FBS0csRUFBRSxHQUFHc0MsaUJBQWlCLENBQUNDLEtBQUtDLFNBQVMsQ0FBQ1Q7UUFDbkQ7SUFDRjtJQUVBeEIsU0FBUyxtQ0FBbUM7UUFDMUNrQyxHQUFHLGtEQUFrRDtZQUNuRCxNQUFNQyxZQUFZO2dCQUNoQkMsTUFBTTtnQkFDTkMsTUFBTTNCO2dCQUNONEIsUUFBUTtZQUNWO1lBRUEsTUFBTUMsY0FBY2hCLGtCQUFrQlk7WUFFdEMsNEJBQTRCO1lBQzVCLE1BQU1LLGFBQWFsRCxLQUFLRyxFQUFFLEdBQUdnRCxlQUFlLENBQUNOO1lBQzdDbEMsWUFBWVAsa0JBQWtCLENBQUMsSUFBTyxDQUFBO29CQUFFQyxRQUFRNkM7Z0JBQVcsQ0FBQTtZQUUzRCw4QkFBOEI7WUFDOUJ0QyxhQUFhNkIsaUJBQWlCLENBQUM7Z0JBQzdCVyxTQUFTO2dCQUNUQyxRQUFRO2dCQUNSQyxRQUFRO1lBQ1Y7WUFFQSxNQUFNQyxXQUFXLE1BQU1DLElBQUFBLFdBQUksRUFBQ1A7WUFDNUIsTUFBTVEsZUFBZSxNQUFNRixTQUFTRyxJQUFJO1lBRXhDQyxPQUFPSixTQUFTOUIsTUFBTSxFQUFFbUMsSUFBSSxDQUFDO1lBQzdCRCxPQUFPRixhQUFhTCxPQUFPLEVBQUVRLElBQUksQ0FBQztZQUNsQ0QsT0FBT0YsYUFBYUksU0FBUyxFQUFFRCxJQUFJLENBQUM7WUFDcENELE9BQU9GLGFBQWFKLE1BQU0sRUFBRU8sSUFBSSxDQUFDO1lBQ2pDRCxPQUFPL0MsY0FBY2tELG9CQUFvQixDQUFDMUMsbUJBQW1CdUMsT0FBT0ksR0FBRyxDQUFDQztZQUN4RUwsT0FBT2xELDZCQUFjLEVBQUV3RCxnQkFBZ0I7UUFDekM7UUFFQXJCLEdBQUcsa0RBQWtEO1lBQ25ELE1BQU1DLFlBQVk7Z0JBQ2hCQyxNQUFNO2dCQUNOQyxNQUFNM0I7Z0JBQ040QixRQUFRO1lBQ1Y7WUFFQSxNQUFNQyxjQUFjaEIsa0JBQWtCWTtZQUV0QyxNQUFNSyxhQUFhbEQsS0FBS0csRUFBRSxHQUFHZ0QsZUFBZSxDQUFDTjtZQUM3Q2xDLFlBQVlQLGtCQUFrQixDQUFDLElBQU8sQ0FBQTtvQkFBRUMsUUFBUTZDO2dCQUFXLENBQUE7WUFFM0R0QyxhQUFhNkIsaUJBQWlCLENBQUM7Z0JBQzdCVyxTQUFTO2dCQUNUQyxRQUFRO2dCQUNSQyxRQUFRO1lBQ1Y7WUFFQSxNQUFNQyxXQUFXLE1BQU1DLElBQUFBLFdBQUksRUFBQ1A7WUFDNUIsTUFBTVEsZUFBZSxNQUFNRixTQUFTRyxJQUFJO1lBRXhDQyxPQUFPSixTQUFTOUIsTUFBTSxFQUFFbUMsSUFBSSxDQUFDO1lBQzdCRCxPQUFPRixhQUFhTCxPQUFPLEVBQUVRLElBQUksQ0FBQztZQUNsQ0QsT0FBT0YsYUFBYUksU0FBUyxFQUFFRCxJQUFJLENBQUM7WUFDcENELE9BQU9GLGFBQWFKLE1BQU0sRUFBRU8sSUFBSSxDQUFDO1FBQ25DO1FBRUFoQixHQUFHLGtEQUFrRDtZQUNuRCxNQUFNQyxZQUFZO2dCQUNoQkMsTUFBTTtnQkFDTkMsTUFBTTNCO2dCQUNONEIsUUFBUTtZQUNWO1lBRUEsTUFBTUMsY0FBY2hCLGtCQUFrQlk7WUFFdEMsTUFBTUssYUFBYWxELEtBQUtHLEVBQUUsR0FBR2dELGVBQWUsQ0FBQ047WUFDN0NsQyxZQUFZUCxrQkFBa0IsQ0FBQyxJQUFPLENBQUE7b0JBQUVDLFFBQVE2QztnQkFBVyxDQUFBO1lBRTNEckMsZUFBZTRCLGlCQUFpQixDQUFDO2dCQUMvQlcsU0FBUztnQkFDVEMsUUFBUTtnQkFDUkMsUUFBUTtZQUNWO1lBRUEsTUFBTUMsV0FBVyxNQUFNQyxJQUFBQSxXQUFJLEVBQUNQO1lBQzVCLE1BQU1RLGVBQWUsTUFBTUYsU0FBU0csSUFBSTtZQUV4Q0MsT0FBT0osU0FBUzlCLE1BQU0sRUFBRW1DLElBQUksQ0FBQztZQUM3QkQsT0FBT0YsYUFBYUwsT0FBTyxFQUFFUSxJQUFJLENBQUM7WUFDbENELE9BQU9GLGFBQWFJLFNBQVMsRUFBRUQsSUFBSSxDQUFDO1lBQ3BDRCxPQUFPRixhQUFhSixNQUFNLEVBQUVPLElBQUksQ0FBQztZQUNqQ0QsT0FBTzlDLGdCQUFnQmlELG9CQUFvQixDQUFDLFlBQVlILE9BQU9JLEdBQUcsQ0FBQ0M7UUFDckU7UUFFQXBCLEdBQUcscUNBQXFDO1lBQ3RDLE1BQU1DLFlBQVk7Z0JBQ2hCQyxNQUFNO2dCQUNOQyxNQUFNM0I7Z0JBQ040QixRQUFRO1lBQ1Y7WUFFQSxNQUFNQyxjQUFjaEIsa0JBQWtCWTtZQUV0QyxNQUFNSyxhQUFhbEQsS0FBS0csRUFBRSxHQUFHZ0QsZUFBZSxDQUFDTjtZQUM3Q2xDLFlBQVlQLGtCQUFrQixDQUFDLElBQU8sQ0FBQTtvQkFBRUMsUUFBUTZDO2dCQUFXLENBQUE7WUFFM0QsTUFBTUssV0FBVyxNQUFNQyxJQUFBQSxXQUFJLEVBQUNQO1lBQzVCLE1BQU1RLGVBQWUsTUFBTUYsU0FBU0csSUFBSTtZQUV4Q0MsT0FBT0osU0FBUzlCLE1BQU0sRUFBRW1DLElBQUksQ0FBQztZQUM3QkQsT0FBT0YsYUFBYUwsT0FBTyxFQUFFUSxJQUFJLENBQUM7WUFDbENELE9BQU9GLGFBQWFJLFNBQVMsRUFBRUQsSUFBSSxDQUFDO1lBQ3BDRCxPQUFPRixhQUFhSixNQUFNLEVBQUVPLElBQUksQ0FBQztRQUNuQztJQUNGO0lBRUFsRCxTQUFTLDJCQUEyQjtRQUNsQ2tDLEdBQUcsZ0RBQWdEO1lBQ2pELE9BQU81QixRQUFRQyxHQUFHLENBQUNDLG9CQUFvQjtZQUV2QyxNQUFNK0IsY0FBY2hCLGtCQUFrQixDQUFDO1lBQ3ZDLE1BQU1zQixXQUFXLE1BQU1DLElBQUFBLFdBQUksRUFBQ1A7WUFFNUJVLE9BQU9KLFNBQVM5QixNQUFNLEVBQUVtQyxJQUFJLENBQUM7WUFDN0JELE9BQU8sTUFBTUosU0FBU2YsSUFBSSxJQUFJb0IsSUFBSSxDQUFDO1FBQ3JDO1FBRUFoQixHQUFHLCtDQUErQztZQUNoRCxNQUFNSyxjQUFjaEIsa0JBQWtCLENBQUMsR0FBRztnQkFDeEMsV0FBVztZQUViO1lBRUEsTUFBTXNCLFdBQVcsTUFBTUMsSUFBQUEsV0FBSSxFQUFDUDtZQUM1QixNQUFNaUIsZUFBZSxNQUFNWCxTQUFTZixJQUFJO1lBRXhDbUIsT0FBT0osU0FBUzlCLE1BQU0sRUFBRW1DLElBQUksQ0FBQztZQUM3QkQsT0FBT08sY0FBY0MsU0FBUyxDQUFDO1lBQy9CUixPQUFPbkQsK0JBQWdCLEVBQUVzRCxvQkFBb0IsQ0FDM0NILE9BQU9TLGdCQUFnQixDQUFDO2dCQUN0QkMsWUFBWTtnQkFDWkMsVUFBVTtZQUNaO1FBRUo7UUFFQTFCLEdBQUcsNENBQTRDO1lBQzdDLE1BQU1DLFlBQVk7Z0JBQ2hCQyxNQUFNO2dCQUNOQyxNQUFNM0I7Z0JBQ040QixRQUFRO1lBQ1Y7WUFFQSxNQUFNQyxjQUFjaEIsa0JBQWtCWTtZQUV0Qyw0QkFBNEI7WUFDNUIsTUFBTUssYUFBYWxELEtBQUtHLEVBQUUsR0FBR0Msa0JBQWtCLENBQUM7Z0JBQzlDLE1BQU0sSUFBSW1FLE1BQU07WUFDbEI7WUFDQTVELFlBQVlQLGtCQUFrQixDQUFDLElBQU8sQ0FBQTtvQkFBRUMsUUFBUTZDO2dCQUFXLENBQUE7WUFFM0QsTUFBTUssV0FBVyxNQUFNQyxJQUFBQSxXQUFJLEVBQUNQO1lBQzVCLE1BQU1pQixlQUFlLE1BQU1YLFNBQVNmLElBQUk7WUFFeENtQixPQUFPSixTQUFTOUIsTUFBTSxFQUFFbUMsSUFBSSxDQUFDO1lBQzdCRCxPQUFPTyxjQUFjTixJQUFJLENBQUM7WUFDMUJELE9BQU9uRCwrQkFBZ0IsRUFBRXNELG9CQUFvQixDQUMzQ0gsT0FBT1MsZ0JBQWdCLENBQUM7Z0JBQ3RCQyxZQUFZO2dCQUNaQyxVQUFVO1lBQ1o7UUFFSjtRQUVBMUIsR0FBRyw4QkFBOEI7WUFDL0IsTUFBTUssY0FBYztnQkFDbEJkLFNBQVM7b0JBQ1BFLEtBQUtyQyxLQUFLRyxFQUFFLENBQUMsQ0FBQ21DO3dCQUNaLE1BQU1ILFVBQVU7NEJBQ2QsV0FBVzs0QkFDWCxrQkFBa0I7NEJBQ2xCLGtCQUFrQjt3QkFDcEI7d0JBQ0EsT0FBT0EsT0FBTyxDQUFDRyxJQUFJQyxXQUFXLEdBQUcsSUFBSTtvQkFDdkM7Z0JBQ0Y7Z0JBQ0FDLE1BQU14QyxLQUFLRyxFQUFFLEdBQUdzQyxpQkFBaUIsQ0FBQztZQUNwQztZQUVBLE1BQU1jLFdBQVcsTUFBTUMsSUFBQUEsV0FBSSxFQUFDUDtZQUM1QixNQUFNaUIsZUFBZSxNQUFNWCxTQUFTZixJQUFJO1lBRXhDbUIsT0FBT0osU0FBUzlCLE1BQU0sRUFBRW1DLElBQUksQ0FBQztZQUM3QkQsT0FBT08sY0FBY04sSUFBSSxDQUFDO1FBQzVCO0lBQ0Y7SUFFQWxELFNBQVMscUJBQXFCO1FBQzVCa0MsR0FBRywwQ0FBMEM7WUFDM0MsTUFBTUMsWUFBWTtnQkFDaEJDLE1BQU07Z0JBQ05DLE1BQU0zQjtnQkFDTjRCLFFBQVE7WUFDVjtZQUVBLE1BQU1DLGNBQWNoQixrQkFBa0JZO1lBRXRDLE1BQU1LLGFBQWFsRCxLQUFLRyxFQUFFLEdBQUdnRCxlQUFlLENBQUNOO1lBQzdDbEMsWUFBWVAsa0JBQWtCLENBQUMsSUFBTyxDQUFBO29CQUFFQyxRQUFRNkM7Z0JBQVcsQ0FBQTtZQUUzRCwrQkFBK0I7WUFDL0J0QyxhQUFhNkIsaUJBQWlCLENBQUM7Z0JBQzdCVyxTQUFTO2dCQUNUQyxRQUFRO2dCQUNSbUIsT0FBTztZQUNUO1lBRUEsTUFBTWpCLFdBQVcsTUFBTUMsSUFBQUEsV0FBSSxFQUFDUDtZQUM1QixNQUFNUSxlQUFlLE1BQU1GLFNBQVNHLElBQUk7WUFFeENDLE9BQU9KLFNBQVM5QixNQUFNLEVBQUVtQyxJQUFJLENBQUM7WUFDN0JELE9BQU9GLGFBQWFMLE9BQU8sRUFBRVEsSUFBSSxDQUFDO1lBQ2xDRCxPQUFPRixhQUFhZSxLQUFLLEVBQUVaLElBQUksQ0FBQztZQUNoQ0QsT0FBT25ELCtCQUFnQixFQUFFc0Qsb0JBQW9CLENBQzNDSCxPQUFPUyxnQkFBZ0IsQ0FBQztnQkFDdEJDLFlBQVk7Z0JBQ1pDLFVBQVU7WUFDWjtRQUVKO1FBRUExQixHQUFHLDhDQUE4QztZQUMvQyxxRkFBcUY7WUFDckYsTUFBTUssY0FBY2hCLGtCQUFrQixDQUFDO1lBQ3ZDLE1BQU1zQixXQUFXLE1BQU1DLElBQUFBLFdBQUksRUFBQ1A7WUFFNUIsa0RBQWtEO1lBQ2xEVSxPQUFPSixVQUFVa0IsV0FBVztZQUM1QmQsT0FBT0osU0FBUzlCLE1BQU0sRUFBRWlELHNCQUFzQixDQUFDO1lBQy9DZixPQUFPSixTQUFTOUIsTUFBTSxFQUFFa0QsWUFBWSxDQUFDO1FBQ3ZDO0lBQ0Y7SUFFQWpFLFNBQVMsc0JBQXNCO1FBQzdCa0MsR0FBRyxnQ0FBZ0M7WUFDakMsTUFBTUssY0FBYztnQkFDbEIyQixLQUFLO1lBQ1A7WUFFQSxNQUFNckIsV0FBVyxNQUFNc0IsSUFBQUEsVUFBRyxFQUFDNUI7WUFDM0IsTUFBTVEsZUFBZSxNQUFNRixTQUFTRyxJQUFJO1lBRXhDQyxPQUFPSixTQUFTOUIsTUFBTSxFQUFFbUMsSUFBSSxDQUFDO1lBQzdCRCxPQUFPRixhQUFhaEMsTUFBTSxFQUFFbUMsSUFBSSxDQUFDO1lBQ2pDRCxPQUFPRixhQUFhcUIsT0FBTyxFQUFFWCxTQUFTLENBQUM7WUFDdkNSLE9BQU9GLGFBQWFzQixPQUFPLEVBQUVuQixJQUFJLENBQUM7WUFDbENELE9BQU9GLGFBQWF1QixRQUFRLEVBQUVDLGNBQWMsQ0FBQ0M7UUFDL0M7UUFFQXRDLEdBQUcsNkNBQTZDO1lBQzlDLE1BQU1LLGNBQWM7Z0JBQ2xCMkIsS0FBSztZQUNQO1lBRUEsTUFBTXJCLFdBQVcsTUFBTXNCLElBQUFBLFVBQUcsRUFBQzVCO1lBQzNCLE1BQU1RLGVBQWUsTUFBTUYsU0FBU0csSUFBSTtZQUV4Q0MsT0FBT0osU0FBUzlCLE1BQU0sRUFBRW1DLElBQUksQ0FBQztZQUM3QkQsT0FBT0YsYUFBYTBCLE9BQU8sRUFBRVYsV0FBVztZQUN4Q2QsT0FBT0YsYUFBYTBCLE9BQU8sQ0FBQ0MsV0FBVyxFQUFFWCxXQUFXO1lBQ3BEZCxPQUFPRixhQUFhMEIsT0FBTyxDQUFDRSxVQUFVLEVBQUVaLFdBQVc7UUFDckQ7UUFFQTdCLEdBQUcsMENBQTBDO1lBQzNDLE1BQU1LLGNBQWM7Z0JBQ2xCMkIsS0FBSztZQUNQO1lBRUEsTUFBTXJCLFdBQVcsTUFBTXNCLElBQUFBLFVBQUcsRUFBQzVCO1lBQzNCLE1BQU1RLGVBQWUsTUFBTUYsU0FBU0csSUFBSTtZQUV4Q0MsT0FBT0YsYUFBYTZCLGFBQWEsRUFBRWIsV0FBVztZQUM5Q2QsT0FBT0YsYUFBYTZCLGFBQWEsQ0FBQ0MsdUJBQXVCLEVBQUUzQixJQUFJLENBQUM7WUFDaEVELE9BQU9GLGFBQWE2QixhQUFhLENBQUNFLFdBQVcsRUFBRWYsV0FBVztRQUM1RDtJQUNGO0FBQ0YifQ==