{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\components\\Checkout\\index.tsx"],"sourcesContent":["\"use client\";\r\nimport React from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Breadcrumb from \"../Common/Breadcrumb\";\r\nimport Shipping from \"./Shipping\";\r\nimport ShippingMethod from \"./ShippingMethod\";\r\nimport PaymentMethod from \"./PaymentMethod\";\r\nimport Billing from \"./Billing\";\r\nimport OrderSummary from \"./OrderSummary\";\r\nimport Coupon from \"./Coupon\";\r\nimport UserInfo from \"./UserInfo\";\r\nimport { useCheckout } from \"@/hooks/useCheckout\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { FormMessage } from \"@/components/ui/form\";\r\nimport { Loader2, CreditCard, AlertTriangle } from \"lucide-react\";\r\nimport MercadoPagoWallet, { MercadoPagoWalletFallback } from \"./MercadoPagoWallet\";\r\n\r\nconst Checkout = () => {\r\n  const router = useRouter();\r\n  const {\r\n    formData,\r\n    isLoading,\r\n    errors,\r\n    step,\r\n    cartItems,\r\n    totalPrice,\r\n    shippingCost,\r\n    discount,\r\n    finalTotal,\r\n    appliedCoupon,\r\n    applyCoupon,\r\n    updateBillingData,\r\n    updateShippingData,\r\n    updateFormData,\r\n    processCheckout,\r\n    // ✅ NUEVO: Propiedades para Wallet Brick\r\n    preferenceId,\r\n    initPoint,\r\n    handleWalletReady,\r\n    handleWalletError,\r\n    handleWalletSubmit,\r\n  } = useCheckout();\r\n\r\n  // Redirigir si el carrito está vacío\r\n  React.useEffect(() => {\r\n    if (cartItems.length === 0 && step === 'form') {\r\n      router.push('/cart');\r\n    }\r\n  }, [cartItems.length, step, router]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    await processCheckout();\r\n  };\r\n\r\n  const handlePaymentMethodChange = (method: string) => {\r\n    updateFormData({ paymentMethod: method as 'mercadopago' | 'bank' | 'cash' });\r\n  };\r\n\r\n  const handleShippingMethodChange = (method: 'free' | 'express' | 'pickup') => {\r\n    updateFormData({ shippingMethod: method });\r\n  };\r\n\r\n  if (step === 'processing') {\r\n    return (\r\n      <>\r\n        <Breadcrumb title={\"Checkout\"} pages={[\"checkout\"]} />\r\n        <section className=\"overflow-hidden py-20 bg-gray-50\">\r\n          <div className=\"max-w-[1170px] w-full mx-auto px-4 sm:px-8 xl:px-0\">\r\n            <Card className=\"max-w-md mx-auto\">\r\n              <CardContent className=\"p-12 text-center\">\r\n                <div className=\"flex flex-col items-center gap-4\">\r\n                  <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center\">\r\n                    <Loader2 className=\"w-8 h-8 text-primary animate-spin\" />\r\n                  </div>\r\n                  <div>\r\n                    <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n                      Procesando tu pedido...\r\n                    </h2>\r\n                    <p className=\"text-gray-600 text-sm\">\r\n                      Por favor espera mientras preparamos tu pago.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </section>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // ✅ NUEVO: Paso de pago con Wallet Brick\r\n  if (step === 'payment') {\r\n    return (\r\n      <>\r\n        <Breadcrumb title={\"Checkout - Pago\"} pages={[\"checkout\", \"pago\"]} />\r\n        <section className=\"overflow-hidden py-20 bg-gray-50\">\r\n          <div className=\"max-w-[1170px] w-full mx-auto px-4 sm:px-8 xl:px-0\">\r\n            <div className=\"max-w-2xl mx-auto\">\r\n              <div className=\"mb-8 text-center\">\r\n                <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n                  Finalizar Pago\r\n                </h2>\r\n                <p className=\"text-gray-600\">\r\n                  Completa tu compra de forma segura con MercadoPago\r\n                </p>\r\n              </div>\r\n\r\n              {/* Wallet Brick */}\r\n              {preferenceId ? (\r\n                <MercadoPagoWallet\r\n                  preferenceId={preferenceId}\r\n                  onReady={handleWalletReady}\r\n                  onError={handleWalletError}\r\n                  onSubmit={handleWalletSubmit}\r\n                />\r\n              ) : (\r\n                // Fallback si no hay preferenceId\r\n                initPoint && (\r\n                  <MercadoPagoWalletFallback\r\n                    initPoint={initPoint}\r\n                  />\r\n                )\r\n              )}\r\n\r\n              {/* Resumen del pedido */}\r\n              <div className=\"mt-8\">\r\n                <Card>\r\n                  <CardContent className=\"p-6\">\r\n                    <h3 className=\"font-semibold text-gray-900 mb-4\">Resumen del Pedido</h3>\r\n                    <div className=\"space-y-2 text-sm\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span>Subtotal:</span>\r\n                        <span>${totalPrice.toFixed(2)}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span>Envío:</span>\r\n                        <span>${shippingCost.toFixed(2)}</span>\r\n                      </div>\r\n                      {discount > 0 && (\r\n                        <div className=\"flex justify-between text-green-600\">\r\n                          <span>Descuento:</span>\r\n                          <span>-${discount.toFixed(2)}</span>\r\n                        </div>\r\n                      )}\r\n                      <div className=\"border-t pt-2 flex justify-between font-semibold\">\r\n                        <span>Total:</span>\r\n                        <span>${finalTotal.toFixed(2)}</span>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </section>\r\n      </>\r\n    );\r\n  }\r\n\r\n  if (step === 'redirect') {\r\n    return (\r\n      <>\r\n        <Breadcrumb title={\"Checkout\"} pages={[\"checkout\"]} />\r\n        <section className=\"overflow-hidden py-20 bg-gray-50\">\r\n          <div className=\"max-w-[1170px] w-full mx-auto px-4 sm:px-8 xl:px-0\">\r\n            <Card className=\"max-w-md mx-auto\">\r\n              <CardContent className=\"p-12 text-center\">\r\n                <div className=\"flex flex-col items-center gap-4\">\r\n                  <div className=\"w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center\">\r\n                    <CreditCard className=\"w-8 h-8 text-blue-600\" />\r\n                  </div>\r\n                  <div>\r\n                    <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n                      Procesando Pago...\r\n                    </h2>\r\n                    <p className=\"text-gray-600 text-sm\">\r\n                      Tu pago está siendo procesado. Serás redirigido automáticamente.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </section>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Breadcrumb title={\"Checkout\"} pages={[\"checkout\"]} />\r\n      <section className=\"overflow-hidden py-20 bg-gray-2\">\r\n        <div className=\"max-w-[1170px] w-full mx-auto px-4 sm:px-8 xl:px-0\">\r\n          <form onSubmit={handleSubmit} role=\"form\">\r\n            <div className=\"flex flex-col lg:flex-row gap-7.5 xl:gap-11\">\r\n              {/* Checkout left */}\r\n              <div className=\"lg:max-w-[670px] w-full\">\r\n                {/* Error general - Migrado al Design System */}\r\n                {errors.general && (\r\n                  <div className=\"mb-6\">\r\n                    <FormMessage variant=\"error\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <AlertTriangle className=\"w-4 h-4\" />\r\n                        <span>{errors.general}</span>\r\n                      </div>\r\n                    </FormMessage>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Error de carrito vacío */}\r\n                {errors.cart && (\r\n                  <div className=\"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md\">\r\n                    <p className=\"text-yellow-800\">{errors.cart}</p>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Billing details */}\r\n                <Billing\r\n                  billingData={formData.billing}\r\n                  errors={errors}\r\n                  onBillingChange={updateBillingData}\r\n                />\r\n\r\n                {/* Shipping address */}\r\n                <Shipping\r\n                  shippingData={formData.shipping}\r\n                  billingData={formData.billing}\r\n                  errors={errors}\r\n                  onShippingChange={updateShippingData}\r\n                />\r\n\r\n                {/* Shipping method */}\r\n                <ShippingMethod\r\n                  selectedMethod={formData.shippingMethod}\r\n                  totalPrice={totalPrice}\r\n                  onMethodChange={handleShippingMethodChange}\r\n                />\r\n\r\n                {/* Payment method */}\r\n                <PaymentMethod\r\n                  selectedMethod={formData.paymentMethod}\r\n                  onMethodChange={handlePaymentMethodChange}\r\n                />\r\n              </div>\r\n\r\n              {/* Checkout right */}\r\n              <div className=\"max-w-[455px] w-full\">\r\n                {/* User info */}\r\n                <UserInfo className=\"mb-6\" />\r\n\r\n                {/* Order summary */}\r\n                <OrderSummary\r\n                  cartItems={cartItems}\r\n                  totalPrice={totalPrice}\r\n                  shippingCost={shippingCost}\r\n                  discount={discount}\r\n                  finalTotal={finalTotal}\r\n                  shippingMethod={formData.shippingMethod}\r\n                  appliedCoupon={appliedCoupon}\r\n                />\r\n\r\n                {/* Coupon */}\r\n                <Coupon\r\n                  onCouponApply={applyCoupon}\r\n                  appliedCoupon={appliedCoupon}\r\n                  isLoading={isLoading}\r\n                />\r\n\r\n                {/* Checkout button */}\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={isLoading || cartItems.length === 0}\r\n                  className={`w-full flex justify-center font-medium text-white py-3 px-6 rounded-md ease-out duration-200 mt-7.5 ${\r\n                    isLoading || cartItems.length === 0\r\n                      ? 'bg-gray-400 cursor-not-allowed'\r\n                      : 'bg-tahiti-gold-500 hover:bg-tahiti-gold-700'\r\n                  }`}\r\n                >\r\n                  {isLoading ? (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\r\n                      Procesando...\r\n                    </div>\r\n                  ) : (\r\n                    'Procesar Pedido'\r\n                  )}\r\n                </button>\r\n\r\n                {/* Terms and conditions */}\r\n                <div className=\"mt-4 p-3 bg-gray-50 border border-gray-200 rounded-md\">\r\n                  <p className=\"text-xs text-gray-600\">\r\n                    Al hacer clic en &quot;Procesar Pedido&quot;, aceptas nuestros{' '}\r\n                    <a href=\"/terms\" className=\"text-blue hover:underline\">\r\n                      términos y condiciones\r\n                    </a>{' '}\r\n                    y{' '}\r\n                    <a href=\"/privacy\" className=\"text-blue hover:underline\">\r\n                      política de privacidad\r\n                    </a>\r\n                    .\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </section>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Checkout;\r\n"],"names":["Checkout","router","useRouter","formData","isLoading","errors","step","cartItems","totalPrice","shippingCost","discount","finalTotal","appliedCoupon","applyCoupon","updateBillingData","updateShippingData","updateFormData","processCheckout","preferenceId","initPoint","handleWalletReady","handleWalletError","handleWalletSubmit","useCheckout","React","useEffect","length","push","handleSubmit","e","preventDefault","handlePaymentMethodChange","method","paymentMethod","handleShippingMethodChange","shippingMethod","Breadcrumb","title","pages","section","className","div","Card","CardContent","Loader2","h2","p","MercadoPagoWallet","onReady","onError","onSubmit","MercadoPagoWalletFallback","h3","span","toFixed","CreditCard","form","role","general","FormMessage","variant","AlertTriangle","cart","Billing","billingData","billing","onBillingChange","Shipping","shippingData","shipping","onShippingChange","ShippingMethod","selectedMethod","onMethodChange","PaymentMethod","UserInfo","OrderSummary","Coupon","onCouponApply","button","type","disabled","a","href"],"mappings":"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"}