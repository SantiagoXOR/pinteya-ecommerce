{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\components\\ui\\__tests__\\checkout-flow.test.tsx"],"sourcesContent":["import React from 'react'\r\nimport { render, screen, fireEvent } from '@testing-library/react'\r\nimport '@testing-library/jest-dom'\r\nimport { CheckoutFlow } from '../checkout-flow'\r\n\r\n// Mock de los componentes del Design System\r\njest.mock('../shipping-info', () => ({\r\n  ShippingInfo: ({ options, selectedOption }: any) => (\r\n    <div data-testid=\"shipping-info\">\r\n      Shipping options for: {selectedOption}\r\n    </div>\r\n  )\r\n}))\r\n\r\njest.mock('../cart-summary', () => ({\r\n  CartSummary: ({ cartItems, variant }: any) => (\r\n    <div data-testid=\"cart-summary\">\r\n      Cart Summary - {cartItems.length} items - {variant}\r\n    </div>\r\n  )\r\n}))\r\n\r\nconst mockCartItems = [\r\n  {\r\n    id: 1,\r\n    title: 'Pintura Sherwin Williams 4L',\r\n    price: 10000,\r\n    discountedPrice: 8500,\r\n    quantity: 2\r\n  }\r\n]\r\n\r\nconst mockCheckoutData = {\r\n  totalPrice: 17000,\r\n  shippingCost: 2500,\r\n  discount: 0,\r\n  finalTotal: 19500,\r\n  shippingMethod: 'standard' as const\r\n}\r\n\r\ndescribe('CheckoutFlow', () => {\r\n  const defaultProps = {\r\n    currentStep: 0,\r\n    cartItems: mockCartItems,\r\n    checkoutData: mockCheckoutData\r\n  }\r\n\r\n  it('renders checkout flow with default steps', () => {\r\n    render(<CheckoutFlow {...defaultProps} />)\r\n\r\n    expect(screen.getByText('Proceso de Compra')).toBeInTheDocument()\r\n    expect(screen.getByText('Paso 1 de 5')).toBeInTheDocument()\r\n    expect(screen.getAllByText('Carrito')).toHaveLength(2) // Aparece en el indicador y en el título\r\n  })\r\n\r\n  it('shows progress indicator', () => {\r\n    render(<CheckoutFlow {...defaultProps} currentStep={2} />)\r\n    \r\n    expect(screen.getByText('Paso 3 de 5')).toBeInTheDocument()\r\n    // El progreso debería ser 60% (3/5 * 100)\r\n  })\r\n\r\n  it('displays active step correctly', () => {\r\n    render(<CheckoutFlow {...defaultProps} currentStep={1} />)\r\n\r\n    expect(screen.getAllByText('Envío')).toHaveLength(2) // Aparece en el indicador y en el título\r\n    expect(screen.getAllByText('Dirección y método')).toHaveLength(2) // Aparece en el indicador y en la descripción\r\n  })\r\n\r\n  it('shows shipping info on shipping step', () => {\r\n    render(<CheckoutFlow {...defaultProps} currentStep={1} />)\r\n    \r\n    expect(screen.getByText('Opciones de Envío')).toBeInTheDocument()\r\n    expect(screen.getByTestId('shipping-info')).toBeInTheDocument()\r\n  })\r\n\r\n  it('calls onStepChange when clicking on completed step', () => {\r\n    const mockOnStepChange = jest.fn()\r\n    \r\n    render(\r\n      <CheckoutFlow \r\n        {...defaultProps} \r\n        currentStep={2}\r\n        onStepChange={mockOnStepChange}\r\n      />\r\n    )\r\n    \r\n    // Hacer clic en el primer paso (debería estar completado)\r\n    const firstStep = screen.getByText('Carrito')\r\n    fireEvent.click(firstStep.closest('div')!)\r\n    \r\n    expect(mockOnStepChange).toHaveBeenCalledWith(0)\r\n  })\r\n\r\n  it('shows cart summary when enabled', () => {\r\n    render(<CheckoutFlow {...defaultProps} showCartSummary={true} />)\r\n    \r\n    expect(screen.getByTestId('cart-summary')).toBeInTheDocument()\r\n    expect(screen.getByText('Cart Summary - 1 items - default')).toBeInTheDocument()\r\n  })\r\n\r\n  it('hides cart summary when disabled', () => {\r\n    render(<CheckoutFlow {...defaultProps} showCartSummary={false} />)\r\n    \r\n    expect(screen.queryByTestId('cart-summary')).not.toBeInTheDocument()\r\n  })\r\n\r\n  it('calls onContinue when continue button is clicked', () => {\r\n    const mockOnContinue = jest.fn()\r\n    \r\n    render(<CheckoutFlow {...defaultProps} onContinue={mockOnContinue} />)\r\n    \r\n    const continueButton = screen.getByText('Continuar')\r\n    fireEvent.click(continueButton)\r\n    \r\n    expect(mockOnContinue).toHaveBeenCalledTimes(1)\r\n  })\r\n\r\n  it('calls onGoBack when back button is clicked', () => {\r\n    const mockOnGoBack = jest.fn()\r\n    \r\n    render(\r\n      <CheckoutFlow \r\n        {...defaultProps} \r\n        currentStep={1}\r\n        onGoBack={mockOnGoBack}\r\n      />\r\n    )\r\n    \r\n    const backButton = screen.getByText('Anterior')\r\n    fireEvent.click(backButton)\r\n    \r\n    expect(mockOnGoBack).toHaveBeenCalledTimes(1)\r\n  })\r\n\r\n  it('disables back button on first step', () => {\r\n    render(<CheckoutFlow {...defaultProps} currentStep={0} />)\r\n    \r\n    const backButton = screen.getByText('Anterior')\r\n    expect(backButton).toBeDisabled()\r\n  })\r\n\r\n  it('shows finish button on last step', () => {\r\n    render(<CheckoutFlow {...defaultProps} currentStep={4} />)\r\n    \r\n    expect(screen.getByText('Finalizar Compra')).toBeInTheDocument()\r\n    expect(screen.queryByText('Continuar')).not.toBeInTheDocument()\r\n  })\r\n\r\n  it('calls onComplete when finish button is clicked', () => {\r\n    const mockOnComplete = jest.fn()\r\n    \r\n    render(\r\n      <CheckoutFlow \r\n        {...defaultProps} \r\n        currentStep={4}\r\n        onComplete={mockOnComplete}\r\n      />\r\n    )\r\n    \r\n    const finishButton = screen.getByText('Finalizar Compra')\r\n    fireEvent.click(finishButton)\r\n    \r\n    expect(mockOnComplete).toHaveBeenCalledTimes(1)\r\n  })\r\n\r\n  it('shows loading state', () => {\r\n    render(\r\n      <CheckoutFlow \r\n        {...defaultProps} \r\n        currentStep={4}\r\n        isLoading={true}\r\n      />\r\n    )\r\n    \r\n    expect(screen.getByText('Procesando...')).toBeInTheDocument()\r\n  })\r\n\r\n  it('displays errors when present', () => {\r\n    const errors = {\r\n      email: 'Email es requerido',\r\n      address: 'Dirección es requerida'\r\n    }\r\n    \r\n    render(<CheckoutFlow {...defaultProps} errors={errors} />)\r\n    \r\n    expect(screen.getByText('Hay errores que corregir:')).toBeInTheDocument()\r\n    expect(screen.getByText('• Email es requerido')).toBeInTheDocument()\r\n    expect(screen.getByText('• Dirección es requerida')).toBeInTheDocument()\r\n  })\r\n\r\n  it('renders in compact variant', () => {\r\n    render(<CheckoutFlow {...defaultProps} variant=\"compact\" />)\r\n    \r\n    // En variante compact, no debería mostrar el indicador de progreso\r\n    expect(screen.queryByText('Proceso de Compra')).not.toBeInTheDocument()\r\n  })\r\n\r\n  it('renders custom steps', () => {\r\n    const customSteps = [\r\n      {\r\n        id: 'custom1',\r\n        title: 'Paso Personalizado',\r\n        description: 'Descripción personalizada',\r\n        icon: () => <div>Icon</div>\r\n      }\r\n    ]\r\n\r\n    render(<CheckoutFlow {...defaultProps} steps={customSteps} />)\r\n\r\n    expect(screen.getAllByText('Paso Personalizado')).toHaveLength(2) // Aparece en el indicador y en el título\r\n    expect(screen.getByText('Paso 1 de 1')).toBeInTheDocument()\r\n  })\r\n\r\n  it('shows step status correctly', () => {\r\n    render(<CheckoutFlow {...defaultProps} currentStep={2} />)\r\n    \r\n    // Los primeros dos pasos deberían estar completados\r\n    // El tercer paso debería estar activo\r\n    // Los últimos dos pasos deberían estar deshabilitados\r\n    \r\n    const steps = screen.getAllByRole('generic').filter(el => \r\n      el.textContent?.includes('Carrito') || \r\n      el.textContent?.includes('Envío') || \r\n      el.textContent?.includes('Facturación')\r\n    )\r\n    \r\n    expect(steps.length).toBeGreaterThan(0)\r\n  })\r\n\r\n  it('renders children content', () => {\r\n    render(\r\n      <CheckoutFlow {...defaultProps}>\r\n        <div data-testid=\"custom-content\">Custom step content</div>\r\n      </CheckoutFlow>\r\n    )\r\n    \r\n    expect(screen.getByTestId('custom-content')).toBeInTheDocument()\r\n    expect(screen.getByText('Custom step content')).toBeInTheDocument()\r\n  })\r\n})\r\n"],"names":["jest","mock","ShippingInfo","options","selectedOption","div","data-testid","CartSummary","cartItems","variant","length","mockCartItems","id","title","price","discountedPrice","quantity","mockCheckoutData","totalPrice","shippingCost","discount","finalTotal","shippingMethod","describe","defaultProps","currentStep","checkoutData","it","render","CheckoutFlow","expect","screen","getByText","toBeInTheDocument","getAllByText","toHaveLength","getByTestId","mockOnStepChange","fn","onStepChange","firstStep","fireEvent","click","closest","toHaveBeenCalledWith","showCartSummary","queryByTestId","not","mockOnContinue","onContinue","continueButton","toHaveBeenCalledTimes","mockOnGoBack","onGoBack","backButton","toBeDisabled","queryByText","mockOnComplete","onComplete","finishButton","isLoading","errors","email","address","customSteps","description","icon","steps","getAllByRole","filter","el","textContent","includes","toBeGreaterThan"],"mappings":"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"}