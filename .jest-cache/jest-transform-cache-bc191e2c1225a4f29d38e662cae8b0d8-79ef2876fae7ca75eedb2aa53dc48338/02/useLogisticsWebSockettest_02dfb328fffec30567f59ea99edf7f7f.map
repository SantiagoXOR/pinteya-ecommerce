{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\__tests__\\logistics\\hooks\\useLogisticsWebSocket.test.ts"],"sourcesContent":["// =====================================================\n// TEST: LOGISTICS WEBSOCKET HOOKS\n// Descripción: Tests comprehensivos para hooks de WebSocket\n// Basado en: Jest + React Testing Library + MSW\n// =====================================================\n\nimport { renderHook, act, waitFor } from '@testing-library/react';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport React from 'react';\nimport { \n  useLogisticsWebSocket, \n  useShipmentTracking, \n  useLogisticsAlerts \n} from '@/hooks/admin/useLogisticsWebSocket';\n\n// Mock WebSocket\nconst createMockWebSocket = () => {\n  const listeners: { [key: string]: Function[] } = {};\n  let connected = false;\n  \n  const mockWs = {\n    send: jest.fn(),\n    close: jest.fn(),\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n    on: jest.fn((event: string, callback: Function) => {\n      if (!listeners[event]) listeners[event] = [];\n      listeners[event].push(callback);\n      \n      // Simular evento 'connected' automáticamente después de un pequeño delay\n      if (event === 'connected' && !connected) {\n        connected = true;\n        setTimeout(() => {\n          callback();\n          mockWs.isConnected = true;\n        }, 50);\n      }\n    }),\n    off: jest.fn((event: string, callback: Function) => {\n      if (listeners[event]) {\n        listeners[event] = listeners[event].filter(cb => cb !== callback);\n      }\n    }),\n    emit: jest.fn((event: string, data?: any) => {\n      if (listeners[event]) {\n        listeners[event].forEach(callback => callback(data));\n      }\n    }),\n    readyState: 1,\n    connect: jest.fn().mockResolvedValue(undefined),\n    disconnect: jest.fn(),\n    isConnected: false,\n    subscribeToShipment: jest.fn(),\n    unsubscribeFromShipment: jest.fn(),\n    subscribeToGeofence: jest.fn(),\n    unsubscribeFromGeofence: jest.fn(),\n    subscribeToAlerts: jest.fn(),\n    unsubscribeFromAlerts: jest.fn()\n  };\n  \n  return mockWs;\n};\n\n// Mock global del WebSocket\nlet globalMockWebSocket: any;\n\n// Mock del módulo de WebSocket\njest.mock('@/lib/websockets/logistics-websocket', () => {\n  return {\n    getLogisticsWebSocket: jest.fn(() => {\n      if (!globalMockWebSocket) {\n        globalMockWebSocket = createMockWebSocket();\n      }\n      return globalMockWebSocket;\n    }),\n    LogisticsWebSocketSimulator: jest.fn().mockImplementation(() => ({\n      start: jest.fn(),\n      stop: jest.fn(),\n      simulateTrackingUpdate: jest.fn(),\n      simulateAlert: jest.fn(),\n      simulateGeofenceEvent: jest.fn()\n    }))\n  };\n});\n\n// Mock global WebSocket\nglobal.WebSocket = jest.fn().mockImplementation(() => createMockWebSocket());\n\n// =====================================================\n// SETUP\n// =====================================================\n\nconst createTestQueryClient = () => new QueryClient({\n  defaultOptions: {\n    queries: { retry: false },\n    mutations: { retry: false }\n  }\n});\n\nconst createWrapper = () => {\n  const queryClient = createTestQueryClient();\n  return ({ children }: { children: React.ReactNode }) => {\n    return React.createElement(\n      QueryClientProvider,\n      { client: queryClient },\n      children\n    );\n  };\n};\n\n// Mock toast notifications\njest.mock('sonner', () => ({\n  toast: {\n    success: jest.fn(),\n    error: jest.fn(),\n    warning: jest.fn(),\n    info: jest.fn()\n  }\n}));\n\n// =====================================================\n// TESTS PARA useLogisticsWebSocket\n// =====================================================\n\ndescribe('useLogisticsWebSocket Hook', () => {\n  let mockWebSocket: any;\n\n  beforeEach(() => {\n    // Reset global mock WebSocket\n    globalMockWebSocket = null;\n    mockWebSocket = createMockWebSocket();\n    jest.clearAllMocks();\n  });\n\n  it('should initialize with default state', () => {\n    const { result } = renderHook(() => useLogisticsWebSocket(), {\n      wrapper: createWrapper()\n    });\n\n    // Verificar estado inicial\n    expect(result.current.isConnected).toBe(false);\n    expect(result.current.connectionState).toBe('connecting'); // Estado inicial cuando se inicializa\n    expect(result.current.lastTrackingUpdate).toBeNull();\n    expect(result.current.lastAlert).toBeNull();\n    expect(result.current.lastGeofenceEvent).toBeNull();\n    expect(result.current.alerts).toEqual([]);\n  });\n\n  it('should handle connection state changes', async () => {\n    const { result } = renderHook(() => useLogisticsWebSocket({\n      simulateInDevelopment: false // Usar WebSocket real\n    }), {\n      wrapper: createWrapper()\n    });\n\n    // Simular conexión\n    act(() => {\n      if (mockWebSocket.onopen) {\n        mockWebSocket.onopen();\n      }\n    });\n\n    await waitFor(() => {\n      expect(result.current.isConnected).toBe(true);\n      expect(result.current.connectionState).toBe('connected');\n    }, { timeout: 2000 });\n  });\n\n  it('should handle disconnection', () => {\n    const { result } = renderHook(() => useLogisticsWebSocket(), {\n      wrapper: createWrapper()\n    });\n\n    // Verificar que el método disconnect existe y es callable\n    expect(typeof result.current.disconnect).toBe('function');\n    \n    // Simular desconexión\n    act(() => {\n      result.current.disconnect();\n    });\n\n    // El estado inicial debería ser disconnected\n    expect(result.current.isConnected).toBe(false);\n  });\n\n  it('should handle tracking updates', async () => {\n    const { result } = renderHook(() => useLogisticsWebSocket(), {\n      wrapper: createWrapper()\n    });\n\n    const trackingUpdate = {\n      shipment_id: 1,\n      location: {\n        latitude: -34.6037,\n        longitude: -58.3816\n      },\n      status: 'in_transit',\n      timestamp: new Date().toISOString()\n    };\n\n    // Simular recepción de tracking update\n    act(() => {\n      // En el simulador, esto se maneja automáticamente\n      // Aquí simulamos el evento directamente\n      result.current.lastTrackingUpdate = trackingUpdate;\n    });\n\n    expect(result.current.lastTrackingUpdate).toEqual(trackingUpdate);\n  });\n\n  it('should handle alerts', async () => {\n    const { result } = renderHook(() => useLogisticsWebSocket(), {\n      wrapper: createWrapper()\n    });\n\n    const alert = {\n      id: 'alert-1',\n      type: 'delay' as const,\n      severity: 'high' as const,\n      shipment_id: 1,\n      message: 'Retraso en la entrega',\n      timestamp: new Date().toISOString(),\n      auto_resolve: false\n    };\n\n    // Simular recepción de alerta\n    act(() => {\n      result.current.alerts.push(alert);\n    });\n\n    expect(result.current.alerts).toContain(alert);\n  });\n\n  it('should clear alerts', () => {\n    const { result } = renderHook(() => useLogisticsWebSocket(), {\n      wrapper: createWrapper()\n    });\n\n    // Agregar algunas alertas\n    act(() => {\n      result.current.alerts.push({\n        id: 'alert-1',\n        type: 'delay',\n        severity: 'high',\n        shipment_id: 1,\n        message: 'Test alert',\n        timestamp: new Date().toISOString(),\n        auto_resolve: false\n      } as any);\n    });\n\n    // Limpiar alertas\n    act(() => {\n      result.current.clearAlerts();\n    });\n\n    expect(result.current.alerts).toEqual([]);\n  });\n\n  it('should handle subscription methods', () => {\n    const { result } = renderHook(() => useLogisticsWebSocket(), {\n      wrapper: createWrapper()\n    });\n\n    // Test subscription methods\n    expect(() => {\n      result.current.subscribeToShipment(1);\n      result.current.unsubscribeFromShipment(1);\n      result.current.subscribeToGeofence('zone-1');\n      result.current.subscribeToAlerts();\n    }).not.toThrow();\n  });\n\n  it('should handle connect/disconnect methods', async () => {\n    const { result } = renderHook(() => useLogisticsWebSocket({\n      autoConnect: false,\n      simulateInDevelopment: false\n    }), {\n      wrapper: createWrapper()\n    });\n\n    // Test connect\n    await act(async () => {\n      await result.current.connect();\n    });\n\n    // Test disconnect\n    act(() => {\n      result.current.disconnect();\n    });\n\n    expect(result.current.isConnected).toBe(false);\n  });\n});\n\n// =====================================================\n// TESTS PARA useShipmentTracking\n// =====================================================\n\ndescribe('useShipmentTracking Hook', () => {\n  beforeEach(() => {\n    createMockWebSocket();\n    jest.clearAllMocks();\n  });\n\n  it('should track specific shipment', () => {\n    const shipmentId = 123;\n    const { result } = renderHook(() => useShipmentTracking(shipmentId), {\n      wrapper: createWrapper()\n    });\n\n    // Verificar estado inicial del tracking\n    expect(result.current.currentLocation).toBeNull();\n    expect(result.current.trackingHistory).toEqual([]);\n    expect(result.current.shipmentId).toBe(shipmentId);\n    expect(result.current.isConnected).toBe(false); // Estado inicial\n  });\n\n  it('should filter tracking updates for specific shipment', async () => {\n    const shipmentId = 123;\n    const { result } = renderHook(() => useShipmentTracking(shipmentId), {\n      wrapper: createWrapper()\n    });\n\n    const trackingUpdate = {\n      shipment_id: shipmentId,\n      location: {\n        latitude: -34.6037,\n        longitude: -58.3816\n      },\n      status: 'in_transit',\n      timestamp: new Date().toISOString()\n    };\n\n    // Simular tracking update para este shipment\n    act(() => {\n      // Esto normalmente vendría del WebSocket\n      (result.current as any).currentLocation = trackingUpdate;\n    });\n\n    expect(result.current.currentLocation?.shipment_id).toBe(shipmentId);\n  });\n\n  it('should ignore tracking updates for other shipments', () => {\n    const shipmentId = 123;\n    const { result } = renderHook(() => useShipmentTracking(shipmentId), {\n      wrapper: createWrapper()\n    });\n\n    const trackingUpdate = {\n      shipment_id: 456, // Diferente shipment\n      location: {\n        latitude: -34.6037,\n        longitude: -58.3816\n      },\n      status: 'in_transit',\n      timestamp: new Date().toISOString()\n    };\n\n    // Este update no debería afectar nuestro tracking\n    expect(result.current.currentLocation?.shipment_id).not.toBe(456);\n  });\n\n  it('should maintain tracking history', async () => {\n    const shipmentId = 123;\n    const { result } = renderHook(() => useShipmentTracking(shipmentId), {\n      wrapper: createWrapper()\n    });\n\n    const updates = [\n      {\n        shipment_id: shipmentId,\n        location: { latitude: -34.6037, longitude: -58.3816 },\n        status: 'picked_up',\n        timestamp: '2024-02-10T10:00:00Z'\n      },\n      {\n        shipment_id: shipmentId,\n        location: { latitude: -34.6100, longitude: -58.3900 },\n        status: 'in_transit',\n        timestamp: '2024-02-10T11:00:00Z'\n      }\n    ];\n\n    // Simular múltiples updates\n    act(() => {\n      updates.forEach(update => {\n        (result.current as any).trackingHistory.push(update);\n      });\n    });\n\n    expect(result.current.trackingHistory).toHaveLength(2);\n  });\n});\n\n// =====================================================\n// TESTS PARA useLogisticsAlerts\n// =====================================================\n\ndescribe('useLogisticsAlerts Hook', () => {\n  beforeEach(() => {\n    createMockWebSocket();\n    jest.clearAllMocks();\n  });\n\n  it('should initialize alerts state', () => {\n    const { result } = renderHook(() => useLogisticsAlerts(), {\n      wrapper: createWrapper()\n    });\n\n    // Verificar estado inicial de alertas\n    expect(result.current.alerts).toEqual([]);\n    expect(result.current.criticalAlerts).toEqual([]);\n    expect(result.current.highAlerts).toEqual([]);\n    expect(result.current.unreadAlerts).toEqual([]);\n    expect(result.current.totalAlerts).toBe(0);\n    expect(result.current.criticalCount).toBe(0);\n    expect(result.current.highCount).toBe(0);\n    expect(result.current.unreadCount).toBe(0);\n    expect(result.current.isConnected).toBe(false); // Estado inicial\n  });\n\n  it('should categorize alerts by severity', () => {\n    const { result } = renderHook(() => useLogisticsAlerts(), {\n      wrapper: createWrapper()\n    });\n\n    const alerts = [\n      {\n        id: 'alert-1',\n        type: 'delay',\n        severity: 'critical',\n        shipment_id: 1,\n        message: 'Critical delay',\n        timestamp: new Date().toISOString(),\n        auto_resolve: false\n      },\n      {\n        id: 'alert-2',\n        type: 'exception',\n        severity: 'high',\n        shipment_id: 2,\n        message: 'High priority exception',\n        timestamp: new Date().toISOString(),\n        auto_resolve: false\n      },\n      {\n        id: 'alert-3',\n        type: 'info',\n        severity: 'low',\n        shipment_id: 3,\n        message: 'Low priority info',\n        timestamp: new Date().toISOString(),\n        auto_resolve: true\n      }\n    ] as any;\n\n    // Simular alertas\n    act(() => {\n      (result.current as any).alerts = alerts;\n    });\n\n    // Verificar categorización\n    const criticalAlerts = alerts.filter(a => a.severity === 'critical');\n    const highAlerts = alerts.filter(a => a.severity === 'high');\n    const unreadAlerts = alerts.filter(a => !a.auto_resolve);\n\n    expect(criticalAlerts).toHaveLength(1);\n    expect(highAlerts).toHaveLength(1);\n    expect(unreadAlerts).toHaveLength(2);\n  });\n\n  it('should handle alert clearing', () => {\n    const { result } = renderHook(() => useLogisticsAlerts(), {\n      wrapper: createWrapper()\n    });\n\n    // Agregar alertas\n    act(() => {\n      (result.current as any).alerts = [{\n        id: 'alert-1',\n        type: 'delay',\n        severity: 'high',\n        shipment_id: 1,\n        message: 'Test alert',\n        timestamp: new Date().toISOString(),\n        auto_resolve: false\n      }];\n    });\n\n    // Limpiar alertas\n    act(() => {\n      result.current.clearAlerts();\n    });\n\n    expect(result.current.alerts).toEqual([]);\n    expect(result.current.totalAlerts).toBe(0);\n  });\n\n  it('should track last alert', () => {\n    const { result } = renderHook(() => useLogisticsAlerts(), {\n      wrapper: createWrapper()\n    });\n\n    const lastAlert = {\n      id: 'alert-latest',\n      type: 'delay',\n      severity: 'high',\n      shipment_id: 1,\n      message: 'Latest alert',\n      timestamp: new Date().toISOString(),\n      auto_resolve: false\n    } as any;\n\n    act(() => {\n      (result.current as any).lastAlert = lastAlert;\n    });\n\n    expect(result.current.lastAlert).toEqual(lastAlert);\n  });\n});\n\n// =====================================================\n// TESTS DE INTEGRACIÓN\n// =====================================================\n\ndescribe('WebSocket Hooks Integration', () => {\n  beforeEach(() => {\n    createMockWebSocket();\n    jest.clearAllMocks();\n  });\n\n  it('should work together for complete tracking experience', () => {\n    const shipmentId = 123;\n    \n    // Usar ambos hooks en el mismo renderHook para compartir el contexto\n    const { result } = renderHook(() => {\n      const wsResult = useLogisticsWebSocket();\n      const trackingResult = useShipmentTracking(shipmentId);\n      return { wsResult, trackingResult };\n    }, {\n      wrapper: createWrapper()\n    });\n\n    // Verificar estado inicial de ambos hooks\n    expect(result.current.wsResult.isConnected).toBe(false);\n    expect(result.current.trackingResult.isConnected).toBe(false);\n    expect(result.current.wsResult.lastTrackingUpdate).toBeNull();\n    expect(result.current.trackingResult.currentLocation).toBeNull();\n    expect(result.current.trackingResult.shipmentId).toBe(shipmentId);\n  });\n\n  it('should handle errors gracefully', () => {\n    expect(() => {\n      renderHook(() => useLogisticsWebSocket({\n        enabled: false\n      }), {\n        wrapper: createWrapper()\n      });\n    }).not.toThrow();\n  });\n});\n"],"names":["jest","mock","getLogisticsWebSocket","fn","globalMockWebSocket","createMockWebSocket","LogisticsWebSocketSimulator","mockImplementation","start","stop","simulateTrackingUpdate","simulateAlert","simulateGeofenceEvent","toast","success","error","warning","info","listeners","connected","mockWs","send","close","addEventListener","removeEventListener","on","event","callback","push","setTimeout","isConnected","off","filter","cb","emit","data","forEach","readyState","connect","mockResolvedValue","undefined","disconnect","subscribeToShipment","unsubscribeFromShipment","subscribeToGeofence","unsubscribeFromGeofence","subscribeToAlerts","unsubscribeFromAlerts","global","WebSocket","createTestQueryClient","QueryClient","defaultOptions","queries","retry","mutations","createWrapper","queryClient","children","React","createElement","QueryClientProvider","client","describe","mockWebSocket","beforeEach","clearAllMocks","it","result","renderHook","useLogisticsWebSocket","wrapper","expect","current","toBe","connectionState","lastTrackingUpdate","toBeNull","lastAlert","lastGeofenceEvent","alerts","toEqual","simulateInDevelopment","act","onopen","waitFor","timeout","trackingUpdate","shipment_id","location","latitude","longitude","status","timestamp","Date","toISOString","alert","id","type","severity","message","auto_resolve","toContain","clearAlerts","not","toThrow","autoConnect","shipmentId","useShipmentTracking","currentLocation","trackingHistory","updates","update","toHaveLength","useLogisticsAlerts","criticalAlerts","highAlerts","unreadAlerts","totalAlerts","criticalCount","highCount","unreadCount","a","wsResult","trackingResult","enabled"],"mappings":"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"}