f904537cd67d8b765e712aedd860145f
/**
 * Utilidades de Autenticación Enterprise
 * Sistema centralizado que combina Clerk + Supabase con patrones enterprise
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get getEnterpriseAuthContext () {
        return getEnterpriseAuthContext;
    },
    get requireAdminAuth () {
        return requireAdminAuth;
    },
    get requireBasicAuth () {
        return requireBasicAuth;
    },
    get requireCriticalAuth () {
        return requireCriticalAuth;
    },
    get requireHighAuth () {
        return requireHighAuth;
    },
    get requireMediumAuth () {
        return requireMediumAuth;
    },
    get requirePaymentAuth () {
        return requirePaymentAuth;
    },
    get withAdminAuth () {
        return withAdminAuth;
    },
    get withBasicAuth () {
        return withBasicAuth;
    },
    get withCriticalAuth () {
        return withCriticalAuth;
    },
    get withEnterpriseAuth () {
        return withEnterpriseAuth;
    },
    get withHighAuth () {
        return withHighAuth;
    },
    get withMediumAuth () {
        return withMediumAuth;
    },
    get withPaymentAuth () {
        return withPaymentAuth;
    }
});
const _auth = require("../../auth");
const _supabase = require("../supabase");
const _jwtvalidation = require("./jwt-validation");
const _csrfprotection = require("./csrf-protection");
const _ratelimiting = require("./rate-limiting");
const _securityaudit = require("./security-audit");
// =====================================================
// CONFIGURACIONES ENTERPRISE
// =====================================================
const ENTERPRISE_CONFIGS = {
    // Configuración para operaciones críticas (admin, pagos)
    critical: {
        requiredRole: 'admin',
        securityLevel: 'critical',
        enableRateLimit: true,
        enableCSRFProtection: true,
        enableJWTValidation: true,
        rateLimitType: 'admin',
        requiredPermissions: [
            'admin_access'
        ]
    },
    // Configuración para operaciones de alto nivel (gestión de contenido)
    high: {
        requiredRole: 'admin',
        securityLevel: 'high',
        enableRateLimit: true,
        enableCSRFProtection: true,
        enableJWTValidation: true,
        rateLimitType: 'admin'
    },
    // Configuración para operaciones moderadas (APIs de productos)
    medium: {
        securityLevel: 'medium',
        enableRateLimit: true,
        enableCSRFProtection: false,
        enableJWTValidation: false,
        rateLimitType: 'products'
    },
    // Configuración para operaciones básicas (consultas públicas)
    low: {
        securityLevel: 'low',
        enableRateLimit: true,
        enableCSRFProtection: false,
        enableJWTValidation: false,
        rateLimitType: 'general'
    }
};
async function getEnterpriseAuthContext(request, options = {}) {
    try {
        const startTime = Date.now();
        // Aplicar configuración predefinida si se especifica nivel de seguridad
        const config = options.securityLevel ? {
            ...ENTERPRISE_CONFIGS[options.securityLevel],
            ...options
        } : options;
        // 1. VALIDACIÓN DE RATE LIMITING
        if (config.enableRateLimit && config.rateLimitType) {
            const rateLimitResult = await (0, _ratelimiting.checkRateLimit)(request, _ratelimiting.RATE_LIMIT_CONFIGS[config.rateLimitType], `enterprise_${config.rateLimitType}`);
            if (!rateLimitResult.allowed) {
                await (0, _securityaudit.logAuthFailure)('unknown', `Rate limit exceeded: ${rateLimitResult.error}`, request);
                return {
                    success: false,
                    error: rateLimitResult.error || 'Rate limit exceeded',
                    code: 'RATE_LIMIT_EXCEEDED',
                    status: 429,
                    retryAfter: rateLimitResult.retryAfter
                };
            }
        }
        // 2. VALIDACIÓN CSRF
        let csrfValid = true;
        if (config.enableCSRFProtection) {
            const csrfResult = await (0, _csrfprotection.validateRequestOrigin)(request);
            csrfValid = csrfResult.valid;
            if (!csrfValid) {
                await (0, _securityaudit.logAuthFailure)('unknown', `CSRF validation failed: ${csrfResult.error}`, request);
                return {
                    success: false,
                    error: csrfResult.error || 'Invalid request origin',
                    code: 'CSRF_VALIDATION_FAILED',
                    status: 403
                };
            }
        }
        // 3. AUTENTICACIÓN BÁSICA CON CLERK
        let userId;
        let sessionId;
        let userEmail;
        if (request && 'query' in request) {
            // Pages Router - NextAuth.js
            // TODO: Implementar autenticación para Pages Router con NextAuth.js
            return {
                success: false,
                error: 'Pages Router no soportado con NextAuth.js',
                code: 'NOT_SUPPORTED',
                status: 401
            };
        } else {
            // App Router - NextAuth.js
            const session = await (0, _auth.auth)();
            if (!session?.user?.id) {
                return {
                    success: false,
                    error: 'Usuario no autenticado',
                    code: 'NOT_AUTHENTICATED',
                    status: 401
                };
            }
            userId = session.user.id;
            sessionId = session.user.id; // NextAuth.js no tiene sessionId separado
            userEmail = session.user.email;
        }
        // 4. VALIDACIÓN JWT
        let jwtValid = true;
        if (config.enableJWTValidation) {
            const jwtResult = await (0, _jwtvalidation.validateJWTIntegrity)(request);
            jwtValid = jwtResult.valid;
            if (!jwtValid) {
                await (0, _securityaudit.logAuthFailure)(userId, `JWT validation failed: ${jwtResult.error}`, request);
                return {
                    success: false,
                    error: jwtResult.error || 'Invalid JWT token',
                    code: 'JWT_VALIDATION_FAILED',
                    status: 401
                };
            }
            // Validar permisos específicos si se requieren
            if (config.requiredRole || config.requiredPermissions) {
                const permissionResult = await (0, _jwtvalidation.validateJWTPermissions)(config.requiredRole || '', config.requiredPermissions || [], request);
                if (!permissionResult.valid) {
                    await (0, _securityaudit.logPermissionDenied)(userId, `Permission validation failed: ${permissionResult.error}`, request);
                    return {
                        success: false,
                        error: permissionResult.error || 'Insufficient permissions',
                        code: 'INSUFFICIENT_PERMISSIONS',
                        status: 403
                    };
                }
            }
        }
        // 5. OBTENER INFORMACIÓN DEL USUARIO DESDE SUPABASE
        const { data: userProfile, error: userError } = await _supabase.supabaseAdmin.from('user_profiles').select('*').eq('clerk_user_id', userId).single();
        if (userError && userError.code !== 'PGRST116') {
            console.error('[ENTERPRISE_AUTH] Error obteniendo perfil de usuario:', userError);
        }
        // 6. DETERMINAR ROL Y PERMISOS
        const userRole = userProfile?.role || 'user';
        const userPermissions = userProfile?.permissions || [];
        // Validar rol requerido
        if (config.requiredRole && userRole !== config.requiredRole) {
            await (0, _securityaudit.logPermissionDenied)(userId, `Role validation failed: required ${config.requiredRole}, got ${userRole}`, request);
            return {
                success: false,
                error: `Rol requerido: ${config.requiredRole}`,
                code: 'INSUFFICIENT_ROLE',
                status: 403
            };
        }
        // Validar permisos requeridos
        if (config.requiredPermissions && config.requiredPermissions.length > 0) {
            const hasAllPermissions = config.requiredPermissions.every((permission)=>userPermissions.includes(permission));
            if (!hasAllPermissions) {
                await (0, _securityaudit.logPermissionDenied)(userId, `Permission validation failed: missing ${config.requiredPermissions.join(', ')}`, request);
                return {
                    success: false,
                    error: `Permisos insuficientes: ${config.requiredPermissions.join(', ')}`,
                    code: 'INSUFFICIENT_PERMISSIONS',
                    status: 403
                };
            }
        }
        // 7. OBTENER INFORMACIÓN ADICIONAL
        const ipAddress = getClientIP(request);
        const userAgent = getHeader(request, 'user-agent') || 'unknown';
        // 8. CREAR CONTEXTO ENTERPRISE
        const context = {
            userId,
            sessionId,
            email: userProfile?.email || userEmail,
            role: userRole,
            permissions: userPermissions,
            sessionValid: !!sessionId,
            sessionMetadata: userProfile?.metadata,
            securityLevel: config.securityLevel || 'medium',
            ipAddress,
            userAgent,
            supabase: _supabase.supabaseAdmin,
            validations: {
                jwtValid,
                csrfValid,
                rateLimitPassed: true,
                originValid: csrfValid
            }
        };
        // 9. LOG DE ÉXITO
        await (0, _securityaudit.logAuthSuccess)(userId, {
            ip_address: ipAddress,
            user_agent: userAgent,
            session_id: sessionId,
            security_level: config.securityLevel || 'medium',
            permissions: userPermissions,
            role: userRole
        }, request);
        const duration = Date.now() - startTime;
        console.log(`[ENTERPRISE_AUTH] Autenticación exitosa para ${userId} en ${duration}ms`);
        return {
            success: true,
            context
        };
    } catch (error) {
        console.error('[ENTERPRISE_AUTH] Error en autenticación enterprise:', error);
        await (0, _securityaudit.logAuthFailure)('unknown', `Enterprise auth error: ${error.message}`, request);
        return {
            success: false,
            error: 'Error interno de autenticación',
            code: 'INTERNAL_AUTH_ERROR',
            status: 500
        };
    }
}
// =====================================================
// FUNCIONES AUXILIARES
// =====================================================
/**
 * Obtiene la IP del cliente
 */ function getClientIP(request) {
    if ('ip' in request && request.ip) {
        return request.ip;
    }
    const forwarded = getHeader(request, 'x-forwarded-for');
    const realIP = getHeader(request, 'x-real-ip');
    const cfIP = getHeader(request, 'cf-connecting-ip');
    return forwarded?.split(',')[0] || realIP || cfIP || 'unknown';
}
/**
 * Obtiene un header de manera compatible
 */ function getHeader(request, headerName) {
    if ('headers' in request && typeof request.headers.get === 'function') {
        return request.headers.get(headerName);
    } else if ('headers' in request) {
        const header = request.headers[headerName];
        return Array.isArray(header) ? header[0] : header || null;
    }
    return null;
}
async function requireCriticalAuth(request) {
    return getEnterpriseAuthContext(request, {
        securityLevel: 'critical'
    });
}
async function requireHighAuth(request, requiredPermissions) {
    return getEnterpriseAuthContext(request, {
        securityLevel: 'high',
        requiredPermissions
    });
}
async function requireMediumAuth(request) {
    return getEnterpriseAuthContext(request, {
        securityLevel: 'medium'
    });
}
async function requireBasicAuth(request) {
    return getEnterpriseAuthContext(request, {
        securityLevel: 'low'
    });
}
async function requireAdminAuth(request, requiredPermissions = [
    'admin_access'
]) {
    return getEnterpriseAuthContext(request, {
        requiredRole: 'admin',
        requiredPermissions,
        securityLevel: 'critical',
        enableRateLimit: true,
        enableCSRFProtection: true,
        enableJWTValidation: true,
        rateLimitType: 'admin'
    });
}
async function requirePaymentAuth(request) {
    return getEnterpriseAuthContext(request, {
        securityLevel: 'critical',
        enableRateLimit: true,
        enableCSRFProtection: true,
        enableJWTValidation: true,
        rateLimitType: 'payments',
        requiredPermissions: [
            'payment_access'
        ]
    });
}
function withEnterpriseAuth(authFunction) {
    return function(handler) {
        return async (request, ...args)=>{
            try {
                const authResult = await authFunction(request);
                if (!authResult.success) {
                    const errorResponse = {
                        success: false,
                        error: authResult.error,
                        code: authResult.code,
                        timestamp: new Date().toISOString(),
                        enterprise: true
                    };
                    const headers = {
                        'Content-Type': 'application/json'
                    };
                    if (authResult.retryAfter) {
                        headers['Retry-After'] = authResult.retryAfter.toString();
                    }
                    if ('query' in request) {
                        // Pages Router
                        const res = args[0];
                        Object.entries(headers).forEach(([key, value])=>{
                            res.setHeader(key, value);
                        });
                        return res.status(authResult.status || 401).json(errorResponse);
                    } else {
                        // App Router
                        return new Response(JSON.stringify(errorResponse), {
                            status: authResult.status || 401,
                            headers
                        });
                    }
                }
                // Añadir contexto enterprise al request
                request.enterpriseAuth = authResult.context;
                return handler(request, ...args);
            } catch (error) {
                console.error('[ENTERPRISE_AUTH] Error en middleware:', error);
                const errorResponse = {
                    success: false,
                    error: 'Error interno de autenticación enterprise',
                    code: 'ENTERPRISE_AUTH_ERROR',
                    timestamp: new Date().toISOString()
                };
                if ('query' in request) {
                    // Pages Router
                    const res = args[0];
                    return res.status(500).json(errorResponse);
                } else {
                    // App Router
                    return new Response(JSON.stringify(errorResponse), {
                        status: 500,
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                }
            }
        };
    };
}
const withCriticalAuth = ()=>withEnterpriseAuth(requireCriticalAuth);
const withHighAuth = (requiredPermissions)=>withEnterpriseAuth((req)=>requireHighAuth(req, requiredPermissions));
const withMediumAuth = ()=>withEnterpriseAuth(requireMediumAuth);
const withBasicAuth = ()=>withEnterpriseAuth(requireBasicAuth);
const withAdminAuth = (requiredPermissions)=>withEnterpriseAuth((req)=>requireAdminAuth(req, requiredPermissions));
const withPaymentAuth = ()=>withEnterpriseAuth(requirePaymentAuth);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhdXRoXFxlbnRlcnByaXNlLWF1dGgtdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBVdGlsaWRhZGVzIGRlIEF1dGVudGljYWNpw7NuIEVudGVycHJpc2VcbiAqIFNpc3RlbWEgY2VudHJhbGl6YWRvIHF1ZSBjb21iaW5hIENsZXJrICsgU3VwYWJhc2UgY29uIHBhdHJvbmVzIGVudGVycHJpc2VcbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IGF1dGggfSBmcm9tICdAL2F1dGgnO1xuaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcbmltcG9ydCB7IHZhbGlkYXRlSldUSW50ZWdyaXR5LCB2YWxpZGF0ZUpXVFBlcm1pc3Npb25zIH0gZnJvbSAnLi9qd3QtdmFsaWRhdGlvbic7XG5pbXBvcnQgeyB2YWxpZGF0ZVJlcXVlc3RPcmlnaW4gfSBmcm9tICcuL2NzcmYtcHJvdGVjdGlvbic7XG5pbXBvcnQgeyBjaGVja1JhdGVMaW1pdCwgUkFURV9MSU1JVF9DT05GSUdTIH0gZnJvbSAnLi9yYXRlLWxpbWl0aW5nJztcbmltcG9ydCB7IGxvZ0F1dGhTdWNjZXNzLCBsb2dBdXRoRmFpbHVyZSwgbG9nUGVybWlzc2lvbkRlbmllZCB9IGZyb20gJy4vc2VjdXJpdHktYXVkaXQnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVElQT1MgWSBJTlRFUkZBQ0VTIEVOVEVSUFJJU0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgRW50ZXJwcmlzZUF1dGhDb250ZXh0IHtcbiAgLy8gSW5mb3JtYWNpw7NuIGRlbCB1c3VhcmlvXG4gIHVzZXJJZDogc3RyaW5nO1xuICBzZXNzaW9uSWQ/OiBzdHJpbmc7XG4gIGVtYWlsPzogc3RyaW5nO1xuICByb2xlOiAnYWRtaW4nIHwgJ3VzZXInIHwgJ21vZGVyYXRvcic7XG4gIHBlcm1pc3Npb25zOiBzdHJpbmdbXTtcbiAgXG4gIC8vIEluZm9ybWFjacOzbiBkZSBsYSBzZXNpw7NuXG4gIHNlc3Npb25WYWxpZDogYm9vbGVhbjtcbiAgc2Vzc2lvbk1ldGFkYXRhPzogYW55O1xuICBcbiAgLy8gSW5mb3JtYWNpw7NuIGRlIHNlZ3VyaWRhZFxuICBzZWN1cml0eUxldmVsOiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnIHwgJ2NyaXRpY2FsJztcbiAgaXBBZGRyZXNzPzogc3RyaW5nO1xuICB1c2VyQWdlbnQ/OiBzdHJpbmc7XG4gIFxuICAvLyBDbGllbnRlcyBkZSBiYXNlIGRlIGRhdG9zXG4gIHN1cGFiYXNlOiB0eXBlb2Ygc3VwYWJhc2VBZG1pbjtcbiAgXG4gIC8vIEluZm9ybWFjacOzbiBkZSB2YWxpZGFjaW9uZXNcbiAgdmFsaWRhdGlvbnM6IHtcbiAgICBqd3RWYWxpZDogYm9vbGVhbjtcbiAgICBjc3JmVmFsaWQ6IGJvb2xlYW47XG4gICAgcmF0ZUxpbWl0UGFzc2VkOiBib29sZWFuO1xuICAgIG9yaWdpblZhbGlkOiBib29sZWFuO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVudGVycHJpc2VBdXRoUmVzdWx0IHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgY29udGV4dD86IEVudGVycHJpc2VBdXRoQ29udGV4dDtcbiAgZXJyb3I/OiBzdHJpbmc7XG4gIGNvZGU/OiBzdHJpbmc7XG4gIHN0YXR1cz86IG51bWJlcjtcbiAgcmV0cnlBZnRlcj86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFbnRlcnByaXNlQXV0aE9wdGlvbnMge1xuICByZXF1aXJlZFJvbGU/OiAnYWRtaW4nIHwgJ3VzZXInIHwgJ21vZGVyYXRvcic7XG4gIHJlcXVpcmVkUGVybWlzc2lvbnM/OiBzdHJpbmdbXTtcbiAgc2VjdXJpdHlMZXZlbD86ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnO1xuICBlbmFibGVSYXRlTGltaXQ/OiBib29sZWFuO1xuICBlbmFibGVDU1JGUHJvdGVjdGlvbj86IGJvb2xlYW47XG4gIGVuYWJsZUpXVFZhbGlkYXRpb24/OiBib29sZWFuO1xuICByYXRlTGltaXRUeXBlPzoga2V5b2YgdHlwZW9mIFJBVEVfTElNSVRfQ09ORklHUztcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENPTkZJR1VSQUNJT05FUyBFTlRFUlBSSVNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBFTlRFUlBSSVNFX0NPTkZJR1MgPSB7XG4gIC8vIENvbmZpZ3VyYWNpw7NuIHBhcmEgb3BlcmFjaW9uZXMgY3LDrXRpY2FzIChhZG1pbiwgcGFnb3MpXG4gIGNyaXRpY2FsOiB7XG4gICAgcmVxdWlyZWRSb2xlOiAnYWRtaW4nIGFzIGNvbnN0LFxuICAgIHNlY3VyaXR5TGV2ZWw6ICdjcml0aWNhbCcgYXMgY29uc3QsXG4gICAgZW5hYmxlUmF0ZUxpbWl0OiB0cnVlLFxuICAgIGVuYWJsZUNTUkZQcm90ZWN0aW9uOiB0cnVlLFxuICAgIGVuYWJsZUpXVFZhbGlkYXRpb246IHRydWUsXG4gICAgcmF0ZUxpbWl0VHlwZTogJ2FkbWluJyBhcyBjb25zdCxcbiAgICByZXF1aXJlZFBlcm1pc3Npb25zOiBbJ2FkbWluX2FjY2VzcyddXG4gIH0sXG4gIFxuICAvLyBDb25maWd1cmFjacOzbiBwYXJhIG9wZXJhY2lvbmVzIGRlIGFsdG8gbml2ZWwgKGdlc3Rpw7NuIGRlIGNvbnRlbmlkbylcbiAgaGlnaDoge1xuICAgIHJlcXVpcmVkUm9sZTogJ2FkbWluJyBhcyBjb25zdCxcbiAgICBzZWN1cml0eUxldmVsOiAnaGlnaCcgYXMgY29uc3QsXG4gICAgZW5hYmxlUmF0ZUxpbWl0OiB0cnVlLFxuICAgIGVuYWJsZUNTUkZQcm90ZWN0aW9uOiB0cnVlLFxuICAgIGVuYWJsZUpXVFZhbGlkYXRpb246IHRydWUsXG4gICAgcmF0ZUxpbWl0VHlwZTogJ2FkbWluJyBhcyBjb25zdFxuICB9LFxuICBcbiAgLy8gQ29uZmlndXJhY2nDs24gcGFyYSBvcGVyYWNpb25lcyBtb2RlcmFkYXMgKEFQSXMgZGUgcHJvZHVjdG9zKVxuICBtZWRpdW06IHtcbiAgICBzZWN1cml0eUxldmVsOiAnbWVkaXVtJyBhcyBjb25zdCxcbiAgICBlbmFibGVSYXRlTGltaXQ6IHRydWUsXG4gICAgZW5hYmxlQ1NSRlByb3RlY3Rpb246IGZhbHNlLFxuICAgIGVuYWJsZUpXVFZhbGlkYXRpb246IGZhbHNlLFxuICAgIHJhdGVMaW1pdFR5cGU6ICdwcm9kdWN0cycgYXMgY29uc3RcbiAgfSxcbiAgXG4gIC8vIENvbmZpZ3VyYWNpw7NuIHBhcmEgb3BlcmFjaW9uZXMgYsOhc2ljYXMgKGNvbnN1bHRhcyBww7pibGljYXMpXG4gIGxvdzoge1xuICAgIHNlY3VyaXR5TGV2ZWw6ICdsb3cnIGFzIGNvbnN0LFxuICAgIGVuYWJsZVJhdGVMaW1pdDogdHJ1ZSxcbiAgICBlbmFibGVDU1JGUHJvdGVjdGlvbjogZmFsc2UsXG4gICAgZW5hYmxlSldUVmFsaWRhdGlvbjogZmFsc2UsXG4gICAgcmF0ZUxpbWl0VHlwZTogJ2dlbmVyYWwnIGFzIGNvbnN0XG4gIH1cbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBGVU5DSU9ORVMgUFJJTkNJUEFMRVMgRU5URVJQUklTRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBGdW5jacOzbiBwcmluY2lwYWwgZGUgYXV0ZW50aWNhY2nDs24gZW50ZXJwcmlzZVxuICogQ29tYmluYSB0b2RhcyBsYXMgdmFsaWRhY2lvbmVzIHkgcmV0b3JuYSBjb250ZXh0byBjb21wbGV0b1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0RW50ZXJwcmlzZUF1dGhDb250ZXh0KFxuICByZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0LFxuICBvcHRpb25zOiBFbnRlcnByaXNlQXV0aE9wdGlvbnMgPSB7fVxuKTogUHJvbWlzZTxFbnRlcnByaXNlQXV0aFJlc3VsdD4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgLy8gQXBsaWNhciBjb25maWd1cmFjacOzbiBwcmVkZWZpbmlkYSBzaSBzZSBlc3BlY2lmaWNhIG5pdmVsIGRlIHNlZ3VyaWRhZFxuICAgIGNvbnN0IGNvbmZpZyA9IG9wdGlvbnMuc2VjdXJpdHlMZXZlbCBcbiAgICAgID8geyAuLi5FTlRFUlBSSVNFX0NPTkZJR1Nbb3B0aW9ucy5zZWN1cml0eUxldmVsXSwgLi4ub3B0aW9ucyB9XG4gICAgICA6IG9wdGlvbnM7XG5cbiAgICAvLyAxLiBWQUxJREFDScOTTiBERSBSQVRFIExJTUlUSU5HXG4gICAgaWYgKGNvbmZpZy5lbmFibGVSYXRlTGltaXQgJiYgY29uZmlnLnJhdGVMaW1pdFR5cGUpIHtcbiAgICAgIGNvbnN0IHJhdGVMaW1pdFJlc3VsdCA9IGF3YWl0IGNoZWNrUmF0ZUxpbWl0KFxuICAgICAgICByZXF1ZXN0LFxuICAgICAgICBSQVRFX0xJTUlUX0NPTkZJR1NbY29uZmlnLnJhdGVMaW1pdFR5cGVdLFxuICAgICAgICBgZW50ZXJwcmlzZV8ke2NvbmZpZy5yYXRlTGltaXRUeXBlfWBcbiAgICAgICk7XG5cbiAgICAgIGlmICghcmF0ZUxpbWl0UmVzdWx0LmFsbG93ZWQpIHtcbiAgICAgICAgYXdhaXQgbG9nQXV0aEZhaWx1cmUoXG4gICAgICAgICAgJ3Vua25vd24nLFxuICAgICAgICAgIGBSYXRlIGxpbWl0IGV4Y2VlZGVkOiAke3JhdGVMaW1pdFJlc3VsdC5lcnJvcn1gLFxuICAgICAgICAgIHJlcXVlc3RcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHJhdGVMaW1pdFJlc3VsdC5lcnJvciB8fCAnUmF0ZSBsaW1pdCBleGNlZWRlZCcsXG4gICAgICAgICAgY29kZTogJ1JBVEVfTElNSVRfRVhDRUVERUQnLFxuICAgICAgICAgIHN0YXR1czogNDI5LFxuICAgICAgICAgIHJldHJ5QWZ0ZXI6IHJhdGVMaW1pdFJlc3VsdC5yZXRyeUFmdGVyXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gMi4gVkFMSURBQ0nDk04gQ1NSRlxuICAgIGxldCBjc3JmVmFsaWQgPSB0cnVlO1xuICAgIGlmIChjb25maWcuZW5hYmxlQ1NSRlByb3RlY3Rpb24pIHtcbiAgICAgIGNvbnN0IGNzcmZSZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZVJlcXVlc3RPcmlnaW4ocmVxdWVzdCk7XG4gICAgICBjc3JmVmFsaWQgPSBjc3JmUmVzdWx0LnZhbGlkO1xuICAgICAgXG4gICAgICBpZiAoIWNzcmZWYWxpZCkge1xuICAgICAgICBhd2FpdCBsb2dBdXRoRmFpbHVyZShcbiAgICAgICAgICAndW5rbm93bicsXG4gICAgICAgICAgYENTUkYgdmFsaWRhdGlvbiBmYWlsZWQ6ICR7Y3NyZlJlc3VsdC5lcnJvcn1gLFxuICAgICAgICAgIHJlcXVlc3RcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IGNzcmZSZXN1bHQuZXJyb3IgfHwgJ0ludmFsaWQgcmVxdWVzdCBvcmlnaW4nLFxuICAgICAgICAgIGNvZGU6ICdDU1JGX1ZBTElEQVRJT05fRkFJTEVEJyxcbiAgICAgICAgICBzdGF0dXM6IDQwM1xuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIDMuIEFVVEVOVElDQUNJw5NOIELDgVNJQ0EgQ09OIENMRVJLXG4gICAgbGV0IHVzZXJJZDogc3RyaW5nO1xuICAgIGxldCBzZXNzaW9uSWQ6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBsZXQgdXNlckVtYWlsOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICBpZiAocmVxdWVzdCAmJiAncXVlcnknIGluIHJlcXVlc3QpIHtcbiAgICAgIC8vIFBhZ2VzIFJvdXRlciAtIE5leHRBdXRoLmpzXG4gICAgICAvLyBUT0RPOiBJbXBsZW1lbnRhciBhdXRlbnRpY2FjacOzbiBwYXJhIFBhZ2VzIFJvdXRlciBjb24gTmV4dEF1dGguanNcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ1BhZ2VzIFJvdXRlciBubyBzb3BvcnRhZG8gY29uIE5leHRBdXRoLmpzJyxcbiAgICAgICAgY29kZTogJ05PVF9TVVBQT1JURUQnLFxuICAgICAgICAgIHN0YXR1czogNDAxXG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEFwcCBSb3V0ZXIgLSBOZXh0QXV0aC5qc1xuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGgoKTtcbiAgICAgIGlmICghc2Vzc2lvbj8udXNlcj8uaWQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ1VzdWFyaW8gbm8gYXV0ZW50aWNhZG8nLFxuICAgICAgICAgIGNvZGU6ICdOT1RfQVVUSEVOVElDQVRFRCcsXG4gICAgICAgICAgc3RhdHVzOiA0MDFcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHVzZXJJZCA9IHNlc3Npb24udXNlci5pZDtcbiAgICAgIHNlc3Npb25JZCA9IHNlc3Npb24udXNlci5pZDsgLy8gTmV4dEF1dGguanMgbm8gdGllbmUgc2Vzc2lvbklkIHNlcGFyYWRvXG4gICAgICB1c2VyRW1haWwgPSBzZXNzaW9uLnVzZXIuZW1haWw7XG4gICAgfVxuXG4gICAgLy8gNC4gVkFMSURBQ0nDk04gSldUXG4gICAgbGV0IGp3dFZhbGlkID0gdHJ1ZTtcbiAgICBpZiAoY29uZmlnLmVuYWJsZUpXVFZhbGlkYXRpb24pIHtcbiAgICAgIGNvbnN0IGp3dFJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlSldUSW50ZWdyaXR5KHJlcXVlc3QpO1xuICAgICAgand0VmFsaWQgPSBqd3RSZXN1bHQudmFsaWQ7XG4gICAgICBcbiAgICAgIGlmICghand0VmFsaWQpIHtcbiAgICAgICAgYXdhaXQgbG9nQXV0aEZhaWx1cmUoXG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIGBKV1QgdmFsaWRhdGlvbiBmYWlsZWQ6ICR7and0UmVzdWx0LmVycm9yfWAsXG4gICAgICAgICAgcmVxdWVzdFxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogand0UmVzdWx0LmVycm9yIHx8ICdJbnZhbGlkIEpXVCB0b2tlbicsXG4gICAgICAgICAgY29kZTogJ0pXVF9WQUxJREFUSU9OX0ZBSUxFRCcsXG4gICAgICAgICAgc3RhdHVzOiA0MDFcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhciBwZXJtaXNvcyBlc3BlY8OtZmljb3Mgc2kgc2UgcmVxdWllcmVuXG4gICAgICBpZiAoY29uZmlnLnJlcXVpcmVkUm9sZSB8fCBjb25maWcucmVxdWlyZWRQZXJtaXNzaW9ucykge1xuICAgICAgICBjb25zdCBwZXJtaXNzaW9uUmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVKV1RQZXJtaXNzaW9ucyhcbiAgICAgICAgICBjb25maWcucmVxdWlyZWRSb2xlIHx8ICcnLFxuICAgICAgICAgIGNvbmZpZy5yZXF1aXJlZFBlcm1pc3Npb25zIHx8IFtdLFxuICAgICAgICAgIHJlcXVlc3RcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghcGVybWlzc2lvblJlc3VsdC52YWxpZCkge1xuICAgICAgICAgIGF3YWl0IGxvZ1Blcm1pc3Npb25EZW5pZWQoXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICBgUGVybWlzc2lvbiB2YWxpZGF0aW9uIGZhaWxlZDogJHtwZXJtaXNzaW9uUmVzdWx0LmVycm9yfWAsXG4gICAgICAgICAgICByZXF1ZXN0XG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogcGVybWlzc2lvblJlc3VsdC5lcnJvciB8fCAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyxcbiAgICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgICAgc3RhdHVzOiA0MDNcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gNS4gT0JURU5FUiBJTkZPUk1BQ0nDk04gREVMIFVTVUFSSU8gREVTREUgU1VQQUJBU0VcbiAgICBjb25zdCB7IGRhdGE6IHVzZXJQcm9maWxlLCBlcnJvcjogdXNlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnY2xlcmtfdXNlcl9pZCcsIHVzZXJJZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmICh1c2VyRXJyb3IgJiYgdXNlckVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tFTlRFUlBSSVNFX0FVVEhdIEVycm9yIG9idGVuaWVuZG8gcGVyZmlsIGRlIHVzdWFyaW86JywgdXNlckVycm9yKTtcbiAgICB9XG5cbiAgICAvLyA2LiBERVRFUk1JTkFSIFJPTCBZIFBFUk1JU09TXG4gICAgY29uc3QgdXNlclJvbGUgPSB1c2VyUHJvZmlsZT8ucm9sZSB8fCAndXNlcic7XG4gICAgY29uc3QgdXNlclBlcm1pc3Npb25zID0gdXNlclByb2ZpbGU/LnBlcm1pc3Npb25zIHx8IFtdO1xuXG4gICAgLy8gVmFsaWRhciByb2wgcmVxdWVyaWRvXG4gICAgaWYgKGNvbmZpZy5yZXF1aXJlZFJvbGUgJiYgdXNlclJvbGUgIT09IGNvbmZpZy5yZXF1aXJlZFJvbGUpIHtcbiAgICAgIGF3YWl0IGxvZ1Blcm1pc3Npb25EZW5pZWQoXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgYFJvbGUgdmFsaWRhdGlvbiBmYWlsZWQ6IHJlcXVpcmVkICR7Y29uZmlnLnJlcXVpcmVkUm9sZX0sIGdvdCAke3VzZXJSb2xlfWAsXG4gICAgICAgIHJlcXVlc3RcbiAgICAgICk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogYFJvbCByZXF1ZXJpZG86ICR7Y29uZmlnLnJlcXVpcmVkUm9sZX1gLFxuICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1JPTEUnLFxuICAgICAgICBzdGF0dXM6IDQwM1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGFyIHBlcm1pc29zIHJlcXVlcmlkb3NcbiAgICBpZiAoY29uZmlnLnJlcXVpcmVkUGVybWlzc2lvbnMgJiYgY29uZmlnLnJlcXVpcmVkUGVybWlzc2lvbnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgaGFzQWxsUGVybWlzc2lvbnMgPSBjb25maWcucmVxdWlyZWRQZXJtaXNzaW9ucy5ldmVyeShcbiAgICAgICAgcGVybWlzc2lvbiA9PiB1c2VyUGVybWlzc2lvbnMuaW5jbHVkZXMocGVybWlzc2lvbilcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGlmICghaGFzQWxsUGVybWlzc2lvbnMpIHtcbiAgICAgICAgYXdhaXQgbG9nUGVybWlzc2lvbkRlbmllZChcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgYFBlcm1pc3Npb24gdmFsaWRhdGlvbiBmYWlsZWQ6IG1pc3NpbmcgJHtjb25maWcucmVxdWlyZWRQZXJtaXNzaW9ucy5qb2luKCcsICcpfWAsXG4gICAgICAgICAgcmVxdWVzdFxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogYFBlcm1pc29zIGluc3VmaWNpZW50ZXM6ICR7Y29uZmlnLnJlcXVpcmVkUGVybWlzc2lvbnMuam9pbignLCAnKX1gLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIHN0YXR1czogNDAzXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gNy4gT0JURU5FUiBJTkZPUk1BQ0nDk04gQURJQ0lPTkFMXG4gICAgY29uc3QgaXBBZGRyZXNzID0gZ2V0Q2xpZW50SVAocmVxdWVzdCk7XG4gICAgY29uc3QgdXNlckFnZW50ID0gZ2V0SGVhZGVyKHJlcXVlc3QsICd1c2VyLWFnZW50JykgfHwgJ3Vua25vd24nO1xuXG4gICAgLy8gOC4gQ1JFQVIgQ09OVEVYVE8gRU5URVJQUklTRVxuICAgIGNvbnN0IGNvbnRleHQ6IEVudGVycHJpc2VBdXRoQ29udGV4dCA9IHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIHNlc3Npb25JZCxcbiAgICAgIGVtYWlsOiB1c2VyUHJvZmlsZT8uZW1haWwgfHwgdXNlckVtYWlsLFxuICAgICAgcm9sZTogdXNlclJvbGUgYXMgJ2FkbWluJyB8ICd1c2VyJyB8ICdtb2RlcmF0b3InLFxuICAgICAgcGVybWlzc2lvbnM6IHVzZXJQZXJtaXNzaW9ucyxcbiAgICAgIHNlc3Npb25WYWxpZDogISFzZXNzaW9uSWQsXG4gICAgICBzZXNzaW9uTWV0YWRhdGE6IHVzZXJQcm9maWxlPy5tZXRhZGF0YSxcbiAgICAgIHNlY3VyaXR5TGV2ZWw6IGNvbmZpZy5zZWN1cml0eUxldmVsIHx8ICdtZWRpdW0nLFxuICAgICAgaXBBZGRyZXNzLFxuICAgICAgdXNlckFnZW50LFxuICAgICAgc3VwYWJhc2U6IHN1cGFiYXNlQWRtaW4sXG4gICAgICB2YWxpZGF0aW9uczoge1xuICAgICAgICBqd3RWYWxpZCxcbiAgICAgICAgY3NyZlZhbGlkLFxuICAgICAgICByYXRlTGltaXRQYXNzZWQ6IHRydWUsXG4gICAgICAgIG9yaWdpblZhbGlkOiBjc3JmVmFsaWRcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gOS4gTE9HIERFIMOJWElUT1xuICAgIGF3YWl0IGxvZ0F1dGhTdWNjZXNzKHVzZXJJZCwge1xuICAgICAgaXBfYWRkcmVzczogaXBBZGRyZXNzLFxuICAgICAgdXNlcl9hZ2VudDogdXNlckFnZW50LFxuICAgICAgc2Vzc2lvbl9pZDogc2Vzc2lvbklkLFxuICAgICAgc2VjdXJpdHlfbGV2ZWw6IGNvbmZpZy5zZWN1cml0eUxldmVsIHx8ICdtZWRpdW0nLFxuICAgICAgcGVybWlzc2lvbnM6IHVzZXJQZXJtaXNzaW9ucyxcbiAgICAgIHJvbGU6IHVzZXJSb2xlXG4gICAgfSwgcmVxdWVzdCk7XG5cbiAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgY29uc29sZS5sb2coYFtFTlRFUlBSSVNFX0FVVEhdIEF1dGVudGljYWNpw7NuIGV4aXRvc2EgcGFyYSAke3VzZXJJZH0gZW4gJHtkdXJhdGlvbn1tc2ApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBjb250ZXh0XG4gICAgfTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tFTlRFUlBSSVNFX0FVVEhdIEVycm9yIGVuIGF1dGVudGljYWNpw7NuIGVudGVycHJpc2U6JywgZXJyb3IpO1xuICAgIFxuICAgIGF3YWl0IGxvZ0F1dGhGYWlsdXJlKFxuICAgICAgJ3Vua25vd24nLFxuICAgICAgYEVudGVycHJpc2UgYXV0aCBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICByZXF1ZXN0XG4gICAgKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ0Vycm9yIGludGVybm8gZGUgYXV0ZW50aWNhY2nDs24nLFxuICAgICAgY29kZTogJ0lOVEVSTkFMX0FVVEhfRVJST1InLFxuICAgICAgc3RhdHVzOiA1MDBcbiAgICB9O1xuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBGVU5DSU9ORVMgQVVYSUxJQVJFU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBPYnRpZW5lIGxhIElQIGRlbCBjbGllbnRlXG4gKi9cbmZ1bmN0aW9uIGdldENsaWVudElQKHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QpOiBzdHJpbmcge1xuICBpZiAoJ2lwJyBpbiByZXF1ZXN0ICYmIHJlcXVlc3QuaXApIHtcbiAgICByZXR1cm4gcmVxdWVzdC5pcDtcbiAgfVxuICBcbiAgY29uc3QgZm9yd2FyZGVkID0gZ2V0SGVhZGVyKHJlcXVlc3QsICd4LWZvcndhcmRlZC1mb3InKTtcbiAgY29uc3QgcmVhbElQID0gZ2V0SGVhZGVyKHJlcXVlc3QsICd4LXJlYWwtaXAnKTtcbiAgY29uc3QgY2ZJUCA9IGdldEhlYWRlcihyZXF1ZXN0LCAnY2YtY29ubmVjdGluZy1pcCcpO1xuICBcbiAgcmV0dXJuIGZvcndhcmRlZD8uc3BsaXQoJywnKVswXSB8fCByZWFsSVAgfHwgY2ZJUCB8fCAndW5rbm93bic7XG59XG5cbi8qKlxuICogT2J0aWVuZSB1biBoZWFkZXIgZGUgbWFuZXJhIGNvbXBhdGlibGVcbiAqL1xuZnVuY3Rpb24gZ2V0SGVhZGVyKHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QsIGhlYWRlck5hbWU6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xuICBpZiAoJ2hlYWRlcnMnIGluIHJlcXVlc3QgJiYgdHlwZW9mIHJlcXVlc3QuaGVhZGVycy5nZXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gKHJlcXVlc3QgYXMgTmV4dFJlcXVlc3QpLmhlYWRlcnMuZ2V0KGhlYWRlck5hbWUpO1xuICB9IGVsc2UgaWYgKCdoZWFkZXJzJyBpbiByZXF1ZXN0KSB7XG4gICAgY29uc3QgaGVhZGVyID0gKHJlcXVlc3QgYXMgTmV4dEFwaVJlcXVlc3QpLmhlYWRlcnNbaGVhZGVyTmFtZV07XG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoaGVhZGVyKSA/IGhlYWRlclswXSA6IGhlYWRlciB8fCBudWxsO1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRlVOQ0lPTkVTIERFIENPTlZFTklFTkNJQSBFTlRFUlBSSVNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEF1dGVudGljYWNpw7NuIHBhcmEgb3BlcmFjaW9uZXMgY3LDrXRpY2FzIChhZG1pbiwgcGFnb3MpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXF1aXJlQ3JpdGljYWxBdXRoKFxuICByZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0XG4pOiBQcm9taXNlPEVudGVycHJpc2VBdXRoUmVzdWx0PiB7XG4gIHJldHVybiBnZXRFbnRlcnByaXNlQXV0aENvbnRleHQocmVxdWVzdCwgeyBzZWN1cml0eUxldmVsOiAnY3JpdGljYWwnIH0pO1xufVxuXG4vKipcbiAqIEF1dGVudGljYWNpw7NuIHBhcmEgb3BlcmFjaW9uZXMgZGUgYWx0byBuaXZlbCAoZ2VzdGnDs24gZGUgY29udGVuaWRvKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVxdWlyZUhpZ2hBdXRoKFxuICByZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0LFxuICByZXF1aXJlZFBlcm1pc3Npb25zPzogc3RyaW5nW11cbik6IFByb21pc2U8RW50ZXJwcmlzZUF1dGhSZXN1bHQ+IHtcbiAgcmV0dXJuIGdldEVudGVycHJpc2VBdXRoQ29udGV4dChyZXF1ZXN0LCB7XG4gICAgc2VjdXJpdHlMZXZlbDogJ2hpZ2gnLFxuICAgIHJlcXVpcmVkUGVybWlzc2lvbnNcbiAgfSk7XG59XG5cbi8qKlxuICogQXV0ZW50aWNhY2nDs24gcGFyYSBvcGVyYWNpb25lcyBtb2RlcmFkYXMgKEFQSXMgZGUgcHJvZHVjdG9zKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVxdWlyZU1lZGl1bUF1dGgoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3Rcbik6IFByb21pc2U8RW50ZXJwcmlzZUF1dGhSZXN1bHQ+IHtcbiAgcmV0dXJuIGdldEVudGVycHJpc2VBdXRoQ29udGV4dChyZXF1ZXN0LCB7IHNlY3VyaXR5TGV2ZWw6ICdtZWRpdW0nIH0pO1xufVxuXG4vKipcbiAqIEF1dGVudGljYWNpw7NuIGLDoXNpY2EgcGFyYSBvcGVyYWNpb25lcyBww7pibGljYXMgY29uIHJhdGUgbGltaXRpbmdcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlcXVpcmVCYXNpY0F1dGgoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3Rcbik6IFByb21pc2U8RW50ZXJwcmlzZUF1dGhSZXN1bHQ+IHtcbiAgcmV0dXJuIGdldEVudGVycHJpc2VBdXRoQ29udGV4dChyZXF1ZXN0LCB7IHNlY3VyaXR5TGV2ZWw6ICdsb3cnIH0pO1xufVxuXG4vKipcbiAqIEF1dGVudGljYWNpw7NuIGVzcGVjw61maWNhIHBhcmEgYWRtaW4gY29uIHBlcm1pc29zIHBlcnNvbmFsaXphZG9zXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXF1aXJlQWRtaW5BdXRoKFxuICByZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0LFxuICByZXF1aXJlZFBlcm1pc3Npb25zOiBzdHJpbmdbXSA9IFsnYWRtaW5fYWNjZXNzJ11cbik6IFByb21pc2U8RW50ZXJwcmlzZUF1dGhSZXN1bHQ+IHtcbiAgcmV0dXJuIGdldEVudGVycHJpc2VBdXRoQ29udGV4dChyZXF1ZXN0LCB7XG4gICAgcmVxdWlyZWRSb2xlOiAnYWRtaW4nLFxuICAgIHJlcXVpcmVkUGVybWlzc2lvbnMsXG4gICAgc2VjdXJpdHlMZXZlbDogJ2NyaXRpY2FsJyxcbiAgICBlbmFibGVSYXRlTGltaXQ6IHRydWUsXG4gICAgZW5hYmxlQ1NSRlByb3RlY3Rpb246IHRydWUsXG4gICAgZW5hYmxlSldUVmFsaWRhdGlvbjogdHJ1ZSxcbiAgICByYXRlTGltaXRUeXBlOiAnYWRtaW4nXG4gIH0pO1xufVxuXG4vKipcbiAqIEF1dGVudGljYWNpw7NuIHBhcmEgQVBJcyBkZSBwYWdvcyBjb24gbcOheGltYSBzZWd1cmlkYWRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlcXVpcmVQYXltZW50QXV0aChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdFxuKTogUHJvbWlzZTxFbnRlcnByaXNlQXV0aFJlc3VsdD4ge1xuICByZXR1cm4gZ2V0RW50ZXJwcmlzZUF1dGhDb250ZXh0KHJlcXVlc3QsIHtcbiAgICBzZWN1cml0eUxldmVsOiAnY3JpdGljYWwnLFxuICAgIGVuYWJsZVJhdGVMaW1pdDogdHJ1ZSxcbiAgICBlbmFibGVDU1JGUHJvdGVjdGlvbjogdHJ1ZSxcbiAgICBlbmFibGVKV1RWYWxpZGF0aW9uOiB0cnVlLFxuICAgIHJhdGVMaW1pdFR5cGU6ICdwYXltZW50cycsXG4gICAgcmVxdWlyZWRQZXJtaXNzaW9uczogWydwYXltZW50X2FjY2VzcyddXG4gIH0pO1xufVxuXG4vKipcbiAqIE1pZGRsZXdhcmUgZW50ZXJwcmlzZSBxdWUgbWFuZWphIGF1dG9tw6F0aWNhbWVudGUgZXJyb3Jlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gd2l0aEVudGVycHJpc2VBdXRoKFxuICBhdXRoRnVuY3Rpb246IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0KSA9PiBQcm9taXNlPEVudGVycHJpc2VBdXRoUmVzdWx0PlxuKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoaGFuZGxlcjogRnVuY3Rpb24pIHtcbiAgICByZXR1cm4gYXN5bmMgKHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QsIC4uLmFyZ3M6IGFueVtdKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgYXV0aEZ1bmN0aW9uKHJlcXVlc3QpO1xuXG4gICAgICAgIGlmICghYXV0aFJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgY29uc3QgZXJyb3JSZXNwb25zZSA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IGF1dGhSZXN1bHQuZXJyb3IsXG4gICAgICAgICAgICBjb2RlOiBhdXRoUmVzdWx0LmNvZGUsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIGVudGVycHJpc2U6IHRydWVcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY29uc3QgaGVhZGVyczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgaWYgKGF1dGhSZXN1bHQucmV0cnlBZnRlcikge1xuICAgICAgICAgICAgaGVhZGVyc1snUmV0cnktQWZ0ZXInXSA9IGF1dGhSZXN1bHQucmV0cnlBZnRlci50b1N0cmluZygpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICgncXVlcnknIGluIHJlcXVlc3QpIHtcbiAgICAgICAgICAgIC8vIFBhZ2VzIFJvdXRlclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXJnc1swXSBhcyBhbnk7XG4gICAgICAgICAgICBPYmplY3QuZW50cmllcyhoZWFkZXJzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcihrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoYXV0aFJlc3VsdC5zdGF0dXMgfHwgNDAxKS5qc29uKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBBcHAgUm91dGVyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KGVycm9yUmVzcG9uc2UpLCB7XG4gICAgICAgICAgICAgIHN0YXR1czogYXV0aFJlc3VsdC5zdGF0dXMgfHwgNDAxLFxuICAgICAgICAgICAgICBoZWFkZXJzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBw7FhZGlyIGNvbnRleHRvIGVudGVycHJpc2UgYWwgcmVxdWVzdFxuICAgICAgICAocmVxdWVzdCBhcyBhbnkpLmVudGVycHJpc2VBdXRoID0gYXV0aFJlc3VsdC5jb250ZXh0O1xuXG4gICAgICAgIHJldHVybiBoYW5kbGVyKHJlcXVlc3QsIC4uLmFyZ3MpO1xuXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbRU5URVJQUklTRV9BVVRIXSBFcnJvciBlbiBtaWRkbGV3YXJlOicsIGVycm9yKTtcblxuICAgICAgICBjb25zdCBlcnJvclJlc3BvbnNlID0ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnRXJyb3IgaW50ZXJubyBkZSBhdXRlbnRpY2FjacOzbiBlbnRlcnByaXNlJyxcbiAgICAgICAgICBjb2RlOiAnRU5URVJQUklTRV9BVVRIX0VSUk9SJyxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICgncXVlcnknIGluIHJlcXVlc3QpIHtcbiAgICAgICAgICAvLyBQYWdlcyBSb3V0ZXJcbiAgICAgICAgICBjb25zdCByZXMgPSBhcmdzWzBdIGFzIGFueTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oZXJyb3JSZXNwb25zZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQXBwIFJvdXRlclxuICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoZXJyb3JSZXNwb25zZSksIHtcbiAgICAgICAgICAgIHN0YXR1czogNTAwLFxuICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gIH07XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNSURETEVXQVJFUyBQUkVERUZJTklET1MgRU5URVJQUklTRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBNaWRkbGV3YXJlIHBhcmEgb3BlcmFjaW9uZXMgY3LDrXRpY2FzXG4gKi9cbmV4cG9ydCBjb25zdCB3aXRoQ3JpdGljYWxBdXRoID0gKCkgPT4gd2l0aEVudGVycHJpc2VBdXRoKHJlcXVpcmVDcml0aWNhbEF1dGgpO1xuXG4vKipcbiAqIE1pZGRsZXdhcmUgcGFyYSBvcGVyYWNpb25lcyBkZSBhbHRvIG5pdmVsXG4gKi9cbmV4cG9ydCBjb25zdCB3aXRoSGlnaEF1dGggPSAocmVxdWlyZWRQZXJtaXNzaW9ucz86IHN0cmluZ1tdKSA9PlxuICB3aXRoRW50ZXJwcmlzZUF1dGgoKHJlcSkgPT4gcmVxdWlyZUhpZ2hBdXRoKHJlcSwgcmVxdWlyZWRQZXJtaXNzaW9ucykpO1xuXG4vKipcbiAqIE1pZGRsZXdhcmUgcGFyYSBvcGVyYWNpb25lcyBtb2RlcmFkYXNcbiAqL1xuZXhwb3J0IGNvbnN0IHdpdGhNZWRpdW1BdXRoID0gKCkgPT4gd2l0aEVudGVycHJpc2VBdXRoKHJlcXVpcmVNZWRpdW1BdXRoKTtcblxuLyoqXG4gKiBNaWRkbGV3YXJlIHBhcmEgb3BlcmFjaW9uZXMgYsOhc2ljYXNcbiAqL1xuZXhwb3J0IGNvbnN0IHdpdGhCYXNpY0F1dGggPSAoKSA9PiB3aXRoRW50ZXJwcmlzZUF1dGgocmVxdWlyZUJhc2ljQXV0aCk7XG5cbi8qKlxuICogTWlkZGxld2FyZSBwYXJhIGFkbWluXG4gKi9cbmV4cG9ydCBjb25zdCB3aXRoQWRtaW5BdXRoID0gKHJlcXVpcmVkUGVybWlzc2lvbnM/OiBzdHJpbmdbXSkgPT5cbiAgd2l0aEVudGVycHJpc2VBdXRoKChyZXEpID0+IHJlcXVpcmVBZG1pbkF1dGgocmVxLCByZXF1aXJlZFBlcm1pc3Npb25zKSk7XG5cbi8qKlxuICogTWlkZGxld2FyZSBwYXJhIHBhZ29zXG4gKi9cbmV4cG9ydCBjb25zdCB3aXRoUGF5bWVudEF1dGggPSAoKSA9PiB3aXRoRW50ZXJwcmlzZUF1dGgocmVxdWlyZVBheW1lbnRBdXRoKTtcbiJdLCJuYW1lcyI6WyJnZXRFbnRlcnByaXNlQXV0aENvbnRleHQiLCJyZXF1aXJlQWRtaW5BdXRoIiwicmVxdWlyZUJhc2ljQXV0aCIsInJlcXVpcmVDcml0aWNhbEF1dGgiLCJyZXF1aXJlSGlnaEF1dGgiLCJyZXF1aXJlTWVkaXVtQXV0aCIsInJlcXVpcmVQYXltZW50QXV0aCIsIndpdGhBZG1pbkF1dGgiLCJ3aXRoQmFzaWNBdXRoIiwid2l0aENyaXRpY2FsQXV0aCIsIndpdGhFbnRlcnByaXNlQXV0aCIsIndpdGhIaWdoQXV0aCIsIndpdGhNZWRpdW1BdXRoIiwid2l0aFBheW1lbnRBdXRoIiwiRU5URVJQUklTRV9DT05GSUdTIiwiY3JpdGljYWwiLCJyZXF1aXJlZFJvbGUiLCJzZWN1cml0eUxldmVsIiwiZW5hYmxlUmF0ZUxpbWl0IiwiZW5hYmxlQ1NSRlByb3RlY3Rpb24iLCJlbmFibGVKV1RWYWxpZGF0aW9uIiwicmF0ZUxpbWl0VHlwZSIsInJlcXVpcmVkUGVybWlzc2lvbnMiLCJoaWdoIiwibWVkaXVtIiwibG93IiwicmVxdWVzdCIsIm9wdGlvbnMiLCJzdGFydFRpbWUiLCJEYXRlIiwibm93IiwiY29uZmlnIiwicmF0ZUxpbWl0UmVzdWx0IiwiY2hlY2tSYXRlTGltaXQiLCJSQVRFX0xJTUlUX0NPTkZJR1MiLCJhbGxvd2VkIiwibG9nQXV0aEZhaWx1cmUiLCJlcnJvciIsInN1Y2Nlc3MiLCJjb2RlIiwic3RhdHVzIiwicmV0cnlBZnRlciIsImNzcmZWYWxpZCIsImNzcmZSZXN1bHQiLCJ2YWxpZGF0ZVJlcXVlc3RPcmlnaW4iLCJ2YWxpZCIsInVzZXJJZCIsInNlc3Npb25JZCIsInVzZXJFbWFpbCIsInNlc3Npb24iLCJhdXRoIiwidXNlciIsImlkIiwiZW1haWwiLCJqd3RWYWxpZCIsImp3dFJlc3VsdCIsInZhbGlkYXRlSldUSW50ZWdyaXR5IiwicGVybWlzc2lvblJlc3VsdCIsInZhbGlkYXRlSldUUGVybWlzc2lvbnMiLCJsb2dQZXJtaXNzaW9uRGVuaWVkIiwiZGF0YSIsInVzZXJQcm9maWxlIiwidXNlckVycm9yIiwic3VwYWJhc2VBZG1pbiIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsImNvbnNvbGUiLCJ1c2VyUm9sZSIsInJvbGUiLCJ1c2VyUGVybWlzc2lvbnMiLCJwZXJtaXNzaW9ucyIsImxlbmd0aCIsImhhc0FsbFBlcm1pc3Npb25zIiwiZXZlcnkiLCJwZXJtaXNzaW9uIiwiaW5jbHVkZXMiLCJqb2luIiwiaXBBZGRyZXNzIiwiZ2V0Q2xpZW50SVAiLCJ1c2VyQWdlbnQiLCJnZXRIZWFkZXIiLCJjb250ZXh0Iiwic2Vzc2lvblZhbGlkIiwic2Vzc2lvbk1ldGFkYXRhIiwibWV0YWRhdGEiLCJzdXBhYmFzZSIsInZhbGlkYXRpb25zIiwicmF0ZUxpbWl0UGFzc2VkIiwib3JpZ2luVmFsaWQiLCJsb2dBdXRoU3VjY2VzcyIsImlwX2FkZHJlc3MiLCJ1c2VyX2FnZW50Iiwic2Vzc2lvbl9pZCIsInNlY3VyaXR5X2xldmVsIiwiZHVyYXRpb24iLCJsb2ciLCJtZXNzYWdlIiwiaXAiLCJmb3J3YXJkZWQiLCJyZWFsSVAiLCJjZklQIiwic3BsaXQiLCJoZWFkZXJOYW1lIiwiaGVhZGVycyIsImdldCIsImhlYWRlciIsIkFycmF5IiwiaXNBcnJheSIsImF1dGhGdW5jdGlvbiIsImhhbmRsZXIiLCJhcmdzIiwiYXV0aFJlc3VsdCIsImVycm9yUmVzcG9uc2UiLCJ0aW1lc3RhbXAiLCJ0b0lTT1N0cmluZyIsImVudGVycHJpc2UiLCJ0b1N0cmluZyIsInJlcyIsIk9iamVjdCIsImVudHJpZXMiLCJmb3JFYWNoIiwia2V5IiwidmFsdWUiLCJzZXRIZWFkZXIiLCJqc29uIiwiUmVzcG9uc2UiLCJKU09OIiwic3RyaW5naWZ5IiwiZW50ZXJwcmlzZUF1dGgiLCJyZXEiXSwibWFwcGluZ3MiOiJBQUFBOzs7Q0FHQzs7Ozs7Ozs7Ozs7UUFvSHFCQTtlQUFBQTs7UUF3VUFDO2VBQUFBOztRQVRBQztlQUFBQTs7UUEvQkFDO2VBQUFBOztRQVNBQztlQUFBQTs7UUFhQUM7ZUFBQUE7O1FBb0NBQztlQUFBQTs7UUFvSFRDO2VBQUFBOztRQUxBQztlQUFBQTs7UUFoQkFDO2VBQUFBOztRQS9FR0M7ZUFBQUE7O1FBb0ZIQztlQUFBQTs7UUFNQUM7ZUFBQUE7O1FBZ0JBQztlQUFBQTs7O3NCQXBrQlE7MEJBQ1M7K0JBQytCO2dDQUN2Qjs4QkFDYTsrQkFDaUI7QUFzRHBFLHdEQUF3RDtBQUN4RCw2QkFBNkI7QUFDN0Isd0RBQXdE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