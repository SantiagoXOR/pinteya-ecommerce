0b932db89ef77d7f01b93a49b4297084
// ===================================
// PINTEYA E-COMMERCE - MERCADOPAGO REFUNDS API
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get GET () {
        return GET;
    },
    get POST () {
        return POST;
    }
});
const _server = require("next/server");
const _auth = require("../../../../auth");
const _supabase = require("../../../../lib/supabase");
const _logger = require("../../../../lib/logger");
const _ratelimiter = require("../../../../lib/rate-limiter");
const _metrics = require("../../../../lib/metrics");
const _mercadopago = require("../../../../lib/mercadopago");
const _mercadopago1 = require("mercadopago");
async function POST(request) {
    const startTime = Date.now();
    const clientIP = request.headers.get('x-forwarded-for') || 'unknown';
    const userAgent = request.headers.get('user-agent') || 'unknown';
    try {
        // Verificar autenticación
        const session = await (0, _auth.auth)();
        if (!session?.user) {
            return _server.NextResponse.json({
                success: false,
                error: 'No autorizado'
            }, {
                status: 401
            });
        }
        // Rate limiting
        const rateLimitResult = await (0, _ratelimiter.checkRateLimit)(request, _ratelimiter.RATE_LIMIT_CONFIGS.PAYMENT_API);
        if (!rateLimitResult.success) {
            _logger.logger.warn(_logger.LogCategory.API, 'Rate limit exceeded for refunds', {
                clientIP,
                userId
            });
            const response = _server.NextResponse.json({
                success: false,
                error: 'Demasiadas solicitudes'
            }, {
                status: 429
            });
            (0, _ratelimiter.addRateLimitHeaders)(response, rateLimitResult, _ratelimiter.RATE_LIMIT_CONFIGS.PAYMENT_API);
            return response;
        }
        const body = await request.json();
        const { payment_id, amount, reason, metadata } = body;
        // Validar datos requeridos
        if (!payment_id) {
            return _server.NextResponse.json({
                success: false,
                error: 'payment_id es requerido'
            }, {
                status: 400
            });
        }
        _logger.logger.info(_logger.LogCategory.PAYMENT, 'Refund request started', {
            userId,
            payment_id,
            amount,
            reason,
            clientIP
        });
        // Verificar que el pago existe y pertenece al usuario
        const supabase = (0, _supabase.getSupabaseClient)();
        if (!supabase) {
            return _server.NextResponse.json({
                success: false,
                error: 'Error de configuración de base de datos'
            }, {
                status: 500
            });
        }
        const { data: order, error: orderError } = await supabase.from('orders').select('id, total_amount, payment_status, external_reference').eq('external_reference', payment_id).single();
        if (orderError || !order) {
            return _server.NextResponse.json({
                success: false,
                error: 'Pago no encontrado'
            }, {
                status: 404
            });
        }
        if (order.payment_status !== 'approved') {
            return _server.NextResponse.json({
                success: false,
                error: 'Solo se pueden reembolsar pagos aprobados'
            }, {
                status: 400
            });
        }
        // Validar monto del reembolso
        const refundAmount = amount || order.total_amount;
        if (refundAmount > order.total_amount) {
            return _server.NextResponse.json({
                success: false,
                error: 'El monto del reembolso no puede ser mayor al pago original'
            }, {
                status: 400
            });
        }
        // Procesar reembolso con MercadoPago
        const refundResult = await processRefund(payment_id, refundAmount, reason, metadata);
        // Actualizar estado en base de datos
        await supabase.from('orders').update({
            payment_status: refundResult.status === 'approved' ? 'refunded' : 'refund_pending',
            updated_at: new Date().toISOString()
        }).eq('id', order.id);
        // Registrar reembolso en tabla de refunds (si existe)
        try {
            await supabase.from('refunds').insert({
                order_id: order.id,
                payment_id,
                refund_id: refundResult.id,
                amount: refundAmount,
                status: refundResult.status,
                reason: reason || 'Reembolso solicitado por el cliente',
                metadata: metadata || {},
                created_at: new Date().toISOString()
            });
        } catch (refundInsertError) {
            // Si la tabla refunds no existe, solo loggeamos el warning
            _logger.logger.warn(_logger.LogCategory.PAYMENT, 'Refunds table not found, skipping insert', {
                payment_id,
                refund_id: refundResult.id
            });
        }
        // Registrar métricas
        await _metrics.metricsCollector.recordRequest('/api/payments/refunds', 'POST', 200, Date.now() - startTime, {
            userId,
            payment_id,
            amount: refundAmount
        });
        _logger.logger.info(_logger.LogCategory.PAYMENT, 'Refund processed successfully', {
            userId,
            payment_id,
            refund_id: refundResult.id,
            amount: refundAmount,
            status: refundResult.status,
            processingTime: Date.now() - startTime
        });
        const response = _server.NextResponse.json({
            success: true,
            data: refundResult,
            timestamp: Date.now(),
            processing_time: Date.now() - startTime
        });
        (0, _ratelimiter.addRateLimitHeaders)(response, rateLimitResult, _ratelimiter.RATE_LIMIT_CONFIGS.PAYMENT_API);
        return response;
    } catch (error) {
        const processingTime = Date.now() - startTime;
        _logger.logger.performance(_logger.LogLevel.ERROR, 'Refund processing failed', {
            operation: 'refund-processing-api',
            duration: processingTime,
            statusCode: 500
        }, {
            clientIP,
            userAgent
        });
        await _metrics.metricsCollector.recordRequest('/api/payments/refunds', 'POST', 500, processingTime, {
            error: error.message
        });
        return _server.NextResponse.json({
            success: false,
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}
async function GET(request) {
    const startTime = Date.now();
    const clientIP = request.headers.get('x-forwarded-for') || 'unknown';
    try {
        // Verificar autenticación
        const session = await (0, _auth.auth)();
        if (!session?.user) {
            return _server.NextResponse.json({
                success: false,
                error: 'No autorizado'
            }, {
                status: 401
            });
        }
        // Rate limiting
        const rateLimitResult = await (0, _ratelimiter.checkRateLimit)(request, _ratelimiter.RATE_LIMIT_CONFIGS.QUERY_API);
        if (!rateLimitResult.success) {
            const response = _server.NextResponse.json({
                success: false,
                error: 'Demasiadas solicitudes'
            }, {
                status: 429
            });
            (0, _ratelimiter.addRateLimitHeaders)(response, rateLimitResult, _ratelimiter.RATE_LIMIT_CONFIGS.QUERY_API);
            return response;
        }
        // Obtener parámetros de consulta
        const url = new URL(request.url);
        const limit = parseInt(url.searchParams.get('limit') || '10');
        const offset = parseInt(url.searchParams.get('offset') || '0');
        const status = url.searchParams.get('status');
        const supabase = (0, _supabase.getSupabaseClient)();
        if (!supabase) {
            return _server.NextResponse.json({
                success: false,
                error: 'Error de configuración de base de datos'
            }, {
                status: 500
            });
        }
        // Construir query
        let query = supabase.from('refunds').select(`
        *,
        orders (
          id,
          total_amount,
          created_at
        )
      `).order('created_at', {
            ascending: false
        }).range(offset, offset + limit - 1);
        if (status) {
            query = query.eq('status', status);
        }
        const { data: refunds, error } = await query;
        if (error) {
            throw new Error(`Error al obtener reembolsos: ${error.message}`);
        }
        // Registrar métricas
        await _metrics.metricsCollector.recordRequest('/api/payments/refunds', 'GET', 200, Date.now() - startTime, {
            userId,
            count: (refunds?.length || 0).toString()
        });
        _logger.logger.info(_logger.LogCategory.API, 'Refunds list retrieved', {
            userId,
            count: refunds?.length || 0,
            processingTime: Date.now() - startTime
        });
        const response = _server.NextResponse.json({
            success: true,
            data: refunds || [],
            pagination: {
                limit,
                offset,
                total: refunds?.length || 0
            },
            timestamp: Date.now(),
            processing_time: Date.now() - startTime
        });
        (0, _ratelimiter.addRateLimitHeaders)(response, rateLimitResult, _ratelimiter.RATE_LIMIT_CONFIGS.QUERY_API);
        return response;
    } catch (error) {
        const processingTime = Date.now() - startTime;
        _logger.logger.performance(_logger.LogLevel.ERROR, 'Refunds list failed', {
            operation: 'refunds-list-api',
            duration: processingTime,
            statusCode: 500
        }, {
            clientIP
        });
        return _server.NextResponse.json({
            success: false,
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}
/**
 * Procesa reembolso con MercadoPago
 */ async function processRefund(paymentId, amount, reason, metadata) {
    try {
        // Crear cliente de MercadoPago
        const client = (0, _mercadopago.createMercadoPagoClient)();
        const payment = new _mercadopago1.Payment(client);
        // En una implementación real, aquí se haría la llamada a la API de MercadoPago
        // Por ahora simulamos el reembolso
        const refundId = `refund_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        // Simular respuesta de MercadoPago
        const refundResponse = {
            id: refundId,
            payment_id: paymentId,
            amount,
            status: 'approved',
            reason: reason || 'Reembolso solicitado',
            created_at: new Date().toISOString(),
            metadata: metadata || {}
        };
        _logger.logger.info(_logger.LogCategory.PAYMENT, 'MercadoPago refund simulated', {
            payment_id: paymentId,
            refund_id: refundId,
            amount,
            status: refundResponse.status
        });
        return refundResponse;
    } catch (error) {
        _logger.logger.error(_logger.LogCategory.PAYMENT, 'MercadoPago refund failed', error);
        // En caso de error, devolver estado pendiente
        return {
            id: `refund_error_${Date.now()}`,
            payment_id: paymentId,
            amount,
            status: 'pending',
            reason: 'Error al procesar reembolso, se procesará manualmente',
            created_at: new Date().toISOString(),
            metadata: metadata || {}
        };
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXHBheW1lbnRzXFxyZWZ1bmRzXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQSU5URVlBIEUtQ09NTUVSQ0UgLSBNRVJDQURPUEFHTyBSRUZVTkRTIEFQSVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcclxuaW1wb3J0IHsgYXV0aCB9IGZyb20gJ0AvYXV0aCc7XHJcbmltcG9ydCB7IGdldFN1cGFiYXNlQ2xpZW50IH0gZnJvbSAnQC9saWIvc3VwYWJhc2UnO1xyXG5pbXBvcnQgeyBsb2dnZXIsIExvZ0xldmVsLCBMb2dDYXRlZ29yeSB9IGZyb20gJ0AvbGliL2xvZ2dlcic7XHJcbmltcG9ydCB7IGNoZWNrUmF0ZUxpbWl0LCBhZGRSYXRlTGltaXRIZWFkZXJzLCBSQVRFX0xJTUlUX0NPTkZJR1MgfSBmcm9tICdAL2xpYi9yYXRlLWxpbWl0ZXInO1xyXG5pbXBvcnQgeyBtZXRyaWNzQ29sbGVjdG9yIH0gZnJvbSAnQC9saWIvbWV0cmljcyc7XHJcbmltcG9ydCB7IGNyZWF0ZU1lcmNhZG9QYWdvQ2xpZW50IH0gZnJvbSAnQC9saWIvbWVyY2Fkb3BhZ28nO1xyXG5pbXBvcnQgeyBQYXltZW50IH0gZnJvbSAnbWVyY2Fkb3BhZ28nO1xyXG5cclxuaW50ZXJmYWNlIFJlZnVuZFJlcXVlc3Qge1xyXG4gIHBheW1lbnRfaWQ6IHN0cmluZztcclxuICBhbW91bnQ/OiBudW1iZXI7XHJcbiAgcmVhc29uPzogc3RyaW5nO1xyXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PjtcclxufVxyXG5cclxuaW50ZXJmYWNlIFJlZnVuZFJlc3BvbnNlIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHBheW1lbnRfaWQ6IHN0cmluZztcclxuICBhbW91bnQ6IG51bWJlcjtcclxuICBzdGF0dXM6ICdwZW5kaW5nJyB8ICdhcHByb3ZlZCcgfCAncmVqZWN0ZWQnO1xyXG4gIHJlYXNvbj86IHN0cmluZztcclxuICBjcmVhdGVkX2F0OiBzdHJpbmc7XHJcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG59XHJcblxyXG4vKipcclxuICogUE9TVCAvYXBpL3BheW1lbnRzL3JlZnVuZHNcclxuICogUHJvY2VzYSByZWVtYm9sc29zIHNlZ8O6biBkb2N1bWVudGFjacOzbiBvZmljaWFsIGRlIE1lcmNhZG9QYWdvXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgY29uc3QgY2xpZW50SVAgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKSB8fCAndW5rbm93bic7XHJcbiAgY29uc3QgdXNlckFnZW50ID0gcmVxdWVzdC5oZWFkZXJzLmdldCgndXNlci1hZ2VudCcpIHx8ICd1bmtub3duJztcclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIFZlcmlmaWNhciBhdXRlbnRpY2FjacOzblxyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGgoKTtcclxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyBhdXRvcml6YWRvJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJhdGUgbGltaXRpbmdcclxuICAgIGNvbnN0IHJhdGVMaW1pdFJlc3VsdCA9IGF3YWl0IGNoZWNrUmF0ZUxpbWl0KFxyXG4gICAgICByZXF1ZXN0LFxyXG4gICAgICBSQVRFX0xJTUlUX0NPTkZJR1MuUEFZTUVOVF9BUElcclxuICAgICk7XHJcblxyXG4gICAgaWYgKCFyYXRlTGltaXRSZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICBsb2dnZXIud2FybihMb2dDYXRlZ29yeS5BUEksICdSYXRlIGxpbWl0IGV4Y2VlZGVkIGZvciByZWZ1bmRzJywge1xyXG4gICAgICAgIGNsaWVudElQLFxyXG4gICAgICAgIHVzZXJJZCxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRGVtYXNpYWRhcyBzb2xpY2l0dWRlcycgfSxcclxuICAgICAgICB7IHN0YXR1czogNDI5IH1cclxuICAgICAgKTtcclxuICAgICAgYWRkUmF0ZUxpbWl0SGVhZGVycyhyZXNwb25zZSwgcmF0ZUxpbWl0UmVzdWx0LCBSQVRFX0xJTUlUX0NPTkZJR1MuUEFZTUVOVF9BUEkpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYm9keTogUmVmdW5kUmVxdWVzdCA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG4gICAgY29uc3QgeyBwYXltZW50X2lkLCBhbW91bnQsIHJlYXNvbiwgbWV0YWRhdGEgfSA9IGJvZHk7XHJcblxyXG4gICAgLy8gVmFsaWRhciBkYXRvcyByZXF1ZXJpZG9zXHJcbiAgICBpZiAoIXBheW1lbnRfaWQpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAncGF5bWVudF9pZCBlcyByZXF1ZXJpZG8nIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgbG9nZ2VyLmluZm8oTG9nQ2F0ZWdvcnkuUEFZTUVOVCwgJ1JlZnVuZCByZXF1ZXN0IHN0YXJ0ZWQnLCB7XHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgcGF5bWVudF9pZCxcclxuICAgICAgYW1vdW50LFxyXG4gICAgICByZWFzb24sXHJcbiAgICAgIGNsaWVudElQLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gVmVyaWZpY2FyIHF1ZSBlbCBwYWdvIGV4aXN0ZSB5IHBlcnRlbmVjZSBhbCB1c3VhcmlvXHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XHJcbiAgICBpZiAoIXN1cGFiYXNlKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0Vycm9yIGRlIGNvbmZpZ3VyYWNpw7NuIGRlIGJhc2UgZGUgZGF0b3MnIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBvcmRlciwgZXJyb3I6IG9yZGVyRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdvcmRlcnMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgdG90YWxfYW1vdW50LCBwYXltZW50X3N0YXR1cywgZXh0ZXJuYWxfcmVmZXJlbmNlJylcclxuICAgICAgLmVxKCdleHRlcm5hbF9yZWZlcmVuY2UnLCBwYXltZW50X2lkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKG9yZGVyRXJyb3IgfHwgIW9yZGVyKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1BhZ28gbm8gZW5jb250cmFkbycgfSxcclxuICAgICAgICB7IHN0YXR1czogNDA0IH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3JkZXIucGF5bWVudF9zdGF0dXMgIT09ICdhcHByb3ZlZCcpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnU29sbyBzZSBwdWVkZW4gcmVlbWJvbHNhciBwYWdvcyBhcHJvYmFkb3MnIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhciBtb250byBkZWwgcmVlbWJvbHNvXHJcbiAgICBjb25zdCByZWZ1bmRBbW91bnQgPSBhbW91bnQgfHwgb3JkZXIudG90YWxfYW1vdW50O1xyXG4gICAgaWYgKHJlZnVuZEFtb3VudCA+IG9yZGVyLnRvdGFsX2Ftb3VudCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbCBtb250byBkZWwgcmVlbWJvbHNvIG5vIHB1ZWRlIHNlciBtYXlvciBhbCBwYWdvIG9yaWdpbmFsJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFByb2Nlc2FyIHJlZW1ib2xzbyBjb24gTWVyY2Fkb1BhZ29cclxuICAgIGNvbnN0IHJlZnVuZFJlc3VsdCA9IGF3YWl0IHByb2Nlc3NSZWZ1bmQocGF5bWVudF9pZCwgcmVmdW5kQW1vdW50LCByZWFzb24sIG1ldGFkYXRhKTtcclxuXHJcbiAgICAvLyBBY3R1YWxpemFyIGVzdGFkbyBlbiBiYXNlIGRlIGRhdG9zXHJcbiAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnb3JkZXJzJylcclxuICAgICAgLnVwZGF0ZSh7IFxyXG4gICAgICAgIHBheW1lbnRfc3RhdHVzOiByZWZ1bmRSZXN1bHQuc3RhdHVzID09PSAnYXBwcm92ZWQnID8gJ3JlZnVuZGVkJyA6ICdyZWZ1bmRfcGVuZGluZycsXHJcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0pXHJcbiAgICAgIC5lcSgnaWQnLCBvcmRlci5pZCk7XHJcblxyXG4gICAgLy8gUmVnaXN0cmFyIHJlZW1ib2xzbyBlbiB0YWJsYSBkZSByZWZ1bmRzIChzaSBleGlzdGUpXHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdyZWZ1bmRzJylcclxuICAgICAgICAuaW5zZXJ0KHtcclxuICAgICAgICAgIG9yZGVyX2lkOiBvcmRlci5pZCxcclxuICAgICAgICAgIHBheW1lbnRfaWQsXHJcbiAgICAgICAgICByZWZ1bmRfaWQ6IHJlZnVuZFJlc3VsdC5pZCxcclxuICAgICAgICAgIGFtb3VudDogcmVmdW5kQW1vdW50LFxyXG4gICAgICAgICAgc3RhdHVzOiByZWZ1bmRSZXN1bHQuc3RhdHVzLFxyXG4gICAgICAgICAgcmVhc29uOiByZWFzb24gfHwgJ1JlZW1ib2xzbyBzb2xpY2l0YWRvIHBvciBlbCBjbGllbnRlJyxcclxuICAgICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSB8fCB7fSxcclxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKHJlZnVuZEluc2VydEVycm9yKSB7XHJcbiAgICAgIC8vIFNpIGxhIHRhYmxhIHJlZnVuZHMgbm8gZXhpc3RlLCBzb2xvIGxvZ2dlYW1vcyBlbCB3YXJuaW5nXHJcbiAgICAgIGxvZ2dlci53YXJuKExvZ0NhdGVnb3J5LlBBWU1FTlQsICdSZWZ1bmRzIHRhYmxlIG5vdCBmb3VuZCwgc2tpcHBpbmcgaW5zZXJ0Jywge1xyXG4gICAgICAgIHBheW1lbnRfaWQsXHJcbiAgICAgICAgcmVmdW5kX2lkOiByZWZ1bmRSZXN1bHQuaWQsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlZ2lzdHJhciBtw6l0cmljYXNcclxuICAgIGF3YWl0IG1ldHJpY3NDb2xsZWN0b3IucmVjb3JkUmVxdWVzdChcclxuICAgICAgJy9hcGkvcGF5bWVudHMvcmVmdW5kcycsXHJcbiAgICAgICdQT1NUJyxcclxuICAgICAgMjAwLFxyXG4gICAgICBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxyXG4gICAgICB7IHVzZXJJZCwgcGF5bWVudF9pZCwgYW1vdW50OiByZWZ1bmRBbW91bnQgfVxyXG4gICAgKTtcclxuXHJcbiAgICBsb2dnZXIuaW5mbyhMb2dDYXRlZ29yeS5QQVlNRU5ULCAnUmVmdW5kIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHknLCB7XHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgcGF5bWVudF9pZCxcclxuICAgICAgcmVmdW5kX2lkOiByZWZ1bmRSZXN1bHQuaWQsXHJcbiAgICAgIGFtb3VudDogcmVmdW5kQW1vdW50LFxyXG4gICAgICBzdGF0dXM6IHJlZnVuZFJlc3VsdC5zdGF0dXMsXHJcbiAgICAgIHByb2Nlc3NpbmdUaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIGRhdGE6IHJlZnVuZFJlc3VsdCxcclxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxyXG4gICAgICBwcm9jZXNzaW5nX3RpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXHJcbiAgICB9KTtcclxuXHJcbiAgICBhZGRSYXRlTGltaXRIZWFkZXJzKHJlc3BvbnNlLCByYXRlTGltaXRSZXN1bHQsIFJBVEVfTElNSVRfQ09ORklHUy5QQVlNRU5UX0FQSSk7XHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zdCBwcm9jZXNzaW5nVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XHJcbiAgICBcclxuICAgIGxvZ2dlci5wZXJmb3JtYW5jZShMb2dMZXZlbC5FUlJPUiwgJ1JlZnVuZCBwcm9jZXNzaW5nIGZhaWxlZCcsIHtcclxuICAgICAgb3BlcmF0aW9uOiAncmVmdW5kLXByb2Nlc3NpbmctYXBpJyxcclxuICAgICAgZHVyYXRpb246IHByb2Nlc3NpbmdUaW1lLFxyXG4gICAgICBzdGF0dXNDb2RlOiA1MDAsXHJcbiAgICB9LCB7XHJcbiAgICAgIGNsaWVudElQLFxyXG4gICAgICB1c2VyQWdlbnQsXHJcbiAgICB9KTtcclxuXHJcbiAgICBhd2FpdCBtZXRyaWNzQ29sbGVjdG9yLnJlY29yZFJlcXVlc3QoXHJcbiAgICAgICcvYXBpL3BheW1lbnRzL3JlZnVuZHMnLFxyXG4gICAgICAnUE9TVCcsXHJcbiAgICAgIDUwMCxcclxuICAgICAgcHJvY2Vzc2luZ1RpbWUsXHJcbiAgICAgIHsgZXJyb3I6IChlcnJvciBhcyBFcnJvcikubWVzc2FnZSB9XHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEdFVCAvYXBpL3BheW1lbnRzL3JlZnVuZHNcclxuICogTGlzdGEgcmVlbWJvbHNvcyBkZWwgdXN1YXJpb1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgY29uc3QgY2xpZW50SVAgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKSB8fCAndW5rbm93bic7XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBWZXJpZmljYXIgYXV0ZW50aWNhY2nDs25cclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKCk7XHJcbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gYXV0b3JpemFkbycgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSYXRlIGxpbWl0aW5nXHJcbiAgICBjb25zdCByYXRlTGltaXRSZXN1bHQgPSBhd2FpdCBjaGVja1JhdGVMaW1pdChcclxuICAgICAgcmVxdWVzdCxcclxuICAgICAgUkFURV9MSU1JVF9DT05GSUdTLlFVRVJZX0FQSVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoIXJhdGVMaW1pdFJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdEZW1hc2lhZGFzIHNvbGljaXR1ZGVzJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MjkgfVxyXG4gICAgICApO1xyXG4gICAgICBhZGRSYXRlTGltaXRIZWFkZXJzKHJlc3BvbnNlLCByYXRlTGltaXRSZXN1bHQsIFJBVEVfTElNSVRfQ09ORklHUy5RVUVSWV9BUEkpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT2J0ZW5lciBwYXLDoW1ldHJvcyBkZSBjb25zdWx0YVxyXG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XHJcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdsaW1pdCcpIHx8ICcxMCcpO1xyXG4gICAgY29uc3Qgb2Zmc2V0ID0gcGFyc2VJbnQodXJsLnNlYXJjaFBhcmFtcy5nZXQoJ29mZnNldCcpIHx8ICcwJyk7XHJcbiAgICBjb25zdCBzdGF0dXMgPSB1cmwuc2VhcmNoUGFyYW1zLmdldCgnc3RhdHVzJyk7XHJcblxyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZUNsaWVudCgpO1xyXG4gICAgaWYgKCFzdXBhYmFzZSkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFcnJvciBkZSBjb25maWd1cmFjacOzbiBkZSBiYXNlIGRlIGRhdG9zJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENvbnN0cnVpciBxdWVyeVxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3JlZnVuZHMnKVxyXG4gICAgICAuc2VsZWN0KGBcclxuICAgICAgICAqLFxyXG4gICAgICAgIG9yZGVycyAoXHJcbiAgICAgICAgICBpZCxcclxuICAgICAgICAgIHRvdGFsX2Ftb3VudCxcclxuICAgICAgICAgIGNyZWF0ZWRfYXRcclxuICAgICAgICApXHJcbiAgICAgIGApXHJcbiAgICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAucmFuZ2Uob2Zmc2V0LCBvZmZzZXQgKyBsaW1pdCAtIDEpO1xyXG5cclxuICAgIGlmIChzdGF0dXMpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc3RhdHVzJywgc3RhdHVzKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IHJlZnVuZHMsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBhbCBvYnRlbmVyIHJlZW1ib2xzb3M6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZWdpc3RyYXIgbcOpdHJpY2FzXHJcbiAgICBhd2FpdCBtZXRyaWNzQ29sbGVjdG9yLnJlY29yZFJlcXVlc3QoXHJcbiAgICAgICcvYXBpL3BheW1lbnRzL3JlZnVuZHMnLFxyXG4gICAgICAnR0VUJyxcclxuICAgICAgMjAwLFxyXG4gICAgICBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxyXG4gICAgICB7IHVzZXJJZCwgY291bnQ6IChyZWZ1bmRzPy5sZW5ndGggfHwgMCkudG9TdHJpbmcoKSB9XHJcbiAgICApO1xyXG5cclxuICAgIGxvZ2dlci5pbmZvKExvZ0NhdGVnb3J5LkFQSSwgJ1JlZnVuZHMgbGlzdCByZXRyaWV2ZWQnLCB7XHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgY291bnQ6IHJlZnVuZHM/Lmxlbmd0aCB8fCAwLFxyXG4gICAgICBwcm9jZXNzaW5nVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiByZWZ1bmRzIHx8IFtdLFxyXG4gICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgbGltaXQsXHJcbiAgICAgICAgb2Zmc2V0LFxyXG4gICAgICAgIHRvdGFsOiByZWZ1bmRzPy5sZW5ndGggfHwgMCxcclxuICAgICAgfSxcclxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxyXG4gICAgICBwcm9jZXNzaW5nX3RpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXHJcbiAgICB9KTtcclxuXHJcbiAgICBhZGRSYXRlTGltaXRIZWFkZXJzKHJlc3BvbnNlLCByYXRlTGltaXRSZXN1bHQsIFJBVEVfTElNSVRfQ09ORklHUy5RVUVSWV9BUEkpO1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc3QgcHJvY2Vzc2luZ1RpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG4gICAgXHJcbiAgICBsb2dnZXIucGVyZm9ybWFuY2UoTG9nTGV2ZWwuRVJST1IsICdSZWZ1bmRzIGxpc3QgZmFpbGVkJywge1xyXG4gICAgICBvcGVyYXRpb246ICdyZWZ1bmRzLWxpc3QtYXBpJyxcclxuICAgICAgZHVyYXRpb246IHByb2Nlc3NpbmdUaW1lLFxyXG4gICAgICBzdGF0dXNDb2RlOiA1MDAsXHJcbiAgICB9LCB7XHJcbiAgICAgIGNsaWVudElQLFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogUHJvY2VzYSByZWVtYm9sc28gY29uIE1lcmNhZG9QYWdvXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBwcm9jZXNzUmVmdW5kKFxyXG4gIHBheW1lbnRJZDogc3RyaW5nLFxyXG4gIGFtb3VudDogbnVtYmVyLFxyXG4gIHJlYXNvbj86IHN0cmluZyxcclxuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cclxuKTogUHJvbWlzZTxSZWZ1bmRSZXNwb25zZT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBDcmVhciBjbGllbnRlIGRlIE1lcmNhZG9QYWdvXHJcbiAgICBjb25zdCBjbGllbnQgPSBjcmVhdGVNZXJjYWRvUGFnb0NsaWVudCgpO1xyXG4gICAgY29uc3QgcGF5bWVudCA9IG5ldyBQYXltZW50KGNsaWVudCk7XHJcblxyXG4gICAgLy8gRW4gdW5hIGltcGxlbWVudGFjacOzbiByZWFsLCBhcXXDrSBzZSBoYXLDrWEgbGEgbGxhbWFkYSBhIGxhIEFQSSBkZSBNZXJjYWRvUGFnb1xyXG4gICAgLy8gUG9yIGFob3JhIHNpbXVsYW1vcyBlbCByZWVtYm9sc29cclxuICAgIGNvbnN0IHJlZnVuZElkID0gYHJlZnVuZF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XHJcbiAgICBcclxuICAgIC8vIFNpbXVsYXIgcmVzcHVlc3RhIGRlIE1lcmNhZG9QYWdvXHJcbiAgICBjb25zdCByZWZ1bmRSZXNwb25zZTogUmVmdW5kUmVzcG9uc2UgPSB7XHJcbiAgICAgIGlkOiByZWZ1bmRJZCxcclxuICAgICAgcGF5bWVudF9pZDogcGF5bWVudElkLFxyXG4gICAgICBhbW91bnQsXHJcbiAgICAgIHN0YXR1czogJ2FwcHJvdmVkJywgLy8gRW4gcHJvZHVjY2nDs24gZXN0byB2ZW5kcsOtYSBkZSBNZXJjYWRvUGFnb1xyXG4gICAgICByZWFzb246IHJlYXNvbiB8fCAnUmVlbWJvbHNvIHNvbGljaXRhZG8nLFxyXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSB8fCB7fSxcclxuICAgIH07XHJcblxyXG4gICAgbG9nZ2VyLmluZm8oTG9nQ2F0ZWdvcnkuUEFZTUVOVCwgJ01lcmNhZG9QYWdvIHJlZnVuZCBzaW11bGF0ZWQnLCB7XHJcbiAgICAgIHBheW1lbnRfaWQ6IHBheW1lbnRJZCxcclxuICAgICAgcmVmdW5kX2lkOiByZWZ1bmRJZCxcclxuICAgICAgYW1vdW50LFxyXG4gICAgICBzdGF0dXM6IHJlZnVuZFJlc3BvbnNlLnN0YXR1cyxcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiByZWZ1bmRSZXNwb25zZTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGxvZ2dlci5lcnJvcihMb2dDYXRlZ29yeS5QQVlNRU5ULCAnTWVyY2Fkb1BhZ28gcmVmdW5kIGZhaWxlZCcsIGVycm9yIGFzIEVycm9yKTtcclxuXHJcbiAgICAvLyBFbiBjYXNvIGRlIGVycm9yLCBkZXZvbHZlciBlc3RhZG8gcGVuZGllbnRlXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpZDogYHJlZnVuZF9lcnJvcl8ke0RhdGUubm93KCl9YCxcclxuICAgICAgcGF5bWVudF9pZDogcGF5bWVudElkLFxyXG4gICAgICBhbW91bnQsXHJcbiAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICByZWFzb246ICdFcnJvciBhbCBwcm9jZXNhciByZWVtYm9sc28sIHNlIHByb2Nlc2Fyw6EgbWFudWFsbWVudGUnLFxyXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSB8fCB7fSxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJHRVQiLCJQT1NUIiwicmVxdWVzdCIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJjbGllbnRJUCIsImhlYWRlcnMiLCJnZXQiLCJ1c2VyQWdlbnQiLCJzZXNzaW9uIiwiYXV0aCIsInVzZXIiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwic3RhdHVzIiwicmF0ZUxpbWl0UmVzdWx0IiwiY2hlY2tSYXRlTGltaXQiLCJSQVRFX0xJTUlUX0NPTkZJR1MiLCJQQVlNRU5UX0FQSSIsImxvZ2dlciIsIndhcm4iLCJMb2dDYXRlZ29yeSIsIkFQSSIsInVzZXJJZCIsInJlc3BvbnNlIiwiYWRkUmF0ZUxpbWl0SGVhZGVycyIsImJvZHkiLCJwYXltZW50X2lkIiwiYW1vdW50IiwicmVhc29uIiwibWV0YWRhdGEiLCJpbmZvIiwiUEFZTUVOVCIsInN1cGFiYXNlIiwiZ2V0U3VwYWJhc2VDbGllbnQiLCJkYXRhIiwib3JkZXIiLCJvcmRlckVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwicGF5bWVudF9zdGF0dXMiLCJyZWZ1bmRBbW91bnQiLCJ0b3RhbF9hbW91bnQiLCJyZWZ1bmRSZXN1bHQiLCJwcm9jZXNzUmVmdW5kIiwidXBkYXRlIiwidXBkYXRlZF9hdCIsInRvSVNPU3RyaW5nIiwiaWQiLCJpbnNlcnQiLCJvcmRlcl9pZCIsInJlZnVuZF9pZCIsImNyZWF0ZWRfYXQiLCJyZWZ1bmRJbnNlcnRFcnJvciIsIm1ldHJpY3NDb2xsZWN0b3IiLCJyZWNvcmRSZXF1ZXN0IiwicHJvY2Vzc2luZ1RpbWUiLCJ0aW1lc3RhbXAiLCJwcm9jZXNzaW5nX3RpbWUiLCJwZXJmb3JtYW5jZSIsIkxvZ0xldmVsIiwiRVJST1IiLCJvcGVyYXRpb24iLCJkdXJhdGlvbiIsInN0YXR1c0NvZGUiLCJtZXNzYWdlIiwiUVVFUllfQVBJIiwidXJsIiwiVVJMIiwibGltaXQiLCJwYXJzZUludCIsInNlYXJjaFBhcmFtcyIsIm9mZnNldCIsInF1ZXJ5IiwiYXNjZW5kaW5nIiwicmFuZ2UiLCJyZWZ1bmRzIiwiRXJyb3IiLCJjb3VudCIsImxlbmd0aCIsInRvU3RyaW5nIiwicGFnaW5hdGlvbiIsInRvdGFsIiwicGF5bWVudElkIiwiY2xpZW50IiwiY3JlYXRlTWVyY2Fkb1BhZ29DbGllbnQiLCJwYXltZW50IiwiUGF5bWVudCIsInJlZnVuZElkIiwiTWF0aCIsInJhbmRvbSIsInN1YnN0ciIsInJlZnVuZFJlc3BvbnNlIl0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMsK0NBQStDO0FBQy9DLHNDQUFzQzs7Ozs7Ozs7Ozs7O1FBeU5oQkE7ZUFBQUE7O1FBekxBQztlQUFBQTs7O3dCQTlCb0I7c0JBQ3JCOzBCQUNhO3dCQUNZOzZCQUMwQjt5QkFDdkM7NkJBQ087OEJBQ2hCO0FBdUJqQixlQUFlQSxLQUFLQyxPQUFvQjtJQUM3QyxNQUFNQyxZQUFZQyxLQUFLQyxHQUFHO0lBQzFCLE1BQU1DLFdBQVdKLFFBQVFLLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLHNCQUFzQjtJQUMzRCxNQUFNQyxZQUFZUCxRQUFRSyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxpQkFBaUI7SUFFdkQsSUFBSTtRQUNGLDBCQUEwQjtRQUMxQixNQUFNRSxVQUFVLE1BQU1DLElBQUFBLFVBQUk7UUFDMUIsSUFBSSxDQUFDRCxTQUFTRSxNQUFNO1lBQ2xCLE9BQU9DLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7Z0JBQUVDLFNBQVM7Z0JBQU9DLE9BQU87WUFBZ0IsR0FDekM7Z0JBQUVDLFFBQVE7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