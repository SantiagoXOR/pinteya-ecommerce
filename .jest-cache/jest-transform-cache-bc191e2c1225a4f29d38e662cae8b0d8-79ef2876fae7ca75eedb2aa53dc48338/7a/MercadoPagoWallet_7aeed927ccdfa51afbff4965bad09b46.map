{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\components\\Checkout\\MercadoPagoWallet.tsx"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - MERCADOPAGO WALLET BRICK\r\n// ===================================\r\n\r\n\"use client\";\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Loader2, CreditCard, AlertTriangle, CheckCircle } from 'lucide-react';\r\n\r\n// Tipos para el SDK de MercadoPago\r\ndeclare global {\r\n  interface Window {\r\n    MercadoPago: any;\r\n  }\r\n}\r\n\r\ninterface MercadoPagoWalletProps {\r\n  preferenceId: string;\r\n  onReady?: () => void;\r\n  onError?: (error: any) => void;\r\n  onSubmit?: (data: any) => void;\r\n  className?: string;\r\n}\r\n\r\nexport default function MercadoPagoWallet({ \r\n  preferenceId, \r\n  onReady, \r\n  onError,\r\n  onSubmit,\r\n  className = \"\"\r\n}: MercadoPagoWalletProps) {\r\n  const walletRef = useRef<HTMLDivElement>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isReady, setIsReady] = useState(false);\r\n  const [sdkLoaded, setSdkLoaded] = useState(false);\r\n\r\n  // Verificar si el SDK ya está cargado\r\n  useEffect(() => {\r\n    if (window.MercadoPago) {\r\n      setSdkLoaded(true);\r\n      return;\r\n    }\r\n\r\n    // Verificar si ya existe un script del SDK\r\n    const existingScript = document.querySelector('script[src*=\"sdk.mercadopago.com\"]');\r\n    if (existingScript) {\r\n      existingScript.addEventListener('load', () => setSdkLoaded(true));\r\n      return;\r\n    }\r\n\r\n    // Cargar el SDK de MercadoPago\r\n    const script = document.createElement('script');\r\n    script.src = 'https://sdk.mercadopago.com/js/v2';\r\n    script.async = true;\r\n    \r\n    script.onload = () => {\r\n      setSdkLoaded(true);\r\n    };\r\n    \r\n    script.onerror = () => {\r\n      setError('Error al cargar el SDK de MercadoPago');\r\n      setIsLoading(false);\r\n      onError?.('Error al cargar el SDK de MercadoPago');\r\n    };\r\n    \r\n    document.head.appendChild(script);\r\n    \r\n    return () => {\r\n      // No remover el script para evitar problemas de recarga\r\n    };\r\n  }, [onError]);\r\n\r\n  // Inicializar el Wallet Brick cuando el SDK esté listo\r\n  useEffect(() => {\r\n    if (!sdkLoaded || !preferenceId) return;\r\n\r\n    const initializeWallet = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        // Verificar que tenemos la clave pública\r\n        const publicKey = process.env.NEXT_PUBLIC_MERCADOPAGO_PUBLIC_KEY;\r\n        if (!publicKey) {\r\n          throw new Error('Clave pública de MercadoPago no configurada');\r\n        }\r\n\r\n        // Inicializar MercadoPago\r\n        const mp = new window.MercadoPago(publicKey);\r\n        \r\n        // Limpiar contenedor anterior si existe\r\n        const container = document.getElementById('wallet_container');\r\n        if (container) {\r\n          container.innerHTML = '';\r\n        }\r\n\r\n        // Crear el Wallet Brick\r\n        await mp.bricks().create(\"wallet\", \"wallet_container\", {\r\n          initialization: {\r\n            preferenceId: preferenceId,\r\n            redirectMode: \"self\" // Mantener en la misma pestaña\r\n          },\r\n          callbacks: {\r\n            onReady: () => {\r\n              setIsLoading(false);\r\n              setIsReady(true);\r\n              onReady?.();\r\n            },\r\n            onError: (error: any) => {\r\n              console.error('Error en Wallet Brick:', error);\r\n              setError(error.message || 'Error en el procesamiento del pago');\r\n              setIsLoading(false);\r\n              onError?.(error);\r\n            },\r\n            onSubmit: (data: any) => {\r\n              console.log('Pago enviado:', data);\r\n              onSubmit?.(data);\r\n            },\r\n          },\r\n          customization: {\r\n            texts: {\r\n              valueProp: 'smart_option',\r\n            },\r\n            visual: {\r\n              buttonBackground: 'default',\r\n              borderRadius: '8px',\r\n            },\r\n          },\r\n        });\r\n\r\n      } catch (error: any) {\r\n        console.error('Error inicializando Wallet Brick:', error);\r\n        setError(error.message || 'Error inicializando el sistema de pagos');\r\n        setIsLoading(false);\r\n        onError?.(error);\r\n      }\r\n    };\r\n\r\n    initializeWallet();\r\n  }, [sdkLoaded, preferenceId, onReady, onError, onSubmit]);\r\n\r\n  const handleRetry = () => {\r\n    setError(null);\r\n    setIsLoading(true);\r\n    setIsReady(false);\r\n    \r\n    // Recargar la página para reiniciar el proceso\r\n    window.location.reload();\r\n  };\r\n\r\n  return (\r\n    <Card className={`w-full ${className}`}>\r\n      <CardHeader>\r\n        <CardTitle className=\"flex items-center gap-2\">\r\n          <CreditCard className=\"w-5 h-5 text-primary\" />\r\n          Método de Pago\r\n        </CardTitle>\r\n      </CardHeader>\r\n      <CardContent>\r\n        {/* Estado de carga */}\r\n        {isLoading && (\r\n          <div className=\"flex flex-col items-center justify-center py-8 space-y-4\">\r\n            <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n            <p className=\"text-sm text-gray-600\">\r\n              Cargando opciones de pago seguras...\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Estado de error */}\r\n        {error && (\r\n          <div className=\"flex flex-col items-center justify-center py-8 space-y-4\">\r\n            <AlertTriangle className=\"w-8 h-8 text-red-500\" />\r\n            <div className=\"text-center\">\r\n              <p className=\"text-sm text-red-600 mb-2\">{error}</p>\r\n              <Button \r\n                onClick={handleRetry}\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n              >\r\n                Reintentar\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Estado listo */}\r\n        {isReady && !error && (\r\n          <div className=\"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg\">\r\n            <div className=\"flex items-center gap-2 text-green-800\">\r\n              <CheckCircle className=\"w-4 h-4\" />\r\n              <span className=\"text-sm font-medium\">\r\n                Sistema de pagos cargado correctamente\r\n              </span>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Contenedor del Wallet Brick */}\r\n        <div \r\n          id=\"wallet_container\" \r\n          ref={walletRef}\r\n          className={`min-h-[200px] ${isLoading || error ? 'hidden' : 'block'}`}\r\n        />\r\n\r\n        {/* Información adicional */}\r\n        {isReady && !error && (\r\n          <div className=\"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\r\n            <p className=\"text-sm text-blue-800\">\r\n              <strong>Pago seguro con MercadoPago:</strong> Acepta tarjetas de crédito, \r\n              débito, efectivo y transferencias bancarias. Tus datos están protegidos \r\n              con encriptación de nivel bancario.\r\n            </p>\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\n// Componente de fallback para casos de error crítico\r\nexport function MercadoPagoWalletFallback({ \r\n  initPoint, \r\n  className = \"\" \r\n}: { \r\n  initPoint: string; \r\n  className?: string; \r\n}) {\r\n  return (\r\n    <Card className={`w-full ${className}`}>\r\n      <CardHeader>\r\n        <CardTitle className=\"flex items-center gap-2\">\r\n          <CreditCard className=\"w-5 h-5 text-primary\" />\r\n          Método de Pago\r\n        </CardTitle>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <div className=\"text-center py-6\">\r\n          <p className=\"text-sm text-gray-600 mb-4\">\r\n            Continúa con el pago en MercadoPago\r\n          </p>\r\n          <Button \r\n            onClick={() => window.open(initPoint, '_blank')}\r\n            className=\"w-full bg-blue-500 hover:bg-blue-600\"\r\n          >\r\n            Pagar con MercadoPago\r\n          </Button>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n"],"names":["MercadoPagoWalletFallback","MercadoPagoWallet","preferenceId","onReady","onError","onSubmit","className","walletRef","useRef","isLoading","setIsLoading","useState","error","setError","isReady","setIsReady","sdkLoaded","setSdkLoaded","useEffect","window","MercadoPago","existingScript","document","querySelector","addEventListener","script","createElement","src","async","onload","onerror","head","appendChild","initializeWallet","publicKey","process","env","NEXT_PUBLIC_MERCADOPAGO_PUBLIC_KEY","Error","mp","container","getElementById","innerHTML","bricks","create","initialization","redirectMode","callbacks","console","message","data","log","customization","texts","valueProp","visual","buttonBackground","borderRadius","handleRetry","location","reload","Card","CardHeader","CardTitle","CreditCard","CardContent","div","Loader2","p","AlertTriangle","Button","onClick","variant","size","CheckCircle","span","id","ref","strong","initPoint","open"],"mappings":"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"}