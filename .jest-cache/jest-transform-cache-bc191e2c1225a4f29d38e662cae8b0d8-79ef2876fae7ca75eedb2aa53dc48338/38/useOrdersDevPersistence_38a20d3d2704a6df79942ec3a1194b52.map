{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\admin\\useOrdersDevPersistence.ts"],"sourcesContent":["// ===================================\n// PINTEYA E-COMMERCE - ORDERS DEV PERSISTENCE HOOK\n// Hook para persistir estado de órdenes durante Fast Refresh en desarrollo\n// ===================================\n\n'use client';\n\nimport { useCallback, useRef, useEffect } from 'react';\nimport { StrictOrderEnterprise } from '@/types/orders-enterprise';\nimport { StrictOrderFilters } from './useOrdersEnterpriseStrict';\n\n// ===================================\n// TIPOS Y CONFIGURACIÓN\n// ===================================\n\ninterface PersistedOrdersState {\n  orders: StrictOrderEnterprise[];\n  pagination: any;\n  analytics: any;\n  filters: StrictOrderFilters;\n  lastFetchTime: number;\n  hasData: boolean;\n}\n\ninterface DevPersistenceOptions {\n  enabled: boolean;\n  maxAge: number; // Tiempo máximo para considerar datos válidos (ms)\n  storageKey: string;\n}\n\n// ===================================\n// STORAGE GLOBAL PARA DESARROLLO\n// ===================================\n\n// Usar Map global para persistir entre Fast Refresh\nconst globalDevStorage = new Map<string, PersistedOrdersState>();\n\n// ===================================\n// UTILIDADES\n// ===================================\n\nfunction isValidPersistedState(state: any): state is PersistedOrdersState {\n  return (\n    state &&\n    typeof state === 'object' &&\n    Array.isArray(state.orders) &&\n    typeof state.lastFetchTime === 'number' &&\n    typeof state.hasData === 'boolean'\n  );\n}\n\nfunction isStateExpired(state: PersistedOrdersState, maxAge: number): boolean {\n  return Date.now() - state.lastFetchTime > maxAge;\n}\n\n// ===================================\n// HOOK DE PERSISTENCIA PARA DESARROLLO\n// ===================================\n\nexport interface UseOrdersDevPersistenceReturn {\n  getPersistedState: () => PersistedOrdersState | null;\n  persistState: (state: Partial<PersistedOrdersState>) => void;\n  clearPersistedState: () => void;\n  hasValidPersistedData: () => boolean;\n}\n\nexport function useOrdersDevPersistence(\n  options: DevPersistenceOptions\n): UseOrdersDevPersistenceReturn {\n  const optionsRef = useRef(options);\n  optionsRef.current = options;\n\n  const getPersistedState = useCallback((): PersistedOrdersState | null => {\n    if (!optionsRef.current.enabled || process.env.NODE_ENV !== 'development') {\n      return null;\n    }\n\n    try {\n      const state = globalDevStorage.get(optionsRef.current.storageKey);\n      \n      if (!state || !isValidPersistedState(state)) {\n        return null;\n      }\n\n      if (isStateExpired(state, optionsRef.current.maxAge)) {\n        globalDevStorage.delete(optionsRef.current.storageKey);\n        return null;\n      }\n\n      return state;\n    } catch (error) {\n      console.warn('[useOrdersDevPersistence] Error getting persisted state:', error);\n      return null;\n    }\n  }, []);\n\n  const persistState = useCallback((newState: Partial<PersistedOrdersState>): void => {\n    if (!optionsRef.current.enabled || process.env.NODE_ENV !== 'development') {\n      return;\n    }\n\n    try {\n      const currentState = globalDevStorage.get(optionsRef.current.storageKey);\n      \n      const updatedState: PersistedOrdersState = {\n        orders: [],\n        pagination: null,\n        analytics: null,\n        filters: {} as StrictOrderFilters,\n        lastFetchTime: Date.now(),\n        hasData: false,\n        ...currentState,\n        ...newState,\n      };\n\n      globalDevStorage.set(optionsRef.current.storageKey, updatedState);\n\n      if (process.env.NODE_ENV === 'development') {\n        console.log('[useOrdersDevPersistence] State persisted:', {\n          key: optionsRef.current.storageKey,\n          ordersCount: updatedState.orders.length,\n          hasData: updatedState.hasData,\n          age: Date.now() - updatedState.lastFetchTime\n        });\n      }\n    } catch (error) {\n      console.warn('[useOrdersDevPersistence] Error persisting state:', error);\n    }\n  }, []);\n\n  const clearPersistedState = useCallback((): void => {\n    if (!optionsRef.current.enabled || process.env.NODE_ENV !== 'development') {\n      return;\n    }\n\n    globalDevStorage.delete(optionsRef.current.storageKey);\n    \n    if (process.env.NODE_ENV === 'development') {\n      console.log('[useOrdersDevPersistence] Persisted state cleared');\n    }\n  }, []);\n\n  const hasValidPersistedData = useCallback((): boolean => {\n    const state = getPersistedState();\n    return state !== null && state.hasData && state.orders.length > 0;\n  }, [getPersistedState]);\n\n  // Cleanup al desmontar (solo en producción o cuando se deshabilita)\n  useEffect(() => {\n    return () => {\n      if (!optionsRef.current.enabled || process.env.NODE_ENV !== 'development') {\n        clearPersistedState();\n      }\n    };\n  }, [clearPersistedState]);\n\n  return {\n    getPersistedState,\n    persistState,\n    clearPersistedState,\n    hasValidPersistedData\n  };\n}\n\n// ===================================\n// HOOK HELPER PARA INTEGRACIÓN FÁCIL\n// ===================================\n\nexport function useOrdersDevState(storageKey: string = 'orders-dev-state') {\n  return useOrdersDevPersistence({\n    enabled: true,\n    maxAge: 5 * 60 * 1000, // 5 minutos\n    storageKey\n  });\n}\n"],"names":["useOrdersDevPersistence","useOrdersDevState","globalDevStorage","Map","isValidPersistedState","state","Array","isArray","orders","lastFetchTime","hasData","isStateExpired","maxAge","Date","now","options","optionsRef","useRef","current","getPersistedState","useCallback","enabled","process","env","NODE_ENV","get","storageKey","delete","error","console","warn","persistState","newState","currentState","updatedState","pagination","analytics","filters","set","log","key","ordersCount","length","age","clearPersistedState","hasValidPersistedData","useEffect"],"mappings":"AAAA,sCAAsC;AACtC,mDAAmD;AACnD,2EAA2E;AAC3E,sCAAsC;AAEtC;;;;;;;;;;;;QA6DgBA;eAAAA;;QAsGAC;eAAAA;;;uBAjK+B;AAuB/C,sCAAsC;AACtC,iCAAiC;AACjC,sCAAsC;AAEtC,oDAAoD;AACpD,MAAMC,mBAAmB,IAAIC;AAE7B,sCAAsC;AACtC,aAAa;AACb,sCAAsC;AAEtC,SAASC,sBAAsBC,KAAU;IACvC,OACEA,SACA,OAAOA,UAAU,YACjBC,MAAMC,OAAO,CAACF,MAAMG,MAAM,KAC1B,OAAOH,MAAMI,aAAa,KAAK,YAC/B,OAAOJ,MAAMK,OAAO,KAAK;AAE7B;AAEA,SAASC,eAAeN,KAA2B,EAAEO,MAAc;IACjE,OAAOC,KAAKC,GAAG,KAAKT,MAAMI,aAAa,GAAGG;AAC5C;AAaO,SAASZ,wBACde,OAA8B;IAE9B,MAAMC,aAAaC,IAAAA,aAAM,EAACF;IAC1BC,WAAWE,OAAO,GAAGH;IAErB,MAAMI,oBAAoBC,IAAAA,kBAAW,EAAC;QACpC,IAAI,CAACJ,WAAWE,OAAO,CAACG,OAAO,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;YACzE,OAAO;QACT;QAEA,IAAI;YACF,MAAMnB,QAAQH,iBAAiBuB,GAAG,CAACT,WAAWE,OAAO,CAACQ,UAAU;YAEhE,IAAI,CAACrB,SAAS,CAACD,sBAAsBC,QAAQ;gBAC3C,OAAO;YACT;YAEA,IAAIM,eAAeN,OAAOW,WAAWE,OAAO,CAACN,MAAM,GAAG;gBACpDV,iBAAiByB,MAAM,CAACX,WAAWE,OAAO,CAACQ,UAAU;gBACrD,OAAO;YACT;YAEA,OAAOrB;QACT,EAAE,OAAOuB,OAAO;YACdC,QAAQC,IAAI,CAAC,4DAA4DF;YACzE,OAAO;QACT;IACF,GAAG,EAAE;IAEL,MAAMG,eAAeX,IAAAA,kBAAW,EAAC,CAACY;QAChC,IAAI,CAAChB,WAAWE,OAAO,CAACG,OAAO,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;YACzE;QACF;QAEA,IAAI;YACF,MAAMS,eAAe/B,iBAAiBuB,GAAG,CAACT,WAAWE,OAAO,CAACQ,UAAU;YAEvE,MAAMQ,eAAqC;gBACzC1B,QAAQ,EAAE;gBACV2B,YAAY;gBACZC,WAAW;gBACXC,SAAS,CAAC;gBACV5B,eAAeI,KAAKC,GAAG;gBACvBJ,SAAS;gBACT,GAAGuB,YAAY;gBACf,GAAGD,QAAQ;YACb;YAEA9B,iBAAiBoC,GAAG,CAACtB,WAAWE,OAAO,CAACQ,UAAU,EAAEQ;YAEpD,IAAIZ,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;gBAC1CK,QAAQU,GAAG,CAAC,8CAA8C;oBACxDC,KAAKxB,WAAWE,OAAO,CAACQ,UAAU;oBAClCe,aAAaP,aAAa1B,MAAM,CAACkC,MAAM;oBACvChC,SAASwB,aAAaxB,OAAO;oBAC7BiC,KAAK9B,KAAKC,GAAG,KAAKoB,aAAazB,aAAa;gBAC9C;YACF;QACF,EAAE,OAAOmB,OAAO;YACdC,QAAQC,IAAI,CAAC,qDAAqDF;QACpE;IACF,GAAG,EAAE;IAEL,MAAMgB,sBAAsBxB,IAAAA,kBAAW,EAAC;QACtC,IAAI,CAACJ,WAAWE,OAAO,CAACG,OAAO,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;YACzE;QACF;QAEAtB,iBAAiByB,MAAM,CAACX,WAAWE,OAAO,CAACQ,UAAU;QAErD,IAAIJ,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;YAC1CK,QAAQU,GAAG,CAAC;QACd;IACF,GAAG,EAAE;IAEL,MAAMM,wBAAwBzB,IAAAA,kBAAW,EAAC;QACxC,MAAMf,QAAQc;QACd,OAAOd,UAAU,QAAQA,MAAMK,OAAO,IAAIL,MAAMG,MAAM,CAACkC,MAAM,GAAG;IAClE,GAAG;QAACvB;KAAkB;IAEtB,oEAAoE;IACpE2B,IAAAA,gBAAS,EAAC;QACR,OAAO;YACL,IAAI,CAAC9B,WAAWE,OAAO,CAACG,OAAO,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;gBACzEoB;YACF;QACF;IACF,GAAG;QAACA;KAAoB;IAExB,OAAO;QACLzB;QACAY;QACAa;QACAC;IACF;AACF;AAMO,SAAS5C,kBAAkByB,aAAqB,kBAAkB;IACvE,OAAO1B,wBAAwB;QAC7BqB,SAAS;QACTT,QAAQ,IAAI,KAAK;QACjBc;IACF;AACF"}