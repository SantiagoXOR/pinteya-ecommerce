4ae72d37cd7a745fea9b922331fc60f7
/**
 * Sistema de Auditoría de Seguridad Mejorado
 * Extiende el sistema base con análisis avanzado, alertas automáticas y reportes
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get DEFAULT_SECURITY_PATTERNS () {
        return DEFAULT_SECURITY_PATTERNS;
    },
    get analyzeSecurityPatterns () {
        return analyzeSecurityPatterns;
    },
    get cleanupOldSecurityEvents () {
        return cleanupOldSecurityEvents;
    },
    get exportSecurityEvents () {
        return exportSecurityEvents;
    },
    get generateSecurityReport () {
        return generateSecurityReport;
    },
    get getActiveSecurityAlerts () {
        return getActiveSecurityAlerts;
    },
    get getSecurityMetrics () {
        return getSecurityMetrics;
    },
    get markAlertAsFalsePositive () {
        return markAlertAsFalsePositive;
    },
    get resolveSecurityAlert () {
        return resolveSecurityAlert;
    },
    get runSecurityHealthCheck () {
        return runSecurityHealthCheck;
    },
    get startSecurityMonitoring () {
        return startSecurityMonitoring;
    },
    get stopSecurityMonitoring () {
        return stopSecurityMonitoring;
    },
    get updateSecurityAlert () {
        return updateSecurityAlert;
    }
});
const _supabase = require("../supabase");
const _securityaudit = require("./security-audit");
const _cachemanager = require("../cache-manager");
const DEFAULT_SECURITY_PATTERNS = [
    {
        id: 'brute_force_login',
        name: 'Ataque de Fuerza Bruta',
        description: 'Múltiples intentos de login fallidos desde la misma IP',
        severity: 'high',
        timeWindow: 15,
        threshold: 5,
        enabled: true,
        conditions: [
            {
                field: 'event_type',
                operator: 'equals',
                value: 'AUTH_FAILURE',
                weight: 1
            },
            {
                field: 'ip_address',
                operator: 'equals',
                value: 'same',
                weight: 1
            }
        ],
        actions: [
            {
                type: 'alert',
                parameters: {
                    notify_admins: true
                }
            },
            {
                type: 'log',
                parameters: {
                    severity: 'high'
                }
            }
        ]
    },
    {
        id: 'privilege_escalation',
        name: 'Escalación de Privilegios',
        description: 'Intento de acceso a recursos sin permisos suficientes',
        severity: 'critical',
        timeWindow: 60,
        threshold: 3,
        enabled: true,
        conditions: [
            {
                field: 'event_type',
                operator: 'equals',
                value: 'PERMISSION_DENIED',
                weight: 1
            },
            {
                field: 'event_category',
                operator: 'equals',
                value: 'authorization',
                weight: 1
            }
        ],
        actions: [
            {
                type: 'alert',
                parameters: {
                    notify_admins: true,
                    priority: 'high'
                }
            },
            {
                type: 'log',
                parameters: {
                    severity: 'critical'
                }
            }
        ]
    },
    {
        id: 'suspicious_data_access',
        name: 'Acceso Sospechoso a Datos',
        description: 'Acceso masivo a datos sensibles en corto período',
        severity: 'medium',
        timeWindow: 30,
        threshold: 10,
        enabled: true,
        conditions: [
            {
                field: 'event_type',
                operator: 'equals',
                value: 'DATA_ACCESS',
                weight: 1
            },
            {
                field: 'event_category',
                operator: 'equals',
                value: 'data_access',
                weight: 1
            }
        ],
        actions: [
            {
                type: 'alert',
                parameters: {
                    notify_admins: false
                }
            },
            {
                type: 'log',
                parameters: {
                    severity: 'medium'
                }
            }
        ]
    },
    {
        id: 'admin_action_burst',
        name: 'Ráfaga de Acciones Administrativas',
        description: 'Múltiples acciones administrativas en corto período',
        severity: 'medium',
        timeWindow: 10,
        threshold: 5,
        enabled: true,
        conditions: [
            {
                field: 'event_type',
                operator: 'equals',
                value: 'ADMIN_ACTION',
                weight: 1
            },
            {
                field: 'event_category',
                operator: 'equals',
                value: 'admin_operations',
                weight: 1
            }
        ],
        actions: [
            {
                type: 'alert',
                parameters: {
                    notify_admins: true
                }
            },
            {
                type: 'log',
                parameters: {
                    severity: 'medium'
                }
            }
        ]
    },
    {
        id: 'geographic_anomaly',
        name: 'Anomalía Geográfica',
        description: 'Acceso desde ubicaciones geográficas inusuales',
        severity: 'medium',
        timeWindow: 60,
        threshold: 2,
        enabled: true,
        conditions: [
            {
                field: 'event_type',
                operator: 'equals',
                value: 'AUTH_SUCCESS',
                weight: 1
            },
            {
                field: 'ip_address',
                operator: 'not_in',
                value: 'usual_locations',
                weight: 1
            }
        ],
        actions: [
            {
                type: 'alert',
                parameters: {
                    notify_user: true
                }
            },
            {
                type: 'log',
                parameters: {
                    severity: 'medium'
                }
            }
        ]
    }
];
async function analyzeSecurityPatterns(userId, timeWindowHours = 24) {
    try {
        console.log('[SECURITY] Iniciando análisis de patrones de seguridad');
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const timeThreshold = new Date(Date.now() - timeWindowHours * 60 * 60 * 1000).toISOString();
        const alerts = [];
        // Obtener eventos recientes
        let query = _supabase.supabaseAdmin.from('security_events').select('*').gte('timestamp', timeThreshold).order('timestamp', {
            ascending: false
        });
        if (userId) {
            query = query.eq('user_id', userId);
        }
        const { data: events, error } = await query;
        if (error) {
            throw new Error(`Error obteniendo eventos: ${error.message}`);
        }
        if (!events || events.length === 0) {
            return alerts;
        }
        // Analizar cada patrón
        for (const pattern of DEFAULT_SECURITY_PATTERNS){
            if (!pattern.enabled) continue;
            const patternAlerts = await detectPattern(pattern, events);
            alerts.push(...patternAlerts);
        }
        // Guardar alertas en base de datos
        if (alerts.length > 0) {
            const { error: insertError } = await _supabase.supabaseAdmin.from('security_alerts').insert(alerts);
            if (insertError) {
                console.error('[SECURITY] Error guardando alertas:', insertError);
            }
        }
        console.log(`[SECURITY] Análisis completado: ${alerts.length} alertas generadas`);
        return alerts;
    } catch (error) {
        console.error('[SECURITY] Error en análisis de patrones:', error);
        return [];
    }
}
/**
 * Detecta un patrón específico en los eventos
 */ async function detectPattern(pattern, events) {
    const alerts = [];
    const timeWindow = pattern.timeWindow * 60 * 1000; // convertir a ms
    // Agrupar eventos por usuario
    const eventsByUser = events.reduce((acc, event)=>{
        if (!acc[event.user_id]) {
            acc[event.user_id] = [];
        }
        acc[event.user_id].push(event);
        return acc;
    }, {});
    // Analizar cada usuario
    for (const [userId, userEvents] of Object.entries(eventsByUser)){
        const matchingEvents = userEvents.filter((event)=>matchesPatternConditions(event, pattern.conditions));
        if (matchingEvents.length < pattern.threshold) continue;
        // Verificar ventana de tiempo
        const sortedEvents = matchingEvents.sort((a, b)=>new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());
        for(let i = 0; i <= sortedEvents.length - pattern.threshold; i++){
            const windowStart = new Date(sortedEvents[i].timestamp).getTime();
            const windowEnd = windowStart + timeWindow;
            const eventsInWindow = sortedEvents.filter((event)=>{
                const eventTime = new Date(event.timestamp).getTime();
                return eventTime >= windowStart && eventTime <= windowEnd;
            });
            if (eventsInWindow.length >= pattern.threshold) {
                // Patrón detectado
                const alert = {
                    id: `${pattern.id}_${userId}_${Date.now()}`,
                    pattern_id: pattern.id,
                    user_id: userId,
                    severity: pattern.severity,
                    title: pattern.name,
                    description: `${pattern.description} - ${eventsInWindow.length} eventos detectados`,
                    event_count: eventsInWindow.length,
                    first_occurrence: eventsInWindow[0].timestamp,
                    last_occurrence: eventsInWindow[eventsInWindow.length - 1].timestamp,
                    status: 'open',
                    metadata: {
                        pattern_name: pattern.name,
                        events: eventsInWindow.map((e)=>e.id),
                        threshold: pattern.threshold,
                        time_window_minutes: pattern.timeWindow
                    }
                };
                alerts.push(alert);
                // Ejecutar acciones del patrón
                await executePatternActions(pattern.actions, alert, eventsInWindow);
                break; // Solo una alerta por patrón por usuario
            }
        }
    }
    return alerts;
}
/**
 * Verifica si un evento coincide con las condiciones del patrón
 */ function matchesPatternConditions(event, conditions) {
    return conditions.every((condition)=>{
        const eventValue = event[condition.field];
        switch(condition.operator){
            case 'equals':
                return eventValue === condition.value;
            case 'contains':
                return typeof eventValue === 'string' && eventValue.includes(condition.value);
            case 'greater_than':
                return Number(eventValue) > Number(condition.value);
            case 'less_than':
                return Number(eventValue) < Number(condition.value);
            case 'in':
                return Array.isArray(condition.value) && condition.value.includes(eventValue);
            case 'not_in':
                return Array.isArray(condition.value) && !condition.value.includes(eventValue);
            default:
                return false;
        }
    });
}
/**
 * Ejecuta las acciones definidas para un patrón
 */ async function executePatternActions(actions, alert, events) {
    for (const action of actions){
        try {
            switch(action.type){
                case 'log':
                    await (0, _securityaudit.logSecurityEvent)({
                        user_id: alert.user_id,
                        event_type: 'SUSPICIOUS_ACTIVITY',
                        event_category: 'suspicious_behavior',
                        severity: action.parameters?.severity || alert.severity,
                        description: `Patrón detectado: ${alert.title}`,
                        metadata: {
                            pattern_id: alert.pattern_id,
                            alert_id: alert.id,
                            event_count: alert.event_count,
                            ...action.parameters
                        }
                    });
                    break;
                case 'alert':
                    console.warn(`[SECURITY ALERT] ${alert.title} - Usuario: ${alert.user_id}`);
                    if (action.parameters?.notify_admins) {
                        // Aquí se podría integrar con un sistema de notificaciones
                        console.log('[SECURITY] Notificando a administradores...');
                    }
                    break;
                case 'block_user':
                    console.log(`[SECURITY] Bloqueando usuario: ${alert.user_id}`);
                    break;
                case 'invalidate_sessions':
                    console.log(`[SECURITY] Invalidando sesiones del usuario: ${alert.user_id}`);
                    break;
                default:
                    console.warn(`[SECURITY] Acción no reconocida: ${action.type}`);
            }
        } catch (error) {
            console.error(`[SECURITY] Error ejecutando acción ${action.type}:`, error);
        }
    }
}
async function getSecurityMetrics() {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const cache = _cachemanager.CacheManager.getInstance();
        const cacheKey = 'security_metrics';
        // Intentar obtener desde cache
        const cached = await cache.get(_cachemanager.CACHE_CONFIGS.USER_SESSION, cacheKey);
        if (cached) {
            return cached;
        }
        const now = new Date();
        const last24h = new Date(now.getTime() - 24 * 60 * 60 * 1000).toISOString();
        // Obtener eventos de las últimas 24 horas
        const { data: events, error } = await _supabase.supabaseAdmin.from('security_events').select('*').gte('timestamp', last24h);
        if (error) {
            throw new Error(`Error obteniendo eventos: ${error.message}`);
        }
        // Obtener alertas activas
        const { data: alerts, error: alertsError } = await _supabase.supabaseAdmin.from('security_alerts').select('id').eq('status', 'open');
        if (alertsError) {
            console.error('[SECURITY] Error obteniendo alertas:', alertsError);
        }
        // Calcular métricas
        const totalEvents = events?.length || 0;
        const criticalEvents = events?.filter((e)=>e.severity === 'critical').length || 0;
        const uniqueUsers = new Set(events?.map((e)=>e.user_id)).size;
        const authFailures = events?.filter((e)=>e.event_type === 'AUTH_FAILURE').length || 0;
        const suspiciousActivities = events?.filter((e)=>e.event_type === 'SUSPICIOUS_ACTIVITY').length || 0;
        const activeAlerts = alerts?.length || 0;
        // Calcular score de seguridad (0-100)
        let securityScore = 100;
        if (criticalEvents > 0) securityScore -= criticalEvents * 10;
        if (authFailures > 10) securityScore -= (authFailures - 10) * 2;
        if (suspiciousActivities > 5) securityScore -= (suspiciousActivities - 5) * 5;
        if (activeAlerts > 0) securityScore -= activeAlerts * 3;
        securityScore = Math.max(0, Math.min(100, securityScore));
        const metrics = {
            total_events_24h: totalEvents,
            critical_events_24h: criticalEvents,
            unique_users_24h: uniqueUsers,
            auth_failures_24h: authFailures,
            suspicious_activities_24h: suspiciousActivities,
            blocked_users: 0,
            active_alerts: activeAlerts,
            avg_response_time: 0,
            security_score: securityScore
        };
        // Guardar en cache por 5 minutos
        await cache.set(_cachemanager.CACHE_CONFIGS.USER_SESSION, cacheKey, metrics);
        return metrics;
    } catch (error) {
        console.error('[SECURITY] Error obteniendo métricas:', error);
        return {
            total_events_24h: 0,
            critical_events_24h: 0,
            unique_users_24h: 0,
            auth_failures_24h: 0,
            suspicious_activities_24h: 0,
            blocked_users: 0,
            active_alerts: 0,
            avg_response_time: 0,
            security_score: 0
        };
    }
}
async function generateSecurityReport(startDate, endDate) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        console.log(`[SECURITY] Generando reporte de seguridad: ${startDate.toISOString()} - ${endDate.toISOString()}`);
        // Obtener eventos del período
        const { data: events, error } = await _supabase.supabaseAdmin.from('security_events').select('*').gte('timestamp', startDate.toISOString()).lte('timestamp', endDate.toISOString()).order('timestamp', {
            ascending: false
        });
        if (error) {
            throw new Error(`Error obteniendo eventos: ${error.message}`);
        }
        const totalEvents = events?.length || 0;
        // Agrupar por severidad
        const eventsBySeverity = {
            low: 0,
            medium: 0,
            high: 0,
            critical: 0
        };
        // Agrupar por categoría
        const eventsByCategory = {
            authentication: 0,
            authorization: 0,
            data_access: 0,
            admin_operations: 0,
            suspicious_behavior: 0
        };
        // Contadores de usuarios e IPs
        const userCounts = {};
        const ipCounts = {};
        events?.forEach((event)=>{
            // Contar por severidad
            eventsBySeverity[event.severity]++;
            // Contar por categoría
            eventsByCategory[event.event_category]++;
            // Contar por usuario
            userCounts[event.user_id] = (userCounts[event.user_id] || 0) + 1;
            // Contar por IP
            if (event.ip_address) {
                ipCounts[event.ip_address] = (ipCounts[event.ip_address] || 0) + 1;
            }
        });
        // Top usuarios (más eventos)
        const topUsers = Object.entries(userCounts).sort(([, a], [, b])=>b - a).slice(0, 10).map(([user_id, event_count])=>({
                user_id,
                event_count
            }));
        // Top IPs (más eventos)
        const topIps = Object.entries(ipCounts).sort(([, a], [, b])=>b - a).slice(0, 10).map(([ip_address, event_count])=>({
                ip_address,
                event_count
            }));
        // Obtener patrones detectados
        const { data: alerts, error: alertsError } = await _supabase.supabaseAdmin.from('security_alerts').select('pattern_id').gte('first_occurrence', startDate.toISOString()).lte('last_occurrence', endDate.toISOString());
        const patternsDetected = [];
        if (!alertsError && alerts) {
            const patternCounts = {};
            alerts.forEach((alert)=>{
                patternCounts[alert.pattern_id] = (patternCounts[alert.pattern_id] || 0) + 1;
            });
            Object.entries(patternCounts).forEach(([pattern_id, occurrences])=>{
                patternsDetected.push({
                    pattern_id,
                    occurrences
                });
            });
        }
        // Generar recomendaciones
        const recommendations = generateSecurityRecommendations(eventsBySeverity, eventsByCategory, patternsDetected);
        const report = {
            id: `report_${Date.now()}`,
            period_start: startDate.toISOString(),
            period_end: endDate.toISOString(),
            total_events: totalEvents,
            events_by_severity: eventsBySeverity,
            events_by_category: eventsByCategory,
            top_users: topUsers,
            top_ips: topIps,
            patterns_detected: patternsDetected,
            recommendations,
            generated_at: new Date().toISOString()
        };
        // Guardar reporte en base de datos
        const { error: insertError } = await _supabase.supabaseAdmin.from('security_reports').insert(report);
        if (insertError) {
            console.error('[SECURITY] Error guardando reporte:', insertError);
        }
        console.log(`[SECURITY] Reporte generado: ${totalEvents} eventos analizados`);
        return report;
    } catch (error) {
        console.error('[SECURITY] Error generando reporte:', error);
        throw error;
    }
}
/**
 * Genera recomendaciones de seguridad basadas en los datos del reporte
 */ function generateSecurityRecommendations(eventsBySeverity, eventsByCategory, patternsDetected) {
    const recommendations = [];
    // Recomendaciones basadas en severidad
    if (eventsBySeverity.critical > 0) {
        recommendations.push(`Se detectaron ${eventsBySeverity.critical} eventos críticos. Revisar inmediatamente.`);
    }
    if (eventsBySeverity.high > 10) {
        recommendations.push(`Alto número de eventos de severidad alta (${eventsBySeverity.high}). Considerar reforzar medidas de seguridad.`);
    }
    // Recomendaciones basadas en categorías
    if (eventsByCategory.authentication > 50) {
        recommendations.push(`Muchos eventos de autenticación (${eventsByCategory.authentication}). Considerar implementar MFA.`);
    }
    if (eventsByCategory.authorization > 20) {
        recommendations.push(`Eventos de autorización elevados (${eventsByCategory.authorization}). Revisar permisos de usuarios.`);
    }
    if (eventsByCategory.suspicious_behavior > 5) {
        recommendations.push(`Actividad sospechosa detectada (${eventsByCategory.suspicious_behavior} eventos). Monitorear de cerca.`);
    }
    // Recomendaciones basadas en patrones
    const highFrequencyPatterns = patternsDetected.filter((p)=>p.occurrences > 3);
    if (highFrequencyPatterns.length > 0) {
        recommendations.push(`Patrones de seguridad recurrentes detectados. Considerar medidas preventivas adicionales.`);
    }
    // Recomendaciones generales
    if (recommendations.length === 0) {
        recommendations.push('No se detectaron problemas críticos de seguridad. Mantener monitoreo regular.');
    }
    return recommendations;
}
async function getActiveSecurityAlerts(userId, severity) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        let query = _supabase.supabaseAdmin.from('security_alerts').select('*').eq('status', 'open').order('last_occurrence', {
            ascending: false
        });
        if (userId) {
            query = query.eq('user_id', userId);
        }
        if (severity) {
            query = query.eq('severity', severity);
        }
        const { data: alerts, error } = await query;
        if (error) {
            throw new Error(`Error obteniendo alertas: ${error.message}`);
        }
        return alerts || [];
    } catch (error) {
        console.error('[SECURITY] Error obteniendo alertas activas:', error);
        return [];
    }
}
async function updateSecurityAlert(alertId, updates) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const { error } = await _supabase.supabaseAdmin.from('security_alerts').update({
            ...updates,
            updated_at: new Date().toISOString()
        }).eq('id', alertId);
        if (error) {
            throw new Error(`Error actualizando alerta: ${error.message}`);
        }
        console.log(`[SECURITY] Alerta ${alertId} actualizada: ${JSON.stringify(updates)}`);
        return true;
    } catch (error) {
        console.error('[SECURITY] Error actualizando alerta:', error);
        return false;
    }
}
async function resolveSecurityAlert(alertId, resolutionNotes, resolvedBy) {
    return await updateSecurityAlert(alertId, {
        status: 'resolved',
        assigned_to: resolvedBy,
        resolution_notes: resolutionNotes
    });
}
async function markAlertAsFalsePositive(alertId, notes, markedBy) {
    return await updateSecurityAlert(alertId, {
        status: 'false_positive',
        assigned_to: markedBy,
        resolution_notes: notes
    });
}
function startSecurityMonitoring(intervalMinutes = 5) {
    console.log(`[SECURITY] 🚫 MONITOREO AUTOMÁTICO TEMPORALMENTE DESHABILITADO`);
    console.log(`[SECURITY] 📋 Razón: Evitar llamadas recursivas a APIs de auth`);
    // RETORNAR UN TIMEOUT DUMMY PARA NO ROMPER EL CÓDIGO QUE LO LLAMA
    return setTimeout(()=>{
        console.log('[SECURITY] Timeout dummy completado');
    }, 1000);
// CÓDIGO COMENTADO TEMPORALMENTE
// return setInterval(async () => {
//   try {
//     console.log('[SECURITY] Ejecutando análisis automático...');
//     // Analizar patrones de seguridad
//     const alerts = await analyzeSecurityPatterns();
//     if (alerts.length > 0) {
//       console.log(`[SECURITY] ${alerts.length} nuevas alertas generadas`);
//       // Procesar alertas críticas inmediatamente
//       const criticalAlerts = alerts.filter(a => a.severity === 'critical');
//       if (criticalAlerts.length > 0) {
//         console.warn(`[SECURITY] ¡${criticalAlerts.length} alertas críticas detectadas!`);
//         // Aquí se podrían enviar notificaciones inmediatas
//       }
//     }
//     // Actualizar métricas
//     await getSecurityMetrics();
//   } catch (error) {
//     console.error('[SECURITY] Error en monitoreo automático:', error);
//   }
// }, intervalMinutes * 60 * 1000);
}
function stopSecurityMonitoring(intervalId) {
    clearInterval(intervalId);
    console.log('[SECURITY] Monitoreo automático detenido');
}
async function runSecurityHealthCheck() {
    try {
        console.log('[SECURITY] Ejecutando verificación completa de seguridad...');
        // Obtener métricas actuales
        const metrics = await getSecurityMetrics();
        // Obtener alertas activas
        const activeAlerts = await getActiveSecurityAlerts();
        const issues = [];
        const recommendations = [];
        let status = 'healthy';
        // Evaluar estado de seguridad
        if (metrics.critical_events_24h > 0) {
            issues.push(`${metrics.critical_events_24h} eventos críticos en las últimas 24 horas`);
            status = 'critical';
        }
        if (metrics.auth_failures_24h > 20) {
            issues.push(`Alto número de fallos de autenticación: ${metrics.auth_failures_24h}`);
            if (status !== 'critical') status = 'warning';
            recommendations.push('Considerar implementar medidas anti-brute force');
        }
        if (metrics.suspicious_activities_24h > 10) {
            issues.push(`Actividad sospechosa elevada: ${metrics.suspicious_activities_24h} eventos`);
            if (status !== 'critical') status = 'warning';
            recommendations.push('Revisar patrones de actividad sospechosa');
        }
        if (metrics.active_alerts > 5) {
            issues.push(`Muchas alertas activas sin resolver: ${metrics.active_alerts}`);
            if (status !== 'critical') status = 'warning';
            recommendations.push('Revisar y resolver alertas pendientes');
        }
        if (metrics.security_score < 70) {
            issues.push(`Score de seguridad bajo: ${metrics.security_score}/100`);
            if (status !== 'critical') status = 'warning';
            recommendations.push('Implementar medidas para mejorar el score de seguridad');
        }
        // Recomendaciones generales
        if (issues.length === 0) {
            recommendations.push('Sistema de seguridad funcionando correctamente');
            recommendations.push('Mantener monitoreo regular y actualizaciones de seguridad');
        }
        console.log(`[SECURITY] Verificación completada - Estado: ${status}`);
        return {
            status,
            issues,
            recommendations,
            metrics
        };
    } catch (error) {
        console.error('[SECURITY] Error en verificación de seguridad:', error);
        return {
            status: 'critical',
            issues: [
                'Error ejecutando verificación de seguridad'
            ],
            recommendations: [
                'Revisar logs del sistema'
            ],
            metrics: await getSecurityMetrics()
        };
    }
}
async function cleanupOldSecurityEvents(daysToKeep = 90) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const cutoffDate = new Date(Date.now() - daysToKeep * 24 * 60 * 60 * 1000).toISOString();
        const { data, error } = await _supabase.supabaseAdmin.from('security_events').delete().lt('timestamp', cutoffDate);
        if (error) {
            throw new Error(`Error limpiando eventos: ${error.message}`);
        }
        const deletedCount = Array.isArray(data) ? data.length : 0;
        console.log(`[SECURITY] Limpieza completada: ${deletedCount} eventos eliminados`);
        return deletedCount;
    } catch (error) {
        console.error('[SECURITY] Error en limpieza de eventos:', error);
        return 0;
    }
}
async function exportSecurityEvents(startDate, endDate, format = 'json') {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const { data: events, error } = await _supabase.supabaseAdmin.from('security_events').select('*').gte('timestamp', startDate.toISOString()).lte('timestamp', endDate.toISOString()).order('timestamp', {
            ascending: true
        });
        if (error) {
            throw new Error(`Error exportando eventos: ${error.message}`);
        }
        if (format === 'json') {
            return JSON.stringify(events, null, 2);
        } else {
            // Formato CSV
            if (!events || events.length === 0) {
                return 'No hay eventos para exportar';
            }
            const headers = Object.keys(events[0]).join(',');
            const rows = events.map((event)=>Object.values(event).map((value)=>typeof value === 'string' ? `"${value.replace(/"/g, '""')}"` : value).join(','));
            return [
                headers,
                ...rows
            ].join('\n');
        }
    } catch (error) {
        console.error('[SECURITY] Error exportando eventos:', error);
        throw error;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhdXRoXFxzZWN1cml0eS1hdWRpdC1lbmhhbmNlZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogU2lzdGVtYSBkZSBBdWRpdG9yw61hIGRlIFNlZ3VyaWRhZCBNZWpvcmFkb1xyXG4gKiBFeHRpZW5kZSBlbCBzaXN0ZW1hIGJhc2UgY29uIGFuw6FsaXNpcyBhdmFuemFkbywgYWxlcnRhcyBhdXRvbcOhdGljYXMgeSByZXBvcnRlc1xyXG4gKi9cclxuXHJcbmltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICdAL2xpYi9zdXBhYmFzZSc7XHJcbmltcG9ydCB7IFxyXG4gIGxvZ1NlY3VyaXR5RXZlbnQsIFxyXG4gIHR5cGUgU2VjdXJpdHlFdmVudCwgXHJcbiAgdHlwZSBTZWN1cml0eVNldmVyaXR5LFxyXG4gIHR5cGUgU2VjdXJpdHlFdmVudFR5cGUsXHJcbiAgdHlwZSBTZWN1cml0eUV2ZW50Q2F0ZWdvcnkgXHJcbn0gZnJvbSAnLi9zZWN1cml0eS1hdWRpdCc7XHJcbmltcG9ydCB7IENhY2hlTWFuYWdlciwgQ0FDSEVfQ09ORklHUyB9IGZyb20gJ0AvbGliL2NhY2hlLW1hbmFnZXInO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gVElQT1MgWSBJTlRFUkZBQ0VTIEVYVEVORElEQVNcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlQYXR0ZXJuIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xyXG4gIHNldmVyaXR5OiBTZWN1cml0eVNldmVyaXR5O1xyXG4gIGNvbmRpdGlvbnM6IFBhdHRlcm5Db25kaXRpb25bXTtcclxuICB0aW1lV2luZG93OiBudW1iZXI7IC8vIGVuIG1pbnV0b3NcclxuICB0aHJlc2hvbGQ6IG51bWJlcjtcclxuICBlbmFibGVkOiBib29sZWFuO1xyXG4gIGFjdGlvbnM6IFNlY3VyaXR5QWN0aW9uW107XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUGF0dGVybkNvbmRpdGlvbiB7XHJcbiAgZmllbGQ6IHN0cmluZztcclxuICBvcGVyYXRvcjogJ2VxdWFscycgfCAnY29udGFpbnMnIHwgJ2dyZWF0ZXJfdGhhbicgfCAnbGVzc190aGFuJyB8ICdpbicgfCAnbm90X2luJztcclxuICB2YWx1ZTogYW55O1xyXG4gIHdlaWdodDogbnVtYmVyOyAvLyBwZXNvIGVuIGVsIGPDoWxjdWxvIGRlbCBwYXRyw7NuXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlBY3Rpb24ge1xyXG4gIHR5cGU6ICdsb2cnIHwgJ2FsZXJ0JyB8ICdibG9ja191c2VyJyB8ICdub3RpZnlfYWRtaW4nIHwgJ2ludmFsaWRhdGVfc2Vzc2lvbnMnO1xyXG4gIHBhcmFtZXRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5UmVwb3J0IHtcclxuICBpZDogc3RyaW5nO1xyXG4gIHBlcmlvZF9zdGFydDogc3RyaW5nO1xyXG4gIHBlcmlvZF9lbmQ6IHN0cmluZztcclxuICB0b3RhbF9ldmVudHM6IG51bWJlcjtcclxuICBldmVudHNfYnlfc2V2ZXJpdHk6IFJlY29yZDxTZWN1cml0eVNldmVyaXR5LCBudW1iZXI+O1xyXG4gIGV2ZW50c19ieV9jYXRlZ29yeTogUmVjb3JkPFNlY3VyaXR5RXZlbnRDYXRlZ29yeSwgbnVtYmVyPjtcclxuICB0b3BfdXNlcnM6IEFycmF5PHsgdXNlcl9pZDogc3RyaW5nOyBldmVudF9jb3VudDogbnVtYmVyIH0+O1xyXG4gIHRvcF9pcHM6IEFycmF5PHsgaXBfYWRkcmVzczogc3RyaW5nOyBldmVudF9jb3VudDogbnVtYmVyIH0+O1xyXG4gIHBhdHRlcm5zX2RldGVjdGVkOiBBcnJheTx7IHBhdHRlcm5faWQ6IHN0cmluZzsgb2NjdXJyZW5jZXM6IG51bWJlciB9PjtcclxuICByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdO1xyXG4gIGdlbmVyYXRlZF9hdDogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5TWV0cmljcyB7XHJcbiAgdG90YWxfZXZlbnRzXzI0aDogbnVtYmVyO1xyXG4gIGNyaXRpY2FsX2V2ZW50c18yNGg6IG51bWJlcjtcclxuICB1bmlxdWVfdXNlcnNfMjRoOiBudW1iZXI7XHJcbiAgYXV0aF9mYWlsdXJlc18yNGg6IG51bWJlcjtcclxuICBzdXNwaWNpb3VzX2FjdGl2aXRpZXNfMjRoOiBudW1iZXI7XHJcbiAgYmxvY2tlZF91c2VyczogbnVtYmVyO1xyXG4gIGFjdGl2ZV9hbGVydHM6IG51bWJlcjtcclxuICBhdmdfcmVzcG9uc2VfdGltZTogbnVtYmVyO1xyXG4gIHNlY3VyaXR5X3Njb3JlOiBudW1iZXI7IC8vIDAtMTAwXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlBbGVydCB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBwYXR0ZXJuX2lkOiBzdHJpbmc7XHJcbiAgdXNlcl9pZDogc3RyaW5nO1xyXG4gIHNldmVyaXR5OiBTZWN1cml0eVNldmVyaXR5O1xyXG4gIHRpdGxlOiBzdHJpbmc7XHJcbiAgZGVzY3JpcHRpb246IHN0cmluZztcclxuICBldmVudF9jb3VudDogbnVtYmVyO1xyXG4gIGZpcnN0X29jY3VycmVuY2U6IHN0cmluZztcclxuICBsYXN0X29jY3VycmVuY2U6IHN0cmluZztcclxuICBzdGF0dXM6ICdvcGVuJyB8ICdpbnZlc3RpZ2F0aW5nJyB8ICdyZXNvbHZlZCcgfCAnZmFsc2VfcG9zaXRpdmUnO1xyXG4gIGFzc2lnbmVkX3RvPzogc3RyaW5nO1xyXG4gIHJlc29sdXRpb25fbm90ZXM/OiBzdHJpbmc7XHJcbiAgbWV0YWRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT47XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIFBBVFJPTkVTIERFIFNFR1VSSURBRCBQUkVERUZJTklET1NcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFQ1VSSVRZX1BBVFRFUk5TOiBTZWN1cml0eVBhdHRlcm5bXSA9IFtcclxuICB7XHJcbiAgICBpZDogJ2JydXRlX2ZvcmNlX2xvZ2luJyxcclxuICAgIG5hbWU6ICdBdGFxdWUgZGUgRnVlcnphIEJydXRhJyxcclxuICAgIGRlc2NyaXB0aW9uOiAnTcO6bHRpcGxlcyBpbnRlbnRvcyBkZSBsb2dpbiBmYWxsaWRvcyBkZXNkZSBsYSBtaXNtYSBJUCcsXHJcbiAgICBzZXZlcml0eTogJ2hpZ2gnLFxyXG4gICAgdGltZVdpbmRvdzogMTUsXHJcbiAgICB0aHJlc2hvbGQ6IDUsXHJcbiAgICBlbmFibGVkOiB0cnVlLFxyXG4gICAgY29uZGl0aW9uczogW1xyXG4gICAgICB7IGZpZWxkOiAnZXZlbnRfdHlwZScsIG9wZXJhdG9yOiAnZXF1YWxzJywgdmFsdWU6ICdBVVRIX0ZBSUxVUkUnLCB3ZWlnaHQ6IDEgfSxcclxuICAgICAgeyBmaWVsZDogJ2lwX2FkZHJlc3MnLCBvcGVyYXRvcjogJ2VxdWFscycsIHZhbHVlOiAnc2FtZScsIHdlaWdodDogMSB9XHJcbiAgICBdLFxyXG4gICAgYWN0aW9uczogW1xyXG4gICAgICB7IHR5cGU6ICdhbGVydCcsIHBhcmFtZXRlcnM6IHsgbm90aWZ5X2FkbWluczogdHJ1ZSB9IH0sXHJcbiAgICAgIHsgdHlwZTogJ2xvZycsIHBhcmFtZXRlcnM6IHsgc2V2ZXJpdHk6ICdoaWdoJyB9IH1cclxuICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAncHJpdmlsZWdlX2VzY2FsYXRpb24nLFxyXG4gICAgbmFtZTogJ0VzY2FsYWNpw7NuIGRlIFByaXZpbGVnaW9zJyxcclxuICAgIGRlc2NyaXB0aW9uOiAnSW50ZW50byBkZSBhY2Nlc28gYSByZWN1cnNvcyBzaW4gcGVybWlzb3Mgc3VmaWNpZW50ZXMnLFxyXG4gICAgc2V2ZXJpdHk6ICdjcml0aWNhbCcsXHJcbiAgICB0aW1lV2luZG93OiA2MCxcclxuICAgIHRocmVzaG9sZDogMyxcclxuICAgIGVuYWJsZWQ6IHRydWUsXHJcbiAgICBjb25kaXRpb25zOiBbXHJcbiAgICAgIHsgZmllbGQ6ICdldmVudF90eXBlJywgb3BlcmF0b3I6ICdlcXVhbHMnLCB2YWx1ZTogJ1BFUk1JU1NJT05fREVOSUVEJywgd2VpZ2h0OiAxIH0sXHJcbiAgICAgIHsgZmllbGQ6ICdldmVudF9jYXRlZ29yeScsIG9wZXJhdG9yOiAnZXF1YWxzJywgdmFsdWU6ICdhdXRob3JpemF0aW9uJywgd2VpZ2h0OiAxIH1cclxuICAgIF0sXHJcbiAgICBhY3Rpb25zOiBbXHJcbiAgICAgIHsgdHlwZTogJ2FsZXJ0JywgcGFyYW1ldGVyczogeyBub3RpZnlfYWRtaW5zOiB0cnVlLCBwcmlvcml0eTogJ2hpZ2gnIH0gfSxcclxuICAgICAgeyB0eXBlOiAnbG9nJywgcGFyYW1ldGVyczogeyBzZXZlcml0eTogJ2NyaXRpY2FsJyB9IH1cclxuICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAnc3VzcGljaW91c19kYXRhX2FjY2VzcycsXHJcbiAgICBuYW1lOiAnQWNjZXNvIFNvc3BlY2hvc28gYSBEYXRvcycsXHJcbiAgICBkZXNjcmlwdGlvbjogJ0FjY2VzbyBtYXNpdm8gYSBkYXRvcyBzZW5zaWJsZXMgZW4gY29ydG8gcGVyw61vZG8nLFxyXG4gICAgc2V2ZXJpdHk6ICdtZWRpdW0nLFxyXG4gICAgdGltZVdpbmRvdzogMzAsXHJcbiAgICB0aHJlc2hvbGQ6IDEwLFxyXG4gICAgZW5hYmxlZDogdHJ1ZSxcclxuICAgIGNvbmRpdGlvbnM6IFtcclxuICAgICAgeyBmaWVsZDogJ2V2ZW50X3R5cGUnLCBvcGVyYXRvcjogJ2VxdWFscycsIHZhbHVlOiAnREFUQV9BQ0NFU1MnLCB3ZWlnaHQ6IDEgfSxcclxuICAgICAgeyBmaWVsZDogJ2V2ZW50X2NhdGVnb3J5Jywgb3BlcmF0b3I6ICdlcXVhbHMnLCB2YWx1ZTogJ2RhdGFfYWNjZXNzJywgd2VpZ2h0OiAxIH1cclxuICAgIF0sXHJcbiAgICBhY3Rpb25zOiBbXHJcbiAgICAgIHsgdHlwZTogJ2FsZXJ0JywgcGFyYW1ldGVyczogeyBub3RpZnlfYWRtaW5zOiBmYWxzZSB9IH0sXHJcbiAgICAgIHsgdHlwZTogJ2xvZycsIHBhcmFtZXRlcnM6IHsgc2V2ZXJpdHk6ICdtZWRpdW0nIH0gfVxyXG4gICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgaWQ6ICdhZG1pbl9hY3Rpb25fYnVyc3QnLFxyXG4gICAgbmFtZTogJ1LDoWZhZ2EgZGUgQWNjaW9uZXMgQWRtaW5pc3RyYXRpdmFzJyxcclxuICAgIGRlc2NyaXB0aW9uOiAnTcO6bHRpcGxlcyBhY2Npb25lcyBhZG1pbmlzdHJhdGl2YXMgZW4gY29ydG8gcGVyw61vZG8nLFxyXG4gICAgc2V2ZXJpdHk6ICdtZWRpdW0nLFxyXG4gICAgdGltZVdpbmRvdzogMTAsXHJcbiAgICB0aHJlc2hvbGQ6IDUsXHJcbiAgICBlbmFibGVkOiB0cnVlLFxyXG4gICAgY29uZGl0aW9uczogW1xyXG4gICAgICB7IGZpZWxkOiAnZXZlbnRfdHlwZScsIG9wZXJhdG9yOiAnZXF1YWxzJywgdmFsdWU6ICdBRE1JTl9BQ1RJT04nLCB3ZWlnaHQ6IDEgfSxcclxuICAgICAgeyBmaWVsZDogJ2V2ZW50X2NhdGVnb3J5Jywgb3BlcmF0b3I6ICdlcXVhbHMnLCB2YWx1ZTogJ2FkbWluX29wZXJhdGlvbnMnLCB3ZWlnaHQ6IDEgfVxyXG4gICAgXSxcclxuICAgIGFjdGlvbnM6IFtcclxuICAgICAgeyB0eXBlOiAnYWxlcnQnLCBwYXJhbWV0ZXJzOiB7IG5vdGlmeV9hZG1pbnM6IHRydWUgfSB9LFxyXG4gICAgICB7IHR5cGU6ICdsb2cnLCBwYXJhbWV0ZXJzOiB7IHNldmVyaXR5OiAnbWVkaXVtJyB9IH1cclxuICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAnZ2VvZ3JhcGhpY19hbm9tYWx5JyxcclxuICAgIG5hbWU6ICdBbm9tYWzDrWEgR2VvZ3LDoWZpY2EnLFxyXG4gICAgZGVzY3JpcHRpb246ICdBY2Nlc28gZGVzZGUgdWJpY2FjaW9uZXMgZ2VvZ3LDoWZpY2FzIGludXN1YWxlcycsXHJcbiAgICBzZXZlcml0eTogJ21lZGl1bScsXHJcbiAgICB0aW1lV2luZG93OiA2MCxcclxuICAgIHRocmVzaG9sZDogMixcclxuICAgIGVuYWJsZWQ6IHRydWUsXHJcbiAgICBjb25kaXRpb25zOiBbXHJcbiAgICAgIHsgZmllbGQ6ICdldmVudF90eXBlJywgb3BlcmF0b3I6ICdlcXVhbHMnLCB2YWx1ZTogJ0FVVEhfU1VDQ0VTUycsIHdlaWdodDogMSB9LFxyXG4gICAgICB7IGZpZWxkOiAnaXBfYWRkcmVzcycsIG9wZXJhdG9yOiAnbm90X2luJywgdmFsdWU6ICd1c3VhbF9sb2NhdGlvbnMnLCB3ZWlnaHQ6IDEgfVxyXG4gICAgXSxcclxuICAgIGFjdGlvbnM6IFtcclxuICAgICAgeyB0eXBlOiAnYWxlcnQnLCBwYXJhbWV0ZXJzOiB7IG5vdGlmeV91c2VyOiB0cnVlIH0gfSxcclxuICAgICAgeyB0eXBlOiAnbG9nJywgcGFyYW1ldGVyczogeyBzZXZlcml0eTogJ21lZGl1bScgfSB9XHJcbiAgICBdXHJcbiAgfVxyXG5dO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gRlVOQ0lPTkVTIERFIEFOw4FMSVNJUyBBVkFOWkFET1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuLyoqXHJcbiAqIEFuYWxpemEgZXZlbnRvcyBkZSBzZWd1cmlkYWQgcGFyYSBkZXRlY3RhciBwYXRyb25lc1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFuYWx5emVTZWN1cml0eVBhdHRlcm5zKFxyXG4gIHVzZXJJZD86IHN0cmluZyxcclxuICB0aW1lV2luZG93SG91cnM6IG51bWJlciA9IDI0XHJcbik6IFByb21pc2U8U2VjdXJpdHlBbGVydFtdPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKCdbU0VDVVJJVFldIEluaWNpYW5kbyBhbsOhbGlzaXMgZGUgcGF0cm9uZXMgZGUgc2VndXJpZGFkJyk7XHJcblxyXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignU3VwYWJhc2UgYWRtaW4gY2xpZW50IG5vIGRpc3BvbmlibGUnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0aW1lVGhyZXNob2xkID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIHRpbWVXaW5kb3dIb3VycyAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpO1xyXG4gICAgY29uc3QgYWxlcnRzOiBTZWN1cml0eUFsZXJ0W10gPSBbXTtcclxuXHJcbiAgICAvLyBPYnRlbmVyIGV2ZW50b3MgcmVjaWVudGVzXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9ldmVudHMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmd0ZSgndGltZXN0YW1wJywgdGltZVRocmVzaG9sZClcclxuICAgICAgLm9yZGVyKCd0aW1lc3RhbXAnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgaWYgKHVzZXJJZCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCd1c2VyX2lkJywgdXNlcklkKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IGV2ZW50cywgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIG9idGVuaWVuZG8gZXZlbnRvczogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghZXZlbnRzIHx8IGV2ZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIGFsZXJ0cztcclxuICAgIH1cclxuXHJcbiAgICAvLyBBbmFsaXphciBjYWRhIHBhdHLDs25cclxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBERUZBVUxUX1NFQ1VSSVRZX1BBVFRFUk5TKSB7XHJcbiAgICAgIGlmICghcGF0dGVybi5lbmFibGVkKSBjb250aW51ZTtcclxuXHJcbiAgICAgIGNvbnN0IHBhdHRlcm5BbGVydHMgPSBhd2FpdCBkZXRlY3RQYXR0ZXJuKHBhdHRlcm4sIGV2ZW50cyk7XHJcbiAgICAgIGFsZXJ0cy5wdXNoKC4uLnBhdHRlcm5BbGVydHMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEd1YXJkYXIgYWxlcnRhcyBlbiBiYXNlIGRlIGRhdG9zXHJcbiAgICBpZiAoYWxlcnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAuZnJvbSgnc2VjdXJpdHlfYWxlcnRzJylcclxuICAgICAgICAuaW5zZXJ0KGFsZXJ0cyk7XHJcblxyXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIGd1YXJkYW5kbyBhbGVydGFzOicsIGluc2VydEVycm9yKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbU0VDVVJJVFldIEFuw6FsaXNpcyBjb21wbGV0YWRvOiAke2FsZXJ0cy5sZW5ndGh9IGFsZXJ0YXMgZ2VuZXJhZGFzYCk7XHJcbiAgICByZXR1cm4gYWxlcnRzO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIGVuIGFuw6FsaXNpcyBkZSBwYXRyb25lczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogRGV0ZWN0YSB1biBwYXRyw7NuIGVzcGVjw61maWNvIGVuIGxvcyBldmVudG9zXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBkZXRlY3RQYXR0ZXJuKFxyXG4gIHBhdHRlcm46IFNlY3VyaXR5UGF0dGVybixcclxuICBldmVudHM6IFNlY3VyaXR5RXZlbnRbXVxyXG4pOiBQcm9taXNlPFNlY3VyaXR5QWxlcnRbXT4ge1xyXG4gIGNvbnN0IGFsZXJ0czogU2VjdXJpdHlBbGVydFtdID0gW107XHJcbiAgY29uc3QgdGltZVdpbmRvdyA9IHBhdHRlcm4udGltZVdpbmRvdyAqIDYwICogMTAwMDsgLy8gY29udmVydGlyIGEgbXNcclxuXHJcbiAgLy8gQWdydXBhciBldmVudG9zIHBvciB1c3VhcmlvXHJcbiAgY29uc3QgZXZlbnRzQnlVc2VyID0gZXZlbnRzLnJlZHVjZSgoYWNjLCBldmVudCkgPT4ge1xyXG4gICAgaWYgKCFhY2NbZXZlbnQudXNlcl9pZF0pIHtcclxuICAgICAgYWNjW2V2ZW50LnVzZXJfaWRdID0gW107XHJcbiAgICB9XHJcbiAgICBhY2NbZXZlbnQudXNlcl9pZF0ucHVzaChldmVudCk7XHJcbiAgICByZXR1cm4gYWNjO1xyXG4gIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIFNlY3VyaXR5RXZlbnRbXT4pO1xyXG5cclxuICAvLyBBbmFsaXphciBjYWRhIHVzdWFyaW9cclxuICBmb3IgKGNvbnN0IFt1c2VySWQsIHVzZXJFdmVudHNdIG9mIE9iamVjdC5lbnRyaWVzKGV2ZW50c0J5VXNlcikpIHtcclxuICAgIGNvbnN0IG1hdGNoaW5nRXZlbnRzID0gdXNlckV2ZW50cy5maWx0ZXIoZXZlbnQgPT4gXHJcbiAgICAgIG1hdGNoZXNQYXR0ZXJuQ29uZGl0aW9ucyhldmVudCwgcGF0dGVybi5jb25kaXRpb25zKVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAobWF0Y2hpbmdFdmVudHMubGVuZ3RoIDwgcGF0dGVybi50aHJlc2hvbGQpIGNvbnRpbnVlO1xyXG5cclxuICAgIC8vIFZlcmlmaWNhciB2ZW50YW5hIGRlIHRpZW1wb1xyXG4gICAgY29uc3Qgc29ydGVkRXZlbnRzID0gbWF0Y2hpbmdFdmVudHMuc29ydCgoYSwgYikgPT4gXHJcbiAgICAgIG5ldyBEYXRlKGEudGltZXN0YW1wKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiLnRpbWVzdGFtcCkuZ2V0VGltZSgpXHJcbiAgICApO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IHNvcnRlZEV2ZW50cy5sZW5ndGggLSBwYXR0ZXJuLnRocmVzaG9sZDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHdpbmRvd1N0YXJ0ID0gbmV3IERhdGUoc29ydGVkRXZlbnRzW2ldLnRpbWVzdGFtcCkuZ2V0VGltZSgpO1xyXG4gICAgICBjb25zdCB3aW5kb3dFbmQgPSB3aW5kb3dTdGFydCArIHRpbWVXaW5kb3c7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBldmVudHNJbldpbmRvdyA9IHNvcnRlZEV2ZW50cy5maWx0ZXIoZXZlbnQgPT4ge1xyXG4gICAgICAgIGNvbnN0IGV2ZW50VGltZSA9IG5ldyBEYXRlKGV2ZW50LnRpbWVzdGFtcCkuZ2V0VGltZSgpO1xyXG4gICAgICAgIHJldHVybiBldmVudFRpbWUgPj0gd2luZG93U3RhcnQgJiYgZXZlbnRUaW1lIDw9IHdpbmRvd0VuZDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoZXZlbnRzSW5XaW5kb3cubGVuZ3RoID49IHBhdHRlcm4udGhyZXNob2xkKSB7XHJcbiAgICAgICAgLy8gUGF0csOzbiBkZXRlY3RhZG9cclxuICAgICAgICBjb25zdCBhbGVydDogU2VjdXJpdHlBbGVydCA9IHtcclxuICAgICAgICAgIGlkOiBgJHtwYXR0ZXJuLmlkfV8ke3VzZXJJZH1fJHtEYXRlLm5vdygpfWAsXHJcbiAgICAgICAgICBwYXR0ZXJuX2lkOiBwYXR0ZXJuLmlkLFxyXG4gICAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgICAgc2V2ZXJpdHk6IHBhdHRlcm4uc2V2ZXJpdHksXHJcbiAgICAgICAgICB0aXRsZTogcGF0dGVybi5uYW1lLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246IGAke3BhdHRlcm4uZGVzY3JpcHRpb259IC0gJHtldmVudHNJbldpbmRvdy5sZW5ndGh9IGV2ZW50b3MgZGV0ZWN0YWRvc2AsXHJcbiAgICAgICAgICBldmVudF9jb3VudDogZXZlbnRzSW5XaW5kb3cubGVuZ3RoLFxyXG4gICAgICAgICAgZmlyc3Rfb2NjdXJyZW5jZTogZXZlbnRzSW5XaW5kb3dbMF0udGltZXN0YW1wLFxyXG4gICAgICAgICAgbGFzdF9vY2N1cnJlbmNlOiBldmVudHNJbldpbmRvd1tldmVudHNJbldpbmRvdy5sZW5ndGggLSAxXS50aW1lc3RhbXAsXHJcbiAgICAgICAgICBzdGF0dXM6ICdvcGVuJyxcclxuICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgIHBhdHRlcm5fbmFtZTogcGF0dGVybi5uYW1lLFxyXG4gICAgICAgICAgICBldmVudHM6IGV2ZW50c0luV2luZG93Lm1hcChlID0+IGUuaWQpLFxyXG4gICAgICAgICAgICB0aHJlc2hvbGQ6IHBhdHRlcm4udGhyZXNob2xkLFxyXG4gICAgICAgICAgICB0aW1lX3dpbmRvd19taW51dGVzOiBwYXR0ZXJuLnRpbWVXaW5kb3dcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhbGVydHMucHVzaChhbGVydCk7XHJcblxyXG4gICAgICAgIC8vIEVqZWN1dGFyIGFjY2lvbmVzIGRlbCBwYXRyw7NuXHJcbiAgICAgICAgYXdhaXQgZXhlY3V0ZVBhdHRlcm5BY3Rpb25zKHBhdHRlcm4uYWN0aW9ucywgYWxlcnQsIGV2ZW50c0luV2luZG93KTtcclxuICAgICAgICBicmVhazsgLy8gU29sbyB1bmEgYWxlcnRhIHBvciBwYXRyw7NuIHBvciB1c3VhcmlvXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBhbGVydHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWZXJpZmljYSBzaSB1biBldmVudG8gY29pbmNpZGUgY29uIGxhcyBjb25kaWNpb25lcyBkZWwgcGF0csOzblxyXG4gKi9cclxuZnVuY3Rpb24gbWF0Y2hlc1BhdHRlcm5Db25kaXRpb25zKFxyXG4gIGV2ZW50OiBTZWN1cml0eUV2ZW50LFxyXG4gIGNvbmRpdGlvbnM6IFBhdHRlcm5Db25kaXRpb25bXVxyXG4pOiBib29sZWFuIHtcclxuICByZXR1cm4gY29uZGl0aW9ucy5ldmVyeShjb25kaXRpb24gPT4ge1xyXG4gICAgY29uc3QgZXZlbnRWYWx1ZSA9IChldmVudCBhcyBhbnkpW2NvbmRpdGlvbi5maWVsZF07XHJcbiAgICBcclxuICAgIHN3aXRjaCAoY29uZGl0aW9uLm9wZXJhdG9yKSB7XHJcbiAgICAgIGNhc2UgJ2VxdWFscyc6XHJcbiAgICAgICAgcmV0dXJuIGV2ZW50VmFsdWUgPT09IGNvbmRpdGlvbi52YWx1ZTtcclxuICAgICAgY2FzZSAnY29udGFpbnMnOlxyXG4gICAgICAgIHJldHVybiB0eXBlb2YgZXZlbnRWYWx1ZSA9PT0gJ3N0cmluZycgJiYgZXZlbnRWYWx1ZS5pbmNsdWRlcyhjb25kaXRpb24udmFsdWUpO1xyXG4gICAgICBjYXNlICdncmVhdGVyX3RoYW4nOlxyXG4gICAgICAgIHJldHVybiBOdW1iZXIoZXZlbnRWYWx1ZSkgPiBOdW1iZXIoY29uZGl0aW9uLnZhbHVlKTtcclxuICAgICAgY2FzZSAnbGVzc190aGFuJzpcclxuICAgICAgICByZXR1cm4gTnVtYmVyKGV2ZW50VmFsdWUpIDwgTnVtYmVyKGNvbmRpdGlvbi52YWx1ZSk7XHJcbiAgICAgIGNhc2UgJ2luJzpcclxuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShjb25kaXRpb24udmFsdWUpICYmIGNvbmRpdGlvbi52YWx1ZS5pbmNsdWRlcyhldmVudFZhbHVlKTtcclxuICAgICAgY2FzZSAnbm90X2luJzpcclxuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShjb25kaXRpb24udmFsdWUpICYmICFjb25kaXRpb24udmFsdWUuaW5jbHVkZXMoZXZlbnRWYWx1ZSk7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogRWplY3V0YSBsYXMgYWNjaW9uZXMgZGVmaW5pZGFzIHBhcmEgdW4gcGF0csOzblxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVBhdHRlcm5BY3Rpb25zKFxyXG4gIGFjdGlvbnM6IFNlY3VyaXR5QWN0aW9uW10sXHJcbiAgYWxlcnQ6IFNlY3VyaXR5QWxlcnQsXHJcbiAgZXZlbnRzOiBTZWN1cml0eUV2ZW50W11cclxuKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgZm9yIChjb25zdCBhY3Rpb24gb2YgYWN0aW9ucykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xyXG4gICAgICAgIGNhc2UgJ2xvZyc6XHJcbiAgICAgICAgICBhd2FpdCBsb2dTZWN1cml0eUV2ZW50KHtcclxuICAgICAgICAgICAgdXNlcl9pZDogYWxlcnQudXNlcl9pZCxcclxuICAgICAgICAgICAgZXZlbnRfdHlwZTogJ1NVU1BJQ0lPVVNfQUNUSVZJVFknLFxyXG4gICAgICAgICAgICBldmVudF9jYXRlZ29yeTogJ3N1c3BpY2lvdXNfYmVoYXZpb3InLFxyXG4gICAgICAgICAgICBzZXZlcml0eTogYWN0aW9uLnBhcmFtZXRlcnM/LnNldmVyaXR5IHx8IGFsZXJ0LnNldmVyaXR5LFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYFBhdHLDs24gZGV0ZWN0YWRvOiAke2FsZXJ0LnRpdGxlfWAsXHJcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgICAgcGF0dGVybl9pZDogYWxlcnQucGF0dGVybl9pZCxcclxuICAgICAgICAgICAgICBhbGVydF9pZDogYWxlcnQuaWQsXHJcbiAgICAgICAgICAgICAgZXZlbnRfY291bnQ6IGFsZXJ0LmV2ZW50X2NvdW50LFxyXG4gICAgICAgICAgICAgIC4uLmFjdGlvbi5wYXJhbWV0ZXJzXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ2FsZXJ0JzpcclxuICAgICAgICAgIGNvbnNvbGUud2FybihgW1NFQ1VSSVRZIEFMRVJUXSAke2FsZXJ0LnRpdGxlfSAtIFVzdWFyaW86ICR7YWxlcnQudXNlcl9pZH1gKTtcclxuICAgICAgICAgIGlmIChhY3Rpb24ucGFyYW1ldGVycz8ubm90aWZ5X2FkbWlucykge1xyXG4gICAgICAgICAgICAvLyBBcXXDrSBzZSBwb2Ryw61hIGludGVncmFyIGNvbiB1biBzaXN0ZW1hIGRlIG5vdGlmaWNhY2lvbmVzXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbU0VDVVJJVFldIE5vdGlmaWNhbmRvIGEgYWRtaW5pc3RyYWRvcmVzLi4uJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAnYmxvY2tfdXNlcic6XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgW1NFQ1VSSVRZXSBCbG9xdWVhbmRvIHVzdWFyaW86ICR7YWxlcnQudXNlcl9pZH1gKTtcclxuICAgICAgICAgIC8vIEltcGxlbWVudGFyIGzDs2dpY2EgZGUgYmxvcXVlb1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ2ludmFsaWRhdGVfc2Vzc2lvbnMnOlxyXG4gICAgICAgICAgY29uc29sZS5sb2coYFtTRUNVUklUWV0gSW52YWxpZGFuZG8gc2VzaW9uZXMgZGVsIHVzdWFyaW86ICR7YWxlcnQudXNlcl9pZH1gKTtcclxuICAgICAgICAgIC8vIEludGVncmFyIGNvbiBzaXN0ZW1hIGRlIGdlc3Rpw7NuIGRlIHNlc2lvbmVzXHJcbiAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGNvbnNvbGUud2FybihgW1NFQ1VSSVRZXSBBY2Npw7NuIG5vIHJlY29ub2NpZGE6ICR7YWN0aW9uLnR5cGV9YCk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtTRUNVUklUWV0gRXJyb3IgZWplY3V0YW5kbyBhY2Npw7NuICR7YWN0aW9uLnR5cGV9OmAsIGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEZVTkNJT05FUyBERSBNw4lUUklDQVMgWSBSRVBPUlRFU1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuLyoqXHJcbiAqIE9idGllbmUgbcOpdHJpY2FzIGRlIHNlZ3VyaWRhZCBlbiB0aWVtcG8gcmVhbFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlY3VyaXR5TWV0cmljcygpOiBQcm9taXNlPFNlY3VyaXR5TWV0cmljcz4ge1xyXG4gIHRyeSB7XHJcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm8gZGlzcG9uaWJsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNhY2hlID0gQ2FjaGVNYW5hZ2VyLmdldEluc3RhbmNlKCk7XHJcbiAgICBjb25zdCBjYWNoZUtleSA9ICdzZWN1cml0eV9tZXRyaWNzJztcclxuXHJcbiAgICAvLyBJbnRlbnRhciBvYnRlbmVyIGRlc2RlIGNhY2hlXHJcbiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCBjYWNoZS5nZXQoQ0FDSEVfQ09ORklHUy5VU0VSX1NFU1NJT04sIGNhY2hlS2V5KTtcclxuICAgIGlmIChjYWNoZWQpIHtcclxuICAgICAgcmV0dXJuIGNhY2hlZCBhcyBTZWN1cml0eU1ldHJpY3M7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcclxuICAgIGNvbnN0IGxhc3QyNGggPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gMjQgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKTtcclxuXHJcbiAgICAvLyBPYnRlbmVyIGV2ZW50b3MgZGUgbGFzIMO6bHRpbWFzIDI0IGhvcmFzXHJcbiAgICBjb25zdCB7IGRhdGE6IGV2ZW50cywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3NlY3VyaXR5X2V2ZW50cycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAuZ3RlKCd0aW1lc3RhbXAnLCBsYXN0MjRoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBvYnRlbmllbmRvIGV2ZW50b3M6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBPYnRlbmVyIGFsZXJ0YXMgYWN0aXZhc1xyXG4gICAgY29uc3QgeyBkYXRhOiBhbGVydHMsIGVycm9yOiBhbGVydHNFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc2VjdXJpdHlfYWxlcnRzJylcclxuICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAuZXEoJ3N0YXR1cycsICdvcGVuJyk7XHJcblxyXG4gICAgaWYgKGFsZXJ0c0Vycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTRUNVUklUWV0gRXJyb3Igb2J0ZW5pZW5kbyBhbGVydGFzOicsIGFsZXJ0c0Vycm9yKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDYWxjdWxhciBtw6l0cmljYXNcclxuICAgIGNvbnN0IHRvdGFsRXZlbnRzID0gZXZlbnRzPy5sZW5ndGggfHwgMDtcclxuICAgIGNvbnN0IGNyaXRpY2FsRXZlbnRzID0gZXZlbnRzPy5maWx0ZXIoZSA9PiBlLnNldmVyaXR5ID09PSAnY3JpdGljYWwnKS5sZW5ndGggfHwgMDtcclxuICAgIGNvbnN0IHVuaXF1ZVVzZXJzID0gbmV3IFNldChldmVudHM/Lm1hcChlID0+IGUudXNlcl9pZCkpLnNpemU7XHJcbiAgICBjb25zdCBhdXRoRmFpbHVyZXMgPSBldmVudHM/LmZpbHRlcihlID0+IGUuZXZlbnRfdHlwZSA9PT0gJ0FVVEhfRkFJTFVSRScpLmxlbmd0aCB8fCAwO1xyXG4gICAgY29uc3Qgc3VzcGljaW91c0FjdGl2aXRpZXMgPSBldmVudHM/LmZpbHRlcihlID0+IGUuZXZlbnRfdHlwZSA9PT0gJ1NVU1BJQ0lPVVNfQUNUSVZJVFknKS5sZW5ndGggfHwgMDtcclxuICAgIGNvbnN0IGFjdGl2ZUFsZXJ0cyA9IGFsZXJ0cz8ubGVuZ3RoIHx8IDA7XHJcblxyXG4gICAgLy8gQ2FsY3VsYXIgc2NvcmUgZGUgc2VndXJpZGFkICgwLTEwMClcclxuICAgIGxldCBzZWN1cml0eVNjb3JlID0gMTAwO1xyXG4gICAgaWYgKGNyaXRpY2FsRXZlbnRzID4gMCkgc2VjdXJpdHlTY29yZSAtPSBjcml0aWNhbEV2ZW50cyAqIDEwO1xyXG4gICAgaWYgKGF1dGhGYWlsdXJlcyA+IDEwKSBzZWN1cml0eVNjb3JlIC09IChhdXRoRmFpbHVyZXMgLSAxMCkgKiAyO1xyXG4gICAgaWYgKHN1c3BpY2lvdXNBY3Rpdml0aWVzID4gNSkgc2VjdXJpdHlTY29yZSAtPSAoc3VzcGljaW91c0FjdGl2aXRpZXMgLSA1KSAqIDU7XHJcbiAgICBpZiAoYWN0aXZlQWxlcnRzID4gMCkgc2VjdXJpdHlTY29yZSAtPSBhY3RpdmVBbGVydHMgKiAzO1xyXG4gICAgc2VjdXJpdHlTY29yZSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgc2VjdXJpdHlTY29yZSkpO1xyXG5cclxuICAgIGNvbnN0IG1ldHJpY3M6IFNlY3VyaXR5TWV0cmljcyA9IHtcclxuICAgICAgdG90YWxfZXZlbnRzXzI0aDogdG90YWxFdmVudHMsXHJcbiAgICAgIGNyaXRpY2FsX2V2ZW50c18yNGg6IGNyaXRpY2FsRXZlbnRzLFxyXG4gICAgICB1bmlxdWVfdXNlcnNfMjRoOiB1bmlxdWVVc2VycyxcclxuICAgICAgYXV0aF9mYWlsdXJlc18yNGg6IGF1dGhGYWlsdXJlcyxcclxuICAgICAgc3VzcGljaW91c19hY3Rpdml0aWVzXzI0aDogc3VzcGljaW91c0FjdGl2aXRpZXMsXHJcbiAgICAgIGJsb2NrZWRfdXNlcnM6IDAsIC8vIFRPRE86IGltcGxlbWVudGFyIGN1YW5kbyBzZSB0ZW5nYSBzaXN0ZW1hIGRlIGJsb3F1ZW9cclxuICAgICAgYWN0aXZlX2FsZXJ0czogYWN0aXZlQWxlcnRzLFxyXG4gICAgICBhdmdfcmVzcG9uc2VfdGltZTogMCwgLy8gVE9ETzogY2FsY3VsYXIgdGllbXBvIHByb21lZGlvIGRlIHJlc3B1ZXN0YVxyXG4gICAgICBzZWN1cml0eV9zY29yZTogc2VjdXJpdHlTY29yZVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBHdWFyZGFyIGVuIGNhY2hlIHBvciA1IG1pbnV0b3NcclxuICAgIGF3YWl0IGNhY2hlLnNldChDQUNIRV9DT05GSUdTLlVTRVJfU0VTU0lPTiwgY2FjaGVLZXksIG1ldHJpY3MpO1xyXG5cclxuICAgIHJldHVybiBtZXRyaWNzO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIG9idGVuaWVuZG8gbcOpdHJpY2FzOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHRvdGFsX2V2ZW50c18yNGg6IDAsXHJcbiAgICAgIGNyaXRpY2FsX2V2ZW50c18yNGg6IDAsXHJcbiAgICAgIHVuaXF1ZV91c2Vyc18yNGg6IDAsXHJcbiAgICAgIGF1dGhfZmFpbHVyZXNfMjRoOiAwLFxyXG4gICAgICBzdXNwaWNpb3VzX2FjdGl2aXRpZXNfMjRoOiAwLFxyXG4gICAgICBibG9ja2VkX3VzZXJzOiAwLFxyXG4gICAgICBhY3RpdmVfYWxlcnRzOiAwLFxyXG4gICAgICBhdmdfcmVzcG9uc2VfdGltZTogMCxcclxuICAgICAgc2VjdXJpdHlfc2NvcmU6IDBcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogR2VuZXJhIHVuIHJlcG9ydGUgZGUgc2VndXJpZGFkIHBhcmEgdW4gcGVyw61vZG8gZXNwZWPDrWZpY29cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVNlY3VyaXR5UmVwb3J0KFxyXG4gIHN0YXJ0RGF0ZTogRGF0ZSxcclxuICBlbmREYXRlOiBEYXRlXHJcbik6IFByb21pc2U8U2VjdXJpdHlSZXBvcnQ+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignU3VwYWJhc2UgYWRtaW4gY2xpZW50IG5vIGRpc3BvbmlibGUnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZyhgW1NFQ1VSSVRZXSBHZW5lcmFuZG8gcmVwb3J0ZSBkZSBzZWd1cmlkYWQ6ICR7c3RhcnREYXRlLnRvSVNPU3RyaW5nKCl9IC0gJHtlbmREYXRlLnRvSVNPU3RyaW5nKCl9YCk7XHJcblxyXG4gICAgLy8gT2J0ZW5lciBldmVudG9zIGRlbCBwZXLDrW9kb1xyXG4gICAgY29uc3QgeyBkYXRhOiBldmVudHMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9ldmVudHMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmd0ZSgndGltZXN0YW1wJywgc3RhcnREYXRlLnRvSVNPU3RyaW5nKCkpXHJcbiAgICAgIC5sdGUoJ3RpbWVzdGFtcCcsIGVuZERhdGUudG9JU09TdHJpbmcoKSlcclxuICAgICAgLm9yZGVyKCd0aW1lc3RhbXAnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3Igb2J0ZW5pZW5kbyBldmVudG9zOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdG90YWxFdmVudHMgPSBldmVudHM/Lmxlbmd0aCB8fCAwO1xyXG5cclxuICAgIC8vIEFncnVwYXIgcG9yIHNldmVyaWRhZFxyXG4gICAgY29uc3QgZXZlbnRzQnlTZXZlcml0eTogUmVjb3JkPFNlY3VyaXR5U2V2ZXJpdHksIG51bWJlcj4gPSB7XHJcbiAgICAgIGxvdzogMCxcclxuICAgICAgbWVkaXVtOiAwLFxyXG4gICAgICBoaWdoOiAwLFxyXG4gICAgICBjcml0aWNhbDogMFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBBZ3J1cGFyIHBvciBjYXRlZ29yw61hXHJcbiAgICBjb25zdCBldmVudHNCeUNhdGVnb3J5OiBSZWNvcmQ8U2VjdXJpdHlFdmVudENhdGVnb3J5LCBudW1iZXI+ID0ge1xyXG4gICAgICBhdXRoZW50aWNhdGlvbjogMCxcclxuICAgICAgYXV0aG9yaXphdGlvbjogMCxcclxuICAgICAgZGF0YV9hY2Nlc3M6IDAsXHJcbiAgICAgIGFkbWluX29wZXJhdGlvbnM6IDAsXHJcbiAgICAgIHN1c3BpY2lvdXNfYmVoYXZpb3I6IDBcclxuICAgIH07XHJcblxyXG4gICAgLy8gQ29udGFkb3JlcyBkZSB1c3VhcmlvcyBlIElQc1xyXG4gICAgY29uc3QgdXNlckNvdW50czogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xyXG4gICAgY29uc3QgaXBDb3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcclxuXHJcbiAgICBldmVudHM/LmZvckVhY2goZXZlbnQgPT4ge1xyXG4gICAgICAvLyBDb250YXIgcG9yIHNldmVyaWRhZFxyXG4gICAgICBldmVudHNCeVNldmVyaXR5W2V2ZW50LnNldmVyaXR5XSsrO1xyXG5cclxuICAgICAgLy8gQ29udGFyIHBvciBjYXRlZ29yw61hXHJcbiAgICAgIGV2ZW50c0J5Q2F0ZWdvcnlbZXZlbnQuZXZlbnRfY2F0ZWdvcnldKys7XHJcblxyXG4gICAgICAvLyBDb250YXIgcG9yIHVzdWFyaW9cclxuICAgICAgdXNlckNvdW50c1tldmVudC51c2VyX2lkXSA9ICh1c2VyQ291bnRzW2V2ZW50LnVzZXJfaWRdIHx8IDApICsgMTtcclxuXHJcbiAgICAgIC8vIENvbnRhciBwb3IgSVBcclxuICAgICAgaWYgKGV2ZW50LmlwX2FkZHJlc3MpIHtcclxuICAgICAgICBpcENvdW50c1tldmVudC5pcF9hZGRyZXNzXSA9IChpcENvdW50c1tldmVudC5pcF9hZGRyZXNzXSB8fCAwKSArIDE7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFRvcCB1c3VhcmlvcyAobcOhcyBldmVudG9zKVxyXG4gICAgY29uc3QgdG9wVXNlcnMgPSBPYmplY3QuZW50cmllcyh1c2VyQ291bnRzKVxyXG4gICAgICAuc29ydCgoWywgYV0sIFssIGJdKSA9PiBiIC0gYSlcclxuICAgICAgLnNsaWNlKDAsIDEwKVxyXG4gICAgICAubWFwKChbdXNlcl9pZCwgZXZlbnRfY291bnRdKSA9PiAoeyB1c2VyX2lkLCBldmVudF9jb3VudCB9KSk7XHJcblxyXG4gICAgLy8gVG9wIElQcyAobcOhcyBldmVudG9zKVxyXG4gICAgY29uc3QgdG9wSXBzID0gT2JqZWN0LmVudHJpZXMoaXBDb3VudHMpXHJcbiAgICAgIC5zb3J0KChbLCBhXSwgWywgYl0pID0+IGIgLSBhKVxyXG4gICAgICAuc2xpY2UoMCwgMTApXHJcbiAgICAgIC5tYXAoKFtpcF9hZGRyZXNzLCBldmVudF9jb3VudF0pID0+ICh7IGlwX2FkZHJlc3MsIGV2ZW50X2NvdW50IH0pKTtcclxuXHJcbiAgICAvLyBPYnRlbmVyIHBhdHJvbmVzIGRldGVjdGFkb3NcclxuICAgIGNvbnN0IHsgZGF0YTogYWxlcnRzLCBlcnJvcjogYWxlcnRzRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3NlY3VyaXR5X2FsZXJ0cycpXHJcbiAgICAgIC5zZWxlY3QoJ3BhdHRlcm5faWQnKVxyXG4gICAgICAuZ3RlKCdmaXJzdF9vY2N1cnJlbmNlJywgc3RhcnREYXRlLnRvSVNPU3RyaW5nKCkpXHJcbiAgICAgIC5sdGUoJ2xhc3Rfb2NjdXJyZW5jZScsIGVuZERhdGUudG9JU09TdHJpbmcoKSk7XHJcblxyXG4gICAgY29uc3QgcGF0dGVybnNEZXRlY3RlZDogQXJyYXk8eyBwYXR0ZXJuX2lkOiBzdHJpbmc7IG9jY3VycmVuY2VzOiBudW1iZXIgfT4gPSBbXTtcclxuICAgIGlmICghYWxlcnRzRXJyb3IgJiYgYWxlcnRzKSB7XHJcbiAgICAgIGNvbnN0IHBhdHRlcm5Db3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcclxuICAgICAgYWxlcnRzLmZvckVhY2goYWxlcnQgPT4ge1xyXG4gICAgICAgIHBhdHRlcm5Db3VudHNbYWxlcnQucGF0dGVybl9pZF0gPSAocGF0dGVybkNvdW50c1thbGVydC5wYXR0ZXJuX2lkXSB8fCAwKSArIDE7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgT2JqZWN0LmVudHJpZXMocGF0dGVybkNvdW50cykuZm9yRWFjaCgoW3BhdHRlcm5faWQsIG9jY3VycmVuY2VzXSkgPT4ge1xyXG4gICAgICAgIHBhdHRlcm5zRGV0ZWN0ZWQucHVzaCh7IHBhdHRlcm5faWQsIG9jY3VycmVuY2VzIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmFyIHJlY29tZW5kYWNpb25lc1xyXG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zID0gZ2VuZXJhdGVTZWN1cml0eVJlY29tbWVuZGF0aW9ucyhcclxuICAgICAgZXZlbnRzQnlTZXZlcml0eSxcclxuICAgICAgZXZlbnRzQnlDYXRlZ29yeSxcclxuICAgICAgcGF0dGVybnNEZXRlY3RlZFxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCByZXBvcnQ6IFNlY3VyaXR5UmVwb3J0ID0ge1xyXG4gICAgICBpZDogYHJlcG9ydF8ke0RhdGUubm93KCl9YCxcclxuICAgICAgcGVyaW9kX3N0YXJ0OiBzdGFydERhdGUudG9JU09TdHJpbmcoKSxcclxuICAgICAgcGVyaW9kX2VuZDogZW5kRGF0ZS50b0lTT1N0cmluZygpLFxyXG4gICAgICB0b3RhbF9ldmVudHM6IHRvdGFsRXZlbnRzLFxyXG4gICAgICBldmVudHNfYnlfc2V2ZXJpdHk6IGV2ZW50c0J5U2V2ZXJpdHksXHJcbiAgICAgIGV2ZW50c19ieV9jYXRlZ29yeTogZXZlbnRzQnlDYXRlZ29yeSxcclxuICAgICAgdG9wX3VzZXJzOiB0b3BVc2VycyxcclxuICAgICAgdG9wX2lwczogdG9wSXBzLFxyXG4gICAgICBwYXR0ZXJuc19kZXRlY3RlZDogcGF0dGVybnNEZXRlY3RlZCxcclxuICAgICAgcmVjb21tZW5kYXRpb25zLFxyXG4gICAgICBnZW5lcmF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBHdWFyZGFyIHJlcG9ydGUgZW4gYmFzZSBkZSBkYXRvc1xyXG4gICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3NlY3VyaXR5X3JlcG9ydHMnKVxyXG4gICAgICAuaW5zZXJ0KHJlcG9ydCk7XHJcblxyXG4gICAgaWYgKGluc2VydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTRUNVUklUWV0gRXJyb3IgZ3VhcmRhbmRvIHJlcG9ydGU6JywgaW5zZXJ0RXJyb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbU0VDVVJJVFldIFJlcG9ydGUgZ2VuZXJhZG86ICR7dG90YWxFdmVudHN9IGV2ZW50b3MgYW5hbGl6YWRvc2ApO1xyXG4gICAgcmV0dXJuIHJlcG9ydDtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignW1NFQ1VSSVRZXSBFcnJvciBnZW5lcmFuZG8gcmVwb3J0ZTonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZW5lcmEgcmVjb21lbmRhY2lvbmVzIGRlIHNlZ3VyaWRhZCBiYXNhZGFzIGVuIGxvcyBkYXRvcyBkZWwgcmVwb3J0ZVxyXG4gKi9cclxuZnVuY3Rpb24gZ2VuZXJhdGVTZWN1cml0eVJlY29tbWVuZGF0aW9ucyhcclxuICBldmVudHNCeVNldmVyaXR5OiBSZWNvcmQ8U2VjdXJpdHlTZXZlcml0eSwgbnVtYmVyPixcclxuICBldmVudHNCeUNhdGVnb3J5OiBSZWNvcmQ8U2VjdXJpdHlFdmVudENhdGVnb3J5LCBudW1iZXI+LFxyXG4gIHBhdHRlcm5zRGV0ZWN0ZWQ6IEFycmF5PHsgcGF0dGVybl9pZDogc3RyaW5nOyBvY2N1cnJlbmNlczogbnVtYmVyIH0+XHJcbik6IHN0cmluZ1tdIHtcclxuICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XHJcblxyXG4gIC8vIFJlY29tZW5kYWNpb25lcyBiYXNhZGFzIGVuIHNldmVyaWRhZFxyXG4gIGlmIChldmVudHNCeVNldmVyaXR5LmNyaXRpY2FsID4gMCkge1xyXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goYFNlIGRldGVjdGFyb24gJHtldmVudHNCeVNldmVyaXR5LmNyaXRpY2FsfSBldmVudG9zIGNyw610aWNvcy4gUmV2aXNhciBpbm1lZGlhdGFtZW50ZS5gKTtcclxuICB9XHJcblxyXG4gIGlmIChldmVudHNCeVNldmVyaXR5LmhpZ2ggPiAxMCkge1xyXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goYEFsdG8gbsO6bWVybyBkZSBldmVudG9zIGRlIHNldmVyaWRhZCBhbHRhICgke2V2ZW50c0J5U2V2ZXJpdHkuaGlnaH0pLiBDb25zaWRlcmFyIHJlZm9yemFyIG1lZGlkYXMgZGUgc2VndXJpZGFkLmApO1xyXG4gIH1cclxuXHJcbiAgLy8gUmVjb21lbmRhY2lvbmVzIGJhc2FkYXMgZW4gY2F0ZWdvcsOtYXNcclxuICBpZiAoZXZlbnRzQnlDYXRlZ29yeS5hdXRoZW50aWNhdGlvbiA+IDUwKSB7XHJcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaChgTXVjaG9zIGV2ZW50b3MgZGUgYXV0ZW50aWNhY2nDs24gKCR7ZXZlbnRzQnlDYXRlZ29yeS5hdXRoZW50aWNhdGlvbn0pLiBDb25zaWRlcmFyIGltcGxlbWVudGFyIE1GQS5gKTtcclxuICB9XHJcblxyXG4gIGlmIChldmVudHNCeUNhdGVnb3J5LmF1dGhvcml6YXRpb24gPiAyMCkge1xyXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goYEV2ZW50b3MgZGUgYXV0b3JpemFjacOzbiBlbGV2YWRvcyAoJHtldmVudHNCeUNhdGVnb3J5LmF1dGhvcml6YXRpb259KS4gUmV2aXNhciBwZXJtaXNvcyBkZSB1c3Vhcmlvcy5gKTtcclxuICB9XHJcblxyXG4gIGlmIChldmVudHNCeUNhdGVnb3J5LnN1c3BpY2lvdXNfYmVoYXZpb3IgPiA1KSB7XHJcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaChgQWN0aXZpZGFkIHNvc3BlY2hvc2EgZGV0ZWN0YWRhICgke2V2ZW50c0J5Q2F0ZWdvcnkuc3VzcGljaW91c19iZWhhdmlvcn0gZXZlbnRvcykuIE1vbml0b3JlYXIgZGUgY2VyY2EuYCk7XHJcbiAgfVxyXG5cclxuICAvLyBSZWNvbWVuZGFjaW9uZXMgYmFzYWRhcyBlbiBwYXRyb25lc1xyXG4gIGNvbnN0IGhpZ2hGcmVxdWVuY3lQYXR0ZXJucyA9IHBhdHRlcm5zRGV0ZWN0ZWQuZmlsdGVyKHAgPT4gcC5vY2N1cnJlbmNlcyA+IDMpO1xyXG4gIGlmIChoaWdoRnJlcXVlbmN5UGF0dGVybnMubGVuZ3RoID4gMCkge1xyXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goYFBhdHJvbmVzIGRlIHNlZ3VyaWRhZCByZWN1cnJlbnRlcyBkZXRlY3RhZG9zLiBDb25zaWRlcmFyIG1lZGlkYXMgcHJldmVudGl2YXMgYWRpY2lvbmFsZXMuYCk7XHJcbiAgfVxyXG5cclxuICAvLyBSZWNvbWVuZGFjaW9uZXMgZ2VuZXJhbGVzXHJcbiAgaWYgKHJlY29tbWVuZGF0aW9ucy5sZW5ndGggPT09IDApIHtcclxuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdObyBzZSBkZXRlY3Rhcm9uIHByb2JsZW1hcyBjcsOtdGljb3MgZGUgc2VndXJpZGFkLiBNYW50ZW5lciBtb25pdG9yZW8gcmVndWxhci4nKTtcclxuICB9XHJcblxyXG4gIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEZVTkNJT05FUyBERSBHRVNUScOTTiBERSBBTEVSVEFTXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4vKipcclxuICogT2J0aWVuZSBhbGVydGFzIGRlIHNlZ3VyaWRhZCBhY3RpdmFzXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWN0aXZlU2VjdXJpdHlBbGVydHMoXHJcbiAgdXNlcklkPzogc3RyaW5nLFxyXG4gIHNldmVyaXR5PzogU2VjdXJpdHlTZXZlcml0eVxyXG4pOiBQcm9taXNlPFNlY3VyaXR5QWxlcnRbXT4ge1xyXG4gIHRyeSB7XHJcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm8gZGlzcG9uaWJsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3NlY3VyaXR5X2FsZXJ0cycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAuZXEoJ3N0YXR1cycsICdvcGVuJylcclxuICAgICAgLm9yZGVyKCdsYXN0X29jY3VycmVuY2UnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XHJcblxyXG4gICAgaWYgKHVzZXJJZCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCd1c2VyX2lkJywgdXNlcklkKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc2V2ZXJpdHkpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc2V2ZXJpdHknLCBzZXZlcml0eSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBhbGVydHMsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBvYnRlbmllbmRvIGFsZXJ0YXM6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYWxlcnRzIHx8IFtdO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIG9idGVuaWVuZG8gYWxlcnRhcyBhY3RpdmFzOicsIGVycm9yKTtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBY3R1YWxpemEgZWwgZXN0YWRvIGRlIHVuYSBhbGVydGFcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVTZWN1cml0eUFsZXJ0KFxyXG4gIGFsZXJ0SWQ6IHN0cmluZyxcclxuICB1cGRhdGVzOiBQYXJ0aWFsPFBpY2s8U2VjdXJpdHlBbGVydCwgJ3N0YXR1cycgfCAnYXNzaWduZWRfdG8nIHwgJ3Jlc29sdXRpb25fbm90ZXMnPj5cclxuKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgdHJ5IHtcclxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGFkbWluIGNsaWVudCBubyBkaXNwb25pYmxlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc2VjdXJpdHlfYWxlcnRzJylcclxuICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgLi4udXBkYXRlcyxcclxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSlcclxuICAgICAgLmVxKCdpZCcsIGFsZXJ0SWQpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGFjdHVhbGl6YW5kbyBhbGVydGE6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZyhgW1NFQ1VSSVRZXSBBbGVydGEgJHthbGVydElkfSBhY3R1YWxpemFkYTogJHtKU09OLnN0cmluZ2lmeSh1cGRhdGVzKX1gKTtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIGFjdHVhbGl6YW5kbyBhbGVydGE6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFJlc3VlbHZlIHVuYSBhbGVydGEgZGUgc2VndXJpZGFkXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVzb2x2ZVNlY3VyaXR5QWxlcnQoXHJcbiAgYWxlcnRJZDogc3RyaW5nLFxyXG4gIHJlc29sdXRpb25Ob3Rlczogc3RyaW5nLFxyXG4gIHJlc29sdmVkQnk6IHN0cmluZ1xyXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICByZXR1cm4gYXdhaXQgdXBkYXRlU2VjdXJpdHlBbGVydChhbGVydElkLCB7XHJcbiAgICBzdGF0dXM6ICdyZXNvbHZlZCcsXHJcbiAgICBhc3NpZ25lZF90bzogcmVzb2x2ZWRCeSxcclxuICAgIHJlc29sdXRpb25fbm90ZXM6IHJlc29sdXRpb25Ob3Rlc1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogTWFyY2EgdW5hIGFsZXJ0YSBjb21vIGZhbHNvIHBvc2l0aXZvXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0FsZXJ0QXNGYWxzZVBvc2l0aXZlKFxyXG4gIGFsZXJ0SWQ6IHN0cmluZyxcclxuICBub3Rlczogc3RyaW5nLFxyXG4gIG1hcmtlZEJ5OiBzdHJpbmdcclxuKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgcmV0dXJuIGF3YWl0IHVwZGF0ZVNlY3VyaXR5QWxlcnQoYWxlcnRJZCwge1xyXG4gICAgc3RhdHVzOiAnZmFsc2VfcG9zaXRpdmUnLFxyXG4gICAgYXNzaWduZWRfdG86IG1hcmtlZEJ5LFxyXG4gICAgcmVzb2x1dGlvbl9ub3Rlczogbm90ZXNcclxuICB9KTtcclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gRlVOQ0lPTkVTIERFIE1PTklUT1JFTyBFTiBUSUVNUE8gUkVBTFxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuLyoqXHJcbiAqIEluaWNpYSBlbCBtb25pdG9yZW8gYXV0b23DoXRpY28gZGUgc2VndXJpZGFkXHJcbiAqIPCfmqsgVEVNUE9SQUxNRU5URSBERVNIQUJJTElUQURPIFBBUkEgRVZJVEFSIFJFQ1VSU0nDk05cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzdGFydFNlY3VyaXR5TW9uaXRvcmluZyhpbnRlcnZhbE1pbnV0ZXM6IG51bWJlciA9IDUpOiBOb2RlSlMuVGltZW91dCB7XHJcbiAgY29uc29sZS5sb2coYFtTRUNVUklUWV0g8J+aqyBNT05JVE9SRU8gQVVUT03DgVRJQ08gVEVNUE9SQUxNRU5URSBERVNIQUJJTElUQURPYCk7XHJcbiAgY29uc29sZS5sb2coYFtTRUNVUklUWV0g8J+TiyBSYXrDs246IEV2aXRhciBsbGFtYWRhcyByZWN1cnNpdmFzIGEgQVBJcyBkZSBhdXRoYCk7XHJcblxyXG4gIC8vIFJFVE9STkFSIFVOIFRJTUVPVVQgRFVNTVkgUEFSQSBOTyBST01QRVIgRUwgQ8OTRElHTyBRVUUgTE8gTExBTUFcclxuICByZXR1cm4gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygnW1NFQ1VSSVRZXSBUaW1lb3V0IGR1bW15IGNvbXBsZXRhZG8nKTtcclxuICB9LCAxMDAwKSBhcyBOb2RlSlMuVGltZW91dDtcclxuXHJcbiAgLy8gQ8OTRElHTyBDT01FTlRBRE8gVEVNUE9SQUxNRU5URVxyXG4gIC8vIHJldHVybiBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XHJcbiAgLy8gICB0cnkge1xyXG4gIC8vICAgICBjb25zb2xlLmxvZygnW1NFQ1VSSVRZXSBFamVjdXRhbmRvIGFuw6FsaXNpcyBhdXRvbcOhdGljby4uLicpO1xyXG5cclxuICAvLyAgICAgLy8gQW5hbGl6YXIgcGF0cm9uZXMgZGUgc2VndXJpZGFkXHJcbiAgLy8gICAgIGNvbnN0IGFsZXJ0cyA9IGF3YWl0IGFuYWx5emVTZWN1cml0eVBhdHRlcm5zKCk7XHJcblxyXG4gIC8vICAgICBpZiAoYWxlcnRzLmxlbmd0aCA+IDApIHtcclxuICAvLyAgICAgICBjb25zb2xlLmxvZyhgW1NFQ1VSSVRZXSAke2FsZXJ0cy5sZW5ndGh9IG51ZXZhcyBhbGVydGFzIGdlbmVyYWRhc2ApO1xyXG5cclxuICAvLyAgICAgICAvLyBQcm9jZXNhciBhbGVydGFzIGNyw610aWNhcyBpbm1lZGlhdGFtZW50ZVxyXG4gIC8vICAgICAgIGNvbnN0IGNyaXRpY2FsQWxlcnRzID0gYWxlcnRzLmZpbHRlcihhID0+IGEuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcpO1xyXG4gIC8vICAgICAgIGlmIChjcml0aWNhbEFsZXJ0cy5sZW5ndGggPiAwKSB7XHJcbiAgLy8gICAgICAgICBjb25zb2xlLndhcm4oYFtTRUNVUklUWV0gwqEke2NyaXRpY2FsQWxlcnRzLmxlbmd0aH0gYWxlcnRhcyBjcsOtdGljYXMgZGV0ZWN0YWRhcyFgKTtcclxuICAvLyAgICAgICAgIC8vIEFxdcOtIHNlIHBvZHLDrWFuIGVudmlhciBub3RpZmljYWNpb25lcyBpbm1lZGlhdGFzXHJcbiAgLy8gICAgICAgfVxyXG4gIC8vICAgICB9XHJcblxyXG4gIC8vICAgICAvLyBBY3R1YWxpemFyIG3DqXRyaWNhc1xyXG4gIC8vICAgICBhd2FpdCBnZXRTZWN1cml0eU1ldHJpY3MoKTtcclxuXHJcbiAgLy8gICB9IGNhdGNoIChlcnJvcikge1xyXG4gIC8vICAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIGVuIG1vbml0b3JlbyBhdXRvbcOhdGljbzonLCBlcnJvcik7XHJcbiAgLy8gICB9XHJcbiAgLy8gfSwgaW50ZXJ2YWxNaW51dGVzICogNjAgKiAxMDAwKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIERldGllbmUgZWwgbW9uaXRvcmVvIGF1dG9tw6F0aWNvXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gc3RvcFNlY3VyaXR5TW9uaXRvcmluZyhpbnRlcnZhbElkOiBOb2RlSlMuVGltZW91dCk6IHZvaWQge1xyXG4gIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZCk7XHJcbiAgY29uc29sZS5sb2coJ1tTRUNVUklUWV0gTW9uaXRvcmVvIGF1dG9tw6F0aWNvIGRldGVuaWRvJyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBFamVjdXRhIHVuYSB2ZXJpZmljYWNpw7NuIGNvbXBsZXRhIGRlIHNlZ3VyaWRhZFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJ1blNlY3VyaXR5SGVhbHRoQ2hlY2soKTogUHJvbWlzZTx7XHJcbiAgc3RhdHVzOiAnaGVhbHRoeScgfCAnd2FybmluZycgfCAnY3JpdGljYWwnO1xyXG4gIGlzc3Vlczogc3RyaW5nW107XHJcbiAgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXTtcclxuICBtZXRyaWNzOiBTZWN1cml0eU1ldHJpY3M7XHJcbn0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coJ1tTRUNVUklUWV0gRWplY3V0YW5kbyB2ZXJpZmljYWNpw7NuIGNvbXBsZXRhIGRlIHNlZ3VyaWRhZC4uLicpO1xyXG5cclxuICAgIC8vIE9idGVuZXIgbcOpdHJpY2FzIGFjdHVhbGVzXHJcbiAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgZ2V0U2VjdXJpdHlNZXRyaWNzKCk7XHJcblxyXG4gICAgLy8gT2J0ZW5lciBhbGVydGFzIGFjdGl2YXNcclxuICAgIGNvbnN0IGFjdGl2ZUFsZXJ0cyA9IGF3YWl0IGdldEFjdGl2ZVNlY3VyaXR5QWxlcnRzKCk7XHJcblxyXG4gICAgY29uc3QgaXNzdWVzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgbGV0IHN0YXR1czogJ2hlYWx0aHknIHwgJ3dhcm5pbmcnIHwgJ2NyaXRpY2FsJyA9ICdoZWFsdGh5JztcclxuXHJcbiAgICAvLyBFdmFsdWFyIGVzdGFkbyBkZSBzZWd1cmlkYWRcclxuICAgIGlmIChtZXRyaWNzLmNyaXRpY2FsX2V2ZW50c18yNGggPiAwKSB7XHJcbiAgICAgIGlzc3Vlcy5wdXNoKGAke21ldHJpY3MuY3JpdGljYWxfZXZlbnRzXzI0aH0gZXZlbnRvcyBjcsOtdGljb3MgZW4gbGFzIMO6bHRpbWFzIDI0IGhvcmFzYCk7XHJcbiAgICAgIHN0YXR1cyA9ICdjcml0aWNhbCc7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1ldHJpY3MuYXV0aF9mYWlsdXJlc18yNGggPiAyMCkge1xyXG4gICAgICBpc3N1ZXMucHVzaChgQWx0byBuw7ptZXJvIGRlIGZhbGxvcyBkZSBhdXRlbnRpY2FjacOzbjogJHttZXRyaWNzLmF1dGhfZmFpbHVyZXNfMjRofWApO1xyXG4gICAgICBpZiAoc3RhdHVzICE9PSAnY3JpdGljYWwnKSBzdGF0dXMgPSAnd2FybmluZyc7XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlcmFyIGltcGxlbWVudGFyIG1lZGlkYXMgYW50aS1icnV0ZSBmb3JjZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChtZXRyaWNzLnN1c3BpY2lvdXNfYWN0aXZpdGllc18yNGggPiAxMCkge1xyXG4gICAgICBpc3N1ZXMucHVzaChgQWN0aXZpZGFkIHNvc3BlY2hvc2EgZWxldmFkYTogJHttZXRyaWNzLnN1c3BpY2lvdXNfYWN0aXZpdGllc18yNGh9IGV2ZW50b3NgKTtcclxuICAgICAgaWYgKHN0YXR1cyAhPT0gJ2NyaXRpY2FsJykgc3RhdHVzID0gJ3dhcm5pbmcnO1xyXG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnUmV2aXNhciBwYXRyb25lcyBkZSBhY3RpdmlkYWQgc29zcGVjaG9zYScpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChtZXRyaWNzLmFjdGl2ZV9hbGVydHMgPiA1KSB7XHJcbiAgICAgIGlzc3Vlcy5wdXNoKGBNdWNoYXMgYWxlcnRhcyBhY3RpdmFzIHNpbiByZXNvbHZlcjogJHttZXRyaWNzLmFjdGl2ZV9hbGVydHN9YCk7XHJcbiAgICAgIGlmIChzdGF0dXMgIT09ICdjcml0aWNhbCcpIHN0YXR1cyA9ICd3YXJuaW5nJztcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1JldmlzYXIgeSByZXNvbHZlciBhbGVydGFzIHBlbmRpZW50ZXMnKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobWV0cmljcy5zZWN1cml0eV9zY29yZSA8IDcwKSB7XHJcbiAgICAgIGlzc3Vlcy5wdXNoKGBTY29yZSBkZSBzZWd1cmlkYWQgYmFqbzogJHttZXRyaWNzLnNlY3VyaXR5X3Njb3JlfS8xMDBgKTtcclxuICAgICAgaWYgKHN0YXR1cyAhPT0gJ2NyaXRpY2FsJykgc3RhdHVzID0gJ3dhcm5pbmcnO1xyXG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnSW1wbGVtZW50YXIgbWVkaWRhcyBwYXJhIG1lam9yYXIgZWwgc2NvcmUgZGUgc2VndXJpZGFkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVjb21lbmRhY2lvbmVzIGdlbmVyYWxlc1xyXG4gICAgaWYgKGlzc3Vlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1Npc3RlbWEgZGUgc2VndXJpZGFkIGZ1bmNpb25hbmRvIGNvcnJlY3RhbWVudGUnKTtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ01hbnRlbmVyIG1vbml0b3JlbyByZWd1bGFyIHkgYWN0dWFsaXphY2lvbmVzIGRlIHNlZ3VyaWRhZCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbU0VDVVJJVFldIFZlcmlmaWNhY2nDs24gY29tcGxldGFkYSAtIEVzdGFkbzogJHtzdGF0dXN9YCk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzLFxyXG4gICAgICBpc3N1ZXMsXHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucyxcclxuICAgICAgbWV0cmljc1xyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignW1NFQ1VSSVRZXSBFcnJvciBlbiB2ZXJpZmljYWNpw7NuIGRlIHNlZ3VyaWRhZDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdGF0dXM6ICdjcml0aWNhbCcsXHJcbiAgICAgIGlzc3VlczogWydFcnJvciBlamVjdXRhbmRvIHZlcmlmaWNhY2nDs24gZGUgc2VndXJpZGFkJ10sXHJcbiAgICAgIHJlY29tbWVuZGF0aW9uczogWydSZXZpc2FyIGxvZ3MgZGVsIHNpc3RlbWEnXSxcclxuICAgICAgbWV0cmljczogYXdhaXQgZ2V0U2VjdXJpdHlNZXRyaWNzKClcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBGVU5DSU9ORVMgREUgVVRJTElEQURcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbi8qKlxyXG4gKiBMaW1waWEgZXZlbnRvcyBkZSBzZWd1cmlkYWQgYW50aWd1b3NcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwT2xkU2VjdXJpdHlFdmVudHMoZGF5c1RvS2VlcDogbnVtYmVyID0gOTApOiBQcm9taXNlPG51bWJlcj4ge1xyXG4gIHRyeSB7XHJcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm8gZGlzcG9uaWJsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGN1dG9mZkRhdGUgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gZGF5c1RvS2VlcCAqIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc2VjdXJpdHlfZXZlbnRzJylcclxuICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgIC5sdCgndGltZXN0YW1wJywgY3V0b2ZmRGF0ZSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgbGltcGlhbmRvIGV2ZW50b3M6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBkZWxldGVkQ291bnQgPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YS5sZW5ndGggOiAwO1xyXG4gICAgY29uc29sZS5sb2coYFtTRUNVUklUWV0gTGltcGllemEgY29tcGxldGFkYTogJHtkZWxldGVkQ291bnR9IGV2ZW50b3MgZWxpbWluYWRvc2ApO1xyXG5cclxuICAgIHJldHVybiBkZWxldGVkQ291bnQ7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tTRUNVUklUWV0gRXJyb3IgZW4gbGltcGllemEgZGUgZXZlbnRvczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBFeHBvcnRhIGV2ZW50b3MgZGUgc2VndXJpZGFkIHBhcmEgYW7DoWxpc2lzIGV4dGVybm9cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHBvcnRTZWN1cml0eUV2ZW50cyhcclxuICBzdGFydERhdGU6IERhdGUsXHJcbiAgZW5kRGF0ZTogRGF0ZSxcclxuICBmb3JtYXQ6ICdqc29uJyB8ICdjc3YnID0gJ2pzb24nXHJcbik6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgdHJ5IHtcclxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGFkbWluIGNsaWVudCBubyBkaXNwb25pYmxlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBldmVudHMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9ldmVudHMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmd0ZSgndGltZXN0YW1wJywgc3RhcnREYXRlLnRvSVNPU3RyaW5nKCkpXHJcbiAgICAgIC5sdGUoJ3RpbWVzdGFtcCcsIGVuZERhdGUudG9JU09TdHJpbmcoKSlcclxuICAgICAgLm9yZGVyKCd0aW1lc3RhbXAnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBleHBvcnRhbmRvIGV2ZW50b3M6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZm9ybWF0ID09PSAnanNvbicpIHtcclxuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGV2ZW50cywgbnVsbCwgMik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBGb3JtYXRvIENTVlxyXG4gICAgICBpZiAoIWV2ZW50cyB8fCBldmVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuICdObyBoYXkgZXZlbnRvcyBwYXJhIGV4cG9ydGFyJztcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgaGVhZGVycyA9IE9iamVjdC5rZXlzKGV2ZW50c1swXSkuam9pbignLCcpO1xyXG4gICAgICBjb25zdCByb3dzID0gZXZlbnRzLm1hcChldmVudCA9PlxyXG4gICAgICAgIE9iamVjdC52YWx1ZXMoZXZlbnQpLm1hcCh2YWx1ZSA9PlxyXG4gICAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IGBcIiR7dmFsdWUucmVwbGFjZSgvXCIvZywgJ1wiXCInKX1cImAgOiB2YWx1ZVxyXG4gICAgICAgICkuam9pbignLCcpXHJcbiAgICAgICk7XHJcblxyXG4gICAgICByZXR1cm4gW2hlYWRlcnMsIC4uLnJvd3NdLmpvaW4oJ1xcbicpO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIGV4cG9ydGFuZG8gZXZlbnRvczonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkRFRkFVTFRfU0VDVVJJVFlfUEFUVEVSTlMiLCJhbmFseXplU2VjdXJpdHlQYXR0ZXJucyIsImNsZWFudXBPbGRTZWN1cml0eUV2ZW50cyIsImV4cG9ydFNlY3VyaXR5RXZlbnRzIiwiZ2VuZXJhdGVTZWN1cml0eVJlcG9ydCIsImdldEFjdGl2ZVNlY3VyaXR5QWxlcnRzIiwiZ2V0U2VjdXJpdHlNZXRyaWNzIiwibWFya0FsZXJ0QXNGYWxzZVBvc2l0aXZlIiwicmVzb2x2ZVNlY3VyaXR5QWxlcnQiLCJydW5TZWN1cml0eUhlYWx0aENoZWNrIiwic3RhcnRTZWN1cml0eU1vbml0b3JpbmciLCJzdG9wU2VjdXJpdHlNb25pdG9yaW5nIiwidXBkYXRlU2VjdXJpdHlBbGVydCIsImlkIiwibmFtZSIsImRlc2NyaXB0aW9uIiwic2V2ZXJpdHkiLCJ0aW1lV2luZG93IiwidGhyZXNob2xkIiwiZW5hYmxlZCIsImNvbmRpdGlvbnMiLCJmaWVsZCIsIm9wZXJhdG9yIiwidmFsdWUiLCJ3ZWlnaHQiLCJhY3Rpb25zIiwidHlwZSIsInBhcmFtZXRlcnMiLCJub3RpZnlfYWRtaW5zIiwicHJpb3JpdHkiLCJub3RpZnlfdXNlciIsInVzZXJJZCIsInRpbWVXaW5kb3dIb3VycyIsImNvbnNvbGUiLCJsb2ciLCJzdXBhYmFzZUFkbWluIiwiRXJyb3IiLCJ0aW1lVGhyZXNob2xkIiwiRGF0ZSIsIm5vdyIsInRvSVNPU3RyaW5nIiwiYWxlcnRzIiwicXVlcnkiLCJmcm9tIiwic2VsZWN0IiwiZ3RlIiwib3JkZXIiLCJhc2NlbmRpbmciLCJlcSIsImRhdGEiLCJldmVudHMiLCJlcnJvciIsIm1lc3NhZ2UiLCJsZW5ndGgiLCJwYXR0ZXJuIiwicGF0dGVybkFsZXJ0cyIsImRldGVjdFBhdHRlcm4iLCJwdXNoIiwiaW5zZXJ0RXJyb3IiLCJpbnNlcnQiLCJldmVudHNCeVVzZXIiLCJyZWR1Y2UiLCJhY2MiLCJldmVudCIsInVzZXJfaWQiLCJ1c2VyRXZlbnRzIiwiT2JqZWN0IiwiZW50cmllcyIsIm1hdGNoaW5nRXZlbnRzIiwiZmlsdGVyIiwibWF0Y2hlc1BhdHRlcm5Db25kaXRpb25zIiwic29ydGVkRXZlbnRzIiwic29ydCIsImEiLCJiIiwidGltZXN0YW1wIiwiZ2V0VGltZSIsImkiLCJ3aW5kb3dTdGFydCIsIndpbmRvd0VuZCIsImV2ZW50c0luV2luZG93IiwiZXZlbnRUaW1lIiwiYWxlcnQiLCJwYXR0ZXJuX2lkIiwidGl0bGUiLCJldmVudF9jb3VudCIsImZpcnN0X29jY3VycmVuY2UiLCJsYXN0X29jY3VycmVuY2UiLCJzdGF0dXMiLCJtZXRhZGF0YSIsInBhdHRlcm5fbmFtZSIsIm1hcCIsImUiLCJ0aW1lX3dpbmRvd19taW51dGVzIiwiZXhlY3V0ZVBhdHRlcm5BY3Rpb25zIiwiZXZlcnkiLCJjb25kaXRpb24iLCJldmVudFZhbHVlIiwiaW5jbHVkZXMiLCJOdW1iZXIiLCJBcnJheSIsImlzQXJyYXkiLCJhY3Rpb24iLCJsb2dTZWN1cml0eUV2ZW50IiwiZXZlbnRfdHlwZSIsImV2ZW50X2NhdGVnb3J5IiwiYWxlcnRfaWQiLCJ3YXJuIiwiY2FjaGUiLCJDYWNoZU1hbmFnZXIiLCJnZXRJbnN0YW5jZSIsImNhY2hlS2V5IiwiY2FjaGVkIiwiZ2V0IiwiQ0FDSEVfQ09ORklHUyIsIlVTRVJfU0VTU0lPTiIsImxhc3QyNGgiLCJhbGVydHNFcnJvciIsInRvdGFsRXZlbnRzIiwiY3JpdGljYWxFdmVudHMiLCJ1bmlxdWVVc2VycyIsIlNldCIsInNpemUiLCJhdXRoRmFpbHVyZXMiLCJzdXNwaWNpb3VzQWN0aXZpdGllcyIsImFjdGl2ZUFsZXJ0cyIsInNlY3VyaXR5U2NvcmUiLCJNYXRoIiwibWF4IiwibWluIiwibWV0cmljcyIsInRvdGFsX2V2ZW50c18yNGgiLCJjcml0aWNhbF9ldmVudHNfMjRoIiwidW5pcXVlX3VzZXJzXzI0aCIsImF1dGhfZmFpbHVyZXNfMjRoIiwic3VzcGljaW91c19hY3Rpdml0aWVzXzI0aCIsImJsb2NrZWRfdXNlcnMiLCJhY3RpdmVfYWxlcnRzIiwiYXZnX3Jlc3BvbnNlX3RpbWUiLCJzZWN1cml0eV9zY29yZSIsInNldCIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJsdGUiLCJldmVudHNCeVNldmVyaXR5IiwibG93IiwibWVkaXVtIiwiaGlnaCIsImNyaXRpY2FsIiwiZXZlbnRzQnlDYXRlZ29yeSIsImF1dGhlbnRpY2F0aW9uIiwiYXV0aG9yaXphdGlvbiIsImRhdGFfYWNjZXNzIiwiYWRtaW5fb3BlcmF0aW9ucyIsInN1c3BpY2lvdXNfYmVoYXZpb3IiLCJ1c2VyQ291bnRzIiwiaXBDb3VudHMiLCJmb3JFYWNoIiwiaXBfYWRkcmVzcyIsInRvcFVzZXJzIiwic2xpY2UiLCJ0b3BJcHMiLCJwYXR0ZXJuc0RldGVjdGVkIiwicGF0dGVybkNvdW50cyIsIm9jY3VycmVuY2VzIiwicmVjb21tZW5kYXRpb25zIiwiZ2VuZXJhdGVTZWN1cml0eVJlY29tbWVuZGF0aW9ucyIsInJlcG9ydCIsInBlcmlvZF9zdGFydCIsInBlcmlvZF9lbmQiLCJ0b3RhbF9ldmVudHMiLCJldmVudHNfYnlfc2V2ZXJpdHkiLCJldmVudHNfYnlfY2F0ZWdvcnkiLCJ0b3BfdXNlcnMiLCJ0b3BfaXBzIiwicGF0dGVybnNfZGV0ZWN0ZWQiLCJnZW5lcmF0ZWRfYXQiLCJoaWdoRnJlcXVlbmN5UGF0dGVybnMiLCJwIiwiYWxlcnRJZCIsInVwZGF0ZXMiLCJ1cGRhdGUiLCJ1cGRhdGVkX2F0IiwiSlNPTiIsInN0cmluZ2lmeSIsInJlc29sdXRpb25Ob3RlcyIsInJlc29sdmVkQnkiLCJhc3NpZ25lZF90byIsInJlc29sdXRpb25fbm90ZXMiLCJub3RlcyIsIm1hcmtlZEJ5IiwiaW50ZXJ2YWxNaW51dGVzIiwic2V0VGltZW91dCIsImludGVydmFsSWQiLCJjbGVhckludGVydmFsIiwiaXNzdWVzIiwiZGF5c1RvS2VlcCIsImN1dG9mZkRhdGUiLCJkZWxldGUiLCJsdCIsImRlbGV0ZWRDb3VudCIsImZvcm1hdCIsImhlYWRlcnMiLCJrZXlzIiwiam9pbiIsInJvd3MiLCJ2YWx1ZXMiLCJyZXBsYWNlIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0M7Ozs7Ozs7Ozs7O1FBc0ZZQTtlQUFBQTs7UUErRlNDO2VBQUFBOztRQTh0QkFDO2VBQUFBOztRQThCQUM7ZUFBQUE7O1FBamNBQztlQUFBQTs7UUF3TEFDO2VBQUFBOztRQWpSQUM7ZUFBQUE7O1FBdVdBQztlQUFBQTs7UUFmQUM7ZUFBQUE7O1FBbUZBQztlQUFBQTs7UUFoRE5DO2VBQUFBOztRQXdDQUM7ZUFBQUE7O1FBM0dNQztlQUFBQTs7OzBCQTdzQlE7K0JBT3ZCOzhCQUNxQztBQTRFckMsTUFBTVosNEJBQStDO0lBQzFEO1FBQ0Vh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