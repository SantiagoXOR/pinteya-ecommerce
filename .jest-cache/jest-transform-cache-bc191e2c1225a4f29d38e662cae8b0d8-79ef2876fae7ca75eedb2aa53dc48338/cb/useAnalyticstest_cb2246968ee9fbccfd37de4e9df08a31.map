{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\hooks\\useAnalytics.test.ts"],"sourcesContent":["/**\n * useAnalytics Hook Tests\n * Enterprise-ready test suite for analytics tracking\n * Pinteya E-commerce\n */\n\nimport { renderHook, act } from '@testing-library/react';\nimport { useAnalytics, useRealTimeMetrics } from '@/hooks/useAnalytics';\nimport { analytics } from '@/lib/analytics';\n\n// Mock useAuth hook\njest.mock('@/hooks/useAuth', () => ({\n  useAuth: () => ({\n    user: { id: 'test-user-123', email: 'test@example.com' },\n    isLoaded: true,\n  }),\n}));\n\n// Mock usePathname\njest.mock('next/navigation', () => ({\n  usePathname: () => '/test-page',\n}));\n\n// Mock analytics lib\njest.mock('@/lib/analytics', () => ({\n  analytics: {\n    trackEvent: jest.fn().mockResolvedValue(undefined),\n    trackEcommerceEvent: jest.fn().mockResolvedValue(undefined),\n    trackPageView: jest.fn().mockResolvedValue(undefined),\n    trackConversion: jest.fn().mockResolvedValue(undefined),\n    trackProductView: jest.fn().mockResolvedValue(undefined),\n    trackAddToCart: jest.fn().mockResolvedValue(undefined),\n    trackRemoveFromCart: jest.fn().mockResolvedValue(undefined),\n    trackCheckoutStart: jest.fn().mockResolvedValue(undefined),\n    trackPurchase: jest.fn().mockResolvedValue(undefined),\n    trackSearch: jest.fn().mockResolvedValue(undefined),\n    getEvents: jest.fn(() => []),\n    getInteractions: jest.fn(() => []),\n    getConversionMetrics: jest.fn(() => ({\n      cartAdditions: 5,\n      cartRemovals: 1,\n      checkoutStarts: 3,\n      checkoutCompletions: 2,\n      productViews: 25,\n      categoryViews: 8,\n      searchQueries: 12,\n      conversionRate: 0.08,\n      averageOrderValue: 150.75,\n      cartAbandonmentRate: 0.33,\n    })),\n    getSessionId: jest.fn(() => 'test-session-123'),\n    initialize: jest.fn().mockResolvedValue(undefined),\n    enable: jest.fn(),\n    disable: jest.fn(),\n    getMetrics: jest.fn(() => ({\n      pageViews: 100,\n      uniqueVisitors: 50,\n      bounceRate: 0.3,\n      avgSessionDuration: 180,\n      conversionRate: 0.05,\n      totalRevenue: 1000\n    })),\n    isEnabled: true\n  },\n}));\n\n// Mock window.gtag\nObject.defineProperty(window, 'gtag', {\n  value: jest.fn(),\n  writable: true,\n});\n\ndescribe('useAnalytics Hook', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Initialization', () => {\n    it('should initialize with correct default state', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      expect(result.current.isEnabled).toBe(true);\n      expect(result.current.sessionMetrics).toBeDefined();\n      expect(typeof result.current.trackEvent).toBe('function');\n      expect(typeof result.current.trackPageView).toBe('function');\n      expect(typeof result.current.getSessionId).toBe('function');\n    });\n\n    it('should provide all required tracking functions', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      const expectedFunctions = [\n        'trackEvent',\n        'trackEcommerceEvent',\n        'trackPageView',\n        'trackConversion',\n        'trackProductView',\n        'trackAddToCart',\n        'trackRemoveFromCart',\n        'trackCheckoutStart',\n        'trackPurchase',\n        'trackSearch',\n      ];\n\n      expectedFunctions.forEach(funcName => {\n        expect(typeof result.current[funcName]).toBe('function');\n      });\n    });\n  });\n\n  describe('Event Tracking', () => {\n    it('should track generic events correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.trackEvent('test_event', 'test_category', 'test_action', 'test_label', 100);\n      });\n\n      expect(analytics.trackEvent).toHaveBeenCalledWith(\n        'test_event',\n        'test_category',\n        'test_action',\n        'test_label',\n        100,\n        undefined\n      );\n    });\n\n    it('should track product view events', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.trackProductView('prod-123', 'Test Product', 'Electronics', 99.99);\n      });\n\n      expect(analytics.trackProductView).toHaveBeenCalledWith(\n        'prod-123',\n        'Test Product',\n        'Electronics',\n        99.99\n      );\n    });\n\n    it('should track add to cart events', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.trackAddToCart('prod-123', 'Test Product', 99.99, 2);\n      });\n\n      expect(analytics.trackAddToCart).toHaveBeenCalledWith(\n        'prod-123',\n        'Test Product',\n        99.99,\n        2\n      );\n    });\n\n    it('should track checkout start events', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.trackCheckoutStart(299.98, 3);\n      });\n\n      expect(analytics.trackCheckoutStart).toHaveBeenCalledWith(299.98, 3);\n    });\n\n    it('should track purchase events', () => {\n      const { result } = renderHook(() => useAnalytics());\n      const mockItems = [{ id: 'item1', name: 'Product 1', price: 99.99 }];\n\n      act(() => {\n        result.current.trackPurchase('order-123', 299.98, mockItems);\n      });\n\n      expect(analytics.trackPurchase).toHaveBeenCalledWith('order-123', 299.98, mockItems);\n    });\n\n    it('should track search events', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.trackSearch('test query', 15);\n      });\n\n      expect(analytics.trackSearch).toHaveBeenCalledWith('test query', 15);\n    });\n  });\n\n  describe('Data Retrieval', () => {\n    it('should get events correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      const events = result.current.getEvents();\n      expect(analytics.getEvents).toHaveBeenCalled();\n      expect(Array.isArray(events)).toBe(true);\n    });\n\n    it('should get session ID correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      const sessionId = result.current.getSessionId();\n      expect(analytics.getSessionId).toHaveBeenCalled();\n      expect(sessionId).toBe('test-session-123');\n    });\n\n    it('should get conversion metrics correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      const metrics = result.current.getConversionMetrics();\n      expect(analytics.getConversionMetrics).toHaveBeenCalled();\n      expect(metrics).toEqual({\n        cartAdditions: 5,\n        cartRemovals: 1,\n        checkoutStarts: 3,\n        checkoutCompletions: 2,\n        productViews: 25,\n        categoryViews: 8,\n        searchQueries: 12,\n        conversionRate: 0.08,\n        averageOrderValue: 150.75,\n        cartAbandonmentRate: 0.33,\n      });\n    });\n  });\n\n  describe('State Management', () => {\n    it('should toggle enabled state correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      expect(result.current.isEnabled).toBe(true);\n\n      act(() => {\n        result.current.setEnabled(false);\n      });\n\n      expect(result.current.isEnabled).toBe(false);\n\n      act(() => {\n        result.current.setEnabled(true);\n      });\n\n      expect(result.current.isEnabled).toBe(true);\n    });\n\n    it('should refresh metrics correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.refreshMetrics();\n      });\n\n      expect(analytics.getConversionMetrics).toHaveBeenCalled();\n    });\n  });\n});\n\ndescribe('useRealTimeMetrics Hook', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    jest.useFakeTimers();\n  });\n\n  afterEach(() => {\n    jest.useRealTimers();\n  });\n\n  it('should initialize with metrics from analytics', () => {\n    const { result } = renderHook(() => useRealTimeMetrics());\n\n    expect(result.current).toEqual({\n      cartAdditions: 5,\n      cartRemovals: 1,\n      checkoutStarts: 3,\n      checkoutCompletions: 2,\n      productViews: 25,\n      categoryViews: 8,\n      searchQueries: 12,\n      conversionRate: 0.08,\n      averageOrderValue: 150.75,\n      cartAbandonmentRate: 0.33,\n    });\n  });\n\n  it('should update metrics at specified interval', () => {\n    renderHook(() => useRealTimeMetrics(1000));\n\n    expect(analytics.getConversionMetrics).toHaveBeenCalledTimes(1);\n\n    act(() => {\n      jest.advanceTimersByTime(1000);\n    });\n\n    expect(analytics.getConversionMetrics).toHaveBeenCalledTimes(2);\n\n    act(() => {\n      jest.advanceTimersByTime(1000);\n    });\n\n    expect(analytics.getConversionMetrics).toHaveBeenCalledTimes(3);\n  });\n});\n\n// useComponentTracking tests skipped due to dependency on useOptimizedAnalytics\n// This hook will be tested separately when useOptimizedAnalytics is properly mocked"],"names":["jest","mock","useAuth","user","id","email","isLoaded","usePathname","analytics","trackEvent","fn","mockResolvedValue","undefined","trackEcommerceEvent","trackPageView","trackConversion","trackProductView","trackAddToCart","trackRemoveFromCart","trackCheckoutStart","trackPurchase","trackSearch","getEvents","getInteractions","getConversionMetrics","cartAdditions","cartRemovals","checkoutStarts","checkoutCompletions","productViews","categoryViews","searchQueries","conversionRate","averageOrderValue","cartAbandonmentRate","getSessionId","initialize","enable","disable","getMetrics","pageViews","uniqueVisitors","bounceRate","avgSessionDuration","totalRevenue","isEnabled","Object","defineProperty","window","value","writable","describe","beforeEach","clearAllMocks","it","result","renderHook","useAnalytics","expect","current","toBe","sessionMetrics","toBeDefined","expectedFunctions","forEach","funcName","act","toHaveBeenCalledWith","mockItems","name","price","events","toHaveBeenCalled","Array","isArray","sessionId","metrics","toEqual","setEnabled","refreshMetrics","useFakeTimers","afterEach","useRealTimers","useRealTimeMetrics","toHaveBeenCalledTimes","advanceTimersByTime"],"mappings":"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"}