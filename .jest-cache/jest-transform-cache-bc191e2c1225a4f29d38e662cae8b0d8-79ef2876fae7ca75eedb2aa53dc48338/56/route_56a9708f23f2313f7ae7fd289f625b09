90d2132c02f67b829e900f4a67cdfedd
/**
 * API Enterprise para crear usuario administrador
 * Refactorizada con utilidades enterprise + RLS + validaciones robustas
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    GET: function() {
        return GET;
    },
    POST: function() {
        return POST;
    }
});
const _server = require("next/server");
const _supabase = require("../../../../lib/supabase");
const _enterpriseauthutils = require("../../../../lib/auth/enterprise-auth-utils");
const _enterpriserlsutils = require("../../../../lib/auth/enterprise-rls-utils");
const _enterprisecache = require("../../../../lib/auth/enterprise-cache");
async function POST(request) {
    try {
        // ENTERPRISE: Autenticación crítica para operaciones de creación de admin
        const authResult = await (0, _enterpriseauthutils.requireCriticalAuth)(request);
        if (!authResult.success) {
            return _server.NextResponse.json({
                error: authResult.error,
                code: authResult.code,
                enterprise: true,
                operation: 'CREATE_ADMIN_USER'
            }, {
                status: authResult.status || 401
            });
        }
        const context = authResult.context;
        // ENTERPRISE: Verificar permisos específicos para crear admins
        if (!context.permissions.includes('admin_create') && context.role !== 'admin') {
            return _server.NextResponse.json({
                error: 'Permisos insuficientes para crear usuarios administradores',
                code: 'INSUFFICIENT_PERMISSIONS',
                enterprise: true,
                required_permissions: [
                    'admin_create'
                ]
            }, {
                status: 403
            });
        }
        const { securityKey, email, password, firstName = 'Admin', lastName = 'User', permissions = [
            'admin_access',
            'user_management',
            'products_create',
            'products_update',
            'products_delete'
        ] } = await request.json();
        // ENTERPRISE: Validación de clave de seguridad
        if (securityKey !== 'CREATE_ADMIN_PINTEYA_ENTERPRISE_2025') {
            return _server.NextResponse.json({
                error: 'Clave de seguridad enterprise incorrecta',
                code: 'INVALID_SECURITY_KEY',
                enterprise: true
            }, {
                status: 403
            });
        }
        // ENTERPRISE: Validaciones robustas
        if (!email || !password) {
            return _server.NextResponse.json({
                error: 'Email y contraseña son requeridos',
                code: 'MISSING_REQUIRED_FIELDS',
                enterprise: true
            }, {
                status: 400
            });
        }
        // ENTERPRISE: Validación de email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            return _server.NextResponse.json({
                error: 'Formato de email inválido',
                code: 'INVALID_EMAIL_FORMAT',
                enterprise: true
            }, {
                status: 400
            });
        }
        // ENTERPRISE: Validación de contraseña robusta
        if (password.length < 12) {
            return _server.NextResponse.json({
                error: 'La contraseña debe tener al menos 12 caracteres para admin',
                code: 'WEAK_PASSWORD',
                enterprise: true
            }, {
                status: 400
            });
        }
        // ENTERPRISE: Validación de complejidad de contraseña
        const hasUpperCase = /[A-Z]/.test(password);
        const hasLowerCase = /[a-z]/.test(password);
        const hasNumbers = /\d/.test(password);
        const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
        if (!hasUpperCase || !hasLowerCase || !hasNumbers || !hasSpecialChar) {
            return _server.NextResponse.json({
                error: 'La contraseña debe contener mayúsculas, minúsculas, números y caracteres especiales',
                code: 'PASSWORD_COMPLEXITY_FAILED',
                enterprise: true
            }, {
                status: 400
            });
        }
        // ENTERPRISE: Ejecutar creación con RLS y auditoría
        const result = await (0, _enterpriserlsutils.executeWithRLS)(context, async (client, rlsContext)=>{
            // Verificar permisos RLS específicos
            if (!(0, _enterpriserlsutils.checkRLSPermission)(rlsContext, 'admin_create')) {
                throw new Error('Permisos RLS insuficientes para crear administradores');
            }
            // 1. Verificar si el usuario ya existe en auth.users
            const { data: existingAuthUser } = await _supabase.supabaseAdmin.auth.admin.listUsers();
            const userExists = existingAuthUser.users.find((u)=>u.email === email);
            let authUser;
            if (userExists) {
                authUser = userExists;
            } else {
                // 2. Crear usuario en Supabase Auth con metadata enterprise
                const { data: newAuthUser, error: authError } = await _supabase.supabaseAdmin.auth.admin.createUser({
                    email,
                    password,
                    email_confirm: true,
                    user_metadata: {
                        first_name: firstName,
                        last_name: lastName,
                        role: 'admin',
                        created_by: context.userId,
                        enterprise_admin: true,
                        security_level: 'critical'
                    }
                });
                if (authError) {
                    throw new Error(`Error creando usuario en Auth: ${authError.message}`);
                }
                authUser = newAuthUser.user;
            }
            // 3. Verificar si el perfil ya existe
            const { data: existingProfile } = await client.from('user_profiles').select('*').eq('email', email).single();
            if (existingProfile) {
                // 4. Actualizar perfil existente con datos enterprise
                const { data: updatedProfile, error: updateError } = await client.from('user_profiles').update({
                    supabase_user_id: authUser.id,
                    first_name: firstName,
                    last_name: lastName,
                    permissions: permissions,
                    metadata: {
                        ...existingProfile.metadata,
                        updated_by: context.userId,
                        enterprise_admin: true,
                        last_admin_update: new Date().toISOString()
                    },
                    updated_at: new Date().toISOString()
                }).eq('email', email).select(`
              *,
              user_roles (
                role_name,
                permissions
              )
            `).single();
                if (updateError) {
                    throw new Error(`Error actualizando perfil: ${updateError.message}`);
                }
                return {
                    action: 'updated',
                    authUser,
                    profile: updatedProfile
                };
            } else {
                // 5. Obtener rol de admin
                const { data: adminRole } = await client.from('user_roles').select('id').eq('role_name', 'admin').single();
                if (!adminRole) {
                    throw new Error('Rol de admin no encontrado en la base de datos');
                }
                // 6. Crear nuevo perfil enterprise
                const { data: newProfile, error: profileError } = await client.from('user_profiles').insert({
                    supabase_user_id: authUser.id,
                    email,
                    first_name: firstName,
                    last_name: lastName,
                    role_id: adminRole.id,
                    permissions: permissions,
                    is_active: true,
                    is_verified: true,
                    metadata: {
                        created_by: context.userId,
                        enterprise_admin: true,
                        security_level: 'critical',
                        created_via: 'enterprise_api'
                    },
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                }).select(`
              *,
              user_roles (
                role_name,
                permissions
              )
            `).single();
                if (profileError) {
                    throw new Error(`Error creando perfil: ${profileError.message}`);
                }
                return {
                    action: 'created',
                    authUser,
                    profile: newProfile
                };
            }
        }, {
            enforceRLS: true,
            auditLog: true,
            adminOverride: true // Permitir bypass RLS para esta operación crítica
        });
        if (!result.success) {
            return _server.NextResponse.json({
                error: result.error,
                code: result.code,
                enterprise: true,
                rls: true
            }, {
                status: 400
            });
        }
        const { action, authUser, profile } = result.data;
        // ENTERPRISE: Invalidar cache relacionado
        (0, _enterprisecache.invalidateUserCache)(authUser.id);
        // ENTERPRISE: Respuesta enterprise con información completa
        return _server.NextResponse.json({
            success: true,
            message: `Usuario administrador ${action === 'created' ? 'creado' : 'actualizado'} correctamente`,
            data: {
                action,
                user: {
                    auth_id: authUser.id,
                    email: authUser.email,
                    profile: {
                        id: profile.id,
                        name: `${profile.first_name} ${profile.last_name}`,
                        role: profile.user_roles?.role_name,
                        permissions: profile.permissions,
                        is_active: profile.is_active,
                        created_at: profile.created_at
                    }
                }
            },
            enterprise: {
                security_level: 'critical',
                rls_enabled: true,
                created_by: context.userId,
                permissions_granted: permissions
            },
            timestamp: new Date().toISOString()
        }, {
            status: action === 'created' ? 201 : 200
        });
    } catch (error) {
        console.error('[ENTERPRISE] Error en create-admin-user-enterprise:', error);
        return _server.NextResponse.json({
            error: 'Error interno del servidor enterprise',
            code: 'INTERNAL_SERVER_ERROR',
            enterprise: true
        }, {
            status: 500
        });
    }
}
async function GET() {
    return _server.NextResponse.json({
        message: 'API Enterprise para crear usuario administrador',
        enterprise: true,
        instructions: {
            method: 'POST',
            required_fields: [
                'securityKey',
                'email',
                'password'
            ],
            optional_fields: [
                'firstName',
                'lastName',
                'permissions'
            ],
            security_key: 'CREATE_ADMIN_PINTEYA_ENTERPRISE_2025',
            password_requirements: {
                min_length: 12,
                must_contain: [
                    'uppercase',
                    'lowercase',
                    'numbers',
                    'special_chars'
                ]
            }
        },
        features: [
            'Enterprise authentication with critical security level',
            'Row Level Security (RLS) enforcement',
            'Robust password validation',
            'Audit logging',
            'Cache invalidation',
            'Comprehensive error handling'
        ]
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXGFkbWluXFxjcmVhdGUtYWRtaW4tdXNlci1lbnRlcnByaXNlXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFQSSBFbnRlcnByaXNlIHBhcmEgY3JlYXIgdXN1YXJpbyBhZG1pbmlzdHJhZG9yXG4gKiBSZWZhY3Rvcml6YWRhIGNvbiB1dGlsaWRhZGVzIGVudGVycHJpc2UgKyBSTFMgKyB2YWxpZGFjaW9uZXMgcm9idXN0YXNcbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcbmltcG9ydCB7IFxuICByZXF1aXJlQ3JpdGljYWxBdXRoIFxufSBmcm9tICdAL2xpYi9hdXRoL2VudGVycHJpc2UtYXV0aC11dGlscyc7XG5pbXBvcnQge1xuICBleGVjdXRlV2l0aFJMUyxcbiAgY2hlY2tSTFNQZXJtaXNzaW9uXG59IGZyb20gJ0AvbGliL2F1dGgvZW50ZXJwcmlzZS1ybHMtdXRpbHMnO1xuaW1wb3J0IHtcbiAgaW52YWxpZGF0ZVVzZXJDYWNoZVxufSBmcm9tICdAL2xpYi9hdXRoL2VudGVycHJpc2UtY2FjaGUnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIC8vIEVOVEVSUFJJU0U6IEF1dGVudGljYWNpw7NuIGNyw610aWNhIHBhcmEgb3BlcmFjaW9uZXMgZGUgY3JlYWNpw7NuIGRlIGFkbWluXG4gICAgY29uc3QgYXV0aFJlc3VsdCA9IGF3YWl0IHJlcXVpcmVDcml0aWNhbEF1dGgocmVxdWVzdCk7XG5cbiAgICBpZiAoIWF1dGhSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIGVycm9yOiBhdXRoUmVzdWx0LmVycm9yLFxuICAgICAgICAgIGNvZGU6IGF1dGhSZXN1bHQuY29kZSxcbiAgICAgICAgICBlbnRlcnByaXNlOiB0cnVlLFxuICAgICAgICAgIG9wZXJhdGlvbjogJ0NSRUFURV9BRE1JTl9VU0VSJ1xuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogYXV0aFJlc3VsdC5zdGF0dXMgfHwgNDAxIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGV4dCA9IGF1dGhSZXN1bHQuY29udGV4dCE7XG5cbiAgICAvLyBFTlRFUlBSSVNFOiBWZXJpZmljYXIgcGVybWlzb3MgZXNwZWPDrWZpY29zIHBhcmEgY3JlYXIgYWRtaW5zXG4gICAgaWYgKCFjb250ZXh0LnBlcm1pc3Npb25zLmluY2x1ZGVzKCdhZG1pbl9jcmVhdGUnKSAmJiBjb250ZXh0LnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBcbiAgICAgICAgICBlcnJvcjogJ1Blcm1pc29zIGluc3VmaWNpZW50ZXMgcGFyYSBjcmVhciB1c3VhcmlvcyBhZG1pbmlzdHJhZG9yZXMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIGVudGVycHJpc2U6IHRydWUsXG4gICAgICAgICAgcmVxdWlyZWRfcGVybWlzc2lvbnM6IFsnYWRtaW5fY3JlYXRlJ11cbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHsgXG4gICAgICBzZWN1cml0eUtleSwgXG4gICAgICBlbWFpbCwgXG4gICAgICBwYXNzd29yZCwgXG4gICAgICBmaXJzdE5hbWUgPSAnQWRtaW4nLCBcbiAgICAgIGxhc3ROYW1lID0gJ1VzZXInLFxuICAgICAgcGVybWlzc2lvbnMgPSBbJ2FkbWluX2FjY2VzcycsICd1c2VyX21hbmFnZW1lbnQnLCAncHJvZHVjdHNfY3JlYXRlJywgJ3Byb2R1Y3RzX3VwZGF0ZScsICdwcm9kdWN0c19kZWxldGUnXVxuICAgIH0gPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcblxuICAgIC8vIEVOVEVSUFJJU0U6IFZhbGlkYWNpw7NuIGRlIGNsYXZlIGRlIHNlZ3VyaWRhZFxuICAgIGlmIChzZWN1cml0eUtleSAhPT0gJ0NSRUFURV9BRE1JTl9QSU5URVlBX0VOVEVSUFJJU0VfMjAyNScpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBcbiAgICAgICAgICBlcnJvcjogJ0NsYXZlIGRlIHNlZ3VyaWRhZCBlbnRlcnByaXNlIGluY29ycmVjdGEnLFxuICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1NFQ1VSSVRZX0tFWScsXG4gICAgICAgICAgZW50ZXJwcmlzZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gRU5URVJQUklTRTogVmFsaWRhY2lvbmVzIHJvYnVzdGFzXG4gICAgaWYgKCFlbWFpbCB8fCAhcGFzc3dvcmQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBcbiAgICAgICAgICBlcnJvcjogJ0VtYWlsIHkgY29udHJhc2XDsWEgc29uIHJlcXVlcmlkb3MnLFxuICAgICAgICAgIGNvZGU6ICdNSVNTSU5HX1JFUVVJUkVEX0ZJRUxEUycsXG4gICAgICAgICAgZW50ZXJwcmlzZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gRU5URVJQUklTRTogVmFsaWRhY2nDs24gZGUgZW1haWxcbiAgICBjb25zdCBlbWFpbFJlZ2V4ID0gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC87XG4gICAgaWYgKCFlbWFpbFJlZ2V4LnRlc3QoZW1haWwpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgXG4gICAgICAgICAgZXJyb3I6ICdGb3JtYXRvIGRlIGVtYWlsIGludsOhbGlkbycsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfRU1BSUxfRk9STUFUJyxcbiAgICAgICAgICBlbnRlcnByaXNlOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBFTlRFUlBSSVNFOiBWYWxpZGFjacOzbiBkZSBjb250cmFzZcOxYSByb2J1c3RhXG4gICAgaWYgKHBhc3N3b3JkLmxlbmd0aCA8IDEyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgXG4gICAgICAgICAgZXJyb3I6ICdMYSBjb250cmFzZcOxYSBkZWJlIHRlbmVyIGFsIG1lbm9zIDEyIGNhcmFjdGVyZXMgcGFyYSBhZG1pbicsXG4gICAgICAgICAgY29kZTogJ1dFQUtfUEFTU1dPUkQnLFxuICAgICAgICAgIGVudGVycHJpc2U6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEVOVEVSUFJJU0U6IFZhbGlkYWNpw7NuIGRlIGNvbXBsZWppZGFkIGRlIGNvbnRyYXNlw7FhXG4gICAgY29uc3QgaGFzVXBwZXJDYXNlID0gL1tBLVpdLy50ZXN0KHBhc3N3b3JkKTtcbiAgICBjb25zdCBoYXNMb3dlckNhc2UgPSAvW2Etel0vLnRlc3QocGFzc3dvcmQpO1xuICAgIGNvbnN0IGhhc051bWJlcnMgPSAvXFxkLy50ZXN0KHBhc3N3b3JkKTtcbiAgICBjb25zdCBoYXNTcGVjaWFsQ2hhciA9IC9bIUAjJCVeJiooKSwuP1wiOnt9fDw+XS8udGVzdChwYXNzd29yZCk7XG5cbiAgICBpZiAoIWhhc1VwcGVyQ2FzZSB8fCAhaGFzTG93ZXJDYXNlIHx8ICFoYXNOdW1iZXJzIHx8ICFoYXNTcGVjaWFsQ2hhcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIGVycm9yOiAnTGEgY29udHJhc2XDsWEgZGViZSBjb250ZW5lciBtYXnDunNjdWxhcywgbWluw7pzY3VsYXMsIG7Dum1lcm9zIHkgY2FyYWN0ZXJlcyBlc3BlY2lhbGVzJyxcbiAgICAgICAgICBjb2RlOiAnUEFTU1dPUkRfQ09NUExFWElUWV9GQUlMRUQnLFxuICAgICAgICAgIGVudGVycHJpc2U6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEVOVEVSUFJJU0U6IEVqZWN1dGFyIGNyZWFjacOzbiBjb24gUkxTIHkgYXVkaXRvcsOtYVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4ZWN1dGVXaXRoUkxTKFxuICAgICAgY29udGV4dCxcbiAgICAgIGFzeW5jIChjbGllbnQsIHJsc0NvbnRleHQpID0+IHtcbiAgICAgICAgLy8gVmVyaWZpY2FyIHBlcm1pc29zIFJMUyBlc3BlY8OtZmljb3NcbiAgICAgICAgaWYgKCFjaGVja1JMU1Blcm1pc3Npb24ocmxzQ29udGV4dCwgJ2FkbWluX2NyZWF0ZScpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQZXJtaXNvcyBSTFMgaW5zdWZpY2llbnRlcyBwYXJhIGNyZWFyIGFkbWluaXN0cmFkb3JlcycpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMS4gVmVyaWZpY2FyIHNpIGVsIHVzdWFyaW8geWEgZXhpc3RlIGVuIGF1dGgudXNlcnNcbiAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ0F1dGhVc2VyIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluLmF1dGguYWRtaW4ubGlzdFVzZXJzKCk7XG4gICAgICAgIGNvbnN0IHVzZXJFeGlzdHMgPSBleGlzdGluZ0F1dGhVc2VyLnVzZXJzLmZpbmQodSA9PiB1LmVtYWlsID09PSBlbWFpbCk7XG5cbiAgICAgICAgbGV0IGF1dGhVc2VyO1xuXG4gICAgICAgIGlmICh1c2VyRXhpc3RzKSB7XG4gICAgICAgICAgYXV0aFVzZXIgPSB1c2VyRXhpc3RzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIDIuIENyZWFyIHVzdWFyaW8gZW4gU3VwYWJhc2UgQXV0aCBjb24gbWV0YWRhdGEgZW50ZXJwcmlzZVxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogbmV3QXV0aFVzZXIsIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW4uYXV0aC5hZG1pbi5jcmVhdGVVc2VyKHtcbiAgICAgICAgICAgIGVtYWlsLFxuICAgICAgICAgICAgcGFzc3dvcmQsXG4gICAgICAgICAgICBlbWFpbF9jb25maXJtOiB0cnVlLFxuICAgICAgICAgICAgdXNlcl9tZXRhZGF0YToge1xuICAgICAgICAgICAgICBmaXJzdF9uYW1lOiBmaXJzdE5hbWUsXG4gICAgICAgICAgICAgIGxhc3RfbmFtZTogbGFzdE5hbWUsXG4gICAgICAgICAgICAgIHJvbGU6ICdhZG1pbicsXG4gICAgICAgICAgICAgIGNyZWF0ZWRfYnk6IGNvbnRleHQudXNlcklkLFxuICAgICAgICAgICAgICBlbnRlcnByaXNlX2FkbWluOiB0cnVlLFxuICAgICAgICAgICAgICBzZWN1cml0eV9sZXZlbDogJ2NyaXRpY2FsJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKGF1dGhFcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBjcmVhbmRvIHVzdWFyaW8gZW4gQXV0aDogJHthdXRoRXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBhdXRoVXNlciA9IG5ld0F1dGhVc2VyLnVzZXI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAzLiBWZXJpZmljYXIgc2kgZWwgcGVyZmlsIHlhIGV4aXN0ZVxuICAgICAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nUHJvZmlsZSB9ID0gYXdhaXQgY2xpZW50XG4gICAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxuICAgICAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgICAgIC5lcSgnZW1haWwnLCBlbWFpbClcbiAgICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nUHJvZmlsZSkge1xuICAgICAgICAgIC8vIDQuIEFjdHVhbGl6YXIgcGVyZmlsIGV4aXN0ZW50ZSBjb24gZGF0b3MgZW50ZXJwcmlzZVxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFByb2ZpbGUsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgY2xpZW50XG4gICAgICAgICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXG4gICAgICAgICAgICAudXBkYXRlKHtcbiAgICAgICAgICAgICAgc3VwYWJhc2VfdXNlcl9pZDogYXV0aFVzZXIuaWQsXG4gICAgICAgICAgICAgIGZpcnN0X25hbWU6IGZpcnN0TmFtZSxcbiAgICAgICAgICAgICAgbGFzdF9uYW1lOiBsYXN0TmFtZSxcbiAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHBlcm1pc3Npb25zLFxuICAgICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICAgIC4uLmV4aXN0aW5nUHJvZmlsZS5tZXRhZGF0YSxcbiAgICAgICAgICAgICAgICB1cGRhdGVkX2J5OiBjb250ZXh0LnVzZXJJZCxcbiAgICAgICAgICAgICAgICBlbnRlcnByaXNlX2FkbWluOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhc3RfYWRtaW5fdXBkYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxuICAgICAgICAgICAgLnNlbGVjdChgXG4gICAgICAgICAgICAgICosXG4gICAgICAgICAgICAgIHVzZXJfcm9sZXMgKFxuICAgICAgICAgICAgICAgIHJvbGVfbmFtZSxcbiAgICAgICAgICAgICAgICBwZXJtaXNzaW9uc1xuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBgKVxuICAgICAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGFjdHVhbGl6YW5kbyBwZXJmaWw6ICR7dXBkYXRlRXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYWN0aW9uOiAndXBkYXRlZCcsXG4gICAgICAgICAgICBhdXRoVXNlcixcbiAgICAgICAgICAgIHByb2ZpbGU6IHVwZGF0ZWRQcm9maWxlXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyA1LiBPYnRlbmVyIHJvbCBkZSBhZG1pblxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogYWRtaW5Sb2xlIH0gPSBhd2FpdCBjbGllbnRcbiAgICAgICAgICAgIC5mcm9tKCd1c2VyX3JvbGVzJylcbiAgICAgICAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgICAgICAgIC5lcSgncm9sZV9uYW1lJywgJ2FkbWluJylcbiAgICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICAgIGlmICghYWRtaW5Sb2xlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JvbCBkZSBhZG1pbiBubyBlbmNvbnRyYWRvIGVuIGxhIGJhc2UgZGUgZGF0b3MnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyA2LiBDcmVhciBudWV2byBwZXJmaWwgZW50ZXJwcmlzZVxuICAgICAgICAgIGNvbnN0IHsgZGF0YTogbmV3UHJvZmlsZSwgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgY2xpZW50XG4gICAgICAgICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXG4gICAgICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICAgICAgc3VwYWJhc2VfdXNlcl9pZDogYXV0aFVzZXIuaWQsXG4gICAgICAgICAgICAgIGVtYWlsLFxuICAgICAgICAgICAgICBmaXJzdF9uYW1lOiBmaXJzdE5hbWUsXG4gICAgICAgICAgICAgIGxhc3RfbmFtZTogbGFzdE5hbWUsXG4gICAgICAgICAgICAgIHJvbGVfaWQ6IGFkbWluUm9sZS5pZCxcbiAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHBlcm1pc3Npb25zLFxuICAgICAgICAgICAgICBpc19hY3RpdmU6IHRydWUsXG4gICAgICAgICAgICAgIGlzX3ZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICAgIGNyZWF0ZWRfYnk6IGNvbnRleHQudXNlcklkLFxuICAgICAgICAgICAgICAgIGVudGVycHJpc2VfYWRtaW46IHRydWUsXG4gICAgICAgICAgICAgICAgc2VjdXJpdHlfbGV2ZWw6ICdjcml0aWNhbCcsXG4gICAgICAgICAgICAgICAgY3JlYXRlZF92aWE6ICdlbnRlcnByaXNlX2FwaSdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc2VsZWN0KGBcbiAgICAgICAgICAgICAgKixcbiAgICAgICAgICAgICAgdXNlcl9yb2xlcyAoXG4gICAgICAgICAgICAgICAgcm9sZV9uYW1lLFxuICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIGApXG4gICAgICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgICAgICBpZiAocHJvZmlsZUVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGNyZWFuZG8gcGVyZmlsOiAke3Byb2ZpbGVFcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhY3Rpb246ICdjcmVhdGVkJyxcbiAgICAgICAgICAgIGF1dGhVc2VyLFxuICAgICAgICAgICAgcHJvZmlsZTogbmV3UHJvZmlsZVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGVuZm9yY2VSTFM6IHRydWUsXG4gICAgICAgIGF1ZGl0TG9nOiB0cnVlLFxuICAgICAgICBhZG1pbk92ZXJyaWRlOiB0cnVlIC8vIFBlcm1pdGlyIGJ5cGFzcyBSTFMgcGFyYSBlc3RhIG9wZXJhY2nDs24gY3LDrXRpY2FcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IFxuICAgICAgICAgIGVycm9yOiByZXN1bHQuZXJyb3IsXG4gICAgICAgICAgY29kZTogcmVzdWx0LmNvZGUsXG4gICAgICAgICAgZW50ZXJwcmlzZTogdHJ1ZSxcbiAgICAgICAgICBybHM6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHsgYWN0aW9uLCBhdXRoVXNlciwgcHJvZmlsZSB9ID0gcmVzdWx0LmRhdGEhO1xuXG4gICAgLy8gRU5URVJQUklTRTogSW52YWxpZGFyIGNhY2hlIHJlbGFjaW9uYWRvXG4gICAgaW52YWxpZGF0ZVVzZXJDYWNoZShhdXRoVXNlci5pZCk7XG5cbiAgICAvLyBFTlRFUlBSSVNFOiBSZXNwdWVzdGEgZW50ZXJwcmlzZSBjb24gaW5mb3JtYWNpw7NuIGNvbXBsZXRhXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiBgVXN1YXJpbyBhZG1pbmlzdHJhZG9yICR7YWN0aW9uID09PSAnY3JlYXRlZCcgPyAnY3JlYWRvJyA6ICdhY3R1YWxpemFkbyd9IGNvcnJlY3RhbWVudGVgLFxuICAgICAgZGF0YToge1xuICAgICAgICBhY3Rpb24sXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBhdXRoX2lkOiBhdXRoVXNlci5pZCxcbiAgICAgICAgICBlbWFpbDogYXV0aFVzZXIuZW1haWwsXG4gICAgICAgICAgcHJvZmlsZToge1xuICAgICAgICAgICAgaWQ6IHByb2ZpbGUuaWQsXG4gICAgICAgICAgICBuYW1lOiBgJHtwcm9maWxlLmZpcnN0X25hbWV9ICR7cHJvZmlsZS5sYXN0X25hbWV9YCxcbiAgICAgICAgICAgIHJvbGU6IHByb2ZpbGUudXNlcl9yb2xlcz8ucm9sZV9uYW1lLFxuICAgICAgICAgICAgcGVybWlzc2lvbnM6IHByb2ZpbGUucGVybWlzc2lvbnMsXG4gICAgICAgICAgICBpc19hY3RpdmU6IHByb2ZpbGUuaXNfYWN0aXZlLFxuICAgICAgICAgICAgY3JlYXRlZF9hdDogcHJvZmlsZS5jcmVhdGVkX2F0XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZW50ZXJwcmlzZToge1xuICAgICAgICBzZWN1cml0eV9sZXZlbDogJ2NyaXRpY2FsJyxcbiAgICAgICAgcmxzX2VuYWJsZWQ6IHRydWUsXG4gICAgICAgIGNyZWF0ZWRfYnk6IGNvbnRleHQudXNlcklkLFxuICAgICAgICBwZXJtaXNzaW9uc19ncmFudGVkOiBwZXJtaXNzaW9uc1xuICAgICAgfSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfSwgeyBzdGF0dXM6IGFjdGlvbiA9PT0gJ2NyZWF0ZWQnID8gMjAxIDogMjAwIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW0VOVEVSUFJJU0VdIEVycm9yIGVuIGNyZWF0ZS1hZG1pbi11c2VyLWVudGVycHJpc2U6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgXG4gICAgICAgIGVycm9yOiAnRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3IgZW50ZXJwcmlzZScsXG4gICAgICAgIGNvZGU6ICdJTlRFUk5BTF9TRVJWRVJfRVJST1InLFxuICAgICAgICBlbnRlcnByaXNlOiB0cnVlXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKCkge1xuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgIG1lc3NhZ2U6ICdBUEkgRW50ZXJwcmlzZSBwYXJhIGNyZWFyIHVzdWFyaW8gYWRtaW5pc3RyYWRvcicsXG4gICAgZW50ZXJwcmlzZTogdHJ1ZSxcbiAgICBpbnN0cnVjdGlvbnM6IHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgcmVxdWlyZWRfZmllbGRzOiBbJ3NlY3VyaXR5S2V5JywgJ2VtYWlsJywgJ3Bhc3N3b3JkJ10sXG4gICAgICBvcHRpb25hbF9maWVsZHM6IFsnZmlyc3ROYW1lJywgJ2xhc3ROYW1lJywgJ3Blcm1pc3Npb25zJ10sXG4gICAgICBzZWN1cml0eV9rZXk6ICdDUkVBVEVfQURNSU5fUElOVEVZQV9FTlRFUlBSSVNFXzIwMjUnLFxuICAgICAgcGFzc3dvcmRfcmVxdWlyZW1lbnRzOiB7XG4gICAgICAgIG1pbl9sZW5ndGg6IDEyLFxuICAgICAgICBtdXN0X2NvbnRhaW46IFsndXBwZXJjYXNlJywgJ2xvd2VyY2FzZScsICdudW1iZXJzJywgJ3NwZWNpYWxfY2hhcnMnXVxuICAgICAgfVxuICAgIH0sXG4gICAgZmVhdHVyZXM6IFtcbiAgICAgICdFbnRlcnByaXNlIGF1dGhlbnRpY2F0aW9uIHdpdGggY3JpdGljYWwgc2VjdXJpdHkgbGV2ZWwnLFxuICAgICAgJ1JvdyBMZXZlbCBTZWN1cml0eSAoUkxTKSBlbmZvcmNlbWVudCcsXG4gICAgICAnUm9idXN0IHBhc3N3b3JkIHZhbGlkYXRpb24nLFxuICAgICAgJ0F1ZGl0IGxvZ2dpbmcnLFxuICAgICAgJ0NhY2hlIGludmFsaWRhdGlvbicsXG4gICAgICAnQ29tcHJlaGVuc2l2ZSBlcnJvciBoYW5kbGluZydcbiAgICBdXG4gIH0pO1xufVxuIl0sIm5hbWVzIjpbIkdFVCIsIlBPU1QiLCJyZXF1ZXN0IiwiYXV0aFJlc3VsdCIsInJlcXVpcmVDcml0aWNhbEF1dGgiLCJzdWNjZXNzIiwiTmV4dFJlc3BvbnNlIiwianNvbiIsImVycm9yIiwiY29kZSIsImVudGVycHJpc2UiLCJvcGVyYXRpb24iLCJzdGF0dXMiLCJjb250ZXh0IiwicGVybWlzc2lvbnMiLCJpbmNsdWRlcyIsInJvbGUiLCJyZXF1aXJlZF9wZXJtaXNzaW9ucyIsInNlY3VyaXR5S2V5IiwiZW1haWwiLCJwYXNzd29yZCIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwiZW1haWxSZWdleCIsInRlc3QiLCJsZW5ndGgiLCJoYXNVcHBlckNhc2UiLCJoYXNMb3dlckNhc2UiLCJoYXNOdW1iZXJzIiwiaGFzU3BlY2lhbENoYXIiLCJyZXN1bHQiLCJleGVjdXRlV2l0aFJMUyIsImNsaWVudCIsInJsc0NvbnRleHQiLCJjaGVja1JMU1Blcm1pc3Npb24iLCJFcnJvciIsImRhdGEiLCJleGlzdGluZ0F1dGhVc2VyIiwic3VwYWJhc2VBZG1pbiIsImF1dGgiLCJhZG1pbiIsImxpc3RVc2VycyIsInVzZXJFeGlzdHMiLCJ1c2VycyIsImZpbmQiLCJ1IiwiYXV0aFVzZXIiLCJuZXdBdXRoVXNlciIsImF1dGhFcnJvciIsImNyZWF0ZVVzZXIiLCJlbWFpbF9jb25maXJtIiwidXNlcl9tZXRhZGF0YSIsImZpcnN0X25hbWUiLCJsYXN0X25hbWUiLCJjcmVhdGVkX2J5IiwidXNlcklkIiwiZW50ZXJwcmlzZV9hZG1pbiIsInNlY3VyaXR5X2xldmVsIiwibWVzc2FnZSIsInVzZXIiLCJleGlzdGluZ1Byb2ZpbGUiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJ1cGRhdGVkUHJvZmlsZSIsInVwZGF0ZUVycm9yIiwidXBkYXRlIiwic3VwYWJhc2VfdXNlcl9pZCIsImlkIiwibWV0YWRhdGEiLCJ1cGRhdGVkX2J5IiwibGFzdF9hZG1pbl91cGRhdGUiLCJEYXRlIiwidG9JU09TdHJpbmciLCJ1cGRhdGVkX2F0IiwiYWN0aW9uIiwicHJvZmlsZSIsImFkbWluUm9sZSIsIm5ld1Byb2ZpbGUiLCJwcm9maWxlRXJyb3IiLCJpbnNlcnQiLCJyb2xlX2lkIiwiaXNfYWN0aXZlIiwiaXNfdmVyaWZpZWQiLCJjcmVhdGVkX3ZpYSIsImNyZWF0ZWRfYXQiLCJlbmZvcmNlUkxTIiwiYXVkaXRMb2ciLCJhZG1pbk92ZXJyaWRlIiwicmxzIiwiaW52YWxpZGF0ZVVzZXJDYWNoZSIsImF1dGhfaWQiLCJuYW1lIiwidXNlcl9yb2xlcyIsInJvbGVfbmFtZSIsInJsc19lbmFibGVkIiwicGVybWlzc2lvbnNfZ3JhbnRlZCIsInRpbWVzdGFtcCIsImNvbnNvbGUiLCJpbnN0cnVjdGlvbnMiLCJtZXRob2QiLCJyZXF1aXJlZF9maWVsZHMiLCJvcHRpb25hbF9maWVsZHMiLCJzZWN1cml0eV9rZXkiLCJwYXNzd29yZF9yZXF1aXJlbWVudHMiLCJtaW5fbGVuZ3RoIiwibXVzdF9jb250YWluIiwiZmVhdHVyZXMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Q0FHQzs7Ozs7Ozs7Ozs7SUFtVXFCQSxHQUFHO2VBQUhBOztJQXBUQUMsSUFBSTtlQUFKQTs7O3dCQWJvQjswQkFDWjtxQ0FHdkI7b0NBSUE7aUNBR0E7QUFFQSxlQUFlQSxLQUFLQyxPQUFvQjtJQUM3QyxJQUFJO1FBQ0YsMEVBQTBFO1FBQzFFLE1BQU1DLGFBQWEsTUFBTUMsSUFBQUEsd0NBQW1CLEVBQUNGO1FBRTdDLElBQUksQ0FBQ0MsV0FBV0UsT0FBTyxFQUFFO1lBQ3ZCLE9BQU9DLG9CQUFZLENBQUNDLElBQUksQ0FD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