c0fa7332d8a77cc80669bfff84837a63
// ===================================
// PINTEYA E-COMMERCE - AUDIT TRAIL SYSTEM ENTERPRISE
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get AuditCategory () {
        return AuditCategory;
    },
    get AuditResult () {
        return AuditResult;
    },
    get AuditSeverity () {
        return AuditSeverity;
    },
    get AuditTrailManager () {
        return AuditTrailManager;
    },
    get RETENTION_POLICIES () {
        return RETENTION_POLICIES;
    },
    get auditTrail () {
        return auditTrail;
    },
    get logAdminAction () {
        return logAdminAction;
    },
    get logAuthentication () {
        return logAuthentication;
    },
    get logDataAccess () {
        return logDataAccess;
    },
    get logPaymentEvent () {
        return logPaymentEvent;
    },
    get logSecurityViolation () {
        return logSecurityViolation;
    }
});
const _logger = require("../logger");
const _supabase = require("../supabase");
const _crypto = /*#__PURE__*/ _interop_require_default(require("crypto"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
var AuditSeverity = /*#__PURE__*/ function(AuditSeverity) {
    AuditSeverity["LOW"] = "low";
    AuditSeverity["MEDIUM"] = "medium";
    AuditSeverity["HIGH"] = "high";
    AuditSeverity["CRITICAL"] = "critical"; // Eventos de seguridad críticos
    return AuditSeverity;
}({});
var AuditCategory = /*#__PURE__*/ function(AuditCategory) {
    AuditCategory["AUTHENTICATION"] = "authentication";
    AuditCategory["AUTHORIZATION"] = "authorization";
    AuditCategory["DATA_ACCESS"] = "data_access";
    AuditCategory["DATA_MODIFICATION"] = "data_modification";
    AuditCategory["PAYMENT_PROCESSING"] = "payment_processing";
    AuditCategory["SYSTEM_ADMINISTRATION"] = "system_administration";
    AuditCategory["SECURITY_VIOLATION"] = "security_violation";
    AuditCategory["CONFIGURATION_CHANGE"] = "configuration_change";
    AuditCategory["ERROR_EVENT"] = "error_event";
    AuditCategory["COMPLIANCE_EVENT"] = "compliance_event";
    return AuditCategory;
}({});
var AuditResult = /*#__PURE__*/ function(AuditResult) {
    AuditResult["SUCCESS"] = "success";
    AuditResult["FAILURE"] = "failure";
    AuditResult["BLOCKED"] = "blocked";
    AuditResult["UNAUTHORIZED"] = "unauthorized";
    AuditResult["ERROR"] = "error";
    return AuditResult;
}({});
const RETENTION_POLICIES = [
    {
        category: "authentication",
        retentionDays: 365,
        archiveAfterDays: 90,
        requiresEncryption: true
    },
    {
        category: "authorization",
        retentionDays: 365,
        archiveAfterDays: 90,
        requiresEncryption: true
    },
    {
        category: "payment_processing",
        retentionDays: 2555,
        archiveAfterDays: 365,
        requiresEncryption: true
    },
    {
        category: "security_violation",
        retentionDays: 2555,
        archiveAfterDays: 180,
        requiresEncryption: true
    },
    {
        category: "data_access",
        retentionDays: 1095,
        archiveAfterDays: 180,
        requiresEncryption: true
    },
    {
        category: "system_administration",
        retentionDays: 1095,
        archiveAfterDays: 365,
        requiresEncryption: true
    }
];
class AuditTrailManager {
    constructor(){
        this.secretKey = process.env.AUDIT_TRAIL_SECRET_KEY || 'default-audit-key';
        if (this.secretKey === 'default-audit-key') {
            _logger.logger.warn(_logger.LogLevel.WARN, 'Using default audit trail secret key - not secure for production', {}, _logger.LogCategory.SYSTEM);
        }
    }
    static getInstance() {
        if (!AuditTrailManager.instance) {
            AuditTrailManager.instance = new AuditTrailManager();
        }
        return AuditTrailManager.instance;
    }
    /**
   * Registra un evento de auditoría
   */ async logEvent(eventData) {
        try {
            const auditEvent = {
                ...eventData,
                id: this.generateEventId(),
                timestamp: new Date().toISOString(),
                hash: ''
            };
            // Generar hash de integridad
            auditEvent.hash = this.generateEventHash(auditEvent);
            // Almacenar en base de datos
            await this.storeAuditEvent(auditEvent);
            // Verificar si requiere alertas
            if (this.requiresAlert(auditEvent)) {
                await this.sendSecurityAlert(auditEvent);
            }
            // Log estructurado
            _logger.logger.audit(_logger.LogLevel.INFO, `Audit event logged: ${auditEvent.action}`, {
                eventId: auditEvent.id,
                category: auditEvent.category,
                severity: auditEvent.severity,
                result: auditEvent.result,
                userId: auditEvent.userId
            });
        } catch (error) {
            _logger.logger.error(_logger.LogLevel.ERROR, 'Failed to log audit event', {
                error: error instanceof Error ? error.message : 'Unknown error',
                action: eventData.action,
                category: eventData.category
            }, _logger.LogCategory.SYSTEM);
        }
    }
    /**
   * Registra evento de autenticación
   */ async logAuthentication(action, result, userId, metadata, request) {
        await this.logEvent({
            userId,
            sessionId: request?.sessionId,
            action,
            resource: 'authentication',
            category: "authentication",
            severity: result === "failure" ? "high" : "medium",
            result,
            ipAddress: request?.ip || 'unknown',
            userAgent: request?.userAgent || 'unknown',
            metadata,
            complianceFlags: [
                'ISO27001',
                'AUTHENTICATION_LOG'
            ]
        });
    }
    /**
   * Registra evento de procesamiento de pagos
   */ async logPaymentEvent(action, result, paymentData, userId, request) {
        await this.logEvent({
            userId,
            action,
            resource: `payment:${paymentData.paymentId || 'unknown'}`,
            category: "payment_processing",
            severity: result === "failure" ? "high" : "low",
            result,
            ipAddress: request?.ip || 'unknown',
            userAgent: request?.userAgent || 'unknown',
            metadata: {
                ...paymentData,
                complianceRequired: true
            },
            complianceFlags: [
                'ISO27001',
                'PAYMENT_LOG',
                'FINANCIAL_COMPLIANCE'
            ]
        });
    }
    /**
   * Registra violación de seguridad
   */ async logSecurityViolation(action, details, request, metadata) {
        await this.logEvent({
            action,
            resource: 'security_system',
            category: "security_violation",
            severity: "critical",
            result: "blocked",
            ipAddress: request.ip,
            userAgent: request.userAgent,
            metadata: {
                details,
                ...metadata,
                alertRequired: true
            },
            complianceFlags: [
                'ISO27001',
                'SECURITY_INCIDENT',
                'IMMEDIATE_ALERT'
            ]
        });
    }
    /**
   * Registra acceso a datos sensibles
   */ async logDataAccess(action, resource, result, userId, request, metadata) {
        await this.logEvent({
            userId,
            action,
            resource,
            category: "data_access",
            severity: result === "unauthorized" ? "high" : "medium",
            result,
            ipAddress: request?.ip || 'unknown',
            userAgent: request?.userAgent || 'unknown',
            metadata,
            complianceFlags: [
                'ISO27001',
                'DATA_ACCESS_LOG'
            ]
        });
    }
    /**
   * Registra cambios administrativos
   */ async logAdminAction(action, resource, result, userId, request, metadata) {
        await this.logEvent({
            userId,
            action,
            resource,
            category: "system_administration",
            severity: "high",
            result,
            ipAddress: request.ip,
            userAgent: request.userAgent,
            metadata,
            complianceFlags: [
                'ISO27001',
                'ADMIN_ACTION',
                'PRIVILEGED_ACCESS'
            ]
        });
    }
    /**
   * Genera ID único para el evento
   */ generateEventId() {
        return `audit_${Date.now()}_${_crypto.default.randomBytes(8).toString('hex')}`;
    }
    /**
   * Genera hash de integridad para el evento
   */ generateEventHash(event) {
        const eventString = JSON.stringify({
            id: event.id,
            timestamp: event.timestamp,
            userId: event.userId,
            action: event.action,
            resource: event.resource,
            category: event.category,
            result: event.result
        });
        return _crypto.default.createHmac('sha256', this.secretKey).update(eventString).digest('hex');
    }
    /**
   * Almacena el evento en la base de datos
   */ async storeAuditEvent(event) {
        const supabase = (0, _supabase.getSupabaseClient)(true); // Usar cliente administrativo
        if (!supabase) {
            throw new Error('Supabase client not available for audit logging');
        }
        const { error } = await supabase.from('audit_events').insert({
            id: event.id,
            timestamp: event.timestamp,
            user_id: event.userId,
            session_id: event.sessionId,
            action: event.action,
            resource: event.resource,
            category: event.category,
            severity: event.severity,
            result: event.result,
            ip_address: event.ipAddress,
            user_agent: event.userAgent,
            request_id: event.requestId,
            metadata: event.metadata,
            hash: event.hash,
            compliance_flags: event.complianceFlags
        });
        if (error) {
            throw new Error(`Failed to store audit event: ${error.message}`);
        }
    }
    /**
   * Determina si el evento requiere alerta inmediata
   */ requiresAlert(event) {
        return event.severity === "critical" || event.category === "security_violation" || event.result === "blocked" || event.complianceFlags?.includes('IMMEDIATE_ALERT') || false;
    }
    /**
   * Envía alerta de seguridad
   */ async sendSecurityAlert(event) {
        try {
            // Log inmediato para alertas críticas
            _logger.logger.security(_logger.LogLevel.ERROR, `SECURITY ALERT: ${event.action}`, {
                eventId: event.id,
                category: event.category,
                severity: event.severity,
                result: event.result,
                ipAddress: event.ipAddress,
                userId: event.userId,
                resource: event.resource
            });
        // TODO: Implementar notificaciones adicionales (email, Slack, etc.)
        // await this.sendEmailAlert(event);
        // await this.sendSlackAlert(event);
        } catch (error) {
            _logger.logger.error(_logger.LogLevel.ERROR, 'Failed to send security alert', {
                error: error instanceof Error ? error.message : 'Unknown error',
                eventId: event.id
            }, _logger.LogCategory.SYSTEM);
        }
    }
    /**
   * Verifica la integridad de un evento
   */ async verifyEventIntegrity(event) {
        const expectedHash = this.generateEventHash({
            ...event,
            hash: ''
        });
        return event.hash === expectedHash;
    }
    /**
   * Obtiene eventos de auditoría con filtros
   */ async getAuditEvents(filters) {
        const supabase = (0, _supabase.getSupabaseClient)(true);
        if (!supabase) {
            throw new Error('Supabase client not available');
        }
        let query = supabase.from('audit_events').select('*').order('timestamp', {
            ascending: false
        });
        if (filters.userId) {
            query = query.eq('user_id', filters.userId);
        }
        if (filters.category) {
            query = query.eq('category', filters.category);
        }
        if (filters.severity) {
            query = query.eq('severity', filters.severity);
        }
        if (filters.startDate) {
            query = query.gte('timestamp', filters.startDate);
        }
        if (filters.endDate) {
            query = query.lte('timestamp', filters.endDate);
        }
        if (filters.limit) {
            query = query.limit(filters.limit);
        }
        const { data, error } = await query;
        if (error) {
            throw new Error(`Failed to retrieve audit events: ${error.message}`);
        }
        return data || [];
    }
}
const auditTrail = AuditTrailManager.getInstance();
const logAuthentication = auditTrail.logAuthentication.bind(auditTrail);
const logPaymentEvent = auditTrail.logPaymentEvent.bind(auditTrail);
const logSecurityViolation = auditTrail.logSecurityViolation.bind(auditTrail);
const logDataAccess = auditTrail.logDataAccess.bind(auditTrail);
const logAdminAction = auditTrail.logAdminAction.bind(auditTrail);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxzZWN1cml0eVxcYXVkaXQtdHJhaWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBJTlRFWUEgRS1DT01NRVJDRSAtIEFVRElUIFRSQUlMIFNZU1RFTSBFTlRFUlBSSVNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyBsb2dnZXIsIExvZ0xldmVsLCBMb2dDYXRlZ29yeSB9IGZyb20gJ0AvbGliL2xvZ2dlcic7XG5pbXBvcnQgeyBnZXRTdXBhYmFzZUNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcblxuLy8gTml2ZWxlcyBkZSBjcml0aWNpZGFkIHNlZ8O6biBJU08vSUVDIDI3MDAxOjIwMTNcbmV4cG9ydCBlbnVtIEF1ZGl0U2V2ZXJpdHkge1xuICBMT1cgPSAnbG93JywgICAgICAgICAgIC8vIEV2ZW50b3MgaW5mb3JtYXRpdm9zXG4gIE1FRElVTSA9ICdtZWRpdW0nLCAgICAgLy8gRXZlbnRvcyBkZSBhZHZlcnRlbmNpYVxuICBISUdIID0gJ2hpZ2gnLCAgICAgICAgIC8vIEV2ZW50b3MgY3LDrXRpY29zXG4gIENSSVRJQ0FMID0gJ2NyaXRpY2FsJyAgLy8gRXZlbnRvcyBkZSBzZWd1cmlkYWQgY3LDrXRpY29zXG59XG5cbi8vIENhdGVnb3LDrWFzIGRlIGV2ZW50b3MgZGUgYXVkaXRvcsOtYVxuZXhwb3J0IGVudW0gQXVkaXRDYXRlZ29yeSB7XG4gIEFVVEhFTlRJQ0FUSU9OID0gJ2F1dGhlbnRpY2F0aW9uJyxcbiAgQVVUSE9SSVpBVElPTiA9ICdhdXRob3JpemF0aW9uJyxcbiAgREFUQV9BQ0NFU1MgPSAnZGF0YV9hY2Nlc3MnLFxuICBEQVRBX01PRElGSUNBVElPTiA9ICdkYXRhX21vZGlmaWNhdGlvbicsXG4gIFBBWU1FTlRfUFJPQ0VTU0lORyA9ICdwYXltZW50X3Byb2Nlc3NpbmcnLFxuICBTWVNURU1fQURNSU5JU1RSQVRJT04gPSAnc3lzdGVtX2FkbWluaXN0cmF0aW9uJyxcbiAgU0VDVVJJVFlfVklPTEFUSU9OID0gJ3NlY3VyaXR5X3Zpb2xhdGlvbicsXG4gIENPTkZJR1VSQVRJT05fQ0hBTkdFID0gJ2NvbmZpZ3VyYXRpb25fY2hhbmdlJyxcbiAgRVJST1JfRVZFTlQgPSAnZXJyb3JfZXZlbnQnLFxuICBDT01QTElBTkNFX0VWRU5UID0gJ2NvbXBsaWFuY2VfZXZlbnQnXG59XG5cbi8vIFJlc3VsdGFkbyBkZSBvcGVyYWNpb25lc1xuZXhwb3J0IGVudW0gQXVkaXRSZXN1bHQge1xuICBTVUNDRVNTID0gJ3N1Y2Nlc3MnLFxuICBGQUlMVVJFID0gJ2ZhaWx1cmUnLFxuICBCTE9DS0VEID0gJ2Jsb2NrZWQnLFxuICBVTkFVVEhPUklaRUQgPSAndW5hdXRob3JpemVkJyxcbiAgRVJST1IgPSAnZXJyb3InXG59XG5cbi8vIEV2ZW50byBkZSBhdWRpdG9yw61hIGNvbXBsZXRvXG5leHBvcnQgaW50ZXJmYWNlIEF1ZGl0RXZlbnQge1xuICBpZDogc3RyaW5nO1xuICB0aW1lc3RhbXA6IHN0cmluZztcbiAgdXNlcklkPzogc3RyaW5nO1xuICBzZXNzaW9uSWQ/OiBzdHJpbmc7XG4gIGFjdGlvbjogc3RyaW5nO1xuICByZXNvdXJjZTogc3RyaW5nO1xuICBjYXRlZ29yeTogQXVkaXRDYXRlZ29yeTtcbiAgc2V2ZXJpdHk6IEF1ZGl0U2V2ZXJpdHk7XG4gIHJlc3VsdDogQXVkaXRSZXN1bHQ7XG4gIGlwQWRkcmVzczogc3RyaW5nO1xuICB1c2VyQWdlbnQ6IHN0cmluZztcbiAgcmVxdWVzdElkPzogc3RyaW5nO1xuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIGhhc2g6IHN0cmluZztcbiAgY29tcGxpYW5jZUZsYWdzPzogc3RyaW5nW107XG59XG5cbi8vIENvbmZpZ3VyYWNpw7NuIGRlIHJldGVuY2nDs24gc2Vnw7puIGNvbXBsaWFuY2VcbmV4cG9ydCBpbnRlcmZhY2UgUmV0ZW50aW9uUG9saWN5IHtcbiAgY2F0ZWdvcnk6IEF1ZGl0Q2F0ZWdvcnk7XG4gIHJldGVudGlvbkRheXM6IG51bWJlcjtcbiAgYXJjaGl2ZUFmdGVyRGF5czogbnVtYmVyO1xuICByZXF1aXJlc0VuY3J5cHRpb246IGJvb2xlYW47XG59XG5cbi8vIFBvbMOtdGljYXMgZGUgcmV0ZW5jacOzbiBJU08vSUVDIDI3MDAxOjIwMTNcbmV4cG9ydCBjb25zdCBSRVRFTlRJT05fUE9MSUNJRVM6IFJldGVudGlvblBvbGljeVtdID0gW1xuICB7XG4gICAgY2F0ZWdvcnk6IEF1ZGl0Q2F0ZWdvcnkuQVVUSEVOVElDQVRJT04sXG4gICAgcmV0ZW50aW9uRGF5czogMzY1LFxuICAgIGFyY2hpdmVBZnRlckRheXM6IDkwLFxuICAgIHJlcXVpcmVzRW5jcnlwdGlvbjogdHJ1ZVxuICB9LFxuICB7XG4gICAgY2F0ZWdvcnk6IEF1ZGl0Q2F0ZWdvcnkuQVVUSE9SSVpBVElPTixcbiAgICByZXRlbnRpb25EYXlzOiAzNjUsXG4gICAgYXJjaGl2ZUFmdGVyRGF5czogOTAsXG4gICAgcmVxdWlyZXNFbmNyeXB0aW9uOiB0cnVlXG4gIH0sXG4gIHtcbiAgICBjYXRlZ29yeTogQXVkaXRDYXRlZ29yeS5QQVlNRU5UX1BST0NFU1NJTkcsXG4gICAgcmV0ZW50aW9uRGF5czogMjU1NSwgLy8gNyBhw7FvcyBwYXJhIGNvbXBsaWFuY2UgZmluYW5jaWVyb1xuICAgIGFyY2hpdmVBZnRlckRheXM6IDM2NSxcbiAgICByZXF1aXJlc0VuY3J5cHRpb246IHRydWVcbiAgfSxcbiAge1xuICAgIGNhdGVnb3J5OiBBdWRpdENhdGVnb3J5LlNFQ1VSSVRZX1ZJT0xBVElPTixcbiAgICByZXRlbnRpb25EYXlzOiAyNTU1LCAvLyA3IGHDsW9zXG4gICAgYXJjaGl2ZUFmdGVyRGF5czogMTgwLFxuICAgIHJlcXVpcmVzRW5jcnlwdGlvbjogdHJ1ZVxuICB9LFxuICB7XG4gICAgY2F0ZWdvcnk6IEF1ZGl0Q2F0ZWdvcnkuREFUQV9BQ0NFU1MsXG4gICAgcmV0ZW50aW9uRGF5czogMTA5NSwgLy8gMyBhw7Fvc1xuICAgIGFyY2hpdmVBZnRlckRheXM6IDE4MCxcbiAgICByZXF1aXJlc0VuY3J5cHRpb246IHRydWVcbiAgfSxcbiAge1xuICAgIGNhdGVnb3J5OiBBdWRpdENhdGVnb3J5LlNZU1RFTV9BRE1JTklTVFJBVElPTixcbiAgICByZXRlbnRpb25EYXlzOiAxMDk1LCAvLyAzIGHDsW9zXG4gICAgYXJjaGl2ZUFmdGVyRGF5czogMzY1LFxuICAgIHJlcXVpcmVzRW5jcnlwdGlvbjogdHJ1ZVxuICB9XG5dO1xuXG4vKipcbiAqIFNpc3RlbWEgZGUgQXVkaXRvcsOtYSBFbnRlcnByaXNlIGNvbiBjb21wbGlhbmNlIElTTy9JRUMgMjcwMDE6MjAxM1xuICovXG5leHBvcnQgY2xhc3MgQXVkaXRUcmFpbE1hbmFnZXIge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogQXVkaXRUcmFpbE1hbmFnZXI7XG4gIHByaXZhdGUgc2VjcmV0S2V5OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5zZWNyZXRLZXkgPSBwcm9jZXNzLmVudi5BVURJVF9UUkFJTF9TRUNSRVRfS0VZIHx8ICdkZWZhdWx0LWF1ZGl0LWtleSc7XG4gICAgaWYgKHRoaXMuc2VjcmV0S2V5ID09PSAnZGVmYXVsdC1hdWRpdC1rZXknKSB7XG4gICAgICBsb2dnZXIud2FybihMb2dMZXZlbC5XQVJOLCAnVXNpbmcgZGVmYXVsdCBhdWRpdCB0cmFpbCBzZWNyZXQga2V5IC0gbm90IHNlY3VyZSBmb3IgcHJvZHVjdGlvbicsIHt9LCBMb2dDYXRlZ29yeS5TWVNURU0pO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBBdWRpdFRyYWlsTWFuYWdlciB7XG4gICAgaWYgKCFBdWRpdFRyYWlsTWFuYWdlci5pbnN0YW5jZSkge1xuICAgICAgQXVkaXRUcmFpbE1hbmFnZXIuaW5zdGFuY2UgPSBuZXcgQXVkaXRUcmFpbE1hbmFnZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIEF1ZGl0VHJhaWxNYW5hZ2VyLmluc3RhbmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdHJhIHVuIGV2ZW50byBkZSBhdWRpdG9yw61hXG4gICAqL1xuICBhc3luYyBsb2dFdmVudChldmVudERhdGE6IE9taXQ8QXVkaXRFdmVudCwgJ2lkJyB8ICd0aW1lc3RhbXAnIHwgJ2hhc2gnPik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhdWRpdEV2ZW50OiBBdWRpdEV2ZW50ID0ge1xuICAgICAgICAuLi5ldmVudERhdGEsXG4gICAgICAgIGlkOiB0aGlzLmdlbmVyYXRlRXZlbnRJZCgpLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgaGFzaDogJydcbiAgICAgIH07XG5cbiAgICAgIC8vIEdlbmVyYXIgaGFzaCBkZSBpbnRlZ3JpZGFkXG4gICAgICBhdWRpdEV2ZW50Lmhhc2ggPSB0aGlzLmdlbmVyYXRlRXZlbnRIYXNoKGF1ZGl0RXZlbnQpO1xuXG4gICAgICAvLyBBbG1hY2VuYXIgZW4gYmFzZSBkZSBkYXRvc1xuICAgICAgYXdhaXQgdGhpcy5zdG9yZUF1ZGl0RXZlbnQoYXVkaXRFdmVudCk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzaSByZXF1aWVyZSBhbGVydGFzXG4gICAgICBpZiAodGhpcy5yZXF1aXJlc0FsZXJ0KGF1ZGl0RXZlbnQpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2VuZFNlY3VyaXR5QWxlcnQoYXVkaXRFdmVudCk7XG4gICAgICB9XG5cbiAgICAgIC8vIExvZyBlc3RydWN0dXJhZG9cbiAgICAgIGxvZ2dlci5hdWRpdChMb2dMZXZlbC5JTkZPLCBgQXVkaXQgZXZlbnQgbG9nZ2VkOiAke2F1ZGl0RXZlbnQuYWN0aW9ufWAsIHtcbiAgICAgICAgZXZlbnRJZDogYXVkaXRFdmVudC5pZCxcbiAgICAgICAgY2F0ZWdvcnk6IGF1ZGl0RXZlbnQuY2F0ZWdvcnksXG4gICAgICAgIHNldmVyaXR5OiBhdWRpdEV2ZW50LnNldmVyaXR5LFxuICAgICAgICByZXN1bHQ6IGF1ZGl0RXZlbnQucmVzdWx0LFxuICAgICAgICB1c2VySWQ6IGF1ZGl0RXZlbnQudXNlcklkXG4gICAgICB9KTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoTG9nTGV2ZWwuRVJST1IsICdGYWlsZWQgdG8gbG9nIGF1ZGl0IGV2ZW50Jywge1xuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIGFjdGlvbjogZXZlbnREYXRhLmFjdGlvbixcbiAgICAgICAgY2F0ZWdvcnk6IGV2ZW50RGF0YS5jYXRlZ29yeVxuICAgICAgfSwgTG9nQ2F0ZWdvcnkuU1lTVEVNKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0cmEgZXZlbnRvIGRlIGF1dGVudGljYWNpw7NuXG4gICAqL1xuICBhc3luYyBsb2dBdXRoZW50aWNhdGlvbihcbiAgICBhY3Rpb246IHN0cmluZyxcbiAgICByZXN1bHQ6IEF1ZGl0UmVzdWx0LFxuICAgIHVzZXJJZD86IHN0cmluZyxcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICAgcmVxdWVzdD86IHsgaXA6IHN0cmluZzsgdXNlckFnZW50OiBzdHJpbmc7IHNlc3Npb25JZD86IHN0cmluZyB9XG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubG9nRXZlbnQoe1xuICAgICAgdXNlcklkLFxuICAgICAgc2Vzc2lvbklkOiByZXF1ZXN0Py5zZXNzaW9uSWQsXG4gICAgICBhY3Rpb24sXG4gICAgICByZXNvdXJjZTogJ2F1dGhlbnRpY2F0aW9uJyxcbiAgICAgIGNhdGVnb3J5OiBBdWRpdENhdGVnb3J5LkFVVEhFTlRJQ0FUSU9OLFxuICAgICAgc2V2ZXJpdHk6IHJlc3VsdCA9PT0gQXVkaXRSZXN1bHQuRkFJTFVSRSA/IEF1ZGl0U2V2ZXJpdHkuSElHSCA6IEF1ZGl0U2V2ZXJpdHkuTUVESVVNLFxuICAgICAgcmVzdWx0LFxuICAgICAgaXBBZGRyZXNzOiByZXF1ZXN0Py5pcCB8fCAndW5rbm93bicsXG4gICAgICB1c2VyQWdlbnQ6IHJlcXVlc3Q/LnVzZXJBZ2VudCB8fCAndW5rbm93bicsXG4gICAgICBtZXRhZGF0YSxcbiAgICAgIGNvbXBsaWFuY2VGbGFnczogWydJU08yNzAwMScsICdBVVRIRU5USUNBVElPTl9MT0cnXVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdHJhIGV2ZW50byBkZSBwcm9jZXNhbWllbnRvIGRlIHBhZ29zXG4gICAqL1xuICBhc3luYyBsb2dQYXltZW50RXZlbnQoXG4gICAgYWN0aW9uOiBzdHJpbmcsXG4gICAgcmVzdWx0OiBBdWRpdFJlc3VsdCxcbiAgICBwYXltZW50RGF0YToge1xuICAgICAgb3JkZXJJZD86IHN0cmluZztcbiAgICAgIHBheW1lbnRJZD86IHN0cmluZztcbiAgICAgIGFtb3VudD86IG51bWJlcjtcbiAgICAgIGN1cnJlbmN5Pzogc3RyaW5nO1xuICAgICAgbWV0aG9kPzogc3RyaW5nO1xuICAgIH0sXG4gICAgdXNlcklkPzogc3RyaW5nLFxuICAgIHJlcXVlc3Q/OiB7IGlwOiBzdHJpbmc7IHVzZXJBZ2VudDogc3RyaW5nIH1cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5sb2dFdmVudCh7XG4gICAgICB1c2VySWQsXG4gICAgICBhY3Rpb24sXG4gICAgICByZXNvdXJjZTogYHBheW1lbnQ6JHtwYXltZW50RGF0YS5wYXltZW50SWQgfHwgJ3Vua25vd24nfWAsXG4gICAgICBjYXRlZ29yeTogQXVkaXRDYXRlZ29yeS5QQVlNRU5UX1BST0NFU1NJTkcsXG4gICAgICBzZXZlcml0eTogcmVzdWx0ID09PSBBdWRpdFJlc3VsdC5GQUlMVVJFID8gQXVkaXRTZXZlcml0eS5ISUdIIDogQXVkaXRTZXZlcml0eS5MT1csXG4gICAgICByZXN1bHQsXG4gICAgICBpcEFkZHJlc3M6IHJlcXVlc3Q/LmlwIHx8ICd1bmtub3duJyxcbiAgICAgIHVzZXJBZ2VudDogcmVxdWVzdD8udXNlckFnZW50IHx8ICd1bmtub3duJyxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIC4uLnBheW1lbnREYXRhLFxuICAgICAgICBjb21wbGlhbmNlUmVxdWlyZWQ6IHRydWVcbiAgICAgIH0sXG4gICAgICBjb21wbGlhbmNlRmxhZ3M6IFsnSVNPMjcwMDEnLCAnUEFZTUVOVF9MT0cnLCAnRklOQU5DSUFMX0NPTVBMSUFOQ0UnXVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdHJhIHZpb2xhY2nDs24gZGUgc2VndXJpZGFkXG4gICAqL1xuICBhc3luYyBsb2dTZWN1cml0eVZpb2xhdGlvbihcbiAgICBhY3Rpb246IHN0cmluZyxcbiAgICBkZXRhaWxzOiBzdHJpbmcsXG4gICAgcmVxdWVzdDogeyBpcDogc3RyaW5nOyB1c2VyQWdlbnQ6IHN0cmluZyB9LFxuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmxvZ0V2ZW50KHtcbiAgICAgIGFjdGlvbixcbiAgICAgIHJlc291cmNlOiAnc2VjdXJpdHlfc3lzdGVtJyxcbiAgICAgIGNhdGVnb3J5OiBBdWRpdENhdGVnb3J5LlNFQ1VSSVRZX1ZJT0xBVElPTixcbiAgICAgIHNldmVyaXR5OiBBdWRpdFNldmVyaXR5LkNSSVRJQ0FMLFxuICAgICAgcmVzdWx0OiBBdWRpdFJlc3VsdC5CTE9DS0VELFxuICAgICAgaXBBZGRyZXNzOiByZXF1ZXN0LmlwLFxuICAgICAgdXNlckFnZW50OiByZXF1ZXN0LnVzZXJBZ2VudCxcbiAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgIGRldGFpbHMsXG4gICAgICAgIC4uLm1ldGFkYXRhLFxuICAgICAgICBhbGVydFJlcXVpcmVkOiB0cnVlXG4gICAgICB9LFxuICAgICAgY29tcGxpYW5jZUZsYWdzOiBbJ0lTTzI3MDAxJywgJ1NFQ1VSSVRZX0lOQ0lERU5UJywgJ0lNTUVESUFURV9BTEVSVCddXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0cmEgYWNjZXNvIGEgZGF0b3Mgc2Vuc2libGVzXG4gICAqL1xuICBhc3luYyBsb2dEYXRhQWNjZXNzKFxuICAgIGFjdGlvbjogc3RyaW5nLFxuICAgIHJlc291cmNlOiBzdHJpbmcsXG4gICAgcmVzdWx0OiBBdWRpdFJlc3VsdCxcbiAgICB1c2VySWQ/OiBzdHJpbmcsXG4gICAgcmVxdWVzdD86IHsgaXA6IHN0cmluZzsgdXNlckFnZW50OiBzdHJpbmcgfSxcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5sb2dFdmVudCh7XG4gICAgICB1c2VySWQsXG4gICAgICBhY3Rpb24sXG4gICAgICByZXNvdXJjZSxcbiAgICAgIGNhdGVnb3J5OiBBdWRpdENhdGVnb3J5LkRBVEFfQUNDRVNTLFxuICAgICAgc2V2ZXJpdHk6IHJlc3VsdCA9PT0gQXVkaXRSZXN1bHQuVU5BVVRIT1JJWkVEID8gQXVkaXRTZXZlcml0eS5ISUdIIDogQXVkaXRTZXZlcml0eS5NRURJVU0sXG4gICAgICByZXN1bHQsXG4gICAgICBpcEFkZHJlc3M6IHJlcXVlc3Q/LmlwIHx8ICd1bmtub3duJyxcbiAgICAgIHVzZXJBZ2VudDogcmVxdWVzdD8udXNlckFnZW50IHx8ICd1bmtub3duJyxcbiAgICAgIG1ldGFkYXRhLFxuICAgICAgY29tcGxpYW5jZUZsYWdzOiBbJ0lTTzI3MDAxJywgJ0RBVEFfQUNDRVNTX0xPRyddXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0cmEgY2FtYmlvcyBhZG1pbmlzdHJhdGl2b3NcbiAgICovXG4gIGFzeW5jIGxvZ0FkbWluQWN0aW9uKFxuICAgIGFjdGlvbjogc3RyaW5nLFxuICAgIHJlc291cmNlOiBzdHJpbmcsXG4gICAgcmVzdWx0OiBBdWRpdFJlc3VsdCxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICByZXF1ZXN0OiB7IGlwOiBzdHJpbmc7IHVzZXJBZ2VudDogc3RyaW5nIH0sXG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubG9nRXZlbnQoe1xuICAgICAgdXNlcklkLFxuICAgICAgYWN0aW9uLFxuICAgICAgcmVzb3VyY2UsXG4gICAgICBjYXRlZ29yeTogQXVkaXRDYXRlZ29yeS5TWVNURU1fQURNSU5JU1RSQVRJT04sXG4gICAgICBzZXZlcml0eTogQXVkaXRTZXZlcml0eS5ISUdILFxuICAgICAgcmVzdWx0LFxuICAgICAgaXBBZGRyZXNzOiByZXF1ZXN0LmlwLFxuICAgICAgdXNlckFnZW50OiByZXF1ZXN0LnVzZXJBZ2VudCxcbiAgICAgIG1ldGFkYXRhLFxuICAgICAgY29tcGxpYW5jZUZsYWdzOiBbJ0lTTzI3MDAxJywgJ0FETUlOX0FDVElPTicsICdQUklWSUxFR0VEX0FDQ0VTUyddXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhIElEIMO6bmljbyBwYXJhIGVsIGV2ZW50b1xuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUV2ZW50SWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYGF1ZGl0XyR7RGF0ZS5ub3coKX1fJHtjcnlwdG8ucmFuZG9tQnl0ZXMoOCkudG9TdHJpbmcoJ2hleCcpfWA7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhIGhhc2ggZGUgaW50ZWdyaWRhZCBwYXJhIGVsIGV2ZW50b1xuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUV2ZW50SGFzaChldmVudDogT21pdDxBdWRpdEV2ZW50LCAnaGFzaCc+KTogc3RyaW5nIHtcbiAgICBjb25zdCBldmVudFN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIGlkOiBldmVudC5pZCxcbiAgICAgIHRpbWVzdGFtcDogZXZlbnQudGltZXN0YW1wLFxuICAgICAgdXNlcklkOiBldmVudC51c2VySWQsXG4gICAgICBhY3Rpb246IGV2ZW50LmFjdGlvbixcbiAgICAgIHJlc291cmNlOiBldmVudC5yZXNvdXJjZSxcbiAgICAgIGNhdGVnb3J5OiBldmVudC5jYXRlZ29yeSxcbiAgICAgIHJlc3VsdDogZXZlbnQucmVzdWx0XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY3J5cHRvXG4gICAgICAuY3JlYXRlSG1hYygnc2hhMjU2JywgdGhpcy5zZWNyZXRLZXkpXG4gICAgICAudXBkYXRlKGV2ZW50U3RyaW5nKVxuICAgICAgLmRpZ2VzdCgnaGV4Jyk7XG4gIH1cblxuICAvKipcbiAgICogQWxtYWNlbmEgZWwgZXZlbnRvIGVuIGxhIGJhc2UgZGUgZGF0b3NcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc3RvcmVBdWRpdEV2ZW50KGV2ZW50OiBBdWRpdEV2ZW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZUNsaWVudCh0cnVlKTsgLy8gVXNhciBjbGllbnRlIGFkbWluaXN0cmF0aXZvXG5cbiAgICBpZiAoIXN1cGFiYXNlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGNsaWVudCBub3QgYXZhaWxhYmxlIGZvciBhdWRpdCBsb2dnaW5nJyk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdhdWRpdF9ldmVudHMnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIGlkOiBldmVudC5pZCxcbiAgICAgICAgdGltZXN0YW1wOiBldmVudC50aW1lc3RhbXAsXG4gICAgICAgIHVzZXJfaWQ6IGV2ZW50LnVzZXJJZCxcbiAgICAgICAgc2Vzc2lvbl9pZDogZXZlbnQuc2Vzc2lvbklkLFxuICAgICAgICBhY3Rpb246IGV2ZW50LmFjdGlvbixcbiAgICAgICAgcmVzb3VyY2U6IGV2ZW50LnJlc291cmNlLFxuICAgICAgICBjYXRlZ29yeTogZXZlbnQuY2F0ZWdvcnksXG4gICAgICAgIHNldmVyaXR5OiBldmVudC5zZXZlcml0eSxcbiAgICAgICAgcmVzdWx0OiBldmVudC5yZXN1bHQsXG4gICAgICAgIGlwX2FkZHJlc3M6IGV2ZW50LmlwQWRkcmVzcyxcbiAgICAgICAgdXNlcl9hZ2VudDogZXZlbnQudXNlckFnZW50LFxuICAgICAgICByZXF1ZXN0X2lkOiBldmVudC5yZXF1ZXN0SWQsXG4gICAgICAgIG1ldGFkYXRhOiBldmVudC5tZXRhZGF0YSxcbiAgICAgICAgaGFzaDogZXZlbnQuaGFzaCxcbiAgICAgICAgY29tcGxpYW5jZV9mbGFnczogZXZlbnQuY29tcGxpYW5jZUZsYWdzXG4gICAgICB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gc3RvcmUgYXVkaXQgZXZlbnQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5hIHNpIGVsIGV2ZW50byByZXF1aWVyZSBhbGVydGEgaW5tZWRpYXRhXG4gICAqL1xuICBwcml2YXRlIHJlcXVpcmVzQWxlcnQoZXZlbnQ6IEF1ZGl0RXZlbnQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgZXZlbnQuc2V2ZXJpdHkgPT09IEF1ZGl0U2V2ZXJpdHkuQ1JJVElDQUwgfHxcbiAgICAgIGV2ZW50LmNhdGVnb3J5ID09PSBBdWRpdENhdGVnb3J5LlNFQ1VSSVRZX1ZJT0xBVElPTiB8fFxuICAgICAgZXZlbnQucmVzdWx0ID09PSBBdWRpdFJlc3VsdC5CTE9DS0VEIHx8XG4gICAgICBldmVudC5jb21wbGlhbmNlRmxhZ3M/LmluY2x1ZGVzKCdJTU1FRElBVEVfQUxFUlQnKSB8fFxuICAgICAgZmFsc2VcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEVudsOtYSBhbGVydGEgZGUgc2VndXJpZGFkXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmRTZWN1cml0eUFsZXJ0KGV2ZW50OiBBdWRpdEV2ZW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIExvZyBpbm1lZGlhdG8gcGFyYSBhbGVydGFzIGNyw610aWNhc1xuICAgICAgbG9nZ2VyLnNlY3VyaXR5KExvZ0xldmVsLkVSUk9SLCBgU0VDVVJJVFkgQUxFUlQ6ICR7ZXZlbnQuYWN0aW9ufWAsIHtcbiAgICAgICAgZXZlbnRJZDogZXZlbnQuaWQsXG4gICAgICAgIGNhdGVnb3J5OiBldmVudC5jYXRlZ29yeSxcbiAgICAgICAgc2V2ZXJpdHk6IGV2ZW50LnNldmVyaXR5LFxuICAgICAgICByZXN1bHQ6IGV2ZW50LnJlc3VsdCxcbiAgICAgICAgaXBBZGRyZXNzOiBldmVudC5pcEFkZHJlc3MsXG4gICAgICAgIHVzZXJJZDogZXZlbnQudXNlcklkLFxuICAgICAgICByZXNvdXJjZTogZXZlbnQucmVzb3VyY2VcbiAgICAgIH0pO1xuXG4gICAgICAvLyBUT0RPOiBJbXBsZW1lbnRhciBub3RpZmljYWNpb25lcyBhZGljaW9uYWxlcyAoZW1haWwsIFNsYWNrLCBldGMuKVxuICAgICAgLy8gYXdhaXQgdGhpcy5zZW5kRW1haWxBbGVydChldmVudCk7XG4gICAgICAvLyBhd2FpdCB0aGlzLnNlbmRTbGFja0FsZXJ0KGV2ZW50KTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoTG9nTGV2ZWwuRVJST1IsICdGYWlsZWQgdG8gc2VuZCBzZWN1cml0eSBhbGVydCcsIHtcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICBldmVudElkOiBldmVudC5pZFxuICAgICAgfSwgTG9nQ2F0ZWdvcnkuU1lTVEVNKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2EgbGEgaW50ZWdyaWRhZCBkZSB1biBldmVudG9cbiAgICovXG4gIGFzeW5jIHZlcmlmeUV2ZW50SW50ZWdyaXR5KGV2ZW50OiBBdWRpdEV2ZW50KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgZXhwZWN0ZWRIYXNoID0gdGhpcy5nZW5lcmF0ZUV2ZW50SGFzaCh7XG4gICAgICAuLi5ldmVudCxcbiAgICAgIGhhc2g6ICcnXG4gICAgfSk7XG5cbiAgICByZXR1cm4gZXZlbnQuaGFzaCA9PT0gZXhwZWN0ZWRIYXNoO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idGllbmUgZXZlbnRvcyBkZSBhdWRpdG9yw61hIGNvbiBmaWx0cm9zXG4gICAqL1xuICBhc3luYyBnZXRBdWRpdEV2ZW50cyhmaWx0ZXJzOiB7XG4gICAgdXNlcklkPzogc3RyaW5nO1xuICAgIGNhdGVnb3J5PzogQXVkaXRDYXRlZ29yeTtcbiAgICBzZXZlcml0eT86IEF1ZGl0U2V2ZXJpdHk7XG4gICAgc3RhcnREYXRlPzogc3RyaW5nO1xuICAgIGVuZERhdGU/OiBzdHJpbmc7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gIH0pOiBQcm9taXNlPEF1ZGl0RXZlbnRbXT4ge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2VDbGllbnQodHJ1ZSk7XG5cbiAgICBpZiAoIXN1cGFiYXNlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGNsaWVudCBub3QgYXZhaWxhYmxlJyk7XG4gICAgfVxuXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdhdWRpdF9ldmVudHMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAub3JkZXIoJ3RpbWVzdGFtcCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcblxuICAgIGlmIChmaWx0ZXJzLnVzZXJJZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgndXNlcl9pZCcsIGZpbHRlcnMudXNlcklkKTtcbiAgICB9XG5cbiAgICBpZiAoZmlsdGVycy5jYXRlZ29yeSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY2F0ZWdvcnknLCBmaWx0ZXJzLmNhdGVnb3J5KTtcbiAgICB9XG5cbiAgICBpZiAoZmlsdGVycy5zZXZlcml0eSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc2V2ZXJpdHknLCBmaWx0ZXJzLnNldmVyaXR5KTtcbiAgICB9XG5cbiAgICBpZiAoZmlsdGVycy5zdGFydERhdGUpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZ3RlKCd0aW1lc3RhbXAnLCBmaWx0ZXJzLnN0YXJ0RGF0ZSk7XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlcnMuZW5kRGF0ZSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5sdGUoJ3RpbWVzdGFtcCcsIGZpbHRlcnMuZW5kRGF0ZSk7XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlcnMubGltaXQpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkubGltaXQoZmlsdGVycy5saW1pdCk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHJldHJpZXZlIGF1ZGl0IGV2ZW50czogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cblxuICAgIHJldHVybiBkYXRhIHx8IFtdO1xuICB9XG59XG5cbi8vIEluc3RhbmNpYSBzaW5nbGV0b25cbmV4cG9ydCBjb25zdCBhdWRpdFRyYWlsID0gQXVkaXRUcmFpbE1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcblxuLy8gRnVuY2lvbmVzIGRlIGNvbnZlbmllbmNpYVxuZXhwb3J0IGNvbnN0IGxvZ0F1dGhlbnRpY2F0aW9uID0gYXVkaXRUcmFpbC5sb2dBdXRoZW50aWNhdGlvbi5iaW5kKGF1ZGl0VHJhaWwpO1xuZXhwb3J0IGNvbnN0IGxvZ1BheW1lbnRFdmVudCA9IGF1ZGl0VHJhaWwubG9nUGF5bWVudEV2ZW50LmJpbmQoYXVkaXRUcmFpbCk7XG5leHBvcnQgY29uc3QgbG9nU2VjdXJpdHlWaW9sYXRpb24gPSBhdWRpdFRyYWlsLmxvZ1NlY3VyaXR5VmlvbGF0aW9uLmJpbmQoYXVkaXRUcmFpbCk7XG5leHBvcnQgY29uc3QgbG9nRGF0YUFjY2VzcyA9IGF1ZGl0VHJhaWwubG9nRGF0YUFjY2Vzcy5iaW5kKGF1ZGl0VHJhaWwpO1xuZXhwb3J0IGNvbnN0IGxvZ0FkbWluQWN0aW9uID0gYXVkaXRUcmFpbC5sb2dBZG1pbkFjdGlvbi5iaW5kKGF1ZGl0VHJhaWwpO1xuIl0sIm5hbWVzIjpbIkF1ZGl0Q2F0ZWdvcnkiLCJBdWRpdFJlc3VsdCIsIkF1ZGl0U2V2ZXJpdHkiLCJBdWRpdFRyYWlsTWFuYWdlciIsIlJFVEVOVElPTl9QT0xJQ0lFUyIsImF1ZGl0VHJhaWwiLCJsb2dBZG1pbkFjdGlvbiIsImxvZ0F1dGhlbnRpY2F0aW9uIiwibG9nRGF0YUFjY2VzcyIsImxvZ1BheW1lbnRFdmVudCIsImxvZ1NlY3VyaXR5VmlvbGF0aW9uIiwiY2F0ZWdvcnkiLCJyZXRlbnRpb25EYXlzIiwiYXJjaGl2ZUFmdGVyRGF5cyIsInJlcXVpcmVzRW5jcnlwdGlvbiIsInNlY3JldEtleSIsInByb2Nlc3MiLCJlbnYiLCJBVURJVF9UUkFJTF9TRUNSRVRfS0VZIiwibG9nZ2VyIiwid2FybiIsIkxvZ0xldmVsIiwiV0FSTiIsIkxvZ0NhdGVnb3J5IiwiU1lTVEVNIiwiZ2V0SW5zdGFuY2UiLCJpbnN0YW5jZSIsImxvZ0V2ZW50IiwiZXZlbnREYXRhIiwiYXVkaXRFdmVudCIsImlkIiwiZ2VuZXJhdGVFdmVudElkIiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiaGFzaCIsImdlbmVyYXRlRXZlbnRIYXNoIiwic3RvcmVBdWRpdEV2ZW50IiwicmVxdWlyZXNBbGVydCIsInNlbmRTZWN1cml0eUFsZXJ0IiwiYXVkaXQiLCJJTkZPIiwiYWN0aW9uIiwiZXZlbnRJZCIsInNldmVyaXR5IiwicmVzdWx0IiwidXNlcklkIiwiZXJyb3IiLCJFUlJPUiIsIkVycm9yIiwibWVzc2FnZSIsIm1ldGFkYXRhIiwicmVxdWVzdCIsInNlc3Npb25JZCIsInJlc291cmNlIiwiaXBBZGRyZXNzIiwiaXAiLCJ1c2VyQWdlbnQiLCJjb21wbGlhbmNlRmxhZ3MiLCJwYXltZW50RGF0YSIsInBheW1lbnRJZCIsImNvbXBsaWFuY2VSZXF1aXJlZCIsImRldGFpbHMiLCJhbGVydFJlcXVpcmVkIiwibm93IiwiY3J5cHRvIiwicmFuZG9tQnl0ZXMiLCJ0b1N0cmluZyIsImV2ZW50IiwiZXZlbnRTdHJpbmciLCJKU09OIiwic3RyaW5naWZ5IiwiY3JlYXRlSG1hYyIsInVwZGF0ZSIsImRpZ2VzdCIsInN1cGFiYXNlIiwiZ2V0U3VwYWJhc2VDbGllbnQiLCJmcm9tIiwiaW5zZXJ0IiwidXNlcl9pZCIsInNlc3Npb25faWQiLCJpcF9hZGRyZXNzIiwidXNlcl9hZ2VudCIsInJlcXVlc3RfaWQiLCJyZXF1ZXN0SWQiLCJjb21wbGlhbmNlX2ZsYWdzIiwiaW5jbHVkZXMiLCJzZWN1cml0eSIsInZlcmlmeUV2ZW50SW50ZWdyaXR5IiwiZXhwZWN0ZWRIYXNoIiwiZ2V0QXVkaXRFdmVudHMiLCJmaWx0ZXJzIiwicXVlcnkiLCJzZWxlY3QiLCJvcmRlciIsImFzY2VuZGluZyIsImVxIiwic3RhcnREYXRlIiwiZ3RlIiwiZW5kRGF0ZSIsImx0ZSIsImxpbWl0IiwiZGF0YSIsImJpbmQiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0QyxxREFBcUQ7QUFDckQsc0NBQXNDOzs7Ozs7Ozs7Ozs7UUFlMUJBO2VBQUFBOztRQWNBQztlQUFBQTs7UUF0QkFDO2VBQUFBOztRQW9HQ0M7ZUFBQUE7O1FBMUNBQztlQUFBQTs7UUF1WkFDO2VBQUFBOztRQU9BQztlQUFBQTs7UUFKQUM7ZUFBQUE7O1FBR0FDO2VBQUFBOztRQUZBQztlQUFBQTs7UUFDQUM7ZUFBQUE7Ozt3QkEzZGlDOzBCQUNaOytEQUNmOzs7Ozs7QUFHWixJQUFBLEFBQUtSLHVDQUFBQTs7Ozs0Q0FJYSxnQ0FBZ0M7V0FKN0NBOztBQVFMLElBQUEsQUFBS0YsdUNBQUFBOzs7Ozs7Ozs7OztXQUFBQTs7QUFjTCxJQUFBLEFBQUtDLHFDQUFBQTs7Ozs7O1dBQUFBOztBQW9DTCxNQUFNRyxxQkFBd0M7SUFDbkQ7UUFDRU8sUUFBUTtRQUNSQyxlQUFlO1FBQ2ZDLGtCQUFrQjtRQUNsQkMsb0JBQW9CO0lBQ3RCO0lBQ0E7UUFDRUgsUUFBUTtRQUNSQyxlQUFlO1FBQ2ZDLGtCQUFrQjtRQUNsQkMsb0JBQW9CO0lBQ3RCO0lBQ0E7UUFDRUgsUUFBUTtRQUNSQyxlQUFlO1FBQ2ZDLGtCQUFrQjtRQUNsQkMsb0JBQW9CO0lBQ3RCO0lBQ0E7UUFDRUgsUUFBUTtRQUNSQyxlQUFlO1FBQ2ZDLGtCQUFrQjtRQUNsQkMsb0JBQW9CO0lBQ3RCO0lBQ0E7UUFDRUgsUUFBUTtRQUNSQyxlQUFlO1FBQ2ZDLGtCQUFrQjtRQUNsQkMsb0JBQW9CO0lBQ3RCO0lBQ0E7UUFDRUgsUUFBUTtRQUNSQyxlQUFlO1FBQ2ZDLGtCQUFrQjtRQUNsQkMsb0JBQW9CO0lBQ3RCO0NBQ0Q7QUFLTSxNQUFNWDtJQUlYLGFBQWM7UUFDWixJQUFJLENBQUNZLFNBQVMsR0FBR0MsUUFBUUMsR0FBRyxDQUFDQyxzQkFBc0IsSUFBSTtRQUN2RCxJQUFJLElBQUksQ0FBQ0gsU0FBUyxLQUFLLHFCQUFxQjtZQUMxQ0ksY0FBTSxDQUFDQyxJQUFJLENBQUNDLGdCQUFRLENBQUNDLElBQUksRUFBRSxvRUFBb0UsQ0FBQyxHQUFHQyxtQkFBVyxDQUFDQyxNQUFNO1FBQ3ZIO0lBQ0Y7SUFFQSxPQUFPQyxjQUFpQztRQUN0QyxJQUFJLENBQUN0QixrQkFBa0J1QixRQUFRLEVBQUU7WUFDL0J2QixrQkFBa0J1QixRQUFRLEdBQUcsSUFBSXZCO1FBQ25DO1FBQ0EsT0FBT0Esa0JBQWtCdUIsUUFBUTtJQUNuQztJQUVBOztHQUVDLEdBQ0QsTUFBTUMsU0FBU0MsU0FBd0QsRUFBaUI7UUFDdEYsSUFBSTtZQUNGLE1BQU1DLGFBQXlCO2dCQUM3QixHQUFHRCxTQUFTO2dCQUNaRSxJQUFJLElBQUksQ0FBQ0MsZUFBZTtnQkFDeEJDLFdBQVcsSUFBSUMsT0FBT0MsV0FBVztnQkFDakNDLE1BQU07WUFDUjtZQUVBLDZCQUE2QjtZQUM3Qk4sV0FBV00sSUFBSSxHQUFHLElBQUksQ0FBQ0MsaUJBQWlCLENBQUNQO1lBRXpDLDZCQUE2QjtZQUM3QixNQUFNLElBQUksQ0FBQ1EsZUFBZSxDQUFDUjtZQUUzQixnQ0FBZ0M7WUFDaEMsSUFBSSxJQUFJLENBQUNTLGFBQWEsQ0FBQ1QsYUFBYTtnQkFDbEMsTUFBTSxJQUFJLENBQUNVLGlCQUFpQixDQUFDVjtZQUMvQjtZQUVBLG1CQUFtQjtZQUNuQlYsY0FBTSxDQUFDcUIsS0FBSyxDQUFDbkIsZ0JBQVEsQ0FBQ29CLElBQUksRUFBRSxDQUFDLG9CQUFvQixFQUFFWixXQUFXYSxNQUFNLEVBQUUsRUFBRTtnQkFDdEVDLFNBQVNkLFdBQVdDLEVBQUU7Z0JBQ3RCbkIsVUFBVWtCLFdBQVdsQixRQUFRO2dCQUM3QmlDLFVBQVVmLFdBQVdlLFFBQVE7Z0JBQzdCQyxRQUFRaEIsV0FBV2dCLE1BQU07Z0JBQ3pCQyxRQUFRakIsV0FBV2lCLE1BQU07WUFDM0I7UUFFRixFQUFFLE9BQU9DLE9BQU87WUFDZDVCLGNBQU0sQ0FBQzRCLEtBQUssQ0FBQzFCLGdCQUFRLENBQUMyQixLQUFLLEVBQUUsNkJBQTZCO2dCQUN4REQsT0FBT0EsaUJBQWlCRSxRQUFRRixNQUFNRyxPQUFPLEdBQUc7Z0JBQ2hEUixRQUFRZCxVQUFVYyxNQUFNO2dCQUN4Qi9CLFVBQVVpQixVQUFVakIsUUFBUTtZQUM5QixHQUFHWSxtQkFBVyxDQUFDQyxNQUFNO1FBQ3ZCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1qQixrQkFDSm1DLE1BQWMsRUFDZEcsTUFBbUIsRUFDbkJDLE1BQWUsRUFDZkssUUFBOEIsRUFDOUJDLE9BQStELEVBQ2hEO1FBQ2YsTUFBTSxJQUFJLENBQUN6QixRQUFRLENBQUM7WUFDbEJtQjtZQUNBTyxXQUFXRCxTQUFTQztZQUNwQlg7WUFDQVksVUFBVTtZQUNWM0MsUUFBUTtZQUNSaUMsVUFBVUM7WUFDVkE7WUFDQVUsV0FBV0gsU0FBU0ksTUFBTTtZQUMxQkMsV0FBV0wsU0FBU0ssYUFBYTtZQUNqQ047WUFDQU8saUJBQWlCO2dCQUFDO2dCQUFZO2FBQXFCO1FBQ3JEO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1qRCxnQkFDSmlDLE1BQWMsRUFDZEcsTUFBbUIsRUFDbkJjLFdBTUMsRUFDRGIsTUFBZSxFQUNmTSxPQUEyQyxFQUM1QjtRQUNmLE1BQU0sSUFBSSxDQUFDekIsUUFBUSxDQUFDO1lBQ2xCbUI7WUFDQUo7WUFDQVksVUFBVSxDQUFDLFFBQVEsRUFBRUssWUFBWUMsU0FBUyxJQUFJLFdBQVc7WUFDekRqRCxRQUFRO1lBQ1JpQyxVQUFVQztZQUNWQTtZQUNBVSxXQUFXSCxTQUFTSSxNQUFNO1lBQzFCQyxXQUFXTCxTQUFTSyxhQUFhO1lBQ2pDTixVQUFVO2dCQUNSLEdBQUdRLFdBQVc7Z0JBQ2RFLG9CQUFvQjtZQUN0QjtZQUNBSCxpQkFBaUI7Z0JBQUM7Z0JBQVk7Z0JBQWU7YUFBdUI7UUFDdEU7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTWhELHFCQUNKZ0MsTUFBYyxFQUNkb0IsT0FBZSxFQUNmVixPQUEwQyxFQUMxQ0QsUUFBOEIsRUFDZjtRQUNmLE1BQU0sSUFBSSxDQUFDeEIsUUFBUSxDQUFDO1lBQ2xCZTtZQUNBWSxVQUFVO1lBQ1YzQyxRQUFRO1lBQ1JpQyxRQUFRO1lBQ1JDLE1BQU07WUFDTlUsV0FBV0gsUUFBUUksRUFBRTtZQUNyQkMsV0FBV0wsUUFBUUssU0FBUztZQUM1Qk4sVUFBVTtnQkFDUlc7Z0JBQ0EsR0FBR1gsUUFBUTtnQkFDWFksZUFBZTtZQUNqQjtZQUNBTCxpQkFBaUI7Z0JBQUM7Z0JBQVk7Z0JBQXFCO2FBQWtCO1FBQ3ZFO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELE1BQU1sRCxjQUNKa0MsTUFBYyxFQUNkWSxRQUFnQixFQUNoQlQsTUFBbUIsRUFDbkJDLE1BQWUsRUFDZk0sT0FBMkMsRUFDM0NELFFBQThCLEVBQ2Y7UUFDZixNQUFNLElBQUksQ0FBQ3hCLFFBQVEsQ0FBQztZQUNsQm1CO1lBQ0FKO1lBQ0FZO1lBQ0EzQyxRQUFRO1lBQ1JpQyxVQUFVQztZQUNWQTtZQUNBVSxXQUFXSCxTQUFTSSxNQUFNO1lBQzFCQyxXQUFXTCxTQUFTSyxhQUFhO1lBQ2pDTjtZQUNBTyxpQkFBaUI7Z0JBQUM7Z0JBQVk7YUFBa0I7UUFDbEQ7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTXBELGVBQ0pvQyxNQUFjLEVBQ2RZLFFBQWdCLEVBQ2hCVCxNQUFtQixFQUNuQkMsTUFBYyxFQUNkTSxPQUEwQyxFQUMxQ0QsUUFBOEIsRUFDZjtRQUNmLE1BQU0sSUFBSSxDQUFDeEIsUUFBUSxDQUFDO1lBQ2xCbUI7WUFDQUo7WUFDQVk7WUFDQTNDLFFBQVE7WUFDUmlDLFFBQVE7WUFDUkM7WUFDQVUsV0FBV0gsUUFBUUksRUFBRTtZQUNyQkMsV0FBV0wsUUFBUUssU0FBUztZQUM1Qk47WUFDQU8saUJBQWlCO2dCQUFDO2dCQUFZO2dCQUFnQjthQUFvQjtRQUNwRTtJQUNGO0lBRUE7O0dBRUMsR0FDRCxBQUFRM0Isa0JBQTBCO1FBQ2hDLE9BQU8sQ0FBQyxNQUFNLEVBQUVFLEtBQUsrQixHQUFHLEdBQUcsQ0FBQyxFQUFFQyxlQUFNLENBQUNDLFdBQVcsQ0FBQyxHQUFHQyxRQUFRLENBQUMsUUFBUTtJQUN2RTtJQUVBOztHQUVDLEdBQ0QsQUFBUS9CLGtCQUFrQmdDLEtBQStCLEVBQVU7UUFDakUsTUFBTUMsY0FBY0MsS0FBS0MsU0FBUyxDQUFDO1lBQ2pDekMsSUFBSXNDLE1BQU10QyxFQUFFO1lBQ1pFLFdBQVdvQyxNQUFNcEMsU0FBUztZQUMxQmMsUUFBUXNCLE1BQU10QixNQUFNO1lBQ3BCSixRQUFRMEIsTUFBTTFCLE1BQU07WUFDcEJZLFVBQVVjLE1BQU1kLFFBQVE7WUFDeEIzQyxVQUFVeUQsTUFBTXpELFFBQVE7WUFDeEJrQyxRQUFRdUIsTUFBTXZCLE1BQU07UUFDdEI7UUFFQSxPQUFPb0IsZUFBTSxDQUNWTyxVQUFVLENBQUMsVUFBVSxJQUFJLENBQUN6RCxTQUFTLEVBQ25DMEQsTUFBTSxDQUFDSixhQUNQSyxNQUFNLENBQUM7SUFDWjtJQUVBOztHQUVDLEdBQ0QsTUFBY3JDLGdCQUFnQitCLEtBQWlCLEVBQWlCO1FBQzlELE1BQU1PLFdBQVdDLElBQUFBLDJCQUFpQixFQUFDLE9BQU8sOEJBQThCO1FBRXhFLElBQUksQ0FBQ0QsVUFBVTtZQUNiLE1BQU0sSUFBSTFCLE1BQU07UUFDbEI7UUFFQSxNQUFNLEVBQUVGLEtBQUssRUFBRSxHQUFHLE1BQU00QixTQUNyQkUsSUFBSSxDQUFDLGdCQUNMQyxNQUFNLENBQUM7WUFDTmhELElBQUlzQyxNQUFNdEMsRUFBRTtZQUNaRSxXQUFXb0MsTUFBTXBDLFNBQVM7WUFDMUIrQyxTQUFTWCxNQUFNdEIsTUFBTTtZQUNyQmtDLFlBQVlaLE1BQU1mLFNBQVM7WUFDM0JYLFFBQVEwQixNQUFNMUIsTUFBTTtZQUNwQlksVUFBVWMsTUFBTWQsUUFBUTtZQUN4QjNDLFVBQVV5RCxNQUFNekQsUUFBUTtZQUN4QmlDLFVBQVV3QixNQUFNeEIsUUFBUTtZQUN4QkMsUUFBUXVCLE1BQU12QixNQUFNO1lBQ3BCb0MsWUFBWWIsTUFBTWIsU0FBUztZQUMzQjJCLFlBQVlkLE1BQU1YLFNBQVM7WUFDM0IwQixZQUFZZixNQUFNZ0IsU0FBUztZQUMzQmpDLFVBQVVpQixNQUFNakIsUUFBUTtZQUN4QmhCLE1BQU1pQyxNQUFNakMsSUFBSTtZQUNoQmtELGtCQUFrQmpCLE1BQU1WLGVBQWU7UUFDekM7UUFFRixJQUFJWCxPQUFPO1lBQ1QsTUFBTSxJQUFJRSxNQUFNLENBQUMsNkJBQTZCLEVBQUVGLE1BQU1HLE9BQU8sRUFBRTtRQUNqRTtJQUNGO0lBRUE7O0dBRUMsR0FDRCxBQUFRWixjQUFjOEIsS0FBaUIsRUFBVztRQUNoRCxPQUNFQSxNQUFNeEIsUUFBUSxtQkFDZHdCLE1BQU16RCxRQUFRLDZCQUNkeUQsTUFBTXZCLE1BQU0sa0JBQ1p1QixNQUFNVixlQUFlLEVBQUU0QixTQUFTLHNCQUNoQztJQUVKO0lBRUE7O0dBRUMsR0FDRCxNQUFjL0Msa0JBQWtCNkIsS0FBaUIsRUFBaUI7UUFDaEUsSUFBSTtZQUNGLHNDQUFzQztZQUN0Q2pELGNBQU0sQ0FBQ29FLFFBQVEsQ0FBQ2xFLGdCQUFRLENBQUMyQixLQUFLLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRW9CLE1BQU0xQixNQUFNLEVBQUUsRUFBRTtnQkFDakVDLFNBQVN5QixNQUFNdEMsRUFBRTtnQkFDakJuQixVQUFVeUQsTUFBTXpELFFBQVE7Z0JBQ3hCaUMsVUFBVXdCLE1BQU14QixRQUFRO2dCQUN4QkMsUUFBUXVCLE1BQU12QixNQUFNO2dCQUNwQlUsV0FBV2EsTUFBTWIsU0FBUztnQkFDMUJULFFBQVFzQixNQUFNdEIsTUFBTTtnQkFDcEJRLFVBQVVjLE1BQU1kLFFBQVE7WUFDMUI7UUFFQSxvRUFBb0U7UUFDcEUsb0NBQW9DO1FBQ3BDLG9DQUFvQztRQUV0QyxFQUFFLE9BQU9QLE9BQU87WUFDZDVCLGNBQU0sQ0FBQzRCLEtBQUssQ0FBQzFCLGdCQUFRLENBQUMyQixLQUFLLEVBQUUsaUNBQWlDO2dCQUM1REQsT0FBT0EsaUJBQWlCRSxRQUFRRixNQUFNRyxPQUFPLEdBQUc7Z0JBQ2hEUCxTQUFTeUIsTUFBTXRDLEVBQUU7WUFDbkIsR0FBR1AsbUJBQVcsQ0FBQ0MsTUFBTTtRQUN2QjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFNZ0UscUJBQXFCcEIsS0FBaUIsRUFBb0I7UUFDOUQsTUFBTXFCLGVBQWUsSUFBSSxDQUFDckQsaUJBQWlCLENBQUM7WUFDMUMsR0FBR2dDLEtBQUs7WUFDUmpDLE1BQU07UUFDUjtRQUVBLE9BQU9pQyxNQUFNakMsSUFBSSxLQUFLc0Q7SUFDeEI7SUFFQTs7R0FFQyxHQUNELE1BQU1DLGVBQWVDLE9BT3BCLEVBQXlCO1FBQ3hCLE1BQU1oQixXQUFXQyxJQUFBQSwyQkFBaUIsRUFBQztRQUVuQyxJQUFJLENBQUNELFVBQVU7WUFDYixNQUFNLElBQUkxQixNQUFNO1FBQ2xCO1FBRUEsSUFBSTJDLFFBQVFqQixTQUNURSxJQUFJLENBQUMsZ0JBQ0xnQixNQUFNLENBQUMsS0FDUEMsS0FBSyxDQUFDLGFBQWE7WUFBRUMsV0FBVztRQUFNO1FBRXpDLElBQUlKLFFBQVE3QyxNQUFNLEVBQUU7WUFDbEI4QyxRQUFRQSxNQUFNSSxFQUFFLENBQUMsV0FBV0wsUUFBUTdDLE1BQU07UUFDNUM7UUFFQSxJQUFJNkMsUUFBUWhGLFFBQVEsRUFBRTtZQUNwQmlGLFFBQVFBLE1BQU1JLEVBQUUsQ0FBQyxZQUFZTCxRQUFRaEYsUUFBUTtRQUMvQztRQUVBLElBQUlnRixRQUFRL0MsUUFBUSxFQUFFO1lBQ3BCZ0QsUUFBUUEsTUFBTUksRUFBRSxDQUFDLFlBQVlMLFFBQVEvQyxRQUFRO1FBQy9DO1FBRUEsSUFBSStDLFFBQVFNLFNBQVMsRUFBRTtZQUNyQkwsUUFBUUEsTUFBTU0sR0FBRyxDQUFDLGFBQWFQLFFBQVFNLFNBQVM7UUFDbEQ7UUFFQSxJQUFJTixRQUFRUSxPQUFPLEVBQUU7WUFDbkJQLFFBQVFBLE1BQU1RLEdBQUcsQ0FBQyxhQUFhVCxRQUFRUSxPQUFPO1FBQ2hEO1FBRUEsSUFBSVIsUUFBUVUsS0FBSyxFQUFFO1lBQ2pCVCxRQUFRQSxNQUFNUyxLQUFLLENBQUNWLFFBQVFVLEtBQUs7UUFDbkM7UUFFQSxNQUFNLEVBQUVDLElBQUksRUFBRXZELEtBQUssRUFBRSxHQUFHLE1BQU02QztRQUU5QixJQUFJN0MsT0FBTztZQUNULE1BQU0sSUFBSUUsTUFBTSxDQUFDLGlDQUFpQyxFQUFFRixNQUFNRyxPQUFPLEVBQUU7UUFDckU7UUFFQSxPQUFPb0QsUUFBUSxFQUFFO0lBQ25CO0FBQ0Y7QUFHTyxNQUFNakcsYUFBYUYsa0JBQWtCc0IsV0FBVztBQUdoRCxNQUFNbEIsb0JBQW9CRixXQUFXRSxpQkFBaUIsQ0FBQ2dHLElBQUksQ0FBQ2xHO0FBQzVELE1BQU1JLGtCQUFrQkosV0FBV0ksZUFBZSxDQUFDOEYsSUFBSSxDQUFDbEc7QUFDeEQsTUFBTUssdUJBQXVCTCxXQUFXSyxvQkFBb0IsQ0FBQzZGLElBQUksQ0FBQ2xHO0FBQ2xFLE1BQU1HLGdCQUFnQkgsV0FBV0csYUFBYSxDQUFDK0YsSUFBSSxDQUFDbEc7QUFDcEQsTUFBTUMsaUJBQWlCRCxXQUFXQyxjQUFjLENBQUNpRyxJQUFJLENBQUNsRyJ9