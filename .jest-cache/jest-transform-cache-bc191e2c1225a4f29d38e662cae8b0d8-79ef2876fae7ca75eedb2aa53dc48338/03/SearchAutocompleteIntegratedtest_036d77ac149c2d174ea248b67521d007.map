{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\components\\ui\\SearchAutocompleteIntegrated.test.tsx"],"sourcesContent":["// ===================================\r\n// TESTS: SearchAutocompleteIntegrated - Integración completa\r\n// ===================================\r\n\r\nimport React from 'react';\r\nimport { render, screen, waitFor } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { useRouter, useSearchParams, usePathname } from 'next/navigation';\r\nimport { searchProducts } from '@/lib/api/products';\r\nimport { SearchAutocompleteIntegrated } from '@/components/ui/SearchAutocompleteIntegrated';\r\n\r\n// Mocks - Aplicando Patrón 1 exitoso: Imports faltantes\r\njest.mock('next/navigation', () => ({\r\n  useRouter: jest.fn(),\r\n  useSearchParams: jest.fn(),\r\n  usePathname: jest.fn(),\r\n}));\r\n\r\njest.mock('@/lib/api/products', () => ({\r\n  searchProducts: jest.fn(),\r\n}));\r\n\r\nconst mockPush = jest.fn();\r\nconst mockPrefetch = jest.fn(); // Patrón 1 exitoso: Import faltante\r\nconst mockSearchProducts = searchProducts as jest.MockedFunction<typeof searchProducts>;\r\n\r\n// Mocks adicionales para Next.js navigation\r\nconst mockSearchParams = jest.fn();\r\nconst mockPathname = jest.fn();\r\n\r\nbeforeEach(() => {\r\n  jest.clearAllMocks();\r\n\r\n  // Configurar mocks de Next.js navigation - Patrón exitoso aplicado\r\n  (useRouter as jest.Mock).mockReturnValue({\r\n    push: mockPush,\r\n    prefetch: mockPrefetch, // Patrón 1 exitoso: Import faltante agregado\r\n  });\r\n\r\n  (useSearchParams as jest.Mock).mockReturnValue({\r\n    get: jest.fn(() => null),\r\n    has: jest.fn(() => false),\r\n    toString: jest.fn(() => ''),\r\n  });\r\n\r\n  (usePathname as jest.Mock).mockReturnValue('/');\r\n\r\n  // Configurar mock de searchProducts con respuesta por defecto\r\n  mockSearchProducts.mockResolvedValue({\r\n    products: [],\r\n    pagination: { total: 0, page: 1, limit: 6, totalPages: 0 },\r\n  });\r\n  \r\n  // Mock localStorage\r\n  Object.defineProperty(window, 'localStorage', {\r\n    value: {\r\n      getItem: jest.fn(() => null),\r\n      setItem: jest.fn(),\r\n      removeItem: jest.fn(),\r\n      clear: jest.fn(),\r\n    },\r\n    writable: true,\r\n  });\r\n});\r\n\r\ndescribe('SearchAutocompleteIntegrated', () => {\r\n  it('should render with default props', () => {\r\n    render(<SearchAutocompleteIntegrated />);\r\n    \r\n    // Patrón 2 exitoso: Expectativas específicas - usar searchbox en lugar de combobox\r\n    expect(screen.getByRole('searchbox')).toBeInTheDocument();\r\n    expect(screen.getByPlaceholderText('Látex interior blanco 20lts, rodillos, pinceles...')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should integrate with useSearch hook and show suggestions', async () => {\r\n    const mockResponse = {\r\n      success: true,\r\n      data: [\r\n        { \r\n          id: '1', \r\n          name: 'Pintura Látex Blanca', \r\n          category: { name: 'Pinturas' },\r\n          images: { previews: ['/test.jpg'] },\r\n          stock: 10\r\n        },\r\n        { \r\n          id: '2', \r\n          name: 'Pintura Esmalte Azul', \r\n          category: { name: 'Pinturas' },\r\n          images: { previews: ['/test2.jpg'] },\r\n          stock: 5\r\n        },\r\n      ],\r\n      pagination: { total: 2, page: 1, limit: 6, totalPages: 1 },\r\n    };\r\n\r\n    mockSearchProducts.mockResolvedValue(mockResponse);\r\n\r\n    render(<SearchAutocompleteIntegrated debounceMs={100} />);\r\n    \r\n    const input = screen.getByRole('searchbox');\r\n    \r\n    await userEvent.type(input, 'pintura');\r\n    \r\n    // Esperar a que se llame la API primero\r\n    await waitFor(() => {\r\n      expect(mockSearchProducts).toHaveBeenCalledWith('pintura');\r\n    }, { timeout: 2000 });\r\n\r\n    // Luego esperar a que aparezcan las sugerencias\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Pintura Látex Blanca')).toBeInTheDocument();\r\n      expect(screen.getByText('Pintura Esmalte Azul')).toBeInTheDocument();\r\n    }, { timeout: 2000 });\r\n\r\n    // Verificar que se llamó a la API\r\n    expect(mockSearchProducts).toHaveBeenCalledWith('pintura', 6);\r\n  });\r\n\r\n  it('should execute search on Enter key', async () => {\r\n    const onSearchExecuted = jest.fn();\r\n    const mockResponse = {\r\n      success: true,\r\n      data: [{ id: '1', name: 'Test Product', category: { name: 'Test' } }],\r\n      pagination: { total: 1, page: 1, limit: 12, totalPages: 1 },\r\n    };\r\n\r\n    mockSearchProducts.mockResolvedValue(mockResponse);\r\n\r\n    render(\r\n      <SearchAutocompleteIntegrated \r\n        onSearchExecuted={onSearchExecuted}\r\n        debounceMs={100}\r\n      />\r\n    );\r\n    \r\n    const input = screen.getByRole('searchbox');\r\n    \r\n    await userEvent.type(input, 'test query');\r\n    await userEvent.keyboard('{Enter}');\r\n    \r\n    await waitFor(() => {\r\n      expect(mockPush).toHaveBeenCalledWith('/search?q=test%20query');\r\n    });\r\n  });\r\n\r\n  it('should handle suggestion selection', async () => {\r\n    const onSuggestionSelected = jest.fn();\r\n    const mockResponse = {\r\n      success: true,\r\n      data: [\r\n        { \r\n          id: '1', \r\n          name: 'Test Product', \r\n          category: { name: 'Test Category' },\r\n          images: { previews: ['/test.jpg'] },\r\n          stock: 10\r\n        },\r\n      ],\r\n      pagination: { total: 1, page: 1, limit: 6, totalPages: 1 },\r\n    };\r\n\r\n    mockSearchProducts.mockResolvedValue(mockResponse);\r\n\r\n    render(\r\n      <SearchAutocompleteIntegrated \r\n        onSuggestionSelected={onSuggestionSelected}\r\n        debounceMs={100}\r\n      />\r\n    );\r\n    \r\n    const input = screen.getByRole('searchbox');\r\n    \r\n    await userEvent.type(input, 'test');\r\n    \r\n    await waitFor(() => {\r\n      expect(screen.getByText('Test Product')).toBeInTheDocument();\r\n    });\r\n\r\n    await userEvent.click(screen.getByText('Test Product'));\r\n    \r\n    expect(onSuggestionSelected).toHaveBeenCalledWith(\r\n      expect.objectContaining({\r\n        title: 'Test Product',\r\n        type: 'product'\r\n      })\r\n    );\r\n  });\r\n\r\n  it('should clear search when clear button is clicked', async () => {\r\n    render(<SearchAutocompleteIntegrated />);\r\n    \r\n    const input = screen.getByRole('searchbox');\r\n    \r\n    await userEvent.type(input, 'test query');\r\n    \r\n    // Buscar el botón de limpiar\r\n    const clearButton = screen.getByLabelText('Clear search');\r\n    await userEvent.click(clearButton);\r\n    \r\n    expect(input).toHaveValue('');\r\n  });\r\n\r\n  it('should show loading state during search', async () => {\r\n    // Mock para simular búsqueda lenta\r\n    mockSearchProducts.mockImplementation(() => \r\n      new Promise(resolve => setTimeout(() => resolve({\r\n        success: true,\r\n        data: [],\r\n        pagination: { total: 0, page: 1, limit: 6, totalPages: 0 },\r\n      }), 1000))\r\n    );\r\n\r\n    render(<SearchAutocompleteIntegrated debounceMs={50} />);\r\n    \r\n    const input = screen.getByRole('searchbox');\r\n    \r\n    await userEvent.type(input, 'test');\r\n    \r\n    // Verificar que aparece el spinner de carga\r\n    await waitFor(() => {\r\n      const spinner = document.querySelector('.animate-spin');\r\n      expect(spinner).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('should handle API errors gracefully', async () => {\r\n    mockSearchProducts.mockRejectedValue(new Error('API Error'));\r\n\r\n    render(<SearchAutocompleteIntegrated debounceMs={50} />);\r\n    \r\n    const input = screen.getByRole('searchbox');\r\n    \r\n    await userEvent.type(input, 'test');\r\n    \r\n    await waitFor(() => {\r\n      expect(mockSearchProducts).toHaveBeenCalled();\r\n    });\r\n\r\n    // El componente no debería crashear y debería mostrar estado sin resultados\r\n    expect(input).toBeInTheDocument();\r\n  });\r\n});\r\n"],"names":["jest","mock","useRouter","fn","useSearchParams","usePathname","searchProducts","mockPush","mockPrefetch","mockSearchProducts","mockSearchParams","mockPathname","beforeEach","clearAllMocks","mockReturnValue","push","prefetch","get","has","toString","mockResolvedValue","products","pagination","total","page","limit","totalPages","Object","defineProperty","window","value","getItem","setItem","removeItem","clear","writable","describe","it","render","SearchAutocompleteIntegrated","expect","screen","getByRole","toBeInTheDocument","getByPlaceholderText","mockResponse","success","data","id","name","category","images","previews","stock","debounceMs","input","userEvent","type","waitFor","toHaveBeenCalledWith","timeout","getByText","onSearchExecuted","keyboard","onSuggestionSelected","click","objectContaining","title","clearButton","getByLabelText","toHaveValue","mockImplementation","Promise","resolve","setTimeout","spinner","document","querySelector","mockRejectedValue","Error","toHaveBeenCalled"],"mappings":"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"}