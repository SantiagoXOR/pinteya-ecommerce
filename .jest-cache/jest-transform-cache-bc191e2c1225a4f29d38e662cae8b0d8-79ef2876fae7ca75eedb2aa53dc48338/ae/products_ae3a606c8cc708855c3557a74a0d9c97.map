{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\lib\\api\\products.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - FUNCIONES DE API PARA PRODUCTOS\r\n// ===================================\r\n\r\nimport { ProductFilters, ProductWithCategory, ApiResponse, PaginatedResponse } from '@/types/api';\r\nimport { safeApiResponseJson } from '@/lib/json-utils';\r\n\r\n// ===================================\r\n// FUNCIONES PARA EL FRONTEND\r\n// ===================================\r\n\r\n/**\r\n * Obtiene productos con filtros desde la API\r\n * @param filters - Filtros de productos\r\n * @returns Promise<PaginatedResponse<ProductWithCategory>>\r\n */\r\nexport async function getProducts(filters?: ProductFilters): Promise<PaginatedResponse<ProductWithCategory>> {\r\n  try {\r\n    const searchParams = new URLSearchParams();\r\n\r\n    if (filters) {\r\n      Object.entries(filters).forEach(([key, value]) => {\r\n        if (value !== undefined && value !== null) {\r\n          searchParams.append(key, value.toString());\r\n        }\r\n      });\r\n    }\r\n\r\n    const url = `/api/products?${searchParams.toString()}`;\r\n    const DEBUG_MODE = process.env.NODE_ENV === 'development';\r\n\r\n    if (DEBUG_MODE) {\r\n      console.log('üîç Fetching products from:', url);\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    if (DEBUG_MODE) {\r\n      console.log('üì° Response status:', response.status, response.statusText);\r\n    }\r\n\r\n    // Usar parsing seguro de JSON\r\n    const result = await safeApiResponseJson<PaginatedResponse<ProductWithCategory>>(response);\r\n\r\n    if (DEBUG_MODE) {\r\n      console.log('üîç Parse result:', { success: result.success, error: result.error });\r\n    }\r\n\r\n    if (!result.success) {\r\n      console.error('‚ùå JSON parsing failed:', result.error);\r\n\r\n      // Return a fallback response instead of throwing\r\n      return {\r\n        data: [],\r\n        pagination: {\r\n          page: 1,\r\n          limit: 12,\r\n          total: 0,\r\n          totalPages: 0,\r\n        },\r\n        success: false,\r\n        message: result.error || 'Error loading products',\r\n      };\r\n    }\r\n\r\n    if (DEBUG_MODE) {\r\n      console.log('‚úÖ Products loaded successfully:', result.data?.data?.length || 0, 'items');\r\n    }\r\n    return result.data;\r\n  } catch (error) {\r\n    console.error('‚ùå Error obteniendo productos:', error);\r\n\r\n    // Return a fallback response instead of throwing\r\n    return {\r\n      data: [],\r\n      pagination: {\r\n        page: 1,\r\n        limit: 12,\r\n        total: 0,\r\n        totalPages: 0,\r\n      },\r\n      success: false,\r\n      message: error instanceof Error ? error.message : 'Error inesperado',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Obtiene un producto por ID desde la API\r\n * @param id - ID del producto\r\n * @returns Promise<ApiResponse<ProductWithCategory>>\r\n */\r\nexport async function getProductById(id: number): Promise<ApiResponse<ProductWithCategory>> {\r\n  try {\r\n    const response = await fetch(`/api/products/${id}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    // Usar parsing seguro de JSON\r\n    const result = await safeApiResponseJson<ApiResponse<ProductWithCategory>>(response);\r\n\r\n    if (!result.success) {\r\n      throw new Error(result.error || 'Error parsing API response');\r\n    }\r\n\r\n    return result.data;\r\n  } catch (error) {\r\n    console.error(`Error obteniendo producto ${id}:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Busca productos por t√©rmino de b√∫squeda\r\n * @param searchTerm - T√©rmino de b√∫squeda\r\n * @param limit - L√≠mite de resultados\r\n * @returns Promise<PaginatedResponse<ProductWithCategory>>\r\n */\r\nexport async function searchProducts(\r\n  searchTerm: string, \r\n  limit: number = 12\r\n): Promise<PaginatedResponse<ProductWithCategory>> {\r\n  return getProducts({\r\n    search: searchTerm,\r\n    limit,\r\n    page: 1,\r\n  });\r\n}\r\n\r\n/**\r\n * Obtiene productos por categor√≠a\r\n * @param categorySlug - Slug de la categor√≠a\r\n * @param page - P√°gina\r\n * @param limit - L√≠mite de resultados\r\n * @returns Promise<PaginatedResponse<ProductWithCategory>>\r\n */\r\nexport async function getProductsByCategory(\r\n  categorySlug: string,\r\n  page: number = 1,\r\n  limit: number = 12\r\n): Promise<PaginatedResponse<ProductWithCategory>> {\r\n  return getProducts({\r\n    category: categorySlug,\r\n    page,\r\n    limit,\r\n  });\r\n}\r\n\r\n/**\r\n * Obtiene productos con descuento\r\n * @param page - P√°gina\r\n * @param limit - L√≠mite de resultados\r\n * @returns Promise<PaginatedResponse<ProductWithCategory>>\r\n */\r\nexport async function getDiscountedProducts(\r\n  page: number = 1,\r\n  limit: number = 12\r\n): Promise<PaginatedResponse<ProductWithCategory>> {\r\n  // Nota: Esto requerir√≠a un filtro adicional en la API\r\n  // Por ahora, obtenemos todos los productos y filtramos en el frontend\r\n  const response = await getProducts({ page, limit });\r\n\r\n  // Filtrar productos con descuento\r\n  const discountedProducts = response.data.filter(\r\n    product => product.discounted_price && product.discounted_price < product.price\r\n  );\r\n\r\n  return {\r\n    ...response,\r\n    data: discountedProducts,\r\n  };\r\n}\r\n\r\n/**\r\n * Obtiene productos por marca\r\n * @param brandName - Nombre de la marca\r\n * @param page - P√°gina\r\n * @param limit - L√≠mite de resultados\r\n * @returns Promise<PaginatedResponse<ProductWithCategory>>\r\n */\r\nexport async function getProductsByBrand(\r\n  brandName: string,\r\n  page: number = 1,\r\n  limit: number = 12\r\n): Promise<PaginatedResponse<ProductWithCategory>> {\r\n  return getProducts({\r\n    brand: brandName,\r\n    page,\r\n    limit,\r\n  });\r\n}\r\n\r\n/**\r\n * Obtiene productos relacionados (misma categor√≠a)\r\n * @param productId - ID del producto actual\r\n * @param categoryId - ID de la categor√≠a\r\n * @param limit - L√≠mite de resultados\r\n * @returns Promise<ProductWithCategory[]>\r\n */\r\nexport async function getRelatedProducts(\r\n  productId: number,\r\n  categoryId: number,\r\n  limit: number = 4\r\n): Promise<ProductWithCategory[]> {\r\n  try {\r\n    // Obtener productos de la misma categor√≠a\r\n    const response = await fetch(`/api/products?category_id=${categoryId}&limit=${limit + 1}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    // Usar parsing seguro de JSON\r\n    const result = await safeApiResponseJson<PaginatedResponse<ProductWithCategory>>(response);\r\n\r\n    if (!result.success) {\r\n      throw new Error(result.error || 'Error parsing API response');\r\n    }\r\n\r\n    const data = result.data;\r\n\r\n    // Filtrar el producto actual y limitar resultados\r\n    return data.data\r\n      .filter(product => product.id !== productId)\r\n      .slice(0, limit);\r\n\r\n  } catch (error) {\r\n    console.error('Error obteniendo productos relacionados:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n// ===================================\r\n// FUNCIONES AUXILIARES\r\n// ===================================\r\n\r\n/**\r\n * Convierte un producto del formato antiguo al nuevo\r\n * @param oldProduct - Producto en formato antiguo\r\n * @returns ProductWithCategory\r\n */\r\nexport function convertLegacyProduct(oldProduct: any): ProductWithCategory {\r\n  return {\r\n    id: oldProduct.id,\r\n    name: oldProduct.title,\r\n    brand: oldProduct.brand || null, // Marca del producto legacy\r\n    slug: oldProduct.title.toLowerCase().replace(/[^a-z0-9]+/g, '-'),\r\n    description: `Producto ${oldProduct.title}`,\r\n    price: oldProduct.price,\r\n    discounted_price: oldProduct.discountedPrice,\r\n    stock: 50, // Stock por defecto\r\n    category_id: 1, // Categor√≠a por defecto\r\n    images: oldProduct.imgs,\r\n    created_at: new Date().toISOString(),\r\n    updated_at: null, // Campo requerido por el tipo\r\n  };\r\n}\r\n\r\n/**\r\n * Calcula el porcentaje de descuento\r\n * @param originalPrice - Precio original\r\n * @param discountedPrice - Precio con descuento\r\n * @returns number\r\n */\r\nexport function calculateDiscountPercentage(\r\n  originalPrice: number,\r\n  discountedPrice: number\r\n): number {\r\n  if (!discountedPrice || discountedPrice >= originalPrice) {\r\n    return 0;\r\n  }\r\n  \r\n  return Math.round(((originalPrice - discountedPrice) / originalPrice) * 100);\r\n}\r\n\r\n/**\r\n * Formatea el precio para mostrar\r\n * @param price - Precio\r\n * @param currency - Moneda\r\n * @returns string\r\n */\r\nexport function formatPrice(price: number, currency: string = 'ARS'): string {\r\n  return new Intl.NumberFormat('es-AR', {\r\n    style: 'currency',\r\n    currency,\r\n    minimumFractionDigits: 0,\r\n    maximumFractionDigits: 2,\r\n  }).format(price);\r\n}\r\n\r\n/**\r\n * Verifica si un producto est√° en stock\r\n * @param product - Producto\r\n * @returns boolean\r\n */\r\nexport function isProductInStock(product: ProductWithCategory): boolean {\r\n  return product.stock > 0;\r\n}\r\n\r\n/**\r\n * Obtiene la URL de la imagen principal del producto\r\n * @param product - Producto\r\n * @returns string\r\n */\r\nexport function getProductMainImage(product: ProductWithCategory): string {\r\n  if (product.images?.previews?.[0]) {\r\n    return product.images.previews[0];\r\n  }\r\n  \r\n  if (product.images?.thumbnails?.[0]) {\r\n    return product.images.thumbnails[0];\r\n  }\r\n  \r\n  return '/images/products/placeholder.jpg';\r\n}\r\n"],"names":["calculateDiscountPercentage","convertLegacyProduct","formatPrice","getDiscountedProducts","getProductById","getProductMainImage","getProducts","getProductsByBrand","getProductsByCategory","getRelatedProducts","isProductInStock","searchProducts","filters","searchParams","URLSearchParams","Object","entries","forEach","key","value","undefined","append","toString","url","DEBUG_MODE","process","env","NODE_ENV","console","log","response","fetch","method","headers","status","statusText","result","safeApiResponseJson","success","error","data","pagination","page","limit","total","totalPages","message","length","Error","id","searchTerm","search","categorySlug","category","discountedProducts","filter","product","discounted_price","price","brandName","brand","productId","categoryId","slice","oldProduct","name","title","slug","toLowerCase","replace","description","discountedPrice","stock","category_id","images","imgs","created_at","Date","toISOString","updated_at","originalPrice","Math","round","currency","Intl","NumberFormat","style","minimumFractionDigits","maximumFractionDigits","format","previews","thumbnails"],"mappings":"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"}