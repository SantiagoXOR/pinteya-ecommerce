{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\hooks\\useCheckout.test.ts"],"sourcesContent":["// ===================================\n// PINTEYA E-COMMERCE - TEST useCheckout HOOK\n// ===================================\n\nimport React from 'react'\nimport { renderHook, act } from '@testing-library/react'\nimport { Provider } from 'react-redux'\nimport { configureStore } from '@reduxjs/toolkit'\nimport { useCheckout } from '@/hooks/useCheckout'\nimport cartReducer from '@/redux/features/cart-slice'\n\n// Mock data\nconst mockCartItems = [\n  {\n    id: 1,\n    title: 'Test Product 1',\n    price: 1000,\n    discountedPrice: 900,\n    quantity: 2,\n  },\n  {\n    id: 2,\n    title: 'Test Product 2',\n    price: 2000,\n    discountedPrice: 2000,\n    quantity: 1,\n  },\n]\n\n// Mock store setup\nconst createMockStore = (initialState = {}) => {\n  return configureStore({\n    reducer: {\n      cartReducer: cartReducer,\n    },\n    preloadedState: {\n      cartReducer: {\n        items: mockCartItems,\n        ...initialState.cartReducer,\n      },\n    },\n  })\n}\n\n// Mock fetch\nconst mockFetch = jest.fn()\nglobal.fetch = mockFetch\n\n// Mock Clerk\njest.mock('@clerk/nextjs', () => ({\n  useUser: () => ({\n    user: null,\n    isLoaded: true,\n  }),\n}))\n\n// Helper function to render hook with Redux store\nconst renderHookWithStore = (initialState = {}) => {\n  const store = createMockStore(initialState)\n  const wrapper = ({ children }: { children: React.ReactNode }) =>\n    React.createElement(Provider, { store }, children)\n\n  return {\n    ...renderHook(() => useCheckout(), { wrapper }),\n    store,\n  }\n}\n\ndescribe('useCheckout Hook', () => {\n  beforeEach(() => {\n    jest.clearAllMocks()\n\n    // Mock successful payment preference creation\n    mockFetch.mockResolvedValue({\n      ok: true,\n      json: async () => ({\n        success: true,\n        data: {\n          init_point: 'https://mercadopago.com/checkout/test',\n          preference_id: 'test-preference-id',\n        },\n      }),\n    })\n  })\n\n  it('initializes with correct default state', () => {\n    const { result } = renderHookWithStore()\n\n    expect(result.current.isLoading).toBe(false)\n    expect(result.current.errors).toEqual({})\n    expect(result.current.step).toBe('form')\n  })\n\n  it('updates billing data correctly', () => {\n    const { result } = renderHookWithStore()\n\n    act(() => {\n      result.current.updateBillingData({\n        firstName: 'Juan',\n        lastName: 'Pérez',\n        email: 'juan@test.com',\n      })\n    })\n\n    expect(result.current.formData.billing.firstName).toBe('Juan')\n    expect(result.current.formData.billing.lastName).toBe('Pérez')\n    expect(result.current.formData.billing.email).toBe('juan@test.com')\n  })\n\n  it('calculates shipping cost correctly', () => {\n    const { result } = renderHookWithStore()\n\n    // Test free shipping\n    expect(result.current.shippingCost).toBeGreaterThanOrEqual(0)\n  })\n\n  it('validates form correctly', () => {\n    const { result } = renderHookWithStore()\n\n    // Test validation with empty form\n    act(() => {\n      const isValid = result.current.validateForm()\n      expect(isValid).toBe(false)\n    })\n\n    expect(result.current.errors.firstName).toBe('Nombre es requerido')\n    expect(result.current.errors.email).toBe('Email es requerido')\n  })\n\n  it('calculates total correctly', () => {\n    const { result } = renderHookWithStore()\n\n    expect(result.current.finalTotal).toBeGreaterThan(0)\n    expect(typeof result.current.finalTotal).toBe('number')\n  })\n})\n"],"names":["jest","mock","useUser","user","isLoaded","mockCartItems","id","title","price","discountedPrice","quantity","createMockStore","initialState","configureStore","reducer","cartReducer","preloadedState","items","mockFetch","fn","global","fetch","renderHookWithStore","store","wrapper","children","React","createElement","Provider","renderHook","useCheckout","describe","beforeEach","clearAllMocks","mockResolvedValue","ok","json","success","data","init_point","preference_id","it","result","expect","current","isLoading","toBe","errors","toEqual","step","act","updateBillingData","firstName","lastName","email","formData","billing","shippingCost","toBeGreaterThanOrEqual","isValid","validateForm","finalTotal","toBeGreaterThan"],"mappings":"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"}