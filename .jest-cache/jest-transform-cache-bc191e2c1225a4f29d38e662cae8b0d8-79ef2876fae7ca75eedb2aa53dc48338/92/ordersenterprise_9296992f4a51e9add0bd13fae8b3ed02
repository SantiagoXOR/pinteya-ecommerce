9abdb2dd5e5126378e2c0b84b844c257
// ===================================
// PINTEYA E-COMMERCE - ORDERS ENTERPRISE UTILITIES
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get calculateAverageStateTime () {
        return calculateAverageStateTime;
    },
    get calculateOrderMetrics () {
        return calculateOrderMetrics;
    },
    get filterOrders () {
        return filterOrders;
    },
    get formatOrderStatus () {
        return formatOrderStatus;
    },
    get formatPaymentStatus () {
        return formatPaymentStatus;
    },
    get generateStatusChangeMessage () {
        return generateStatusChangeMessage;
    },
    get getAvailableTransitions () {
        return getAvailableTransitions;
    },
    get ordersToCSV () {
        return ordersToCSV;
    },
    get shouldNotifyCustomer () {
        return shouldNotifyCustomer;
    },
    get sortOrders () {
        return sortOrders;
    },
    get statusRequiresAdditionalInfo () {
        return statusRequiresAdditionalInfo;
    },
    get validateOrderData () {
        return validateOrderData;
    },
    get validateStateTransition () {
        return validateStateTransition;
    }
});
const _ordersenterprise = require("../types/orders-enterprise");
function validateStateTransition(currentStatus, newStatus) {
    if (currentStatus === newStatus) {
        return {
            valid: false,
            message: 'El estado ya es el mismo',
            allowedTransitions: _ordersenterprise.ORDER_STATE_TRANSITIONS[currentStatus] || []
        };
    }
    const allowedTransitions = _ordersenterprise.ORDER_STATE_TRANSITIONS[currentStatus];
    if (!allowedTransitions || !allowedTransitions.includes(newStatus)) {
        return {
            valid: false,
            message: `Transición no permitida: ${_ordersenterprise.ORDER_STATUS_DESCRIPTIONS[currentStatus]} → ${_ordersenterprise.ORDER_STATUS_DESCRIPTIONS[newStatus]}`,
            allowedTransitions: allowedTransitions || []
        };
    }
    return {
        valid: true,
        allowedTransitions: allowedTransitions || []
    };
}
function getAvailableTransitions(currentStatus) {
    const transitions = _ordersenterprise.ORDER_STATE_TRANSITIONS[currentStatus] || [];
    return transitions.map((status)=>({
            status,
            description: _ordersenterprise.ORDER_STATUS_DESCRIPTIONS[status],
            requiresReason: [
                'cancelled',
                'refunded',
                'returned'
            ].includes(status)
        }));
}
function statusRequiresAdditionalInfo(status) {
    return {
        requiresTracking: [
            'shipped'
        ].includes(status),
        requiresCarrier: [
            'shipped'
        ].includes(status),
        requiresReason: [
            'cancelled',
            'refunded',
            'returned'
        ].includes(status),
        requiresEstimatedDelivery: [
            'shipped'
        ].includes(status)
    };
}
function formatOrderStatus(status) {
    const statusMap = {
        pending: {
            label: 'Pendiente',
            color: 'yellow',
            description: 'Esperando confirmación',
            icon: 'clock'
        },
        confirmed: {
            label: 'Confirmada',
            color: 'blue',
            description: 'Confirmada, preparando pedido',
            icon: 'check-circle'
        },
        processing: {
            label: 'Procesando',
            color: 'orange',
            description: 'En proceso de preparación',
            icon: 'cog'
        },
        shipped: {
            label: 'Enviada',
            color: 'purple',
            description: 'Producto en camino',
            icon: 'truck'
        },
        delivered: {
            label: 'Entregada',
            color: 'green',
            description: 'Producto entregado exitosamente',
            icon: 'check'
        },
        cancelled: {
            label: 'Cancelada',
            color: 'red',
            description: 'Orden cancelada',
            icon: 'x-circle'
        },
        refunded: {
            label: 'Reembolsada',
            color: 'gray',
            description: 'Dinero reembolsado',
            icon: 'arrow-left'
        },
        returned: {
            label: 'Devuelta',
            color: 'amber',
            description: 'Producto devuelto',
            icon: 'arrow-up'
        }
    };
    return statusMap[status] || statusMap.pending;
}
function formatPaymentStatus(status) {
    const statusMap = {
        pending: {
            label: 'Pendiente',
            color: 'yellow',
            description: 'Esperando pago'
        },
        paid: {
            label: 'Pagado',
            color: 'green',
            description: 'Pago confirmado'
        },
        failed: {
            label: 'Falló',
            color: 'red',
            description: 'Error en el pago'
        },
        refunded: {
            label: 'Reembolsado',
            color: 'gray',
            description: 'Dinero devuelto'
        }
    };
    return statusMap[status] || statusMap.pending;
}
function calculateAverageStateTime(statusHistory) {
    const stateTimes = {};
    for(let i = 0; i < statusHistory.length - 1; i++){
        const current = statusHistory[i];
        const next = statusHistory[i + 1];
        const timeInState = new Date(next.created_at).getTime() - new Date(current.created_at).getTime();
        const stateKey = `${current.new_status}_to_${next.new_status}`;
        if (!stateTimes[stateKey]) {
            stateTimes[stateKey] = [];
        }
        stateTimes[stateKey].push(timeInState);
    }
    const averages = {};
    for (const [key, times] of Object.entries(stateTimes)){
        averages[key] = times.reduce((sum, time)=>sum + time, 0) / times.length;
    }
    return averages;
}
function calculateOrderMetrics(order) {
    const totalItems = order.order_items?.reduce((sum, item)=>sum + item.quantity, 0) || 0;
    const averageItemPrice = totalItems > 0 ? order.total / totalItems : 0;
    let processingTime;
    let deliveryTime;
    if (order.status_history && order.status_history.length > 0) {
        const confirmedTime = order.status_history.find((h)=>h.new_status === 'confirmed')?.created_at;
        const shippedTime = order.status_history.find((h)=>h.new_status === 'shipped')?.created_at;
        const deliveredTime = order.status_history.find((h)=>h.new_status === 'delivered')?.created_at;
        if (confirmedTime && shippedTime) {
            processingTime = new Date(shippedTime).getTime() - new Date(confirmedTime).getTime();
        }
        if (shippedTime && deliveredTime) {
            deliveryTime = new Date(deliveredTime).getTime() - new Date(shippedTime).getTime();
        }
    }
    return {
        totalItems,
        averageItemPrice,
        processingTime,
        deliveryTime
    };
}
function filterOrders(orders, filters) {
    return orders.filter((order)=>{
        // Filtro por estado
        if (filters.status && order.status !== filters.status) {
            return false;
        }
        // Filtro por estado de pago
        if (filters.paymentStatus && order.payment_status !== filters.paymentStatus) {
            return false;
        }
        // Filtro por fecha desde
        if (filters.dateFrom && new Date(order.created_at) < new Date(filters.dateFrom)) {
            return false;
        }
        // Filtro por fecha hasta
        if (filters.dateTo && new Date(order.created_at) > new Date(filters.dateTo)) {
            return false;
        }
        // Filtro por monto mínimo
        if (filters.minAmount && order.total < filters.minAmount) {
            return false;
        }
        // Filtro por monto máximo
        if (filters.maxAmount && order.total > filters.maxAmount) {
            return false;
        }
        // Filtro por búsqueda de texto
        if (filters.search) {
            const searchLower = filters.search.toLowerCase();
            const searchableText = [
                order.order_number,
                order.user_profiles?.name,
                order.user_profiles?.email,
                order.notes,
                order.admin_notes
            ].filter(Boolean).join(' ').toLowerCase();
            if (!searchableText.includes(searchLower)) {
                return false;
            }
        }
        return true;
    });
}
function sortOrders(orders, sortBy, sortOrder = 'desc') {
    return [
        ...orders
    ].sort((a, b)=>{
        let comparison = 0;
        switch(sortBy){
            case 'created_at':
                comparison = new Date(a.created_at).getTime() - new Date(b.created_at).getTime();
                break;
            case 'total':
                comparison = a.total - b.total;
                break;
            case 'order_number':
                comparison = a.order_number.localeCompare(b.order_number);
                break;
            case 'status':
                comparison = a.status.localeCompare(b.status);
                break;
        }
        return sortOrder === 'asc' ? comparison : -comparison;
    });
}
function generateStatusChangeMessage(orderNumber, previousStatus, newStatus, trackingNumber) {
    const statusInfo = formatOrderStatus(newStatus);
    let message = `Tu orden ${orderNumber} ha cambiado a: ${statusInfo.label}`;
    if (newStatus === 'shipped' && trackingNumber) {
        message += `. Número de seguimiento: ${trackingNumber}`;
    }
    return message;
}
function shouldNotifyCustomer(previousStatus, newStatus) {
    // Notificar en cambios importantes para el cliente
    const notifiableTransitions = [
        'confirmed',
        'shipped',
        'delivered',
        'cancelled'
    ];
    return notifiableTransitions.includes(newStatus);
}
function validateOrderData(orderData) {
    const errors = [];
    if (orderData.total !== undefined && orderData.total <= 0) {
        errors.push('El monto total debe ser mayor a 0');
    }
    if (orderData.order_number && !/^ORD-\d+-[A-Z0-9]+$/.test(orderData.order_number)) {
        errors.push('Formato de número de orden inválido');
    }
    if (orderData.tracking_number && orderData.tracking_number.length < 3) {
        errors.push('Número de seguimiento muy corto');
    }
    return {
        valid: errors.length === 0,
        errors
    };
}
function ordersToCSV(orders) {
    const headers = [
        'Número de Orden',
        'Cliente',
        'Email',
        'Estado',
        'Estado de Pago',
        'Total',
        'Fecha de Creación',
        'Última Actualización'
    ];
    const rows = orders.map((order)=>[
            order.order_number,
            order.user_profiles?.name || '',
            order.user_profiles?.email || '',
            formatOrderStatus(order.status).label,
            formatPaymentStatus(order.payment_status).label,
            order.total.toString(),
            new Date(order.created_at).toLocaleDateString(),
            new Date(order.updated_at).toLocaleDateString()
        ]);
    return [
        headers,
        ...rows
    ].map((row)=>row.map((cell)=>`"${cell}"`).join(',')).join('\n');
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxvcmRlcnMtZW50ZXJwcmlzZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUElOVEVZQSBFLUNPTU1FUkNFIC0gT1JERVJTIEVOVEVSUFJJU0UgVVRJTElUSUVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyBcbiAgT3JkZXJTdGF0dXMsIFxuICBQYXltZW50U3RhdHVzLFxuICBPUkRFUl9TVEFURV9UUkFOU0lUSU9OUyxcbiAgT1JERVJfU1RBVFVTX0RFU0NSSVBUSU9OUyxcbiAgU3RhdGVUcmFuc2l0aW9uVmFsaWRhdGlvbixcbiAgT3JkZXJFbnRlcnByaXNlLFxuICBPcmRlclN0YXR1c0hpc3RvcnksXG4gIE9yZGVyTm90ZVxufSBmcm9tICdAL3R5cGVzL29yZGVycy1lbnRlcnByaXNlJztcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFZBTElEQUNJT05FUyBERSBFU1RBRE9cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogVmFsaWRhIHNpIHVuYSB0cmFuc2ljacOzbiBkZSBlc3RhZG8gZXMgcGVybWl0aWRhXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVN0YXRlVHJhbnNpdGlvbihcbiAgY3VycmVudFN0YXR1czogT3JkZXJTdGF0dXMsIFxuICBuZXdTdGF0dXM6IE9yZGVyU3RhdHVzXG4pOiBTdGF0ZVRyYW5zaXRpb25WYWxpZGF0aW9uIHtcbiAgaWYgKGN1cnJlbnRTdGF0dXMgPT09IG5ld1N0YXR1cykge1xuICAgIHJldHVybiB7IFxuICAgICAgdmFsaWQ6IGZhbHNlLCBcbiAgICAgIG1lc3NhZ2U6ICdFbCBlc3RhZG8geWEgZXMgZWwgbWlzbW8nLFxuICAgICAgYWxsb3dlZFRyYW5zaXRpb25zOiBPUkRFUl9TVEFURV9UUkFOU0lUSU9OU1tjdXJyZW50U3RhdHVzXSB8fCBbXVxuICAgIH07XG4gIH1cbiAgXG4gIGNvbnN0IGFsbG93ZWRUcmFuc2l0aW9ucyA9IE9SREVSX1NUQVRFX1RSQU5TSVRJT05TW2N1cnJlbnRTdGF0dXNdO1xuICBpZiAoIWFsbG93ZWRUcmFuc2l0aW9ucyB8fCAhYWxsb3dlZFRyYW5zaXRpb25zLmluY2x1ZGVzKG5ld1N0YXR1cykpIHtcbiAgICByZXR1cm4geyBcbiAgICAgIHZhbGlkOiBmYWxzZSwgXG4gICAgICBtZXNzYWdlOiBgVHJhbnNpY2nDs24gbm8gcGVybWl0aWRhOiAke09SREVSX1NUQVRVU19ERVNDUklQVElPTlNbY3VycmVudFN0YXR1c119IOKGkiAke09SREVSX1NUQVRVU19ERVNDUklQVElPTlNbbmV3U3RhdHVzXX1gLFxuICAgICAgYWxsb3dlZFRyYW5zaXRpb25zOiBhbGxvd2VkVHJhbnNpdGlvbnMgfHwgW11cbiAgICB9O1xuICB9XG4gIFxuICByZXR1cm4geyBcbiAgICB2YWxpZDogdHJ1ZSxcbiAgICBhbGxvd2VkVHJhbnNpdGlvbnM6IGFsbG93ZWRUcmFuc2l0aW9ucyB8fCBbXVxuICB9O1xufVxuXG4vKipcbiAqIE9idGllbmUgbGFzIHRyYW5zaWNpb25lcyBkaXNwb25pYmxlcyBwYXJhIHVuIGVzdGFkb1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlVHJhbnNpdGlvbnMoY3VycmVudFN0YXR1czogT3JkZXJTdGF0dXMpOiB7XG4gIHN0YXR1czogT3JkZXJTdGF0dXM7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHJlcXVpcmVzUmVhc29uOiBib29sZWFuO1xufVtdIHtcbiAgY29uc3QgdHJhbnNpdGlvbnMgPSBPUkRFUl9TVEFURV9UUkFOU0lUSU9OU1tjdXJyZW50U3RhdHVzXSB8fCBbXTtcbiAgXG4gIHJldHVybiB0cmFuc2l0aW9ucy5tYXAoc3RhdHVzID0+ICh7XG4gICAgc3RhdHVzLFxuICAgIGRlc2NyaXB0aW9uOiBPUkRFUl9TVEFUVVNfREVTQ1JJUFRJT05TW3N0YXR1c10sXG4gICAgcmVxdWlyZXNSZWFzb246IFsnY2FuY2VsbGVkJywgJ3JlZnVuZGVkJywgJ3JldHVybmVkJ10uaW5jbHVkZXMoc3RhdHVzKVxuICB9KSk7XG59XG5cbi8qKlxuICogVmVyaWZpY2Egc2kgdW4gZXN0YWRvIHJlcXVpZXJlIGluZm9ybWFjacOzbiBhZGljaW9uYWxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0YXR1c1JlcXVpcmVzQWRkaXRpb25hbEluZm8oc3RhdHVzOiBPcmRlclN0YXR1cyk6IHtcbiAgcmVxdWlyZXNUcmFja2luZzogYm9vbGVhbjtcbiAgcmVxdWlyZXNDYXJyaWVyOiBib29sZWFuO1xuICByZXF1aXJlc1JlYXNvbjogYm9vbGVhbjtcbiAgcmVxdWlyZXNFc3RpbWF0ZWREZWxpdmVyeTogYm9vbGVhbjtcbn0ge1xuICByZXR1cm4ge1xuICAgIHJlcXVpcmVzVHJhY2tpbmc6IFsnc2hpcHBlZCddLmluY2x1ZGVzKHN0YXR1cyksXG4gICAgcmVxdWlyZXNDYXJyaWVyOiBbJ3NoaXBwZWQnXS5pbmNsdWRlcyhzdGF0dXMpLFxuICAgIHJlcXVpcmVzUmVhc29uOiBbJ2NhbmNlbGxlZCcsICdyZWZ1bmRlZCcsICdyZXR1cm5lZCddLmluY2x1ZGVzKHN0YXR1cyksXG4gICAgcmVxdWlyZXNFc3RpbWF0ZWREZWxpdmVyeTogWydzaGlwcGVkJ10uaW5jbHVkZXMoc3RhdHVzKVxuICB9O1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRk9STUFURU8gWSBESVNQTEFZXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEZvcm1hdGVhIGVsIGVzdGFkbyBkZSB1bmEgb3JkZW4gcGFyYSBtb3N0cmFyIGFsIHVzdWFyaW9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdE9yZGVyU3RhdHVzKHN0YXR1czogT3JkZXJTdGF0dXMpOiB7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGNvbG9yOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIGljb246IHN0cmluZztcbn0ge1xuICBjb25zdCBzdGF0dXNNYXA6IFJlY29yZDxPcmRlclN0YXR1cywgeyBsYWJlbDogc3RyaW5nOyBjb2xvcjogc3RyaW5nOyBkZXNjcmlwdGlvbjogc3RyaW5nOyBpY29uOiBzdHJpbmcgfT4gPSB7XG4gICAgcGVuZGluZzoge1xuICAgICAgbGFiZWw6ICdQZW5kaWVudGUnLFxuICAgICAgY29sb3I6ICd5ZWxsb3cnLFxuICAgICAgZGVzY3JpcHRpb246ICdFc3BlcmFuZG8gY29uZmlybWFjacOzbicsXG4gICAgICBpY29uOiAnY2xvY2snXG4gICAgfSxcbiAgICBjb25maXJtZWQ6IHtcbiAgICAgIGxhYmVsOiAnQ29uZmlybWFkYScsXG4gICAgICBjb2xvcjogJ2JsdWUnLFxuICAgICAgZGVzY3JpcHRpb246ICdDb25maXJtYWRhLCBwcmVwYXJhbmRvIHBlZGlkbycsXG4gICAgICBpY29uOiAnY2hlY2stY2lyY2xlJ1xuICAgIH0sXG4gICAgcHJvY2Vzc2luZzoge1xuICAgICAgbGFiZWw6ICdQcm9jZXNhbmRvJyxcbiAgICAgIGNvbG9yOiAnb3JhbmdlJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnRW4gcHJvY2VzbyBkZSBwcmVwYXJhY2nDs24nLFxuICAgICAgaWNvbjogJ2NvZydcbiAgICB9LFxuICAgIHNoaXBwZWQ6IHtcbiAgICAgIGxhYmVsOiAnRW52aWFkYScsXG4gICAgICBjb2xvcjogJ3B1cnBsZScsXG4gICAgICBkZXNjcmlwdGlvbjogJ1Byb2R1Y3RvIGVuIGNhbWlubycsXG4gICAgICBpY29uOiAndHJ1Y2snXG4gICAgfSxcbiAgICBkZWxpdmVyZWQ6IHtcbiAgICAgIGxhYmVsOiAnRW50cmVnYWRhJyxcbiAgICAgIGNvbG9yOiAnZ3JlZW4nLFxuICAgICAgZGVzY3JpcHRpb246ICdQcm9kdWN0byBlbnRyZWdhZG8gZXhpdG9zYW1lbnRlJyxcbiAgICAgIGljb246ICdjaGVjaydcbiAgICB9LFxuICAgIGNhbmNlbGxlZDoge1xuICAgICAgbGFiZWw6ICdDYW5jZWxhZGEnLFxuICAgICAgY29sb3I6ICdyZWQnLFxuICAgICAgZGVzY3JpcHRpb246ICdPcmRlbiBjYW5jZWxhZGEnLFxuICAgICAgaWNvbjogJ3gtY2lyY2xlJ1xuICAgIH0sXG4gICAgcmVmdW5kZWQ6IHtcbiAgICAgIGxhYmVsOiAnUmVlbWJvbHNhZGEnLFxuICAgICAgY29sb3I6ICdncmF5JyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnRGluZXJvIHJlZW1ib2xzYWRvJyxcbiAgICAgIGljb246ICdhcnJvdy1sZWZ0J1xuICAgIH0sXG4gICAgcmV0dXJuZWQ6IHtcbiAgICAgIGxhYmVsOiAnRGV2dWVsdGEnLFxuICAgICAgY29sb3I6ICdhbWJlcicsXG4gICAgICBkZXNjcmlwdGlvbjogJ1Byb2R1Y3RvIGRldnVlbHRvJyxcbiAgICAgIGljb246ICdhcnJvdy11cCdcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHN0YXR1c01hcFtzdGF0dXNdIHx8IHN0YXR1c01hcC5wZW5kaW5nO1xufVxuXG4vKipcbiAqIEZvcm1hdGVhIGVsIGVzdGFkbyBkZSBwYWdvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRQYXltZW50U3RhdHVzKHN0YXR1czogUGF5bWVudFN0YXR1cyk6IHtcbiAgbGFiZWw6IHN0cmluZztcbiAgY29sb3I6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbn0ge1xuICBjb25zdCBzdGF0dXNNYXA6IFJlY29yZDxQYXltZW50U3RhdHVzLCB7IGxhYmVsOiBzdHJpbmc7IGNvbG9yOiBzdHJpbmc7IGRlc2NyaXB0aW9uOiBzdHJpbmcgfT4gPSB7XG4gICAgcGVuZGluZzoge1xuICAgICAgbGFiZWw6ICdQZW5kaWVudGUnLFxuICAgICAgY29sb3I6ICd5ZWxsb3cnLFxuICAgICAgZGVzY3JpcHRpb246ICdFc3BlcmFuZG8gcGFnbydcbiAgICB9LFxuICAgIHBhaWQ6IHtcbiAgICAgIGxhYmVsOiAnUGFnYWRvJyxcbiAgICAgIGNvbG9yOiAnZ3JlZW4nLFxuICAgICAgZGVzY3JpcHRpb246ICdQYWdvIGNvbmZpcm1hZG8nXG4gICAgfSxcbiAgICBmYWlsZWQ6IHtcbiAgICAgIGxhYmVsOiAnRmFsbMOzJyxcbiAgICAgIGNvbG9yOiAncmVkJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnRXJyb3IgZW4gZWwgcGFnbydcbiAgICB9LFxuICAgIHJlZnVuZGVkOiB7XG4gICAgICBsYWJlbDogJ1JlZW1ib2xzYWRvJyxcbiAgICAgIGNvbG9yOiAnZ3JheScsXG4gICAgICBkZXNjcmlwdGlvbjogJ0RpbmVybyBkZXZ1ZWx0bydcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHN0YXR1c01hcFtzdGF0dXNdIHx8IHN0YXR1c01hcC5wZW5kaW5nO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ8OBTENVTE9TIFkgTcOJVFJJQ0FTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIENhbGN1bGEgZWwgdGllbXBvIHByb21lZGlvIGVudHJlIGVzdGFkb3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUF2ZXJhZ2VTdGF0ZVRpbWUoXG4gIHN0YXR1c0hpc3Rvcnk6IE9yZGVyU3RhdHVzSGlzdG9yeVtdXG4pOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+IHtcbiAgY29uc3Qgc3RhdGVUaW1lczogUmVjb3JkPHN0cmluZywgbnVtYmVyW10+ID0ge307XG4gIFxuICBmb3IgKGxldCBpID0gMDsgaSA8IHN0YXR1c0hpc3RvcnkubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgY29uc3QgY3VycmVudCA9IHN0YXR1c0hpc3RvcnlbaV07XG4gICAgY29uc3QgbmV4dCA9IHN0YXR1c0hpc3RvcnlbaSArIDFdO1xuICAgIFxuICAgIGNvbnN0IHRpbWVJblN0YXRlID0gbmV3IERhdGUobmV4dC5jcmVhdGVkX2F0KS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShjdXJyZW50LmNyZWF0ZWRfYXQpLmdldFRpbWUoKTtcbiAgICBjb25zdCBzdGF0ZUtleSA9IGAke2N1cnJlbnQubmV3X3N0YXR1c31fdG9fJHtuZXh0Lm5ld19zdGF0dXN9YDtcbiAgICBcbiAgICBpZiAoIXN0YXRlVGltZXNbc3RhdGVLZXldKSB7XG4gICAgICBzdGF0ZVRpbWVzW3N0YXRlS2V5XSA9IFtdO1xuICAgIH1cbiAgICBzdGF0ZVRpbWVzW3N0YXRlS2V5XS5wdXNoKHRpbWVJblN0YXRlKTtcbiAgfVxuICBcbiAgY29uc3QgYXZlcmFnZXM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgZm9yIChjb25zdCBba2V5LCB0aW1lc10gb2YgT2JqZWN0LmVudHJpZXMoc3RhdGVUaW1lcykpIHtcbiAgICBhdmVyYWdlc1trZXldID0gdGltZXMucmVkdWNlKChzdW0sIHRpbWUpID0+IHN1bSArIHRpbWUsIDApIC8gdGltZXMubGVuZ3RoO1xuICB9XG4gIFxuICByZXR1cm4gYXZlcmFnZXM7XG59XG5cbi8qKlxuICogQ2FsY3VsYSBtw6l0cmljYXMgZGUgdW5hIG9yZGVuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVPcmRlck1ldHJpY3Mob3JkZXI6IE9yZGVyRW50ZXJwcmlzZSk6IHtcbiAgdG90YWxJdGVtczogbnVtYmVyO1xuICBhdmVyYWdlSXRlbVByaWNlOiBudW1iZXI7XG4gIHByb2Nlc3NpbmdUaW1lPzogbnVtYmVyO1xuICBkZWxpdmVyeVRpbWU/OiBudW1iZXI7XG59IHtcbiAgY29uc3QgdG90YWxJdGVtcyA9IG9yZGVyLm9yZGVyX2l0ZW1zPy5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgaXRlbS5xdWFudGl0eSwgMCkgfHwgMDtcbiAgY29uc3QgYXZlcmFnZUl0ZW1QcmljZSA9IHRvdGFsSXRlbXMgPiAwID8gb3JkZXIudG90YWwgLyB0b3RhbEl0ZW1zIDogMDtcbiAgXG4gIGxldCBwcm9jZXNzaW5nVGltZTogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICBsZXQgZGVsaXZlcnlUaW1lOiBudW1iZXIgfCB1bmRlZmluZWQ7XG4gIFxuICBpZiAob3JkZXIuc3RhdHVzX2hpc3RvcnkgJiYgb3JkZXIuc3RhdHVzX2hpc3RvcnkubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IGNvbmZpcm1lZFRpbWUgPSBvcmRlci5zdGF0dXNfaGlzdG9yeS5maW5kKGggPT4gaC5uZXdfc3RhdHVzID09PSAnY29uZmlybWVkJyk/LmNyZWF0ZWRfYXQ7XG4gICAgY29uc3Qgc2hpcHBlZFRpbWUgPSBvcmRlci5zdGF0dXNfaGlzdG9yeS5maW5kKGggPT4gaC5uZXdfc3RhdHVzID09PSAnc2hpcHBlZCcpPy5jcmVhdGVkX2F0O1xuICAgIGNvbnN0IGRlbGl2ZXJlZFRpbWUgPSBvcmRlci5zdGF0dXNfaGlzdG9yeS5maW5kKGggPT4gaC5uZXdfc3RhdHVzID09PSAnZGVsaXZlcmVkJyk/LmNyZWF0ZWRfYXQ7XG4gICAgXG4gICAgaWYgKGNvbmZpcm1lZFRpbWUgJiYgc2hpcHBlZFRpbWUpIHtcbiAgICAgIHByb2Nlc3NpbmdUaW1lID0gbmV3IERhdGUoc2hpcHBlZFRpbWUpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGNvbmZpcm1lZFRpbWUpLmdldFRpbWUoKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHNoaXBwZWRUaW1lICYmIGRlbGl2ZXJlZFRpbWUpIHtcbiAgICAgIGRlbGl2ZXJ5VGltZSA9IG5ldyBEYXRlKGRlbGl2ZXJlZFRpbWUpLmdldFRpbWUoKSAtIG5ldyBEYXRlKHNoaXBwZWRUaW1lKS5nZXRUaW1lKCk7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4ge1xuICAgIHRvdGFsSXRlbXMsXG4gICAgYXZlcmFnZUl0ZW1QcmljZSxcbiAgICBwcm9jZXNzaW5nVGltZSxcbiAgICBkZWxpdmVyeVRpbWVcbiAgfTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZJTFRST1MgWSBCw5pTUVVFREFcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogRmlsdHJhIMOzcmRlbmVzIHBvciBjcml0ZXJpb3MgbcO6bHRpcGxlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyT3JkZXJzKFxuICBvcmRlcnM6IE9yZGVyRW50ZXJwcmlzZVtdLFxuICBmaWx0ZXJzOiB7XG4gICAgc3RhdHVzPzogT3JkZXJTdGF0dXM7XG4gICAgcGF5bWVudFN0YXR1cz86IFBheW1lbnRTdGF0dXM7XG4gICAgZGF0ZUZyb20/OiBzdHJpbmc7XG4gICAgZGF0ZVRvPzogc3RyaW5nO1xuICAgIHNlYXJjaD86IHN0cmluZztcbiAgICBtaW5BbW91bnQ/OiBudW1iZXI7XG4gICAgbWF4QW1vdW50PzogbnVtYmVyO1xuICB9XG4pOiBPcmRlckVudGVycHJpc2VbXSB7XG4gIHJldHVybiBvcmRlcnMuZmlsdGVyKG9yZGVyID0+IHtcbiAgICAvLyBGaWx0cm8gcG9yIGVzdGFkb1xuICAgIGlmIChmaWx0ZXJzLnN0YXR1cyAmJiBvcmRlci5zdGF0dXMgIT09IGZpbHRlcnMuc3RhdHVzKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIEZpbHRybyBwb3IgZXN0YWRvIGRlIHBhZ29cbiAgICBpZiAoZmlsdGVycy5wYXltZW50U3RhdHVzICYmIG9yZGVyLnBheW1lbnRfc3RhdHVzICE9PSBmaWx0ZXJzLnBheW1lbnRTdGF0dXMpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgLy8gRmlsdHJvIHBvciBmZWNoYSBkZXNkZVxuICAgIGlmIChmaWx0ZXJzLmRhdGVGcm9tICYmIG5ldyBEYXRlKG9yZGVyLmNyZWF0ZWRfYXQpIDwgbmV3IERhdGUoZmlsdGVycy5kYXRlRnJvbSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgLy8gRmlsdHJvIHBvciBmZWNoYSBoYXN0YVxuICAgIGlmIChmaWx0ZXJzLmRhdGVUbyAmJiBuZXcgRGF0ZShvcmRlci5jcmVhdGVkX2F0KSA+IG5ldyBEYXRlKGZpbHRlcnMuZGF0ZVRvKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICAvLyBGaWx0cm8gcG9yIG1vbnRvIG3DrW5pbW9cbiAgICBpZiAoZmlsdGVycy5taW5BbW91bnQgJiYgb3JkZXIudG90YWwgPCBmaWx0ZXJzLm1pbkFtb3VudCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICAvLyBGaWx0cm8gcG9yIG1vbnRvIG3DoXhpbW9cbiAgICBpZiAoZmlsdGVycy5tYXhBbW91bnQgJiYgb3JkZXIudG90YWwgPiBmaWx0ZXJzLm1heEFtb3VudCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICAvLyBGaWx0cm8gcG9yIGLDunNxdWVkYSBkZSB0ZXh0b1xuICAgIGlmIChmaWx0ZXJzLnNlYXJjaCkge1xuICAgICAgY29uc3Qgc2VhcmNoTG93ZXIgPSBmaWx0ZXJzLnNlYXJjaC50b0xvd2VyQ2FzZSgpO1xuICAgICAgY29uc3Qgc2VhcmNoYWJsZVRleHQgPSBbXG4gICAgICAgIG9yZGVyLm9yZGVyX251bWJlcixcbiAgICAgICAgb3JkZXIudXNlcl9wcm9maWxlcz8ubmFtZSxcbiAgICAgICAgb3JkZXIudXNlcl9wcm9maWxlcz8uZW1haWwsXG4gICAgICAgIG9yZGVyLm5vdGVzLFxuICAgICAgICBvcmRlci5hZG1pbl9ub3Rlc1xuICAgICAgXS5maWx0ZXIoQm9vbGVhbikuam9pbignICcpLnRvTG93ZXJDYXNlKCk7XG4gICAgICBcbiAgICAgIGlmICghc2VhcmNoYWJsZVRleHQuaW5jbHVkZXMoc2VhcmNoTG93ZXIpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRydWU7XG4gIH0pO1xufVxuXG4vKipcbiAqIE9yZGVuYSDDs3JkZW5lcyBwb3IgY3JpdGVyaW8gZXNwZWPDrWZpY29cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNvcnRPcmRlcnMoXG4gIG9yZGVyczogT3JkZXJFbnRlcnByaXNlW10sXG4gIHNvcnRCeTogJ2NyZWF0ZWRfYXQnIHwgJ3RvdGFsJyB8ICdvcmRlcl9udW1iZXInIHwgJ3N0YXR1cycsXG4gIHNvcnRPcmRlcjogJ2FzYycgfCAnZGVzYycgPSAnZGVzYydcbik6IE9yZGVyRW50ZXJwcmlzZVtdIHtcbiAgcmV0dXJuIFsuLi5vcmRlcnNdLnNvcnQoKGEsIGIpID0+IHtcbiAgICBsZXQgY29tcGFyaXNvbiA9IDA7XG4gICAgXG4gICAgc3dpdGNoIChzb3J0QnkpIHtcbiAgICAgIGNhc2UgJ2NyZWF0ZWRfYXQnOlxuICAgICAgICBjb21wYXJpc29uID0gbmV3IERhdGUoYS5jcmVhdGVkX2F0KS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiLmNyZWF0ZWRfYXQpLmdldFRpbWUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0b3RhbCc6XG4gICAgICBjb21wYXJpc29uID0gYS50b3RhbCAtIGIudG90YWw7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnb3JkZXJfbnVtYmVyJzpcbiAgICAgICAgY29tcGFyaXNvbiA9IGEub3JkZXJfbnVtYmVyLmxvY2FsZUNvbXBhcmUoYi5vcmRlcl9udW1iZXIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3N0YXR1cyc6XG4gICAgICAgIGNvbXBhcmlzb24gPSBhLnN0YXR1cy5sb2NhbGVDb21wYXJlKGIuc3RhdHVzKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBzb3J0T3JkZXIgPT09ICdhc2MnID8gY29tcGFyaXNvbiA6IC1jb21wYXJpc29uO1xuICB9KTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFVUSUxJREFERVMgREUgTk9USUZJQ0FDScOTTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBHZW5lcmEgbWVuc2FqZSBkZSBub3RpZmljYWNpw7NuIHBhcmEgY2FtYmlvIGRlIGVzdGFkb1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTdGF0dXNDaGFuZ2VNZXNzYWdlKFxuICBvcmRlck51bWJlcjogc3RyaW5nLFxuICBwcmV2aW91c1N0YXR1czogT3JkZXJTdGF0dXMsXG4gIG5ld1N0YXR1czogT3JkZXJTdGF0dXMsXG4gIHRyYWNraW5nTnVtYmVyPzogc3RyaW5nXG4pOiBzdHJpbmcge1xuICBjb25zdCBzdGF0dXNJbmZvID0gZm9ybWF0T3JkZXJTdGF0dXMobmV3U3RhdHVzKTtcbiAgXG4gIGxldCBtZXNzYWdlID0gYFR1IG9yZGVuICR7b3JkZXJOdW1iZXJ9IGhhIGNhbWJpYWRvIGE6ICR7c3RhdHVzSW5mby5sYWJlbH1gO1xuICBcbiAgaWYgKG5ld1N0YXR1cyA9PT0gJ3NoaXBwZWQnICYmIHRyYWNraW5nTnVtYmVyKSB7XG4gICAgbWVzc2FnZSArPSBgLiBOw7ptZXJvIGRlIHNlZ3VpbWllbnRvOiAke3RyYWNraW5nTnVtYmVyfWA7XG4gIH1cbiAgXG4gIHJldHVybiBtZXNzYWdlO1xufVxuXG4vKipcbiAqIERldGVybWluYSBzaSBzZSBkZWJlIGVudmlhciBub3RpZmljYWNpw7NuIGFsIGNsaWVudGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3VsZE5vdGlmeUN1c3RvbWVyKFxuICBwcmV2aW91c1N0YXR1czogT3JkZXJTdGF0dXMsXG4gIG5ld1N0YXR1czogT3JkZXJTdGF0dXNcbik6IGJvb2xlYW4ge1xuICAvLyBOb3RpZmljYXIgZW4gY2FtYmlvcyBpbXBvcnRhbnRlcyBwYXJhIGVsIGNsaWVudGVcbiAgY29uc3Qgbm90aWZpYWJsZVRyYW5zaXRpb25zID0gW1xuICAgICdjb25maXJtZWQnLFxuICAgICdzaGlwcGVkJyxcbiAgICAnZGVsaXZlcmVkJyxcbiAgICAnY2FuY2VsbGVkJ1xuICBdO1xuICBcbiAgcmV0dXJuIG5vdGlmaWFibGVUcmFuc2l0aW9ucy5pbmNsdWRlcyhuZXdTdGF0dXMpO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVkFMSURBQ0lPTkVTIERFIERBVE9TXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFZhbGlkYSBkYXRvcyBkZSBvcmRlbiBhbnRlcyBkZSBjcmVhci9hY3R1YWxpemFyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZU9yZGVyRGF0YShvcmRlckRhdGE6IFBhcnRpYWw8T3JkZXJFbnRlcnByaXNlPik6IHtcbiAgdmFsaWQ6IGJvb2xlYW47XG4gIGVycm9yczogc3RyaW5nW107XG59IHtcbiAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICBcbiAgaWYgKG9yZGVyRGF0YS50b3RhbCAhPT0gdW5kZWZpbmVkICYmIG9yZGVyRGF0YS50b3RhbCA8PSAwKSB7XG4gICAgZXJyb3JzLnB1c2goJ0VsIG1vbnRvIHRvdGFsIGRlYmUgc2VyIG1heW9yIGEgMCcpO1xuICB9XG4gIFxuICBpZiAob3JkZXJEYXRhLm9yZGVyX251bWJlciAmJiAhL15PUkQtXFxkKy1bQS1aMC05XSskLy50ZXN0KG9yZGVyRGF0YS5vcmRlcl9udW1iZXIpKSB7XG4gICAgZXJyb3JzLnB1c2goJ0Zvcm1hdG8gZGUgbsO6bWVybyBkZSBvcmRlbiBpbnbDoWxpZG8nKTtcbiAgfVxuICBcbiAgaWYgKG9yZGVyRGF0YS50cmFja2luZ19udW1iZXIgJiYgb3JkZXJEYXRhLnRyYWNraW5nX251bWJlci5sZW5ndGggPCAzKSB7XG4gICAgZXJyb3JzLnB1c2goJ07Dum1lcm8gZGUgc2VndWltaWVudG8gbXV5IGNvcnRvJyk7XG4gIH1cbiAgXG4gIHJldHVybiB7XG4gICAgdmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgZXJyb3JzXG4gIH07XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBFWFBPUlRBQ0nDk04gREUgREFUT1Ncbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogQ29udmllcnRlIMOzcmRlbmVzIGEgZm9ybWF0byBDU1ZcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG9yZGVyc1RvQ1NWKG9yZGVyczogT3JkZXJFbnRlcnByaXNlW10pOiBzdHJpbmcge1xuICBjb25zdCBoZWFkZXJzID0gW1xuICAgICdOw7ptZXJvIGRlIE9yZGVuJyxcbiAgICAnQ2xpZW50ZScsXG4gICAgJ0VtYWlsJyxcbiAgICAnRXN0YWRvJyxcbiAgICAnRXN0YWRvIGRlIFBhZ28nLFxuICAgICdUb3RhbCcsXG4gICAgJ0ZlY2hhIGRlIENyZWFjacOzbicsXG4gICAgJ8OabHRpbWEgQWN0dWFsaXphY2nDs24nXG4gIF07XG4gIFxuICBjb25zdCByb3dzID0gb3JkZXJzLm1hcChvcmRlciA9PiBbXG4gICAgb3JkZXIub3JkZXJfbnVtYmVyLFxuICAgIG9yZGVyLnVzZXJfcHJvZmlsZXM/Lm5hbWUgfHwgJycsXG4gICAgb3JkZXIudXNlcl9wcm9maWxlcz8uZW1haWwgfHwgJycsXG4gICAgZm9ybWF0T3JkZXJTdGF0dXMob3JkZXIuc3RhdHVzKS5sYWJlbCxcbiAgICBmb3JtYXRQYXltZW50U3RhdHVzKG9yZGVyLnBheW1lbnRfc3RhdHVzKS5sYWJlbCxcbiAgICBvcmRlci50b3RhbC50b1N0cmluZygpLFxuICAgIG5ldyBEYXRlKG9yZGVyLmNyZWF0ZWRfYXQpLnRvTG9jYWxlRGF0ZVN0cmluZygpLFxuICAgIG5ldyBEYXRlKG9yZGVyLnVwZGF0ZWRfYXQpLnRvTG9jYWxlRGF0ZVN0cmluZygpXG4gIF0pO1xuICBcbiAgcmV0dXJuIFtoZWFkZXJzLCAuLi5yb3dzXVxuICAgIC5tYXAocm93ID0+IHJvdy5tYXAoY2VsbCA9PiBgXCIke2NlbGx9XCJgKS5qb2luKCcsJykpXG4gICAgLmpvaW4oJ1xcbicpO1xufVxuIl0sIm5hbWVzIjpbImNhbGN1bGF0ZUF2ZXJhZ2VTdGF0ZVRpbWUiLCJjYWxjdWxhdGVPcmRlck1ldHJpY3MiLCJmaWx0ZXJPcmRlcnMiLCJmb3JtYXRPcmRlclN0YXR1cyIsImZvcm1hdFBheW1lbnRTdGF0dXMiLCJnZW5lcmF0ZVN0YXR1c0NoYW5nZU1lc3NhZ2UiLCJnZXRBdmFpbGFibGVUcmFuc2l0aW9ucyIsIm9yZGVyc1RvQ1NWIiwic2hvdWxkTm90aWZ5Q3VzdG9tZXIiLCJzb3J0T3JkZXJzIiwic3RhdHVzUmVxdWlyZXNBZGRpdGlvbmFsSW5mbyIsInZhbGlkYXRlT3JkZXJEYXRhIiwidmFsaWRhdGVTdGF0ZVRyYW5zaXRpb24iLCJjdXJyZW50U3RhdHVzIiwibmV3U3RhdHVzIiwidmFsaWQiLCJtZXNzYWdlIiwiYWxsb3dlZFRyYW5zaXRpb25zIiwiT1JERVJfU1RBVEVfVFJBTlNJVElPTlMiLCJpbmNsdWRlcyIsIk9SREVSX1NUQVRVU19ERVNDUklQVElPTlMiLCJ0cmFuc2l0aW9ucyIsIm1hcCIsInN0YXR1cyIsImRlc2NyaXB0aW9uIiwicmVxdWlyZXNSZWFzb24iLCJyZXF1aXJlc1RyYWNraW5nIiwicmVxdWlyZXNDYXJyaWVyIiwicmVxdWlyZXNFc3RpbWF0ZWREZWxpdmVyeSIsInN0YXR1c01hcCIsInBlbmRpbmciLCJsYWJlbCIsImNvbG9yIiwiaWNvbiIsImNvbmZpcm1lZCIsInByb2Nlc3NpbmciLCJzaGlwcGVkIiwiZGVsaXZlcmVkIiwiY2FuY2VsbGVkIiwicmVmdW5kZWQiLCJyZXR1cm5lZCIsInBhaWQiLCJmYWlsZWQiLCJzdGF0dXNIaXN0b3J5Iiwic3RhdGVUaW1lcyIsImkiLCJsZW5ndGgiLCJjdXJyZW50IiwibmV4dCIsInRpbWVJblN0YXRlIiwiRGF0ZSIsImNyZWF0ZWRfYXQiLCJnZXRUaW1lIiwic3RhdGVLZXkiLCJuZXdfc3RhdHVzIiwicHVzaCIsImF2ZXJhZ2VzIiwia2V5IiwidGltZXMiLCJPYmplY3QiLCJlbnRyaWVzIiwicmVkdWNlIiwic3VtIiwidGltZSIsIm9yZGVyIiwidG90YWxJdGVtcyIsIm9yZGVyX2l0ZW1zIiwiaXRlbSIsInF1YW50aXR5IiwiYXZlcmFnZUl0ZW1QcmljZSIsInRvdGFsIiwicHJvY2Vzc2luZ1RpbWUiLCJkZWxpdmVyeVRpbWUiLCJzdGF0dXNfaGlzdG9yeSIsImNvbmZpcm1lZFRpbWUiLCJmaW5kIiwiaCIsInNoaXBwZWRUaW1lIiwiZGVsaXZlcmVkVGltZSIsIm9yZGVycyIsImZpbHRlcnMiLCJmaWx0ZXIiLCJwYXltZW50U3RhdHVzIiwicGF5bWVudF9zdGF0dXMiLCJkYXRlRnJvbSIsImRhdGVUbyIsIm1pbkFtb3VudCIsIm1heEFtb3VudCIsInNlYXJjaCIsInNlYXJjaExvd2VyIiwidG9Mb3dlckNhc2UiLCJzZWFyY2hhYmxlVGV4dCIsIm9yZGVyX251bWJlciIsInVzZXJfcHJvZmlsZXMiLCJuYW1lIiwiZW1haWwiLCJub3RlcyIsImFkbWluX25vdGVzIiwiQm9vbGVhbiIsImpvaW4iLCJzb3J0QnkiLCJzb3J0T3JkZXIiLCJzb3J0IiwiYSIsImIiLCJjb21wYXJpc29uIiwibG9jYWxlQ29tcGFyZSIsIm9yZGVyTnVtYmVyIiwicHJldmlvdXNTdGF0dXMiLCJ0cmFja2luZ051bWJlciIsInN0YXR1c0luZm8iLCJub3RpZmlhYmxlVHJhbnNpdGlvbnMiLCJvcmRlckRhdGEiLCJlcnJvcnMiLCJ1bmRlZmluZWQiLCJ0ZXN0IiwidHJhY2tpbmdfbnVtYmVyIiwiaGVhZGVycyIsInJvd3MiLCJ0b1N0cmluZyIsInRvTG9jYWxlRGF0ZVN0cmluZyIsInVwZGF0ZWRfYXQiLCJyb3ciLCJjZWxsIl0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMsbURBQW1EO0FBQ25ELHNDQUFzQzs7Ozs7Ozs7Ozs7O1FBNkx0QkE7ZUFBQUE7O1FBNkJBQztlQUFBQTs7UUF5Q0FDO2VBQUFBOztRQTNLQUM7ZUFBQUE7O1FBK0RBQztlQUFBQTs7UUFnTkFDO2VBQUFBOztRQXJUQUM7ZUFBQUE7O1FBOFhBQztlQUFBQTs7UUFyREFDO2VB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