a52136253eb25739ed0105f1ee135fe5
// ===================================
// PINTEYA E-COMMERCE - API DE PRODUCTOS
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get GET () {
        return GET;
    },
    get POST () {
        return POST;
    }
});
const _server = require("next/server");
const _supabase = require("../../../lib/supabase");
const _validations = require("../../../lib/validations");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
async function GET(request) {
    try {
        const { searchParams } = new URL(request.url);
        // Extraer parámetros de query
        const queryParams = {
            category: searchParams.get('category') || undefined,
            categories: searchParams.get('categories')?.split(',').filter(Boolean) || undefined,
            brand: searchParams.get('brand') || undefined,
            brands: searchParams.get('brands')?.split(',').filter(Boolean) || undefined,
            paintType: searchParams.get('paintType') || undefined,
            paintTypes: searchParams.get('paintTypes')?.split(',').filter(Boolean) || undefined,
            priceMin: searchParams.get('priceMin') ? Number(searchParams.get('priceMin')) : undefined,
            priceMax: searchParams.get('priceMax') ? Number(searchParams.get('priceMax')) : undefined,
            search: searchParams.get('search') || undefined,
            page: searchParams.get('page') ? Number(searchParams.get('page')) : 1,
            limit: searchParams.get('limit') ? Number(searchParams.get('limit')) : 12,
            sortBy: searchParams.get('sortBy') || 'created_at',
            sortOrder: searchParams.get('sortOrder') || 'desc'
        };
        // Validar parámetros de manera segura
        const validationResult = (0, _validations.safeValidateData)(_validations.ProductFiltersSchema, queryParams);
        if (!validationResult.success) {
            console.error('Error de validación en GET /api/products:', validationResult.error);
            const errorResponse = {
                data: null,
                success: false,
                error: `Parámetros inválidos: ${validationResult.error}`
            };
            return _server.NextResponse.json(errorResponse, {
                status: 400
            });
        }
        const filters = validationResult.data;
        const supabase = (0, _supabase.getSupabaseClient)();
        // Verificar que el cliente de Supabase esté disponible
        if (!supabase) {
            console.error('Cliente de Supabase no disponible en GET /api/products');
            const errorResponse = {
                data: null,
                success: false,
                error: 'Servicio de base de datos no disponible'
            };
            return _server.NextResponse.json(errorResponse, {
                status: 503
            });
        }
        // Construir query base optimizada (solo campos necesarios)
        let query = supabase.from('products').select(`
        id, name, slug, price, discounted_price, brand, stock, images,
        category:categories(id, name, slug)
      `, {
            count: 'exact'
        });
        // Aplicar filtros
        if (filters.category) {
            // Primero obtener el ID de la categoría por su slug
            const { data: categoryData } = await supabase.from('categories').select('id').eq('slug', filters.category).single();
            if (categoryData) {
                query = query.eq('category_id', categoryData.id);
            }
        }
        // Filtro por múltiples categorías (nuevo)
        if (filters.categories && filters.categories.length > 0) {
            const { data: categoriesData } = await supabase.from('categories').select('id').in('slug', filters.categories);
            if (categoriesData && categoriesData.length > 0) {
                const categoryIds = categoriesData.map((cat)=>cat.id);
                query = query.in('category_id', categoryIds);
            }
        }
        if (filters.brand) {
            query = query.eq('brand', filters.brand);
        }
        // Filtro por múltiples marcas (nuevo)
        if (filters.brands && filters.brands.length > 0) {
            query = query.in('brand', filters.brands);
        }
        // Filtro por tipo de pintura (nuevo)
        if (filters.paintType) {
            query = query.eq('paint_type', filters.paintType);
        }
        // Filtro por múltiples tipos de pintura (nuevo)
        if (filters.paintTypes && filters.paintTypes.length > 0) {
            query = query.in('paint_type', filters.paintTypes);
        }
        if (filters.priceMin) {
            query = query.gte('price', filters.priceMin);
        }
        if (filters.priceMax) {
            query = query.lte('price', filters.priceMax);
        }
        if (filters.search) {
            query = query.or(`name.ilike.%${filters.search}%,description.ilike.%${filters.search}%,brand.ilike.%${filters.search}%`);
        }
        // Solo productos con stock (temporalmente comentado para testing)
        // query = query.gt('stock', 0);
        // Ordenamiento
        const orderColumn = filters.sortBy === 'created_at' ? 'created_at' : filters.sortBy === 'brand' ? 'brand' : filters.sortBy || 'created_at';
        query = query.order(orderColumn, {
            ascending: filters.sortOrder === 'asc'
        });
        // Paginación
        const page = filters.page || 1;
        const limit = filters.limit || 10;
        const from = (page - 1) * limit;
        const to = from + limit - 1;
        query = query.range(from, to);
        // Ejecutar query
        const { data: products, error, count } = await query;
        if (error) {
            console.error('Error en GET /api/products - Supabase:', error);
            const errorResponse = {
                data: null,
                success: false,
                error: error.message || 'Error obteniendo productos de la base de datos'
            };
            return _server.NextResponse.json(errorResponse, {
                status: 500
            });
        }
        // Calcular información de paginación
        const totalPages = Math.ceil((count || 0) / limit);
        const response = {
            data: products || [],
            pagination: {
                page,
                limit,
                total: count || 0,
                totalPages
            },
            success: true,
            message: `${products?.length || 0} productos encontrados`
        };
        // Agregar headers de cache para mejorar performance
        return _server.NextResponse.json(response, {
            headers: {
                'Cache-Control': 'public, s-maxage=60, stale-while-revalidate=300',
                'Content-Type': 'application/json'
            }
        });
    } catch (error) {
        console.error('Error en GET /api/products:', error);
        const errorResponse = {
            data: null,
            success: false,
            error: error.message || 'Error interno del servidor'
        };
        return _server.NextResponse.json(errorResponse, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        // ENTERPRISE: Usar nueva autenticación enterprise para admin
        const { requireAdminAuth } = await Promise.resolve().then(()=>/*#__PURE__*/ _interop_require_wildcard(require("../../../lib/auth/enterprise-auth-utils")));
        const authResult = await requireAdminAuth(request, [
            'products_create'
        ]);
        if (!authResult.success) {
            return _server.NextResponse.json({
                error: authResult.error,
                code: authResult.code,
                enterprise: true,
                timestamp: new Date().toISOString()
            }, {
                status: authResult.status || 401
            });
        }
        const context = authResult.context;
        const body = await request.json();
        // Validar datos del producto
        const productData = (0, _validations.validateData)(_validations.ProductSchema, body);
        const supabase = (0, _supabase.getSupabaseClient)(true); // Usar cliente admin
        // Verificar que el cliente administrativo esté disponible
        if (!supabase) {
            console.error('Cliente administrativo de Supabase no disponible en POST /api/products');
            const errorResponse = {
                data: null,
                success: false,
                error: 'Servicio administrativo no disponible'
            };
            return _server.NextResponse.json(errorResponse, {
                status: 503
            });
        }
        // Crear slug si no se proporciona
        if (!productData.slug) {
            productData.slug = productData.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
        }
        // Insertar producto
        const { data: product, error } = await supabase.from('products').insert(productData).select(`
        *,
        category:categories(id, name, slug)
      `).single();
        if (error) {
            (0, _supabase.handleSupabaseError)(error, 'POST /api/products');
        }
        const response = {
            data: product,
            success: true,
            message: 'Producto creado exitosamente'
        };
        return _server.NextResponse.json(response, {
            status: 201
        });
    } catch (error) {
        console.error('Error en POST /api/products:', error);
        const errorResponse = {
            data: null,
            success: false,
            error: error.message || 'Error interno del servidor'
        };
        return _server.NextResponse.json(errorResponse, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXHByb2R1Y3RzXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQSU5URVlBIEUtQ09NTUVSQ0UgLSBBUEkgREUgUFJPRFVDVE9TXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBnZXRTdXBhYmFzZUNsaWVudCwgaGFuZGxlU3VwYWJhc2VFcnJvciB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcclxuaW1wb3J0IHsgdmFsaWRhdGVEYXRhLCBzYWZlVmFsaWRhdGVEYXRhLCBQcm9kdWN0RmlsdGVyc1NjaGVtYSwgUHJvZHVjdFNjaGVtYSB9IGZyb20gJ0AvbGliL3ZhbGlkYXRpb25zJztcclxuaW1wb3J0IHsgQXBpUmVzcG9uc2UsIFBhZ2luYXRlZFJlc3BvbnNlLCBQcm9kdWN0V2l0aENhdGVnb3J5IH0gZnJvbSAnQC90eXBlcy9hcGknO1xyXG5pbXBvcnQge1xyXG4gIGV4ZWN1dGVXaXRoUkxTLFxyXG4gIHdpdGhSTFMsXHJcbiAgY3JlYXRlUkxTRmlsdGVyc1xyXG59IGZyb20gJ0AvbGliL2F1dGgvZW50ZXJwcmlzZS1ybHMtdXRpbHMnO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gR0VUIC9hcGkvcHJvZHVjdHMgLSBPYnRlbmVyIHByb2R1Y3RvcyBjb24gZmlsdHJvc1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcclxuICAgIFxyXG4gICAgLy8gRXh0cmFlciBwYXLDoW1ldHJvcyBkZSBxdWVyeVxyXG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSB7XHJcbiAgICAgIGNhdGVnb3J5OiBzZWFyY2hQYXJhbXMuZ2V0KCdjYXRlZ29yeScpIHx8IHVuZGVmaW5lZCxcclxuICAgICAgY2F0ZWdvcmllczogc2VhcmNoUGFyYW1zLmdldCgnY2F0ZWdvcmllcycpPy5zcGxpdCgnLCcpLmZpbHRlcihCb29sZWFuKSB8fCB1bmRlZmluZWQsXHJcbiAgICAgIGJyYW5kOiBzZWFyY2hQYXJhbXMuZ2V0KCdicmFuZCcpIHx8IHVuZGVmaW5lZCxcclxuICAgICAgYnJhbmRzOiBzZWFyY2hQYXJhbXMuZ2V0KCdicmFuZHMnKT8uc3BsaXQoJywnKS5maWx0ZXIoQm9vbGVhbikgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBwYWludFR5cGU6IHNlYXJjaFBhcmFtcy5nZXQoJ3BhaW50VHlwZScpIHx8IHVuZGVmaW5lZCxcclxuICAgICAgcGFpbnRUeXBlczogc2VhcmNoUGFyYW1zLmdldCgncGFpbnRUeXBlcycpPy5zcGxpdCgnLCcpLmZpbHRlcihCb29sZWFuKSB8fCB1bmRlZmluZWQsXHJcbiAgICAgIHByaWNlTWluOiBzZWFyY2hQYXJhbXMuZ2V0KCdwcmljZU1pbicpID8gTnVtYmVyKHNlYXJjaFBhcmFtcy5nZXQoJ3ByaWNlTWluJykpIDogdW5kZWZpbmVkLFxyXG4gICAgICBwcmljZU1heDogc2VhcmNoUGFyYW1zLmdldCgncHJpY2VNYXgnKSA/IE51bWJlcihzZWFyY2hQYXJhbXMuZ2V0KCdwcmljZU1heCcpKSA6IHVuZGVmaW5lZCxcclxuICAgICAgc2VhcmNoOiBzZWFyY2hQYXJhbXMuZ2V0KCdzZWFyY2gnKSB8fCB1bmRlZmluZWQsXHJcbiAgICAgIHBhZ2U6IHNlYXJjaFBhcmFtcy5nZXQoJ3BhZ2UnKSA/IE51bWJlcihzZWFyY2hQYXJhbXMuZ2V0KCdwYWdlJykpIDogMSxcclxuICAgICAgbGltaXQ6IHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgPyBOdW1iZXIoc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKSkgOiAxMixcclxuICAgICAgc29ydEJ5OiBzZWFyY2hQYXJhbXMuZ2V0KCdzb3J0QnknKSBhcyAncHJpY2UnIHwgJ25hbWUnIHwgJ2NyZWF0ZWRfYXQnIHwgJ2JyYW5kJyB8fCAnY3JlYXRlZF9hdCcsXHJcbiAgICAgIHNvcnRPcmRlcjogc2VhcmNoUGFyYW1zLmdldCgnc29ydE9yZGVyJykgYXMgJ2FzYycgfCAnZGVzYycgfHwgJ2Rlc2MnLFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBWYWxpZGFyIHBhcsOhbWV0cm9zIGRlIG1hbmVyYSBzZWd1cmFcclxuICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSBzYWZlVmFsaWRhdGVEYXRhKFByb2R1Y3RGaWx0ZXJzU2NoZW1hLCBxdWVyeVBhcmFtcyk7XHJcblxyXG4gICAgaWYgKCF2YWxpZGF0aW9uUmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGUgdmFsaWRhY2nDs24gZW4gR0VUIC9hcGkvcHJvZHVjdHM6JywgdmFsaWRhdGlvblJlc3VsdC5lcnJvcik7XHJcbiAgICAgIGNvbnN0IGVycm9yUmVzcG9uc2U6IEFwaVJlc3BvbnNlPG51bGw+ID0ge1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGBQYXLDoW1ldHJvcyBpbnbDoWxpZG9zOiAke3ZhbGlkYXRpb25SZXN1bHQuZXJyb3J9YCxcclxuICAgICAgfTtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGVycm9yUmVzcG9uc2UsIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZmlsdGVycyA9IHZhbGlkYXRpb25SZXN1bHQuZGF0YSE7XHJcbiAgICBcclxuICAgIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2VDbGllbnQoKTtcclxuXHJcbiAgICAvLyBWZXJpZmljYXIgcXVlIGVsIGNsaWVudGUgZGUgU3VwYWJhc2UgZXN0w6kgZGlzcG9uaWJsZVxyXG4gICAgaWYgKCFzdXBhYmFzZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdDbGllbnRlIGRlIFN1cGFiYXNlIG5vIGRpc3BvbmlibGUgZW4gR0VUIC9hcGkvcHJvZHVjdHMnKTtcclxuICAgICAgY29uc3QgZXJyb3JSZXNwb25zZTogQXBpUmVzcG9uc2U8bnVsbD4gPSB7XHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ1NlcnZpY2lvIGRlIGJhc2UgZGUgZGF0b3Mgbm8gZGlzcG9uaWJsZScsXHJcbiAgICAgIH07XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihlcnJvclJlc3BvbnNlLCB7IHN0YXR1czogNTAzIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENvbnN0cnVpciBxdWVyeSBiYXNlIG9wdGltaXphZGEgKHNvbG8gY2FtcG9zIG5lY2VzYXJpb3MpXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZHVjdHMnKVxyXG4gICAgICAuc2VsZWN0KGBcclxuICAgICAgICBpZCwgbmFtZSwgc2x1ZywgcHJpY2UsIGRpc2NvdW50ZWRfcHJpY2UsIGJyYW5kLCBzdG9jaywgaW1hZ2VzLFxyXG4gICAgICAgIGNhdGVnb3J5OmNhdGVnb3JpZXMoaWQsIG5hbWUsIHNsdWcpXHJcbiAgICAgIGAsIHsgY291bnQ6ICdleGFjdCcgfSk7XHJcblxyXG4gICAgLy8gQXBsaWNhciBmaWx0cm9zXHJcbiAgICBpZiAoZmlsdGVycy5jYXRlZ29yeSkge1xyXG4gICAgICAvLyBQcmltZXJvIG9idGVuZXIgZWwgSUQgZGUgbGEgY2F0ZWdvcsOtYSBwb3Igc3Ugc2x1Z1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGNhdGVnb3J5RGF0YSB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnY2F0ZWdvcmllcycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAgIC5lcSgnc2x1ZycsIGZpbHRlcnMuY2F0ZWdvcnkpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgaWYgKGNhdGVnb3J5RGF0YSkge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2NhdGVnb3J5X2lkJywgY2F0ZWdvcnlEYXRhLmlkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEZpbHRybyBwb3IgbcO6bHRpcGxlcyBjYXRlZ29yw61hcyAobnVldm8pXHJcbiAgICBpZiAoZmlsdGVycy5jYXRlZ29yaWVzICYmIGZpbHRlcnMuY2F0ZWdvcmllcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogY2F0ZWdvcmllc0RhdGEgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2NhdGVnb3JpZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAuaW4oJ3NsdWcnLCBmaWx0ZXJzLmNhdGVnb3JpZXMpO1xyXG5cclxuICAgICAgaWYgKGNhdGVnb3JpZXNEYXRhICYmIGNhdGVnb3JpZXNEYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBjYXRlZ29yeUlkcyA9IGNhdGVnb3JpZXNEYXRhLm1hcChjYXQgPT4gY2F0LmlkKTtcclxuICAgICAgICBxdWVyeSA9IHF1ZXJ5LmluKCdjYXRlZ29yeV9pZCcsIGNhdGVnb3J5SWRzKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLmJyYW5kKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ2JyYW5kJywgZmlsdGVycy5icmFuZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRmlsdHJvIHBvciBtw7psdGlwbGVzIG1hcmNhcyAobnVldm8pXHJcbiAgICBpZiAoZmlsdGVycy5icmFuZHMgJiYgZmlsdGVycy5icmFuZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmluKCdicmFuZCcsIGZpbHRlcnMuYnJhbmRzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGaWx0cm8gcG9yIHRpcG8gZGUgcGludHVyYSAobnVldm8pXHJcbiAgICBpZiAoZmlsdGVycy5wYWludFR5cGUpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgncGFpbnRfdHlwZScsIGZpbHRlcnMucGFpbnRUeXBlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGaWx0cm8gcG9yIG3Dumx0aXBsZXMgdGlwb3MgZGUgcGludHVyYSAobnVldm8pXHJcbiAgICBpZiAoZmlsdGVycy5wYWludFR5cGVzICYmIGZpbHRlcnMucGFpbnRUeXBlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3BhaW50X3R5cGUnLCBmaWx0ZXJzLnBhaW50VHlwZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLnByaWNlTWluKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZ3RlKCdwcmljZScsIGZpbHRlcnMucHJpY2VNaW4pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLnByaWNlTWF4KSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkubHRlKCdwcmljZScsIGZpbHRlcnMucHJpY2VNYXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLnNlYXJjaCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBuYW1lLmlsaWtlLiUke2ZpbHRlcnMuc2VhcmNofSUsZGVzY3JpcHRpb24uaWxpa2UuJSR7ZmlsdGVycy5zZWFyY2h9JSxicmFuZC5pbGlrZS4lJHtmaWx0ZXJzLnNlYXJjaH0lYCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU29sbyBwcm9kdWN0b3MgY29uIHN0b2NrICh0ZW1wb3JhbG1lbnRlIGNvbWVudGFkbyBwYXJhIHRlc3RpbmcpXHJcbiAgICAvLyBxdWVyeSA9IHF1ZXJ5Lmd0KCdzdG9jaycsIDApO1xyXG5cclxuICAgIC8vIE9yZGVuYW1pZW50b1xyXG4gICAgY29uc3Qgb3JkZXJDb2x1bW4gPSBmaWx0ZXJzLnNvcnRCeSA9PT0gJ2NyZWF0ZWRfYXQnID8gJ2NyZWF0ZWRfYXQnIDpcclxuICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzLnNvcnRCeSA9PT0gJ2JyYW5kJyA/ICdicmFuZCcgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgIChmaWx0ZXJzLnNvcnRCeSB8fCAnY3JlYXRlZF9hdCcpO1xyXG4gICAgcXVlcnkgPSBxdWVyeS5vcmRlcihvcmRlckNvbHVtbiwgeyBhc2NlbmRpbmc6IGZpbHRlcnMuc29ydE9yZGVyID09PSAnYXNjJyB9KTtcclxuXHJcbiAgICAvLyBQYWdpbmFjacOzblxyXG4gICAgY29uc3QgcGFnZSA9IGZpbHRlcnMucGFnZSB8fCAxO1xyXG4gICAgY29uc3QgbGltaXQgPSBmaWx0ZXJzLmxpbWl0IHx8IDEwO1xyXG4gICAgY29uc3QgZnJvbSA9IChwYWdlIC0gMSkgKiBsaW1pdDtcclxuICAgIGNvbnN0IHRvID0gZnJvbSArIGxpbWl0IC0gMTtcclxuICAgIHF1ZXJ5ID0gcXVlcnkucmFuZ2UoZnJvbSwgdG8pO1xyXG5cclxuICAgIC8vIEVqZWN1dGFyIHF1ZXJ5XHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2R1Y3RzLCBlcnJvciwgY291bnQgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlbiBHRVQgL2FwaS9wcm9kdWN0cyAtIFN1cGFiYXNlOicsIGVycm9yKTtcclxuICAgICAgY29uc3QgZXJyb3JSZXNwb25zZTogQXBpUmVzcG9uc2U8bnVsbD4gPSB7XHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3Igb2J0ZW5pZW5kbyBwcm9kdWN0b3MgZGUgbGEgYmFzZSBkZSBkYXRvcycsXHJcbiAgICAgIH07XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihlcnJvclJlc3BvbnNlLCB7IHN0YXR1czogNTAwIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhbGN1bGFyIGluZm9ybWFjacOzbiBkZSBwYWdpbmFjacOzblxyXG4gICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCgoY291bnQgfHwgMCkgLyBsaW1pdCk7XHJcblxyXG4gICAgY29uc3QgcmVzcG9uc2U6IFBhZ2luYXRlZFJlc3BvbnNlPFByb2R1Y3RXaXRoQ2F0ZWdvcnk+ID0ge1xyXG4gICAgICBkYXRhOiBwcm9kdWN0cyB8fCBbXSxcclxuICAgICAgcGFnaW5hdGlvbjoge1xyXG4gICAgICAgIHBhZ2UsXHJcbiAgICAgICAgbGltaXQsXHJcbiAgICAgICAgdG90YWw6IGNvdW50IHx8IDAsXHJcbiAgICAgICAgdG90YWxQYWdlcyxcclxuICAgICAgfSxcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogYCR7cHJvZHVjdHM/Lmxlbmd0aCB8fCAwfSBwcm9kdWN0b3MgZW5jb250cmFkb3NgLFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBBZ3JlZ2FyIGhlYWRlcnMgZGUgY2FjaGUgcGFyYSBtZWpvcmFyIHBlcmZvcm1hbmNlXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzcG9uc2UsIHtcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICdDYWNoZS1Db250cm9sJzogJ3B1YmxpYywgcy1tYXhhZ2U9NjAsIHN0YWxlLXdoaWxlLXJldmFsaWRhdGU9MzAwJyxcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlbiBHRVQgL2FwaS9wcm9kdWN0czonLCBlcnJvcik7XHJcbiAgICBcclxuICAgIGNvbnN0IGVycm9yUmVzcG9uc2U6IEFwaVJlc3BvbnNlPG51bGw+ID0ge1xyXG4gICAgICBkYXRhOiBudWxsLFxyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGVycm9yUmVzcG9uc2UsIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQT1NUIC9hcGkvcHJvZHVjdHMgLSBDcmVhciBwcm9kdWN0byAoQWRtaW4pXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIEVOVEVSUFJJU0U6IFVzYXIgbnVldmEgYXV0ZW50aWNhY2nDs24gZW50ZXJwcmlzZSBwYXJhIGFkbWluXHJcbiAgICBjb25zdCB7IHJlcXVpcmVBZG1pbkF1dGggfSA9IGF3YWl0IGltcG9ydCgnQC9saWIvYXV0aC9lbnRlcnByaXNlLWF1dGgtdXRpbHMnKTtcclxuXHJcbiAgICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgcmVxdWlyZUFkbWluQXV0aChyZXF1ZXN0LCBbJ3Byb2R1Y3RzX2NyZWF0ZSddKTtcclxuXHJcbiAgICBpZiAoIWF1dGhSZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZXJyb3I6IGF1dGhSZXN1bHQuZXJyb3IsXHJcbiAgICAgICAgICBjb2RlOiBhdXRoUmVzdWx0LmNvZGUsXHJcbiAgICAgICAgICBlbnRlcnByaXNlOiB0cnVlLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiBhdXRoUmVzdWx0LnN0YXR1cyB8fCA0MDEgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNvbnRleHQgPSBhdXRoUmVzdWx0LmNvbnRleHQhO1xyXG5cclxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcclxuICAgIFxyXG4gICAgLy8gVmFsaWRhciBkYXRvcyBkZWwgcHJvZHVjdG9cclxuICAgIGNvbnN0IHByb2R1Y3REYXRhID0gdmFsaWRhdGVEYXRhKFByb2R1Y3RTY2hlbWEsIGJvZHkpO1xyXG4gICAgXHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlQ2xpZW50KHRydWUpOyAvLyBVc2FyIGNsaWVudGUgYWRtaW5cclxuXHJcbiAgICAvLyBWZXJpZmljYXIgcXVlIGVsIGNsaWVudGUgYWRtaW5pc3RyYXRpdm8gZXN0w6kgZGlzcG9uaWJsZVxyXG4gICAgaWYgKCFzdXBhYmFzZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdDbGllbnRlIGFkbWluaXN0cmF0aXZvIGRlIFN1cGFiYXNlIG5vIGRpc3BvbmlibGUgZW4gUE9TVCAvYXBpL3Byb2R1Y3RzJyk7XHJcbiAgICAgIGNvbnN0IGVycm9yUmVzcG9uc2U6IEFwaVJlc3BvbnNlPG51bGw+ID0ge1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdTZXJ2aWNpbyBhZG1pbmlzdHJhdGl2byBubyBkaXNwb25pYmxlJyxcclxuICAgICAgfTtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGVycm9yUmVzcG9uc2UsIHsgc3RhdHVzOiA1MDMgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXIgc2x1ZyBzaSBubyBzZSBwcm9wb3JjaW9uYVxyXG4gICAgaWYgKCFwcm9kdWN0RGF0YS5zbHVnKSB7XHJcbiAgICAgIHByb2R1Y3REYXRhLnNsdWcgPSBwcm9kdWN0RGF0YS5uYW1lXHJcbiAgICAgICAgLnRvTG93ZXJDYXNlKClcclxuICAgICAgICAucmVwbGFjZSgvW15hLXowLTldKy9nLCAnLScpXHJcbiAgICAgICAgLnJlcGxhY2UoLyheLXwtJCkvZywgJycpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEluc2VydGFyIHByb2R1Y3RvXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2R1Y3QsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZHVjdHMnKVxyXG4gICAgICAuaW5zZXJ0KHByb2R1Y3REYXRhKVxyXG4gICAgICAuc2VsZWN0KGBcclxuICAgICAgICAqLFxyXG4gICAgICAgIGNhdGVnb3J5OmNhdGVnb3JpZXMoaWQsIG5hbWUsIHNsdWcpXHJcbiAgICAgIGApXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgaGFuZGxlU3VwYWJhc2VFcnJvcihlcnJvciwgJ1BPU1QgL2FwaS9wcm9kdWN0cycpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlc3BvbnNlOiBBcGlSZXNwb25zZTxQcm9kdWN0V2l0aENhdGVnb3J5PiA9IHtcclxuICAgICAgZGF0YTogcHJvZHVjdCxcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogJ1Byb2R1Y3RvIGNyZWFkbyBleGl0b3NhbWVudGUnLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzcG9uc2UsIHsgc3RhdHVzOiAyMDEgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIFBPU1QgL2FwaS9wcm9kdWN0czonLCBlcnJvcik7XHJcbiAgICBcclxuICAgIGNvbnN0IGVycm9yUmVzcG9uc2U6IEFwaVJlc3BvbnNlPG51bGw+ID0ge1xyXG4gICAgICBkYXRhOiBudWxsLFxyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGVycm9yUmVzcG9uc2UsIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJHRVQiLCJQT1NUIiwicmVxdWVzdCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInF1ZXJ5UGFyYW1zIiwiY2F0ZWdvcnkiLCJnZXQiLCJ1bmRlZmluZWQiLCJjYXRlZ29yaWVzIiwic3BsaXQiLCJmaWx0ZXIiLCJCb29sZWFuIiwiYnJhbmQiLCJicmFuZHMiLCJwYWludFR5cGUiLCJwYWludFR5cGVzIiwicHJpY2VNaW4iLCJOdW1iZXIiLCJwcmljZU1heCIsInNlYXJjaCIsInBhZ2UiLCJsaW1pdCIsInNvcnRCeSIsInNvcnRPcmRlciIsInZhbGlkYXRpb25SZXN1bHQiLCJzYWZlVmFsaWRhdGVEYXRhIiwiUHJvZHVjdEZpbHRlcnNTY2hlbWEiLCJzdWNjZXNzIiwiY29uc29sZSIsImVycm9yIiwiZXJyb3JSZXNwb25zZSIsImRhdGEiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwic3RhdHVzIiwiZmlsdGVycyIsInN1cGFiYXNlIiwiZ2V0U3VwYWJhc2VDbGllbnQiLCJxdWVyeSIsImZyb20iLCJzZWxlY3QiLCJjb3VudCIsImNhdGVnb3J5RGF0YSIsImVxIiwic2luZ2xlIiwiaWQiLCJsZW5ndGgiLCJjYXRlZ29yaWVzRGF0YSIsImluIiwiY2F0ZWdvcnlJZHMiLCJtYXAiLCJjYXQiLCJndGUiLCJsdGUiLCJvciIsIm9yZGVyQ29sdW1uIiwib3JkZXIiLCJhc2NlbmRpbmciLCJ0byIsInJhbmdlIiwicHJvZHVjdHMiLCJtZXNzYWdlIiwidG90YWxQYWdlcyIsIk1hdGgiLCJjZWlsIiwicmVzcG9uc2UiLCJwYWdpbmF0aW9uIiwidG90YWwiLCJoZWFkZXJzIiwicmVxdWlyZUFkbWluQXV0aCIsImF1dGhSZXN1bHQiLCJjb2RlIiwiZW50ZXJwcmlzZSIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImNvbnRleHQiLCJib2R5IiwicHJvZHVjdERhdGEiLCJ2YWxpZGF0ZURhdGEiLCJQcm9kdWN0U2NoZW1hIiwic2x1ZyIsIm5hbWUiLCJ0b0xvd2VyQ2FzZSIsInJlcGxhY2UiLCJwcm9kdWN0IiwiaW5zZXJ0IiwiaGFuZGxlU3VwYWJhc2VFcnJvciJdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBQ3RDLHdDQUF3QztBQUN4QyxzQ0FBc0M7Ozs7Ozs7Ozs7OztRQWVoQkE7ZUFBQUE7O1FBdUxBQztlQUFBQTs7O3dCQXBNb0I7MEJBQ2E7NkJBQzZCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFXN0UsZUFBZUQsSUFBSUUsT0FBb0I7SUFDNUMsSUFBSTtRQUNGLE1BQU0sRUFBRUMsWUFBWSxFQUFFLEdBQUcsSUFBSUMsSUFBSUYsUUFBUUcsR0FBRztRQUU1Qyw4QkFBOEI7UUFDOUIsTUFBTUMsY0FBYztZQUNsQkMsVUFBVUosYUFBYUssR0FBRyxDQUFDLGVBQWVDO1lBQzFDQyxZQUFZUCxhQUFhSyxHQUFHLENBQUMsZUFBZUcsTUFBTSxLQUFLQyxPQUFPQyxZQUFZSjtZQUMxRUssT0FBT1gsYUFBYUssR0FBRyxDQUFDLFlBQVlDO1lBQ3BDTSxRQUFRWixhQUFhSyxHQUFHLENBQUMsV0FBV0csTUFBTSxLQUFLQyxPQUFPQyxZQUFZSjtZQUNsRU8sV0FBV2IsYUFBYUssR0FBRyxDQUFDLGdCQUFnQkM7WUFDNUNRLFlBQVlkLGFBQWFLLEdBQUcsQ0FBQyxlQUFlRyxNQUFNLEtBQUtDLE9B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