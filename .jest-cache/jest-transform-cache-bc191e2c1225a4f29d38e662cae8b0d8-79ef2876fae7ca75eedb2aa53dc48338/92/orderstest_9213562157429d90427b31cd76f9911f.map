{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\api\\admin\\orders.test.js"],"sourcesContent":["// ===================================\n// PINTEYA E-COMMERCE - ORDERS API TESTS\n// ===================================\n\nimport { GET, POST } from '@/app/api/admin/orders/route';\nimport { \n  createMockSupabaseAdmin,\n  createMockClerkAuth,\n  createMockRateLimiter,\n  createMockLogger,\n  createMockMetricsCollector,\n  mockOrders,\n  mockOrderItems,\n  resetAllMocks\n} from '../../setup/orders-mocks';\n\n// ===================================\n// SETUP MOCKS\n// ===================================\n\n// Mock Next.js\njest.mock('next/server', () => ({\n  NextRequest: jest.fn(),\n  NextResponse: {\n    json: jest.fn((data, options) => ({\n      json: () => Promise.resolve(data),\n      status: options?.status || 200,\n      headers: new Map()\n    }))\n  }\n}));\n\n// Mock Supabase\njest.mock('@/lib/supabase', () => ({\n  supabaseAdmin: createMockSupabaseAdmin()\n}));\n\n// Mock NextAuth - Clerk eliminado, usar NextAuth\n// const { mockAuth } = createMockClerkAuth(true); // ELIMINADO - migrado a NextAuth\njest.mock('@/auth', () => ({ auth: jest.fn() }));\n\n// Mock Rate Limiter\nconst { mockCheckRateLimit, mockAddRateLimitHeaders } = createMockRateLimiter();\njest.mock('@/lib/rate-limiter', () => ({\n  checkRateLimit: mockCheckRateLimit,\n  addRateLimitHeaders: mockAddRateLimitHeaders,\n  RATE_LIMIT_CONFIGS: {\n    admin: { requests: 100, window: 3600000 }\n  }\n}));\n\n// Mock Logger\nconst mockLogger = createMockLogger();\njest.mock('@/lib/logger', () => ({\n  logger: mockLogger,\n  LogLevel: { INFO: 'info', ERROR: 'error', WARN: 'warn' },\n  LogCategory: { API: 'api', DATABASE: 'database', AUTH: 'auth' }\n}));\n\n// Mock Metrics\nconst mockMetricsCollector = createMockMetricsCollector();\njest.mock('@/lib/metrics', () => ({\n  metricsCollector: mockMetricsCollector\n}));\n\n// Mock Zod\njest.mock('zod', () => ({\n  z: {\n    object: jest.fn().mockReturnValue({\n      safeParse: jest.fn().mockReturnValue({\n        success: true,\n        data: {\n          page: 1,\n          limit: 20,\n          sort_by: 'created_at',\n          sort_order: 'desc'\n        }\n      })\n    }),\n    coerce: {\n      number: jest.fn().mockReturnValue({\n        min: jest.fn().mockReturnThis(),\n        max: jest.fn().mockReturnThis(),\n        default: jest.fn().mockReturnThis()\n      })\n    },\n    string: jest.fn().mockReturnValue({\n      optional: jest.fn().mockReturnThis(),\n      min: jest.fn().mockReturnThis(),\n      max: jest.fn().mockReturnThis(),\n      uuid: jest.fn().mockReturnThis()\n    }),\n    enum: jest.fn().mockReturnValue({\n      default: jest.fn().mockReturnThis()\n    }),\n    array: jest.fn().mockReturnValue({\n      min: jest.fn().mockReturnThis()\n    }),\n    number: jest.fn().mockReturnValue({\n      min: jest.fn().mockReturnThis(),\n      max: jest.fn().mockReturnThis()\n    })\n  }\n}));\n\n// ===================================\n// TESTS GET /api/admin/orders\n// ===================================\n\ndescribe('GET /api/admin/orders', () => {\n  beforeEach(() => {\n    resetAllMocks();\n  });\n\n  test('should return orders list successfully', async () => {\n    // Arrange\n    const mockRequest = {\n      url: 'http://localhost:3000/api/admin/orders?page=1&limit=20'\n    };\n\n    // Act\n    const response = await GET(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(200);\n    expect(data.success).toBe(true);\n    expect(data.data.orders).toEqual(mockOrders);\n    expect(data.data.pagination).toBeDefined();\n    expect(data.data.pagination.page).toBe(1);\n    expect(data.data.pagination.limit).toBe(20);\n    expect(data.data.pagination.total).toBe(mockOrders.length);\n\n    // Verify mocks were called\n    expect(mockAuth).toHaveBeenCalled();\n    expect(mockAuth).toHaveBeenCalled();\n    expect(mockCheckRateLimit).toHaveBeenCalled();\n    expect(mockMetricsCollector.recordApiCall).toHaveBeenCalledWith(\n      'admin-orders-list',\n      expect.any(Number),\n      200\n    );\n  });\n\n  test('should handle authentication failure', async () => {\n    // Arrange\n    mockAuth.mockResolvedValueOnce({ userId: null });\n    const mockRequest = {\n      url: 'http://localhost:3000/api/admin/orders'\n    };\n\n    // Act\n    const response = await GET(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(401);\n    expect(data.error).toBe('Usuario no autenticado');\n  });\n\n  test('should handle non-admin user', async () => {\n    // Arrange\n    mockAuth.mockResolvedValueOnce({\n      emailAddresses: [{ emailAddress: 'user@example.com' }]\n    });\n    const mockRequest = {\n      url: 'http://localhost:3000/api/admin/orders'\n    };\n\n    // Act\n    const response = await GET(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(403);\n    expect(data.error).toBe('Acceso denegado - Se requieren permisos de administrador');\n  });\n\n  test('should handle rate limiting', async () => {\n    // Arrange\n    mockCheckRateLimit.mockResolvedValueOnce({\n      success: false,\n      remaining: 0,\n      reset: Date.now() + 3600000\n    });\n    const mockRequest = {\n      url: 'http://localhost:3000/api/admin/orders'\n    };\n\n    // Act\n    const response = await GET(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(429);\n    expect(data.error).toBe('Demasiadas solicitudes');\n    expect(mockAddRateLimitHeaders).toHaveBeenCalled();\n  });\n\n  test('should handle filters correctly', async () => {\n    // Arrange\n    const mockRequest = {\n      url: 'http://localhost:3000/api/admin/orders?status=pending&search=test&page=2'\n    };\n\n    // Act\n    const response = await GET(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(200);\n    expect(data.success).toBe(true);\n    expect(data.data.filters).toBeDefined();\n  });\n\n  test('should handle database errors', async () => {\n    // Arrange\n    const mockSupabase = require('@/lib/supabase').supabaseAdmin;\n    mockSupabase.from().select().range.mockImplementationOnce(() => \n      Promise.resolve({ data: null, error: { message: 'Database error' } })\n    );\n    \n    const mockRequest = {\n      url: 'http://localhost:3000/api/admin/orders'\n    };\n\n    // Act\n    const response = await GET(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(500);\n    expect(data.error).toBe('Error al obtener órdenes');\n    expect(mockLogger.log).toHaveBeenCalledWith(\n      'error',\n      'database',\n      'Error al obtener órdenes admin',\n      expect.any(Object)\n    );\n  });\n});\n\n// ===================================\n// TESTS POST /api/admin/orders\n// ===================================\n\ndescribe('POST /api/admin/orders', () => {\n  beforeEach(() => {\n    resetAllMocks();\n  });\n\n  test('should create order successfully', async () => {\n    // Arrange\n    const orderData = {\n      user_id: 'test-user-id',\n      items: [\n        {\n          product_id: 1,\n          quantity: 2,\n          unit_price: 15000\n        }\n      ],\n      shipping_address: {\n        street_name: 'Av. Corrientes',\n        street_number: '1234',\n        zip_code: '1000',\n        city_name: 'Buenos Aires',\n        state_name: 'CABA'\n      },\n      notes: 'Test order'\n    };\n\n    const mockRequest = {\n      json: () => Promise.resolve(orderData)\n    };\n\n    // Act\n    const response = await POST(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(201);\n    expect(data.success).toBe(true);\n    expect(data.data).toBeDefined();\n    expect(data.data.order_number).toMatch(/^ORD-\\d+-[A-Z0-9]+$/);\n\n    // Verify database calls\n    const mockSupabase = require('@/lib/supabase').supabaseAdmin;\n    expect(mockSupabase.from).toHaveBeenCalledWith('orders');\n    expect(mockSupabase.from).toHaveBeenCalledWith('order_items');\n\n    // Verify metrics\n    expect(mockMetricsCollector.recordApiCall).toHaveBeenCalledWith(\n      'admin-orders-create',\n      expect.any(Number),\n      201\n    );\n  });\n\n  test('should handle validation errors', async () => {\n    // Arrange\n    const invalidOrderData = {\n      user_id: 'invalid-uuid',\n      items: [] // Empty items array should fail validation\n    };\n\n    // Mock Zod validation failure\n    const mockZod = require('zod');\n    mockZod.z.object().safeParse.mockReturnValueOnce({\n      success: false,\n      error: {\n        errors: [\n          { message: 'Invalid UUID', path: ['user_id'] },\n          { message: 'At least one item required', path: ['items'] }\n        ]\n      }\n    });\n\n    const mockRequest = {\n      json: () => Promise.resolve(invalidOrderData)\n    };\n\n    // Act\n    const response = await POST(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(400);\n    expect(data.error).toBe('Datos de orden inválidos');\n    expect(data.details).toBeDefined();\n  });\n\n  test('should handle order creation database error', async () => {\n    // Arrange\n    const orderData = {\n      user_id: 'test-user-id',\n      items: [{ product_id: 1, quantity: 1, unit_price: 15000 }]\n    };\n\n    const mockSupabase = require('@/lib/supabase').supabaseAdmin;\n    mockSupabase.from().insert().select().single.mockImplementationOnce(() => \n      Promise.resolve({ data: null, error: { message: 'Insert failed' } })\n    );\n\n    const mockRequest = {\n      json: () => Promise.resolve(orderData)\n    };\n\n    // Act\n    const response = await POST(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(500);\n    expect(data.error).toBe('Error al crear orden');\n  });\n\n  test('should handle order items creation error with rollback', async () => {\n    // Arrange\n    const orderData = {\n      user_id: 'test-user-id',\n      items: [{ product_id: 1, quantity: 1, unit_price: 15000 }]\n    };\n\n    const mockSupabase = require('@/lib/supabase').supabaseAdmin;\n    \n    // Order creation succeeds\n    mockSupabase.from().insert().select().single.mockImplementationOnce(() => \n      Promise.resolve({ data: { id: 'new-order-id' }, error: null })\n    );\n    \n    // Order items creation fails\n    mockSupabase.from().insert.mockImplementationOnce(() => \n      Promise.resolve({ data: null, error: { message: 'Items insert failed' } })\n    );\n\n    const mockRequest = {\n      json: () => Promise.resolve(orderData)\n    };\n\n    // Act\n    const response = await POST(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(500);\n    expect(data.error).toBe('Error al crear items de orden');\n    \n    // Verify rollback was attempted\n    expect(mockSupabase.from).toHaveBeenCalledWith('orders');\n  });\n\n  test('should calculate total amount correctly', async () => {\n    // Arrange\n    const orderData = {\n      user_id: 'test-user-id',\n      items: [\n        { product_id: 1, quantity: 2, unit_price: 15000 }, // 30000\n        { product_id: 2, quantity: 1, unit_price: 2500 }   // 2500\n      ]\n      // Total should be 32500\n    };\n\n    const mockRequest = {\n      json: () => Promise.resolve(orderData)\n    };\n\n    // Act\n    const response = await POST(mockRequest);\n    const data = await response.json();\n\n    // Assert\n    expect(response.status).toBe(201);\n    expect(data.success).toBe(true);\n    \n    // Verify total calculation in the insert call\n    const mockSupabase = require('@/lib/supabase').supabaseAdmin;\n    const insertCall = mockSupabase.from().insert.mock.calls[0][0];\n    expect(insertCall.total_amount).toBe(32500);\n  });\n});\n\n// ===================================\n// INTEGRATION TESTS\n// ===================================\n\ndescribe('Orders API Integration', () => {\n  beforeEach(() => {\n    resetAllMocks();\n  });\n\n  test('should handle complete order lifecycle', async () => {\n    // Test creating an order and then retrieving it\n    \n    // 1. Create order\n    const orderData = {\n      user_id: 'test-user-id',\n      items: [{ product_id: 1, quantity: 1, unit_price: 15000 }]\n    };\n\n    const createRequest = {\n      json: () => Promise.resolve(orderData)\n    };\n\n    const createResponse = await POST(createRequest);\n    const createData = await createResponse.json();\n\n    expect(createResponse.status).toBe(201);\n    expect(createData.success).toBe(true);\n\n    // 2. Retrieve orders list\n    const getRequest = {\n      url: 'http://localhost:3000/api/admin/orders'\n    };\n\n    const getResponse = await GET(getRequest);\n    const getData = await getResponse.json();\n\n    expect(getResponse.status).toBe(200);\n    expect(getData.success).toBe(true);\n    expect(getData.data.orders).toBeDefined();\n  });\n\n  test('should maintain data consistency across operations', async () => {\n    // Verify that all related data is properly linked\n    const mockRequest = {\n      url: 'http://localhost:3000/api/admin/orders'\n    };\n\n    const response = await GET(mockRequest);\n    const data = await response.json();\n\n    expect(response.status).toBe(200);\n    \n    // Verify order structure\n    const order = data.data.orders[0];\n    expect(order.id).toBeDefined();\n    expect(order.order_number).toBeDefined();\n    expect(order.user_profiles).toBeDefined();\n    expect(order.order_items).toBeDefined();\n    expect(Array.isArray(order.order_items)).toBe(true);\n    \n    // Verify order items have product data\n    if (order.order_items.length > 0) {\n      expect(order.order_items[0].products).toBeDefined();\n    }\n  });\n});\n"],"names":["jest","mock","NextRequest","fn","NextResponse","json","data","options","Promise","resolve","status","headers","Map","supabaseAdmin","createMockSupabaseAdmin","auth","checkRateLimit","mockCheckRateLimit","addRateLimitHeaders","mockAddRateLimitHeaders","RATE_LIMIT_CONFIGS","admin","requests","window","logger","mockLogger","LogLevel","INFO","ERROR","WARN","LogCategory","API","DATABASE","AUTH","metricsCollector","mockMetricsCollector","z","object","mockReturnValue","safeParse","success","page","limit","sort_by","sort_order","coerce","number","min","mockReturnThis","max","default","string","optional","uuid","enum","array","createMockRateLimiter","createMockLogger","createMockMetricsCollector","describe","beforeEach","resetAllMocks","test","mockRequest","url","response","GET","expect","toBe","orders","toEqual","mockOrders","pagination","toBeDefined","total","length","mockAuth","toHaveBeenCalled","recordApiCall","toHaveBeenCalledWith","any","Number","mockResolvedValueOnce","userId","error","emailAddresses","emailAddress","remaining","reset","Date","now","filters","mockSupabase","require","from","select","range","mockImplementationOnce","message","log","Object","orderData","user_id","items","product_id","quantity","unit_price","shipping_address","street_name","street_number","zip_code","city_name","state_name","notes","POST","order_number","toMatch","invalidOrderData","mockZod","mockReturnValueOnce","errors","path","details","insert","single","id","insertCall","calls","total_amount","createRequest","createResponse","createData","getRequest","getResponse","getData","order","user_profiles","order_items","Array","isArray","products"],"mappings":"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"}