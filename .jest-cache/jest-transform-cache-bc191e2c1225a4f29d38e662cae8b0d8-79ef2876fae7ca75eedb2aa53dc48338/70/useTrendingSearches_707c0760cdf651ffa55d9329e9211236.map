{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\useTrendingSearches.ts"],"sourcesContent":["// ===================================\n// HOOK: useTrendingSearches - B√∫squedas populares/trending\n// ===================================\n\nimport { useQuery } from '@tanstack/react-query';\nimport { searchQueryKeys } from '@/lib/query-client';\nimport { TrendingSearch, TrendingSearchesResponse } from '@/app/api/search/trending/route';\nimport { ApiResponse } from '@/types/api';\n\nexport interface UseTrendingSearchesOptions {\n  /** N√∫mero m√°ximo de b√∫squedas trending a obtener */\n  limit?: number;\n  /** N√∫mero de d√≠as hacia atr√°s para calcular trending */\n  days?: number;\n  /** Filtrar por categor√≠a espec√≠fica */\n  category?: string;\n  /** Habilitar/deshabilitar la query */\n  enabled?: boolean;\n  /** Intervalo de refetch en milisegundos */\n  refetchInterval?: number;\n}\n\nexport interface UseTrendingSearchesReturn {\n  /** B√∫squedas trending */\n  trendingSearches: TrendingSearch[];\n  /** Indica si est√° cargando */\n  isLoading: boolean;\n  /** Indica si hay un error */\n  error: Error | null;\n  /** Funci√≥n para refrescar los datos */\n  refetch: () => void;\n  /** Indica si los datos est√°n obsoletos */\n  isStale: boolean;\n  /** Timestamp de la √∫ltima actualizaci√≥n */\n  lastUpdated: string | null;\n  /** Funci√≥n para registrar una b√∫squeda */\n  trackSearch: (query: string, category?: string) => Promise<void>;\n}\n\n/**\n * Hook para obtener b√∫squedas trending/populares\n * \n * Obtiene las b√∫squedas m√°s populares basadas en datos reales del sistema\n * de analytics, con fallback a datos por defecto.\n */\nexport function useTrendingSearches(options: UseTrendingSearchesOptions = {}): UseTrendingSearchesReturn {\n  const {\n    limit = 6,\n    days = 7,\n    category,\n    enabled = true,\n    refetchInterval = 5 * 60 * 1000, // 5 minutos\n  } = options;\n\n  // Query para obtener b√∫squedas trending\n  const {\n    data,\n    isLoading,\n    error,\n    refetch,\n    isStale,\n  } = useQuery({\n    queryKey: [...searchQueryKeys.trending(), 'params', { limit, days, category }],\n    queryFn: async (): Promise<TrendingSearchesResponse> => {\n      console.log('üî• useTrendingSearches: Fetching trending searches', {\n        limit,\n        days,\n        category\n      });\n\n      const params = new URLSearchParams();\n      params.set('limit', limit.toString());\n      params.set('days', days.toString());\n      \n      if (category) {\n        params.set('category', category);\n      }\n\n      const response = await fetch(`/api/search/trending?${params.toString()}`);\n      \n      if (!response.ok) {\n        throw new Error(`Error fetching trending searches: ${response.status}`);\n      }\n\n      const result: ApiResponse<TrendingSearchesResponse> = await response.json();\n      \n      if (!result.success || !result.data) {\n        throw new Error(result.error || 'Error obteniendo b√∫squedas trending');\n      }\n\n      console.log('‚úÖ useTrendingSearches: Trending searches fetched', {\n        count: result.data.trending.length,\n        lastUpdated: result.data.lastUpdated\n      });\n\n      return result.data;\n    },\n    enabled,\n    refetchInterval,\n    staleTime: 2 * 60 * 1000, // 2 minutos\n    gcTime: 10 * 60 * 1000, // 10 minutos\n    retry: 2,\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),\n  });\n\n  // Funci√≥n para registrar una b√∫squeda en analytics\n  const trackSearch = async (query: string, searchCategory?: string): Promise<void> => {\n    try {\n      console.log('üìä useTrendingSearches: Tracking search', { query, category: searchCategory });\n\n      const response = await fetch('/api/search/trending', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          query: query.trim(),\n          category: searchCategory,\n          userId: null, // Se puede obtener del contexto de auth si est√° disponible\n          sessionId: `session-${Date.now()}`, // Generar session ID simple\n        }),\n      });\n\n      if (!response.ok) {\n        console.warn('‚ö†Ô∏è Error tracking search:', response.status);\n      } else {\n        console.log('‚úÖ Search tracked successfully');\n      }\n    } catch (error) {\n      console.warn('‚ö†Ô∏è Error tracking search:', error);\n      // No lanzar error para no interrumpir la experiencia del usuario\n    }\n  };\n\n  return {\n    trendingSearches: data?.trending || [],\n    isLoading,\n    error: error as Error | null,\n    refetch,\n    isStale,\n    lastUpdated: data?.lastUpdated || null,\n    trackSearch,\n  };\n}\n\n/**\n * Hook simplificado para obtener solo las b√∫squedas trending\n */\nexport function useTrendingSearchesSimple(limit: number = 6): TrendingSearch[] {\n  const { trendingSearches } = useTrendingSearches({ limit });\n  return trendingSearches;\n}\n\n/**\n * Hook para obtener b√∫squedas trending por categor√≠a\n */\nexport function useTrendingSearchesByCategory(category: string, limit: number = 4): TrendingSearch[] {\n  const { trendingSearches } = useTrendingSearches({ \n    category, \n    limit,\n    refetchInterval: 10 * 60 * 1000 // 10 minutos para categor√≠as espec√≠ficas\n  });\n  return trendingSearches;\n}\n\nexport default useTrendingSearches;\n"],"names":["useTrendingSearches","useTrendingSearchesByCategory","useTrendingSearchesSimple","options","limit","days","category","enabled","refetchInterval","data","isLoading","error","refetch","isStale","useQuery","queryKey","searchQueryKeys","trending","queryFn","console","log","params","URLSearchParams","set","toString","response","fetch","ok","Error","status","result","json","success","count","length","lastUpdated","staleTime","gcTime","retry","retryDelay","attemptIndex","Math","min","trackSearch","query","searchCategory","method","headers","body","JSON","stringify","trim","userId","sessionId","Date","now","warn","trendingSearches"],"mappings":"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"}