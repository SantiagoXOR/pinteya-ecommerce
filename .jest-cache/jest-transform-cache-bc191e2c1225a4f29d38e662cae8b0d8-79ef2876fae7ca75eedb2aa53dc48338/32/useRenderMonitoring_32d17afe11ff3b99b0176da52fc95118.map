{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\monitoring\\useRenderMonitoring.ts"],"sourcesContent":["// ===================================\n// PINTEYA E-COMMERCE - RENDER MONITORING SYSTEM\n// Sistema de monitoreo en tiempo real para detectar problemas de renderizado\n// ===================================\n\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useToast } from '@/hooks/use-toast';\n\n// ===================================\n// TIPOS Y INTERFACES\n// ===================================\n\nexport interface RenderMetrics {\n  readonly componentName: string;\n  readonly renderCount: number;\n  readonly averageRenderTime: number;\n  readonly lastRenderTime: number;\n  readonly slowRenders: number;\n  readonly errorCount: number;\n  readonly memoryUsage?: number;\n  readonly timestamp: number;\n}\n\nexport interface PerformanceThresholds {\n  readonly slowRenderThreshold: number; // ms\n  readonly maxRenderCount: number; // renders per minute\n  readonly memoryThreshold: number; // MB\n  readonly errorThreshold: number; // errors per minute\n}\n\nexport interface MonitoringAlert {\n  readonly id: string;\n  readonly type: 'performance' | 'error' | 'memory' | 'render-loop';\n  readonly severity: 'low' | 'medium' | 'high' | 'critical';\n  readonly message: string;\n  readonly componentName: string;\n  readonly metrics: Partial<RenderMetrics>;\n  readonly timestamp: number;\n  readonly resolved: boolean;\n}\n\nexport interface MonitoringState {\n  readonly isEnabled: boolean;\n  readonly metrics: Map<string, RenderMetrics>;\n  readonly alerts: MonitoringAlert[];\n  readonly globalStats: {\n    readonly totalComponents: number;\n    readonly totalRenders: number;\n    readonly averageRenderTime: number;\n    readonly activeAlerts: number;\n  };\n}\n\nexport interface MonitoringOptions {\n  readonly enabled?: boolean;\n  readonly componentName: string;\n  readonly thresholds?: Partial<PerformanceThresholds>;\n  readonly enableToasts?: boolean;\n  readonly enableConsoleLogging?: boolean;\n  readonly enableLocalStorage?: boolean;\n  readonly sampleRate?: number; // 0-1, percentage of renders to monitor\n}\n\n// ===================================\n// CONFIGURACIÓN POR DEFECTO\n// ===================================\n\nconst DEFAULT_THRESHOLDS: PerformanceThresholds = {\n  slowRenderThreshold: 16, // 16ms = 60fps\n  maxRenderCount: 60, // 60 renders per minute\n  memoryThreshold: 100, // 100MB\n  errorThreshold: 5 // 5 errors per minute\n};\n\nconst DEFAULT_OPTIONS: Required<Omit<MonitoringOptions, 'componentName'>> = {\n  enabled: process.env.NODE_ENV === 'development',\n  thresholds: DEFAULT_THRESHOLDS,\n  enableToasts: true,\n  enableConsoleLogging: true,\n  enableLocalStorage: true,\n  sampleRate: 1.0\n};\n\n// ===================================\n// ALMACENAMIENTO GLOBAL\n// ===================================\n\nclass MonitoringStore {\n  private static instance: MonitoringStore;\n  private metrics = new Map<string, RenderMetrics>();\n  private alerts: MonitoringAlert[] = [];\n  private listeners = new Set<(state: MonitoringState) => void>();\n\n  static getInstance(): MonitoringStore {\n    if (!MonitoringStore.instance) {\n      MonitoringStore.instance = new MonitoringStore();\n    }\n    return MonitoringStore.instance;\n  }\n\n  addListener(listener: (state: MonitoringState) => void): () => void {\n    this.listeners.add(listener);\n    return () => this.listeners.delete(listener);\n  }\n\n  private notifyListeners(): void {\n    // Debounce para evitar loops infinitos\n    if (this.notifyTimeout) {\n      clearTimeout(this.notifyTimeout);\n    }\n\n    this.notifyTimeout = setTimeout(() => {\n      const state = this.getState();\n      this.listeners.forEach(listener => listener(state));\n      this.notifyTimeout = null;\n    }, 16); // 16ms = ~60fps\n  }\n\n  private notifyTimeout: NodeJS.Timeout | null = null;\n\n  getState(): MonitoringState {\n    const totalRenders = Array.from(this.metrics.values())\n      .reduce((sum, metric) => sum + metric.renderCount, 0);\n    \n    const averageRenderTime = Array.from(this.metrics.values())\n      .reduce((sum, metric, _, arr) => sum + metric.averageRenderTime / arr.length, 0);\n\n    return {\n      isEnabled: true,\n      metrics: new Map(this.metrics),\n      alerts: [...this.alerts],\n      globalStats: {\n        totalComponents: this.metrics.size,\n        totalRenders,\n        averageRenderTime,\n        activeAlerts: this.alerts.filter(alert => !alert.resolved).length\n      }\n    };\n  }\n\n  updateMetrics(componentName: string, metrics: Partial<RenderMetrics>): void {\n    const existing = this.metrics.get(componentName);\n    const updated: RenderMetrics = {\n      componentName,\n      renderCount: 0,\n      averageRenderTime: 0,\n      lastRenderTime: 0,\n      slowRenders: 0,\n      errorCount: 0,\n      timestamp: Date.now(),\n      ...existing,\n      ...metrics\n    };\n\n    this.metrics.set(componentName, updated);\n    this.notifyListeners();\n  }\n\n  addAlert(alert: Omit<MonitoringAlert, 'id' | 'timestamp' | 'resolved'>): void {\n    const newAlert: MonitoringAlert = {\n      ...alert,\n      id: `alert-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      timestamp: Date.now(),\n      resolved: false\n    };\n\n    this.alerts.unshift(newAlert);\n    \n    // Mantener solo las últimas 100 alertas\n    if (this.alerts.length > 100) {\n      this.alerts = this.alerts.slice(0, 100);\n    }\n\n    this.notifyListeners();\n  }\n\n  resolveAlert(alertId: string): void {\n    const alert = this.alerts.find(a => a.id === alertId);\n    if (alert) {\n      (alert as any).resolved = true;\n      this.notifyListeners();\n    }\n  }\n\n  clearAlerts(): void {\n    this.alerts = [];\n    this.notifyListeners();\n  }\n\n  exportData(): string {\n    return JSON.stringify({\n      metrics: Array.from(this.metrics.entries()),\n      alerts: this.alerts,\n      timestamp: Date.now()\n    }, null, 2);\n  }\n}\n\nconst monitoringStore = MonitoringStore.getInstance();\n\n// ===================================\n// UTILIDADES DE PERFORMANCE\n// ===================================\n\nfunction measureRenderTime<T>(fn: () => T): { result: T; duration: number } {\n  const start = performance.now();\n  const result = fn();\n  const duration = performance.now() - start;\n  return { result, duration };\n}\n\nfunction getMemoryUsage(): number {\n  if ('memory' in performance) {\n    return (performance as any).memory.usedJSHeapSize / 1024 / 1024; // MB\n  }\n  return 0;\n}\n\nfunction shouldSample(sampleRate: number): boolean {\n  return Math.random() < sampleRate;\n}\n\n// ===================================\n// HOOK PRINCIPAL DE MONITOREO\n// ===================================\n\nexport function useRenderMonitoring(options: MonitoringOptions) {\n  const opts = { ...DEFAULT_OPTIONS, ...options };\n  const { toast } = useToast();\n  \n  // Referencias para tracking\n  const renderCountRef = useRef(0);\n  const renderTimesRef = useRef<number[]>([]);\n  const lastRenderTimeRef = useRef(0);\n  const slowRendersRef = useRef(0);\n  const errorCountRef = useRef(0);\n  const mountTimeRef = useRef(Date.now());\n  \n  // Estado local\n  const [monitoringState, setMonitoringState] = useState<MonitoringState>(\n    monitoringStore.getState()\n  );\n\n  // ===================================\n  // FUNCIONES DE ANÁLISIS\n  // ===================================\n\n  const analyzePerformance = useCallback((renderTime: number) => {\n    const { componentName, thresholds } = opts;\n    \n    // Detectar render lento\n    if (renderTime > thresholds.slowRenderThreshold) {\n      slowRendersRef.current++;\n      \n      monitoringStore.addAlert({\n        type: 'performance',\n        severity: renderTime > thresholds.slowRenderThreshold * 2 ? 'high' : 'medium',\n        message: `Render lento detectado: ${renderTime.toFixed(2)}ms (umbral: ${thresholds.slowRenderThreshold}ms)`,\n        componentName,\n        metrics: { lastRenderTime: renderTime }\n      });\n\n      if (opts.enableConsoleLogging) {\n        console.warn(`[RenderMonitoring] Slow render in ${componentName}: ${renderTime.toFixed(2)}ms`);\n      }\n    }\n\n    // Detectar posible render loop\n    const now = Date.now();\n    const oneMinuteAgo = now - 60000;\n    const recentRenders = renderTimesRef.current.filter(time => time > oneMinuteAgo).length;\n    \n    if (recentRenders > thresholds.maxRenderCount) {\n      monitoringStore.addAlert({\n        type: 'render-loop',\n        severity: 'critical',\n        message: `Posible render loop: ${recentRenders} renders en el último minuto (máximo: ${thresholds.maxRenderCount})`,\n        componentName,\n        metrics: { renderCount: recentRenders }\n      });\n\n      if (opts.enableToasts) {\n        toast({\n          title: 'Render Loop Detectado',\n          description: `${componentName}: ${recentRenders} renders/min`,\n          variant: 'destructive'\n        });\n      }\n    }\n\n    // Detectar uso excesivo de memoria\n    const memoryUsage = getMemoryUsage();\n    if (memoryUsage > thresholds.memoryThreshold) {\n      monitoringStore.addAlert({\n        type: 'memory',\n        severity: 'high',\n        message: `Uso de memoria elevado: ${memoryUsage.toFixed(2)}MB (umbral: ${thresholds.memoryThreshold}MB)`,\n        componentName,\n        metrics: { memoryUsage }\n      });\n    }\n  }, [opts, toast]);\n\n  // ===================================\n  // FUNCIÓN DE TRACKING DE RENDER\n  // ===================================\n\n  const trackRender = useCallback(() => {\n    if (!opts.enabled || !shouldSample(opts.sampleRate)) {\n      return;\n    }\n\n    const renderTime = performance.now() - lastRenderTimeRef.current;\n    renderCountRef.current++;\n    renderTimesRef.current.push(Date.now());\n    \n    // Mantener solo los últimos 100 renders\n    if (renderTimesRef.current.length > 100) {\n      renderTimesRef.current = renderTimesRef.current.slice(-100);\n    }\n\n    // Calcular promedio de tiempo de render\n    const recentTimes = renderTimesRef.current.slice(-10); // Últimos 10 renders\n    const averageRenderTime = recentTimes.reduce((sum, time, i, arr) => {\n      if (i === 0) return 0;\n      return sum + (time - arr[i - 1]) / (arr.length - 1);\n    }, 0);\n\n    // Actualizar métricas\n    const metrics: Partial<RenderMetrics> = {\n      renderCount: renderCountRef.current,\n      averageRenderTime,\n      lastRenderTime: renderTime,\n      slowRenders: slowRendersRef.current,\n      errorCount: errorCountRef.current,\n      memoryUsage: getMemoryUsage(),\n      timestamp: Date.now()\n    };\n\n    monitoringStore.updateMetrics(opts.componentName, metrics);\n    \n    // Analizar performance\n    analyzePerformance(renderTime);\n    \n    // Guardar en localStorage si está habilitado\n    if (opts.enableLocalStorage) {\n      try {\n        localStorage.setItem(\n          `render-monitoring-${opts.componentName}`,\n          JSON.stringify(metrics)\n        );\n      } catch (error) {\n        // Ignorar errores de localStorage\n      }\n    }\n\n    lastRenderTimeRef.current = performance.now();\n  }, [opts, analyzePerformance]);\n\n  // ===================================\n  // FUNCIÓN DE TRACKING DE ERRORES\n  // ===================================\n\n  const trackError = useCallback((error: Error, errorInfo?: any) => {\n    if (!opts.enabled) return;\n\n    errorCountRef.current++;\n    \n    monitoringStore.addAlert({\n      type: 'error',\n      severity: 'high',\n      message: `Error en componente: ${error.message}`,\n      componentName: opts.componentName,\n      metrics: { errorCount: errorCountRef.current }\n    });\n\n    if (opts.enableConsoleLogging) {\n      console.error(`[RenderMonitoring] Error in ${opts.componentName}:`, error, errorInfo);\n    }\n\n    if (opts.enableToasts) {\n      toast({\n        title: 'Error de Componente',\n        description: `${opts.componentName}: ${error.message}`,\n        variant: 'destructive'\n      });\n    }\n  }, [opts, toast]);\n\n  // ===================================\n  // EFECTOS\n  // ===================================\n\n  // Suscribirse a cambios del store\n  useEffect(() => {\n    const unsubscribe = monitoringStore.addListener(setMonitoringState);\n    return unsubscribe;\n  }, []);\n\n  // Track render en cada render del componente\n  useEffect(() => {\n    trackRender();\n  });\n\n  // Cleanup al desmontar\n  useEffect(() => {\n    return () => {\n      if (opts.enableConsoleLogging) {\n        const totalTime = Date.now() - mountTimeRef.current;\n        console.log(\n          `[RenderMonitoring] ${opts.componentName} unmounted after ${totalTime}ms, ` +\n          `${renderCountRef.current} renders, ` +\n          `${slowRendersRef.current} slow renders, ` +\n          `${errorCountRef.current} errors`\n        );\n      }\n    };\n  }, [opts]);\n\n  // ===================================\n  // API PÚBLICA\n  // ===================================\n\n  return {\n    // Estado\n    isEnabled: opts.enabled,\n    metrics: monitoringState.metrics.get(opts.componentName),\n    globalStats: monitoringState.globalStats,\n    alerts: monitoringState.alerts.filter(alert => \n      alert.componentName === opts.componentName\n    ),\n    \n    // Funciones\n    trackError,\n    trackRender,\n    \n    // Utilidades\n    exportData: () => monitoringStore.exportData(),\n    clearAlerts: () => monitoringStore.clearAlerts(),\n    resolveAlert: (alertId: string) => monitoringStore.resolveAlert(alertId)\n  };\n}\n\n// ===================================\n// HOOK PARA MONITOREO GLOBAL\n// ===================================\n\nexport function useGlobalMonitoring() {\n  const [state, setState] = useState<MonitoringState>(monitoringStore.getState());\n\n  useEffect(() => {\n    const unsubscribe = monitoringStore.addListener(setState);\n    return unsubscribe;\n  }, []);\n\n  return {\n    ...state,\n    exportData: () => monitoringStore.exportData(),\n    clearAlerts: () => monitoringStore.clearAlerts(),\n    resolveAlert: (alertId: string) => monitoringStore.resolveAlert(alertId)\n  };\n}\n\n// ===================================\n// HOC PARA MONITOREO AUTOMÁTICO\n// ===================================\n\nexport function withRenderMonitoring<P extends object>(\n  Component: React.ComponentType<P>,\n  options: Omit<MonitoringOptions, 'componentName'>\n): React.ComponentType<P> {\n  const componentName = Component.displayName || Component.name || 'UnknownComponent';\n  \n  const WrappedComponent: React.FC<P> = (props) => {\n    const { trackError } = useRenderMonitoring({\n      ...options,\n      componentName\n    });\n\n    // Error boundary simple\n    useEffect(() => {\n      const handleError = (event: ErrorEvent) => {\n        trackError(new Error(event.message));\n      };\n\n      window.addEventListener('error', handleError);\n      return () => window.removeEventListener('error', handleError);\n    }, [trackError]);\n\n    return React.createElement(Component, props);\n  };\n\n  WrappedComponent.displayName = `withRenderMonitoring(${componentName})`;\n  return WrappedComponent;\n}\n\n// ===================================\n// UTILIDADES EXPORTADAS\n// ===================================\n\n/**\n * Obtiene métricas de un componente específico\n */\nexport function getComponentMetrics(componentName: string): RenderMetrics | undefined {\n  return monitoringStore.getState().metrics.get(componentName);\n}\n\n/**\n * Obtiene todas las alertas activas\n */\nexport function getActiveAlerts(): MonitoringAlert[] {\n  return monitoringStore.getState().alerts.filter(alert => !alert.resolved);\n}\n\n/**\n * Exporta todos los datos de monitoreo\n */\nexport function exportMonitoringData(): string {\n  return monitoringStore.exportData();\n}\n\n/**\n * Limpia todas las alertas\n */\nexport function clearAllAlerts(): void {\n  monitoringStore.clearAlerts();\n}"],"names":["clearAllAlerts","exportMonitoringData","getActiveAlerts","getComponentMetrics","useGlobalMonitoring","useRenderMonitoring","withRenderMonitoring","DEFAULT_THRESHOLDS","slowRenderThreshold","maxRenderCount","memoryThreshold","errorThreshold","DEFAULT_OPTIONS","enabled","process","env","NODE_ENV","thresholds","enableToasts","enableConsoleLogging","enableLocalStorage","sampleRate","MonitoringStore","getInstance","instance","addListener","listener","listeners","add","delete","notifyListeners","notifyTimeout","clearTimeout","setTimeout","state","getState","forEach","totalRenders","Array","from","metrics","values","reduce","sum","metric","renderCount","averageRenderTime","_","arr","length","isEnabled","Map","alerts","globalStats","totalComponents","size","activeAlerts","filter","alert","resolved","updateMetrics","componentName","existing","get","updated","lastRenderTime","slowRenders","errorCount","timestamp","Date","now","set","addAlert","newAlert","id","Math","random","toString","substr","unshift","slice","resolveAlert","alertId","find","a","clearAlerts","exportData","JSON","stringify","entries","Set","monitoringStore","measureRenderTime","fn","start","performance","result","duration","getMemoryUsage","memory","usedJSHeapSize","shouldSample","options","opts","toast","useToast","renderCountRef","useRef","renderTimesRef","lastRenderTimeRef","slowRendersRef","errorCountRef","mountTimeRef","monitoringState","setMonitoringState","useState","analyzePerformance","useCallback","renderTime","current","type","severity","message","toFixed","console","warn","oneMinuteAgo","recentRenders","time","title","description","variant","memoryUsage","trackRender","push","recentTimes","i","localStorage","setItem","error","trackError","errorInfo","useEffect","unsubscribe","totalTime","log","setState","Component","displayName","name","WrappedComponent","props","handleError","event","Error","window","addEventListener","removeEventListener","React","createElement"],"mappings":"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"}