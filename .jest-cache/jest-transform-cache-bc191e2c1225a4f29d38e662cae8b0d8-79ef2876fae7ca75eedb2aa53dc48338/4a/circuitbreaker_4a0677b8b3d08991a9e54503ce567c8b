8abf785c419f3dafed7bb221726de9dd
// ===================================
// PINTEYA E-COMMERCE - CIRCUIT BREAKER PATTERN ENTERPRISE
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get CIRCUIT_BREAKER_CONFIGS () {
        return CIRCUIT_BREAKER_CONFIGS;
    },
    get CircuitBreaker () {
        return CircuitBreaker;
    },
    get CircuitBreakerState () {
        return CircuitBreakerState;
    },
    get executeMercadoPagoCritical () {
        return executeMercadoPagoCritical;
    },
    get executeMercadoPagoStandard () {
        return executeMercadoPagoStandard;
    },
    get executeWebhookProcessing () {
        return executeWebhookProcessing;
    },
    get mercadoPagoCriticalBreaker () {
        return mercadoPagoCriticalBreaker;
    },
    get mercadoPagoStandardBreaker () {
        return mercadoPagoStandardBreaker;
    },
    get webhookProcessingBreaker () {
        return webhookProcessingBreaker;
    }
});
const _logger = require("../logger");
const _metrics = require("../metrics");
var CircuitBreakerState = /*#__PURE__*/ function(CircuitBreakerState) {
    CircuitBreakerState["CLOSED"] = "CLOSED";
    CircuitBreakerState["OPEN"] = "OPEN";
    CircuitBreakerState["HALF_OPEN"] = "HALF_OPEN"; // Probando si el servicio se recuperó
    return CircuitBreakerState;
}({});
const CIRCUIT_BREAKER_CONFIGS = {
    MERCADOPAGO_CRITICAL: {
        failureThreshold: 5,
        recoveryTimeout: 60000,
        monitoringWindow: 120000,
        halfOpenMaxCalls: 3,
        successThreshold: 2
    },
    MERCADOPAGO_STANDARD: {
        failureThreshold: 3,
        recoveryTimeout: 30000,
        monitoringWindow: 60000,
        halfOpenMaxCalls: 2,
        successThreshold: 1
    },
    WEBHOOK_PROCESSING: {
        failureThreshold: 10,
        recoveryTimeout: 15000,
        monitoringWindow: 30000,
        halfOpenMaxCalls: 5,
        successThreshold: 3
    }
};
class CircuitBreaker {
    constructor(name, config){
        this.name = name;
        this.config = config;
        this.state = "CLOSED";
        this.failures = 0;
        this.successes = 0;
        this.lastFailureTime = 0;
        this.lastSuccessTime = 0;
        this.halfOpenCalls = 0;
        this.stateChanges = 0;
        this.metrics = {
            totalCalls: 0,
            successfulCalls: 0,
            failedCalls: 0,
            rejectedCalls: 0,
            lastFailureTime: 0,
            lastSuccessTime: 0,
            stateChanges: 0
        };
        _logger.logger.debug(_logger.LogLevel.DEBUG, `Circuit Breaker initialized: ${name}`, {
            config: this.config
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Ejecuta una operación protegida por el circuit breaker
   */ async execute(operation) {
        const startTime = Date.now();
        this.metrics.totalCalls++;
        // Verificar si debemos rechazar la llamada
        if (this.shouldReject()) {
            this.metrics.rejectedCalls++;
            await this.recordMetrics('rejected');
            return {
                success: false,
                error: new Error(`Circuit breaker is ${this.state} - operation rejected`),
                state: this.state,
                executionTime: Date.now() - startTime,
                wasRejected: true
            };
        }
        try {
            // Ejecutar la operación
            const result = await operation();
            // Registrar éxito
            await this.onSuccess();
            const executionTime = Date.now() - startTime;
            await this.recordMetrics('success', executionTime);
            return {
                success: true,
                data: result,
                state: this.state,
                executionTime,
                wasRejected: false
            };
        } catch (error) {
            // Registrar fallo
            await this.onFailure(error);
            const executionTime = Date.now() - startTime;
            await this.recordMetrics('failure', executionTime);
            return {
                success: false,
                error: error,
                state: this.state,
                executionTime,
                wasRejected: false
            };
        }
    }
    /**
   * Determina si debemos rechazar la operación
   */ shouldReject() {
        const now = Date.now();
        switch(this.state){
            case "CLOSED":
                return false;
            case "OPEN":
                // Verificar si es tiempo de intentar recuperación
                if (now - this.lastFailureTime >= this.config.recoveryTimeout) {
                    this.transitionToHalfOpen();
                    return false;
                }
                return true;
            case "HALF_OPEN":
                // Limitar llamadas en estado HALF_OPEN
                return this.halfOpenCalls >= this.config.halfOpenMaxCalls;
            default:
                return false;
        }
    }
    /**
   * Maneja un éxito en la operación
   */ async onSuccess() {
        this.lastSuccessTime = Date.now();
        this.metrics.successfulCalls++;
        switch(this.state){
            case "HALF_OPEN":
                this.successes++;
                this.halfOpenCalls++;
                if (this.successes >= this.config.successThreshold) {
                    this.transitionToClosed();
                }
                break;
            case "CLOSED":
                // Reset failure counter en ventana de monitoreo
                if (this.isInMonitoringWindow()) {
                    this.failures = 0;
                }
                break;
        }
    }
    /**
   * Maneja un fallo en la operación
   */ async onFailure(error) {
        this.lastFailureTime = Date.now();
        this.metrics.failedCalls++;
        this.failures++;
        _logger.logger.warn(_logger.LogLevel.WARN, `Circuit Breaker failure: ${this.name}`, {
            error: error.message,
            failures: this.failures,
            state: this.state
        }, _logger.LogCategory.SYSTEM);
        switch(this.state){
            case "CLOSED":
                if (this.failures >= this.config.failureThreshold) {
                    this.transitionToOpen();
                }
                break;
            case "HALF_OPEN":
                this.transitionToOpen();
                break;
        }
    }
    /**
   * Transición a estado OPEN
   */ transitionToOpen() {
        this.state = "OPEN";
        this.stateChanges++;
        this.metrics.stateChanges++;
        this.halfOpenCalls = 0;
        this.successes = 0;
        _logger.logger.warn(_logger.LogLevel.WARN, `Circuit Breaker OPENED: ${this.name}`, {
            failures: this.failures,
            threshold: this.config.failureThreshold
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Transición a estado HALF_OPEN
   */ transitionToHalfOpen() {
        this.state = "HALF_OPEN";
        this.stateChanges++;
        this.metrics.stateChanges++;
        this.halfOpenCalls = 0;
        this.successes = 0;
        _logger.logger.info(_logger.LogLevel.INFO, `Circuit Breaker HALF-OPEN: ${this.name}`, {
            recoveryTimeout: this.config.recoveryTimeout
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Transición a estado CLOSED
   */ transitionToClosed() {
        this.state = "CLOSED";
        this.stateChanges++;
        this.metrics.stateChanges++;
        this.failures = 0;
        this.successes = 0;
        this.halfOpenCalls = 0;
        _logger.logger.info(_logger.LogLevel.INFO, `Circuit Breaker CLOSED: ${this.name}`, {
            successThreshold: this.config.successThreshold
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Verifica si estamos en la ventana de monitoreo
   */ isInMonitoringWindow() {
        const now = Date.now();
        return now - this.lastFailureTime <= this.config.monitoringWindow;
    }
    /**
   * Registra métricas del circuit breaker
   */ async recordMetrics(operation, executionTime) {
        try {
            await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.${operation}`, 1, {
                state: this.state,
                operation
            });
            if (executionTime) {
                await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.execution_time`, executionTime, {
                    state: this.state
                });
            }
            // Métricas de estado
            await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.state_changes`, this.stateChanges);
            await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.failure_rate`, this.metrics.totalCalls > 0 ? this.metrics.failedCalls / this.metrics.totalCalls : 0);
        } catch (error) {
            _logger.logger.error(_logger.LogLevel.ERROR, `Failed to record circuit breaker metrics: ${this.name}`, {
                error: error instanceof Error ? error.message : 'Unknown error'
            }, _logger.LogCategory.SYSTEM);
        }
    }
    /**
   * Obtiene el estado actual del circuit breaker
   */ getState() {
        return this.state;
    }
    /**
   * Obtiene las métricas del circuit breaker
   */ getMetrics() {
        return {
            ...this.metrics,
            state: this.state,
            config: this.config
        };
    }
    /**
   * Fuerza el reset del circuit breaker (solo para testing/admin)
   */ reset() {
        this.state = "CLOSED";
        this.failures = 0;
        this.successes = 0;
        this.halfOpenCalls = 0;
        this.lastFailureTime = 0;
        this.lastSuccessTime = 0;
        _logger.logger.info(_logger.LogLevel.INFO, `Circuit Breaker manually reset: ${this.name}`, {}, _logger.LogCategory.SYSTEM);
    }
}
const mercadoPagoCriticalBreaker = new CircuitBreaker('mercadopago_critical', CIRCUIT_BREAKER_CONFIGS.MERCADOPAGO_CRITICAL);
const mercadoPagoStandardBreaker = new CircuitBreaker('mercadopago_standard', CIRCUIT_BREAKER_CONFIGS.MERCADOPAGO_STANDARD);
const webhookProcessingBreaker = new CircuitBreaker('webhook_processing', CIRCUIT_BREAKER_CONFIGS.WEBHOOK_PROCESSING);
async function executeMercadoPagoCritical(operation) {
    return mercadoPagoCriticalBreaker.execute(operation);
}
async function executeMercadoPagoStandard(operation) {
    return mercadoPagoStandardBreaker.execute(operation);
}
async function executeWebhookProcessing(operation) {
    return webhookProcessingBreaker.execute(operation);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxtZXJjYWRvcGFnb1xcY2lyY3VpdC1icmVha2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBQSU5URVlBIEUtQ09NTUVSQ0UgLSBDSVJDVUlUIEJSRUFLRVIgUEFUVEVSTiBFTlRFUlBSSVNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyBsb2dnZXIsIExvZ0xldmVsLCBMb2dDYXRlZ29yeSB9IGZyb20gJ0AvbGliL2xvZ2dlcic7XG5pbXBvcnQgeyBtZXRyaWNzQ29sbGVjdG9yIH0gZnJvbSAnQC9saWIvbWV0cmljcyc7XG5cbi8vIEVzdGFkb3MgZGVsIENpcmN1aXQgQnJlYWtlclxuZXhwb3J0IGVudW0gQ2lyY3VpdEJyZWFrZXJTdGF0ZSB7XG4gIENMT1NFRCA9ICdDTE9TRUQnLCAgICAgLy8gRnVuY2lvbmFtaWVudG8gbm9ybWFsXG4gIE9QRU4gPSAnT1BFTicsICAgICAgICAgLy8gQ2lyY3VpdG8gYWJpZXJ0bywgcmVjaGF6YSByZXF1ZXN0c1xuICBIQUxGX09QRU4gPSAnSEFMRl9PUEVOJyAvLyBQcm9iYW5kbyBzaSBlbCBzZXJ2aWNpbyBzZSByZWN1cGVyw7Ncbn1cblxuLy8gQ29uZmlndXJhY2nDs24gZGVsIENpcmN1aXQgQnJlYWtlclxuZXhwb3J0IGludGVyZmFjZSBDaXJjdWl0QnJlYWtlckNvbmZpZyB7XG4gIGZhaWx1cmVUaHJlc2hvbGQ6IG51bWJlcjsgICAgICAvLyBOw7ptZXJvIGRlIGZhbGxvcyBwYXJhIGFicmlyIGVsIGNpcmN1aXRvXG4gIHJlY292ZXJ5VGltZW91dDogbnVtYmVyOyAgICAgICAvLyBUaWVtcG8gYW50ZXMgZGUgaW50ZW50YXIgcmVjdXBlcmFjacOzbiAobXMpXG4gIG1vbml0b3JpbmdXaW5kb3c6IG51bWJlcjsgICAgICAvLyBWZW50YW5hIGRlIG1vbml0b3JlbyBwYXJhIGNvbnRhciBmYWxsb3MgKG1zKVxuICBoYWxmT3Blbk1heENhbGxzOiBudW1iZXI7ICAgICAgLy8gTcOheGltbyBkZSBsbGFtYWRhcyBlbiBlc3RhZG8gSEFMRl9PUEVOXG4gIHN1Y2Nlc3NUaHJlc2hvbGQ6IG51bWJlcjsgICAgICAvLyDDiXhpdG9zIG5lY2VzYXJpb3MgcGFyYSBjZXJyYXIgZWwgY2lyY3VpdG9cbn1cblxuLy8gQ29uZmlndXJhY2lvbmVzIHByZWRlZmluaWRhc1xuZXhwb3J0IGNvbnN0IENJUkNVSVRfQlJFQUtFUl9DT05GSUdTID0ge1xuICBNRVJDQURPUEFHT19DUklUSUNBTDoge1xuICAgIGZhaWx1cmVUaHJlc2hvbGQ6IDUsXG4gICAgcmVjb3ZlcnlUaW1lb3V0OiA2MDAwMCwgICAgICAvLyAxIG1pbnV0b1xuICAgIG1vbml0b3JpbmdXaW5kb3c6IDEyMDAwMCwgICAgLy8gMiBtaW51dG9zXG4gICAgaGFsZk9wZW5NYXhDYWxsczogMyxcbiAgICBzdWNjZXNzVGhyZXNob2xkOiAyXG4gIH0sXG4gIE1FUkNBRE9QQUdPX1NUQU5EQVJEOiB7XG4gICAgZmFpbHVyZVRocmVzaG9sZDogMyxcbiAgICByZWNvdmVyeVRpbWVvdXQ6IDMwMDAwLCAgICAgIC8vIDMwIHNlZ3VuZG9zXG4gICAgbW9uaXRvcmluZ1dpbmRvdzogNjAwMDAsICAgICAvLyAxIG1pbnV0b1xuICAgIGhhbGZPcGVuTWF4Q2FsbHM6IDIsXG4gICAgc3VjY2Vzc1RocmVzaG9sZDogMVxuICB9LFxuICBXRUJIT09LX1BST0NFU1NJTkc6IHtcbiAgICBmYWlsdXJlVGhyZXNob2xkOiAxMCxcbiAgICByZWNvdmVyeVRpbWVvdXQ6IDE1MDAwLCAgICAgIC8vIDE1IHNlZ3VuZG9zXG4gICAgbW9uaXRvcmluZ1dpbmRvdzogMzAwMDAsICAgICAvLyAzMCBzZWd1bmRvc1xuICAgIGhhbGZPcGVuTWF4Q2FsbHM6IDUsXG4gICAgc3VjY2Vzc1RocmVzaG9sZDogM1xuICB9XG59IGFzIGNvbnN0O1xuXG4vLyBNw6l0cmljYXMgZGVsIENpcmN1aXQgQnJlYWtlclxuaW50ZXJmYWNlIENpcmN1aXRCcmVha2VyTWV0cmljcyB7XG4gIHRvdGFsQ2FsbHM6IG51bWJlcjtcbiAgc3VjY2Vzc2Z1bENhbGxzOiBudW1iZXI7XG4gIGZhaWxlZENhbGxzOiBudW1iZXI7XG4gIHJlamVjdGVkQ2FsbHM6IG51bWJlcjtcbiAgbGFzdEZhaWx1cmVUaW1lOiBudW1iZXI7XG4gIGxhc3RTdWNjZXNzVGltZTogbnVtYmVyO1xuICBzdGF0ZUNoYW5nZXM6IG51bWJlcjtcbn1cblxuLy8gUmVzdWx0YWRvIGRlIGVqZWN1Y2nDs25cbmV4cG9ydCBpbnRlcmZhY2UgQ2lyY3VpdEJyZWFrZXJSZXN1bHQ8VD4ge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICBkYXRhPzogVDtcbiAgZXJyb3I/OiBFcnJvcjtcbiAgc3RhdGU6IENpcmN1aXRCcmVha2VyU3RhdGU7XG4gIGV4ZWN1dGlvblRpbWU6IG51bWJlcjtcbiAgd2FzUmVqZWN0ZWQ6IGJvb2xlYW47XG59XG5cbi8qKlxuICogQ2lyY3VpdCBCcmVha2VyIEVudGVycHJpc2UgcGFyYSBNZXJjYWRvUGFnb1xuICogSW1wbGVtZW50YSBlbCBwYXRyw7NuIENpcmN1aXQgQnJlYWtlciBjb24gZXN0YWRvcyB5IHJlY3VwZXJhY2nDs24gYXV0b23DoXRpY2FcbiAqL1xuZXhwb3J0IGNsYXNzIENpcmN1aXRCcmVha2VyIHtcbiAgcHJpdmF0ZSBzdGF0ZTogQ2lyY3VpdEJyZWFrZXJTdGF0ZSA9IENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEO1xuICBwcml2YXRlIGZhaWx1cmVzOiBudW1iZXIgPSAwO1xuICBwcml2YXRlIHN1Y2Nlc3NlczogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBsYXN0RmFpbHVyZVRpbWU6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgbGFzdFN1Y2Nlc3NUaW1lOiBudW1iZXIgPSAwO1xuICBwcml2YXRlIGhhbGZPcGVuQ2FsbHM6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgc3RhdGVDaGFuZ2VzOiBudW1iZXIgPSAwO1xuICBwcml2YXRlIG1ldHJpY3M6IENpcmN1aXRCcmVha2VyTWV0cmljcztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIG5hbWU6IHN0cmluZyxcbiAgICBwcml2YXRlIGNvbmZpZzogQ2lyY3VpdEJyZWFrZXJDb25maWdcbiAgKSB7XG4gICAgdGhpcy5tZXRyaWNzID0ge1xuICAgICAgdG90YWxDYWxsczogMCxcbiAgICAgIHN1Y2Nlc3NmdWxDYWxsczogMCxcbiAgICAgIGZhaWxlZENhbGxzOiAwLFxuICAgICAgcmVqZWN0ZWRDYWxsczogMCxcbiAgICAgIGxhc3RGYWlsdXJlVGltZTogMCxcbiAgICAgIGxhc3RTdWNjZXNzVGltZTogMCxcbiAgICAgIHN0YXRlQ2hhbmdlczogMFxuICAgIH07XG5cbiAgICBsb2dnZXIuZGVidWcoTG9nTGV2ZWwuREVCVUcsIGBDaXJjdWl0IEJyZWFrZXIgaW5pdGlhbGl6ZWQ6ICR7bmFtZX1gLCB7XG4gICAgICBjb25maWc6IHRoaXMuY29uZmlnXG4gICAgfSwgTG9nQ2F0ZWdvcnkuU1lTVEVNKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFamVjdXRhIHVuYSBvcGVyYWNpw7NuIHByb3RlZ2lkYSBwb3IgZWwgY2lyY3VpdCBicmVha2VyXG4gICAqL1xuICBhc3luYyBleGVjdXRlPFQ+KG9wZXJhdGlvbjogKCkgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8Q2lyY3VpdEJyZWFrZXJSZXN1bHQ8VD4+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIHRoaXMubWV0cmljcy50b3RhbENhbGxzKys7XG5cbiAgICAvLyBWZXJpZmljYXIgc2kgZGViZW1vcyByZWNoYXphciBsYSBsbGFtYWRhXG4gICAgaWYgKHRoaXMuc2hvdWxkUmVqZWN0KCkpIHtcbiAgICAgIHRoaXMubWV0cmljcy5yZWplY3RlZENhbGxzKys7XG4gICAgICBcbiAgICAgIGF3YWl0IHRoaXMucmVjb3JkTWV0cmljcygncmVqZWN0ZWQnKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBuZXcgRXJyb3IoYENpcmN1aXQgYnJlYWtlciBpcyAke3RoaXMuc3RhdGV9IC0gb3BlcmF0aW9uIHJlamVjdGVkYCksXG4gICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgICBleGVjdXRpb25UaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgICB3YXNSZWplY3RlZDogdHJ1ZVxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gRWplY3V0YXIgbGEgb3BlcmFjacOzblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgb3BlcmF0aW9uKCk7XG4gICAgICBcbiAgICAgIC8vIFJlZ2lzdHJhciDDqXhpdG9cbiAgICAgIGF3YWl0IHRoaXMub25TdWNjZXNzKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgYXdhaXQgdGhpcy5yZWNvcmRNZXRyaWNzKCdzdWNjZXNzJywgZXhlY3V0aW9uVGltZSk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgIHdhc1JlamVjdGVkOiBmYWxzZVxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBSZWdpc3RyYXIgZmFsbG9cbiAgICAgIGF3YWl0IHRoaXMub25GYWlsdXJlKGVycm9yIGFzIEVycm9yKTtcbiAgICAgIFxuICAgICAgY29uc3QgZXhlY3V0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBhd2FpdCB0aGlzLnJlY29yZE1ldHJpY3MoJ2ZhaWx1cmUnLCBleGVjdXRpb25UaW1lKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBhcyBFcnJvcixcbiAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgIHdhc1JlamVjdGVkOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5hIHNpIGRlYmVtb3MgcmVjaGF6YXIgbGEgb3BlcmFjacOzblxuICAgKi9cbiAgcHJpdmF0ZSBzaG91bGRSZWplY3QoKTogYm9vbGVhbiB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcblxuICAgIHN3aXRjaCAodGhpcy5zdGF0ZSkge1xuICAgICAgY2FzZSBDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRDpcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICBjYXNlIENpcmN1aXRCcmVha2VyU3RhdGUuT1BFTjpcbiAgICAgICAgLy8gVmVyaWZpY2FyIHNpIGVzIHRpZW1wbyBkZSBpbnRlbnRhciByZWN1cGVyYWNpw7NuXG4gICAgICAgIGlmIChub3cgLSB0aGlzLmxhc3RGYWlsdXJlVGltZSA+PSB0aGlzLmNvbmZpZy5yZWNvdmVyeVRpbWVvdXQpIHtcbiAgICAgICAgICB0aGlzLnRyYW5zaXRpb25Ub0hhbGZPcGVuKCk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICBjYXNlIENpcmN1aXRCcmVha2VyU3RhdGUuSEFMRl9PUEVOOlxuICAgICAgICAvLyBMaW1pdGFyIGxsYW1hZGFzIGVuIGVzdGFkbyBIQUxGX09QRU5cbiAgICAgICAgcmV0dXJuIHRoaXMuaGFsZk9wZW5DYWxscyA+PSB0aGlzLmNvbmZpZy5oYWxmT3Blbk1heENhbGxzO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1hbmVqYSB1biDDqXhpdG8gZW4gbGEgb3BlcmFjacOzblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBvblN1Y2Nlc3MoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5sYXN0U3VjY2Vzc1RpbWUgPSBEYXRlLm5vdygpO1xuICAgIHRoaXMubWV0cmljcy5zdWNjZXNzZnVsQ2FsbHMrKztcblxuICAgIHN3aXRjaCAodGhpcy5zdGF0ZSkge1xuICAgICAgY2FzZSBDaXJjdWl0QnJlYWtlclN0YXRlLkhBTEZfT1BFTjpcbiAgICAgICAgdGhpcy5zdWNjZXNzZXMrKztcbiAgICAgICAgdGhpcy5oYWxmT3BlbkNhbGxzKys7XG4gICAgICAgIFxuICAgICAgICBpZiAodGhpcy5zdWNjZXNzZXMgPj0gdGhpcy5jb25maWcuc3VjY2Vzc1RocmVzaG9sZCkge1xuICAgICAgICAgIHRoaXMudHJhbnNpdGlvblRvQ2xvc2VkKCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgQ2lyY3VpdEJyZWFrZXJTdGF0ZS5DTE9TRUQ6XG4gICAgICAgIC8vIFJlc2V0IGZhaWx1cmUgY291bnRlciBlbiB2ZW50YW5hIGRlIG1vbml0b3Jlb1xuICAgICAgICBpZiAodGhpcy5pc0luTW9uaXRvcmluZ1dpbmRvdygpKSB7XG4gICAgICAgICAgdGhpcy5mYWlsdXJlcyA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1hbmVqYSB1biBmYWxsbyBlbiBsYSBvcGVyYWNpw7NuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIG9uRmFpbHVyZShlcnJvcjogRXJyb3IpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmxhc3RGYWlsdXJlVGltZSA9IERhdGUubm93KCk7XG4gICAgdGhpcy5tZXRyaWNzLmZhaWxlZENhbGxzKys7XG4gICAgdGhpcy5mYWlsdXJlcysrO1xuXG4gICAgbG9nZ2VyLndhcm4oTG9nTGV2ZWwuV0FSTiwgYENpcmN1aXQgQnJlYWtlciBmYWlsdXJlOiAke3RoaXMubmFtZX1gLCB7XG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICAgIGZhaWx1cmVzOiB0aGlzLmZhaWx1cmVzLFxuICAgICAgc3RhdGU6IHRoaXMuc3RhdGVcbiAgICB9LCBMb2dDYXRlZ29yeS5TWVNURU0pO1xuXG4gICAgc3dpdGNoICh0aGlzLnN0YXRlKSB7XG4gICAgICBjYXNlIENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEOlxuICAgICAgICBpZiAodGhpcy5mYWlsdXJlcyA+PSB0aGlzLmNvbmZpZy5mYWlsdXJlVGhyZXNob2xkKSB7XG4gICAgICAgICAgdGhpcy50cmFuc2l0aW9uVG9PcGVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgQ2lyY3VpdEJyZWFrZXJTdGF0ZS5IQUxGX09QRU46XG4gICAgICAgIHRoaXMudHJhbnNpdGlvblRvT3BlbigpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVHJhbnNpY2nDs24gYSBlc3RhZG8gT1BFTlxuICAgKi9cbiAgcHJpdmF0ZSB0cmFuc2l0aW9uVG9PcGVuKCk6IHZvaWQge1xuICAgIHRoaXMuc3RhdGUgPSBDaXJjdWl0QnJlYWtlclN0YXRlLk9QRU47XG4gICAgdGhpcy5zdGF0ZUNoYW5nZXMrKztcbiAgICB0aGlzLm1ldHJpY3Muc3RhdGVDaGFuZ2VzKys7XG4gICAgdGhpcy5oYWxmT3BlbkNhbGxzID0gMDtcbiAgICB0aGlzLnN1Y2Nlc3NlcyA9IDA7XG5cbiAgICBsb2dnZXIud2FybihMb2dMZXZlbC5XQVJOLCBgQ2lyY3VpdCBCcmVha2VyIE9QRU5FRDogJHt0aGlzLm5hbWV9YCwge1xuICAgICAgZmFpbHVyZXM6IHRoaXMuZmFpbHVyZXMsXG4gICAgICB0aHJlc2hvbGQ6IHRoaXMuY29uZmlnLmZhaWx1cmVUaHJlc2hvbGRcbiAgICB9LCBMb2dDYXRlZ29yeS5TWVNURU0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyYW5zaWNpw7NuIGEgZXN0YWRvIEhBTEZfT1BFTlxuICAgKi9cbiAgcHJpdmF0ZSB0cmFuc2l0aW9uVG9IYWxmT3BlbigpOiB2b2lkIHtcbiAgICB0aGlzLnN0YXRlID0gQ2lyY3VpdEJyZWFrZXJTdGF0ZS5IQUxGX09QRU47XG4gICAgdGhpcy5zdGF0ZUNoYW5nZXMrKztcbiAgICB0aGlzLm1ldHJpY3Muc3RhdGVDaGFuZ2VzKys7XG4gICAgdGhpcy5oYWxmT3BlbkNhbGxzID0gMDtcbiAgICB0aGlzLnN1Y2Nlc3NlcyA9IDA7XG5cbiAgICBsb2dnZXIuaW5mbyhMb2dMZXZlbC5JTkZPLCBgQ2lyY3VpdCBCcmVha2VyIEhBTEYtT1BFTjogJHt0aGlzLm5hbWV9YCwge1xuICAgICAgcmVjb3ZlcnlUaW1lb3V0OiB0aGlzLmNvbmZpZy5yZWNvdmVyeVRpbWVvdXRcbiAgICB9LCBMb2dDYXRlZ29yeS5TWVNURU0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyYW5zaWNpw7NuIGEgZXN0YWRvIENMT1NFRFxuICAgKi9cbiAgcHJpdmF0ZSB0cmFuc2l0aW9uVG9DbG9zZWQoKTogdm9pZCB7XG4gICAgdGhpcy5zdGF0ZSA9IENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEO1xuICAgIHRoaXMuc3RhdGVDaGFuZ2VzKys7XG4gICAgdGhpcy5tZXRyaWNzLnN0YXRlQ2hhbmdlcysrO1xuICAgIHRoaXMuZmFpbHVyZXMgPSAwO1xuICAgIHRoaXMuc3VjY2Vzc2VzID0gMDtcbiAgICB0aGlzLmhhbGZPcGVuQ2FsbHMgPSAwO1xuXG4gICAgbG9nZ2VyLmluZm8oTG9nTGV2ZWwuSU5GTywgYENpcmN1aXQgQnJlYWtlciBDTE9TRUQ6ICR7dGhpcy5uYW1lfWAsIHtcbiAgICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6IHRoaXMuY29uZmlnLnN1Y2Nlc3NUaHJlc2hvbGRcbiAgICB9LCBMb2dDYXRlZ29yeS5TWVNURU0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNpIGVzdGFtb3MgZW4gbGEgdmVudGFuYSBkZSBtb25pdG9yZW9cbiAgICovXG4gIHByaXZhdGUgaXNJbk1vbml0b3JpbmdXaW5kb3coKTogYm9vbGVhbiB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICByZXR1cm4gKG5vdyAtIHRoaXMubGFzdEZhaWx1cmVUaW1lKSA8PSB0aGlzLmNvbmZpZy5tb25pdG9yaW5nV2luZG93O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdHJhIG3DqXRyaWNhcyBkZWwgY2lyY3VpdCBicmVha2VyXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJlY29yZE1ldHJpY3MoXG4gICAgb3BlcmF0aW9uOiAnc3VjY2VzcycgfCAnZmFpbHVyZScgfCAncmVqZWN0ZWQnLFxuICAgIGV4ZWN1dGlvblRpbWU/OiBudW1iZXJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IG1ldHJpY3NDb2xsZWN0b3IucmVjb3JkTWV0cmljKGBjaXJjdWl0X2JyZWFrZXIuJHt0aGlzLm5hbWV9LiR7b3BlcmF0aW9ufWAsIDEsIHtcbiAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICAgIG9wZXJhdGlvblxuICAgICAgfSk7XG5cbiAgICAgIGlmIChleGVjdXRpb25UaW1lKSB7XG4gICAgICAgIGF3YWl0IG1ldHJpY3NDb2xsZWN0b3IucmVjb3JkTWV0cmljKFxuICAgICAgICAgIGBjaXJjdWl0X2JyZWFrZXIuJHt0aGlzLm5hbWV9LmV4ZWN1dGlvbl90aW1lYCxcbiAgICAgICAgICBleGVjdXRpb25UaW1lLFxuICAgICAgICAgIHsgc3RhdGU6IHRoaXMuc3RhdGUgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBNw6l0cmljYXMgZGUgZXN0YWRvXG4gICAgICBhd2FpdCBtZXRyaWNzQ29sbGVjdG9yLnJlY29yZE1ldHJpYyhgY2lyY3VpdF9icmVha2VyLiR7dGhpcy5uYW1lfS5zdGF0ZV9jaGFuZ2VzYCwgdGhpcy5zdGF0ZUNoYW5nZXMpO1xuICAgICAgYXdhaXQgbWV0cmljc0NvbGxlY3Rvci5yZWNvcmRNZXRyaWMoYGNpcmN1aXRfYnJlYWtlci4ke3RoaXMubmFtZX0uZmFpbHVyZV9yYXRlYCwgXG4gICAgICAgIHRoaXMubWV0cmljcy50b3RhbENhbGxzID4gMCA/IHRoaXMubWV0cmljcy5mYWlsZWRDYWxscyAvIHRoaXMubWV0cmljcy50b3RhbENhbGxzIDogMFxuICAgICAgKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoTG9nTGV2ZWwuRVJST1IsIGBGYWlsZWQgdG8gcmVjb3JkIGNpcmN1aXQgYnJlYWtlciBtZXRyaWNzOiAke3RoaXMubmFtZX1gLCB7XG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xuICAgICAgfSwgTG9nQ2F0ZWdvcnkuU1lTVEVNKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogT2J0aWVuZSBlbCBlc3RhZG8gYWN0dWFsIGRlbCBjaXJjdWl0IGJyZWFrZXJcbiAgICovXG4gIGdldFN0YXRlKCk6IENpcmN1aXRCcmVha2VyU3RhdGUge1xuICAgIHJldHVybiB0aGlzLnN0YXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idGllbmUgbGFzIG3DqXRyaWNhcyBkZWwgY2lyY3VpdCBicmVha2VyXG4gICAqL1xuICBnZXRNZXRyaWNzKCk6IENpcmN1aXRCcmVha2VyTWV0cmljcyAmIHsgc3RhdGU6IENpcmN1aXRCcmVha2VyU3RhdGU7IGNvbmZpZzogQ2lyY3VpdEJyZWFrZXJDb25maWcgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRoaXMubWV0cmljcyxcbiAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZ1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRnVlcnphIGVsIHJlc2V0IGRlbCBjaXJjdWl0IGJyZWFrZXIgKHNvbG8gcGFyYSB0ZXN0aW5nL2FkbWluKVxuICAgKi9cbiAgcmVzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5zdGF0ZSA9IENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEO1xuICAgIHRoaXMuZmFpbHVyZXMgPSAwO1xuICAgIHRoaXMuc3VjY2Vzc2VzID0gMDtcbiAgICB0aGlzLmhhbGZPcGVuQ2FsbHMgPSAwO1xuICAgIHRoaXMubGFzdEZhaWx1cmVUaW1lID0gMDtcbiAgICB0aGlzLmxhc3RTdWNjZXNzVGltZSA9IDA7XG5cbiAgICBsb2dnZXIuaW5mbyhMb2dMZXZlbC5JTkZPLCBgQ2lyY3VpdCBCcmVha2VyIG1hbnVhbGx5IHJlc2V0OiAke3RoaXMubmFtZX1gLCB7fSwgTG9nQ2F0ZWdvcnkuU1lTVEVNKTtcbiAgfVxufVxuXG4vLyBJbnN0YW5jaWFzIGdsb2JhbGVzIGRlIGNpcmN1aXQgYnJlYWtlcnNcbmV4cG9ydCBjb25zdCBtZXJjYWRvUGFnb0NyaXRpY2FsQnJlYWtlciA9IG5ldyBDaXJjdWl0QnJlYWtlcihcbiAgJ21lcmNhZG9wYWdvX2NyaXRpY2FsJyxcbiAgQ0lSQ1VJVF9CUkVBS0VSX0NPTkZJR1MuTUVSQ0FET1BBR09fQ1JJVElDQUxcbik7XG5cbmV4cG9ydCBjb25zdCBtZXJjYWRvUGFnb1N0YW5kYXJkQnJlYWtlciA9IG5ldyBDaXJjdWl0QnJlYWtlcihcbiAgJ21lcmNhZG9wYWdvX3N0YW5kYXJkJywgXG4gIENJUkNVSVRfQlJFQUtFUl9DT05GSUdTLk1FUkNBRE9QQUdPX1NUQU5EQVJEXG4pO1xuXG5leHBvcnQgY29uc3Qgd2ViaG9va1Byb2Nlc3NpbmdCcmVha2VyID0gbmV3IENpcmN1aXRCcmVha2VyKFxuICAnd2ViaG9va19wcm9jZXNzaW5nJyxcbiAgQ0lSQ1VJVF9CUkVBS0VSX0NPTkZJR1MuV0VCSE9PS19QUk9DRVNTSU5HXG4pO1xuXG4vKipcbiAqIFdyYXBwZXIgcGFyYSBvcGVyYWNpb25lcyBjcsOtdGljYXMgZGUgTWVyY2Fkb1BhZ29cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVNZXJjYWRvUGFnb0NyaXRpY2FsPFQ+KFxuICBvcGVyYXRpb246ICgpID0+IFByb21pc2U8VD5cbik6IFByb21pc2U8Q2lyY3VpdEJyZWFrZXJSZXN1bHQ8VD4+IHtcbiAgcmV0dXJuIG1lcmNhZG9QYWdvQ3JpdGljYWxCcmVha2VyLmV4ZWN1dGUob3BlcmF0aW9uKTtcbn1cblxuLyoqXG4gKiBXcmFwcGVyIHBhcmEgb3BlcmFjaW9uZXMgZXN0w6FuZGFyIGRlIE1lcmNhZG9QYWdvXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlTWVyY2Fkb1BhZ29TdGFuZGFyZDxUPihcbiAgb3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+XG4pOiBQcm9taXNlPENpcmN1aXRCcmVha2VyUmVzdWx0PFQ+PiB7XG4gIHJldHVybiBtZXJjYWRvUGFnb1N0YW5kYXJkQnJlYWtlci5leGVjdXRlKG9wZXJhdGlvbik7XG59XG5cbi8qKlxuICogV3JhcHBlciBwYXJhIHByb2Nlc2FtaWVudG8gZGUgd2ViaG9va3NcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVXZWJob29rUHJvY2Vzc2luZzxUPihcbiAgb3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+XG4pOiBQcm9taXNlPENpcmN1aXRCcmVha2VyUmVzdWx0PFQ+PiB7XG4gIHJldHVybiB3ZWJob29rUHJvY2Vzc2luZ0JyZWFrZXIuZXhlY3V0ZShvcGVyYXRpb24pO1xufVxuIl0sIm5hbWVzIjpbIkNJUkNVSVRfQlJFQUtFUl9DT05GSUdTIiwiQ2lyY3VpdEJyZWFrZXIiLCJDaXJjdWl0QnJlYWtlclN0YXRlIiwiZXhlY3V0ZU1lcmNhZG9QYWdvQ3JpdGljYWwiLCJleGVjdXRlTWVyY2Fkb1BhZ29TdGFuZGFyZCIsImV4ZWN1dGVXZWJob29rUHJvY2Vzc2luZyIsIm1lcmNhZG9QYWdvQ3JpdGljYWxCcmVha2VyIiwibWVyY2Fkb1BhZ29TdGFuZGFyZEJyZWFrZXIiLCJ3ZWJob29rUHJvY2Vzc2luZ0JyZWFrZXIiLCJNRVJDQURPUEFHT19DUklUSUNBTCIsImZhaWx1cmVUaHJlc2hvbGQiLCJyZWNvdmVyeVRpbWVvdXQiLCJtb25pdG9yaW5nV2luZG93IiwiaGFsZk9wZW5NYXhDYWxscyIsInN1Y2Nlc3NUaHJlc2hvbGQiLCJNRVJDQURPUEFHT19TVEFOREFSRCIsIldFQkhPT0tfUFJPQ0VTU0lORyIsIm5hbWUiLCJjb25maWciLCJzdGF0ZSIsImZhaWx1cmVzIiwic3VjY2Vzc2VzIiwibGFzdEZhaWx1cmVUaW1lIiwibGFzdFN1Y2Nlc3NUaW1lIiwiaGFsZk9wZW5DYWxscyIsInN0YXRlQ2hhbmdlcyIsIm1ldHJpY3MiLCJ0b3RhbENhbGxzIiwic3VjY2Vzc2Z1bENhbGxzIiwiZmFpbGVkQ2FsbHMiLCJyZWplY3RlZENhbGxzIiwibG9nZ2VyIiwiZGVidWciLCJMb2dMZXZlbCIsIkRFQlVHIiwiTG9nQ2F0ZWdvcnkiLCJTWVNURU0iLCJleGVjdXRlIiwib3BlcmF0aW9uIiwic3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsInNob3VsZFJlamVjdCIsInJlY29yZE1ldHJpY3MiLCJzdWNjZXNzIiwiZXJyb3IiLCJFcnJvciIsImV4ZWN1dGlvblRpbWUiLCJ3YXNSZWplY3RlZCIsInJlc3VsdCIsIm9uU3VjY2VzcyIsImRhdGEiLCJvbkZhaWx1cmUiLCJ0cmFuc2l0aW9uVG9IYWxmT3BlbiIsInRyYW5zaXRpb25Ub0Nsb3NlZCIsImlzSW5Nb25pdG9yaW5nV2luZG93Iiwid2FybiIsIldBUk4iLCJtZXNzYWdlIiwidHJhbnNpdGlvblRvT3BlbiIsInRocmVzaG9sZCIsImluZm8iLCJJTkZPIiwibWV0cmljc0NvbGxlY3RvciIsInJlY29yZE1ldHJpYyIsIkVSUk9SIiwiZ2V0U3RhdGUiLCJnZXRNZXRyaWNzIiwicmVzZXQiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0QywwREFBMEQ7QUFDMUQsc0NBQXNDOzs7Ozs7Ozs7Ozs7UUFzQnpC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