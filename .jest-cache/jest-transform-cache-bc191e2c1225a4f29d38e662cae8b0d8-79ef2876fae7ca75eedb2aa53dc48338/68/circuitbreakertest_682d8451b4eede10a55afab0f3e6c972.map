{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\lib\\circuit-breaker.test.ts"],"sourcesContent":["// ===================================\n// PINTEYA E-COMMERCE - CIRCUIT BREAKER TESTS\n// ===================================\n\nimport { \n  CircuitBreaker, \n  CircuitBreakerState, \n  CIRCUIT_BREAKER_CONFIGS,\n  executeMercadoPagoCritical,\n  executeMercadoPagoStandard \n} from '@/lib/mercadopago/circuit-breaker';\n\n// Mock logger\njest.mock('@/lib/logger', () => ({\n  logger: {\n    debug: jest.fn(),\n    info: jest.fn(),\n    warn: jest.fn(),\n    error: jest.fn(),\n  },\n  LogLevel: {\n    DEBUG: 'debug',\n    INFO: 'info',\n    WARN: 'warn',\n    ERROR: 'error',\n  },\n  LogCategory: {\n    SYSTEM: 'system',\n  },\n}));\n\n// Mock metrics collector\njest.mock('@/lib/metrics', () => ({\n  metricsCollector: {\n    recordMetric: jest.fn().mockResolvedValue(undefined),\n  },\n}));\n\ndescribe('Circuit Breaker Enterprise', () => {\n  let circuitBreaker: CircuitBreaker;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    circuitBreaker = new CircuitBreaker('test', {\n      failureThreshold: 3,\n      recoveryTimeout: 1000,\n      monitoringWindow: 5000,\n      halfOpenMaxCalls: 2,\n      successThreshold: 1\n    });\n  });\n\n  describe('Estado CLOSED', () => {\n    test('debe ejecutar operaciones exitosas normalmente', async () => {\n      const mockOperation = jest.fn().mockResolvedValue('success');\n      \n      const result = await circuitBreaker.execute(mockOperation);\n      \n      expect(result.success).toBe(true);\n      expect(result.data).toBe('success');\n      expect(result.state).toBe(CircuitBreakerState.CLOSED);\n      expect(result.wasRejected).toBe(false);\n      expect(mockOperation).toHaveBeenCalledTimes(1);\n    });\n\n    test('debe manejar fallos sin cambiar de estado si no alcanza el umbral', async () => {\n      const mockOperation = jest.fn().mockRejectedValue(new Error('Test error'));\n      \n      // Primer fallo\n      const result1 = await circuitBreaker.execute(mockOperation);\n      expect(result1.success).toBe(false);\n      expect(result1.state).toBe(CircuitBreakerState.CLOSED);\n      \n      // Segundo fallo\n      const result2 = await circuitBreaker.execute(mockOperation);\n      expect(result2.success).toBe(false);\n      expect(result2.state).toBe(CircuitBreakerState.CLOSED);\n      \n      expect(mockOperation).toHaveBeenCalledTimes(2);\n    });\n\n    test('debe cambiar a OPEN cuando alcanza el umbral de fallos', async () => {\n      const mockOperation = jest.fn().mockRejectedValue(new Error('Test error'));\n      \n      // Ejecutar hasta alcanzar el umbral (3 fallos)\n      await circuitBreaker.execute(mockOperation);\n      await circuitBreaker.execute(mockOperation);\n      const result = await circuitBreaker.execute(mockOperation);\n      \n      expect(result.success).toBe(false);\n      expect(result.state).toBe(CircuitBreakerState.OPEN);\n      expect(mockOperation).toHaveBeenCalledTimes(3);\n    });\n  });\n\n  describe('Estado OPEN', () => {\n    beforeEach(async () => {\n      // Forzar el circuit breaker a estado OPEN\n      const mockOperation = jest.fn().mockRejectedValue(new Error('Test error'));\n      await circuitBreaker.execute(mockOperation);\n      await circuitBreaker.execute(mockOperation);\n      await circuitBreaker.execute(mockOperation);\n    });\n\n    test('debe rechazar operaciones inmediatamente', async () => {\n      const mockOperation = jest.fn().mockResolvedValue('success');\n      \n      const result = await circuitBreaker.execute(mockOperation);\n      \n      expect(result.success).toBe(false);\n      expect(result.wasRejected).toBe(true);\n      expect(result.state).toBe(CircuitBreakerState.OPEN);\n      expect(mockOperation).not.toHaveBeenCalled();\n    });\n\n    test('debe transicionar a HALF_OPEN después del timeout de recuperación', async () => {\n      const mockOperation = jest.fn().mockResolvedValue('success');\n      \n      // Esperar el timeout de recuperación\n      await new Promise(resolve => setTimeout(resolve, 1100));\n      \n      const result = await circuitBreaker.execute(mockOperation);\n      \n      expect(result.success).toBe(true);\n      expect(result.state).toBe(CircuitBreakerState.HALF_OPEN);\n      expect(mockOperation).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('Estado HALF_OPEN', () => {\n    beforeEach(async () => {\n      // Forzar a estado OPEN y luego esperar timeout\n      const mockOperation = jest.fn().mockRejectedValue(new Error('Test error'));\n      await circuitBreaker.execute(mockOperation);\n      await circuitBreaker.execute(mockOperation);\n      await circuitBreaker.execute(mockOperation);\n      \n      // Esperar timeout de recuperación\n      await new Promise(resolve => setTimeout(resolve, 1100));\n    });\n\n    test('debe permitir llamadas limitadas', async () => {\n      const mockOperation = jest.fn().mockResolvedValue('success');\n      \n      // Primera llamada exitosa\n      const result1 = await circuitBreaker.execute(mockOperation);\n      expect(result1.success).toBe(true);\n      expect(result1.state).toBe(CircuitBreakerState.CLOSED); // Se cierra inmediatamente con 1 éxito\n      \n      expect(mockOperation).toHaveBeenCalledTimes(1);\n    });\n\n    test('debe volver a OPEN si falla una operación', async () => {\n      const mockOperation = jest.fn().mockRejectedValue(new Error('Test error'));\n      \n      const result = await circuitBreaker.execute(mockOperation);\n      \n      expect(result.success).toBe(false);\n      expect(result.state).toBe(CircuitBreakerState.OPEN);\n      expect(mockOperation).toHaveBeenCalledTimes(1);\n    });\n\n    test('debe rechazar llamadas que excedan el límite', async () => {\n      const mockOperation = jest.fn().mockResolvedValue('success');\n      \n      // Primera llamada exitosa (cierra el circuito)\n      await circuitBreaker.execute(mockOperation);\n      \n      // Forzar de vuelta a HALF_OPEN para probar límite\n      circuitBreaker.reset();\n      const failOperation = jest.fn().mockRejectedValue(new Error('Test error'));\n      await circuitBreaker.execute(failOperation);\n      await circuitBreaker.execute(failOperation);\n      await circuitBreaker.execute(failOperation);\n      \n      await new Promise(resolve => setTimeout(resolve, 1100));\n      \n      // Ahora en HALF_OPEN, probar límite de llamadas\n      await circuitBreaker.execute(mockOperation); // 1ra llamada\n      await circuitBreaker.execute(mockOperation); // 2da llamada (límite)\n      \n      const result = await circuitBreaker.execute(mockOperation); // 3ra llamada (rechazada)\n      expect(result.wasRejected).toBe(true);\n    });\n  });\n\n  describe('Métricas', () => {\n    test('debe registrar métricas correctamente', async () => {\n      const mockOperation = jest.fn().mockResolvedValue('success');\n      \n      await circuitBreaker.execute(mockOperation);\n      \n      const metrics = circuitBreaker.getMetrics();\n      expect(metrics.totalCalls).toBe(1);\n      expect(metrics.successfulCalls).toBe(1);\n      expect(metrics.failedCalls).toBe(0);\n      expect(metrics.rejectedCalls).toBe(0);\n    });\n\n    test('debe actualizar métricas en fallos', async () => {\n      const mockOperation = jest.fn().mockRejectedValue(new Error('Test error'));\n      \n      await circuitBreaker.execute(mockOperation);\n      \n      const metrics = circuitBreaker.getMetrics();\n      expect(metrics.totalCalls).toBe(1);\n      expect(metrics.successfulCalls).toBe(0);\n      expect(metrics.failedCalls).toBe(1);\n      expect(metrics.rejectedCalls).toBe(0);\n    });\n  });\n\n  describe('Configuraciones predefinidas', () => {\n    test('debe tener configuración para MercadoPago crítico', () => {\n      const config = CIRCUIT_BREAKER_CONFIGS.MERCADOPAGO_CRITICAL;\n      \n      expect(config.failureThreshold).toBe(5);\n      expect(config.recoveryTimeout).toBe(60000);\n      expect(config.monitoringWindow).toBe(120000);\n      expect(config.halfOpenMaxCalls).toBe(3);\n      expect(config.successThreshold).toBe(2);\n    });\n\n    test('debe tener configuración para MercadoPago estándar', () => {\n      const config = CIRCUIT_BREAKER_CONFIGS.MERCADOPAGO_STANDARD;\n      \n      expect(config.failureThreshold).toBe(3);\n      expect(config.recoveryTimeout).toBe(30000);\n      expect(config.monitoringWindow).toBe(60000);\n      expect(config.halfOpenMaxCalls).toBe(2);\n      expect(config.successThreshold).toBe(1);\n    });\n\n    test('debe tener configuración para procesamiento de webhooks', () => {\n      const config = CIRCUIT_BREAKER_CONFIGS.WEBHOOK_PROCESSING;\n      \n      expect(config.failureThreshold).toBe(10);\n      expect(config.recoveryTimeout).toBe(15000);\n      expect(config.monitoringWindow).toBe(30000);\n      expect(config.halfOpenMaxCalls).toBe(5);\n      expect(config.successThreshold).toBe(3);\n    });\n  });\n\n  describe('Wrappers de conveniencia', () => {\n    test('executeMercadoPagoCritical debe usar el circuit breaker correcto', async () => {\n      const mockOperation = jest.fn().mockResolvedValue('critical success');\n      \n      const result = await executeMercadoPagoCritical(mockOperation);\n      \n      expect(result.success).toBe(true);\n      expect(result.data).toBe('critical success');\n      expect(mockOperation).toHaveBeenCalledTimes(1);\n    });\n\n    test('executeMercadoPagoStandard debe usar el circuit breaker correcto', async () => {\n      const mockOperation = jest.fn().mockResolvedValue('standard success');\n      \n      const result = await executeMercadoPagoStandard(mockOperation);\n      \n      expect(result.success).toBe(true);\n      expect(result.data).toBe('standard success');\n      expect(mockOperation).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe('Reset manual', () => {\n    test('debe resetear el circuit breaker a estado CLOSED', async () => {\n      // Forzar a estado OPEN\n      const mockOperation = jest.fn().mockRejectedValue(new Error('Test error'));\n      await circuitBreaker.execute(mockOperation);\n      await circuitBreaker.execute(mockOperation);\n      await circuitBreaker.execute(mockOperation);\n      \n      expect(circuitBreaker.getState()).toBe(CircuitBreakerState.OPEN);\n      \n      // Reset manual\n      circuitBreaker.reset();\n      \n      expect(circuitBreaker.getState()).toBe(CircuitBreakerState.CLOSED);\n      \n      const metrics = circuitBreaker.getMetrics();\n      expect(metrics.lastFailureTime).toBe(0);\n      expect(metrics.lastSuccessTime).toBe(0);\n    });\n  });\n});\n"],"names":["jest","mock","logger","debug","fn","info","warn","error","LogLevel","DEBUG","INFO","WARN","ERROR","LogCategory","SYSTEM","metricsCollector","recordMetric","mockResolvedValue","undefined","describe","circuitBreaker","beforeEach","clearAllMocks","CircuitBreaker","failureThreshold","recoveryTimeout","monitoringWindow","halfOpenMaxCalls","successThreshold","test","mockOperation","result","execute","expect","success","toBe","data","state","CircuitBreakerState","CLOSED","wasRejected","toHaveBeenCalledTimes","mockRejectedValue","Error","result1","result2","OPEN","not","toHaveBeenCalled","Promise","resolve","setTimeout","HALF_OPEN","reset","failOperation","metrics","getMetrics","totalCalls","successfulCalls","failedCalls","rejectedCalls","config","CIRCUIT_BREAKER_CONFIGS","MERCADOPAGO_CRITICAL","MERCADOPAGO_STANDARD","WEBHOOK_PROCESSING","executeMercadoPagoCritical","executeMercadoPagoStandard","getState","lastFailureTime","lastSuccessTime"],"mappings":"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"}