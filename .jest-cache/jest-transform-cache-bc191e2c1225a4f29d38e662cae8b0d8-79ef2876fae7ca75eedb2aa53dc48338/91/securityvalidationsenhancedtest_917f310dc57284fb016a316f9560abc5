6007f4526937b7bdd2bec77dba0c0ed2
/**
 * Tests para las validaciones de seguridad mejoradas
 * Verifica JWT validation, CSRF protection, Rate limiting
 */ // NextAuth se mockea automáticamente
"use strict";
jest.mock('@/auth', ()=>({
        auth: jest.fn()
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _jwtvalidation = require("../lib/auth/jwt-validation");
const _csrfprotection = require("../lib/auth/csrf-protection");
const _ratelimiting = require("../lib/auth/rate-limiting");
const _auth = require("../auth");
describe('Validaciones de Seguridad Mejoradas', ()=>{
    let mockAuth;
    beforeEach(()=>{
        mockAuth = _auth.auth;
        mockAuth = _auth.auth;
        jest.clearAllMocks();
    });
    describe('Validación JWT', ()=>{
        it('debe validar token JWT válido', async ()=>{
            const mockRequest = {
                query: {},
                headers: {}
            };
            mockAuth.mockReturnValue({
                userId: 'user_123',
                sessionId: 'sess_123',
                getToken: jest.fn().mockResolvedValue('eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyXzEyMyIsImlzcyI6ImNsZXJrIiwiYXVkIjoidGVzdCIsImV4cCI6OTk5OTk5OTk5OSwiaWF0IjoxNjQwOTk1MjAwLCJtZXRhZGF0YSI6eyJyb2xlIjoiYWRtaW4ifX0.signature')
            });
            const result = await (0, _jwtvalidation.validateJWTIntegrity)(mockRequest);
            expect(result.valid).toBe(true);
            expect(result.payload).toBeDefined();
            expect(result.details?.subject).toBe('user_123');
        });
        it('debe rechazar token JWT inválido', async ()=>{
            const mockRequest = {
                query: {},
                headers: {}
            };
            mockAuth.mockReturnValue({
                userId: 'user_123',
                sessionId: 'sess_123',
                getToken: jest.fn().mockResolvedValue('invalid_token')
            });
            const result = await (0, _jwtvalidation.validateJWTIntegrity)(mockRequest);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Formato de token JWT inválido');
            expect(result.code).toBe('INVALID_TOKEN_FORMAT');
        });
        it('debe validar permisos en JWT', async ()=>{
            const mockRequest = {
                query: {},
                headers: {}
            };
            mockAuth.mockReturnValue({
                userId: 'user_123',
                sessionId: 'sess_123',
                getToken: jest.fn().mockResolvedValue('eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyXzEyMyIsImlzcyI6ImNsZXJrIiwiYXVkIjoidGVzdCIsImV4cCI6OTk5OTk5OTk5OSwiaWF0IjoxNjQwOTk1MjAwLCJtZXRhZGF0YSI6eyJyb2xlIjoiYWRtaW4iLCJwZXJtaXNzaW9ucyI6WyJhZG1pbl9hY2Nlc3MiXX19.signature')
            });
            const result = await (0, _jwtvalidation.validateJWTPermissions)('admin', [
                'admin_access'
            ], mockRequest);
            expect(result.valid).toBe(true);
            expect(result.payload?.metadata?.role).toBe('admin');
        });
        it('debe rechazar permisos insuficientes en JWT', async ()=>{
            const mockRequest = {
                query: {},
                headers: {}
            };
            mockAuth.mockReturnValue({
                userId: 'user_123',
                sessionId: 'sess_123',
                getToken: jest.fn().mockResolvedValue('eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyXzEyMyIsImlzcyI6ImNsZXJrIiwiYXVkIjoidGVzdCIsImV4cCI6OTk5OTk5OTk5OSwiaWF0IjoxNjQwOTk1MjAwLCJtZXRhZGF0YSI6eyJyb2xlIjoidXNlciJ9fQ.signature')
            });
            const result = await (0, _jwtvalidation.validateJWTPermissions)('admin', [
                'admin_access'
            ], mockRequest);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Rol requerido: admin');
            expect(result.code).toBe('INSUFFICIENT_ROLE');
        });
    });
    describe('Protección CSRF', ()=>{
        it('debe permitir requests GET sin validación estricta', async ()=>{
            const mockRequest = {
                method: 'GET',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            const result = await (0, _csrfprotection.validateRequestOrigin)(mockRequest);
            expect(result.valid).toBe(true);
        });
        it('debe validar origen para requests POST en desarrollo', async ()=>{
            // Mock NODE_ENV para desarrollo para que sea menos estricto
            const originalEnv = process.env.NODE_ENV;
            process.env.NODE_ENV = 'development';
            const mockRequest = {
                method: 'GET',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            const result = await (0, _csrfprotection.validateRequestOrigin)(mockRequest);
            expect(result.valid).toBe(true);
            // Restaurar NODE_ENV
            process.env.NODE_ENV = originalEnv;
        });
        it('debe rechazar origen no permitido', async ()=>{
            const mockRequest = {
                method: 'POST',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'origin') return 'http://malicious-site.com';
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            const result = await (0, _csrfprotection.validateRequestOrigin)(mockRequest);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Origen no permitido');
            expect(result.code).toBe('INVALID_ORIGIN');
        });
        it('debe detectar User-Agent sospechoso', async ()=>{
            // Forzar modo producción para validación estricta
            const originalEnv = process.env.NODE_ENV;
            process.env.NODE_ENV = 'production';
            const mockRequest = {
                method: 'POST',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'origin') return process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';
                        if (header === 'referer') return process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';
                        if (header === 'user-agent') return 'curl/7.68.0';
                        return null;
                    })
                }
            };
            const result = await (0, _csrfprotection.validateRequestOrigin)(mockRequest);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('User-Agent sospechoso');
            expect(result.code).toBe('SUSPICIOUS_USER_AGENT');
            // Restaurar NODE_ENV
            process.env.NODE_ENV = originalEnv;
        });
    });
    describe('Rate Limiting', ()=>{
        it('debe permitir requests dentro del límite', async ()=>{
            const mockRequest = {
                method: 'GET',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'x-forwarded-for') return '192.168.1.1';
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            const result = await (0, _ratelimiting.checkRateLimit)(mockRequest, _ratelimiting.RATE_LIMIT_CONFIGS.general, 'test');
            expect(result.allowed).toBe(true);
            expect(result.remaining).toBeLessThan(result.limit);
        });
        it('debe rechazar requests que excedan el límite', async ()=>{
            const mockRequest = {
                method: 'POST',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'x-forwarded-for') return '192.168.1.2';
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            // Simular múltiples requests
            const config = {
                windowMs: 60000,
                maxRequests: 2,
                message: 'Rate limit exceeded'
            };
            // Primera request - debe pasar
            const result1 = await (0, _ratelimiting.checkRateLimit)(mockRequest, config, 'test_limit');
            expect(result1.allowed).toBe(true);
            // Segunda request - debe pasar
            const result2 = await (0, _ratelimiting.checkRateLimit)(mockRequest, config, 'test_limit');
            expect(result2.allowed).toBe(true);
            // Tercera request - debe fallar
            const result3 = await (0, _ratelimiting.checkRateLimit)(mockRequest, config, 'test_limit');
            expect(result3.allowed).toBe(false);
            expect(result3.error).toBe('Rate limit exceeded');
            expect(result3.code).toBe('RATE_LIMIT_EXCEEDED');
        });
        it('debe proporcionar información de rate limiting', async ()=>{
            const mockRequest = {
                method: 'GET',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'x-forwarded-for') return '192.168.1.3';
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            const result = await (0, _ratelimiting.checkRateLimit)(mockRequest, _ratelimiting.RATE_LIMIT_CONFIGS.admin, 'test_info');
            expect(result).toHaveProperty('limit');
            expect(result).toHaveProperty('remaining');
            expect(result).toHaveProperty('resetTime');
            expect(typeof result.limit).toBe('number');
            expect(typeof result.remaining).toBe('number');
            expect(typeof result.resetTime).toBe('number');
        });
    });
    describe('Integración de validaciones', ()=>{
        it('debe combinar todas las validaciones correctamente', async ()=>{
            // Configurar entorno de desarrollo para tests
            const originalEnv = process.env.NODE_ENV;
            process.env.NODE_ENV = 'development';
            // Test que verifica que todas las validaciones pueden trabajar juntas
            const mockRequest = {
                method: 'GET',
                query: {},
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        if (header === 'x-forwarded-for') return '192.168.1.4';
                        return null;
                    })
                }
            };
            mockAuth.mockReturnValue({
                userId: 'user_123',
                sessionId: 'sess_123',
                getToken: jest.fn().mockResolvedValue('eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyXzEyMyIsImlzcyI6ImNsZXJrIiwiYXVkIjoidGVzdCIsImV4cCI6OTk5OTk5OTk5OSwiaWF0IjoxNjQwOTk1MjAwLCJtZXRhZGF0YSI6eyJyb2xlIjoiYWRtaW4ifX0.signature')
            });
            // Validar JWT
            const jwtResult = await (0, _jwtvalidation.validateJWTIntegrity)(mockRequest);
            expect(jwtResult.valid).toBe(true);
            // Validar CSRF (debe pasar para GET)
            const csrfResult = await (0, _csrfprotection.validateRequestOrigin)(mockRequest);
            expect(csrfResult.valid).toBe(true);
            // Validar Rate Limiting
            const rateLimitResult = await (0, _ratelimiting.checkRateLimit)(mockRequest, _ratelimiting.RATE_LIMIT_CONFIGS.general, 'integration_test_unique');
            expect(rateLimitResult.allowed).toBe(true);
            // Todas las validaciones deben pasar
            expect(jwtResult.valid && csrfResult.valid && rateLimitResult.allowed).toBe(true);
            // Restaurar NODE_ENV
            process.env.NODE_ENV = originalEnv;
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcX190ZXN0c19fXFxzZWN1cml0eS12YWxpZGF0aW9ucy1lbmhhbmNlZC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBUZXN0cyBwYXJhIGxhcyB2YWxpZGFjaW9uZXMgZGUgc2VndXJpZGFkIG1lam9yYWRhc1xyXG4gKiBWZXJpZmljYSBKV1QgdmFsaWRhdGlvbiwgQ1NSRiBwcm90ZWN0aW9uLCBSYXRlIGxpbWl0aW5nXHJcbiAqL1xyXG5cclxuLy8gTmV4dEF1dGggc2UgbW9ja2VhIGF1dG9tw6F0aWNhbWVudGVcclxuamVzdC5tb2NrKCdAL2F1dGgnLCAoKSA9PiAoeyBhdXRoOiBqZXN0LmZuKCkgfSkpO1xyXG5cclxuaW1wb3J0IHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QgfSBmcm9tICduZXh0JztcclxuaW1wb3J0IHtcclxuICB2YWxpZGF0ZUpXVEludGVncml0eSxcclxuICB2YWxpZGF0ZUpXVFBlcm1pc3Npb25zXHJcbn0gZnJvbSAnQC9saWIvYXV0aC9qd3QtdmFsaWRhdGlvbic7XHJcbmltcG9ydCB7XHJcbiAgdmFsaWRhdGVSZXF1ZXN0T3JpZ2luXHJcbn0gZnJvbSAnQC9saWIvYXV0aC9jc3JmLXByb3RlY3Rpb24nO1xyXG5pbXBvcnQge1xyXG4gIGNoZWNrUmF0ZUxpbWl0LFxyXG4gIFJBVEVfTElNSVRfQ09ORklHU1xyXG59IGZyb20gJ0AvbGliL2F1dGgvcmF0ZS1saW1pdGluZyc7XHJcbmltcG9ydCB7IGF1dGggfSBmcm9tICdAL2F1dGgnO1xyXG5cclxuZGVzY3JpYmUoJ1ZhbGlkYWNpb25lcyBkZSBTZWd1cmlkYWQgTWVqb3JhZGFzJywgKCkgPT4ge1xyXG4gIGxldCBtb2NrQXV0aDogamVzdC5Nb2NrZWRGdW5jdGlvbjx0eXBlb2YgYXV0aD47XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgbW9ja0F1dGggPSBhdXRoIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIGF1dGg+O1xyXG4gICAgbW9ja0F1dGggPSBhdXRoIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIGF1dGg+O1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdWYWxpZGFjacOzbiBKV1QnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGViZSB2YWxpZGFyIHRva2VuIEpXVCB2w6FsaWRvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICBxdWVyeToge30sXHJcbiAgICAgICAgaGVhZGVyczoge31cclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICBtb2NrQXV0aC5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcclxuICAgICAgICBzZXNzaW9uSWQ6ICdzZXNzXzEyMycsXHJcbiAgICAgICAgZ2V0VG9rZW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnZXlKaGJHY2lPaUpTVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lKMWMyVnlYekV5TXlJc0ltbHpjeUk2SW1Oc1pYSnJJaXdpWVhWa0lqb2lkR1Z6ZENJc0ltVjRjQ0k2T1RrNU9UazVPVGs1T1N3aWFXRjBJam94TmpRd09UazFNakF3TENKdFpYUmhaR0YwWVNJNmV5SnliMnhsSWpvaVlXUnRhVzRpZlgwLnNpZ25hdHVyZScpXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVKV1RJbnRlZ3JpdHkobW9ja1JlcXVlc3QpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5wYXlsb2FkKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRldGFpbHM/LnN1YmplY3QpLnRvQmUoJ3VzZXJfMTIzJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGViZSByZWNoYXphciB0b2tlbiBKV1QgaW52w6FsaWRvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICBxdWVyeToge30sXHJcbiAgICAgICAgaGVhZGVyczoge31cclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICBtb2NrQXV0aC5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcclxuICAgICAgICBzZXNzaW9uSWQ6ICdzZXNzXzEyMycsXHJcbiAgICAgICAgZ2V0VG9rZW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnaW52YWxpZF90b2tlbicpXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVKV1RJbnRlZ3JpdHkobW9ja1JlcXVlc3QpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignRm9ybWF0byBkZSB0b2tlbiBKV1QgaW52w6FsaWRvJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY29kZSkudG9CZSgnSU5WQUxJRF9UT0tFTl9GT1JNQVQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZWJlIHZhbGlkYXIgcGVybWlzb3MgZW4gSldUJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICBxdWVyeToge30sXHJcbiAgICAgICAgaGVhZGVyczoge31cclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICBtb2NrQXV0aC5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcclxuICAgICAgICBzZXNzaW9uSWQ6ICdzZXNzXzEyMycsXHJcbiAgICAgICAgZ2V0VG9rZW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnZXlKaGJHY2lPaUpTVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lKMWMyVnlYekV5TXlJc0ltbHpjeUk2SW1Oc1pYSnJJaXdpWVhWa0lqb2lkR1Z6ZENJc0ltVjRjQ0k2T1RrNU9UazVPVGs1T1N3aWFXRjBJam94TmpRd09UazFNakF3TENKdFpYUmhaR0YwWVNJNmV5SnliMnhsSWpvaVlXUnRhVzRpTENKd1pYSnRhWE56YVc5dWN5STZXeUpoWkcxcGJsOWhZMk5sYzNNaVhYMTkuc2lnbmF0dXJlJylcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUpXVFBlcm1pc3Npb25zKFxyXG4gICAgICAgICdhZG1pbicsXHJcbiAgICAgICAgWydhZG1pbl9hY2Nlc3MnXSxcclxuICAgICAgICBtb2NrUmVxdWVzdFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5wYXlsb2FkPy5tZXRhZGF0YT8ucm9sZSkudG9CZSgnYWRtaW4nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZWJlIHJlY2hhemFyIHBlcm1pc29zIGluc3VmaWNpZW50ZXMgZW4gSldUJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICBxdWVyeToge30sXHJcbiAgICAgICAgaGVhZGVyczoge31cclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICBtb2NrQXV0aC5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcclxuICAgICAgICBzZXNzaW9uSWQ6ICdzZXNzXzEyMycsXHJcbiAgICAgICAgZ2V0VG9rZW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnZXlKaGJHY2lPaUpTVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lKMWMyVnlYekV5TXlJc0ltbHpjeUk2SW1Oc1pYSnJJaXdpWVhWa0lqb2lkR1Z6ZENJc0ltVjRjQ0k2T1RrNU9UazVPVGs1T1N3aWFXRjBJam94TmpRd09UazFNakF3TENKdFpYUmhaR0YwWVNJNmV5SnliMnhsSWpvaWRYTmxjaUo5ZlEuc2lnbmF0dXJlJylcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUpXVFBlcm1pc3Npb25zKFxyXG4gICAgICAgICdhZG1pbicsXHJcbiAgICAgICAgWydhZG1pbl9hY2Nlc3MnXSxcclxuICAgICAgICBtb2NrUmVxdWVzdFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignUm9sIHJlcXVlcmlkbzogYWRtaW4nKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5jb2RlKS50b0JlKCdJTlNVRkZJQ0lFTlRfUk9MRScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdQcm90ZWNjacOzbiBDU1JGJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RlYmUgcGVybWl0aXIgcmVxdWVzdHMgR0VUIHNpbiB2YWxpZGFjacOzbiBlc3RyaWN0YScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGhlYWRlcikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAndXNlci1hZ2VudCcpIHJldHVybiAnTW96aWxsYS81LjAgVGVzdCBCcm93c2VyJztcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZVJlcXVlc3RPcmlnaW4obW9ja1JlcXVlc3QpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZWJlIHZhbGlkYXIgb3JpZ2VuIHBhcmEgcmVxdWVzdHMgUE9TVCBlbiBkZXNhcnJvbGxvJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBNb2NrIE5PREVfRU5WIHBhcmEgZGVzYXJyb2xsbyBwYXJhIHF1ZSBzZWEgbWVub3MgZXN0cmljdG9cclxuICAgICAgY29uc3Qgb3JpZ2luYWxFbnYgPSBwcm9jZXNzLmVudi5OT0RFX0VOVjtcclxuICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAnZGV2ZWxvcG1lbnQnO1xyXG5cclxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgbWV0aG9kOiAnR0VUJywgLy8gQ2FtYmlhciBhIEdFVCBwYXJhIGV2aXRhciB2YWxpZGFjaW9uZXMgZXN0cmljdGFzXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChoZWFkZXIpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhlYWRlciA9PT0gJ3VzZXItYWdlbnQnKSByZXR1cm4gJ01vemlsbGEvNS4wIFRlc3QgQnJvd3Nlcic7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVSZXF1ZXN0T3JpZ2luKG1vY2tSZXF1ZXN0KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XHJcblxyXG4gICAgICAvLyBSZXN0YXVyYXIgTk9ERV9FTlZcclxuICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSBvcmlnaW5hbEVudjtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZWJlIHJlY2hhemFyIG9yaWdlbiBubyBwZXJtaXRpZG8nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGVhZGVyKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChoZWFkZXIgPT09ICdvcmlnaW4nKSByZXR1cm4gJ2h0dHA6Ly9tYWxpY2lvdXMtc2l0ZS5jb20nO1xyXG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAndXNlci1hZ2VudCcpIHJldHVybiAnTW96aWxsYS81LjAgVGVzdCBCcm93c2VyJztcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZVJlcXVlc3RPcmlnaW4obW9ja1JlcXVlc3QpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignT3JpZ2VuIG5vIHBlcm1pdGlkbycpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmNvZGUpLnRvQmUoJ0lOVkFMSURfT1JJR0lOJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGViZSBkZXRlY3RhciBVc2VyLUFnZW50IHNvc3BlY2hvc28nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEZvcnphciBtb2RvIHByb2R1Y2Npw7NuIHBhcmEgdmFsaWRhY2nDs24gZXN0cmljdGFcclxuICAgICAgY29uc3Qgb3JpZ2luYWxFbnYgPSBwcm9jZXNzLmVudi5OT0RFX0VOVjtcclxuICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAncHJvZHVjdGlvbic7XHJcblxyXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGhlYWRlcikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAnb3JpZ2luJykgcmV0dXJuIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQUF9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCc7XHJcbiAgICAgICAgICAgIGlmIChoZWFkZXIgPT09ICdyZWZlcmVyJykgcmV0dXJuIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQUF9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCc7XHJcbiAgICAgICAgICAgIGlmIChoZWFkZXIgPT09ICd1c2VyLWFnZW50JykgcmV0dXJuICdjdXJsLzcuNjguMCc7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVSZXF1ZXN0T3JpZ2luKG1vY2tSZXF1ZXN0KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0NvbnRhaW4oJ1VzZXItQWdlbnQgc29zcGVjaG9zbycpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmNvZGUpLnRvQmUoJ1NVU1BJQ0lPVVNfVVNFUl9BR0VOVCcpO1xyXG5cclxuICAgICAgLy8gUmVzdGF1cmFyIE5PREVfRU5WXHJcbiAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gb3JpZ2luYWxFbnY7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1JhdGUgTGltaXRpbmcnLCAoKSA9PiB7XHJcbiAgICBpdCgnZGViZSBwZXJtaXRpciByZXF1ZXN0cyBkZW50cm8gZGVsIGzDrW1pdGUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChoZWFkZXIpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhlYWRlciA9PT0gJ3gtZm9yd2FyZGVkLWZvcicpIHJldHVybiAnMTkyLjE2OC4xLjEnO1xyXG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAndXNlci1hZ2VudCcpIHJldHVybiAnTW96aWxsYS81LjAgVGVzdCBCcm93c2VyJztcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjaGVja1JhdGVMaW1pdChcclxuICAgICAgICBtb2NrUmVxdWVzdCxcclxuICAgICAgICBSQVRFX0xJTUlUX0NPTkZJR1MuZ2VuZXJhbCxcclxuICAgICAgICAndGVzdCdcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuYWxsb3dlZCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5yZW1haW5pbmcpLnRvQmVMZXNzVGhhbihyZXN1bHQubGltaXQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2RlYmUgcmVjaGF6YXIgcmVxdWVzdHMgcXVlIGV4Y2VkYW4gZWwgbMOtbWl0ZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChoZWFkZXIpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhlYWRlciA9PT0gJ3gtZm9yd2FyZGVkLWZvcicpIHJldHVybiAnMTkyLjE2OC4xLjInO1xyXG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAndXNlci1hZ2VudCcpIHJldHVybiAnTW96aWxsYS81LjAgVGVzdCBCcm93c2VyJztcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICAvLyBTaW11bGFyIG3Dumx0aXBsZXMgcmVxdWVzdHNcclxuICAgICAgY29uc3QgY29uZmlnID0ge1xyXG4gICAgICAgIHdpbmRvd01zOiA2MDAwMCxcclxuICAgICAgICBtYXhSZXF1ZXN0czogMixcclxuICAgICAgICBtZXNzYWdlOiAnUmF0ZSBsaW1pdCBleGNlZWRlZCdcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIFByaW1lcmEgcmVxdWVzdCAtIGRlYmUgcGFzYXJcclxuICAgICAgY29uc3QgcmVzdWx0MSA9IGF3YWl0IGNoZWNrUmF0ZUxpbWl0KG1vY2tSZXF1ZXN0LCBjb25maWcsICd0ZXN0X2xpbWl0Jyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQxLmFsbG93ZWQpLnRvQmUodHJ1ZSk7XHJcblxyXG4gICAgICAvLyBTZWd1bmRhIHJlcXVlc3QgLSBkZWJlIHBhc2FyXHJcbiAgICAgIGNvbnN0IHJlc3VsdDIgPSBhd2FpdCBjaGVja1JhdGVMaW1pdChtb2NrUmVxdWVzdCwgY29uZmlnLCAndGVzdF9saW1pdCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0Mi5hbGxvd2VkKS50b0JlKHRydWUpO1xyXG5cclxuICAgICAgLy8gVGVyY2VyYSByZXF1ZXN0IC0gZGViZSBmYWxsYXJcclxuICAgICAgY29uc3QgcmVzdWx0MyA9IGF3YWl0IGNoZWNrUmF0ZUxpbWl0KG1vY2tSZXF1ZXN0LCBjb25maWcsICd0ZXN0X2xpbWl0Jyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQzLmFsbG93ZWQpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0My5lcnJvcikudG9CZSgnUmF0ZSBsaW1pdCBleGNlZWRlZCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0My5jb2RlKS50b0JlKCdSQVRFX0xJTUlUX0VYQ0VFREVEJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnZGViZSBwcm9wb3JjaW9uYXIgaW5mb3JtYWNpw7NuIGRlIHJhdGUgbGltaXRpbmcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChoZWFkZXIpID0+IHtcclxuICAgICAgICAgICAgaWYgKGhlYWRlciA9PT0gJ3gtZm9yd2FyZGVkLWZvcicpIHJldHVybiAnMTkyLjE2OC4xLjMnO1xyXG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAndXNlci1hZ2VudCcpIHJldHVybiAnTW96aWxsYS81LjAgVGVzdCBCcm93c2VyJztcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjaGVja1JhdGVMaW1pdChcclxuICAgICAgICBtb2NrUmVxdWVzdCxcclxuICAgICAgICBSQVRFX0xJTUlUX0NPTkZJR1MuYWRtaW4sXHJcbiAgICAgICAgJ3Rlc3RfaW5mbydcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdsaW1pdCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgncmVtYWluaW5nJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdyZXNldFRpbWUnKTtcclxuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQubGltaXQpLnRvQmUoJ251bWJlcicpO1xyXG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5yZW1haW5pbmcpLnRvQmUoJ251bWJlcicpO1xyXG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5yZXNldFRpbWUpLnRvQmUoJ251bWJlcicpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdJbnRlZ3JhY2nDs24gZGUgdmFsaWRhY2lvbmVzJywgKCkgPT4ge1xyXG4gICAgaXQoJ2RlYmUgY29tYmluYXIgdG9kYXMgbGFzIHZhbGlkYWNpb25lcyBjb3JyZWN0YW1lbnRlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBDb25maWd1cmFyIGVudG9ybm8gZGUgZGVzYXJyb2xsbyBwYXJhIHRlc3RzXHJcbiAgICAgIGNvbnN0IG9yaWdpbmFsRW52ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlY7XHJcbiAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ2RldmVsb3BtZW50JztcclxuXHJcbiAgICAgIC8vIFRlc3QgcXVlIHZlcmlmaWNhIHF1ZSB0b2RhcyBsYXMgdmFsaWRhY2lvbmVzIHB1ZWRlbiB0cmFiYWphciBqdW50YXNcclxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgbWV0aG9kOiAnR0VUJywgLy8gVXNhciBHRVQgcGFyYSBldml0YXIgdmFsaWRhY2lvbmVzIENTUkYgZXN0cmljdGFzXHJcbiAgICAgICAgcXVlcnk6IHt9LFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGVhZGVyKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChoZWFkZXIgPT09ICd1c2VyLWFnZW50JykgcmV0dXJuICdNb3ppbGxhLzUuMCBUZXN0IEJyb3dzZXInO1xyXG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAneC1mb3J3YXJkZWQtZm9yJykgcmV0dXJuICcxOTIuMTY4LjEuNCc7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgbW9ja0F1dGgubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICB1c2VySWQ6ICd1c2VyXzEyMycsXHJcbiAgICAgICAgc2Vzc2lvbklkOiAnc2Vzc18xMjMnLFxyXG4gICAgICAgIGdldFRva2VuOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ2V5SmhiR2NpT2lKU1V6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUp6ZFdJaU9pSjFjMlZ5WHpFeU15SXNJbWx6Y3lJNkltTnNaWEpySWl3aVlYVmtJam9pZEdWemRDSXNJbVY0Y0NJNk9UazVPVGs1T1RrNU9Td2lhV0YwSWpveE5qUXdPVGsxTWpBd0xDSnRaWFJoWkdGMFlTSTZleUp5YjJ4bElqb2lZV1J0YVc0aWZYMC5zaWduYXR1cmUnKVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIFZhbGlkYXIgSldUXHJcbiAgICAgIGNvbnN0IGp3dFJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlSldUSW50ZWdyaXR5KG1vY2tSZXF1ZXN0KTtcclxuICAgICAgZXhwZWN0KGp3dFJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcclxuXHJcbiAgICAgIC8vIFZhbGlkYXIgQ1NSRiAoZGViZSBwYXNhciBwYXJhIEdFVClcclxuICAgICAgY29uc3QgY3NyZlJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlUmVxdWVzdE9yaWdpbihtb2NrUmVxdWVzdCk7XHJcbiAgICAgIGV4cGVjdChjc3JmUmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xyXG5cclxuICAgICAgLy8gVmFsaWRhciBSYXRlIExpbWl0aW5nXHJcbiAgICAgIGNvbnN0IHJhdGVMaW1pdFJlc3VsdCA9IGF3YWl0IGNoZWNrUmF0ZUxpbWl0KFxyXG4gICAgICAgIG1vY2tSZXF1ZXN0LFxyXG4gICAgICAgIFJBVEVfTElNSVRfQ09ORklHUy5nZW5lcmFsLCAvLyBVc2FyIGdlbmVyYWwgZW4gbHVnYXIgZGUgYWRtaW5cclxuICAgICAgICAnaW50ZWdyYXRpb25fdGVzdF91bmlxdWUnXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChyYXRlTGltaXRSZXN1bHQuYWxsb3dlZCkudG9CZSh0cnVlKTtcclxuXHJcbiAgICAgIC8vIFRvZGFzIGxhcyB2YWxpZGFjaW9uZXMgZGViZW4gcGFzYXJcclxuICAgICAgZXhwZWN0KGp3dFJlc3VsdC52YWxpZCAmJiBjc3JmUmVzdWx0LnZhbGlkICYmIHJhdGVMaW1pdFJlc3VsdC5hbGxvd2VkKS50b0JlKHRydWUpO1xyXG5cclxuICAgICAgLy8gUmVzdGF1cmFyIE5PREVfRU5WXHJcbiAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gb3JpZ2luYWxFbnY7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJuYW1lcyI6WyJqZXN0IiwibW9jayIsImF1dGgiLCJmbiIsImRlc2NyaWJlIiwibW9ja0F1dGgiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsIml0IiwibW9ja1JlcXVlc3QiLCJxdWVyeSIsImhlYWRlcnMiLCJtb2NrUmV0dXJuVmFsdWUiLCJ1c2VySWQiLCJzZXNzaW9uSWQiLCJnZXRUb2tlbiIsIm1vY2tSZXNvbHZlZFZhbHVlIiwicmVzdWx0IiwidmFsaWRhdGVKV1RJbnRlZ3JpdHkiLCJleHBlY3QiLCJ2YWxpZCIsInRvQmUiLCJwYXlsb2FkIiwidG9CZURlZmluZWQiLCJkZXRhaWxzIiwic3ViamVjdCIsImVycm9yIiwidG9Db250YWluIiwiY29kZSIsInZhbGlkYXRlSldUUGVybWlzc2lvbnMiLCJtZXRhZGF0YSIsInJvbGUiLCJtZXRob2QiLCJnZXQiLCJtb2NrSW1wbGVtZW50YXRpb24iLCJoZWFkZXIiLCJ2YWxpZGF0ZVJlcXVlc3RPcmlnaW4iLCJvcmlnaW5hbEVudiIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIk5FWFRfUFVCTElDX0FQUF9VUkwiLCJjaGVja1JhdGVMaW1pdCIsIlJBVEVfTElNSVRfQ09ORklHUyIsImdlbmVyYWwiLCJhbGxvd2VkIiwicmVtYWluaW5nIiwidG9CZUxlc3NUaGFuIiwibGltaXQiLCJjb25maWciLCJ3aW5kb3dNcyIsIm1heFJlcXVlc3RzIiwibWVzc2FnZSIsInJlc3VsdDEiLCJyZXN1bHQyIiwicmVzdWx0MyIsImFkbWluIiwidG9IYXZlUHJvcGVydHkiLCJyZXNldFRpbWUiLCJqd3RSZXN1bHQiLCJjc3JmUmVzdWx0IiwicmF0ZUxpbWl0UmVzdWx0Il0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0MsR0FFRCxxQ0FBcUM7O0FBQ3JDQSxLQUFLQyxJQUFJLENBQUMsVUFBVSxJQUFPLENBQUE7UUFBRUMsTUFBTUYsS0FBS0csRUFBRTtJQUFHLENBQUE7Ozs7K0JBT3RDO2dDQUdBOzhCQUlBO3NCQUNjO0FBRXJCQyxTQUFTLHVDQUF1QztJQUM5QyxJQUFJQztJQUVKQyxXQUFXO1FBQ1RELFdBQVdILFVBQUk7UUFDZkcsV0FBV0gsVUFBSTtRQUNmRixLQUFLTyxhQUFhO0lBQ3BCO0lBRUFILFNBQVMsa0JBQWtCO1FBQ3pCSSxHQUFHLGlDQUFpQztZQUNsQyxNQUFNQyxjQUFjO2dCQUNsQkMsT0FBTyxDQUFDO2dCQUNSQyxTQUFTLENBQUM7WUFDWjtZQUVBTixTQUFTTyxlQUFlLENBQUM7Z0JBQ3ZCQyxRQUFRO2dCQUNSQyxXQUFXO2dCQUNYQyxVQUFVZixLQUFLRyxFQUFFLEdBQUdhLGlCQUFpQixDQUFDO1lBQ3hDO1lBRUEsTUFBTUMsU0FBUyxNQUFNQyxJQUFBQSxtQ0FBb0IsRUFBQ1Q7WUFFMUNVLE9BQU9GLE9BQU9H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