668bb23930fe02eba2ca39665f1d0a9c
/**
 * Tests para las validaciones de seguridad avanzadas
 * Verifica permisos granulares y contexto de seguridad
 */ "use strict";
// NextAuth se mockea automáticamente via moduleNameMapper
// Mock de Supabase
jest.mock('@/lib/supabase', ()=>({
        supabaseAdmin: {
            from: jest.fn(()=>({
                    insert: jest.fn(()=>({
                            error: null
                        })),
                    select: jest.fn(()=>({
                            eq: jest.fn(()=>({
                                    gte: jest.fn(()=>({
                                            not: jest.fn(()=>({
                                                    data: [],
                                                    error: null
                                                }))
                                        }))
                                }))
                        }))
                }))
        }
    }));
jest.mock('@/auth', ()=>({
        auth: mockAuth
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _securityvalidations = require("../lib/auth/security-validations");
// Mock NextAuth
const mockAuth = jest.fn();
describe('Validaciones de Seguridad', ()=>{
    beforeEach(()=>{
        jest.clearAllMocks();
    });
    describe('getPermissionsByRole', ()=>{
        it('debe retornar permisos completos para admin', ()=>{
            const permissions = (0, _securityvalidations.getPermissionsByRole)('admin');
            // Patrón 2: Expectativas específicas para la implementación real
            expect(Array.isArray(permissions)).toBe(true);
            expect(permissions).toContain('delete:products');
            expect(permissions).toContain('write:users');
            expect(permissions).toContain('admin:dashboard');
        });
        it('debe retornar permisos limitados para moderator', ()=>{
            const permissions = (0, _securityvalidations.getPermissionsByRole)('moderator');
            // Patrón 2: Expectativas específicas para la implementación real
            expect(Array.isArray(permissions)).toBe(true);
            expect(permissions).toContain('write:products');
            expect(permissions).toContain('moderate:content');
            expect(permissions).not.toContain('delete:users');
        });
        it('debe retornar permisos básicos para manager', ()=>{
            const permissions = (0, _securityvalidations.getPermissionsByRole)('manager');
            expect(permissions.isAdmin).toBe(false);
            expect(permissions.isModerator).toBe(false);
            expect(permissions.canDeleteProducts).toBe(false);
            expect(permissions.canAccessAdmin).toBe(true);
            expect(permissions.canViewAnalytics).toBe(true);
        });
        it('debe retornar sin permisos para user', ()=>{
            const permissions = (0, _securityvalidations.getPermissionsByRole)('user');
            expect(permissions.isAdmin).toBe(false);
            expect(permissions.canAccessAdmin).toBe(false);
            expect(permissions.canReadProducts).toBe(false);
        });
        it('debe retornar permisos de user para rol desconocido', ()=>{
            const permissions = (0, _securityvalidations.getPermissionsByRole)('unknown_role');
            expect(permissions.isAdmin).toBe(false);
            expect(permissions.canAccessAdmin).toBe(false);
        });
    });
    describe('isValidAdminRole', ()=>{
        it('debe validar roles administrativos', ()=>{
            expect(isValidAdminRole('admin')).toBe(true);
            expect(isValidAdminRole('moderator')).toBe(true);
            expect(isValidAdminRole('manager')).toBe(true);
        });
        it('debe rechazar roles no administrativos', ()=>{
            expect(isValidAdminRole('user')).toBe(false);
            expect(isValidAdminRole('guest')).toBe(false);
            expect(isValidAdminRole('')).toBe(false);
        });
    });
    describe('hasPermission', ()=>{
        it('debe verificar permisos individuales correctamente', ()=>{
            const adminPermissions = (0, _securityvalidations.getPermissionsByRole)('admin');
            const userPermissions = (0, _securityvalidations.getPermissionsByRole)('user');
            expect((0, _securityvalidations.hasPermission)(adminPermissions, 'canDeleteProducts')).toBe(true);
            expect((0, _securityvalidations.hasPermission)(userPermissions, 'canDeleteProducts')).toBe(false);
        });
    });
    describe('hasAnyPermission', ()=>{
        it('debe verificar que al menos un permiso esté presente', ()=>{
            const moderatorPermissions = (0, _securityvalidations.getPermissionsByRole)('moderator');
            expect((0, _securityvalidations.hasAnyPermission)(moderatorPermissions, [
                'canDeleteProducts',
                'canWriteProducts'
            ])).toBe(true);
            expect((0, _securityvalidations.hasAnyPermission)(moderatorPermissions, [
                'canDeleteProducts',
                'canManageUsers'
            ])).toBe(false);
        });
    });
    describe('hasAllPermissions', ()=>{
        it('debe verificar que todos los permisos estén presentes', ()=>{
            const adminPermissions = (0, _securityvalidations.getPermissionsByRole)('admin');
            const moderatorPermissions = (0, _securityvalidations.getPermissionsByRole)('moderator');
            expect((0, _securityvalidations.hasAllPermissions)(adminPermissions, [
                'canReadProducts',
                'canWriteProducts'
            ])).toBe(true);
            expect((0, _securityvalidations.hasAllPermissions)(moderatorPermissions, [
                'canReadProducts',
                'canDeleteProducts'
            ])).toBe(false);
        });
    });
    describe('getSecurityContext', ()=>{
        it('debe obtener contexto de seguridad completo', async ()=>{
            const mockUser = {
                id: 'user_123',
                publicMetadata: {
                    role: 'admin',
                    department: 'IT',
                    isActive: true
                },
                emailAddresses: [
                    {
                        verification: {
                            status: 'verified'
                        }
                    }
                ]
            };
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(mockUser)
                }
            });
            const mockRequest = {
                headers: {
                    get: jest.fn().mockImplementation((key)=>{
                        if (key === 'x-forwarded-for') return '192.168.1.1';
                        if (key === 'user-agent') return 'Test Browser';
                        return null;
                    })
                }
            };
            const context = await getSecurityContext('user_123', mockRequest);
            expect(context).toBeDefined();
            expect(context?.userId).toBe('user_123');
            expect(context?.userRole).toBe('admin');
            expect(context?.permissions.isAdmin).toBe(true);
            expect(context?.metadata.emailVerified).toBe(true);
            expect(context?.ipAddress).toBe('192.168.1.1');
            expect(context?.userAgent).toBe('Test Browser');
        });
        it('debe manejar usuario no encontrado', async ()=>{
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(null)
                }
            });
            const context = await getSecurityContext('user_not_found');
            expect(context).toBeNull();
        });
        it('debe manejar errores de Clerk', async ()=>{
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockRejectedValue(new Error('Clerk error'))
                }
            });
            const context = await getSecurityContext('user_error');
            expect(context).toBeNull();
        });
    });
    describe('validateSecurityContext', ()=>{
        beforeEach(()=>{
            const mockUser = {
                id: 'user_123',
                publicMetadata: {
                    role: 'admin',
                    isActive: true
                },
                emailAddresses: [
                    {
                        verification: {
                            status: 'verified'
                        }
                    }
                ]
            };
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(mockUser)
                }
            });
        });
        it('debe validar contexto exitosamente para admin', async ()=>{
            const result = await validateSecurityContext('user_123', 'PRODUCT_DELETE', [
                'canDeleteProducts'
            ]);
            expect(result.valid).toBe(true);
            expect(result.context).toBeDefined();
            expect(result.context?.permissions.canDeleteProducts).toBe(true);
        });
        it('debe rechazar permisos insuficientes', async ()=>{
            const mockUser = {
                id: 'user_123',
                publicMetadata: {
                    role: 'user',
                    isActive: true
                },
                emailAddresses: [
                    {
                        verification: {
                            status: 'verified'
                        }
                    }
                ]
            };
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(mockUser)
                }
            });
            const result = await validateSecurityContext('user_123', 'PRODUCT_DELETE', [
                'canDeleteProducts'
            ]);
            expect(result.valid).toBe(false);
            expect(result.code).toBe('INSUFFICIENT_PERMISSIONS');
            expect(result.severity).toBe('high');
        });
        it('debe rechazar usuario inactivo', async ()=>{
            const mockUser = {
                id: 'user_123',
                publicMetadata: {
                    role: 'admin',
                    isActive: false
                },
                emailAddresses: [
                    {
                        verification: {
                            status: 'verified'
                        }
                    }
                ]
            };
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(mockUser)
                }
            });
            const result = await validateSecurityContext('user_123', 'PRODUCT_READ', [
                'canReadProducts'
            ]);
            expect(result.valid).toBe(false);
            expect(result.code).toBe('USER_INACTIVE');
            expect(result.severity).toBe('medium');
        });
    });
    describe('validateProductPermissions', ()=>{
        beforeEach(()=>{
            const mockUser = {
                id: 'user_123',
                publicMetadata: {
                    role: 'admin',
                    isActive: true
                },
                emailAddresses: [
                    {
                        verification: {
                            status: 'verified'
                        }
                    }
                ]
            };
            mockClerkClient.mockReturnValue({
                users: {
                    getUser: jest.fn().mockResolvedValue(mockUser)
                }
            });
        });
        it('debe validar permisos de lectura', async ()=>{
            const result = await validateProductPermissions('user_123', 'read');
            expect(result.valid).toBe(true);
        });
        it('debe validar permisos de creación', async ()=>{
            const result = await validateProductPermissions('user_123', 'create');
            expect(result.valid).toBe(true);
        });
        it('debe validar permisos de eliminación', async ()=>{
            const result = await validateProductPermissions('user_123', 'delete');
            expect(result.valid).toBe(true);
        });
    });
    describe('withSecurityValidation wrapper', ()=>{
        it('debe crear wrapper funcional', ()=>{
            const mockHandler = jest.fn();
            const wrappedHandler = withSecurityValidation([
                'canReadProducts'
            ], 'PRODUCT_READ')(mockHandler);
            expect(typeof wrappedHandler).toBe('function');
        });
        it('debe rechazar request sin userId', async ()=>{
            const mockHandler = jest.fn();
            const wrappedHandler = withSecurityValidation([
                'canReadProducts'
            ], 'PRODUCT_READ')(mockHandler);
            const mockRequest = {
                headers: {
                    get: jest.fn().mockReturnValue(null)
                }
            };
            const mockResponse = {
                status: jest.fn().mockReturnThis(),
                json: jest.fn()
            };
            await wrappedHandler(mockRequest, mockResponse);
            expect(mockResponse.status).toHaveBeenCalledWith(401);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                error: 'Usuario no autenticado',
                code: 'AUTH_REQUIRED'
            });
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcX190ZXN0c19fXFxzZWN1cml0eS12YWxpZGF0aW9ucy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgcGFyYSBsYXMgdmFsaWRhY2lvbmVzIGRlIHNlZ3VyaWRhZCBhdmFuemFkYXNcbiAqIFZlcmlmaWNhIHBlcm1pc29zIGdyYW51bGFyZXMgeSBjb250ZXh0byBkZSBzZWd1cmlkYWRcbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QgfSBmcm9tICduZXh0JztcblxuLy8gTmV4dEF1dGggc2UgbW9ja2VhIGF1dG9tw6F0aWNhbWVudGUgdmlhIG1vZHVsZU5hbWVNYXBwZXJcblxuLy8gTW9jayBkZSBTdXBhYmFzZVxuamVzdC5tb2NrKCdAL2xpYi9zdXBhYmFzZScsICgpID0+ICh7XG4gIHN1cGFiYXNlQWRtaW46IHtcbiAgICBmcm9tOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICBpbnNlcnQ6IGplc3QuZm4oKCkgPT4gKHsgZXJyb3I6IG51bGwgfSkpLFxuICAgICAgc2VsZWN0OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgIGVxOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgICAgZ3RlOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgICAgICBub3Q6IGplc3QuZm4oKCkgPT4gKHsgZGF0YTogW10sIGVycm9yOiBudWxsIH0pKVxuICAgICAgICAgIH0pKVxuICAgICAgICB9KSlcbiAgICAgIH0pKVxuICAgIH0pKVxuICB9XG59KSk7XG5cbmltcG9ydCB7XG4gIGdldFBlcm1pc3Npb25zQnlSb2xlLFxuICBoYXNQZXJtaXNzaW9uLFxuICBoYXNBbnlQZXJtaXNzaW9uLFxuICBoYXNBbGxQZXJtaXNzaW9ucyxcbiAgaXNBZG1pbixcbiAgaXNNb2RlcmF0b3IsXG4gIGdldFVzZXJSb2xlLFxuICB2YWxpZGF0ZVJlc291cmNlQWNjZXNzLFxuICBnZXRVc2VyUGVybWlzc2lvbnNcbn0gZnJvbSAnQC9saWIvYXV0aC9zZWN1cml0eS12YWxpZGF0aW9ucyc7XG5cbi8vIE1vY2sgTmV4dEF1dGhcbmNvbnN0IG1vY2tBdXRoID0gamVzdC5mbigpO1xuamVzdC5tb2NrKCdAL2F1dGgnLCAoKSA9PiAoe1xuICBhdXRoOiBtb2NrQXV0aFxufSkpO1xuXG5kZXNjcmliZSgnVmFsaWRhY2lvbmVzIGRlIFNlZ3VyaWRhZCcsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQZXJtaXNzaW9uc0J5Um9sZScsICgpID0+IHtcbiAgICBpdCgnZGViZSByZXRvcm5hciBwZXJtaXNvcyBjb21wbGV0b3MgcGFyYSBhZG1pbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlcm1pc3Npb25zID0gZ2V0UGVybWlzc2lvbnNCeVJvbGUoJ2FkbWluJyk7XG5cbiAgICAgIC8vIFBhdHLDs24gMjogRXhwZWN0YXRpdmFzIGVzcGVjw61maWNhcyBwYXJhIGxhIGltcGxlbWVudGFjacOzbiByZWFsXG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShwZXJtaXNzaW9ucykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMpLnRvQ29udGFpbignZGVsZXRlOnByb2R1Y3RzJyk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMpLnRvQ29udGFpbignd3JpdGU6dXNlcnMnKTtcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucykudG9Db250YWluKCdhZG1pbjpkYXNoYm9hcmQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJldG9ybmFyIHBlcm1pc29zIGxpbWl0YWRvcyBwYXJhIG1vZGVyYXRvcicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlcm1pc3Npb25zID0gZ2V0UGVybWlzc2lvbnNCeVJvbGUoJ21vZGVyYXRvcicpO1xuXG4gICAgICAvLyBQYXRyw7NuIDI6IEV4cGVjdGF0aXZhcyBlc3BlY8OtZmljYXMgcGFyYSBsYSBpbXBsZW1lbnRhY2nDs24gcmVhbFxuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocGVybWlzc2lvbnMpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zKS50b0NvbnRhaW4oJ3dyaXRlOnByb2R1Y3RzJyk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMpLnRvQ29udGFpbignbW9kZXJhdGU6Y29udGVudCcpO1xuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zKS5ub3QudG9Db250YWluKCdkZWxldGU6dXNlcnMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJldG9ybmFyIHBlcm1pc29zIGLDoXNpY29zIHBhcmEgbWFuYWdlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlcm1pc3Npb25zID0gZ2V0UGVybWlzc2lvbnNCeVJvbGUoJ21hbmFnZXInKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zLmlzQWRtaW4pLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zLmlzTW9kZXJhdG9yKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5jYW5EZWxldGVQcm9kdWN0cykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuY2FuQWNjZXNzQWRtaW4pLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuY2FuVmlld0FuYWx5dGljcykudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJldG9ybmFyIHNpbiBwZXJtaXNvcyBwYXJhIHVzZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IGdldFBlcm1pc3Npb25zQnlSb2xlKCd1c2VyJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5pc0FkbWluKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChwZXJtaXNzaW9ucy5jYW5BY2Nlc3NBZG1pbikudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocGVybWlzc2lvbnMuY2FuUmVhZFByb2R1Y3RzKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJldG9ybmFyIHBlcm1pc29zIGRlIHVzZXIgcGFyYSByb2wgZGVzY29ub2NpZG8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IGdldFBlcm1pc3Npb25zQnlSb2xlKCd1bmtub3duX3JvbGUnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zLmlzQWRtaW4pLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHBlcm1pc3Npb25zLmNhbkFjY2Vzc0FkbWluKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2lzVmFsaWRBZG1pblJvbGUnLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgdmFsaWRhciByb2xlcyBhZG1pbmlzdHJhdGl2b3MnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaXNWYWxpZEFkbWluUm9sZSgnYWRtaW4nKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkQWRtaW5Sb2xlKCdtb2RlcmF0b3InKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkQWRtaW5Sb2xlKCdtYW5hZ2VyJykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSByZWNoYXphciByb2xlcyBubyBhZG1pbmlzdHJhdGl2b3MnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoaXNWYWxpZEFkbWluUm9sZSgndXNlcicpKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkQWRtaW5Sb2xlKCdndWVzdCcpKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkQWRtaW5Sb2xlKCcnKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdoYXNQZXJtaXNzaW9uJywgKCkgPT4ge1xuICAgIGl0KCdkZWJlIHZlcmlmaWNhciBwZXJtaXNvcyBpbmRpdmlkdWFsZXMgY29ycmVjdGFtZW50ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGFkbWluUGVybWlzc2lvbnMgPSBnZXRQZXJtaXNzaW9uc0J5Um9sZSgnYWRtaW4nKTtcbiAgICAgIGNvbnN0IHVzZXJQZXJtaXNzaW9ucyA9IGdldFBlcm1pc3Npb25zQnlSb2xlKCd1c2VyJyk7XG5cbiAgICAgIGV4cGVjdChoYXNQZXJtaXNzaW9uKGFkbWluUGVybWlzc2lvbnMsICdjYW5EZWxldGVQcm9kdWN0cycpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGhhc1Blcm1pc3Npb24odXNlclBlcm1pc3Npb25zLCAnY2FuRGVsZXRlUHJvZHVjdHMnKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdoYXNBbnlQZXJtaXNzaW9uJywgKCkgPT4ge1xuICAgIGl0KCdkZWJlIHZlcmlmaWNhciBxdWUgYWwgbWVub3MgdW4gcGVybWlzbyBlc3TDqSBwcmVzZW50ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vZGVyYXRvclBlcm1pc3Npb25zID0gZ2V0UGVybWlzc2lvbnNCeVJvbGUoJ21vZGVyYXRvcicpO1xuXG4gICAgICBleHBlY3QoaGFzQW55UGVybWlzc2lvbihtb2RlcmF0b3JQZXJtaXNzaW9ucywgWydjYW5EZWxldGVQcm9kdWN0cycsICdjYW5Xcml0ZVByb2R1Y3RzJ10pKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGhhc0FueVBlcm1pc3Npb24obW9kZXJhdG9yUGVybWlzc2lvbnMsIFsnY2FuRGVsZXRlUHJvZHVjdHMnLCAnY2FuTWFuYWdlVXNlcnMnXSkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaGFzQWxsUGVybWlzc2lvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgdmVyaWZpY2FyIHF1ZSB0b2RvcyBsb3MgcGVybWlzb3MgZXN0w6luIHByZXNlbnRlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGFkbWluUGVybWlzc2lvbnMgPSBnZXRQZXJtaXNzaW9uc0J5Um9sZSgnYWRtaW4nKTtcbiAgICAgIGNvbnN0IG1vZGVyYXRvclBlcm1pc3Npb25zID0gZ2V0UGVybWlzc2lvbnNCeVJvbGUoJ21vZGVyYXRvcicpO1xuXG4gICAgICBleHBlY3QoaGFzQWxsUGVybWlzc2lvbnMoYWRtaW5QZXJtaXNzaW9ucywgWydjYW5SZWFkUHJvZHVjdHMnLCAnY2FuV3JpdGVQcm9kdWN0cyddKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChoYXNBbGxQZXJtaXNzaW9ucyhtb2RlcmF0b3JQZXJtaXNzaW9ucywgWydjYW5SZWFkUHJvZHVjdHMnLCAnY2FuRGVsZXRlUHJvZHVjdHMnXSkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U2VjdXJpdHlDb250ZXh0JywgKCkgPT4ge1xuICAgIGl0KCdkZWJlIG9idGVuZXIgY29udGV4dG8gZGUgc2VndXJpZGFkIGNvbXBsZXRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAndXNlcl8xMjMnLFxuICAgICAgICBwdWJsaWNNZXRhZGF0YToge1xuICAgICAgICAgIHJvbGU6ICdhZG1pbicsXG4gICAgICAgICAgZGVwYXJ0bWVudDogJ0lUJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbEFkZHJlc3NlczogW3tcbiAgICAgICAgICB2ZXJpZmljYXRpb246IHsgc3RhdHVzOiAndmVyaWZpZWQnIH1cbiAgICAgICAgfV1cbiAgICAgIH07XG5cbiAgICAgIG1vY2tDbGVya0NsaWVudC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB1c2Vyczoge1xuICAgICAgICAgIGdldFVzZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcilcbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5KSA9PiB7XG4gICAgICAgICAgICBpZiAoa2V5ID09PSAneC1mb3J3YXJkZWQtZm9yJykgcmV0dXJuICcxOTIuMTY4LjEuMSc7XG4gICAgICAgICAgICBpZiAoa2V5ID09PSAndXNlci1hZ2VudCcpIHJldHVybiAnVGVzdCBCcm93c2VyJztcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBjb25zdCBjb250ZXh0ID0gYXdhaXQgZ2V0U2VjdXJpdHlDb250ZXh0KCd1c2VyXzEyMycsIG1vY2tSZXF1ZXN0KTtcblxuICAgICAgZXhwZWN0KGNvbnRleHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoY29udGV4dD8udXNlcklkKS50b0JlKCd1c2VyXzEyMycpO1xuICAgICAgZXhwZWN0KGNvbnRleHQ/LnVzZXJSb2xlKS50b0JlKCdhZG1pbicpO1xuICAgICAgZXhwZWN0KGNvbnRleHQ/LnBlcm1pc3Npb25zLmlzQWRtaW4pLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY29udGV4dD8ubWV0YWRhdGEuZW1haWxWZXJpZmllZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChjb250ZXh0Py5pcEFkZHJlc3MpLnRvQmUoJzE5Mi4xNjguMS4xJyk7XG4gICAgICBleHBlY3QoY29udGV4dD8udXNlckFnZW50KS50b0JlKCdUZXN0IEJyb3dzZXInKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIG1hbmVqYXIgdXN1YXJpbyBubyBlbmNvbnRyYWRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NsZXJrQ2xpZW50Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHVzZXJzOiB7XG4gICAgICAgICAgZ2V0VXNlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpXG4gICAgICAgIH1cbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgY29uc3QgY29udGV4dCA9IGF3YWl0IGdldFNlY3VyaXR5Q29udGV4dCgndXNlcl9ub3RfZm91bmQnKTtcblxuICAgICAgZXhwZWN0KGNvbnRleHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSBtYW5lamFyIGVycm9yZXMgZGUgQ2xlcmsnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQ2xlcmtDbGllbnQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgdXNlcnM6IHtcbiAgICAgICAgICBnZXRVc2VyOiBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdDbGVyayBlcnJvcicpKVxuICAgICAgICB9XG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IGNvbnRleHQgPSBhd2FpdCBnZXRTZWN1cml0eUNvbnRleHQoJ3VzZXJfZXJyb3InKTtcblxuICAgICAgZXhwZWN0KGNvbnRleHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZVNlY3VyaXR5Q29udGV4dCcsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgICBpZDogJ3VzZXJfMTIzJyxcbiAgICAgICAgcHVibGljTWV0YWRhdGE6IHtcbiAgICAgICAgICByb2xlOiAnYWRtaW4nLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsQWRkcmVzc2VzOiBbe1xuICAgICAgICAgIHZlcmlmaWNhdGlvbjogeyBzdGF0dXM6ICd2ZXJpZmllZCcgfVxuICAgICAgICB9XVxuICAgICAgfTtcblxuICAgICAgbW9ja0NsZXJrQ2xpZW50Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHVzZXJzOiB7XG4gICAgICAgICAgZ2V0VXNlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKVxuICAgICAgICB9XG4gICAgICB9IGFzIGFueSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSB2YWxpZGFyIGNvbnRleHRvIGV4aXRvc2FtZW50ZSBwYXJhIGFkbWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVTZWN1cml0eUNvbnRleHQoXG4gICAgICAgICd1c2VyXzEyMycsXG4gICAgICAgICdQUk9EVUNUX0RFTEVURScsXG4gICAgICAgIFsnY2FuRGVsZXRlUHJvZHVjdHMnXVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29udGV4dCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29udGV4dD8ucGVybWlzc2lvbnMuY2FuRGVsZXRlUHJvZHVjdHMpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSByZWNoYXphciBwZXJtaXNvcyBpbnN1ZmljaWVudGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAndXNlcl8xMjMnLFxuICAgICAgICBwdWJsaWNNZXRhZGF0YToge1xuICAgICAgICAgIHJvbGU6ICd1c2VyJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbEFkZHJlc3NlczogW3tcbiAgICAgICAgICB2ZXJpZmljYXRpb246IHsgc3RhdHVzOiAndmVyaWZpZWQnIH1cbiAgICAgICAgfV1cbiAgICAgIH07XG5cbiAgICAgIG1vY2tDbGVya0NsaWVudC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB1c2Vyczoge1xuICAgICAgICAgIGdldFVzZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcilcbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZVNlY3VyaXR5Q29udGV4dChcbiAgICAgICAgJ3VzZXJfMTIzJyxcbiAgICAgICAgJ1BST0RVQ1RfREVMRVRFJyxcbiAgICAgICAgWydjYW5EZWxldGVQcm9kdWN0cyddXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29kZSkudG9CZSgnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnNldmVyaXR5KS50b0JlKCdoaWdoJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSByZWNoYXphciB1c3VhcmlvIGluYWN0aXZvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XG4gICAgICAgIGlkOiAndXNlcl8xMjMnLFxuICAgICAgICBwdWJsaWNNZXRhZGF0YToge1xuICAgICAgICAgIHJvbGU6ICdhZG1pbicsXG4gICAgICAgICAgaXNBY3RpdmU6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsQWRkcmVzc2VzOiBbe1xuICAgICAgICAgIHZlcmlmaWNhdGlvbjogeyBzdGF0dXM6ICd2ZXJpZmllZCcgfVxuICAgICAgICB9XVxuICAgICAgfTtcblxuICAgICAgbW9ja0NsZXJrQ2xpZW50Lm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHVzZXJzOiB7XG4gICAgICAgICAgZ2V0VXNlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKVxuICAgICAgICB9XG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlU2VjdXJpdHlDb250ZXh0KFxuICAgICAgICAndXNlcl8xMjMnLFxuICAgICAgICAnUFJPRFVDVF9SRUFEJyxcbiAgICAgICAgWydjYW5SZWFkUHJvZHVjdHMnXVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvZGUpLnRvQmUoJ1VTRVJfSU5BQ1RJVkUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2V2ZXJpdHkpLnRvQmUoJ21lZGl1bScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVQcm9kdWN0UGVybWlzc2lvbnMnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgICAgaWQ6ICd1c2VyXzEyMycsXG4gICAgICAgIHB1YmxpY01ldGFkYXRhOiB7XG4gICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbEFkZHJlc3NlczogW3tcbiAgICAgICAgICB2ZXJpZmljYXRpb246IHsgc3RhdHVzOiAndmVyaWZpZWQnIH1cbiAgICAgICAgfV1cbiAgICAgIH07XG5cbiAgICAgIG1vY2tDbGVya0NsaWVudC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB1c2Vyczoge1xuICAgICAgICAgIGdldFVzZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcilcbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgdmFsaWRhciBwZXJtaXNvcyBkZSBsZWN0dXJhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVQcm9kdWN0UGVybWlzc2lvbnMoJ3VzZXJfMTIzJywgJ3JlYWQnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHZhbGlkYXIgcGVybWlzb3MgZGUgY3JlYWNpw7NuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVQcm9kdWN0UGVybWlzc2lvbnMoJ3VzZXJfMTIzJywgJ2NyZWF0ZScpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgdmFsaWRhciBwZXJtaXNvcyBkZSBlbGltaW5hY2nDs24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZVByb2R1Y3RQZXJtaXNzaW9ucygndXNlcl8xMjMnLCAnZGVsZXRlJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd3aXRoU2VjdXJpdHlWYWxpZGF0aW9uIHdyYXBwZXInLCAoKSA9PiB7XG4gICAgaXQoJ2RlYmUgY3JlYXIgd3JhcHBlciBmdW5jaW9uYWwnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrSGFuZGxlciA9IGplc3QuZm4oKTtcbiAgICAgIGNvbnN0IHdyYXBwZWRIYW5kbGVyID0gd2l0aFNlY3VyaXR5VmFsaWRhdGlvbihbJ2NhblJlYWRQcm9kdWN0cyddLCAnUFJPRFVDVF9SRUFEJykobW9ja0hhbmRsZXIpO1xuXG4gICAgICBleHBlY3QodHlwZW9mIHdyYXBwZWRIYW5kbGVyKS50b0JlKCdmdW5jdGlvbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgcmVjaGF6YXIgcmVxdWVzdCBzaW4gdXNlcklkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0hhbmRsZXIgPSBqZXN0LmZuKCk7XG4gICAgICBjb25zdCB3cmFwcGVkSGFuZGxlciA9IHdpdGhTZWN1cml0eVZhbGlkYXRpb24oWydjYW5SZWFkUHJvZHVjdHMnXSwgJ1BST0RVQ1RfUkVBRCcpKG1vY2tIYW5kbGVyKTtcblxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobnVsbClcbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXNwb25zZSA9IHtcbiAgICAgICAgc3RhdHVzOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAganNvbjogamVzdC5mbigpXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCB3cmFwcGVkSGFuZGxlcihtb2NrUmVxdWVzdCwgbW9ja1Jlc3BvbnNlKTtcblxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMSk7XG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnVXN1YXJpbyBubyBhdXRlbnRpY2FkbycsXG4gICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJ1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJzdXBhYmFzZUFkbWluIiwiZnJvbSIsImZuIiwiaW5zZXJ0IiwiZXJyb3IiLCJzZWxlY3QiLCJlcSIsImd0ZSIsIm5vdCIsImRhdGEiLCJhdXRoIiwibW9ja0F1dGgiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJjbGVhckFsbE1vY2tzIiwiaXQiLCJwZXJtaXNzaW9ucyIsImdldFBlcm1pc3Npb25zQnlSb2xlIiwiZXhwZWN0IiwiQXJyYXkiLCJpc0FycmF5IiwidG9CZSIsInRvQ29udGFpbiIsImlzQWRtaW4iLCJpc01vZGVyYXRvciIsImNhbkRlbGV0ZVByb2R1Y3RzIiwiY2FuQWNjZXNzQWRtaW4iLCJjYW5WaWV3QW5hbHl0aWNzIiwiY2FuUmVhZFByb2R1Y3RzIiwiaXNWYWxpZEFkbWluUm9sZSIsImFkbWluUGVybWlzc2lvbnMiLCJ1c2VyUGVybWlzc2lvbnMiLCJoYXNQZXJtaXNzaW9uIiwibW9kZXJhdG9yUGVybWlzc2lvbnMiLCJoYXNBbnlQZXJtaXNzaW9uIiwiaGFzQWxsUGVybWlzc2lvbnMiLCJtb2NrVXNlciIsImlkIiwicHVibGljTWV0YWRhdGEiLCJyb2xlIiwiZGVwYXJ0bWVudCIsImlzQWN0aXZlIiwiZW1haWxBZGRyZXNzZXMiLCJ2ZXJpZmljYXRpb24iLCJzdGF0dXMiLCJtb2NrQ2xlcmtDbGllbnQiLCJtb2NrUmV0dXJuVmFsdWUiLCJ1c2VycyIsImdldFVzZXIiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsIm1vY2tSZXF1ZXN0IiwiaGVhZGVycyIsImdldCIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsImtleSIsImNvbnRleHQiLCJnZXRTZWN1cml0eUNvbnRleHQiLCJ0b0JlRGVmaW5lZCIsInVzZXJJZCIsInVzZXJSb2xlIiwibWV0YWRhdGEiLCJlbWFpbFZlcmlmaWVkIiwiaXBBZGRyZXNzIiwidXNlckFnZW50IiwidG9CZU51bGwiLCJtb2NrUmVqZWN0ZWRWYWx1ZSIsIkVycm9yIiwicmVzdWx0IiwidmFsaWRhdGVTZWN1cml0eUNvbnRleHQiLCJ2YWxpZCIsImNvZGUiLCJzZXZlcml0eSIsInZhbGlkYXRlUHJvZHVjdFBlcm1pc3Npb25zIiwibW9ja0hhbmRsZXIiLCJ3cmFwcGVkSGFuZGxlciIsIndpdGhTZWN1cml0eVZhbGlkYXRpb24iLCJtb2NrUmVzcG9uc2UiLCJtb2NrUmV0dXJuVGhpcyIsImpzb24iLCJ0b0hhdmVCZWVuQ2FsbGVkV2l0aCIsInN1Y2Nlc3MiXSwibWFwcGluZ3MiOiJBQUFBOzs7Q0FHQztBQUtELDBEQUEwRDtBQUUxRCxtQkFBbUI7QUFDbkJBLEtBQUtDLElBQUksQ0FBQyxrQkFBa0IsSUFBTyxDQUFBO1FBQ2pDQyxlQUFlO1lBQ2JDLE1BQU1ILEtBQUtJLEVBQUUsQ0FBQyxJQUFPLENBQUE7b0JBQ25CQyxRQUFRTCxLQUFL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