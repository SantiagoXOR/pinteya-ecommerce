{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\components\\Common\\CartSidebarModal\\index.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { useEffect, useState } from \"react\";\r\n\r\nimport { useCartModalContext } from \"@/app/context/CartSidebarModalContext\";\r\nimport { selectTotalPrice } from \"@/redux/features/cart-slice\";\r\nimport { useAppSelector } from \"@/redux/store\";\r\nimport { useSelector } from \"react-redux\";\r\nimport SingleItem from \"./SingleItem\";\r\nimport Link from \"next/link\";\r\nimport EmptyCart from \"./EmptyCart\";\r\nimport ShippingProgressBar from \"@/components/ui/shipping-progress-bar\";\r\nimport Image from \"next/image\";\r\nimport CheckoutTransitionAnimation from \"@/components/ui/checkout-transition-animation\";\r\nimport useCheckoutTransition from \"@/hooks/useCheckoutTransition\";\r\nimport { useCartWithBackend } from \"@/hooks/useCartWithBackend\";\r\n\r\nconst CartSidebarModal = () => {\r\n  const { isCartModalOpen, closeCartModal } = useCartModalContext();\r\n  const cartItems = useAppSelector((state) => state.cartReducer.items);\r\n\r\n  // Hook para carrito con backend\r\n  const {\r\n    items: backendCartItems,\r\n    totalItems: backendTotalItems,\r\n    totalAmount: backendTotalAmount,\r\n    loading: cartLoading\r\n  } = useCartWithBackend();\r\n\r\n  const totalPrice = useSelector(selectTotalPrice);\r\n\r\n  // Usar carrito del backend si está disponible, sino usar Redux\r\n  const effectiveCartItems = backendCartItems.length > 0 ? backendCartItems : cartItems;\r\n  const effectiveTotalPrice = backendCartItems.length > 0 ? backendTotalAmount : totalPrice;\r\n  const hasItems = effectiveCartItems.length > 0;\r\n\r\n  // Hook para manejar la animación de transición al checkout\r\n  const {\r\n    isTransitioning,\r\n    startTransition,\r\n    skipAnimation,\r\n    isButtonDisabled,\r\n  } = useCheckoutTransition({\r\n    onTransitionStart: () => {\r\n      // Cerrar el modal con animación de deslizamiento\r\n      closeCartModal();\r\n    },\r\n    onTransitionComplete: () => {\r\n      // La navegación se maneja automáticamente en el componente de animación\r\n    },\r\n  });\r\n\r\n  useEffect(() => {\r\n    // closing modal while clicking outside\r\n    function handleClickOutside(event: MouseEvent) {\r\n      if (event.target && !(event.target as Element).closest(\".modal-content\")) {\r\n        closeCartModal();\r\n      }\r\n    }\r\n\r\n    if (isCartModalOpen) {\r\n      document.addEventListener(\"mousedown\", handleClickOutside);\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, [isCartModalOpen, closeCartModal]);\r\n\r\n  return (\r\n    <div\r\n      className={`fixed top-0 left-0 z-99999 overflow-y-auto no-scrollbar w-full h-screen bg-dark/70 transition-all duration-500 ease-out ${\r\n        isCartModalOpen ? \"translate-x-0 opacity-100\" : \"translate-x-full opacity-0\"\r\n      }`}\r\n    >\r\n      <div className=\"flex items-center justify-end\">\r\n        <div className={`w-full max-w-[500px] shadow-1 bg-white px-4 sm:px-7.5 lg:px-11 relative modal-content transition-transform duration-500 ease-out ${\r\n          isCartModalOpen ? \"translate-x-0\" : \"translate-x-full\"\r\n        }`}>\r\n          <div className=\"sticky top-0 bg-white z-20 flex items-center justify-between py-4 border-b border-gray-200 shadow-sm\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"bg-gradient-to-r from-orange-500 to-yellow-500 p-2 rounded-full\">\r\n                <svg className=\"w-5 h-5 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                  <path d=\"M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z\"/>\r\n                </svg>\r\n              </div>\r\n              <div>\r\n                <h2 className=\"font-bold text-lg\" style={{ color: '#ea5a17' }}>\r\n                  🛒 Tu Selección\r\n                </h2>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  {cartItems.length} {cartItems.length === 1 ? 'producto' : 'productos'} listos\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={() => closeCartModal()}\r\n              aria-label=\"Cerrar carrito\"\r\n              className=\"flex items-center justify-center p-2 rounded-full hover:bg-gray-100 transition-colors duration-150\"\r\n            >\r\n              <svg\r\n                className=\"w-6 h-6 text-gray-400 hover:text-gray-600\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"flex-1 overflow-y-auto no-scrollbar pt-4\">\r\n            <div className=\"flex flex-col gap-4 px-1\">\r\n              {/* <!-- cart item --> */}\r\n              {cartItems.length > 0 ? (\r\n                cartItems.map((item: any, key: number) => (\r\n                  <SingleItem key={key} item={item} />\r\n                ))\r\n              ) : (\r\n                <EmptyCart />\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"border-t border-gray-200 bg-white pt-3 pb-3 mt-4 sticky bottom-0\">\r\n            {/* Barra de Progreso Envío Gratis */}\r\n            {cartItems.length > 0 && (\r\n              <div className=\"mb-3\">\r\n                <ShippingProgressBar\r\n                  currentAmount={totalPrice}\r\n                  variant=\"compact\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* Subtotal */}\r\n            <div className=\"flex items-center justify-between gap-3 mb-3\">\r\n              <p className=\"font-bold text-lg text-gray-900\">Subtotal:</p>\r\n              <p className=\"font-bold text-lg\" style={{ color: '#ea5a17' }}>\r\n                ${totalPrice.toLocaleString()}\r\n              </p>\r\n            </div>\r\n\r\n            {/* Información de pago */}\r\n            <div className=\"space-y-2\">\r\n              {/* Línea informativa de MercadoPago - 150px */}\r\n              <div className=\"w-full flex items-center justify-center gap-2 py-1 px-2 text-sm text-gray-600\">\r\n                <Image\r\n                  src=\"/images/logo/MercadoPagoLogos/SVGs/MP_RGB_HANDSHAKE_color_horizontal.svg\"\r\n                  alt=\"MercadoPago\"\r\n                  width={150}\r\n                  height={48}\r\n                  className=\"w-auto h-auto max-w-[150px]\"\r\n                />\r\n                <span className=\"font-medium\">Pago seguro</span>\r\n              </div>\r\n\r\n              {/* Botón principal de checkout */}\r\n              <button\r\n                onClick={startTransition}\r\n                disabled={isButtonDisabled || !hasItems || cartLoading}\r\n                data-testid=\"checkout-btn\"\r\n                className={`w-full flex justify-center font-bold text-black bg-yellow-400 hover:bg-yellow-500 py-3 px-4 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl ${\r\n                  isButtonDisabled || !hasItems || cartLoading\r\n                    ? 'opacity-50 cursor-not-allowed'\r\n                    : 'hover:scale-105 active:scale-95'\r\n                }`}\r\n              >\r\n                {cartLoading ? 'Cargando carrito...' : isButtonDisabled ? 'Procesando...' : 'Finalizar Compra'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Componente de animación de transición */}\r\n      <CheckoutTransitionAnimation\r\n        isActive={isTransitioning}\r\n        skipAnimation={skipAnimation}\r\n        onComplete={() => {\r\n          // Callback adicional si es necesario\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CartSidebarModal;\r\n"],"names":["CartSidebarModal","isCartModalOpen","closeCartModal","useCartModalContext","cartItems","useAppSelector","state","cartReducer","items","backendCartItems","totalItems","backendTotalItems","totalAmount","backendTotalAmount","loading","cartLoading","useCartWithBackend","totalPrice","useSelector","selectTotalPrice","effectiveCartItems","length","effectiveTotalPrice","hasItems","isTransitioning","startTransition","skipAnimation","isButtonDisabled","useCheckoutTransition","onTransitionStart","onTransitionComplete","useEffect","handleClickOutside","event","target","closest","document","addEventListener","removeEventListener","div","className","svg","fill","viewBox","path","d","h2","style","color","p","button","onClick","aria-label","stroke","strokeLinecap","strokeLinejoin","strokeWidth","map","item","key","SingleItem","EmptyCart","ShippingProgressBar","currentAmount","variant","toLocaleString","Image","src","alt","width","height","span","disabled","data-testid","CheckoutTransitionAnimation","isActive","onComplete"],"mappings":"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"}