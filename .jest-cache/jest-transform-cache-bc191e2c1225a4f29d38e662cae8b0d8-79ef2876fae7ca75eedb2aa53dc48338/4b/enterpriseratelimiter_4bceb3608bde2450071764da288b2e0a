59a6fd93c45e41d763954145ed659f7f
/**
 * Sistema Enterprise de Rate Limiting
 * Unifica todas las implementaciones de rate limiting con Redis y fallback en memoria
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get ENTERPRISE_RATE_LIMIT_CONFIGS () {
        return ENTERPRISE_RATE_LIMIT_CONFIGS;
    },
    get checkEnterpriseRateLimit () {
        return checkEnterpriseRateLimit;
    },
    get endpointKeyGenerator () {
        return endpointKeyGenerator;
    },
    get hybridKeyGenerator () {
        return hybridKeyGenerator;
    },
    get ipKeyGenerator () {
        return ipKeyGenerator;
    },
    get memoryStore () {
        return memoryStore;
    },
    get metricsCollector () {
        return metricsCollector;
    },
    get userKeyGenerator () {
        return userKeyGenerator;
    }
});
const _redis = require("../redis");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const ENTERPRISE_RATE_LIMIT_CONFIGS = {
    // Autenticación crítica
    CRITICAL_AUTH: {
        windowMs: 15 * 60 * 1000,
        maxRequests: 3,
        message: 'Demasiados intentos de autenticación crítica. Intenta en 15 minutos.',
        enableRedis: true,
        enableMetrics: true,
        enableLogging: true
    },
    // Admin APIs
    ADMIN_API: {
        windowMs: 5 * 60 * 1000,
        maxRequests: 50,
        message: 'Límite de requests administrativas excedido. Intenta en 5 minutos.',
        enableRedis: true,
        enableMetrics: true,
        enableLogging: true
    },
    // APIs de pagos
    PAYMENT_API: {
        windowMs: 10 * 60 * 1000,
        maxRequests: 15,
        message: 'Límite de requests de pagos excedido. Intenta en 10 minutos.',
        enableRedis: true,
        enableMetrics: true,
        enableLogging: true,
        onLimitReached: (key, request)=>{
            console.warn(`[PAYMENT_RATE_LIMIT] Límite excedido para ${key}`);
        }
    },
    // APIs públicas de productos
    PUBLIC_API: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 100,
        message: 'Límite de requests públicas excedido. Intenta en 1 minuto.',
        enableRedis: true,
        enableMetrics: true,
        enableLogging: false // No loggear APIs públicas
    },
    // Webhooks
    WEBHOOK_API: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 200,
        message: 'Límite de webhooks excedido.',
        enableRedis: true,
        enableMetrics: true,
        enableLogging: true
    },
    // Búsquedas y consultas
    SEARCH_API: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 60,
        message: 'Límite de búsquedas excedido. Intenta en 1 minuto.',
        enableRedis: true,
        enableMetrics: true,
        enableLogging: false
    },
    // Upload de archivos
    UPLOAD_API: {
        windowMs: 5 * 60 * 1000,
        maxRequests: 10,
        message: 'Límite de uploads excedido. Intenta en 5 minutos.',
        enableRedis: true,
        enableMetrics: true,
        enableLogging: true
    },
    // APIs de desarrollo/debug
    DEBUG_API: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 30,
        message: 'Límite de debug APIs excedido.',
        enableRedis: false,
        enableMetrics: true,
        enableLogging: true
    }
};
function ipKeyGenerator(request) {
    const ip = getClientIP(request);
    return `ip:${ip}`;
}
function userKeyGenerator(request) {
    // Intentar obtener user ID de diferentes fuentes
    const userId = getUserId(request);
    const ip = getClientIP(request);
    return userId ? `user:${userId}` : `ip:${ip}`;
}
function endpointKeyGenerator(request) {
    const ip = getClientIP(request);
    const endpoint = getEndpoint(request);
    return `endpoint:${ip}:${endpoint}`;
}
function hybridKeyGenerator(request) {
    const userId = getUserId(request);
    const ip = getClientIP(request);
    const endpoint = getEndpoint(request);
    const userPart = userId ? `user:${userId}` : `ip:${ip}`;
    return `${userPart}:${endpoint}`;
}
// =====================================================
// UTILIDADES
// =====================================================
/**
 * Obtiene la IP del cliente
 */ function getClientIP(request) {
    // Intentar diferentes headers de IP
    const headers = [
        'x-forwarded-for',
        'x-real-ip',
        'x-client-ip',
        'cf-connecting-ip'
    ];
    for (const header of headers){
        let ip = null;
        if ('headers' in request && typeof request.headers.get === 'function') {
            // NextRequest
            ip = request.headers.get(header);
        } else if ('headers' in request) {
            // NextApiRequest
            const headerValue = request.headers[header];
            ip = Array.isArray(headerValue) ? headerValue[0] : headerValue || null;
        }
        if (ip) {
            // Tomar la primera IP si hay múltiples
            return ip.split(',')[0].trim();
        }
    }
    return 'unknown';
}
/**
 * Obtiene el ID del usuario autenticado
 */ function getUserId(request) {
    // Intentar obtener de diferentes fuentes
    // 1. Headers de Clerk
    let userId = null;
    if ('headers' in request && typeof request.headers.get === 'function') {
        // NextRequest
        userId = request.headers.get('x-clerk-user-id');
    } else if ('headers' in request) {
        // NextApiRequest
        const headerValue = request.headers['x-clerk-user-id'];
        userId = Array.isArray(headerValue) ? headerValue[0] : headerValue || null;
    }
    // 2. Contexto enterprise si está disponible
    if (!userId && request.enterpriseAuth?.userId) {
        userId = request.enterpriseAuth.userId;
    }
    // 3. Contexto de autenticación si está disponible
    if (!userId && request.auth?.userId) {
        userId = request.auth.userId;
    }
    return userId;
}
/**
 * Obtiene el endpoint de la request
 */ function getEndpoint(request) {
    if ('nextUrl' in request) {
        // NextRequest
        return request.nextUrl.pathname;
    } else if ('url' in request) {
        // NextApiRequest
        try {
            const url = new URL(request.url || '', 'http://localhost');
            return url.pathname;
        } catch  {
            return '/unknown';
        }
    }
    return '/unknown';
}
class MemoryRateLimitStore {
    constructor(){
        this.store = new Map();
        // Limpiar entradas expiradas cada 5 minutos
        this.cleanupInterval = setInterval(()=>{
            this.cleanup();
        }, 5 * 60 * 1000);
    }
    get(key) {
        const entry = this.store.get(key);
        if (!entry) {
            return null;
        }
        // Verificar si ha expirado
        if (Date.now() > entry.resetTime) {
            this.store.delete(key);
            return null;
        }
        return entry;
    }
    set(key, entry) {
        this.store.set(key, entry);
    }
    increment(key) {
        const entry = this.get(key);
        if (entry) {
            entry.count++;
            this.set(key, entry);
            return entry.count;
        }
        return 0;
    }
    cleanup() {
        const now = Date.now();
        let cleaned = 0;
        for (const [key, entry] of this.store.entries()){
            if (now > entry.resetTime) {
                this.store.delete(key);
                cleaned++;
            }
        }
        if (cleaned > 0) {
            console.log(`[MEMORY_RATE_LIMIT] Limpiadas ${cleaned} entradas expiradas`);
        }
    }
    getStats() {
        const entries = this.store.size;
        const memoryUsage = JSON.stringify([
            ...this.store.entries()
        ]).length;
        return {
            entries,
            memoryUsage
        };
    }
    clear() {
        this.store.clear();
    }
    destroy() {
        if (this.cleanupInterval) {
            clearInterval(this.cleanupInterval);
        }
        this.store.clear();
    }
}
// Instancia global del store en memoria
const memoryStore = new MemoryRateLimitStore();
// =====================================================
// MÉTRICAS GLOBALES
// =====================================================
class RateLimitMetricsCollector {
    recordRequest(result, ip, endpoint) {
        this.metrics.totalRequests++;
        if (result.allowed) {
            this.metrics.allowedRequests++;
        } else {
            this.metrics.blockedRequests++;
            // Registrar IP bloqueada
            const currentCount = this.blockedIPs.get(ip) || 0;
            this.blockedIPs.set(ip, currentCount + 1);
        }
        // Registrar fuente
        if (result.source === 'redis') {
            this.metrics.redisHits++;
        } else if (result.source === 'memory') {
            this.metrics.memoryFallbacks++;
        } else if (result.source === 'error') {
            this.metrics.errors++;
        }
        // Registrar tiempo de respuesta
        if (result.metrics?.responseTime) {
            this.responseTimes.push(result.metrics.responseTime);
            // Mantener solo los últimos 1000 tiempos
            if (this.responseTimes.length > 1000) {
                this.responseTimes = this.responseTimes.slice(-1000);
            }
            // Calcular promedio
            this.metrics.averageResponseTime = this.responseTimes.reduce((a, b)=>a + b, 0) / this.responseTimes.length;
        }
        // Registrar endpoint
        const endpointCount = this.endpointCounts.get(endpoint) || 0;
        this.endpointCounts.set(endpoint, endpointCount + 1);
        // Actualizar tops
        this.updateTopLists();
    }
    updateTopLists() {
        // Top IPs bloqueadas
        this.metrics.topBlockedIPs = Array.from(this.blockedIPs.entries()).sort((a, b)=>b[1] - a[1]).slice(0, 10).map(([ip, count])=>({
                ip,
                count
            }));
        // Top endpoints
        this.metrics.topEndpoints = Array.from(this.endpointCounts.entries()).sort((a, b)=>b[1] - a[1]).slice(0, 10).map(([endpoint, count])=>({
                endpoint,
                count
            }));
    }
    getMetrics() {
        return {
            ...this.metrics
        };
    }
    reset() {
        this.metrics = {
            totalRequests: 0,
            allowedRequests: 0,
            blockedRequests: 0,
            redisHits: 0,
            memoryFallbacks: 0,
            errors: 0,
            averageResponseTime: 0,
            topBlockedIPs: [],
            topEndpoints: []
        };
        this.responseTimes = [];
        this.blockedIPs.clear();
        this.endpointCounts.clear();
    }
    constructor(){
        this.metrics = {
            totalRequests: 0,
            allowedRequests: 0,
            blockedRequests: 0,
            redisHits: 0,
            memoryFallbacks: 0,
            errors: 0,
            averageResponseTime: 0,
            topBlockedIPs: [],
            topEndpoints: []
        };
        this.responseTimes = [];
        this.blockedIPs = new Map();
        this.endpointCounts = new Map();
    }
}
// Instancia global del collector de métricas
const metricsCollector = new RateLimitMetricsCollector();
// =====================================================
// IMPLEMENTACIÓN REDIS
// =====================================================
// Función isRedisAvailable ahora se importa desde @/lib/redis
/**
 * Rate limiting con Redis
 */ async function rateLimitWithRedis(key, config) {
    const startTime = Date.now();
    try {
        // Usar la función importada de Redis
        const result = await (0, _redis.enterpriseRateLimit)(key, config);
        if (result) {
            return {
                allowed: result.allowed,
                limit: result.limit || config.maxRequests,
                remaining: result.remaining || 0,
                resetTime: result.resetTime || Date.now() + config.windowMs,
                retryAfter: result.allowed ? undefined : Math.ceil(config.windowMs / 1000),
                source: 'redis',
                metrics: {
                    responseTime: Date.now() - startTime,
                    cacheHit: true,
                    keyGenerated: key
                }
            };
        }
        // Si no hay resultado, usar implementación manual
        const { redis } = await Promise.resolve().then(()=>/*#__PURE__*/ _interop_require_wildcard(require("../redis")));
        const now = Date.now();
        const window = Math.floor(now / config.windowMs);
        const redisKey = `rate_limit:${key}:${window}`;
        // Usar pipeline para operaciones atómicas
        const pipeline = redis.pipeline();
        pipeline.incr(redisKey);
        pipeline.expire(redisKey, Math.ceil(config.windowMs / 1000));
        const results = await pipeline.exec();
        const count = results?.[0]?.[1] || 1;
        const remaining = Math.max(0, config.maxRequests - count);
        const resetTime = (window + 1) * config.windowMs;
        const allowed = count <= config.maxRequests;
        return {
            allowed,
            limit: config.maxRequests,
            remaining,
            resetTime,
            retryAfter: allowed ? undefined : Math.ceil((resetTime - now) / 1000),
            source: 'redis',
            metrics: {
                responseTime: Date.now() - startTime,
                cacheHit: true,
                keyGenerated: redisKey
            }
        };
    } catch (error) {
        console.error('[RATE_LIMIT] Error en Redis:', error);
        // Fallback a memoria en caso de error
        return rateLimitWithMemory(key, config);
    }
}
/**
 * Rate limiting con memoria (fallback)
 */ function rateLimitWithMemory(key, config) {
    const startTime = Date.now();
    const now = Date.now();
    let entry = memoryStore.get(key);
    if (!entry) {
        // Primera request en esta ventana
        entry = {
            count: 1,
            resetTime: now + config.windowMs,
            firstRequest: now
        };
        memoryStore.set(key, entry);
        return {
            allowed: true,
            limit: config.maxRequests,
            remaining: config.maxRequests - 1,
            resetTime: entry.resetTime,
            source: 'memory',
            metrics: {
                responseTime: Date.now() - startTime,
                cacheHit: false,
                keyGenerated: key
            }
        };
    }
    // Incrementar contador
    entry.count++;
    memoryStore.set(key, entry);
    const allowed = entry.count <= config.maxRequests;
    const remaining = Math.max(0, config.maxRequests - entry.count);
    return {
        allowed,
        limit: config.maxRequests,
        remaining,
        resetTime: entry.resetTime,
        retryAfter: allowed ? undefined : Math.ceil((entry.resetTime - now) / 1000),
        source: 'memory',
        metrics: {
            responseTime: Date.now() - startTime,
            cacheHit: true,
            keyGenerated: key
        }
    };
}
async function checkEnterpriseRateLimit(request, configName, customConfig) {
    const baseConfig = ENTERPRISE_RATE_LIMIT_CONFIGS[configName];
    if (!baseConfig) {
        return {
            allowed: true,
            limit: 1000,
            remaining: 999,
            resetTime: Date.now() + 60000,
            error: `Configuración '${configName}' no encontrada`,
            code: 'CONFIG_NOT_FOUND',
            source: 'error'
        };
    }
    const config = {
        ...baseConfig,
        ...customConfig
    };
    const keyGenerator = config.keyGenerator || hybridKeyGenerator;
    const key = keyGenerator(request);
    let result;
    try {
        // Intentar Redis primero si está habilitado
        if (config.enableRedis !== false && await (0, _redis.isRedisAvailable)()) {
            result = await rateLimitWithRedis(key, config);
        } else {
            result = rateLimitWithMemory(key, config);
        }
        // Registrar métricas si está habilitado
        if (config.enableMetrics) {
            const ip = getClientIP(request);
            const endpoint = getEndpoint(request);
            metricsCollector.recordRequest(result, ip, endpoint);
        }
        // Logging si está habilitado
        if (config.enableLogging) {
            if (!result.allowed) {
                console.warn(`[RATE_LIMIT] Límite excedido para ${key}: ${result.remaining}/${result.limit}`);
                // Callback personalizado si está definido
                if (config.onLimitReached) {
                    config.onLimitReached(key, request);
                }
            }
        }
        return result;
    } catch (error) {
        console.error('[RATE_LIMIT] Error en checkEnterpriseRateLimit:', error);
        return {
            allowed: true,
            limit: config.maxRequests,
            remaining: config.maxRequests,
            resetTime: Date.now() + config.windowMs,
            error: 'Error interno en rate limiting',
            code: 'INTERNAL_ERROR',
            source: 'error'
        };
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxyYXRlLWxpbWl0aW5nXFxlbnRlcnByaXNlLXJhdGUtbGltaXRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNpc3RlbWEgRW50ZXJwcmlzZSBkZSBSYXRlIExpbWl0aW5nXG4gKiBVbmlmaWNhIHRvZGFzIGxhcyBpbXBsZW1lbnRhY2lvbmVzIGRlIHJhdGUgbGltaXRpbmcgY29uIFJlZGlzIHkgZmFsbGJhY2sgZW4gbWVtb3JpYVxuICovXG5cbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHsgaXNSZWRpc0F2YWlsYWJsZSwgZW50ZXJwcmlzZVJhdGVMaW1pdCB9IGZyb20gJ0AvbGliL3JlZGlzJztcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRJUE9TIFkgSU5URVJGQUNFU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBFbnRlcnByaXNlUmF0ZUxpbWl0Q29uZmlnIHtcbiAgd2luZG93TXM6IG51bWJlcjtcbiAgbWF4UmVxdWVzdHM6IG51bWJlcjtcbiAgbWVzc2FnZT86IHN0cmluZztcbiAga2V5R2VuZXJhdG9yPzogKHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QpID0+IHN0cmluZztcbiAgc2tpcFN1Y2Nlc3NmdWxSZXF1ZXN0cz86IGJvb2xlYW47XG4gIHNraXBGYWlsZWRSZXF1ZXN0cz86IGJvb2xlYW47XG4gIGVuYWJsZVJlZGlzPzogYm9vbGVhbjtcbiAgZW5hYmxlTWVtb3J5RmFsbGJhY2s/OiBib29sZWFuO1xuICBlbmFibGVNZXRyaWNzPzogYm9vbGVhbjtcbiAgZW5hYmxlTG9nZ2luZz86IGJvb2xlYW47XG4gIGN1c3RvbUhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICBvbkxpbWl0UmVhY2hlZD86IChrZXk6IHN0cmluZywgcmVxdWVzdDogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdCkgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFbnRlcnByaXNlUmF0ZUxpbWl0UmVzdWx0IHtcbiAgYWxsb3dlZDogYm9vbGVhbjtcbiAgbGltaXQ6IG51bWJlcjtcbiAgcmVtYWluaW5nOiBudW1iZXI7XG4gIHJlc2V0VGltZTogbnVtYmVyO1xuICByZXRyeUFmdGVyPzogbnVtYmVyO1xuICBlcnJvcj86IHN0cmluZztcbiAgY29kZT86IHN0cmluZztcbiAgc291cmNlOiAncmVkaXMnIHwgJ21lbW9yeScgfCAnZXJyb3InO1xuICBtZXRyaWNzPzoge1xuICAgIHJlc3BvbnNlVGltZTogbnVtYmVyO1xuICAgIGNhY2hlSGl0OiBib29sZWFuO1xuICAgIGtleUdlbmVyYXRlZDogc3RyaW5nO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJhdGVMaW1pdE1ldHJpY3Mge1xuICB0b3RhbFJlcXVlc3RzOiBudW1iZXI7XG4gIGFsbG93ZWRSZXF1ZXN0czogbnVtYmVyO1xuICBibG9ja2VkUmVxdWVzdHM6IG51bWJlcjtcbiAgcmVkaXNIaXRzOiBudW1iZXI7XG4gIG1lbW9yeUZhbGxiYWNrczogbnVtYmVyO1xuICBlcnJvcnM6IG51bWJlcjtcbiAgYXZlcmFnZVJlc3BvbnNlVGltZTogbnVtYmVyO1xuICB0b3BCbG9ja2VkSVBzOiBBcnJheTx7IGlwOiBzdHJpbmc7IGNvdW50OiBudW1iZXIgfT47XG4gIHRvcEVuZHBvaW50czogQXJyYXk8eyBlbmRwb2ludDogc3RyaW5nOyBjb3VudDogbnVtYmVyIH0+O1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09ORklHVVJBQ0lPTkVTIFBSRURFRklOSURBUyBFTlRFUlBSSVNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY29uc3QgRU5URVJQUklTRV9SQVRFX0xJTUlUX0NPTkZJR1M6IFJlY29yZDxzdHJpbmcsIEVudGVycHJpc2VSYXRlTGltaXRDb25maWc+ID0ge1xuICAvLyBBdXRlbnRpY2FjacOzbiBjcsOtdGljYVxuICBDUklUSUNBTF9BVVRIOiB7XG4gICAgd2luZG93TXM6IDE1ICogNjAgKiAxMDAwLCAvLyAxNSBtaW51dG9zXG4gICAgbWF4UmVxdWVzdHM6IDMsIC8vIDMgaW50ZW50b3MgcG9yIDE1IG1pbnV0b3NcbiAgICBtZXNzYWdlOiAnRGVtYXNpYWRvcyBpbnRlbnRvcyBkZSBhdXRlbnRpY2FjacOzbiBjcsOtdGljYS4gSW50ZW50YSBlbiAxNSBtaW51dG9zLicsXG4gICAgZW5hYmxlUmVkaXM6IHRydWUsXG4gICAgZW5hYmxlTWV0cmljczogdHJ1ZSxcbiAgICBlbmFibGVMb2dnaW5nOiB0cnVlXG4gIH0sXG5cbiAgLy8gQWRtaW4gQVBJc1xuICBBRE1JTl9BUEk6IHtcbiAgICB3aW5kb3dNczogNSAqIDYwICogMTAwMCwgLy8gNSBtaW51dG9zXG4gICAgbWF4UmVxdWVzdHM6IDUwLCAvLyA1MCByZXF1ZXN0cyBwb3IgNSBtaW51dG9zXG4gICAgbWVzc2FnZTogJ0zDrW1pdGUgZGUgcmVxdWVzdHMgYWRtaW5pc3RyYXRpdmFzIGV4Y2VkaWRvLiBJbnRlbnRhIGVuIDUgbWludXRvcy4nLFxuICAgIGVuYWJsZVJlZGlzOiB0cnVlLFxuICAgIGVuYWJsZU1ldHJpY3M6IHRydWUsXG4gICAgZW5hYmxlTG9nZ2luZzogdHJ1ZVxuICB9LFxuXG4gIC8vIEFQSXMgZGUgcGFnb3NcbiAgUEFZTUVOVF9BUEk6IHtcbiAgICB3aW5kb3dNczogMTAgKiA2MCAqIDEwMDAsIC8vIDEwIG1pbnV0b3NcbiAgICBtYXhSZXF1ZXN0czogMTUsIC8vIDE1IHJlcXVlc3RzIHBvciAxMCBtaW51dG9zXG4gICAgbWVzc2FnZTogJ0zDrW1pdGUgZGUgcmVxdWVzdHMgZGUgcGFnb3MgZXhjZWRpZG8uIEludGVudGEgZW4gMTAgbWludXRvcy4nLFxuICAgIGVuYWJsZVJlZGlzOiB0cnVlLFxuICAgIGVuYWJsZU1ldHJpY3M6IHRydWUsXG4gICAgZW5hYmxlTG9nZ2luZzogdHJ1ZSxcbiAgICBvbkxpbWl0UmVhY2hlZDogKGtleSwgcmVxdWVzdCkgPT4ge1xuICAgICAgY29uc29sZS53YXJuKGBbUEFZTUVOVF9SQVRFX0xJTUlUXSBMw61taXRlIGV4Y2VkaWRvIHBhcmEgJHtrZXl9YCk7XG4gICAgfVxuICB9LFxuXG4gIC8vIEFQSXMgcMO6YmxpY2FzIGRlIHByb2R1Y3Rvc1xuICBQVUJMSUNfQVBJOiB7XG4gICAgd2luZG93TXM6IDEgKiA2MCAqIDEwMDAsIC8vIDEgbWludXRvXG4gICAgbWF4UmVxdWVzdHM6IDEwMCwgLy8gMTAwIHJlcXVlc3RzIHBvciBtaW51dG9cbiAgICBtZXNzYWdlOiAnTMOtbWl0ZSBkZSByZXF1ZXN0cyBww7pibGljYXMgZXhjZWRpZG8uIEludGVudGEgZW4gMSBtaW51dG8uJyxcbiAgICBlbmFibGVSZWRpczogdHJ1ZSxcbiAgICBlbmFibGVNZXRyaWNzOiB0cnVlLFxuICAgIGVuYWJsZUxvZ2dpbmc6IGZhbHNlIC8vIE5vIGxvZ2dlYXIgQVBJcyBww7pibGljYXNcbiAgfSxcblxuICAvLyBXZWJob29rc1xuICBXRUJIT09LX0FQSToge1xuICAgIHdpbmRvd01zOiAxICogNjAgKiAxMDAwLCAvLyAxIG1pbnV0b1xuICAgIG1heFJlcXVlc3RzOiAyMDAsIC8vIDIwMCB3ZWJob29rcyBwb3IgbWludXRvXG4gICAgbWVzc2FnZTogJ0zDrW1pdGUgZGUgd2ViaG9va3MgZXhjZWRpZG8uJyxcbiAgICBlbmFibGVSZWRpczogdHJ1ZSxcbiAgICBlbmFibGVNZXRyaWNzOiB0cnVlLFxuICAgIGVuYWJsZUxvZ2dpbmc6IHRydWVcbiAgfSxcblxuICAvLyBCw7pzcXVlZGFzIHkgY29uc3VsdGFzXG4gIFNFQVJDSF9BUEk6IHtcbiAgICB3aW5kb3dNczogMSAqIDYwICogMTAwMCwgLy8gMSBtaW51dG9cbiAgICBtYXhSZXF1ZXN0czogNjAsIC8vIDYwIGLDunNxdWVkYXMgcG9yIG1pbnV0b1xuICAgIG1lc3NhZ2U6ICdMw61taXRlIGRlIGLDunNxdWVkYXMgZXhjZWRpZG8uIEludGVudGEgZW4gMSBtaW51dG8uJyxcbiAgICBlbmFibGVSZWRpczogdHJ1ZSxcbiAgICBlbmFibGVNZXRyaWNzOiB0cnVlLFxuICAgIGVuYWJsZUxvZ2dpbmc6IGZhbHNlXG4gIH0sXG5cbiAgLy8gVXBsb2FkIGRlIGFyY2hpdm9zXG4gIFVQTE9BRF9BUEk6IHtcbiAgICB3aW5kb3dNczogNSAqIDYwICogMTAwMCwgLy8gNSBtaW51dG9zXG4gICAgbWF4UmVxdWVzdHM6IDEwLCAvLyAxMCB1cGxvYWRzIHBvciA1IG1pbnV0b3NcbiAgICBtZXNzYWdlOiAnTMOtbWl0ZSBkZSB1cGxvYWRzIGV4Y2VkaWRvLiBJbnRlbnRhIGVuIDUgbWludXRvcy4nLFxuICAgIGVuYWJsZVJlZGlzOiB0cnVlLFxuICAgIGVuYWJsZU1ldHJpY3M6IHRydWUsXG4gICAgZW5hYmxlTG9nZ2luZzogdHJ1ZVxuICB9LFxuXG4gIC8vIEFQSXMgZGUgZGVzYXJyb2xsby9kZWJ1Z1xuICBERUJVR19BUEk6IHtcbiAgICB3aW5kb3dNczogMSAqIDYwICogMTAwMCwgLy8gMSBtaW51dG9cbiAgICBtYXhSZXF1ZXN0czogMzAsIC8vIDMwIHJlcXVlc3RzIHBvciBtaW51dG9cbiAgICBtZXNzYWdlOiAnTMOtbWl0ZSBkZSBkZWJ1ZyBBUElzIGV4Y2VkaWRvLicsXG4gICAgZW5hYmxlUmVkaXM6IGZhbHNlLCAvLyBVc2FyIG1lbW9yaWEgcGFyYSBkZWJ1Z1xuICAgIGVuYWJsZU1ldHJpY3M6IHRydWUsXG4gICAgZW5hYmxlTG9nZ2luZzogdHJ1ZVxuICB9XG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gR0VORVJBRE9SRVMgREUgQ0xBVkVTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdlbmVyYWRvciBkZSBjbGF2ZSBwb3IgSVBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlwS2V5R2VuZXJhdG9yKHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QpOiBzdHJpbmcge1xuICBjb25zdCBpcCA9IGdldENsaWVudElQKHJlcXVlc3QpO1xuICByZXR1cm4gYGlwOiR7aXB9YDtcbn1cblxuLyoqXG4gKiBHZW5lcmFkb3IgZGUgY2xhdmUgcG9yIHVzdWFyaW8gYXV0ZW50aWNhZG9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZXJLZXlHZW5lcmF0b3IocmVxdWVzdDogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdCk6IHN0cmluZyB7XG4gIC8vIEludGVudGFyIG9idGVuZXIgdXNlciBJRCBkZSBkaWZlcmVudGVzIGZ1ZW50ZXNcbiAgY29uc3QgdXNlcklkID0gZ2V0VXNlcklkKHJlcXVlc3QpO1xuICBjb25zdCBpcCA9IGdldENsaWVudElQKHJlcXVlc3QpO1xuICBcbiAgcmV0dXJuIHVzZXJJZCA/IGB1c2VyOiR7dXNlcklkfWAgOiBgaXA6JHtpcH1gO1xufVxuXG4vKipcbiAqIEdlbmVyYWRvciBkZSBjbGF2ZSBwb3IgZW5kcG9pbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVuZHBvaW50S2V5R2VuZXJhdG9yKHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QpOiBzdHJpbmcge1xuICBjb25zdCBpcCA9IGdldENsaWVudElQKHJlcXVlc3QpO1xuICBjb25zdCBlbmRwb2ludCA9IGdldEVuZHBvaW50KHJlcXVlc3QpO1xuICBcbiAgcmV0dXJuIGBlbmRwb2ludDoke2lwfToke2VuZHBvaW50fWA7XG59XG5cbi8qKlxuICogR2VuZXJhZG9yIGRlIGNsYXZlIGjDrWJyaWRvICh1c3VhcmlvICsgZW5kcG9pbnQpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoeWJyaWRLZXlHZW5lcmF0b3IocmVxdWVzdDogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdCk6IHN0cmluZyB7XG4gIGNvbnN0IHVzZXJJZCA9IGdldFVzZXJJZChyZXF1ZXN0KTtcbiAgY29uc3QgaXAgPSBnZXRDbGllbnRJUChyZXF1ZXN0KTtcbiAgY29uc3QgZW5kcG9pbnQgPSBnZXRFbmRwb2ludChyZXF1ZXN0KTtcbiAgXG4gIGNvbnN0IHVzZXJQYXJ0ID0gdXNlcklkID8gYHVzZXI6JHt1c2VySWR9YCA6IGBpcDoke2lwfWA7XG4gIHJldHVybiBgJHt1c2VyUGFydH06JHtlbmRwb2ludH1gO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVVRJTElEQURFU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBPYnRpZW5lIGxhIElQIGRlbCBjbGllbnRlXG4gKi9cbmZ1bmN0aW9uIGdldENsaWVudElQKHJlcXVlc3Q6IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QpOiBzdHJpbmcge1xuICAvLyBJbnRlbnRhciBkaWZlcmVudGVzIGhlYWRlcnMgZGUgSVBcbiAgY29uc3QgaGVhZGVycyA9IFtcbiAgICAneC1mb3J3YXJkZWQtZm9yJyxcbiAgICAneC1yZWFsLWlwJyxcbiAgICAneC1jbGllbnQtaXAnLFxuICAgICdjZi1jb25uZWN0aW5nLWlwJ1xuICBdO1xuXG4gIGZvciAoY29uc3QgaGVhZGVyIG9mIGhlYWRlcnMpIHtcbiAgICBsZXQgaXA6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgIFxuICAgIGlmICgnaGVhZGVycycgaW4gcmVxdWVzdCAmJiB0eXBlb2YgcmVxdWVzdC5oZWFkZXJzLmdldCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgLy8gTmV4dFJlcXVlc3RcbiAgICAgIGlwID0gKHJlcXVlc3QgYXMgTmV4dFJlcXVlc3QpLmhlYWRlcnMuZ2V0KGhlYWRlcik7XG4gICAgfSBlbHNlIGlmICgnaGVhZGVycycgaW4gcmVxdWVzdCkge1xuICAgICAgLy8gTmV4dEFwaVJlcXVlc3RcbiAgICAgIGNvbnN0IGhlYWRlclZhbHVlID0gKHJlcXVlc3QgYXMgTmV4dEFwaVJlcXVlc3QpLmhlYWRlcnNbaGVhZGVyXTtcbiAgICAgIGlwID0gQXJyYXkuaXNBcnJheShoZWFkZXJWYWx1ZSkgPyBoZWFkZXJWYWx1ZVswXSA6IGhlYWRlclZhbHVlIHx8IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKGlwKSB7XG4gICAgICAvLyBUb21hciBsYSBwcmltZXJhIElQIHNpIGhheSBtw7psdGlwbGVzXG4gICAgICByZXR1cm4gaXAuc3BsaXQoJywnKVswXS50cmltKCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuICd1bmtub3duJztcbn1cblxuLyoqXG4gKiBPYnRpZW5lIGVsIElEIGRlbCB1c3VhcmlvIGF1dGVudGljYWRvXG4gKi9cbmZ1bmN0aW9uIGdldFVzZXJJZChyZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0KTogc3RyaW5nIHwgbnVsbCB7XG4gIC8vIEludGVudGFyIG9idGVuZXIgZGUgZGlmZXJlbnRlcyBmdWVudGVzXG4gIFxuICAvLyAxLiBIZWFkZXJzIGRlIENsZXJrXG4gIGxldCB1c2VySWQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBcbiAgaWYgKCdoZWFkZXJzJyBpbiByZXF1ZXN0ICYmIHR5cGVvZiByZXF1ZXN0LmhlYWRlcnMuZ2V0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgLy8gTmV4dFJlcXVlc3RcbiAgICB1c2VySWQgPSAocmVxdWVzdCBhcyBOZXh0UmVxdWVzdCkuaGVhZGVycy5nZXQoJ3gtY2xlcmstdXNlci1pZCcpO1xuICB9IGVsc2UgaWYgKCdoZWFkZXJzJyBpbiByZXF1ZXN0KSB7XG4gICAgLy8gTmV4dEFwaVJlcXVlc3RcbiAgICBjb25zdCBoZWFkZXJWYWx1ZSA9IChyZXF1ZXN0IGFzIE5leHRBcGlSZXF1ZXN0KS5oZWFkZXJzWyd4LWNsZXJrLXVzZXItaWQnXTtcbiAgICB1c2VySWQgPSBBcnJheS5pc0FycmF5KGhlYWRlclZhbHVlKSA/IGhlYWRlclZhbHVlWzBdIDogaGVhZGVyVmFsdWUgfHwgbnVsbDtcbiAgfVxuXG4gIC8vIDIuIENvbnRleHRvIGVudGVycHJpc2Ugc2kgZXN0w6EgZGlzcG9uaWJsZVxuICBpZiAoIXVzZXJJZCAmJiAocmVxdWVzdCBhcyBhbnkpLmVudGVycHJpc2VBdXRoPy51c2VySWQpIHtcbiAgICB1c2VySWQgPSAocmVxdWVzdCBhcyBhbnkpLmVudGVycHJpc2VBdXRoLnVzZXJJZDtcbiAgfVxuXG4gIC8vIDMuIENvbnRleHRvIGRlIGF1dGVudGljYWNpw7NuIHNpIGVzdMOhIGRpc3BvbmlibGVcbiAgaWYgKCF1c2VySWQgJiYgKHJlcXVlc3QgYXMgYW55KS5hdXRoPy51c2VySWQpIHtcbiAgICB1c2VySWQgPSAocmVxdWVzdCBhcyBhbnkpLmF1dGgudXNlcklkO1xuICB9XG5cbiAgcmV0dXJuIHVzZXJJZDtcbn1cblxuLyoqXG4gKiBPYnRpZW5lIGVsIGVuZHBvaW50IGRlIGxhIHJlcXVlc3RcbiAqL1xuZnVuY3Rpb24gZ2V0RW5kcG9pbnQocmVxdWVzdDogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdCk6IHN0cmluZyB7XG4gIGlmICgnbmV4dFVybCcgaW4gcmVxdWVzdCkge1xuICAgIC8vIE5leHRSZXF1ZXN0XG4gICAgcmV0dXJuIChyZXF1ZXN0IGFzIE5leHRSZXF1ZXN0KS5uZXh0VXJsLnBhdGhuYW1lO1xuICB9IGVsc2UgaWYgKCd1cmwnIGluIHJlcXVlc3QpIHtcbiAgICAvLyBOZXh0QXBpUmVxdWVzdFxuICAgIHRyeSB7XG4gICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKChyZXF1ZXN0IGFzIE5leHRBcGlSZXF1ZXN0KS51cmwgfHwgJycsICdodHRwOi8vbG9jYWxob3N0Jyk7XG4gICAgICByZXR1cm4gdXJsLnBhdGhuYW1lO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuICcvdW5rbm93bic7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gJy91bmtub3duJztcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFNUT1JFIEVOIE1FTU9SSUEgKEZBTExCQUNLKVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW50ZXJmYWNlIE1lbW9yeVJhdGVMaW1pdEVudHJ5IHtcbiAgY291bnQ6IG51bWJlcjtcbiAgcmVzZXRUaW1lOiBudW1iZXI7XG4gIGZpcnN0UmVxdWVzdDogbnVtYmVyO1xufVxuXG5jbGFzcyBNZW1vcnlSYXRlTGltaXRTdG9yZSB7XG4gIHByaXZhdGUgc3RvcmUgPSBuZXcgTWFwPHN0cmluZywgTWVtb3J5UmF0ZUxpbWl0RW50cnk+KCk7XG4gIHByaXZhdGUgY2xlYW51cEludGVydmFsOiBOb2RlSlMuVGltZW91dDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBMaW1waWFyIGVudHJhZGFzIGV4cGlyYWRhcyBjYWRhIDUgbWludXRvc1xuICAgIHRoaXMuY2xlYW51cEludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgdGhpcy5jbGVhbnVwKCk7XG4gICAgfSwgNSAqIDYwICogMTAwMCk7XG4gIH1cblxuICBnZXQoa2V5OiBzdHJpbmcpOiBNZW1vcnlSYXRlTGltaXRFbnRyeSB8IG51bGwge1xuICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5zdG9yZS5nZXQoa2V5KTtcbiAgICBcbiAgICBpZiAoIWVudHJ5KSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgc2kgaGEgZXhwaXJhZG9cbiAgICBpZiAoRGF0ZS5ub3coKSA+IGVudHJ5LnJlc2V0VGltZSkge1xuICAgICAgdGhpcy5zdG9yZS5kZWxldGUoa2V5KTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuXG4gIHNldChrZXk6IHN0cmluZywgZW50cnk6IE1lbW9yeVJhdGVMaW1pdEVudHJ5KTogdm9pZCB7XG4gICAgdGhpcy5zdG9yZS5zZXQoa2V5LCBlbnRyeSk7XG4gIH1cblxuICBpbmNyZW1lbnQoa2V5OiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5nZXQoa2V5KTtcbiAgICBpZiAoZW50cnkpIHtcbiAgICAgIGVudHJ5LmNvdW50Kys7XG4gICAgICB0aGlzLnNldChrZXksIGVudHJ5KTtcbiAgICAgIHJldHVybiBlbnRyeS5jb3VudDtcbiAgICB9XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICBwcml2YXRlIGNsZWFudXAoKTogdm9pZCB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgY2xlYW5lZCA9IDA7XG5cbiAgICBmb3IgKGNvbnN0IFtrZXksIGVudHJ5XSBvZiB0aGlzLnN0b3JlLmVudHJpZXMoKSkge1xuICAgICAgaWYgKG5vdyA+IGVudHJ5LnJlc2V0VGltZSkge1xuICAgICAgICB0aGlzLnN0b3JlLmRlbGV0ZShrZXkpO1xuICAgICAgICBjbGVhbmVkKys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNsZWFuZWQgPiAwKSB7XG4gICAgICBjb25zb2xlLmxvZyhgW01FTU9SWV9SQVRFX0xJTUlUXSBMaW1waWFkYXMgJHtjbGVhbmVkfSBlbnRyYWRhcyBleHBpcmFkYXNgKTtcbiAgICB9XG4gIH1cblxuICBnZXRTdGF0cygpOiB7IGVudHJpZXM6IG51bWJlcjsgbWVtb3J5VXNhZ2U6IG51bWJlciB9IHtcbiAgICBjb25zdCBlbnRyaWVzID0gdGhpcy5zdG9yZS5zaXplO1xuICAgIGNvbnN0IG1lbW9yeVVzYWdlID0gSlNPTi5zdHJpbmdpZnkoWy4uLnRoaXMuc3RvcmUuZW50cmllcygpXSkubGVuZ3RoO1xuXG4gICAgcmV0dXJuIHsgZW50cmllcywgbWVtb3J5VXNhZ2UgfTtcbiAgfVxuXG4gIGNsZWFyKCk6IHZvaWQge1xuICAgIHRoaXMuc3RvcmUuY2xlYXIoKTtcbiAgfVxuXG4gIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY2xlYW51cEludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuY2xlYW51cEludGVydmFsKTtcbiAgICB9XG4gICAgdGhpcy5zdG9yZS5jbGVhcigpO1xuICB9XG59XG5cbi8vIEluc3RhbmNpYSBnbG9iYWwgZGVsIHN0b3JlIGVuIG1lbW9yaWFcbmNvbnN0IG1lbW9yeVN0b3JlID0gbmV3IE1lbW9yeVJhdGVMaW1pdFN0b3JlKCk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNw4lUUklDQVMgR0xPQkFMRVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNsYXNzIFJhdGVMaW1pdE1ldHJpY3NDb2xsZWN0b3Ige1xuICBwcml2YXRlIG1ldHJpY3M6IFJhdGVMaW1pdE1ldHJpY3MgPSB7XG4gICAgdG90YWxSZXF1ZXN0czogMCxcbiAgICBhbGxvd2VkUmVxdWVzdHM6IDAsXG4gICAgYmxvY2tlZFJlcXVlc3RzOiAwLFxuICAgIHJlZGlzSGl0czogMCxcbiAgICBtZW1vcnlGYWxsYmFja3M6IDAsXG4gICAgZXJyb3JzOiAwLFxuICAgIGF2ZXJhZ2VSZXNwb25zZVRpbWU6IDAsXG4gICAgdG9wQmxvY2tlZElQczogW10sXG4gICAgdG9wRW5kcG9pbnRzOiBbXVxuICB9O1xuXG4gIHByaXZhdGUgcmVzcG9uc2VUaW1lczogbnVtYmVyW10gPSBbXTtcbiAgcHJpdmF0ZSBibG9ja2VkSVBzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgcHJpdmF0ZSBlbmRwb2ludENvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG5cbiAgcmVjb3JkUmVxdWVzdChyZXN1bHQ6IEVudGVycHJpc2VSYXRlTGltaXRSZXN1bHQsIGlwOiBzdHJpbmcsIGVuZHBvaW50OiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLm1ldHJpY3MudG90YWxSZXF1ZXN0cysrO1xuXG4gICAgaWYgKHJlc3VsdC5hbGxvd2VkKSB7XG4gICAgICB0aGlzLm1ldHJpY3MuYWxsb3dlZFJlcXVlc3RzKys7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubWV0cmljcy5ibG9ja2VkUmVxdWVzdHMrKztcbiAgICAgIFxuICAgICAgLy8gUmVnaXN0cmFyIElQIGJsb3F1ZWFkYVxuICAgICAgY29uc3QgY3VycmVudENvdW50ID0gdGhpcy5ibG9ja2VkSVBzLmdldChpcCkgfHwgMDtcbiAgICAgIHRoaXMuYmxvY2tlZElQcy5zZXQoaXAsIGN1cnJlbnRDb3VudCArIDEpO1xuICAgIH1cblxuICAgIC8vIFJlZ2lzdHJhciBmdWVudGVcbiAgICBpZiAocmVzdWx0LnNvdXJjZSA9PT0gJ3JlZGlzJykge1xuICAgICAgdGhpcy5tZXRyaWNzLnJlZGlzSGl0cysrO1xuICAgIH0gZWxzZSBpZiAocmVzdWx0LnNvdXJjZSA9PT0gJ21lbW9yeScpIHtcbiAgICAgIHRoaXMubWV0cmljcy5tZW1vcnlGYWxsYmFja3MrKztcbiAgICB9IGVsc2UgaWYgKHJlc3VsdC5zb3VyY2UgPT09ICdlcnJvcicpIHtcbiAgICAgIHRoaXMubWV0cmljcy5lcnJvcnMrKztcbiAgICB9XG5cbiAgICAvLyBSZWdpc3RyYXIgdGllbXBvIGRlIHJlc3B1ZXN0YVxuICAgIGlmIChyZXN1bHQubWV0cmljcz8ucmVzcG9uc2VUaW1lKSB7XG4gICAgICB0aGlzLnJlc3BvbnNlVGltZXMucHVzaChyZXN1bHQubWV0cmljcy5yZXNwb25zZVRpbWUpO1xuICAgICAgXG4gICAgICAvLyBNYW50ZW5lciBzb2xvIGxvcyDDumx0aW1vcyAxMDAwIHRpZW1wb3NcbiAgICAgIGlmICh0aGlzLnJlc3BvbnNlVGltZXMubGVuZ3RoID4gMTAwMCkge1xuICAgICAgICB0aGlzLnJlc3BvbnNlVGltZXMgPSB0aGlzLnJlc3BvbnNlVGltZXMuc2xpY2UoLTEwMDApO1xuICAgICAgfVxuXG4gICAgICAvLyBDYWxjdWxhciBwcm9tZWRpb1xuICAgICAgdGhpcy5tZXRyaWNzLmF2ZXJhZ2VSZXNwb25zZVRpbWUgPSBcbiAgICAgICAgdGhpcy5yZXNwb25zZVRpbWVzLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gdGhpcy5yZXNwb25zZVRpbWVzLmxlbmd0aDtcbiAgICB9XG5cbiAgICAvLyBSZWdpc3RyYXIgZW5kcG9pbnRcbiAgICBjb25zdCBlbmRwb2ludENvdW50ID0gdGhpcy5lbmRwb2ludENvdW50cy5nZXQoZW5kcG9pbnQpIHx8IDA7XG4gICAgdGhpcy5lbmRwb2ludENvdW50cy5zZXQoZW5kcG9pbnQsIGVuZHBvaW50Q291bnQgKyAxKTtcblxuICAgIC8vIEFjdHVhbGl6YXIgdG9wc1xuICAgIHRoaXMudXBkYXRlVG9wTGlzdHMoKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlVG9wTGlzdHMoKTogdm9pZCB7XG4gICAgLy8gVG9wIElQcyBibG9xdWVhZGFzXG4gICAgdGhpcy5tZXRyaWNzLnRvcEJsb2NrZWRJUHMgPSBBcnJheS5mcm9tKHRoaXMuYmxvY2tlZElQcy5lbnRyaWVzKCkpXG4gICAgICAuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pXG4gICAgICAuc2xpY2UoMCwgMTApXG4gICAgICAubWFwKChbaXAsIGNvdW50XSkgPT4gKHsgaXAsIGNvdW50IH0pKTtcblxuICAgIC8vIFRvcCBlbmRwb2ludHNcbiAgICB0aGlzLm1ldHJpY3MudG9wRW5kcG9pbnRzID0gQXJyYXkuZnJvbSh0aGlzLmVuZHBvaW50Q291bnRzLmVudHJpZXMoKSlcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiWzFdIC0gYVsxXSlcbiAgICAgIC5zbGljZSgwLCAxMClcbiAgICAgIC5tYXAoKFtlbmRwb2ludCwgY291bnRdKSA9PiAoeyBlbmRwb2ludCwgY291bnQgfSkpO1xuICB9XG5cbiAgZ2V0TWV0cmljcygpOiBSYXRlTGltaXRNZXRyaWNzIHtcbiAgICByZXR1cm4geyAuLi50aGlzLm1ldHJpY3MgfTtcbiAgfVxuXG4gIHJlc2V0KCk6IHZvaWQge1xuICAgIHRoaXMubWV0cmljcyA9IHtcbiAgICAgIHRvdGFsUmVxdWVzdHM6IDAsXG4gICAgICBhbGxvd2VkUmVxdWVzdHM6IDAsXG4gICAgICBibG9ja2VkUmVxdWVzdHM6IDAsXG4gICAgICByZWRpc0hpdHM6IDAsXG4gICAgICBtZW1vcnlGYWxsYmFja3M6IDAsXG4gICAgICBlcnJvcnM6IDAsXG4gICAgICBhdmVyYWdlUmVzcG9uc2VUaW1lOiAwLFxuICAgICAgdG9wQmxvY2tlZElQczogW10sXG4gICAgICB0b3BFbmRwb2ludHM6IFtdXG4gICAgfTtcbiAgICB0aGlzLnJlc3BvbnNlVGltZXMgPSBbXTtcbiAgICB0aGlzLmJsb2NrZWRJUHMuY2xlYXIoKTtcbiAgICB0aGlzLmVuZHBvaW50Q291bnRzLmNsZWFyKCk7XG4gIH1cbn1cblxuLy8gSW5zdGFuY2lhIGdsb2JhbCBkZWwgY29sbGVjdG9yIGRlIG3DqXRyaWNhc1xuY29uc3QgbWV0cmljc0NvbGxlY3RvciA9IG5ldyBSYXRlTGltaXRNZXRyaWNzQ29sbGVjdG9yKCk7XG5cbi8vIEV4cG9ydGFyIHBhcmEgdXNvIGV4dGVybm9cbmV4cG9ydCB7IG1lbW9yeVN0b3JlLCBtZXRyaWNzQ29sbGVjdG9yIH07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBJTVBMRU1FTlRBQ0nDk04gUkVESVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIEZ1bmNpw7NuIGlzUmVkaXNBdmFpbGFibGUgYWhvcmEgc2UgaW1wb3J0YSBkZXNkZSBAL2xpYi9yZWRpc1xuXG4vKipcbiAqIFJhdGUgbGltaXRpbmcgY29uIFJlZGlzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJhdGVMaW1pdFdpdGhSZWRpcyhcbiAga2V5OiBzdHJpbmcsXG4gIGNvbmZpZzogRW50ZXJwcmlzZVJhdGVMaW1pdENvbmZpZ1xuKTogUHJvbWlzZTxFbnRlcnByaXNlUmF0ZUxpbWl0UmVzdWx0PiB7XG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cbiAgdHJ5IHtcbiAgICAvLyBVc2FyIGxhIGZ1bmNpw7NuIGltcG9ydGFkYSBkZSBSZWRpc1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGVudGVycHJpc2VSYXRlTGltaXQoa2V5LCBjb25maWcpO1xuXG4gICAgaWYgKHJlc3VsdCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogcmVzdWx0LmFsbG93ZWQsXG4gICAgICAgIGxpbWl0OiByZXN1bHQubGltaXQgfHwgY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgICByZW1haW5pbmc6IHJlc3VsdC5yZW1haW5pbmcgfHwgMCxcbiAgICAgICAgcmVzZXRUaW1lOiByZXN1bHQucmVzZXRUaW1lIHx8IERhdGUubm93KCkgKyBjb25maWcud2luZG93TXMsXG4gICAgICAgIHJldHJ5QWZ0ZXI6IHJlc3VsdC5hbGxvd2VkID8gdW5kZWZpbmVkIDogTWF0aC5jZWlsKGNvbmZpZy53aW5kb3dNcyAvIDEwMDApLFxuICAgICAgICBzb3VyY2U6ICdyZWRpcycsXG4gICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICByZXNwb25zZVRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgICAgY2FjaGVIaXQ6IHRydWUsXG4gICAgICAgICAga2V5R2VuZXJhdGVkOiBrZXlcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBTaSBubyBoYXkgcmVzdWx0YWRvLCB1c2FyIGltcGxlbWVudGFjacOzbiBtYW51YWxcbiAgICBjb25zdCB7IHJlZGlzIH0gPSBhd2FpdCBpbXBvcnQoJ0AvbGliL3JlZGlzJyk7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCB3aW5kb3cgPSBNYXRoLmZsb29yKG5vdyAvIGNvbmZpZy53aW5kb3dNcyk7XG4gICAgY29uc3QgcmVkaXNLZXkgPSBgcmF0ZV9saW1pdDoke2tleX06JHt3aW5kb3d9YDtcblxuICAgIC8vIFVzYXIgcGlwZWxpbmUgcGFyYSBvcGVyYWNpb25lcyBhdMOzbWljYXNcbiAgICBjb25zdCBwaXBlbGluZSA9IHJlZGlzLnBpcGVsaW5lKCk7XG4gICAgcGlwZWxpbmUuaW5jcihyZWRpc0tleSk7XG4gICAgcGlwZWxpbmUuZXhwaXJlKHJlZGlzS2V5LCBNYXRoLmNlaWwoY29uZmlnLndpbmRvd01zIC8gMTAwMCkpO1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHBpcGVsaW5lLmV4ZWMoKTtcbiAgICBjb25zdCBjb3VudCA9IHJlc3VsdHM/LlswXT8uWzFdIGFzIG51bWJlciB8fCAxO1xuXG4gICAgY29uc3QgcmVtYWluaW5nID0gTWF0aC5tYXgoMCwgY29uZmlnLm1heFJlcXVlc3RzIC0gY291bnQpO1xuICAgIGNvbnN0IHJlc2V0VGltZSA9ICh3aW5kb3cgKyAxKSAqIGNvbmZpZy53aW5kb3dNcztcbiAgICBjb25zdCBhbGxvd2VkID0gY291bnQgPD0gY29uZmlnLm1heFJlcXVlc3RzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQsXG4gICAgICBsaW1pdDogY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgcmVtYWluaW5nLFxuICAgICAgcmVzZXRUaW1lLFxuICAgICAgcmV0cnlBZnRlcjogYWxsb3dlZCA/IHVuZGVmaW5lZCA6IE1hdGguY2VpbCgocmVzZXRUaW1lIC0gbm93KSAvIDEwMDApLFxuICAgICAgc291cmNlOiAncmVkaXMnLFxuICAgICAgbWV0cmljczoge1xuICAgICAgICByZXNwb25zZVRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgIGNhY2hlSGl0OiB0cnVlLFxuICAgICAgICBrZXlHZW5lcmF0ZWQ6IHJlZGlzS2V5XG4gICAgICB9XG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbUkFURV9MSU1JVF0gRXJyb3IgZW4gUmVkaXM6JywgZXJyb3IpO1xuXG4gICAgLy8gRmFsbGJhY2sgYSBtZW1vcmlhIGVuIGNhc28gZGUgZXJyb3JcbiAgICByZXR1cm4gcmF0ZUxpbWl0V2l0aE1lbW9yeShrZXksIGNvbmZpZyk7XG4gIH1cbn1cblxuLyoqXG4gKiBSYXRlIGxpbWl0aW5nIGNvbiBtZW1vcmlhIChmYWxsYmFjaylcbiAqL1xuZnVuY3Rpb24gcmF0ZUxpbWl0V2l0aE1lbW9yeShcbiAga2V5OiBzdHJpbmcsXG4gIGNvbmZpZzogRW50ZXJwcmlzZVJhdGVMaW1pdENvbmZpZ1xuKTogRW50ZXJwcmlzZVJhdGVMaW1pdFJlc3VsdCB7XG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG5cbiAgbGV0IGVudHJ5ID0gbWVtb3J5U3RvcmUuZ2V0KGtleSk7XG5cbiAgaWYgKCFlbnRyeSkge1xuICAgIC8vIFByaW1lcmEgcmVxdWVzdCBlbiBlc3RhIHZlbnRhbmFcbiAgICBlbnRyeSA9IHtcbiAgICAgIGNvdW50OiAxLFxuICAgICAgcmVzZXRUaW1lOiBub3cgKyBjb25maWcud2luZG93TXMsXG4gICAgICBmaXJzdFJlcXVlc3Q6IG5vd1xuICAgIH07XG4gICAgbWVtb3J5U3RvcmUuc2V0KGtleSwgZW50cnkpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICBsaW1pdDogY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgcmVtYWluaW5nOiBjb25maWcubWF4UmVxdWVzdHMgLSAxLFxuICAgICAgcmVzZXRUaW1lOiBlbnRyeS5yZXNldFRpbWUsXG4gICAgICBzb3VyY2U6ICdtZW1vcnknLFxuICAgICAgbWV0cmljczoge1xuICAgICAgICByZXNwb25zZVRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgIGNhY2hlSGl0OiBmYWxzZSxcbiAgICAgICAga2V5R2VuZXJhdGVkOiBrZXlcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gSW5jcmVtZW50YXIgY29udGFkb3JcbiAgZW50cnkuY291bnQrKztcbiAgbWVtb3J5U3RvcmUuc2V0KGtleSwgZW50cnkpO1xuXG4gIGNvbnN0IGFsbG93ZWQgPSBlbnRyeS5jb3VudCA8PSBjb25maWcubWF4UmVxdWVzdHM7XG4gIGNvbnN0IHJlbWFpbmluZyA9IE1hdGgubWF4KDAsIGNvbmZpZy5tYXhSZXF1ZXN0cyAtIGVudHJ5LmNvdW50KTtcblxuICByZXR1cm4ge1xuICAgIGFsbG93ZWQsXG4gICAgbGltaXQ6IGNvbmZpZy5tYXhSZXF1ZXN0cyxcbiAgICByZW1haW5pbmcsXG4gICAgcmVzZXRUaW1lOiBlbnRyeS5yZXNldFRpbWUsXG4gICAgcmV0cnlBZnRlcjogYWxsb3dlZCA/IHVuZGVmaW5lZCA6IE1hdGguY2VpbCgoZW50cnkucmVzZXRUaW1lIC0gbm93KSAvIDEwMDApLFxuICAgIHNvdXJjZTogJ21lbW9yeScsXG4gICAgbWV0cmljczoge1xuICAgICAgcmVzcG9uc2VUaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgY2FjaGVIaXQ6IHRydWUsXG4gICAgICBrZXlHZW5lcmF0ZWQ6IGtleVxuICAgIH1cbiAgfTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZVTkNJw5NOIFBSSU5DSVBBTCBERSBSQVRFIExJTUlUSU5HXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEZ1bmNpw7NuIHByaW5jaXBhbCBkZSByYXRlIGxpbWl0aW5nIGVudGVycHJpc2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrRW50ZXJwcmlzZVJhdGVMaW1pdChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdCxcbiAgY29uZmlnTmFtZToga2V5b2YgdHlwZW9mIEVOVEVSUFJJU0VfUkFURV9MSU1JVF9DT05GSUdTLFxuICBjdXN0b21Db25maWc/OiBQYXJ0aWFsPEVudGVycHJpc2VSYXRlTGltaXRDb25maWc+XG4pOiBQcm9taXNlPEVudGVycHJpc2VSYXRlTGltaXRSZXN1bHQ+IHtcbiAgY29uc3QgYmFzZUNvbmZpZyA9IEVOVEVSUFJJU0VfUkFURV9MSU1JVF9DT05GSUdTW2NvbmZpZ05hbWVdO1xuXG4gIGlmICghYmFzZUNvbmZpZykge1xuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgbGltaXQ6IDEwMDAsXG4gICAgICByZW1haW5pbmc6IDk5OSxcbiAgICAgIHJlc2V0VGltZTogRGF0ZS5ub3coKSArIDYwMDAwLFxuICAgICAgZXJyb3I6IGBDb25maWd1cmFjacOzbiAnJHtjb25maWdOYW1lfScgbm8gZW5jb250cmFkYWAsXG4gICAgICBjb2RlOiAnQ09ORklHX05PVF9GT1VORCcsXG4gICAgICBzb3VyY2U6ICdlcnJvcidcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgY29uZmlnID0geyAuLi5iYXNlQ29uZmlnLCAuLi5jdXN0b21Db25maWcgfTtcbiAgY29uc3Qga2V5R2VuZXJhdG9yID0gY29uZmlnLmtleUdlbmVyYXRvciB8fCBoeWJyaWRLZXlHZW5lcmF0b3I7XG4gIGNvbnN0IGtleSA9IGtleUdlbmVyYXRvcihyZXF1ZXN0KTtcblxuICBsZXQgcmVzdWx0OiBFbnRlcnByaXNlUmF0ZUxpbWl0UmVzdWx0O1xuXG4gIHRyeSB7XG4gICAgLy8gSW50ZW50YXIgUmVkaXMgcHJpbWVybyBzaSBlc3TDoSBoYWJpbGl0YWRvXG4gICAgaWYgKGNvbmZpZy5lbmFibGVSZWRpcyAhPT0gZmFsc2UgJiYgYXdhaXQgaXNSZWRpc0F2YWlsYWJsZSgpKSB7XG4gICAgICByZXN1bHQgPSBhd2FpdCByYXRlTGltaXRXaXRoUmVkaXMoa2V5LCBjb25maWcpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHQgPSByYXRlTGltaXRXaXRoTWVtb3J5KGtleSwgY29uZmlnKTtcbiAgICB9XG5cbiAgICAvLyBSZWdpc3RyYXIgbcOpdHJpY2FzIHNpIGVzdMOhIGhhYmlsaXRhZG9cbiAgICBpZiAoY29uZmlnLmVuYWJsZU1ldHJpY3MpIHtcbiAgICAgIGNvbnN0IGlwID0gZ2V0Q2xpZW50SVAocmVxdWVzdCk7XG4gICAgICBjb25zdCBlbmRwb2ludCA9IGdldEVuZHBvaW50KHJlcXVlc3QpO1xuICAgICAgbWV0cmljc0NvbGxlY3Rvci5yZWNvcmRSZXF1ZXN0KHJlc3VsdCwgaXAsIGVuZHBvaW50KTtcbiAgICB9XG5cbiAgICAvLyBMb2dnaW5nIHNpIGVzdMOhIGhhYmlsaXRhZG9cbiAgICBpZiAoY29uZmlnLmVuYWJsZUxvZ2dpbmcpIHtcbiAgICAgIGlmICghcmVzdWx0LmFsbG93ZWQpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBbUkFURV9MSU1JVF0gTMOtbWl0ZSBleGNlZGlkbyBwYXJhICR7a2V5fTogJHtyZXN1bHQucmVtYWluaW5nfS8ke3Jlc3VsdC5saW1pdH1gKTtcblxuICAgICAgICAvLyBDYWxsYmFjayBwZXJzb25hbGl6YWRvIHNpIGVzdMOhIGRlZmluaWRvXG4gICAgICAgIGlmIChjb25maWcub25MaW1pdFJlYWNoZWQpIHtcbiAgICAgICAgICBjb25maWcub25MaW1pdFJlYWNoZWQoa2V5LCByZXF1ZXN0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1JBVEVfTElNSVRdIEVycm9yIGVuIGNoZWNrRW50ZXJwcmlzZVJhdGVMaW1pdDonLCBlcnJvcik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogdHJ1ZSwgLy8gUGVybWl0aXIgZW4gY2FzbyBkZSBlcnJvclxuICAgICAgbGltaXQ6IGNvbmZpZy5tYXhSZXF1ZXN0cyxcbiAgICAgIHJlbWFpbmluZzogY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgcmVzZXRUaW1lOiBEYXRlLm5vdygpICsgY29uZmlnLndpbmRvd01zLFxuICAgICAgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGVuIHJhdGUgbGltaXRpbmcnLFxuICAgICAgY29kZTogJ0lOVEVSTkFMX0VSUk9SJyxcbiAgICAgIHNvdXJjZTogJ2Vycm9yJ1xuICAgIH07XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJFTlRFUlBSSVNFX1JBVEVfTElNSVRfQ09ORklHUyIsImNoZWNrRW50ZXJwcmlzZVJhdGVMaW1pdCIsImVuZHBvaW50S2V5R2VuZXJhdG9yIiwiaHlicmlkS2V5R2VuZXJhdG9yIiwiaXBLZXlHZW5lcmF0b3IiLCJtZW1vcnlTdG9yZSIsIm1ldHJpY3NDb2xsZWN0b3IiLCJ1c2VyS2V5R2VuZXJhdG9yIiwiQ1JJVElDQUxfQVVUSCIsIndpbmRvd01zIiwibWF4UmVxdWVzdHMiLCJtZXNzYWdlIiwiZW5hYmxlUmVkaXMiLCJlbmFibGVNZXRyaWNzIiwiZW5hYmxlTG9nZ2luZyIsIkFETUlOX0FQSSIsIlBBWU1FTlRfQVBJIiwib25MaW1pdFJlYWNoZWQiLCJrZXkiLCJyZXF1ZXN0IiwiY29uc29sZSIsIndhcm4iLCJQVUJMSUNfQVBJIiwiV0VCSE9PS19BUEkiLCJTRUFSQ0hfQVBJIiwiVVBMT0FEX0FQSSIsIkRFQlVHX0FQSSIsImlwIiwiZ2V0Q2xpZW50SVAiLCJ1c2VySWQiLCJnZXRVc2VySWQiLCJlbmRwb2ludCIsImdldEVuZHBvaW50IiwidXNlclBhcnQiLCJoZWFkZXJzIiwiaGVhZGVyIiwiZ2V0IiwiaGVhZGVyVmFsdWUiLCJBcnJheSIsImlzQXJyYXkiLCJzcGxpdCIsInRyaW0iLCJlbnRlcnByaXNlQXV0aCIsImF1dGgiLCJuZXh0VXJsIiwicGF0aG5hbWUiLCJ1cmwiLCJVUkwiLCJNZW1vcnlSYXRlTGltaXRTdG9yZSIsInN0b3JlIiwiTWFwIiwiY2xlYW51cEludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJjbGVhbnVwIiwiZW50cnkiLCJEYXRlIiwibm93IiwicmVzZXRUaW1lIiwiZGVsZXRlIiwic2V0IiwiaW5jcmVtZW50IiwiY291bnQiLCJjbGVhbmVkIiwiZW50cmllcyIsImxvZyIsImdldFN0YXRzIiwic2l6ZSIsIm1lbW9yeVVzYWdlIiwiSlNPTiIsInN0cmluZ2lmeSIsImxlbmd0aCIsImNsZWFyIiwiZGVzdHJveSIsImNsZWFySW50ZXJ2YWwiLCJSYXRlTGltaXRNZXRyaWNzQ29sbGVjdG9yIiwicmVjb3JkUmVxdWVzdCIsInJlc3VsdCIsIm1ldHJpY3MiLCJ0b3RhbFJlcXVlc3RzIiwiYWxsb3dlZCIsImFsbG93ZWRSZXF1ZXN0cyIsImJsb2NrZWRSZXF1ZXN0cyIsImN1cnJlbnRDb3VudCIsImJsb2NrZWRJUHMiLCJzb3VyY2UiLCJyZWRpc0hpdHMiLCJtZW1vcnlGYWxsYmFja3MiLCJlcnJvcnMiLCJyZXNwb25zZVRpbWUiLCJyZXNwb25zZVRpbWVzIiwicHVzaCIsInNsaWNlIiwiYXZlcmFnZVJlc3BvbnNlVGltZSIsInJlZHVjZSIsImEiLCJiIiwiZW5kcG9pbnRDb3VudCIsImVuZHBvaW50Q291bnRzIiwidXBkYXRlVG9wTGlzdHMiLCJ0b3BCbG9ja2VkSVBzIiwiZnJvbSIsInNvcnQiLCJtYXAiLCJ0b3BFbmRwb2ludHMiLCJnZXRNZXRyaWNzIiwicmVzZXQiLCJyYXRlTGltaXRXaXRoUmVkaXMiLCJjb25maWciLCJzdGFydFRpbWUiLCJlbnRlcnByaXNlUmF0ZUxpbWl0IiwibGltaXQiLCJyZW1haW5pbmciLCJyZXRyeUFmdGVyIiwidW5kZWZpbmVkIiwiTWF0aCIsImNlaWwiLCJjYWNoZUhpdCIsImtleUdlbmVyYXRlZCIsInJlZGlzIiwid2luZG93IiwiZmxvb3IiLCJyZWRpc0tleSIsInBpcGVsaW5lIiwiaW5jciIsImV4cGlyZSIsInJlc3VsdHMiLCJleGVjIiwibWF4IiwiZXJyb3IiLCJyYXRlTGltaXRXaXRoTWVtb3J5IiwiZmlyc3RSZXF1ZXN0IiwiY29uZmlnTmFtZSIsImN1c3RvbUNvbmZpZyIsImJhc2VDb25maWciLCJjb2RlIiwia2V5R2VuZXJhdG9yIiwiaXNSZWRpc0F2YWlsYWJsZSJdLCJtYXBwaW5ncyI6IkFBQUE7OztDQUdDOzs7Ozs7Ozs7OztRQXlEWUE7ZUFBQUE7O1FBd2lCU0M7ZUFBQUE7O1FBemJOQztlQUFBQTs7UUFVQUM7ZUFBQUE7O1FBN0JBQztlQUFBQTs7UUFnVVBDO2VBQUFBOztRQUFhQztlQUFBQTs7UUF4VE5DO2VBQUFBOzs7dUJBekpzQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBcUQvQyxNQUFNUCxnQ0FBMkU7SUFDdEYsd0JBQXdCO0lBQ3hCUSxlQUFlO1FBQ2JDLFVBQVUsS0FBSyxLQUFLO1FBQ3BCQyxhQUFhO1FBQ2JDLFNBQVM7UUFDVEMsYUFBYTtRQUNiQyxlQUFlO1FBQ2ZDLGVBQWU7SUFDakI7SUFFQSxhQUFhO0lBQ2JDLFdBQVc7UUFDVE4sVUFBVSxJQUFJLEtBQUs7UUFDbkJDLGFBQWE7UUFDYkMsU0FBUztRQUNUQyxhQUFhO1FBQ2JDLGVBQWU7UUFDZkMsZUFBZTtJQUNqQjtJQUVBLGdCQUFnQjtJQUNoQkUsYUFBYTtRQUNYUCxVQUFVLEtBQUssS0FBSztRQUNwQkMsYUFBYTtRQUNiQyxTQUFTO1FBQ1RDLGFBQWE7UUFDYkMsZUFBZTtRQUNmQyxlQUFlO1FBQ2ZHLGdCQUFnQixDQUFDQyxLQUFLQztZQUNwQkMsUUFBUUMsSUFBSSxDQUFDLENBQUMsMENBQTBDLEVBQUVILEtBQUs7UUFDakU7SUFDRjtJQUVBLDZCQUE2QjtJQUM3QkksWUFBWTtRQUNWYixVQUFVLElBQUksS0FBSztRQUNuQkMsYUFBYTtRQUNiQyxTQUFTO1FB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