{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\hooks\\useAnalytics.test.ts"],"sourcesContent":["/**\n * useAnalytics Hook Tests\n * Enterprise-ready test suite for analytics tracking\n * Pinteya E-commerce\n */\n\nimport { renderHook, act } from '@testing-library/react';\nimport { useAnalytics, useRealTimeMetrics } from '@/hooks/useAnalytics';\nimport { analytics } from '@/lib/analytics';\n\n// Mock useAuth hook\njest.mock('@/hooks/useAuth', () => ({\n  useAuth: () => ({\n    user: { id: 'test-user-123', email: 'test@example.com' },\n    isLoaded: true,\n  }),\n}));\n\n// Mock usePathname\njest.mock('next/navigation', () => ({\n  usePathname: () => '/test-page',\n}));\n\n// Mock analytics lib\njest.mock('@/lib/analytics', () => ({\n  analytics: {\n    trackEvent: jest.fn().mockResolvedValue(undefined),\n    trackEcommerceEvent: jest.fn().mockResolvedValue(undefined),\n    trackPageView: jest.fn().mockResolvedValue(undefined),\n    trackConversion: jest.fn().mockResolvedValue(undefined),\n    trackProductView: jest.fn().mockResolvedValue(undefined),\n    trackAddToCart: jest.fn().mockResolvedValue(undefined),\n    trackRemoveFromCart: jest.fn().mockResolvedValue(undefined),\n    trackCheckoutStart: jest.fn().mockResolvedValue(undefined),\n    trackPurchase: jest.fn().mockResolvedValue(undefined),\n    trackSearch: jest.fn().mockResolvedValue(undefined),\n    getEvents: jest.fn(() => []),\n    getInteractions: jest.fn(() => []),\n    getConversionMetrics: jest.fn(() => ({\n      cartAdditions: 5,\n      cartRemovals: 1,\n      checkoutStarts: 3,\n      checkoutCompletions: 2,\n      productViews: 25,\n      categoryViews: 8,\n      searchQueries: 12,\n      conversionRate: 0.08,\n      averageOrderValue: 150.75,\n      cartAbandonmentRate: 0.33,\n    })),\n    getSessionId: jest.fn(() => 'test-session-123'),\n    initialize: jest.fn().mockResolvedValue(undefined),\n    enable: jest.fn(),\n    disable: jest.fn(),\n  },\n}));\n\n// Mock window.gtag\nObject.defineProperty(window, 'gtag', {\n  value: jest.fn(),\n  writable: true,\n});\n\ndescribe('useAnalytics Hook', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Initialization', () => {\n    it('should initialize with correct default state', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      expect(result.current.isEnabled).toBe(true);\n      expect(result.current.sessionMetrics).toBeDefined();\n      expect(typeof result.current.trackEvent).toBe('function');\n      expect(typeof result.current.trackPageView).toBe('function');\n      expect(typeof result.current.getSessionId).toBe('function');\n    });\n\n    it('should provide all required tracking functions', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      const expectedFunctions = [\n        'trackEvent',\n        'trackEcommerceEvent',\n        'trackPageView',\n        'trackConversion',\n        'trackProductView',\n        'trackAddToCart',\n        'trackRemoveFromCart',\n        'trackCheckoutStart',\n        'trackPurchase',\n        'trackSearch',\n      ];\n\n      expectedFunctions.forEach(funcName => {\n        expect(typeof result.current[funcName]).toBe('function');\n      });\n    });\n  });\n\n  describe('Event Tracking', () => {\n    it('should track generic events correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.trackEvent('test_event', 'test_category', 'test_action', 'test_label', 100);\n      });\n\n      expect(analytics.trackEvent).toHaveBeenCalledWith(\n        'test_event',\n        'test_category',\n        'test_action',\n        'test_label',\n        100,\n        undefined\n      );\n    });\n\n    it('should track product view events', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.trackProductView('prod-123', 'Test Product', 'Electronics', 99.99);\n      });\n\n      expect(analytics.trackProductView).toHaveBeenCalledWith(\n        'prod-123',\n        'Test Product',\n        'Electronics',\n        99.99\n      );\n    });\n\n    it('should track add to cart events', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.trackAddToCart('prod-123', 'Test Product', 99.99, 2);\n      });\n\n      expect(analytics.trackAddToCart).toHaveBeenCalledWith(\n        'prod-123',\n        'Test Product',\n        99.99,\n        2\n      );\n    });\n\n    it('should track checkout start events', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.trackCheckoutStart(299.98, 3);\n      });\n\n      expect(analytics.trackCheckoutStart).toHaveBeenCalledWith(299.98, 3);\n    });\n\n    it('should track purchase events', () => {\n      const { result } = renderHook(() => useAnalytics());\n      const mockItems = [{ id: 'item1', name: 'Product 1', price: 99.99 }];\n\n      act(() => {\n        result.current.trackPurchase('order-123', 299.98, mockItems);\n      });\n\n      expect(analytics.trackPurchase).toHaveBeenCalledWith('order-123', 299.98, mockItems);\n    });\n\n    it('should track search events', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.trackSearch('test query', 15);\n      });\n\n      expect(analytics.trackSearch).toHaveBeenCalledWith('test query', 15);\n    });\n  });\n\n  describe('Data Retrieval', () => {\n    it('should get events correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      const events = result.current.getEvents();\n      expect(analytics.getEvents).toHaveBeenCalled();\n      expect(Array.isArray(events)).toBe(true);\n    });\n\n    it('should get session ID correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      const sessionId = result.current.getSessionId();\n      expect(analytics.getSessionId).toHaveBeenCalled();\n      expect(sessionId).toBe('test-session-123');\n    });\n\n    it('should get conversion metrics correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      const metrics = result.current.getConversionMetrics();\n      expect(analytics.getConversionMetrics).toHaveBeenCalled();\n      expect(metrics).toEqual({\n        cartAdditions: 5,\n        cartRemovals: 1,\n        checkoutStarts: 3,\n        checkoutCompletions: 2,\n        productViews: 25,\n        categoryViews: 8,\n        searchQueries: 12,\n        conversionRate: 0.08,\n        averageOrderValue: 150.75,\n        cartAbandonmentRate: 0.33,\n      });\n    });\n  });\n\n  describe('State Management', () => {\n    it('should toggle enabled state correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      expect(result.current.isEnabled).toBe(true);\n\n      act(() => {\n        result.current.setEnabled(false);\n      });\n\n      expect(result.current.isEnabled).toBe(false);\n\n      act(() => {\n        result.current.setEnabled(true);\n      });\n\n      expect(result.current.isEnabled).toBe(true);\n    });\n\n    it('should refresh metrics correctly', () => {\n      const { result } = renderHook(() => useAnalytics());\n\n      act(() => {\n        result.current.refreshMetrics();\n      });\n\n      expect(analytics.getConversionMetrics).toHaveBeenCalled();\n    });\n  });\n});\n\ndescribe('useRealTimeMetrics Hook', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    jest.useFakeTimers();\n  });\n\n  afterEach(() => {\n    jest.useRealTimers();\n  });\n\n  it('should initialize with metrics from analytics', () => {\n    const { result } = renderHook(() => useRealTimeMetrics());\n\n    expect(result.current).toEqual({\n      cartAdditions: 5,\n      cartRemovals: 1,\n      checkoutStarts: 3,\n      checkoutCompletions: 2,\n      productViews: 25,\n      categoryViews: 8,\n      searchQueries: 12,\n      conversionRate: 0.08,\n      averageOrderValue: 150.75,\n      cartAbandonmentRate: 0.33,\n    });\n  });\n\n  it('should update metrics at specified interval', () => {\n    renderHook(() => useRealTimeMetrics(1000));\n\n    expect(analytics.getConversionMetrics).toHaveBeenCalledTimes(1);\n\n    act(() => {\n      jest.advanceTimersByTime(1000);\n    });\n\n    expect(analytics.getConversionMetrics).toHaveBeenCalledTimes(2);\n\n    act(() => {\n      jest.advanceTimersByTime(1000);\n    });\n\n    expect(analytics.getConversionMetrics).toHaveBeenCalledTimes(3);\n  });\n});\n\n// useComponentTracking tests skipped due to dependency on useOptimizedAnalytics\n// This hook will be tested separately when useOptimizedAnalytics is properly mocked"],"names":["jest","mock","useAuth","user","id","email","isLoaded","usePathname","analytics","trackEvent","fn","mockResolvedValue","undefined","trackEcommerceEvent","trackPageView","trackConversion","trackProductView","trackAddToCart","trackRemoveFromCart","trackCheckoutStart","trackPurchase","trackSearch","getEvents","getInteractions","getConversionMetrics","cartAdditions","cartRemovals","checkoutStarts","checkoutCompletions","productViews","categoryViews","searchQueries","conversionRate","averageOrderValue","cartAbandonmentRate","getSessionId","initialize","enable","disable","Object","defineProperty","window","value","writable","describe","beforeEach","clearAllMocks","it","result","renderHook","useAnalytics","expect","current","isEnabled","toBe","sessionMetrics","toBeDefined","expectedFunctions","forEach","funcName","act","toHaveBeenCalledWith","mockItems","name","price","events","toHaveBeenCalled","Array","isArray","sessionId","metrics","toEqual","setEnabled","refreshMetrics","useFakeTimers","afterEach","useRealTimers","useRealTimeMetrics","toHaveBeenCalledTimes","advanceTimersByTime"],"mappings":"AAAA;;;;CAIC;AAMD,oBAAoB;AACpBA,KAAKC,IAAI,CAAC,mBAAmB,IAAO,CAAA;QAClCC,SAAS,IAAO,CAAA;gBACdC,MAAM;oBAAEC,IAAI;oBAAiBC,OAAO;gBAAmB;gBACvDC,UAAU;YACZ,CAAA;IACF,CAAA;AAEA,mBAAmB;AACnBN,KAAKC,IAAI,CAAC,mBAAmB,IAAO,CAAA;QAClCM,aAAa,IAAM;IACrB,CAAA;AAEA,qBAAqB;AACrBP,KAAKC,IAAI,CAAC,mBAAmB,IAAO,CAAA;QAClCO,WAAW;YACTC,YAAYT,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YACxCC,qBAAqBb,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YACjDE,eAAed,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YAC3CG,iBAAiBf,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YAC7CI,kBAAkBhB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YAC9CK,gBAAgBjB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YAC5CM,qBAAqBlB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YACjDO,oBAAoBnB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YAChDQ,eAAepB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YAC3CS,aAAarB,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YACzCU,WAAWtB,KAAKU,EAAE,CAAC,IAAM,EAAE;YAC3Ba,iBAAiBvB,KAAKU,EAAE,CAAC,IAAM,EAAE;YACjCc,sBAAsBxB,KAAKU,EAAE,CAAC,IAAO,CAAA;oBACnCe,eAAe;oBACfC,cAAc;oBACdC,gBAAgB;oBAChBC,qBAAqB;oBACrBC,cAAc;oBACdC,eAAe;oBACfC,eAAe;oBACfC,gBAAgB;oBAChBC,mBAAmB;oBACnBC,qBAAqB;gBACvB,CAAA;YACAC,cAAcnC,KAAKU,EAAE,CAAC,IAAM;YAC5B0B,YAAYpC,KAAKU,EAAE,GAAGC,iBAAiB,CAACC;YACxCyB,QAAQrC,KAAKU,EAAE;YACf4B,SAAStC,KAAKU,EAAE;QAClB;IACF,CAAA;;;;uBAjDgC;8BACiB;2BACvB;AAiD1B,mBAAmB;AACnB6B,OAAOC,cAAc,CAACC,QAAQ,QAAQ;IACpCC,OAAO1C,KAAKU,EAAE;IACdiC,UAAU;AACZ;AAEAC,SAAS,qBAAqB;IAC5BC,WAAW;QACT7C,KAAK8C,aAAa;IACpB;IAEAF,SAAS,kBAAkB;QACzBG,GAAG,gDAAgD;YACjD,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhDC,OAAOH,OAAOI,OAAO,CAACC,SAAS,EAAEC,IAAI,CAAC;YACtCH,OAAOH,OAAOI,OAAO,CAACG,cAAc,EAAEC,WAAW;YACjDL,OAAO,OAAOH,OAAOI,OAAO,CAAC3C,UAAU,EAAE6C,IAAI,CAAC;YAC9CH,OAAO,OAAOH,OAAOI,OAAO,CAACtC,aAAa,EAAEwC,IAAI,CAAC;YACjDH,OAAO,OAAOH,OAAOI,OAAO,CAACjB,YAAY,EAAEmB,IAAI,CAAC;QAClD;QAEAP,GAAG,kDAAkD;YACnD,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhD,MAAMO,oBAAoB;gBACxB;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;aACD;YAEDA,kBAAkBC,OAAO,CAACC,CAAAA;gBACxBR,OAAO,OAAOH,OAAOI,OAAO,CAACO,SAAS,EAAEL,IAAI,CAAC;YAC/C;QACF;IACF;IAEAV,SAAS,kBAAkB;QACzBG,GAAG,yCAAyC;YAC1C,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhDU,IAAAA,UAAG,EAAC;gBACFZ,OAAOI,OAAO,CAAC3C,UAAU,CAAC,cAAc,iBAAiB,eAAe,cAAc;YACxF;YAEA0C,OAAO3C,oBAAS,CAACC,UAAU,EAAEoD,oBAAoB,CAC/C,cACA,iBACA,eACA,cACA,KACAjD;QAEJ;QAEAmC,GAAG,oCAAoC;YACrC,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhDU,IAAAA,UAAG,EAAC;gBACFZ,OAAOI,OAAO,CAACpC,gBAAgB,CAAC,YAAY,gBAAgB,eAAe;YAC7E;YAEAmC,OAAO3C,oBAAS,CAACQ,gBAAgB,EAAE6C,oBAAoB,CACrD,YACA,gBACA,eACA;QAEJ;QAEAd,GAAG,mCAAmC;YACpC,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhDU,IAAAA,UAAG,EAAC;gBACFZ,OAAOI,OAAO,CAACnC,cAAc,CAAC,YAAY,gBAAgB,OAAO;YACnE;YAEAkC,OAAO3C,oBAAS,CAACS,cAAc,EAAE4C,oBAAoB,CACnD,YACA,gBACA,OACA;QAEJ;QAEAd,GAAG,sCAAsC;YACvC,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhDU,IAAAA,UAAG,EAAC;gBACFZ,OAAOI,OAAO,CAACjC,kBAAkB,CAAC,QAAQ;YAC5C;YAEAgC,OAAO3C,oBAAS,CAACW,kBAAkB,EAAE0C,oBAAoB,CAAC,QAAQ;QACpE;QAEAd,GAAG,gCAAgC;YACjC,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAChD,MAAMY,YAAY;gBAAC;oBAAE1D,IAAI;oBAAS2D,MAAM;oBAAaC,OAAO;gBAAM;aAAE;YAEpEJ,IAAAA,UAAG,EAAC;gBACFZ,OAAOI,OAAO,CAAChC,aAAa,CAAC,aAAa,QAAQ0C;YACpD;YAEAX,OAAO3C,oBAAS,CAACY,aAAa,EAAEyC,oBAAoB,CAAC,aAAa,QAAQC;QAC5E;QAEAf,GAAG,8BAA8B;YAC/B,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhDU,IAAAA,UAAG,EAAC;gBACFZ,OAAOI,OAAO,CAAC/B,WAAW,CAAC,cAAc;YAC3C;YAEA8B,OAAO3C,oBAAS,CAACa,WAAW,EAAEwC,oBAAoB,CAAC,cAAc;QACnE;IACF;IAEAjB,SAAS,kBAAkB;QACzBG,GAAG,+BAA+B;YAChC,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhD,MAAMe,SAASjB,OAAOI,OAAO,CAAC9B,SAAS;YACvC6B,OAAO3C,oBAAS,CAACc,SAAS,EAAE4C,gBAAgB;YAC5Cf,OAAOgB,MAAMC,OAAO,CAACH,SAASX,IAAI,CAAC;QACrC;QAEAP,GAAG,mCAAmC;YACpC,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhD,MAAMmB,YAAYrB,OAAOI,OAAO,CAACjB,YAAY;YAC7CgB,OAAO3C,oBAAS,CAAC2B,YAAY,EAAE+B,gBAAgB;YAC/Cf,OAAOkB,WAAWf,IAAI,CAAC;QACzB;QAEAP,GAAG,2CAA2C;YAC5C,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhD,MAAMoB,UAAUtB,OAAOI,OAAO,CAAC5B,oBAAoB;YACnD2B,OAAO3C,oBAAS,CAACgB,oBAAoB,EAAE0C,gBAAgB;YACvDf,OAAOmB,SAASC,OAAO,CAAC;gBACtB9C,eAAe;gBACfC,cAAc;gBACdC,gBAAgB;gBAChBC,qBAAqB;gBACrBC,cAAc;gBACdC,eAAe;gBACfC,eAAe;gBACfC,gBAAgB;gBAChBC,mBAAmB;gBACnBC,qBAAqB;YACvB;QACF;IACF;IAEAU,SAAS,oBAAoB;QAC3BG,GAAG,yCAAyC;YAC1C,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhDC,OAAOH,OAAOI,OAAO,CAACC,SAAS,EAAEC,IAAI,CAAC;YAEtCM,IAAAA,UAAG,EAAC;gBACFZ,OAAOI,OAAO,CAACoB,UAAU,CAAC;YAC5B;YAEArB,OAAOH,OAAOI,OAAO,CAACC,SAAS,EAAEC,IAAI,CAAC;YAEtCM,IAAAA,UAAG,EAAC;gBACFZ,OAAOI,OAAO,CAACoB,UAAU,CAAC;YAC5B;YAEArB,OAAOH,OAAOI,OAAO,CAACC,SAAS,EAAEC,IAAI,CAAC;QACxC;QAEAP,GAAG,oCAAoC;YACrC,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,0BAAY;YAEhDU,IAAAA,UAAG,EAAC;gBACFZ,OAAOI,OAAO,CAACqB,cAAc;YAC/B;YAEAtB,OAAO3C,oBAAS,CAACgB,oBAAoB,EAAE0C,gBAAgB;QACzD;IACF;AACF;AAEAtB,SAAS,2BAA2B;IAClCC,WAAW;QACT7C,KAAK8C,aAAa;QAClB9C,KAAK0E,aAAa;IACpB;IAEAC,UAAU;QACR3E,KAAK4E,aAAa;IACpB;IAEA7B,GAAG,iDAAiD;QAClD,MAAM,EAAEC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAM4B,IAAAA,gCAAkB;QAEtD1B,OAAOH,OAAOI,OAAO,EAAEmB,OAAO,CAAC;YAC7B9C,eAAe;YACfC,cAAc;YACdC,gBAAgB;YAChBC,qBAAqB;YACrBC,cAAc;YACdC,eAAe;YACfC,eAAe;YACfC,gBAAgB;YAChBC,mBAAmB;YACnBC,qBAAqB;QACvB;IACF;IAEAa,GAAG,+CAA+C;QAChDE,IAAAA,iBAAU,EAAC,IAAM4B,IAAAA,gCAAkB,EAAC;QAEpC1B,OAAO3C,oBAAS,CAACgB,oBAAoB,EAAEsD,qBAAqB,CAAC;QAE7DlB,IAAAA,UAAG,EAAC;YACF5D,KAAK+E,mBAAmB,CAAC;QAC3B;QAEA5B,OAAO3C,oBAAS,CAACgB,oBAAoB,EAAEsD,qBAAqB,CAAC;QAE7DlB,IAAAA,UAAG,EAAC;YACF5D,KAAK+E,mBAAmB,CAAC;QAC3B;QAEA5B,OAAO3C,oBAAS,CAACgB,oBAAoB,EAAEsD,qBAAqB,CAAC;IAC/D;AACF,IAEA,gFAAgF;CAChF,oFAAoF"}