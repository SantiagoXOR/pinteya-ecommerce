037b13de56fcaea9fc27fd5432ad3233
// ===================================
// PINTEYA E-COMMERCE - CART HOOK WITH CLERK INTEGRATION
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    useCart: function() {
        return useCart;
    },
    useCartWithClerk: function() {
        return useCartWithClerk;
    }
});
const _react = require("react");
const _nextjs = require("@clerk/nextjs");
const _store = require("../redux/store");
const _cartslice = require("../redux/features/cart-slice");
const _cartPersistence = require("../redux/middleware/cartPersistence");
const useCartWithClerk = ()=>{
    const { user, isLoaded } = (0, _nextjs.useUser)();
    const dispatch = (0, _store.useAppDispatch)();
    const cartItems = (0, _store.useAppSelector)(_cartslice.selectCartItems);
    // Función para migrar carrito temporal a usuario autenticado
    const migrateCart = (0, _react.useCallback)(async (userId)=>{
        try {
            // Obtener items del localStorage
            const temporaryItems = (0, _cartPersistence.loadCartFromStorage)();
            if (temporaryItems.length > 0) {
                // Migrar items al backend (implementación futura)
                const migrationSuccess = await (0, _cartPersistence.migrateTemporaryCart)(temporaryItems, userId);
                if (migrationSuccess) {
                    // Limpiar localStorage después de migración exitosa
                    (0, _cartPersistence.clearCartFromStorage)();
                }
            }
            // Cargar carrito del usuario desde el backend (implementación futura)
            const userCartItems = await (0, _cartPersistence.loadUserCart)(userId);
            // Si hay items del usuario, reemplazar el carrito actual
            if (userCartItems.length > 0) {
                dispatch((0, _cartslice.replaceCart)(userCartItems));
            }
        } catch (error) {
            console.error('Error during cart migration:', error);
        }
    }, [
        dispatch
    ]);
    // Función para guardar carrito del usuario autenticado
    const saveCart = (0, _react.useCallback)(async (userId)=>{
        try {
            if (cartItems.length > 0) {
                await (0, _cartPersistence.saveUserCart)(userId, cartItems);
            }
        } catch (error) {
            console.error('Error saving user cart:', error);
        }
    }, [
        cartItems
    ]);
    // Efecto para manejar cambios en el estado de autenticación
    (0, _react.useEffect)(()=>{
        if (!isLoaded) return;
        if (user) {
            // Usuario autenticado - migrar carrito temporal si existe
            migrateCart(user.id);
        } else {
            // Usuario no autenticado - cargar desde localStorage
            const persistedItems = (0, _cartPersistence.loadCartFromStorage)();
            if (persistedItems.length > 0) {
                dispatch((0, _cartslice.hydrateCart)(persistedItems));
            }
        }
    }, [
        user,
        isLoaded,
        dispatch,
        migrateCart
    ]);
    // Efecto para guardar carrito de usuario autenticado cuando cambie
    (0, _react.useEffect)(()=>{
        if (!isLoaded || !user) return;
        // Debounce para evitar guardados excesivos
        const timeoutId = setTimeout(()=>{
            saveCart(user.id);
        }, 1000);
        return ()=>clearTimeout(timeoutId);
    }, [
        cartItems,
        user,
        isLoaded,
        saveCart
    ]);
    // Función para limpiar carrito al cerrar sesión
    const handleSignOut = (0, _react.useCallback)(()=>{
        dispatch((0, _cartslice.removeAllItemsFromCart)());
        (0, _cartPersistence.clearCartFromStorage)();
    }, [
        dispatch
    ]);
    return {
        isAuthenticated: !!user,
        userId: user?.id,
        cartItems,
        migrateCart,
        saveCart,
        handleSignOut
    };
};
const useCart = ()=>{
    const cartItems = (0, _store.useAppSelector)(_cartslice.selectCartItems);
    const dispatch = (0, _store.useAppDispatch)();
    return {
        cartItems,
        dispatch
    };
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZUNhcnRXaXRoQ2xlcmsudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gUElOVEVZQSBFLUNPTU1FUkNFIC0gQ0FSVCBIT09LIFdJVEggQ0xFUksgSU5URUdSQVRJT05cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCB7IHVzZVVzZXIgfSBmcm9tICdAY2xlcmsvbmV4dGpzJztcclxuaW1wb3J0IHsgdXNlQXBwRGlzcGF0Y2gsIHVzZUFwcFNlbGVjdG9yIH0gZnJvbSAnQC9yZWR1eC9zdG9yZSc7XHJcbmltcG9ydCB7IFxyXG4gIHNlbGVjdENhcnRJdGVtcywgXHJcbiAgaHlkcmF0ZUNhcnQsIFxyXG4gIHJlcGxhY2VDYXJ0LFxyXG4gIHJlbW92ZUFsbEl0ZW1zRnJvbUNhcnQgXHJcbn0gZnJvbSAnQC9yZWR1eC9mZWF0dXJlcy9jYXJ0LXNsaWNlJztcclxuaW1wb3J0IHsgXHJcbiAgbG9hZENhcnRGcm9tU3RvcmFnZSwgXHJcbiAgY2xlYXJDYXJ0RnJvbVN0b3JhZ2UsXHJcbiAgbWlncmF0ZVRlbXBvcmFyeUNhcnQsXHJcbiAgbG9hZFVzZXJDYXJ0LFxyXG4gIHNhdmVVc2VyQ2FydCBcclxufSBmcm9tICdAL3JlZHV4L21pZGRsZXdhcmUvY2FydFBlcnNpc3RlbmNlJztcclxuXHJcbi8vIEhvb2sgcGVyc29uYWxpemFkbyBwYXJhIG1hbmVqYXIgZWwgY2Fycml0byBjb24gaW50ZWdyYWNpw7NuIENsZXJrXHJcbmV4cG9ydCBjb25zdCB1c2VDYXJ0V2l0aENsZXJrID0gKCkgPT4ge1xyXG4gIGNvbnN0IHsgdXNlciwgaXNMb2FkZWQgfSA9IHVzZVVzZXIoKTtcclxuICBjb25zdCBkaXNwYXRjaCA9IHVzZUFwcERpc3BhdGNoKCk7XHJcbiAgY29uc3QgY2FydEl0ZW1zID0gdXNlQXBwU2VsZWN0b3Ioc2VsZWN0Q2FydEl0ZW1zKTtcclxuXHJcbiAgLy8gRnVuY2nDs24gcGFyYSBtaWdyYXIgY2Fycml0byB0ZW1wb3JhbCBhIHVzdWFyaW8gYXV0ZW50aWNhZG9cclxuICBjb25zdCBtaWdyYXRlQ2FydCA9IHVzZUNhbGxiYWNrKGFzeW5jICh1c2VySWQ6IHN0cmluZykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gT2J0ZW5lciBpdGVtcyBkZWwgbG9jYWxTdG9yYWdlXHJcbiAgICAgIGNvbnN0IHRlbXBvcmFyeUl0ZW1zID0gbG9hZENhcnRGcm9tU3RvcmFnZSgpO1xyXG4gICAgICBcclxuICAgICAgaWYgKHRlbXBvcmFyeUl0ZW1zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBcclxuICAgICAgICAvLyBNaWdyYXIgaXRlbXMgYWwgYmFja2VuZCAoaW1wbGVtZW50YWNpw7NuIGZ1dHVyYSlcclxuICAgICAgICBjb25zdCBtaWdyYXRpb25TdWNjZXNzID0gYXdhaXQgbWlncmF0ZVRlbXBvcmFyeUNhcnQodGVtcG9yYXJ5SXRlbXMsIHVzZXJJZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKG1pZ3JhdGlvblN1Y2Nlc3MpIHtcclxuICAgICAgICAgIC8vIExpbXBpYXIgbG9jYWxTdG9yYWdlIGRlc3B1w6lzIGRlIG1pZ3JhY2nDs24gZXhpdG9zYVxyXG4gICAgICAgICAgY2xlYXJDYXJ0RnJvbVN0b3JhZ2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIENhcmdhciBjYXJyaXRvIGRlbCB1c3VhcmlvIGRlc2RlIGVsIGJhY2tlbmQgKGltcGxlbWVudGFjacOzbiBmdXR1cmEpXHJcbiAgICAgIGNvbnN0IHVzZXJDYXJ0SXRlbXMgPSBhd2FpdCBsb2FkVXNlckNhcnQodXNlcklkKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFNpIGhheSBpdGVtcyBkZWwgdXN1YXJpbywgcmVlbXBsYXphciBlbCBjYXJyaXRvIGFjdHVhbFxyXG4gICAgICBpZiAodXNlckNhcnRJdGVtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgZGlzcGF0Y2gocmVwbGFjZUNhcnQodXNlckNhcnRJdGVtcykpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZHVyaW5nIGNhcnQgbWlncmF0aW9uOicsIGVycm9yKTtcclxuICAgIH1cclxuICB9LCBbZGlzcGF0Y2hdKTtcclxuXHJcbiAgLy8gRnVuY2nDs24gcGFyYSBndWFyZGFyIGNhcnJpdG8gZGVsIHVzdWFyaW8gYXV0ZW50aWNhZG9cclxuICBjb25zdCBzYXZlQ2FydCA9IHVzZUNhbGxiYWNrKGFzeW5jICh1c2VySWQ6IHN0cmluZykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKGNhcnRJdGVtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgYXdhaXQgc2F2ZVVzZXJDYXJ0KHVzZXJJZCwgY2FydEl0ZW1zKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2F2aW5nIHVzZXIgY2FydDonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfSwgW2NhcnRJdGVtc10pO1xyXG5cclxuICAvLyBFZmVjdG8gcGFyYSBtYW5lamFyIGNhbWJpb3MgZW4gZWwgZXN0YWRvIGRlIGF1dGVudGljYWNpw7NuXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmICghaXNMb2FkZWQpIHJldHVybjtcclxuXHJcbiAgICBpZiAodXNlcikge1xyXG4gICAgICAvLyBVc3VhcmlvIGF1dGVudGljYWRvIC0gbWlncmFyIGNhcnJpdG8gdGVtcG9yYWwgc2kgZXhpc3RlXHJcbiAgICAgIG1pZ3JhdGVDYXJ0KHVzZXIuaWQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gVXN1YXJpbyBubyBhdXRlbnRpY2FkbyAtIGNhcmdhciBkZXNkZSBsb2NhbFN0b3JhZ2VcclxuICAgICAgY29uc3QgcGVyc2lzdGVkSXRlbXMgPSBsb2FkQ2FydEZyb21TdG9yYWdlKCk7XHJcbiAgICAgIGlmIChwZXJzaXN0ZWRJdGVtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgZGlzcGF0Y2goaHlkcmF0ZUNhcnQocGVyc2lzdGVkSXRlbXMpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0sIFt1c2VyLCBpc0xvYWRlZCwgZGlzcGF0Y2gsIG1pZ3JhdGVDYXJ0XSk7XHJcblxyXG4gIC8vIEVmZWN0byBwYXJhIGd1YXJkYXIgY2Fycml0byBkZSB1c3VhcmlvIGF1dGVudGljYWRvIGN1YW5kbyBjYW1iaWVcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKCFpc0xvYWRlZCB8fCAhdXNlcikgcmV0dXJuO1xyXG5cclxuICAgIC8vIERlYm91bmNlIHBhcmEgZXZpdGFyIGd1YXJkYWRvcyBleGNlc2l2b3NcclxuICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBzYXZlQ2FydCh1c2VyLmlkKTtcclxuICAgIH0sIDEwMDApO1xyXG5cclxuICAgIHJldHVybiAoKSA9PiBjbGVhclRpbWVvdXQodGltZW91dElkKTtcclxuICB9LCBbY2FydEl0ZW1zLCB1c2VyLCBpc0xvYWRlZCwgc2F2ZUNhcnRdKTtcclxuXHJcbiAgLy8gRnVuY2nDs24gcGFyYSBsaW1waWFyIGNhcnJpdG8gYWwgY2VycmFyIHNlc2nDs25cclxuICBjb25zdCBoYW5kbGVTaWduT3V0ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xyXG4gICAgZGlzcGF0Y2gocmVtb3ZlQWxsSXRlbXNGcm9tQ2FydCgpKTtcclxuICAgIGNsZWFyQ2FydEZyb21TdG9yYWdlKCk7XHJcbiAgfSwgW2Rpc3BhdGNoXSk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBpc0F1dGhlbnRpY2F0ZWQ6ICEhdXNlcixcclxuICAgIHVzZXJJZDogdXNlcj8uaWQsXHJcbiAgICBjYXJ0SXRlbXMsXHJcbiAgICBtaWdyYXRlQ2FydCxcclxuICAgIHNhdmVDYXJ0LFxyXG4gICAgaGFuZGxlU2lnbk91dCxcclxuICB9O1xyXG59O1xyXG5cclxuLy8gSG9vayBzaW1wbGlmaWNhZG8gcGFyYSBjb21wb25lbnRlcyBxdWUgc29sbyBuZWNlc2l0YW4gZWwgZXN0YWRvIGRlbCBjYXJyaXRvXHJcbmV4cG9ydCBjb25zdCB1c2VDYXJ0ID0gKCkgPT4ge1xyXG4gIGNvbnN0IGNhcnRJdGVtcyA9IHVzZUFwcFNlbGVjdG9yKHNlbGVjdENhcnRJdGVtcyk7XHJcbiAgY29uc3QgZGlzcGF0Y2ggPSB1c2VBcHBEaXNwYXRjaCgpO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgY2FydEl0ZW1zLFxyXG4gICAgZGlzcGF0Y2gsXHJcbiAgfTtcclxufTtcclxuIl0sIm5hbWVzIjpbInVzZUNhcnQiLCJ1c2VDYXJ0V2l0aENsZXJrIiwidXNlciIsImlzTG9hZGVkIiwidXNlVXNlciIsImRpc3BhdGNoIiwidXNlQXBwRGlzcGF0Y2giLCJjYXJ0SXRlbXMiLCJ1c2VBcHBTZWxlY3RvciIsInNlbGVjdENhcnRJdGVtcyIsIm1pZ3JhdGVDYXJ0IiwidXNlQ2FsbGJhY2siLCJ1c2VySWQiLCJ0ZW1wb3JhcnlJdGVtcyIsImxvYWRDYXJ0RnJvbVN0b3JhZ2UiLCJsZW5ndGgiLCJtaWdyYXRpb25TdWNjZXNzIiwibWlncmF0ZVRlbXBvcmFyeUNhcnQiLCJjbGVhckNhcnRGcm9tU3RvcmFnZSIsInVzZXJDYXJ0SXRlbXMiLCJsb2FkVXNlckNhcnQiLCJyZXBsYWNlQ2FydCIsImVycm9yIiwiY29uc29sZSIsInNhdmVDYXJ0Iiwic2F2ZVVzZXJDYXJ0IiwidXNlRWZmZWN0IiwiaWQiLCJwZXJzaXN0ZWRJdGVtcyIsImh5ZHJhdGVDYXJ0IiwidGltZW91dElkIiwic2V0VGltZW91dCIsImNsZWFyVGltZW91dCIsImhhbmRsZVNpZ25PdXQiLCJyZW1vdmVBbGxJdGVtc0Zyb21DYXJ0IiwiaXNBdXRoZW50aWNhdGVkIl0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMsd0RBQXdEO0FBQ3hELHNDQUFzQzs7Ozs7Ozs7Ozs7O0lBK0d6QkEsT0FBTztlQUFQQTs7SUEzRkFDLGdCQUFnQjtlQUFoQkE7Ozt1QkFsQjBCO3dCQUNmO3VCQUN1QjsyQkFNeEM7aUNBT0E7QUFHQSxNQUFNQSxtQkFBbUI7SUFDOUIsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLFFBQVEsRUFBRSxHQUFHQyxJQUFBQSxlQUFPO0lBQ2xDLE1BQU1DLFdBQVdDLElBQUFBLHFCQUFjO0lBQy9CLE1BQU1DLFlBQVlDLElBQUFBLHFCQUFjLEVBQUNDLDBCQUFlO0lBRWhELDZEQUE2RDtJQUM3RCxNQUFNQyxjQUFjQyxJQUFBQSxrQkFBVyxFQUFDLE9BQU9DO1FBQ3JDLElBQUk7WUFDRixpQ0FBaUM7WUFDakMsTUFBTUMsaUJBQWlCQyxJQUFBQSxvQ0FBbUI7WUFFMUMsSUFBSUQsZUFBZUUsTUFBTSxHQUFHLEdBQUc7Z0JBRTdCLGtEQUFrRDtnQkFDbEQsTUFBTUMsbUJBQW1CLE1BQU1DLElBQUFBLHFDQUFvQixFQUFDSixnQkFBZ0JEO2dCQUVwRSxJQUFJSSxrQkFBa0I7b0JBQ3BCLG9EQUFvRDtvQkFDcERFLElBQUFBLHFDQUFvQjtnQkFDdEI7WUFDRjtZQUVBLHNFQUFzRTtZQUN0RSxNQUFNQyxnQkFBZ0IsTUFBTUMsSUFBQUEsNkJBQVksRUFBQ1I7WUFFekMseURBQXlEO1lBQ3pELElBQUlPLGNBQWNKLE1BQU0sR0FBRyxHQUFHO2dCQUM1QlYsU0FBU2dCLElBQUFBLHNCQUFXLEVBQUNGO1lBQ3ZCO1FBRUYsRUFBRSxPQUFPRyxPQUFPO1lBQ2RDLFFBQVFELEtBQUssQ0FBQyxnQ0FBZ0NBO1FBQ2hEO0lBQ0YsR0FBRztRQUFDakI7S0FBUztJQUViLHVEQUF1RDtJQUN2RCxNQUFNbUIsV0FBV2IsSUFBQUEsa0JBQVcsRUFBQyxPQUFPQztRQUNsQyxJQUFJO1lBQ0YsSUFBSUwsVUFBVVEsTUFBTSxHQUFHLEdBQUc7Z0JBQ3hCLE1BQU1VLElBQUFBLDZCQUFZLEVBQUNiLFFBQVFMO1lBQzdCO1FBQ0YsRUFBRSxPQUFPZSxPQUFPO1lBQ2RDLFFBQVFELEtBQUssQ0FBQywyQkFBMkJBO1FBQzNDO0lBQ0YsR0FBRztRQUFDZjtLQUFVO0lBRWQsNERBQTREO0lBQzVEbUIsSUFBQUEsZ0JBQVMsRUFBQztRQUNSLElBQUksQ0FBQ3ZCLFVBQVU7UUFFZixJQUFJRCxNQUFNO1lBQ1IsMERBQTBEO1lBQzFEUSxZQUFZUixLQUFLeUIsRUFBRTtRQUNyQixPQUFPO1lBQ0wscURBQXFEO1lBQ3JELE1BQU1DLGlCQUFpQmQsSUFBQUEsb0NBQW1CO1lBQzFDLElBQUljLGVBQWViLE1BQU0sR0FBRyxHQUFHO2dCQUM3QlYsU0FBU3dCLElBQUFBLHNCQUFXLEVBQUNEO1lBQ3ZCO1FBQ0Y7SUFDRixHQUFHO1FBQUMxQjtRQUFNQztRQUFVRTtRQUFVSztLQUFZO0lBRTFDLG1FQUFtRTtJQUNuRWdCLElBQUFBLGdCQUFTLEVBQUM7UUFDUixJQUFJLENBQUN2QixZQUFZLENBQUNELE1BQU07UUFFeEIsMkNBQTJDO1FBQzNDLE1BQU00QixZQUFZQyxXQUFXO1lBQzNCUCxTQUFTdEIsS0FBS3lCLEVBQUU7UUFDbEIsR0FBRztRQUVILE9BQU8sSUFBTUssYUFBYUY7SUFDNUIsR0FBRztRQUFDdkI7UUFBV0w7UUFBTUM7UUFBVXFCO0tBQVM7SUFFeEMsZ0RBQWdEO0lBQ2hELE1BQU1TLGdCQUFnQnRCLElBQUFBLGtCQUFXLEVBQUM7UUFDaENOLFNBQVM2QixJQUFBQSxpQ0FBc0I7UUFDL0JoQixJQUFBQSxxQ0FBb0I7SUFDdEIsR0FBRztRQUFDYjtLQUFTO0lBRWIsT0FBTztRQUNMOEIsaUJBQWlCLENBQUMsQ0FBQ2pDO1FBQ25CVSxRQUFRVixNQUFNeUI7UUFDZHBCO1FBQ0FHO1FBQ0FjO1FBQ0FTO0lBQ0Y7QUFDRjtBQUdPLE1BQU1qQyxVQUFVO0lBQ3JCLE1BQU1PLFlBQVlDLElBQUFBLHFCQUFjLEVBQUNDLDBCQUFlO0lBQ2hELE1BQU1KLFdBQVdDLElBQUFBLHFCQUFjO0lBRS9CLE9BQU87UUFDTEM7UUFDQUY7SUFDRjtBQUNGIn0=