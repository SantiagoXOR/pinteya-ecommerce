4495fd62c6f75ee542cbc61dcefb6ac4
// ===================================
// PINTEYA E-COMMERCE - API DE PRODUCTOS
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    GET: function() {
        return GET;
    },
    POST: function() {
        return POST;
    }
});
const _server = require("next/server");
const _supabase = require("../../../lib/supabase");
const _validations = require("../../../lib/validations");
async function GET(request) {
    try {
        const { searchParams } = new URL(request.url);
        // Extraer parámetros de query
        const queryParams = {
            category: searchParams.get('category') || undefined,
            brand: searchParams.get('brand') || undefined,
            priceMin: searchParams.get('priceMin') ? Number(searchParams.get('priceMin')) : undefined,
            priceMax: searchParams.get('priceMax') ? Number(searchParams.get('priceMax')) : undefined,
            search: searchParams.get('search') || undefined,
            page: searchParams.get('page') ? Number(searchParams.get('page')) : 1,
            limit: searchParams.get('limit') ? Number(searchParams.get('limit')) : 12,
            sortBy: searchParams.get('sortBy') || 'created_at',
            sortOrder: searchParams.get('sortOrder') || 'desc'
        };
        // Validar parámetros
        const filters = (0, _validations.validateData)(_validations.ProductFiltersSchema, queryParams);
        const supabase = (0, _supabase.getSupabaseClient)();
        // Verificar que el cliente de Supabase esté disponible
        if (!supabase) {
            console.error('Cliente de Supabase no disponible en GET /api/products');
            const errorResponse = {
                data: null,
                success: false,
                error: 'Servicio de base de datos no disponible'
            };
            return _server.NextResponse.json(errorResponse, {
                status: 503
            });
        }
        // Construir query base
        let query = supabase.from('products').select(`
        *,
        category:categories(id, name, slug)
      `, {
            count: 'exact'
        });
        // Aplicar filtros
        if (filters.category) {
            // Primero obtener el ID de la categoría por su slug
            const { data: categoryData } = await supabase.from('categories').select('id').eq('slug', filters.category).single();
            if (categoryData) {
                query = query.eq('category_id', categoryData.id);
            }
        }
        if (filters.brand) {
            query = query.eq('brand', filters.brand);
        }
        if (filters.priceMin) {
            query = query.gte('price', filters.priceMin);
        }
        if (filters.priceMax) {
            query = query.lte('price', filters.priceMax);
        }
        if (filters.search) {
            query = query.or(`name.ilike.%${filters.search}%,description.ilike.%${filters.search}%,brand.ilike.%${filters.search}%`);
        }
        // Solo productos con stock (temporalmente comentado para testing)
        // query = query.gt('stock', 0);
        // Ordenamiento
        const orderColumn = filters.sortBy === 'created_at' ? 'created_at' : filters.sortBy === 'brand' ? 'brand' : filters.sortBy || 'created_at';
        query = query.order(orderColumn, {
            ascending: filters.sortOrder === 'asc'
        });
        // Paginación
        const page = filters.page || 1;
        const limit = filters.limit || 10;
        const from = (page - 1) * limit;
        const to = from + limit - 1;
        query = query.range(from, to);
        // Ejecutar query
        const { data: products, error, count } = await query;
        if (error) {
            (0, _supabase.handleSupabaseError)(error, 'GET /api/products');
        }
        // Calcular información de paginación
        const totalPages = Math.ceil((count || 0) / limit);
        const response = {
            data: products || [],
            pagination: {
                page,
                limit,
                total: count || 0,
                totalPages
            },
            success: true,
            message: `${products?.length || 0} productos encontrados`
        };
        return _server.NextResponse.json(response);
    } catch (error) {
        console.error('Error en GET /api/products:', error);
        const errorResponse = {
            data: null,
            success: false,
            error: error.message || 'Error interno del servidor'
        };
        return _server.NextResponse.json(errorResponse, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        // TODO: Verificar permisos de administrador
        // const { userId } = auth();
        // if (!userId || !isAdmin(userId)) {
        //   return NextResponse.json({ error: 'No autorizado' }, { status: 401 });
        // }
        const body = await request.json();
        // Validar datos del producto
        const productData = (0, _validations.validateData)(_validations.ProductSchema, body);
        const supabase = (0, _supabase.getSupabaseClient)(true); // Usar cliente admin
        // Verificar que el cliente administrativo esté disponible
        if (!supabase) {
            console.error('Cliente administrativo de Supabase no disponible en POST /api/products');
            const errorResponse = {
                data: null,
                success: false,
                error: 'Servicio administrativo no disponible'
            };
            return _server.NextResponse.json(errorResponse, {
                status: 503
            });
        }
        // Crear slug si no se proporciona
        if (!productData.slug) {
            productData.slug = productData.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
        }
        // Insertar producto
        const { data: product, error } = await supabase.from('products').insert(productData).select(`
        *,
        category:categories(id, name, slug)
      `).single();
        if (error) {
            (0, _supabase.handleSupabaseError)(error, 'POST /api/products');
        }
        const response = {
            data: product,
            success: true,
            message: 'Producto creado exitosamente'
        };
        return _server.NextResponse.json(response, {
            status: 201
        });
    } catch (error) {
        console.error('Error en POST /api/products:', error);
        const errorResponse = {
            data: null,
            success: false,
            error: error.message || 'Error interno del servidor'
        };
        return _server.NextResponse.json(errorResponse, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXHByb2R1Y3RzXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQSU5URVlBIEUtQ09NTUVSQ0UgLSBBUEkgREUgUFJPRFVDVE9TXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBnZXRTdXBhYmFzZUNsaWVudCwgaGFuZGxlU3VwYWJhc2VFcnJvciB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcclxuaW1wb3J0IHsgdmFsaWRhdGVEYXRhLCBQcm9kdWN0RmlsdGVyc1NjaGVtYSwgUHJvZHVjdFNjaGVtYSB9IGZyb20gJ0AvbGliL3ZhbGlkYXRpb25zJztcclxuaW1wb3J0IHsgQXBpUmVzcG9uc2UsIFBhZ2luYXRlZFJlc3BvbnNlLCBQcm9kdWN0V2l0aENhdGVnb3J5IH0gZnJvbSAnQC90eXBlcy9hcGknO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gR0VUIC9hcGkvcHJvZHVjdHMgLSBPYnRlbmVyIHByb2R1Y3RvcyBjb24gZmlsdHJvc1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcclxuICAgIFxyXG4gICAgLy8gRXh0cmFlciBwYXLDoW1ldHJvcyBkZSBxdWVyeVxyXG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSB7XHJcbiAgICAgIGNhdGVnb3J5OiBzZWFyY2hQYXJhbXMuZ2V0KCdjYXRlZ29yeScpIHx8IHVuZGVmaW5lZCxcclxuICAgICAgYnJhbmQ6IHNlYXJjaFBhcmFtcy5nZXQoJ2JyYW5kJykgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBwcmljZU1pbjogc2VhcmNoUGFyYW1zLmdldCgncHJpY2VNaW4nKSA/IE51bWJlcihzZWFyY2hQYXJhbXMuZ2V0KCdwcmljZU1pbicpKSA6IHVuZGVmaW5lZCxcclxuICAgICAgcHJpY2VNYXg6IHNlYXJjaFBhcmFtcy5nZXQoJ3ByaWNlTWF4JykgPyBOdW1iZXIoc2VhcmNoUGFyYW1zLmdldCgncHJpY2VNYXgnKSkgOiB1bmRlZmluZWQsXHJcbiAgICAgIHNlYXJjaDogc2VhcmNoUGFyYW1zLmdldCgnc2VhcmNoJykgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBwYWdlOiBzZWFyY2hQYXJhbXMuZ2V0KCdwYWdlJykgPyBOdW1iZXIoc2VhcmNoUGFyYW1zLmdldCgncGFnZScpKSA6IDEsXHJcbiAgICAgIGxpbWl0OiBzZWFyY2hQYXJhbXMuZ2V0KCdsaW1pdCcpID8gTnVtYmVyKHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykpIDogMTIsXHJcbiAgICAgIHNvcnRCeTogc2VhcmNoUGFyYW1zLmdldCgnc29ydEJ5JykgYXMgJ3ByaWNlJyB8ICduYW1lJyB8ICdjcmVhdGVkX2F0JyB8ICdicmFuZCcgfHwgJ2NyZWF0ZWRfYXQnLFxyXG4gICAgICBzb3J0T3JkZXI6IHNlYXJjaFBhcmFtcy5nZXQoJ3NvcnRPcmRlcicpIGFzICdhc2MnIHwgJ2Rlc2MnIHx8ICdkZXNjJyxcclxuICAgIH07XHJcblxyXG4gICAgLy8gVmFsaWRhciBwYXLDoW1ldHJvc1xyXG4gICAgY29uc3QgZmlsdGVycyA9IHZhbGlkYXRlRGF0YShQcm9kdWN0RmlsdGVyc1NjaGVtYSwgcXVlcnlQYXJhbXMpO1xyXG4gICAgXHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XHJcblxyXG4gICAgLy8gVmVyaWZpY2FyIHF1ZSBlbCBjbGllbnRlIGRlIFN1cGFiYXNlIGVzdMOpIGRpc3BvbmlibGVcclxuICAgIGlmICghc3VwYWJhc2UpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignQ2xpZW50ZSBkZSBTdXBhYmFzZSBubyBkaXNwb25pYmxlIGVuIEdFVCAvYXBpL3Byb2R1Y3RzJyk7XHJcbiAgICAgIGNvbnN0IGVycm9yUmVzcG9uc2U6IEFwaVJlc3BvbnNlPG51bGw+ID0ge1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdTZXJ2aWNpbyBkZSBiYXNlIGRlIGRhdG9zIG5vIGRpc3BvbmlibGUnLFxyXG4gICAgICB9O1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oZXJyb3JSZXNwb25zZSwgeyBzdGF0dXM6IDUwMyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDb25zdHJ1aXIgcXVlcnkgYmFzZVxyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2R1Y3RzJylcclxuICAgICAgLnNlbGVjdChgXHJcbiAgICAgICAgKixcclxuICAgICAgICBjYXRlZ29yeTpjYXRlZ29yaWVzKGlkLCBuYW1lLCBzbHVnKVxyXG4gICAgICBgLCB7IGNvdW50OiAnZXhhY3QnIH0pO1xyXG5cclxuICAgIC8vIEFwbGljYXIgZmlsdHJvc1xyXG4gICAgaWYgKGZpbHRlcnMuY2F0ZWdvcnkpIHtcclxuICAgICAgLy8gUHJpbWVybyBvYnRlbmVyIGVsIElEIGRlIGxhIGNhdGVnb3LDrWEgcG9yIHN1IHNsdWdcclxuICAgICAgY29uc3QgeyBkYXRhOiBjYXRlZ29yeURhdGEgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oJ2NhdGVnb3JpZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAuZXEoJ3NsdWcnLCBmaWx0ZXJzLmNhdGVnb3J5KVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChjYXRlZ29yeURhdGEpIHtcclxuICAgICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjYXRlZ29yeV9pZCcsIGNhdGVnb3J5RGF0YS5pZCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoZmlsdGVycy5icmFuZCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdicmFuZCcsIGZpbHRlcnMuYnJhbmQpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLnByaWNlTWluKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZ3RlKCdwcmljZScsIGZpbHRlcnMucHJpY2VNaW4pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLnByaWNlTWF4KSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkubHRlKCdwcmljZScsIGZpbHRlcnMucHJpY2VNYXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLnNlYXJjaCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yKGBuYW1lLmlsaWtlLiUke2ZpbHRlcnMuc2VhcmNofSUsZGVzY3JpcHRpb24uaWxpa2UuJSR7ZmlsdGVycy5zZWFyY2h9JSxicmFuZC5pbGlrZS4lJHtmaWx0ZXJzLnNlYXJjaH0lYCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU29sbyBwcm9kdWN0b3MgY29uIHN0b2NrICh0ZW1wb3JhbG1lbnRlIGNvbWVudGFkbyBwYXJhIHRlc3RpbmcpXHJcbiAgICAvLyBxdWVyeSA9IHF1ZXJ5Lmd0KCdzdG9jaycsIDApO1xyXG5cclxuICAgIC8vIE9yZGVuYW1pZW50b1xyXG4gICAgY29uc3Qgb3JkZXJDb2x1bW4gPSBmaWx0ZXJzLnNvcnRCeSA9PT0gJ2NyZWF0ZWRfYXQnID8gJ2NyZWF0ZWRfYXQnIDpcclxuICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzLnNvcnRCeSA9PT0gJ2JyYW5kJyA/ICdicmFuZCcgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgIChmaWx0ZXJzLnNvcnRCeSB8fCAnY3JlYXRlZF9hdCcpO1xyXG4gICAgcXVlcnkgPSBxdWVyeS5vcmRlcihvcmRlckNvbHVtbiwgeyBhc2NlbmRpbmc6IGZpbHRlcnMuc29ydE9yZGVyID09PSAnYXNjJyB9KTtcclxuXHJcbiAgICAvLyBQYWdpbmFjacOzblxyXG4gICAgY29uc3QgcGFnZSA9IGZpbHRlcnMucGFnZSB8fCAxO1xyXG4gICAgY29uc3QgbGltaXQgPSBmaWx0ZXJzLmxpbWl0IHx8IDEwO1xyXG4gICAgY29uc3QgZnJvbSA9IChwYWdlIC0gMSkgKiBsaW1pdDtcclxuICAgIGNvbnN0IHRvID0gZnJvbSArIGxpbWl0IC0gMTtcclxuICAgIHF1ZXJ5ID0gcXVlcnkucmFuZ2UoZnJvbSwgdG8pO1xyXG5cclxuICAgIC8vIEVqZWN1dGFyIHF1ZXJ5XHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2R1Y3RzLCBlcnJvciwgY291bnQgfSA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBoYW5kbGVTdXBhYmFzZUVycm9yKGVycm9yLCAnR0VUIC9hcGkvcHJvZHVjdHMnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDYWxjdWxhciBpbmZvcm1hY2nDs24gZGUgcGFnaW5hY2nDs25cclxuICAgIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwoKGNvdW50IHx8IDApIC8gbGltaXQpO1xyXG5cclxuICAgIGNvbnN0IHJlc3BvbnNlOiBQYWdpbmF0ZWRSZXNwb25zZTxQcm9kdWN0V2l0aENhdGVnb3J5PiA9IHtcclxuICAgICAgZGF0YTogcHJvZHVjdHMgfHwgW10sXHJcbiAgICAgIHBhZ2luYXRpb246IHtcclxuICAgICAgICBwYWdlLFxyXG4gICAgICAgIGxpbWl0LFxyXG4gICAgICAgIHRvdGFsOiBjb3VudCB8fCAwLFxyXG4gICAgICAgIHRvdGFsUGFnZXMsXHJcbiAgICAgIH0sXHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIG1lc3NhZ2U6IGAke3Byb2R1Y3RzPy5sZW5ndGggfHwgMH0gcHJvZHVjdG9zIGVuY29udHJhZG9zYCxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3BvbnNlKTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gR0VUIC9hcGkvcHJvZHVjdHM6JywgZXJyb3IpO1xyXG4gICAgXHJcbiAgICBjb25zdCBlcnJvclJlc3BvbnNlOiBBcGlSZXNwb25zZTxudWxsPiA9IHtcclxuICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicsXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihlcnJvclJlc3BvbnNlLCB7IHN0YXR1czogNTAwIH0pO1xyXG4gIH1cclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gUE9TVCAvYXBpL3Byb2R1Y3RzIC0gQ3JlYXIgcHJvZHVjdG8gKEFkbWluKVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBUT0RPOiBWZXJpZmljYXIgcGVybWlzb3MgZGUgYWRtaW5pc3RyYWRvclxyXG4gICAgLy8gY29uc3QgeyB1c2VySWQgfSA9IGF1dGgoKTtcclxuICAgIC8vIGlmICghdXNlcklkIHx8ICFpc0FkbWluKHVzZXJJZCkpIHtcclxuICAgIC8vICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdObyBhdXRvcml6YWRvJyB9LCB7IHN0YXR1czogNDAxIH0pO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcclxuICAgIFxyXG4gICAgLy8gVmFsaWRhciBkYXRvcyBkZWwgcHJvZHVjdG9cclxuICAgIGNvbnN0IHByb2R1Y3REYXRhID0gdmFsaWRhdGVEYXRhKFByb2R1Y3RTY2hlbWEsIGJvZHkpO1xyXG4gICAgXHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlQ2xpZW50KHRydWUpOyAvLyBVc2FyIGNsaWVudGUgYWRtaW5cclxuXHJcbiAgICAvLyBWZXJpZmljYXIgcXVlIGVsIGNsaWVudGUgYWRtaW5pc3RyYXRpdm8gZXN0w6kgZGlzcG9uaWJsZVxyXG4gICAgaWYgKCFzdXBhYmFzZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdDbGllbnRlIGFkbWluaXN0cmF0aXZvIGRlIFN1cGFiYXNlIG5vIGRpc3BvbmlibGUgZW4gUE9TVCAvYXBpL3Byb2R1Y3RzJyk7XHJcbiAgICAgIGNvbnN0IGVycm9yUmVzcG9uc2U6IEFwaVJlc3BvbnNlPG51bGw+ID0ge1xyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdTZXJ2aWNpbyBhZG1pbmlzdHJhdGl2byBubyBkaXNwb25pYmxlJyxcclxuICAgICAgfTtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGVycm9yUmVzcG9uc2UsIHsgc3RhdHVzOiA1MDMgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXIgc2x1ZyBzaSBubyBzZSBwcm9wb3JjaW9uYVxyXG4gICAgaWYgKCFwcm9kdWN0RGF0YS5zbHVnKSB7XHJcbiAgICAgIHByb2R1Y3REYXRhLnNsdWcgPSBwcm9kdWN0RGF0YS5uYW1lXHJcbiAgICAgICAgLnRvTG93ZXJDYXNlKClcclxuICAgICAgICAucmVwbGFjZSgvW15hLXowLTldKy9nLCAnLScpXHJcbiAgICAgICAgLnJlcGxhY2UoLyheLXwtJCkvZywgJycpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEluc2VydGFyIHByb2R1Y3RvXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2R1Y3QsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgncHJvZHVjdHMnKVxyXG4gICAgICAuaW5zZXJ0KHByb2R1Y3REYXRhKVxyXG4gICAgICAuc2VsZWN0KGBcclxuICAgICAgICAqLFxyXG4gICAgICAgIGNhdGVnb3J5OmNhdGVnb3JpZXMoaWQsIG5hbWUsIHNsdWcpXHJcbiAgICAgIGApXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgaGFuZGxlU3VwYWJhc2VFcnJvcihlcnJvciwgJ1BPU1QgL2FwaS9wcm9kdWN0cycpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlc3BvbnNlOiBBcGlSZXNwb25zZTxQcm9kdWN0V2l0aENhdGVnb3J5PiA9IHtcclxuICAgICAgZGF0YTogcHJvZHVjdCxcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogJ1Byb2R1Y3RvIGNyZWFkbyBleGl0b3NhbWVudGUnLFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzcG9uc2UsIHsgc3RhdHVzOiAyMDEgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIFBPU1QgL2FwaS9wcm9kdWN0czonLCBlcnJvcik7XHJcbiAgICBcclxuICAgIGNvbnN0IGVycm9yUmVzcG9uc2U6IEFwaVJlc3BvbnNlPG51bGw+ID0ge1xyXG4gICAgICBkYXRhOiBudWxsLFxyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGVycm9yUmVzcG9uc2UsIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJHRVQiLCJQT1NUIiwicmVxdWVzdCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInF1ZXJ5UGFyYW1zIiwiY2F0ZWdvcnkiLCJnZXQiLCJ1bmRlZmluZWQiLCJicmFuZCIsInByaWNlTWluIiwiTnVtYmVyIiwicHJpY2VNYXgiLCJzZWFyY2giLCJwYWdlIiwibGltaXQiLCJzb3J0QnkiLCJzb3J0T3JkZXIiLCJmaWx0ZXJzIiwidmFsaWRhdGVEYXRhIiwiUHJvZHVjdEZpbHRlcnNTY2hlbWEiLCJzdXBhYmFzZSIsImdldFN1cGFiYXNlQ2xpZW50IiwiY29uc29sZSIsImVycm9yIiwiZXJyb3JSZXNwb25zZSIsImRhdGEiLCJzdWNjZXNzIiwiTmV4dFJlc3BvbnNlIiwianNvbiIsInN0YXR1cyIsInF1ZXJ5IiwiZnJvbSIsInNlbGVjdCIsImNvdW50IiwiY2F0ZWdvcnlEYXRhIiwiZXEiLCJzaW5nbGUiLCJpZCIsImd0ZSIsImx0ZSIsIm9yIiwib3JkZXJDb2x1bW4iLCJvcmRlciIsImFzY2VuZGluZyIsInRvIiwicmFuZ2UiLCJwcm9kdWN0cyIsImhhbmRsZVN1cGFiYXNlRXJyb3IiLCJ0b3RhbFBhZ2VzIiwiTWF0aCIsImNlaWwiLCJyZXNwb25zZSIsInBhZ2luYXRpb24iLCJ0b3RhbCIsIm1lc3NhZ2UiLCJsZW5ndGgiLCJib2R5IiwicHJvZHVjdERhdGEiLCJQcm9kdWN0U2NoZW1hIiwic2x1ZyIsIm5hbWUiLCJ0b0xvd2VyQ2FzZSIsInJlcGxhY2UiLCJwcm9kdWN0IiwiaW5zZXJ0Il0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMsd0NBQXdDO0FBQ3hDLHNDQUFzQzs7Ozs7Ozs7Ozs7O0lBVWhCQSxHQUFHO2VBQUhBOztJQStIQUMsSUFBSTtlQUFKQTs7O3dCQXZJb0I7MEJBQ2E7NkJBQ1c7QUFNM0QsZUFBZUQsSUFBSUUsT0FBb0I7SUFD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