e3fcf9b6d97d4c848ab377d9dfc97753
/**
 * Sistema de Rate Limiting para APIs
 * Implementa límites de velocidad para prevenir ataques de fuerza bruta
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get RATE_LIMIT_CONFIGS () {
        return RATE_LIMIT_CONFIGS;
    },
    get checkRateLimit () {
        return checkRateLimit;
    },
    get clearRateLimit () {
        return clearRateLimit;
    },
    get getRateLimitStats () {
        return getRateLimitStats;
    },
    get withAdminRateLimit () {
        return withAdminRateLimit;
    },
    get withAuthRateLimit () {
        return withAuthRateLimit;
    },
    get withPaymentRateLimit () {
        return withPaymentRateLimit;
    },
    get withProductRateLimit () {
        return withProductRateLimit;
    },
    get withRateLimit () {
        return withRateLimit;
    }
});
const RATE_LIMIT_CONFIGS = {
    // APIs de autenticación - muy restrictivo
    auth: {
        windowMs: 15 * 60 * 1000,
        maxRequests: 5,
        message: 'Demasiados intentos de autenticación. Intenta de nuevo en 15 minutos.'
    },
    // APIs admin - restrictivo (temporalmente aumentado para pruebas)
    admin: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 100,
        message: 'Demasiadas requests administrativas. Intenta de nuevo en 1 minuto.'
    },
    // APIs de productos - moderado
    products: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 60,
        message: 'Demasiadas requests de productos. Intenta de nuevo en 1 minuto.'
    },
    // APIs de pagos - muy restrictivo
    payments: {
        windowMs: 10 * 60 * 1000,
        maxRequests: 10,
        message: 'Demasiadas requests de pagos. Intenta de nuevo en 10 minutos.'
    },
    // APIs generales - permisivo
    general: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 100,
        message: 'Demasiadas requests. Intenta de nuevo en 1 minuto.'
    }
};
// =====================================================
// ALMACENAMIENTO EN MEMORIA (Compatible con Edge Runtime)
// =====================================================
const rateLimitStore = new Map();
// Limpiar entradas expiradas cada 5 minutos
// Solo en Node.js runtime, no en Edge Runtime
if (typeof setInterval !== 'undefined' && typeof process !== 'undefined' && process.env.NODE_ENV !== 'production') {
    setInterval(()=>{
        const now = Date.now();
        for (const [key, entry] of rateLimitStore.entries()){
            if (entry.resetTime < now) {
                rateLimitStore.delete(key);
            }
        }
    }, 5 * 60 * 1000);
}
// =====================================================
// FUNCIONES DE RATE LIMITING
// =====================================================
/**
 * Genera una clave única para el rate limiting
 */ function generateRateLimitKey(request, prefix = 'default') {
    // Obtener IP del cliente
    let clientIP = 'unknown';
    if ('ip' in request && request.ip) {
        clientIP = request.ip;
    } else if ('headers' in request) {
        // Intentar obtener IP de headers
        const forwarded = getHeader(request, 'x-forwarded-for');
        const realIP = getHeader(request, 'x-real-ip');
        const cfIP = getHeader(request, 'cf-connecting-ip');
        clientIP = forwarded?.split(',')[0] || realIP || cfIP || 'unknown';
    }
    // Obtener User-Agent para mayor especificidad
    const userAgent = getHeader(request, 'user-agent') || 'unknown';
    const userAgentHash = hashString(userAgent);
    return `${prefix}:${clientIP}:${userAgentHash}`;
}
/**
 * Obtiene un header de manera compatible
 */ function getHeader(request, headerName) {
    if ('headers' in request && typeof request.headers.get === 'function') {
        return request.headers.get(headerName);
    } else if ('headers' in request) {
        const header = request.headers[headerName];
        return Array.isArray(header) ? header[0] : header || null;
    }
    return null;
}
/**
 * Hash simple para User-Agent
 */ function hashString(str) {
    let hash = 0;
    for(let i = 0; i < str.length; i++){
        const char = str.charCodeAt(i);
        hash = (hash << 5) - hash + char;
        hash = hash & hash; // Convertir a 32-bit integer
    }
    return Math.abs(hash).toString(36);
}
async function checkRateLimit(request, config, keyPrefix = 'api') {
    // Bypass temporal para pruebas de desarrollo
    if (process.env.NODE_ENV === 'development' && keyPrefix === 'admin-orders') {
        return {
            allowed: true,
            limit: config.maxRequests,
            remaining: config.maxRequests,
            resetTime: Date.now() + config.windowMs
        };
    }
    try {
        const now = Date.now();
        const key = config.keyGenerator ? config.keyGenerator(request) : generateRateLimitKey(request, keyPrefix);
        // Obtener entrada actual o crear nueva
        let entry = rateLimitStore.get(key);
        if (!entry || entry.resetTime < now) {
            // Crear nueva entrada
            entry = {
                count: 1,
                resetTime: now + config.windowMs,
                firstRequest: now
            };
            rateLimitStore.set(key, entry);
            return {
                allowed: true,
                limit: config.maxRequests,
                remaining: config.maxRequests - 1,
                resetTime: entry.resetTime
            };
        }
        // Incrementar contador
        entry.count++;
        rateLimitStore.set(key, entry);
        // Verificar si excede el límite
        if (entry.count > config.maxRequests) {
            const retryAfter = Math.ceil((entry.resetTime - now) / 1000);
            return {
                allowed: false,
                limit: config.maxRequests,
                remaining: 0,
                resetTime: entry.resetTime,
                retryAfter,
                error: config.message || 'Rate limit exceeded',
                code: 'RATE_LIMIT_EXCEEDED'
            };
        }
        return {
            allowed: true,
            limit: config.maxRequests,
            remaining: config.maxRequests - entry.count,
            resetTime: entry.resetTime
        };
    } catch (error) {
        console.error('[RATE_LIMIT] Error en verificación:', error);
        // En caso de error, permitir la request pero loggear
        return {
            allowed: true,
            limit: config.maxRequests,
            remaining: config.maxRequests,
            resetTime: Date.now() + config.windowMs,
            error: 'Error interno en rate limiting'
        };
    }
}
function withRateLimit(configName, customConfig) {
    const baseConfig = RATE_LIMIT_CONFIGS[configName];
    const config = {
        ...baseConfig,
        ...customConfig
    };
    return function(handler) {
        return async (request, ...args)=>{
            try {
                const rateLimitResult = await checkRateLimit(request, config, configName);
                // Añadir headers de rate limiting
                const headers = {
                    'X-RateLimit-Limit': rateLimitResult.limit.toString(),
                    'X-RateLimit-Remaining': rateLimitResult.remaining.toString(),
                    'X-RateLimit-Reset': Math.ceil(rateLimitResult.resetTime / 1000).toString()
                };
                if (rateLimitResult.retryAfter) {
                    headers['Retry-After'] = rateLimitResult.retryAfter.toString();
                }
                if (!rateLimitResult.allowed) {
                    const errorResponse = {
                        success: false,
                        error: rateLimitResult.error,
                        code: rateLimitResult.code,
                        rateLimit: {
                            limit: rateLimitResult.limit,
                            remaining: rateLimitResult.remaining,
                            resetTime: rateLimitResult.resetTime,
                            retryAfter: rateLimitResult.retryAfter
                        }
                    };
                    if ('query' in request) {
                        // Pages Router
                        const res = args[0];
                        Object.entries(headers).forEach(([key, value])=>{
                            res.setHeader(key, value);
                        });
                        return res.status(429).json(errorResponse);
                    } else {
                        // App Router
                        return new Response(JSON.stringify(errorResponse), {
                            status: 429,
                            headers: {
                                'Content-Type': 'application/json',
                                ...headers
                            }
                        });
                    }
                }
                // Añadir información de rate limiting al request
                request.rateLimit = rateLimitResult;
                // Ejecutar handler original
                const response = await handler(request, ...args);
                // Añadir headers a la respuesta si es posible
                if (response && typeof response.headers?.set === 'function') {
                    Object.entries(headers).forEach(([key, value])=>{
                        response.headers.set(key, value);
                    });
                }
                return response;
            } catch (error) {
                console.error('[RATE_LIMIT] Error en middleware:', error);
                return handler(request, ...args);
            }
        };
    };
}
function withAuthRateLimit() {
    return withRateLimit('auth');
}
function withAdminRateLimit() {
    return withRateLimit('admin');
}
function withProductRateLimit() {
    return withRateLimit('products');
}
function withPaymentRateLimit() {
    return withRateLimit('payments');
}
function clearRateLimit(key) {
    return rateLimitStore.delete(key);
}
function getRateLimitStats() {
    const now = Date.now();
    const entries = Array.from(rateLimitStore.values());
    const activeEntries = entries.filter((entry)=>entry.resetTime > now);
    return {
        totalKeys: rateLimitStore.size,
        activeEntries: activeEntries.length,
        oldestEntry: entries.length > 0 ? Math.min(...entries.map((e)=>e.firstRequest)) : null,
        newestEntry: entries.length > 0 ? Math.max(...entries.map((e)=>e.firstRequest)) : null
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhdXRoXFxyYXRlLWxpbWl0aW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2lzdGVtYSBkZSBSYXRlIExpbWl0aW5nIHBhcmEgQVBJc1xuICogSW1wbGVtZW50YSBsw61taXRlcyBkZSB2ZWxvY2lkYWQgcGFyYSBwcmV2ZW5pciBhdGFxdWVzIGRlIGZ1ZXJ6YSBicnV0YVxuICovXG5cbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCB9IGZyb20gJ25leHQnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVElQT1MgWSBJTlRFUkZBQ0VTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFJhdGVMaW1pdFJlc3VsdCB7XG4gIGFsbG93ZWQ6IGJvb2xlYW47XG4gIGxpbWl0OiBudW1iZXI7XG4gIHJlbWFpbmluZzogbnVtYmVyO1xuICByZXNldFRpbWU6IG51bWJlcjtcbiAgcmV0cnlBZnRlcj86IG51bWJlcjtcbiAgZXJyb3I/OiBzdHJpbmc7XG4gIGNvZGU/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmF0ZUxpbWl0Q29uZmlnIHtcbiAgd2luZG93TXM6IG51bWJlcjsgIC8vIFZlbnRhbmEgZGUgdGllbXBvIGVuIG1pbGlzZWd1bmRvc1xuICBtYXhSZXF1ZXN0czogbnVtYmVyOyAgLy8gTcOheGltbyBuw7ptZXJvIGRlIHJlcXVlc3RzIHBvciB2ZW50YW5hXG4gIGtleUdlbmVyYXRvcj86IChyZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0KSA9PiBzdHJpbmc7XG4gIHNraXBTdWNjZXNzZnVsUmVxdWVzdHM/OiBib29sZWFuO1xuICBza2lwRmFpbGVkUmVxdWVzdHM/OiBib29sZWFuO1xuICBtZXNzYWdlPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJhdGVMaW1pdEVudHJ5IHtcbiAgY291bnQ6IG51bWJlcjtcbiAgcmVzZXRUaW1lOiBudW1iZXI7XG4gIGZpcnN0UmVxdWVzdDogbnVtYmVyO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09ORklHVVJBQ0lPTkVTIERFIFJBVEUgTElNSVRJTkdcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBjb25zdCBSQVRFX0xJTUlUX0NPTkZJR1MgPSB7XG4gIC8vIEFQSXMgZGUgYXV0ZW50aWNhY2nDs24gLSBtdXkgcmVzdHJpY3Rpdm9cbiAgYXV0aDoge1xuICAgIHdpbmRvd01zOiAxNSAqIDYwICogMTAwMCwgLy8gMTUgbWludXRvc1xuICAgIG1heFJlcXVlc3RzOiA1LCAvLyA1IGludGVudG9zIHBvciAxNSBtaW51dG9zXG4gICAgbWVzc2FnZTogJ0RlbWFzaWFkb3MgaW50ZW50b3MgZGUgYXV0ZW50aWNhY2nDs24uIEludGVudGEgZGUgbnVldm8gZW4gMTUgbWludXRvcy4nXG4gIH0sXG4gIFxuICAvLyBBUElzIGFkbWluIC0gcmVzdHJpY3Rpdm8gKHRlbXBvcmFsbWVudGUgYXVtZW50YWRvIHBhcmEgcHJ1ZWJhcylcbiAgYWRtaW46IHtcbiAgICB3aW5kb3dNczogMSAqIDYwICogMTAwMCwgLy8gMSBtaW51dG9cbiAgICBtYXhSZXF1ZXN0czogMTAwLCAvLyAxMDAgcmVxdWVzdHMgcG9yIG1pbnV0b1xuICAgIG1lc3NhZ2U6ICdEZW1hc2lhZGFzIHJlcXVlc3RzIGFkbWluaXN0cmF0aXZhcy4gSW50ZW50YSBkZSBudWV2byBlbiAxIG1pbnV0by4nXG4gIH0sXG4gIFxuICAvLyBBUElzIGRlIHByb2R1Y3RvcyAtIG1vZGVyYWRvXG4gIHByb2R1Y3RzOiB7XG4gICAgd2luZG93TXM6IDEgKiA2MCAqIDEwMDAsIC8vIDEgbWludXRvXG4gICAgbWF4UmVxdWVzdHM6IDYwLCAvLyA2MCByZXF1ZXN0cyBwb3IgbWludXRvXG4gICAgbWVzc2FnZTogJ0RlbWFzaWFkYXMgcmVxdWVzdHMgZGUgcHJvZHVjdG9zLiBJbnRlbnRhIGRlIG51ZXZvIGVuIDEgbWludXRvLidcbiAgfSxcbiAgXG4gIC8vIEFQSXMgZGUgcGFnb3MgLSBtdXkgcmVzdHJpY3Rpdm9cbiAgcGF5bWVudHM6IHtcbiAgICB3aW5kb3dNczogMTAgKiA2MCAqIDEwMDAsIC8vIDEwIG1pbnV0b3NcbiAgICBtYXhSZXF1ZXN0czogMTAsIC8vIDEwIHJlcXVlc3RzIHBvciAxMCBtaW51dG9zXG4gICAgbWVzc2FnZTogJ0RlbWFzaWFkYXMgcmVxdWVzdHMgZGUgcGFnb3MuIEludGVudGEgZGUgbnVldm8gZW4gMTAgbWludXRvcy4nXG4gIH0sXG4gIFxuICAvLyBBUElzIGdlbmVyYWxlcyAtIHBlcm1pc2l2b1xuICBnZW5lcmFsOiB7XG4gICAgd2luZG93TXM6IDEgKiA2MCAqIDEwMDAsIC8vIDEgbWludXRvXG4gICAgbWF4UmVxdWVzdHM6IDEwMCwgLy8gMTAwIHJlcXVlc3RzIHBvciBtaW51dG9cbiAgICBtZXNzYWdlOiAnRGVtYXNpYWRhcyByZXF1ZXN0cy4gSW50ZW50YSBkZSBudWV2byBlbiAxIG1pbnV0by4nXG4gIH1cbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBTE1BQ0VOQU1JRU5UTyBFTiBNRU1PUklBIChDb21wYXRpYmxlIGNvbiBFZGdlIFJ1bnRpbWUpXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCByYXRlTGltaXRTdG9yZSA9IG5ldyBNYXA8c3RyaW5nLCBSYXRlTGltaXRFbnRyeT4oKTtcblxuLy8gTGltcGlhciBlbnRyYWRhcyBleHBpcmFkYXMgY2FkYSA1IG1pbnV0b3Ncbi8vIFNvbG8gZW4gTm9kZS5qcyBydW50aW1lLCBubyBlbiBFZGdlIFJ1bnRpbWVcbmlmICh0eXBlb2Ygc2V0SW50ZXJ2YWwgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gIHNldEludGVydmFsKCgpID0+IHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGZvciAoY29uc3QgW2tleSwgZW50cnldIG9mIHJhdGVMaW1pdFN0b3JlLmVudHJpZXMoKSkge1xuICAgICAgaWYgKGVudHJ5LnJlc2V0VGltZSA8IG5vdykge1xuICAgICAgICByYXRlTGltaXRTdG9yZS5kZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIDUgKiA2MCAqIDEwMDApO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRlVOQ0lPTkVTIERFIFJBVEUgTElNSVRJTkdcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogR2VuZXJhIHVuYSBjbGF2ZSDDum5pY2EgcGFyYSBlbCByYXRlIGxpbWl0aW5nXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlUmF0ZUxpbWl0S2V5KFxuICByZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0LFxuICBwcmVmaXg6IHN0cmluZyA9ICdkZWZhdWx0J1xuKTogc3RyaW5nIHtcbiAgLy8gT2J0ZW5lciBJUCBkZWwgY2xpZW50ZVxuICBsZXQgY2xpZW50SVAgPSAndW5rbm93bic7XG4gIFxuICBpZiAoJ2lwJyBpbiByZXF1ZXN0ICYmIHJlcXVlc3QuaXApIHtcbiAgICBjbGllbnRJUCA9IHJlcXVlc3QuaXA7XG4gIH0gZWxzZSBpZiAoJ2hlYWRlcnMnIGluIHJlcXVlc3QpIHtcbiAgICAvLyBJbnRlbnRhciBvYnRlbmVyIElQIGRlIGhlYWRlcnNcbiAgICBjb25zdCBmb3J3YXJkZWQgPSBnZXRIZWFkZXIocmVxdWVzdCwgJ3gtZm9yd2FyZGVkLWZvcicpO1xuICAgIGNvbnN0IHJlYWxJUCA9IGdldEhlYWRlcihyZXF1ZXN0LCAneC1yZWFsLWlwJyk7XG4gICAgY29uc3QgY2ZJUCA9IGdldEhlYWRlcihyZXF1ZXN0LCAnY2YtY29ubmVjdGluZy1pcCcpO1xuICAgIFxuICAgIGNsaWVudElQID0gZm9yd2FyZGVkPy5zcGxpdCgnLCcpWzBdIHx8IHJlYWxJUCB8fCBjZklQIHx8ICd1bmtub3duJztcbiAgfVxuXG4gIC8vIE9idGVuZXIgVXNlci1BZ2VudCBwYXJhIG1heW9yIGVzcGVjaWZpY2lkYWRcbiAgY29uc3QgdXNlckFnZW50ID0gZ2V0SGVhZGVyKHJlcXVlc3QsICd1c2VyLWFnZW50JykgfHwgJ3Vua25vd24nO1xuICBjb25zdCB1c2VyQWdlbnRIYXNoID0gaGFzaFN0cmluZyh1c2VyQWdlbnQpO1xuXG4gIHJldHVybiBgJHtwcmVmaXh9OiR7Y2xpZW50SVB9OiR7dXNlckFnZW50SGFzaH1gO1xufVxuXG4vKipcbiAqIE9idGllbmUgdW4gaGVhZGVyIGRlIG1hbmVyYSBjb21wYXRpYmxlXG4gKi9cbmZ1bmN0aW9uIGdldEhlYWRlcihcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdCxcbiAgaGVhZGVyTmFtZTogc3RyaW5nXG4pOiBzdHJpbmcgfCBudWxsIHtcbiAgaWYgKCdoZWFkZXJzJyBpbiByZXF1ZXN0ICYmIHR5cGVvZiByZXF1ZXN0LmhlYWRlcnMuZ2V0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIChyZXF1ZXN0IGFzIE5leHRSZXF1ZXN0KS5oZWFkZXJzLmdldChoZWFkZXJOYW1lKTtcbiAgfSBlbHNlIGlmICgnaGVhZGVycycgaW4gcmVxdWVzdCkge1xuICAgIGNvbnN0IGhlYWRlciA9IChyZXF1ZXN0IGFzIE5leHRBcGlSZXF1ZXN0KS5oZWFkZXJzW2hlYWRlck5hbWVdO1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KGhlYWRlcikgPyBoZWFkZXJbMF0gOiBoZWFkZXIgfHwgbnVsbDtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBIYXNoIHNpbXBsZSBwYXJhIFVzZXItQWdlbnRcbiAqL1xuZnVuY3Rpb24gaGFzaFN0cmluZyhzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gIGxldCBoYXNoID0gMDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBjaGFyID0gc3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgY2hhcjtcbiAgICBoYXNoID0gaGFzaCAmIGhhc2g7IC8vIENvbnZlcnRpciBhIDMyLWJpdCBpbnRlZ2VyXG4gIH1cbiAgcmV0dXJuIE1hdGguYWJzKGhhc2gpLnRvU3RyaW5nKDM2KTtcbn1cblxuLyoqXG4gKiBWZXJpZmljYSBzaSB1bmEgcmVxdWVzdCBlc3TDoSBkZW50cm8gZGUgbG9zIGzDrW1pdGVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1JhdGVMaW1pdChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdCxcbiAgY29uZmlnOiBSYXRlTGltaXRDb25maWcsXG4gIGtleVByZWZpeDogc3RyaW5nID0gJ2FwaSdcbik6IFByb21pc2U8UmF0ZUxpbWl0UmVzdWx0PiB7XG4gIC8vIEJ5cGFzcyB0ZW1wb3JhbCBwYXJhIHBydWViYXMgZGUgZGVzYXJyb2xsb1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgJiYga2V5UHJlZml4ID09PSAnYWRtaW4tb3JkZXJzJykge1xuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgbGltaXQ6IGNvbmZpZy5tYXhSZXF1ZXN0cyxcbiAgICAgIHJlbWFpbmluZzogY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgcmVzZXRUaW1lOiBEYXRlLm5vdygpICsgY29uZmlnLndpbmRvd01zXG4gICAgfTtcbiAgfVxuICBcbiAgdHJ5IHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGtleSA9IGNvbmZpZy5rZXlHZW5lcmF0b3IgXG4gICAgICA/IGNvbmZpZy5rZXlHZW5lcmF0b3IocmVxdWVzdClcbiAgICAgIDogZ2VuZXJhdGVSYXRlTGltaXRLZXkocmVxdWVzdCwga2V5UHJlZml4KTtcblxuICAgIC8vIE9idGVuZXIgZW50cmFkYSBhY3R1YWwgbyBjcmVhciBudWV2YVxuICAgIGxldCBlbnRyeSA9IHJhdGVMaW1pdFN0b3JlLmdldChrZXkpO1xuICAgIFxuICAgIGlmICghZW50cnkgfHwgZW50cnkucmVzZXRUaW1lIDwgbm93KSB7XG4gICAgICAvLyBDcmVhciBudWV2YSBlbnRyYWRhXG4gICAgICBlbnRyeSA9IHtcbiAgICAgICAgY291bnQ6IDEsXG4gICAgICAgIHJlc2V0VGltZTogbm93ICsgY29uZmlnLndpbmRvd01zLFxuICAgICAgICBmaXJzdFJlcXVlc3Q6IG5vd1xuICAgICAgfTtcbiAgICAgIHJhdGVMaW1pdFN0b3JlLnNldChrZXksIGVudHJ5KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgICAgbGltaXQ6IGNvbmZpZy5tYXhSZXF1ZXN0cyxcbiAgICAgICAgcmVtYWluaW5nOiBjb25maWcubWF4UmVxdWVzdHMgLSAxLFxuICAgICAgICByZXNldFRpbWU6IGVudHJ5LnJlc2V0VGltZVxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBJbmNyZW1lbnRhciBjb250YWRvclxuICAgIGVudHJ5LmNvdW50Kys7XG4gICAgcmF0ZUxpbWl0U3RvcmUuc2V0KGtleSwgZW50cnkpO1xuXG4gICAgLy8gVmVyaWZpY2FyIHNpIGV4Y2VkZSBlbCBsw61taXRlXG4gICAgaWYgKGVudHJ5LmNvdW50ID4gY29uZmlnLm1heFJlcXVlc3RzKSB7XG4gICAgICBjb25zdCByZXRyeUFmdGVyID0gTWF0aC5jZWlsKChlbnRyeS5yZXNldFRpbWUgLSBub3cpIC8gMTAwMCk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgICBsaW1pdDogY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgICByZW1haW5pbmc6IDAsXG4gICAgICAgIHJlc2V0VGltZTogZW50cnkucmVzZXRUaW1lLFxuICAgICAgICByZXRyeUFmdGVyLFxuICAgICAgICBlcnJvcjogY29uZmlnLm1lc3NhZ2UgfHwgJ1JhdGUgbGltaXQgZXhjZWVkZWQnLFxuICAgICAgICBjb2RlOiAnUkFURV9MSU1JVF9FWENFRURFRCdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFsbG93ZWQ6IHRydWUsXG4gICAgICBsaW1pdDogY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgcmVtYWluaW5nOiBjb25maWcubWF4UmVxdWVzdHMgLSBlbnRyeS5jb3VudCxcbiAgICAgIHJlc2V0VGltZTogZW50cnkucmVzZXRUaW1lXG4gICAgfTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tSQVRFX0xJTUlUXSBFcnJvciBlbiB2ZXJpZmljYWNpw7NuOicsIGVycm9yKTtcbiAgICBcbiAgICAvLyBFbiBjYXNvIGRlIGVycm9yLCBwZXJtaXRpciBsYSByZXF1ZXN0IHBlcm8gbG9nZ2VhclxuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiB0cnVlLFxuICAgICAgbGltaXQ6IGNvbmZpZy5tYXhSZXF1ZXN0cyxcbiAgICAgIHJlbWFpbmluZzogY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgcmVzZXRUaW1lOiBEYXRlLm5vdygpICsgY29uZmlnLndpbmRvd01zLFxuICAgICAgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGVuIHJhdGUgbGltaXRpbmcnXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIE1pZGRsZXdhcmUgZGUgcmF0ZSBsaW1pdGluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gd2l0aFJhdGVMaW1pdChcbiAgY29uZmlnTmFtZToga2V5b2YgdHlwZW9mIFJBVEVfTElNSVRfQ09ORklHUyxcbiAgY3VzdG9tQ29uZmlnPzogUGFydGlhbDxSYXRlTGltaXRDb25maWc+XG4pIHtcbiAgY29uc3QgYmFzZUNvbmZpZyA9IFJBVEVfTElNSVRfQ09ORklHU1tjb25maWdOYW1lXTtcbiAgY29uc3QgY29uZmlnID0geyAuLi5iYXNlQ29uZmlnLCAuLi5jdXN0b21Db25maWcgfTtcblxuICByZXR1cm4gZnVuY3Rpb24gKGhhbmRsZXI6IEZ1bmN0aW9uKSB7XG4gICAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0LCAuLi5hcmdzOiBhbnlbXSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmF0ZUxpbWl0UmVzdWx0ID0gYXdhaXQgY2hlY2tSYXRlTGltaXQocmVxdWVzdCwgY29uZmlnLCBjb25maWdOYW1lKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEHDsWFkaXIgaGVhZGVycyBkZSByYXRlIGxpbWl0aW5nXG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICAgICAgJ1gtUmF0ZUxpbWl0LUxpbWl0JzogcmF0ZUxpbWl0UmVzdWx0LmxpbWl0LnRvU3RyaW5nKCksXG4gICAgICAgICAgJ1gtUmF0ZUxpbWl0LVJlbWFpbmluZyc6IHJhdGVMaW1pdFJlc3VsdC5yZW1haW5pbmcudG9TdHJpbmcoKSxcbiAgICAgICAgICAnWC1SYXRlTGltaXQtUmVzZXQnOiBNYXRoLmNlaWwocmF0ZUxpbWl0UmVzdWx0LnJlc2V0VGltZSAvIDEwMDApLnRvU3RyaW5nKClcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAocmF0ZUxpbWl0UmVzdWx0LnJldHJ5QWZ0ZXIpIHtcbiAgICAgICAgICBoZWFkZXJzWydSZXRyeS1BZnRlciddID0gcmF0ZUxpbWl0UmVzdWx0LnJldHJ5QWZ0ZXIudG9TdHJpbmcoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghcmF0ZUxpbWl0UmVzdWx0LmFsbG93ZWQpIHtcbiAgICAgICAgICBjb25zdCBlcnJvclJlc3BvbnNlID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogcmF0ZUxpbWl0UmVzdWx0LmVycm9yLFxuICAgICAgICAgICAgY29kZTogcmF0ZUxpbWl0UmVzdWx0LmNvZGUsXG4gICAgICAgICAgICByYXRlTGltaXQ6IHtcbiAgICAgICAgICAgICAgbGltaXQ6IHJhdGVMaW1pdFJlc3VsdC5saW1pdCxcbiAgICAgICAgICAgICAgcmVtYWluaW5nOiByYXRlTGltaXRSZXN1bHQucmVtYWluaW5nLFxuICAgICAgICAgICAgICByZXNldFRpbWU6IHJhdGVMaW1pdFJlc3VsdC5yZXNldFRpbWUsXG4gICAgICAgICAgICAgIHJldHJ5QWZ0ZXI6IHJhdGVMaW1pdFJlc3VsdC5yZXRyeUFmdGVyXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGlmICgncXVlcnknIGluIHJlcXVlc3QpIHtcbiAgICAgICAgICAgIC8vIFBhZ2VzIFJvdXRlclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXJnc1swXSBhcyBhbnk7XG4gICAgICAgICAgICBPYmplY3QuZW50cmllcyhoZWFkZXJzKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcihrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDI5KS5qc29uKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBBcHAgUm91dGVyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KGVycm9yUmVzcG9uc2UpLCB7XG4gICAgICAgICAgICAgIHN0YXR1czogNDI5LFxuICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICAuLi5oZWFkZXJzXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEHDsWFkaXIgaW5mb3JtYWNpw7NuIGRlIHJhdGUgbGltaXRpbmcgYWwgcmVxdWVzdFxuICAgICAgICAocmVxdWVzdCBhcyBhbnkpLnJhdGVMaW1pdCA9IHJhdGVMaW1pdFJlc3VsdDtcblxuICAgICAgICAvLyBFamVjdXRhciBoYW5kbGVyIG9yaWdpbmFsXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LCAuLi5hcmdzKTtcblxuICAgICAgICAvLyBBw7FhZGlyIGhlYWRlcnMgYSBsYSByZXNwdWVzdGEgc2kgZXMgcG9zaWJsZVxuICAgICAgICBpZiAocmVzcG9uc2UgJiYgdHlwZW9mIHJlc3BvbnNlLmhlYWRlcnM/LnNldCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGhlYWRlcnMpLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICAgICAgcmVzcG9uc2UuaGVhZGVycy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG5cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tSQVRFX0xJTUlUXSBFcnJvciBlbiBtaWRkbGV3YXJlOicsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIGhhbmRsZXIocmVxdWVzdCwgLi4uYXJncyk7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcbn1cblxuLyoqXG4gKiBSYXRlIGxpbWl0aW5nIGVzcGVjw61maWNvIHBhcmEgQVBJcyBkZSBhdXRlbnRpY2FjacOzblxuICovXG5leHBvcnQgZnVuY3Rpb24gd2l0aEF1dGhSYXRlTGltaXQoKSB7XG4gIHJldHVybiB3aXRoUmF0ZUxpbWl0KCdhdXRoJyk7XG59XG5cbi8qKlxuICogUmF0ZSBsaW1pdGluZyBlc3BlY8OtZmljbyBwYXJhIEFQSXMgYWRtaW5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhBZG1pblJhdGVMaW1pdCgpIHtcbiAgcmV0dXJuIHdpdGhSYXRlTGltaXQoJ2FkbWluJyk7XG59XG5cbi8qKlxuICogUmF0ZSBsaW1pdGluZyBlc3BlY8OtZmljbyBwYXJhIEFQSXMgZGUgcHJvZHVjdG9zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoUHJvZHVjdFJhdGVMaW1pdCgpIHtcbiAgcmV0dXJuIHdpdGhSYXRlTGltaXQoJ3Byb2R1Y3RzJyk7XG59XG5cbi8qKlxuICogUmF0ZSBsaW1pdGluZyBlc3BlY8OtZmljbyBwYXJhIEFQSXMgZGUgcGFnb3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhQYXltZW50UmF0ZUxpbWl0KCkge1xuICByZXR1cm4gd2l0aFJhdGVMaW1pdCgncGF5bWVudHMnKTtcbn1cblxuLyoqXG4gKiBGdW5jacOzbiBwYXJhIGxpbXBpYXIgbWFudWFsbWVudGUgZWwgcmF0ZSBsaW1pdCBkZSB1bmEgY2xhdmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyUmF0ZUxpbWl0KGtleTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiByYXRlTGltaXRTdG9yZS5kZWxldGUoa2V5KTtcbn1cblxuLyoqXG4gKiBGdW5jacOzbiBwYXJhIG9idGVuZXIgZXN0YWTDrXN0aWNhcyBkZSByYXRlIGxpbWl0aW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRSYXRlTGltaXRTdGF0cygpOiB7XG4gIHRvdGFsS2V5czogbnVtYmVyO1xuICBhY3RpdmVFbnRyaWVzOiBudW1iZXI7XG4gIG9sZGVzdEVudHJ5OiBudW1iZXIgfCBudWxsO1xuICBuZXdlc3RFbnRyeTogbnVtYmVyIHwgbnVsbDtcbn0ge1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBjb25zdCBlbnRyaWVzID0gQXJyYXkuZnJvbShyYXRlTGltaXRTdG9yZS52YWx1ZXMoKSk7XG4gIGNvbnN0IGFjdGl2ZUVudHJpZXMgPSBlbnRyaWVzLmZpbHRlcihlbnRyeSA9PiBlbnRyeS5yZXNldFRpbWUgPiBub3cpO1xuICBcbiAgcmV0dXJuIHtcbiAgICB0b3RhbEtleXM6IHJhdGVMaW1pdFN0b3JlLnNpemUsXG4gICAgYWN0aXZlRW50cmllczogYWN0aXZlRW50cmllcy5sZW5ndGgsXG4gICAgb2xkZXN0RW50cnk6IGVudHJpZXMubGVuZ3RoID4gMCA/IE1hdGgubWluKC4uLmVudHJpZXMubWFwKGUgPT4gZS5maXJzdFJlcXVlc3QpKSA6IG51bGwsXG4gICAgbmV3ZXN0RW50cnk6IGVudHJpZXMubGVuZ3RoID4gMCA/IE1hdGgubWF4KC4uLmVudHJpZXMubWFwKGUgPT4gZS5maXJzdFJlcXVlc3QpKSA6IG51bGxcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJSQVRFX0xJTUlUX0NPTkZJR1MiLCJjaGVja1JhdGVMaW1pdCIsImNsZWFyUmF0ZUxpbWl0IiwiZ2V0UmF0ZUxpbWl0U3RhdHMiLCJ3aXRoQWRtaW5SYXRlTGltaXQiLCJ3aXRoQXV0aFJhdGVMaW1pdCIsIndpdGhQYXltZW50UmF0ZUxpbWl0Iiwid2l0aFByb2R1Y3RSYXRlTGltaXQiLCJ3aXRoUmF0ZUxpbWl0IiwiYXV0aCIsIndpbmRvd01zIiwibWF4UmVxdWVzdHMiLCJtZXNzYWdlIiwiYWRtaW4iLCJwcm9kdWN0cyIsInBheW1lbnRzIiwiZ2VuZXJhbCIsInJhdGVMaW1pdFN0b3JlIiwiTWFwIiwic2V0SW50ZXJ2YWwiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJub3ciLCJEYXRlIiwia2V5IiwiZW50cnkiLCJlbnRyaWVzIiwicmVzZXRUaW1lIiwiZGVsZXRlIiwiZ2VuZXJhdGVSYXRlTGltaXRLZXkiLCJyZXF1ZXN0IiwicHJlZml4IiwiY2xpZW50SVAiLCJpcCIsImZvcndhcmRlZCIsImdldEhlYWRlciIsInJlYWxJUCIsImNmSVAiLCJzcGxpdCIsInVzZXJBZ2VudCIsInVzZXJBZ2VudEhhc2giLCJoYXNoU3RyaW5nIiwiaGVhZGVyTmFtZSIsImhlYWRlcnMiLCJnZXQiLCJoZWFkZXIiLCJBcnJheSIsImlzQXJyYXkiLCJzdHIiLCJoYXNoIiwiaSIsImxlbmd0aCIsImNoYXIiLCJjaGFyQ29kZUF0IiwiTWF0aCIsImFicyIsInRvU3RyaW5nIiwiY29uZmlnIiwia2V5UHJlZml4IiwiYWxsb3dlZCIsImxpbWl0IiwicmVtYWluaW5nIiwia2V5R2VuZXJhdG9yIiwiY291bnQiLCJmaXJzdFJlcXVlc3QiLCJzZXQiLCJyZXRyeUFmdGVyIiwiY2VpbCIsImVycm9yIiwiY29kZSIsImNvbnNvbGUiLCJjb25maWdOYW1lIiwiY3VzdG9tQ29uZmlnIiwiYmFzZUNvbmZpZyIsImhhbmRsZXIiLCJhcmdzIiwicmF0ZUxpbWl0UmVzdWx0IiwiZXJyb3JSZXNwb25zZSIsInN1Y2Nlc3MiLCJyYXRlTGltaXQiLCJyZXMiLCJPYmplY3QiLCJmb3JFYWNoIiwidmFsdWUiLCJzZXRIZWFkZXIiLCJzdGF0dXMiLCJqc29uIiwiUmVzcG9uc2UiLCJKU09OIiwic3RyaW5naWZ5IiwicmVzcG9uc2UiLCJmcm9tIiwidmFsdWVzIiwiYWN0aXZlRW50cmllcyIsImZpbHRlciIsInRvdGFsS2V5cyIsInNpemUiLCJvbGRlc3RFbnRyeSIsIm1pbiIsIm1hcCIsImUiLCJuZXdlc3RFbnRyeSIsIm1heCJdLCJtYXBwaW5ncyI6IkFBQUE7OztDQUdDOzs7Ozs7Ozs7OztRQXNDWUE7ZUFBQUE7O1FBd0hTQztlQUFBQTs7UUFpTU5DO2VBQUFBOztRQU9B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