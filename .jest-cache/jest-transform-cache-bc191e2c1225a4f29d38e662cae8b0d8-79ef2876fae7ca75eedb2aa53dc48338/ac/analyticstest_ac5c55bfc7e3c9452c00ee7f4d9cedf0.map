{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\lib\\analytics.test.ts"],"sourcesContent":["/**\r\n * Tests para el sistema de Analytics de Pinteya E-commerce\r\n * Verificación de la corrección del error de runtime en getElementInfo\r\n */\r\n\r\nimport { analytics } from '@/lib/analytics';\r\n\r\n// Mock del DOM para testing\r\nconst mockElement = (props: {\r\n  id?: string;\r\n  className?: string | DOMTokenList;\r\n  tagName?: string;\r\n  getAttribute?: (attr: string) => string | null;\r\n}) => {\r\n  return {\r\n    id: props.id || '',\r\n    className: props.className || '',\r\n    tagName: props.tagName || 'div',\r\n    getAttribute: props.getAttribute || (() => null),\r\n  } as HTMLElement;\r\n};\r\n\r\n// Mock de DOMTokenList para simular el comportamiento real\r\nclass MockDOMTokenList {\r\n  private classes: string[];\r\n\r\n  constructor(classes: string[]) {\r\n    this.classes = classes;\r\n  }\r\n\r\n  toString(): string {\r\n    return this.classes.join(' ');\r\n  }\r\n\r\n  split(separator: string): string[] {\r\n    return this.toString().split(separator);\r\n  }\r\n}\r\n\r\ndescribe('Analytics - getElementInfo', () => {\r\n  let analyticsManager: any;\r\n\r\n  beforeEach(() => {\r\n    // Acceder al método privado para testing\r\n    analyticsManager = analytics as any;\r\n  });\r\n\r\n  describe('Manejo de className como string', () => {\r\n    it('debería manejar className como string simple', () => {\r\n      const element = mockElement({\r\n        id: 'test-button',\r\n        className: 'btn btn-primary active',\r\n        tagName: 'BUTTON'\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('button#test-button.btn.btn-primary.active');\r\n    });\r\n\r\n    it('debería manejar className vacío', () => {\r\n      const element = mockElement({\r\n        id: 'test-div',\r\n        className: '',\r\n        tagName: 'DIV'\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('div#test-div');\r\n    });\r\n\r\n    it('debería manejar className con espacios extra', () => {\r\n      const element = mockElement({\r\n        className: '  btn   btn-large  active  ',\r\n        tagName: 'BUTTON'\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('button.btn.btn-large.active');\r\n    });\r\n  });\r\n\r\n  describe('Manejo de className como DOMTokenList', () => {\r\n    it('debería manejar DOMTokenList correctamente', () => {\r\n      const mockTokenList = new MockDOMTokenList(['btn', 'btn-primary', 'active']);\r\n      \r\n      const element = mockElement({\r\n        id: 'test-button',\r\n        className: mockTokenList as any,\r\n        tagName: 'BUTTON'\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('button#test-button.btn.btn-primary.active');\r\n    });\r\n\r\n    it('debería manejar DOMTokenList vacío', () => {\r\n      const mockTokenList = new MockDOMTokenList([]);\r\n      \r\n      const element = mockElement({\r\n        id: 'test-div',\r\n        className: mockTokenList as any,\r\n        tagName: 'DIV'\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('div#test-div');\r\n    });\r\n\r\n    it('debería manejar DOMTokenList con clases vacías', () => {\r\n      const mockTokenList = new MockDOMTokenList(['btn', '', 'active', '  ']);\r\n      \r\n      const element = mockElement({\r\n        className: mockTokenList as any,\r\n        tagName: 'SPAN'\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('span.btn.active');\r\n    });\r\n  });\r\n\r\n  describe('Manejo de data-analytics', () => {\r\n    it('debería incluir data-analytics cuando está presente', () => {\r\n      const element = mockElement({\r\n        className: 'btn',\r\n        tagName: 'BUTTON',\r\n        getAttribute: (attr: string) => attr === 'data-analytics' ? 'add-to-cart' : null\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('button.btn[add-to-cart]');\r\n    });\r\n\r\n    it('debería funcionar sin data-analytics', () => {\r\n      const element = mockElement({\r\n        className: 'btn',\r\n        tagName: 'BUTTON',\r\n        getAttribute: () => null\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('button.btn');\r\n    });\r\n  });\r\n\r\n  describe('Casos edge', () => {\r\n    it('debería manejar elemento sin id ni className', () => {\r\n      const element = mockElement({\r\n        tagName: 'DIV'\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('div');\r\n    });\r\n\r\n    it('debería manejar tagName en mayúsculas', () => {\r\n      const element = mockElement({\r\n        className: 'container',\r\n        tagName: 'DIV'\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('div.container');\r\n    });\r\n\r\n    it('debería manejar className undefined/null', () => {\r\n      const element = mockElement({\r\n        id: 'test',\r\n        className: undefined as any,\r\n        tagName: 'SPAN'\r\n      });\r\n\r\n      const result = analyticsManager.getElementInfo(element);\r\n      \r\n      expect(result).toBe('span#test');\r\n    });\r\n  });\r\n\r\n  describe('Compatibilidad con elementos reales del DOM', () => {\r\n    it('debería funcionar con elementos button reales', () => {\r\n      // Simular un elemento button real con DOMTokenList\r\n      const realButton = {\r\n        id: 'real-button',\r\n        className: {\r\n          toString: () => 'btn btn-primary',\r\n          split: undefined // DOMTokenList no tiene split\r\n        },\r\n        tagName: 'BUTTON',\r\n        getAttribute: () => null\r\n      } as any;\r\n\r\n      const result = analyticsManager.getElementInfo(realButton);\r\n      \r\n      expect(result).toBe('button#real-button.btn.btn-primary');\r\n    });\r\n  });\r\n});\r\n"],"names":["mockElement","props","id","className","tagName","getAttribute","MockDOMTokenList","classes","toString","join","split","separator","describe","analyticsManager","beforeEach","analytics","it","element","result","getElementInfo","expect","toBe","mockTokenList","attr","undefined","realButton"],"mappings":"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"}