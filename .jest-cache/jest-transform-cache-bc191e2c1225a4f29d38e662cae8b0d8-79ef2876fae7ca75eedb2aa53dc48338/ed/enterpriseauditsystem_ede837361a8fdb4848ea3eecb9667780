d549f586f0babdc1b91c13cd11ed3eae
/**
 * Sistema Enterprise de Auditor칤a de Seguridad
 * Unifica y extiende todas las funcionalidades de auditor칤a con capacidades enterprise
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get ENTERPRISE_AUDIT_CONFIG () {
        return ENTERPRISE_AUDIT_CONFIG;
    },
    get EnterpriseAuditSystem () {
        return EnterpriseAuditSystem;
    },
    get enterpriseAuditSystem () {
        return enterpriseAuditSystem;
    }
});
const _securityaudit = require("../auth/security-audit");
const _securityauditenhanced = require("../auth/security-audit-enhanced");
const _enterpriseratelimiter = require("../rate-limiting/enterprise-rate-limiter");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const ENTERPRISE_AUDIT_CONFIG = {
    // Retenci칩n de datos
    DATA_RETENTION: {
        security_events: 365,
        anomalies: 180,
        incidents: 1095,
        metrics: 90
    },
    // Umbrales de detecci칩n
    DETECTION_THRESHOLDS: {
        anomaly_confidence: 0.7,
        risk_score_critical: 80,
        risk_score_high: 60,
        risk_score_medium: 40,
        false_positive_threshold: 0.1
    },
    // Configuraci칩n de alertas
    ALERT_CONFIG: {
        immediate_notification: [
            'critical'
        ],
        batch_notification: [
            'high',
            'medium'
        ],
        notification_cooldown: 300,
        escalation_timeout: 3600 // segundos
    },
    // An치lisis autom치tico
    AUTOMATED_ANALYSIS: {
        pattern_analysis_interval: 300,
        anomaly_detection_interval: 600,
        metrics_update_interval: 60,
        cleanup_interval: 86400 // 24 horas
    }
};
class EnterpriseAuditSystem {
    constructor(){
        this.analysisIntervals = [];
    }
    static getInstance() {
        if (!EnterpriseAuditSystem.instance) {
            EnterpriseAuditSystem.instance = new EnterpriseAuditSystem();
        }
        return EnterpriseAuditSystem.instance;
    }
    /**
   * Inicializa el sistema de auditor칤a enterprise
   */ async initialize() {
        console.log('[ENTERPRISE_AUDIT] Inicializando sistema de auditor칤a...');
        try {
            // Verificar tablas de base de datos
            await this.ensureDatabaseTables();
            // Iniciar an치lisis autom치tico
            this.startAutomatedAnalysis();
            // Limpiar datos antiguos
            await this.cleanupOldData();
            console.log('[ENTERPRISE_AUDIT] Sistema inicializado correctamente');
        } catch (error) {
            console.error('[ENTERPRISE_AUDIT] Error en inicializaci칩n:', error);
            throw error;
        }
    }
    /**
   * Registra un evento de seguridad enterprise
   */ async logEnterpriseEvent(event, context, request) {
        try {
            // Generar ID 칰nico para correlaci칩n
            const correlationId = this.generateCorrelationId();
            // Calcular risk score
            const riskScore = this.calculateRiskScore(event);
            // Crear evento enterprise
            const enterpriseEvent = {
                ...event,
                id: this.generateEventId(),
                timestamp: new Date().toISOString(),
                resolved: false,
                correlation_id: correlationId,
                risk_score: riskScore,
                enterprise_context: context ? {
                    security_level: context.securityLevel,
                    permissions: context.permissions,
                    session_id: context.sessionId || 'unknown',
                    request_id: this.generateRequestId(request),
                    rate_limit_status: this.getRateLimitStatus(),
                    rls_context: {
                        filters_applied: {},
                        bypass_enabled: context.role === 'admin'
                    }
                } : undefined
            };
            // Registrar en sistema legacy
            await (0, _securityaudit.logSecurityEvent)(event);
            // Registrar en sistema enterprise
            await this.saveEnterpriseEvent(enterpriseEvent);
            // An치lisis inmediato para eventos cr칤ticos
            if (event.severity === 'critical' || riskScore > ENTERPRISE_AUDIT_CONFIG.DETECTION_THRESHOLDS.risk_score_critical) {
                await this.performImmediateAnalysis(enterpriseEvent);
            }
            return correlationId;
        } catch (error) {
            console.error('[ENTERPRISE_AUDIT] Error registrando evento:', error);
            throw error;
        }
    }
    /**
   * Detecta anomal칤as en tiempo real
   */ async detectAnomalies(userId) {
        try {
            const anomalies = [];
            // Obtener eventos recientes
            const recentEvents = await this.getRecentEvents(userId, 24); // 칰ltimas 24 horas
            console.log(`[ENTERPRISE_AUDIT] DEBUG: Found ${recentEvents.length} recent events for user ${userId || 'all'}`);
            if (recentEvents.length > 0) {
                console.log(`[ENTERPRISE_AUDIT] DEBUG: Sample event:`, JSON.stringify(recentEvents[0], null, 2));
            }
            if (recentEvents.length === 0) {
                return anomalies;
            }
            // Ejecutar detectores de anomal칤as
            const detectors = [
                this.detectUnusualLoginPattern,
                this.detectSuspiciousAPIUsage,
                this.detectPrivilegeEscalation,
                this.detectRateLimitAbuse,
                this.detectGeographicAnomaly,
                this.detectTimeBasedAnomaly,
                this.detectBehavioralDeviation
            ];
            for (const detector of detectors){
                try {
                    const detectedAnomalies = await detector.call(this, recentEvents, userId);
                    anomalies.push(...detectedAnomalies);
                } catch (error) {
                    console.error('[ENTERPRISE_AUDIT] Error en detector de anomal칤as:', error);
                }
            }
            // Filtrar por confianza
            const highConfidenceAnomalies = anomalies.filter((a)=>a.confidence_score >= ENTERPRISE_AUDIT_CONFIG.DETECTION_THRESHOLDS.anomaly_confidence);
            // Guardar anomal칤as detectadas
            if (highConfidenceAnomalies.length > 0) {
                await this.saveAnomalies(highConfidenceAnomalies);
            }
            return highConfidenceAnomalies;
        } catch (error) {
            console.error('[ENTERPRISE_AUDIT] Error en detecci칩n de anomal칤as:', error);
            return [];
        }
    }
    /**
   * Genera un reporte de seguridad enterprise
   */ async generateEnterpriseReport(startDate, endDate, includeAnomalies = true, includeIncidents = true) {
        try {
            // Generar reporte base
            const baseReport = await (0, _securityauditenhanced.generateSecurityReport)(startDate, endDate);
            // A침adir datos enterprise
            const enterpriseData = {
                anomalies: includeAnomalies ? await this.getAnomaliesInPeriod(startDate, endDate) : [],
                incidents: includeIncidents ? await this.getIncidentsInPeriod(startDate, endDate) : [],
                rate_limiting_stats: this.getRateLimitingStats(),
                compliance_metrics: await this.getComplianceMetrics(startDate, endDate),
                risk_assessment: await this.performRiskAssessment(),
                recommendations: await this.generateRecommendations()
            };
            return {
                ...baseReport,
                enterprise_data: enterpriseData
            };
        } catch (error) {
            console.error('[ENTERPRISE_AUDIT] Error generando reporte:', error);
            throw error;
        }
    }
    // =====================================================
    // M칄TODOS PRIVADOS
    // =====================================================
    generateCorrelationId() {
        return `corr_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }
    generateEventId() {
        return `evt_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }
    generateRequestId(request) {
        if (request) {
            return `req_${request.headers.get('x-request-id') || Date.now()}`;
        }
        return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }
    calculateRiskScore(event) {
        let score = 0;
        // Base score por severidad
        switch(event.severity){
            case 'critical':
                score += 80;
                break;
            case 'high':
                score += 60;
                break;
            case 'medium':
                score += 40;
                break;
            case 'low':
                score += 20;
                break;
        }
        // Ajustes por tipo de evento
        switch(event.event_type){
            case 'AUTH_FAILURE':
                score += 10;
                break;
            case 'PERMISSION_DENIED':
                score += 15;
                break;
            case 'SUSPICIOUS_ACTIVITY':
                score += 25;
                break;
            case 'SECURITY_VIOLATION':
                score += 30;
                break;
        }
        // Ajustes por categor칤a
        switch(event.event_category){
            case 'authentication':
                score += 5;
                break;
            case 'authorization':
                score += 10;
                break;
            case 'suspicious_behavior':
                score += 20;
                break;
        }
        return Math.min(100, Math.max(0, score));
    }
    getRateLimitStatus() {
        const metrics = _enterpriseratelimiter.metricsCollector.getMetrics();
        return {
            allowed: metrics.allowedRequests > 0,
            remaining: metrics.allowedRequests,
            limit: metrics.totalRequests
        };
    }
    async ensureDatabaseTables() {
        // Verificar que las tablas necesarias existan
        // En un entorno real, esto se har칤a con migraciones
        console.log('[ENTERPRISE_AUDIT] Verificando tablas de base de datos...');
    }
    startAutomatedAnalysis() {
        console.log('[ENTERPRISE_AUDIT] 游뛂 AN츼LISIS AUTOM츼TICO TEMPORALMENTE DESHABILITADO');
        console.log('[ENTERPRISE_AUDIT] 游늶 Raz칩n: Evitar llamadas recursivas a APIs de auth');
        // C칍DIGO COMENTADO TEMPORALMENTE PARA EVITAR RECURSI칍N
        // const config = ENTERPRISE_AUDIT_CONFIG.AUTOMATED_ANALYSIS;
        // // An치lisis de patrones
        // const patternInterval = setInterval(async () => {
        //   try {
        //     await analyzeSecurityPatterns();
        //   } catch (error) {
        //     console.error('[ENTERPRISE_AUDIT] Error en an치lisis de patrones:', error);
        //   }
        // }, config.pattern_analysis_interval * 1000);
        // // Detecci칩n de anomal칤as
        // const anomalyInterval = setInterval(async () => {
        //   try {
        //     await this.detectAnomalies();
        //   } catch (error) {
        //     console.error('[ENTERPRISE_AUDIT] Error en detecci칩n de anomal칤as:', error);
        //   }
        // }, config.anomaly_detection_interval * 1000);
        // Actualizaci칩n de m칠tricas
        const metricsInterval = setInterval(async ()=>{
            try {
                await (0, _securityauditenhanced.getSecurityMetrics)();
            } catch (error) {
                console.error('[ENTERPRISE_AUDIT] Error actualizando m칠tricas:', error);
            }
        }, config.metrics_update_interval * 1000);
        this.analysisIntervals.push(patternInterval, anomalyInterval, metricsInterval);
    }
    async cleanupOldData() {
        try {
            const retention = ENTERPRISE_AUDIT_CONFIG.DATA_RETENTION;
            const now = new Date();
            // Limpiar eventos antiguos
            const eventsThreshold = new Date(now.getTime() - retention.security_events * 24 * 60 * 60 * 1000);
            // En un entorno real, esto se har칤a con consultas SQL optimizadas
            console.log(`[ENTERPRISE_AUDIT] Limpiando eventos anteriores a ${eventsThreshold.toISOString()}`);
        } catch (error) {
            console.error('[ENTERPRISE_AUDIT] Error en limpieza de datos:', error);
        }
    }
    async saveEnterpriseEvent(event) {
        // 游뛂 TEMPORALMENTE DESHABILITADO PARA EVITAR LOGS MASIVOS DURANTE DEBUG
        // console.log('[ENTERPRISE_AUDIT] Guardando evento enterprise:', event.id);
        return;
    }
    async performImmediateAnalysis(event) {
        console.log(`[ENTERPRISE_AUDIT] An치lisis inmediato para evento cr칤tico: ${event.id}`);
        // Implementar an치lisis inmediato para eventos cr칤ticos
        if (event.risk_score && event.risk_score > 90) {
            console.warn(`[ENTERPRISE_AUDIT] 춰Evento de riesgo extremo detectado! Score: ${event.risk_score}`);
        }
    }
    async getRecentEvents(userId, hours = 24) {
        try {
            const { supabaseAdmin } = await Promise.resolve().then(()=>/*#__PURE__*/ _interop_require_wildcard(require("../supabase")));
            const cutoffTime = new Date(Date.now() - hours * 60 * 60 * 1000).toISOString();
            console.log(`[ENTERPRISE_AUDIT] DEBUG: getRecentEvents - cutoffTime: ${cutoffTime}, userId: ${userId}`);
            // Estrategia simplificada para testing
            const { data, error } = await supabaseAdmin.from('enterprise_audit_events').select('*').gte('created_at', cutoffTime).order('created_at', {
                ascending: false
            });
            console.log(`[ENTERPRISE_AUDIT] DEBUG: getRecentEvents - raw data length: ${data?.length || 0}`);
            if (data && data.length > 0) {
                console.log(`[ENTERPRISE_AUDIT] DEBUG: Sample raw event:`, JSON.stringify(data[0], null, 2));
            }
            if (error) {
                console.error('[ENTERPRISE_AUDIT] Error obteniendo eventos recientes:', error);
                return [];
            }
            let events = data || [];
            // Filtrar por userId si se especifica
            if (userId && events.length > 0) {
                const beforeFilter = events.length;
                events = events.filter((event)=>event.user_id === userId);
                console.log(`[ENTERPRISE_AUDIT] DEBUG: getRecentEvents - filtered from ${beforeFilter} to ${events.length} events for user ${userId}`);
            }
            return events;
        } catch (error) {
            console.error('[ENTERPRISE_AUDIT] Error en getRecentEvents:', error);
            return [];
        }
    }
    // =====================================================
    // DETECTORES DE ANOMAL칈AS AVANZADOS
    // =====================================================
    /**
   * Detecta patrones de login inusuales
   */ async detectUnusualLoginPattern(events, userId) {
        const anomalies = [];
        try {
            const authEvents = events.filter((e)=>e.event_category === 'authentication' && (!userId || e.user_id === userId));
            console.log(`[ENTERPRISE_AUDIT] DEBUG: detectUnusualLoginPattern - Found ${authEvents.length} auth events`);
            if (authEvents.length > 0) {
                console.log(`[ENTERPRISE_AUDIT] DEBUG: Auth events:`, authEvents.map((e)=>({
                        type: e.event_type,
                        category: e.event_category,
                        user: e.user_id
                    })));
            }
            if (authEvents.length < 3) return anomalies;
            // Agrupar por usuario
            const userEvents = new Map();
            authEvents.forEach((event)=>{
                if (!userEvents.has(event.user_id)) {
                    userEvents.set(event.user_id, []);
                }
                userEvents.get(event.user_id).push(event);
            });
            for (const [uid, userAuthEvents] of userEvents){
                const indicators = [];
                let confidenceScore = 0;
                // 1. M칰ltiples fallos seguidos de 칠xito (posible brute force exitoso)
                const failures = userAuthEvents.filter((e)=>e.event_type === 'AUTH_FAILURE');
                const successes = userAuthEvents.filter((e)=>e.event_type === 'AUTH_SUCCESS');
                if (failures.length >= 3 && successes.length > 0) {
                    const lastFailure = new Date(failures[failures.length - 1].timestamp);
                    const firstSuccess = new Date(successes[0].timestamp);
                    if (firstSuccess > lastFailure) {
                        indicators.push({
                            type: 'brute_force_success',
                            value: {
                                failures: failures.length,
                                time_diff: firstSuccess.getTime() - lastFailure.getTime()
                            },
                            weight: 0.8,
                            description: `${failures.length} fallos seguidos de login exitoso`
                        });
                        confidenceScore += 0.8;
                    }
                }
                // 2. Logins desde m칰ltiples IPs en corto tiempo
                const uniqueIPs = new Set(userAuthEvents.map((e)=>e.ip_address).filter(Boolean));
                if (uniqueIPs.size >= 3) {
                    indicators.push({
                        type: 'multiple_ips',
                        value: {
                            ip_count: uniqueIPs.size,
                            ips: Array.from(uniqueIPs)
                        },
                        weight: 0.6,
                        description: `Login desde ${uniqueIPs.size} IPs diferentes`
                    });
                    confidenceScore += 0.6;
                }
                // 3. Logins fuera de horario habitual
                const loginHours = userAuthEvents.filter((e)=>e.event_type === 'AUTH_SUCCESS').map((e)=>new Date(e.timestamp).getHours());
                const unusualHours = loginHours.filter((hour)=>hour < 6 || hour > 22);
                if (unusualHours.length > 0) {
                    indicators.push({
                        type: 'unusual_hours',
                        value: {
                            unusual_count: unusualHours.length,
                            hours: unusualHours
                        },
                        weight: 0.4,
                        description: `${unusualHours.length} logins en horarios inusuales`
                    });
                    confidenceScore += 0.4;
                }
                // Crear anomal칤a si hay suficientes indicadores
                if (indicators.length >= 2 && confidenceScore >= 0.7) {
                    anomalies.push({
                        id: this.generateAnomalyId(),
                        user_id: uid,
                        anomaly_type: 'unusual_login_pattern',
                        confidence_score: Math.min(1, confidenceScore),
                        description: `Patr칩n de login inusual detectado: ${indicators.map((i)=>i.description).join(', ')}`,
                        indicators,
                        risk_level: confidenceScore > 0.8 ? 'high' : 'medium',
                        detected_at: new Date().toISOString(),
                        status: 'new',
                        automated_actions: [
                            'log_incident',
                            'notify_security_team'
                        ],
                        manual_review_required: confidenceScore > 0.8
                    });
                }
            }
        } catch (error) {
            console.error('[ENTERPRISE_AUDIT] Error en detectUnusualLoginPattern:', error);
        }
        return anomalies;
    }
    /**
   * Detecta uso sospechoso de APIs
   */ async detectSuspiciousAPIUsage(events, userId) {
        const anomalies = [];
        try {
            const apiEvents = events.filter((e)=>e.event_category === 'data_access' && (!userId || e.user_id === userId));
            if (apiEvents.length < 5) return anomalies;
            // Agrupar por usuario
            const userEvents = new Map();
            apiEvents.forEach((event)=>{
                if (!userEvents.has(event.user_id)) {
                    userEvents.set(event.user_id, []);
                }
                userEvents.get(event.user_id).push(event);
            });
            for (const [uid, userApiEvents] of userEvents){
                const indicators = [];
                let confidenceScore = 0;
                // 1. Volumen inusual de requests
                const requestCount = userApiEvents.length;
                if (requestCount > 100) {
                    indicators.push({
                        type: 'high_volume_requests',
                        value: {
                            count: requestCount
                        },
                        weight: 0.6,
                        description: `${requestCount} requests en 24 horas`
                    });
                    confidenceScore += 0.6;
                }
                // 2. Acceso a recursos sensibles
                const sensitiveResources = userApiEvents.filter((e)=>e.metadata?.resource && [
                        'admin',
                        'user_data',
                        'payment',
                        'sensitive'
                    ].some((keyword)=>e.metadata.resource.toLowerCase().includes(keyword)));
                if (sensitiveResources.length > 10) {
                    indicators.push({
                        type: 'sensitive_resource_access',
                        value: {
                            count: sensitiveResources.length
                        },
                        weight: 0.7,
                        description: `${sensitiveResources.length} accesos a recursos sensibles`
                    });
                    confidenceScore += 0.7;
                }
                // 3. Patr칩n de scraping (requests muy r치pidos)
                const timestamps = userApiEvents.map((e)=>new Date(e.timestamp).getTime()).sort();
                let rapidRequests = 0;
                for(let i = 1; i < timestamps.length; i++){
                    if (timestamps[i] - timestamps[i - 1] < 1000) {
                        rapidRequests++;
                    }
                }
                if (rapidRequests > userApiEvents.length * 0.5) {
                    indicators.push({
                        type: 'rapid_requests',
                        value: {
                            rapid_count: rapidRequests,
                            total: userApiEvents.length
                        },
                        weight: 0.8,
                        description: `${rapidRequests} requests en menos de 1 segundo entre ellas`
                    });
                    confidenceScore += 0.8;
                }
                // Crear anomal칤a si hay suficientes indicadores
                if (indicators.length >= 2 && confidenceScore >= 0.7) {
                    anomalies.push({
                        id: this.generateAnomalyId(),
                        user_id: uid,
                        anomaly_type: 'suspicious_api_usage',
                        confidence_score: Math.min(1, confidenceScore),
                        description: `Uso sospechoso de API detectado: ${indicators.map((i)=>i.description).join(', ')}`,
                        indicators,
                        risk_level: confidenceScore > 0.8 ? 'high' : 'medium',
                        detected_at: new Date().toISOString(),
                        status: 'new',
                        automated_actions: [
                            'rate_limit_user',
                            'log_incident'
                        ],
                        manual_review_required: confidenceScore > 0.8
                    });
                }
            }
        } catch (error) {
            console.error('[ENTERPRISE_AUDIT] Error en detectSuspiciousAPIUsage:', error);
        }
        return anomalies;
    }
    /**
   * Detecta intentos de escalaci칩n de privilegios
   */ async detectPrivilegeEscalation(events, userId) {
        const anomalies = [];
        try {
            const authEvents = events.filter((e)=>e.event_category === 'authorization' && (!userId || e.user_id === userId));
            if (authEvents.length < 3) return anomalies;
            // Agrupar por usuario
            const userEvents = new Map();
            authEvents.forEach((event)=>{
                if (!userEvents.has(event.user_id)) {
                    userEvents.set(event.user_id, []);
                }
                userEvents.get(event.user_id).push(event);
            });
            for (const [uid, userAuthEvents] of userEvents){
                const indicators = [];
                let confidenceScore = 0;
                // 1. M칰ltiples denegaciones de permisos
                const deniedEvents = userAuthEvents.filter((e)=>e.event_type === 'PERMISSION_DENIED');
                if (deniedEvents.length >= 5) {
                    indicators.push({
                        type: 'multiple_permission_denials',
                        value: {
                            count: deniedEvents.length
                        },
                        weight: 0.7,
                        description: `${deniedEvents.length} denegaciones de permisos`
                    });
                    confidenceScore += 0.7;
                }
                // 2. Intentos de acceso a recursos admin
                const adminAttempts = userAuthEvents.filter((e)=>e.metadata?.operation && e.metadata.operation.toLowerCase().includes('admin'));
                if (adminAttempts.length >= 3) {
                    indicators.push({
                        type: 'admin_access_attempts',
                        value: {
                            count: adminAttempts.length
                        },
                        weight: 0.8,
                        description: `${adminAttempts.length} intentos de acceso administrativo`
                    });
                    confidenceScore += 0.8;
                }
                // 3. Cambios de rol sospechosos
                const roleChanges = userAuthEvents.filter((e)=>e.event_type === 'ROLE_CHANGE');
                if (roleChanges.length > 0) {
                    indicators.push({
                        type: 'role_changes',
                        value: {
                            count: roleChanges.length
                        },
                        weight: 0.9,
                        description: `${roleChanges.length} cambios de rol detectados`
                    });
                    confidenceScore += 0.9;
                }
                // Crear anomal칤a si hay suficientes indicadores
                if (indicators.length >= 1 && confidenceScore >= 0.7) {
                    anomalies.push({
                        id: this.generateAnomalyId(),
                        user_id: uid,
                        anomaly_type: 'privilege_escalation_attempt',
                        confidence_score: Math.min(1, confidenceScore),
                        description: `Intento de escalaci칩n de privilegios: ${indicators.map((i)=>i.description).join(', ')}`,
                        indicators,
                        risk_level: confidenceScore > 0.8 ? 'critical' : 'high',
                        detected_at: new Date().toISOString(),
                        status: 'new',
                        automated_actions: [
                            'block_user',
                            'invalidate_sessions',
                            'notify_security_team'
                        ],
                        manual_review_required: true
                    });
                }
            }
        } catch (error) {
            console.error('[ENTERPRISE_AUDIT] Error en detectPrivilegeEscalation:', error);
        }
        return anomalies;
    }
    /**
   * Detecta abuso de rate limiting
   */ async detectRateLimitAbuse(events, userId) {
        const anomalies = [];
        try {
            // Obtener m칠tricas de rate limiting
            const rateLimitStats = this.getRateLimitingStats();
            if (rateLimitStats.blockedRequests === 0) return anomalies;
            // Analizar IPs con m치s bloqueos
            const topBlockedIPs = rateLimitStats.topBlockedIPs || [];
            for (const ipData of topBlockedIPs){
                if (ipData.count >= 10) {
                    const indicators = [
                        {
                            type: 'rate_limit_violations',
                            value: {
                                count: ipData.count,
                                ip: ipData.ip
                            },
                            weight: 0.8,
                            description: `${ipData.count} violaciones de rate limit desde IP ${ipData.ip}`
                        }
                    ];
                    // Buscar eventos relacionados con esta IP
                    const ipEvents = events.filter((e)=>e.ip_address === ipData.ip);
                    const uniqueUsers = new Set(ipEvents.map((e)=>e.user_id));
                    if (uniqueUsers.size > 1) {
                        indicators.push({
                            type: 'multiple_users_same_ip',
                            value: {
                                user_count: uniqueUsers.size,
                                ip: ipData.ip
                            },
                            weight: 0.6,
                            description: `${uniqueUsers.size} usuarios diferentes desde la misma IP`
                        });
                    }
                    anomalies.push({
                        id: this.generateAnomalyId(),
                        user_id: Array.from(uniqueUsers)[0] || 'unknown',
                        anomaly_type: 'rate_limit_abuse',
                        confidence_score: 0.8,
                        description: `Abuso de rate limiting detectado desde IP ${ipData.ip}`,
                        indicators,
                        risk_level: 'high',
                        detected_at: new Date().toISOString(),
                        status: 'new',
                        automated_actions: [
                            'block_ip',
                            'log_incident'
                        ],
                        manual_review_required: false
                    });
                }
            }
        } catch (error) {
            console.error('[ENTERPRISE_AUDIT] Error en detectRateLimitAbuse:', error);
        }
        return anomalies;
    }
    async detectGeographicAnomaly(events, userId) {
        // Implementaci칩n b치sica - en producci칩n se integrar칤a con servicio de geolocalizaci칩n
        return [];
    }
    async detectTimeBasedAnomaly(events, userId) {
        // Implementaci칩n b치sica - detectar칤a actividad fuera de horarios normales
        return [];
    }
    async detectBehavioralDeviation(events, userId) {
        // Implementaci칩n b치sica - comparar칤a con patrones hist칩ricos del usuario
        return [];
    }
    generateAnomalyId() {
        return `anom_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }
    async saveAnomalies(anomalies) {
        console.log(`[ENTERPRISE_AUDIT] Guardando ${anomalies.length} anomal칤as detectadas`);
    }
    async getAnomaliesInPeriod(startDate, endDate) {
        return [];
    }
    async getIncidentsInPeriod(startDate, endDate) {
        return [];
    }
    getRateLimitingStats() {
        return _enterpriseratelimiter.metricsCollector.getMetrics();
    }
    async getComplianceMetrics(startDate, endDate) {
        return {
            audit_coverage: 95,
            policy_violations: 2,
            data_retention_compliance: true
        };
    }
    async performRiskAssessment() {
        return {
            overall_risk_level: 'medium',
            risk_factors: [],
            mitigation_recommendations: []
        };
    }
    async generateRecommendations() {
        return [];
    }
    /**
   * Destructor para limpiar intervalos
   */ destroy() {
        this.analysisIntervals.forEach((interval)=>clearInterval(interval));
        this.analysisIntervals = [];
    }
}
const enterpriseAuditSystem = EnterpriseAuditSystem.getInstance();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxzZWN1cml0eVxcZW50ZXJwcmlzZS1hdWRpdC1zeXN0ZW0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTaXN0ZW1hIEVudGVycHJpc2UgZGUgQXVkaXRvcsOtYSBkZSBTZWd1cmlkYWRcbiAqIFVuaWZpY2EgeSBleHRpZW5kZSB0b2RhcyBsYXMgZnVuY2lvbmFsaWRhZGVzIGRlIGF1ZGl0b3LDrWEgY29uIGNhcGFjaWRhZGVzIGVudGVycHJpc2VcbiAqL1xuXG5pbXBvcnQgeyBzdXBhYmFzZUFkbWluIH0gZnJvbSAnQC9saWIvc3VwYWJhc2UnO1xuaW1wb3J0IHsgXG4gIGxvZ1NlY3VyaXR5RXZlbnQsXG4gIHR5cGUgU2VjdXJpdHlFdmVudCxcbiAgdHlwZSBTZWN1cml0eVNldmVyaXR5LFxuICB0eXBlIFNlY3VyaXR5RXZlbnRUeXBlLFxuICB0eXBlIFNlY3VyaXR5RXZlbnRDYXRlZ29yeVxufSBmcm9tICdAL2xpYi9hdXRoL3NlY3VyaXR5LWF1ZGl0JztcbmltcG9ydCB7XG4gIGFuYWx5emVTZWN1cml0eVBhdHRlcm5zLFxuICBnZXRTZWN1cml0eU1ldHJpY3MsXG4gIGdlbmVyYXRlU2VjdXJpdHlSZXBvcnQsXG4gIHR5cGUgU2VjdXJpdHlNZXRyaWNzLFxuICB0eXBlIFNlY3VyaXR5UmVwb3J0XG59IGZyb20gJ0AvbGliL2F1dGgvc2VjdXJpdHktYXVkaXQtZW5oYW5jZWQnO1xuaW1wb3J0IHsgbWV0cmljc0NvbGxlY3RvciBhcyByYXRlTGltaXRNZXRyaWNzIH0gZnJvbSAnQC9saWIvcmF0ZS1saW1pdGluZy9lbnRlcnByaXNlLXJhdGUtbGltaXRlcic7XG5pbXBvcnQgdHlwZSB7IEVudGVycHJpc2VBdXRoQ29udGV4dCB9IGZyb20gJ0AvbGliL2F1dGgvZW50ZXJwcmlzZS1hdXRoLXV0aWxzJztcbmltcG9ydCB0eXBlIHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUSVBPUyBZIElOVEVSRkFDRVMgRU5URVJQUklTRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGludGVyZmFjZSBFbnRlcnByaXNlU2VjdXJpdHlFdmVudCBleHRlbmRzIFNlY3VyaXR5RXZlbnQge1xuICBlbnRlcnByaXNlX2NvbnRleHQ/OiB7XG4gICAgc2VjdXJpdHlfbGV2ZWw6IHN0cmluZztcbiAgICBwZXJtaXNzaW9uczogc3RyaW5nW107XG4gICAgc2Vzc2lvbl9pZDogc3RyaW5nO1xuICAgIHJlcXVlc3RfaWQ6IHN0cmluZztcbiAgICByYXRlX2xpbWl0X3N0YXR1cz86IHtcbiAgICAgIGFsbG93ZWQ6IGJvb2xlYW47XG4gICAgICByZW1haW5pbmc6IG51bWJlcjtcbiAgICAgIGxpbWl0OiBudW1iZXI7XG4gICAgfTtcbiAgICBybHNfY29udGV4dD86IHtcbiAgICAgIGZpbHRlcnNfYXBwbGllZDogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICAgIGJ5cGFzc19lbmFibGVkOiBib29sZWFuO1xuICAgIH07XG4gIH07XG4gIGNvcnJlbGF0aW9uX2lkPzogc3RyaW5nO1xuICBwYXJlbnRfZXZlbnRfaWQ/OiBzdHJpbmc7XG4gIHJpc2tfc2NvcmU/OiBudW1iZXI7IC8vIDAtMTAwXG4gIGF1dG9tYXRlZF9yZXNwb25zZT86IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5QW5vbWFseURldGVjdGlvbiB7XG4gIGlkOiBzdHJpbmc7XG4gIHVzZXJfaWQ6IHN0cmluZztcbiAgYW5vbWFseV90eXBlOiBBbm9tYWx5VHlwZTtcbiAgY29uZmlkZW5jZV9zY29yZTogbnVtYmVyOyAvLyAwLTFcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgaW5kaWNhdG9yczogQW5vbWFseUluZGljYXRvcltdO1xuICByaXNrX2xldmVsOiBTZWN1cml0eVNldmVyaXR5O1xuICBkZXRlY3RlZF9hdDogc3RyaW5nO1xuICBzdGF0dXM6ICduZXcnIHwgJ2ludmVzdGlnYXRpbmcnIHwgJ3Jlc29sdmVkJyB8ICdmYWxzZV9wb3NpdGl2ZSc7XG4gIGF1dG9tYXRlZF9hY3Rpb25zOiBzdHJpbmdbXTtcbiAgbWFudWFsX3Jldmlld19yZXF1aXJlZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IHR5cGUgQW5vbWFseVR5cGUgPSBcbiAgfCAndW51c3VhbF9sb2dpbl9wYXR0ZXJuJ1xuICB8ICdzdXNwaWNpb3VzX2FwaV91c2FnZSdcbiAgfCAncHJpdmlsZWdlX2VzY2FsYXRpb25fYXR0ZW1wdCdcbiAgfCAnZGF0YV9leGZpbHRyYXRpb25fcGF0dGVybidcbiAgfCAnYnJ1dGVfZm9yY2VfYXR0YWNrJ1xuICB8ICdzZXNzaW9uX2hpamFja2luZydcbiAgfCAncmF0ZV9saW1pdF9hYnVzZSdcbiAgfCAnZ2VvZ3JhcGhpY19hbm9tYWx5J1xuICB8ICd0aW1lX2Jhc2VkX2Fub21hbHknXG4gIHwgJ2JlaGF2aW9yYWxfZGV2aWF0aW9uJztcblxuZXhwb3J0IGludGVyZmFjZSBBbm9tYWx5SW5kaWNhdG9yIHtcbiAgdHlwZTogc3RyaW5nO1xuICB2YWx1ZTogYW55O1xuICB3ZWlnaHQ6IG51bWJlcjtcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWN1cml0eUluY2lkZW50IHtcbiAgaWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgc2V2ZXJpdHk6IFNlY3VyaXR5U2V2ZXJpdHk7XG4gIHN0YXR1czogJ29wZW4nIHwgJ2ludmVzdGlnYXRpbmcnIHwgJ3Jlc29sdmVkJyB8ICdjbG9zZWQnO1xuICBhc3NpZ25lZF90bz86IHN0cmluZztcbiAgY3JlYXRlZF9hdDogc3RyaW5nO1xuICB1cGRhdGVkX2F0OiBzdHJpbmc7XG4gIHJlc29sdmVkX2F0Pzogc3RyaW5nO1xuICBldmVudHM6IHN0cmluZ1tdOyAvLyBJRHMgZGUgZXZlbnRvcyByZWxhY2lvbmFkb3NcbiAgYW5vbWFsaWVzOiBzdHJpbmdbXTsgLy8gSURzIGRlIGFub21hbMOtYXMgcmVsYWNpb25hZGFzXG4gIHRpbWVsaW5lOiBJbmNpZGVudFRpbWVsaW5lRW50cnlbXTtcbiAgaW1wYWN0X2Fzc2Vzc21lbnQ6IHtcbiAgICBhZmZlY3RlZF91c2VyczogbnVtYmVyO1xuICAgIGFmZmVjdGVkX3N5c3RlbXM6IHN0cmluZ1tdO1xuICAgIGRhdGFfY29tcHJvbWlzZWQ6IGJvb2xlYW47XG4gICAgZXN0aW1hdGVkX2Nvc3Q6IG51bWJlcjtcbiAgfTtcbiAgcmVzcG9uc2VfYWN0aW9uczogUmVzcG9uc2VBY3Rpb25bXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJbmNpZGVudFRpbWVsaW5lRW50cnkge1xuICB0aW1lc3RhbXA6IHN0cmluZztcbiAgYWN0aW9uOiBzdHJpbmc7XG4gIGFjdG9yOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55Pjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZXNwb25zZUFjdGlvbiB7XG4gIGlkOiBzdHJpbmc7XG4gIHR5cGU6ICdtYW51YWwnIHwgJ2F1dG9tYXRlZCc7XG4gIGFjdGlvbjogc3RyaW5nO1xuICBzdGF0dXM6ICdwZW5kaW5nJyB8ICdpbl9wcm9ncmVzcycgfCAnY29tcGxldGVkJyB8ICdmYWlsZWQnO1xuICBleGVjdXRlZF9hdD86IHN0cmluZztcbiAgZXhlY3V0ZWRfYnk/OiBzdHJpbmc7XG4gIHJlc3VsdD86IHN0cmluZztcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVudGVycHJpc2VTZWN1cml0eU1ldHJpY3MgZXh0ZW5kcyBTZWN1cml0eU1ldHJpY3Mge1xuICByYXRlX2xpbWl0aW5nOiB7XG4gICAgdG90YWxfcmVxdWVzdHM6IG51bWJlcjtcbiAgICBibG9ja2VkX3JlcXVlc3RzOiBudW1iZXI7XG4gICAgYmxvY2tfcmF0ZTogbnVtYmVyO1xuICAgIHRvcF9ibG9ja2VkX2lwczogQXJyYXk8eyBpcDogc3RyaW5nOyBjb3VudDogbnVtYmVyIH0+O1xuICB9O1xuICBhbm9tYWx5X2RldGVjdGlvbjoge1xuICAgIHRvdGFsX2Fub21hbGllczogbnVtYmVyO1xuICAgIGhpZ2hfY29uZmlkZW5jZV9hbm9tYWxpZXM6IG51bWJlcjtcbiAgICBmYWxzZV9wb3NpdGl2ZV9yYXRlOiBudW1iZXI7XG4gICAgZGV0ZWN0aW9uX2FjY3VyYWN5OiBudW1iZXI7XG4gIH07XG4gIGluY2lkZW50X21hbmFnZW1lbnQ6IHtcbiAgICBvcGVuX2luY2lkZW50czogbnVtYmVyO1xuICAgIGF2Z19yZXNvbHV0aW9uX3RpbWU6IG51bWJlcjtcbiAgICBpbmNpZGVudHNfYnlfc2V2ZXJpdHk6IFJlY29yZDxTZWN1cml0eVNldmVyaXR5LCBudW1iZXI+O1xuICB9O1xuICBjb21wbGlhbmNlOiB7XG4gICAgYXVkaXRfY292ZXJhZ2U6IG51bWJlcjtcbiAgICBwb2xpY3lfdmlvbGF0aW9uczogbnVtYmVyO1xuICAgIGRhdGFfcmV0ZW50aW9uX2NvbXBsaWFuY2U6IGJvb2xlYW47XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlEYXNoYm9hcmREYXRhIHtcbiAgb3ZlcnZpZXc6IEVudGVycHJpc2VTZWN1cml0eU1ldHJpY3M7XG4gIHJlY2VudF9ldmVudHM6IEVudGVycHJpc2VTZWN1cml0eUV2ZW50W107XG4gIGFjdGl2ZV9hbm9tYWxpZXM6IFNlY3VyaXR5QW5vbWFseURldGVjdGlvbltdO1xuICBvcGVuX2luY2lkZW50czogU2VjdXJpdHlJbmNpZGVudFtdO1xuICBzZWN1cml0eV90cmVuZHM6IHtcbiAgICBldmVudHNfdHJlbmQ6IEFycmF5PHsgZGF0ZTogc3RyaW5nOyBjb3VudDogbnVtYmVyOyBzZXZlcml0eTogU2VjdXJpdHlTZXZlcml0eSB9PjtcbiAgICBhbm9tYWxpZXNfdHJlbmQ6IEFycmF5PHsgZGF0ZTogc3RyaW5nOyBjb3VudDogbnVtYmVyOyB0eXBlOiBBbm9tYWx5VHlwZSB9PjtcbiAgICBpbmNpZGVudHNfdHJlbmQ6IEFycmF5PHsgZGF0ZTogc3RyaW5nOyBjb3VudDogbnVtYmVyOyBzZXZlcml0eTogU2VjdXJpdHlTZXZlcml0eSB9PjtcbiAgfTtcbiAgcmVjb21tZW5kYXRpb25zOiBTZWN1cml0eVJlY29tbWVuZGF0aW9uW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlSZWNvbW1lbmRhdGlvbiB7XG4gIGlkOiBzdHJpbmc7XG4gIHR5cGU6ICdpbW1lZGlhdGUnIHwgJ3Nob3J0X3Rlcm0nIHwgJ2xvbmdfdGVybSc7XG4gIHByaW9yaXR5OiBTZWN1cml0eVNldmVyaXR5O1xuICB0aXRsZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBpbXBhY3Q6IHN0cmluZztcbiAgZWZmb3J0OiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnO1xuICBjYXRlZ29yeTogJ3ByZXZlbnRpb24nIHwgJ2RldGVjdGlvbicgfCAncmVzcG9uc2UnIHwgJ3JlY292ZXJ5JztcbiAgaW1wbGVtZW50YXRpb25fc3RlcHM6IHN0cmluZ1tdO1xuICBlc3RpbWF0ZWRfY29tcGxldGlvbjogc3RyaW5nO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09ORklHVVJBQ0lPTkVTIEVOVEVSUFJJU0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBjb25zdCBFTlRFUlBSSVNFX0FVRElUX0NPTkZJRyA9IHtcbiAgLy8gUmV0ZW5jacOzbiBkZSBkYXRvc1xuICBEQVRBX1JFVEVOVElPTjoge1xuICAgIHNlY3VyaXR5X2V2ZW50czogMzY1LCAvLyBkw61hc1xuICAgIGFub21hbGllczogMTgwLFxuICAgIGluY2lkZW50czogMTA5NSwgLy8gMyBhw7Fvc1xuICAgIG1ldHJpY3M6IDkwXG4gIH0sXG5cbiAgLy8gVW1icmFsZXMgZGUgZGV0ZWNjacOzblxuICBERVRFQ1RJT05fVEhSRVNIT0xEUzoge1xuICAgIGFub21hbHlfY29uZmlkZW5jZTogMC43LFxuICAgIHJpc2tfc2NvcmVfY3JpdGljYWw6IDgwLFxuICAgIHJpc2tfc2NvcmVfaGlnaDogNjAsXG4gICAgcmlza19zY29yZV9tZWRpdW06IDQwLFxuICAgIGZhbHNlX3Bvc2l0aXZlX3RocmVzaG9sZDogMC4xXG4gIH0sXG5cbiAgLy8gQ29uZmlndXJhY2nDs24gZGUgYWxlcnRhc1xuICBBTEVSVF9DT05GSUc6IHtcbiAgICBpbW1lZGlhdGVfbm90aWZpY2F0aW9uOiBbJ2NyaXRpY2FsJ10sXG4gICAgYmF0Y2hfbm90aWZpY2F0aW9uOiBbJ2hpZ2gnLCAnbWVkaXVtJ10sXG4gICAgbm90aWZpY2F0aW9uX2Nvb2xkb3duOiAzMDAsIC8vIHNlZ3VuZG9zXG4gICAgZXNjYWxhdGlvbl90aW1lb3V0OiAzNjAwIC8vIHNlZ3VuZG9zXG4gIH0sXG5cbiAgLy8gQW7DoWxpc2lzIGF1dG9tw6F0aWNvXG4gIEFVVE9NQVRFRF9BTkFMWVNJUzoge1xuICAgIHBhdHRlcm5fYW5hbHlzaXNfaW50ZXJ2YWw6IDMwMCwgLy8gc2VndW5kb3NcbiAgICBhbm9tYWx5X2RldGVjdGlvbl9pbnRlcnZhbDogNjAwLFxuICAgIG1ldHJpY3NfdXBkYXRlX2ludGVydmFsOiA2MCxcbiAgICBjbGVhbnVwX2ludGVydmFsOiA4NjQwMCAvLyAyNCBob3Jhc1xuICB9XG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ0xBU0UgUFJJTkNJUEFMIERFTCBTSVNURU1BXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgY2xhc3MgRW50ZXJwcmlzZUF1ZGl0U3lzdGVtIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IEVudGVycHJpc2VBdWRpdFN5c3RlbTtcbiAgcHJpdmF0ZSBhbmFseXNpc0ludGVydmFsczogTm9kZUpTLlRpbWVvdXRbXSA9IFtdO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7fVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogRW50ZXJwcmlzZUF1ZGl0U3lzdGVtIHtcbiAgICBpZiAoIUVudGVycHJpc2VBdWRpdFN5c3RlbS5pbnN0YW5jZSkge1xuICAgICAgRW50ZXJwcmlzZUF1ZGl0U3lzdGVtLmluc3RhbmNlID0gbmV3IEVudGVycHJpc2VBdWRpdFN5c3RlbSgpO1xuICAgIH1cbiAgICByZXR1cm4gRW50ZXJwcmlzZUF1ZGl0U3lzdGVtLmluc3RhbmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaWNpYWxpemEgZWwgc2lzdGVtYSBkZSBhdWRpdG9yw61hIGVudGVycHJpc2VcbiAgICovXG4gIHB1YmxpYyBhc3luYyBpbml0aWFsaXplKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKCdbRU5URVJQUklTRV9BVURJVF0gSW5pY2lhbGl6YW5kbyBzaXN0ZW1hIGRlIGF1ZGl0b3LDrWEuLi4nKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBWZXJpZmljYXIgdGFibGFzIGRlIGJhc2UgZGUgZGF0b3NcbiAgICAgIGF3YWl0IHRoaXMuZW5zdXJlRGF0YWJhc2VUYWJsZXMoKTtcblxuICAgICAgLy8gSW5pY2lhciBhbsOhbGlzaXMgYXV0b23DoXRpY29cbiAgICAgIHRoaXMuc3RhcnRBdXRvbWF0ZWRBbmFseXNpcygpO1xuXG4gICAgICAvLyBMaW1waWFyIGRhdG9zIGFudGlndW9zXG4gICAgICBhd2FpdCB0aGlzLmNsZWFudXBPbGREYXRhKCk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdbRU5URVJQUklTRV9BVURJVF0gU2lzdGVtYSBpbmljaWFsaXphZG8gY29ycmVjdGFtZW50ZScpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbRU5URVJQUklTRV9BVURJVF0gRXJyb3IgZW4gaW5pY2lhbGl6YWNpw7NuOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RyYSB1biBldmVudG8gZGUgc2VndXJpZGFkIGVudGVycHJpc2VcbiAgICovXG4gIHB1YmxpYyBhc3luYyBsb2dFbnRlcnByaXNlRXZlbnQoXG4gICAgZXZlbnQ6IE9taXQ8RW50ZXJwcmlzZVNlY3VyaXR5RXZlbnQsICdpZCcgfCAndGltZXN0YW1wJyB8ICdyZXNvbHZlZCc+LFxuICAgIGNvbnRleHQ/OiBFbnRlcnByaXNlQXV0aENvbnRleHQsXG4gICAgcmVxdWVzdD86IE5leHRSZXF1ZXN0XG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdlbmVyYXIgSUQgw7puaWNvIHBhcmEgY29ycmVsYWNpw7NuXG4gICAgICBjb25zdCBjb3JyZWxhdGlvbklkID0gdGhpcy5nZW5lcmF0ZUNvcnJlbGF0aW9uSWQoKTtcbiAgICAgIFxuICAgICAgLy8gQ2FsY3VsYXIgcmlzayBzY29yZVxuICAgICAgY29uc3Qgcmlza1Njb3JlID0gdGhpcy5jYWxjdWxhdGVSaXNrU2NvcmUoZXZlbnQpO1xuXG4gICAgICAvLyBDcmVhciBldmVudG8gZW50ZXJwcmlzZVxuICAgICAgY29uc3QgZW50ZXJwcmlzZUV2ZW50OiBFbnRlcnByaXNlU2VjdXJpdHlFdmVudCA9IHtcbiAgICAgICAgLi4uZXZlbnQsXG4gICAgICAgIGlkOiB0aGlzLmdlbmVyYXRlRXZlbnRJZCgpLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgcmVzb2x2ZWQ6IGZhbHNlLFxuICAgICAgICBjb3JyZWxhdGlvbl9pZDogY29ycmVsYXRpb25JZCxcbiAgICAgICAgcmlza19zY29yZTogcmlza1Njb3JlLFxuICAgICAgICBlbnRlcnByaXNlX2NvbnRleHQ6IGNvbnRleHQgPyB7XG4gICAgICAgICAgc2VjdXJpdHlfbGV2ZWw6IGNvbnRleHQuc2VjdXJpdHlMZXZlbCxcbiAgICAgICAgICBwZXJtaXNzaW9uczogY29udGV4dC5wZXJtaXNzaW9ucyxcbiAgICAgICAgICBzZXNzaW9uX2lkOiBjb250ZXh0LnNlc3Npb25JZCB8fCAndW5rbm93bicsXG4gICAgICAgICAgcmVxdWVzdF9pZDogdGhpcy5nZW5lcmF0ZVJlcXVlc3RJZChyZXF1ZXN0KSxcbiAgICAgICAgICByYXRlX2xpbWl0X3N0YXR1czogdGhpcy5nZXRSYXRlTGltaXRTdGF0dXMoKSxcbiAgICAgICAgICBybHNfY29udGV4dDoge1xuICAgICAgICAgICAgZmlsdGVyc19hcHBsaWVkOiB7fSxcbiAgICAgICAgICAgIGJ5cGFzc19lbmFibGVkOiBjb250ZXh0LnJvbGUgPT09ICdhZG1pbidcbiAgICAgICAgICB9XG4gICAgICAgIH0gOiB1bmRlZmluZWRcbiAgICAgIH07XG5cbiAgICAgIC8vIFJlZ2lzdHJhciBlbiBzaXN0ZW1hIGxlZ2FjeVxuICAgICAgYXdhaXQgbG9nU2VjdXJpdHlFdmVudChldmVudCk7XG5cbiAgICAgIC8vIFJlZ2lzdHJhciBlbiBzaXN0ZW1hIGVudGVycHJpc2VcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZUVudGVycHJpc2VFdmVudChlbnRlcnByaXNlRXZlbnQpO1xuXG4gICAgICAvLyBBbsOhbGlzaXMgaW5tZWRpYXRvIHBhcmEgZXZlbnRvcyBjcsOtdGljb3NcbiAgICAgIGlmIChldmVudC5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJyB8fCByaXNrU2NvcmUgPiBFTlRFUlBSSVNFX0FVRElUX0NPTkZJRy5ERVRFQ1RJT05fVEhSRVNIT0xEUy5yaXNrX3Njb3JlX2NyaXRpY2FsKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucGVyZm9ybUltbWVkaWF0ZUFuYWx5c2lzKGVudGVycHJpc2VFdmVudCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb3JyZWxhdGlvbklkO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbRU5URVJQUklTRV9BVURJVF0gRXJyb3IgcmVnaXN0cmFuZG8gZXZlbnRvOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlY3RhIGFub21hbMOtYXMgZW4gdGllbXBvIHJlYWxcbiAgICovXG4gIHB1YmxpYyBhc3luYyBkZXRlY3RBbm9tYWxpZXModXNlcklkPzogc3RyaW5nKTogUHJvbWlzZTxTZWN1cml0eUFub21hbHlEZXRlY3Rpb25bXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhbm9tYWxpZXM6IFNlY3VyaXR5QW5vbWFseURldGVjdGlvbltdID0gW107XG5cbiAgICAgIC8vIE9idGVuZXIgZXZlbnRvcyByZWNpZW50ZXNcbiAgICAgIGNvbnN0IHJlY2VudEV2ZW50cyA9IGF3YWl0IHRoaXMuZ2V0UmVjZW50RXZlbnRzKHVzZXJJZCwgMjQpOyAvLyDDumx0aW1hcyAyNCBob3Jhc1xuXG4gICAgICBjb25zb2xlLmxvZyhgW0VOVEVSUFJJU0VfQVVESVRdIERFQlVHOiBGb3VuZCAke3JlY2VudEV2ZW50cy5sZW5ndGh9IHJlY2VudCBldmVudHMgZm9yIHVzZXIgJHt1c2VySWQgfHwgJ2FsbCd9YCk7XG4gICAgICBpZiAocmVjZW50RXZlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coYFtFTlRFUlBSSVNFX0FVRElUXSBERUJVRzogU2FtcGxlIGV2ZW50OmAsIEpTT04uc3RyaW5naWZ5KHJlY2VudEV2ZW50c1swXSwgbnVsbCwgMikpO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVjZW50RXZlbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gYW5vbWFsaWVzO1xuICAgICAgfVxuXG4gICAgICAvLyBFamVjdXRhciBkZXRlY3RvcmVzIGRlIGFub21hbMOtYXNcbiAgICAgIGNvbnN0IGRldGVjdG9ycyA9IFtcbiAgICAgICAgdGhpcy5kZXRlY3RVbnVzdWFsTG9naW5QYXR0ZXJuLFxuICAgICAgICB0aGlzLmRldGVjdFN1c3BpY2lvdXNBUElVc2FnZSxcbiAgICAgICAgdGhpcy5kZXRlY3RQcml2aWxlZ2VFc2NhbGF0aW9uLFxuICAgICAgICB0aGlzLmRldGVjdFJhdGVMaW1pdEFidXNlLFxuICAgICAgICB0aGlzLmRldGVjdEdlb2dyYXBoaWNBbm9tYWx5LFxuICAgICAgICB0aGlzLmRldGVjdFRpbWVCYXNlZEFub21hbHksXG4gICAgICAgIHRoaXMuZGV0ZWN0QmVoYXZpb3JhbERldmlhdGlvblxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBkZXRlY3RvciBvZiBkZXRlY3RvcnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBkZXRlY3RlZEFub21hbGllcyA9IGF3YWl0IGRldGVjdG9yLmNhbGwodGhpcywgcmVjZW50RXZlbnRzLCB1c2VySWQpO1xuICAgICAgICAgIGFub21hbGllcy5wdXNoKC4uLmRldGVjdGVkQW5vbWFsaWVzKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbRU5URVJQUklTRV9BVURJVF0gRXJyb3IgZW4gZGV0ZWN0b3IgZGUgYW5vbWFsw61hczonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gRmlsdHJhciBwb3IgY29uZmlhbnphXG4gICAgICBjb25zdCBoaWdoQ29uZmlkZW5jZUFub21hbGllcyA9IGFub21hbGllcy5maWx0ZXIoXG4gICAgICAgIGEgPT4gYS5jb25maWRlbmNlX3Njb3JlID49IEVOVEVSUFJJU0VfQVVESVRfQ09ORklHLkRFVEVDVElPTl9USFJFU0hPTERTLmFub21hbHlfY29uZmlkZW5jZVxuICAgICAgKTtcblxuICAgICAgLy8gR3VhcmRhciBhbm9tYWzDrWFzIGRldGVjdGFkYXNcbiAgICAgIGlmIChoaWdoQ29uZmlkZW5jZUFub21hbGllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZUFub21hbGllcyhoaWdoQ29uZmlkZW5jZUFub21hbGllcyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoaWdoQ29uZmlkZW5jZUFub21hbGllcztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW0VOVEVSUFJJU0VfQVVESVRdIEVycm9yIGVuIGRldGVjY2nDs24gZGUgYW5vbWFsw61hczonLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYSB1biByZXBvcnRlIGRlIHNlZ3VyaWRhZCBlbnRlcnByaXNlXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2VuZXJhdGVFbnRlcnByaXNlUmVwb3J0KFxuICAgIHN0YXJ0RGF0ZTogc3RyaW5nLFxuICAgIGVuZERhdGU6IHN0cmluZyxcbiAgICBpbmNsdWRlQW5vbWFsaWVzOiBib29sZWFuID0gdHJ1ZSxcbiAgICBpbmNsdWRlSW5jaWRlbnRzOiBib29sZWFuID0gdHJ1ZVxuICApOiBQcm9taXNlPFNlY3VyaXR5UmVwb3J0ICYgeyBlbnRlcnByaXNlX2RhdGE6IGFueSB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdlbmVyYXIgcmVwb3J0ZSBiYXNlXG4gICAgICBjb25zdCBiYXNlUmVwb3J0ID0gYXdhaXQgZ2VuZXJhdGVTZWN1cml0eVJlcG9ydChzdGFydERhdGUsIGVuZERhdGUpO1xuXG4gICAgICAvLyBBw7FhZGlyIGRhdG9zIGVudGVycHJpc2VcbiAgICAgIGNvbnN0IGVudGVycHJpc2VEYXRhID0ge1xuICAgICAgICBhbm9tYWxpZXM6IGluY2x1ZGVBbm9tYWxpZXMgPyBhd2FpdCB0aGlzLmdldEFub21hbGllc0luUGVyaW9kKHN0YXJ0RGF0ZSwgZW5kRGF0ZSkgOiBbXSxcbiAgICAgICAgaW5jaWRlbnRzOiBpbmNsdWRlSW5jaWRlbnRzID8gYXdhaXQgdGhpcy5nZXRJbmNpZGVudHNJblBlcmlvZChzdGFydERhdGUsIGVuZERhdGUpIDogW10sXG4gICAgICAgIHJhdGVfbGltaXRpbmdfc3RhdHM6IHRoaXMuZ2V0UmF0ZUxpbWl0aW5nU3RhdHMoKSxcbiAgICAgICAgY29tcGxpYW5jZV9tZXRyaWNzOiBhd2FpdCB0aGlzLmdldENvbXBsaWFuY2VNZXRyaWNzKHN0YXJ0RGF0ZSwgZW5kRGF0ZSksXG4gICAgICAgIHJpc2tfYXNzZXNzbWVudDogYXdhaXQgdGhpcy5wZXJmb3JtUmlza0Fzc2Vzc21lbnQoKSxcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiBhd2FpdCB0aGlzLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zKClcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmJhc2VSZXBvcnQsXG4gICAgICAgIGVudGVycHJpc2VfZGF0YTogZW50ZXJwcmlzZURhdGFcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tFTlRFUlBSSVNFX0FVRElUXSBFcnJvciBnZW5lcmFuZG8gcmVwb3J0ZTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBNw4lUT0RPUyBQUklWQURPU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVDb3JyZWxhdGlvbklkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBjb3JyXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVFdmVudElkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBldnRfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVJlcXVlc3RJZChyZXF1ZXN0PzogTmV4dFJlcXVlc3QpOiBzdHJpbmcge1xuICAgIGlmIChyZXF1ZXN0KSB7XG4gICAgICByZXR1cm4gYHJlcV8ke3JlcXVlc3QuaGVhZGVycy5nZXQoJ3gtcmVxdWVzdC1pZCcpIHx8IERhdGUubm93KCl9YDtcbiAgICB9XG4gICAgcmV0dXJuIGByZXFfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVSaXNrU2NvcmUoZXZlbnQ6IE9taXQ8RW50ZXJwcmlzZVNlY3VyaXR5RXZlbnQsICdpZCcgfCAndGltZXN0YW1wJyB8ICdyZXNvbHZlZCc+KTogbnVtYmVyIHtcbiAgICBsZXQgc2NvcmUgPSAwO1xuXG4gICAgLy8gQmFzZSBzY29yZSBwb3Igc2V2ZXJpZGFkXG4gICAgc3dpdGNoIChldmVudC5zZXZlcml0eSkge1xuICAgICAgY2FzZSAnY3JpdGljYWwnOiBzY29yZSArPSA4MDsgYnJlYWs7XG4gICAgICBjYXNlICdoaWdoJzogc2NvcmUgKz0gNjA7IGJyZWFrO1xuICAgICAgY2FzZSAnbWVkaXVtJzogc2NvcmUgKz0gNDA7IGJyZWFrO1xuICAgICAgY2FzZSAnbG93Jzogc2NvcmUgKz0gMjA7IGJyZWFrO1xuICAgIH1cblxuICAgIC8vIEFqdXN0ZXMgcG9yIHRpcG8gZGUgZXZlbnRvXG4gICAgc3dpdGNoIChldmVudC5ldmVudF90eXBlKSB7XG4gICAgICBjYXNlICdBVVRIX0ZBSUxVUkUnOiBzY29yZSArPSAxMDsgYnJlYWs7XG4gICAgICBjYXNlICdQRVJNSVNTSU9OX0RFTklFRCc6IHNjb3JlICs9IDE1OyBicmVhaztcbiAgICAgIGNhc2UgJ1NVU1BJQ0lPVVNfQUNUSVZJVFknOiBzY29yZSArPSAyNTsgYnJlYWs7XG4gICAgICBjYXNlICdTRUNVUklUWV9WSU9MQVRJT04nOiBzY29yZSArPSAzMDsgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gQWp1c3RlcyBwb3IgY2F0ZWdvcsOtYVxuICAgIHN3aXRjaCAoZXZlbnQuZXZlbnRfY2F0ZWdvcnkpIHtcbiAgICAgIGNhc2UgJ2F1dGhlbnRpY2F0aW9uJzogc2NvcmUgKz0gNTsgYnJlYWs7XG4gICAgICBjYXNlICdhdXRob3JpemF0aW9uJzogc2NvcmUgKz0gMTA7IGJyZWFrO1xuICAgICAgY2FzZSAnc3VzcGljaW91c19iZWhhdmlvcic6IHNjb3JlICs9IDIwOyBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5taW4oMTAwLCBNYXRoLm1heCgwLCBzY29yZSkpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRSYXRlTGltaXRTdGF0dXMoKSB7XG4gICAgY29uc3QgbWV0cmljcyA9IHJhdGVMaW1pdE1ldHJpY3MuZ2V0TWV0cmljcygpO1xuICAgIHJldHVybiB7XG4gICAgICBhbGxvd2VkOiBtZXRyaWNzLmFsbG93ZWRSZXF1ZXN0cyA+IDAsXG4gICAgICByZW1haW5pbmc6IG1ldHJpY3MuYWxsb3dlZFJlcXVlc3RzLFxuICAgICAgbGltaXQ6IG1ldHJpY3MudG90YWxSZXF1ZXN0c1xuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGVuc3VyZURhdGFiYXNlVGFibGVzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIFZlcmlmaWNhciBxdWUgbGFzIHRhYmxhcyBuZWNlc2FyaWFzIGV4aXN0YW5cbiAgICAvLyBFbiB1biBlbnRvcm5vIHJlYWwsIGVzdG8gc2UgaGFyw61hIGNvbiBtaWdyYWNpb25lc1xuICAgIGNvbnNvbGUubG9nKCdbRU5URVJQUklTRV9BVURJVF0gVmVyaWZpY2FuZG8gdGFibGFzIGRlIGJhc2UgZGUgZGF0b3MuLi4nKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhcnRBdXRvbWF0ZWRBbmFseXNpcygpOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZygnW0VOVEVSUFJJU0VfQVVESVRdIPCfmqsgQU7DgUxJU0lTIEFVVE9Nw4FUSUNPIFRFTVBPUkFMTUVOVEUgREVTSEFCSUxJVEFETycpO1xuICAgIGNvbnNvbGUubG9nKCdbRU5URVJQUklTRV9BVURJVF0g8J+TiyBSYXrDs246IEV2aXRhciBsbGFtYWRhcyByZWN1cnNpdmFzIGEgQVBJcyBkZSBhdXRoJyk7XG5cbiAgICAvLyBDw5NESUdPIENPTUVOVEFETyBURU1QT1JBTE1FTlRFIFBBUkEgRVZJVEFSIFJFQ1VSU0nDk05cbiAgICAvLyBjb25zdCBjb25maWcgPSBFTlRFUlBSSVNFX0FVRElUX0NPTkZJRy5BVVRPTUFURURfQU5BTFlTSVM7XG5cbiAgICAvLyAvLyBBbsOhbGlzaXMgZGUgcGF0cm9uZXNcbiAgICAvLyBjb25zdCBwYXR0ZXJuSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgLy8gICB0cnkge1xuICAgIC8vICAgICBhd2FpdCBhbmFseXplU2VjdXJpdHlQYXR0ZXJucygpO1xuICAgIC8vICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyAgICAgY29uc29sZS5lcnJvcignW0VOVEVSUFJJU0VfQVVESVRdIEVycm9yIGVuIGFuw6FsaXNpcyBkZSBwYXRyb25lczonLCBlcnJvcik7XG4gICAgLy8gICB9XG4gICAgLy8gfSwgY29uZmlnLnBhdHRlcm5fYW5hbHlzaXNfaW50ZXJ2YWwgKiAxMDAwKTtcblxuICAgIC8vIC8vIERldGVjY2nDs24gZGUgYW5vbWFsw61hc1xuICAgIC8vIGNvbnN0IGFub21hbHlJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAvLyAgIHRyeSB7XG4gICAgLy8gICAgIGF3YWl0IHRoaXMuZGV0ZWN0QW5vbWFsaWVzKCk7XG4gICAgLy8gICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vICAgICBjb25zb2xlLmVycm9yKCdbRU5URVJQUklTRV9BVURJVF0gRXJyb3IgZW4gZGV0ZWNjacOzbiBkZSBhbm9tYWzDrWFzOicsIGVycm9yKTtcbiAgICAvLyAgIH1cbiAgICAvLyB9LCBjb25maWcuYW5vbWFseV9kZXRlY3Rpb25faW50ZXJ2YWwgKiAxMDAwKTtcblxuICAgIC8vIEFjdHVhbGl6YWNpw7NuIGRlIG3DqXRyaWNhc1xuICAgIGNvbnN0IG1ldHJpY3NJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGdldFNlY3VyaXR5TWV0cmljcygpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW0VOVEVSUFJJU0VfQVVESVRdIEVycm9yIGFjdHVhbGl6YW5kbyBtw6l0cmljYXM6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH0sIGNvbmZpZy5tZXRyaWNzX3VwZGF0ZV9pbnRlcnZhbCAqIDEwMDApO1xuXG4gICAgdGhpcy5hbmFseXNpc0ludGVydmFscy5wdXNoKHBhdHRlcm5JbnRlcnZhbCwgYW5vbWFseUludGVydmFsLCBtZXRyaWNzSW50ZXJ2YWwpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjbGVhbnVwT2xkRGF0YSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmV0ZW50aW9uID0gRU5URVJQUklTRV9BVURJVF9DT05GSUcuREFUQV9SRVRFTlRJT047XG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAvLyBMaW1waWFyIGV2ZW50b3MgYW50aWd1b3NcbiAgICAgIGNvbnN0IGV2ZW50c1RocmVzaG9sZCA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgLSByZXRlbnRpb24uc2VjdXJpdHlfZXZlbnRzICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICBcbiAgICAgIC8vIEVuIHVuIGVudG9ybm8gcmVhbCwgZXN0byBzZSBoYXLDrWEgY29uIGNvbnN1bHRhcyBTUUwgb3B0aW1pemFkYXNcbiAgICAgIGNvbnNvbGUubG9nKGBbRU5URVJQUklTRV9BVURJVF0gTGltcGlhbmRvIGV2ZW50b3MgYW50ZXJpb3JlcyBhICR7ZXZlbnRzVGhyZXNob2xkLnRvSVNPU3RyaW5nKCl9YCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tFTlRFUlBSSVNFX0FVRElUXSBFcnJvciBlbiBsaW1waWV6YSBkZSBkYXRvczonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzYXZlRW50ZXJwcmlzZUV2ZW50KGV2ZW50OiBFbnRlcnByaXNlU2VjdXJpdHlFdmVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIPCfmqsgVEVNUE9SQUxNRU5URSBERVNIQUJJTElUQURPIFBBUkEgRVZJVEFSIExPR1MgTUFTSVZPUyBEVVJBTlRFIERFQlVHXG4gICAgLy8gY29uc29sZS5sb2coJ1tFTlRFUlBSSVNFX0FVRElUXSBHdWFyZGFuZG8gZXZlbnRvIGVudGVycHJpc2U6JywgZXZlbnQuaWQpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcGVyZm9ybUltbWVkaWF0ZUFuYWx5c2lzKGV2ZW50OiBFbnRlcnByaXNlU2VjdXJpdHlFdmVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKGBbRU5URVJQUklTRV9BVURJVF0gQW7DoWxpc2lzIGlubWVkaWF0byBwYXJhIGV2ZW50byBjcsOtdGljbzogJHtldmVudC5pZH1gKTtcbiAgICBcbiAgICAvLyBJbXBsZW1lbnRhciBhbsOhbGlzaXMgaW5tZWRpYXRvIHBhcmEgZXZlbnRvcyBjcsOtdGljb3NcbiAgICBpZiAoZXZlbnQucmlza19zY29yZSAmJiBldmVudC5yaXNrX3Njb3JlID4gOTApIHtcbiAgICAgIGNvbnNvbGUud2FybihgW0VOVEVSUFJJU0VfQVVESVRdIMKhRXZlbnRvIGRlIHJpZXNnbyBleHRyZW1vIGRldGVjdGFkbyEgU2NvcmU6ICR7ZXZlbnQucmlza19zY29yZX1gKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFJlY2VudEV2ZW50cyh1c2VySWQ/OiBzdHJpbmcsIGhvdXJzOiBudW1iZXIgPSAyNCk6IFByb21pc2U8RW50ZXJwcmlzZVNlY3VyaXR5RXZlbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHN1cGFiYXNlQWRtaW4gfSA9IGF3YWl0IGltcG9ydCgnQC9saWIvc3VwYWJhc2UnKTtcbiAgICAgIGNvbnN0IGN1dG9mZlRpbWUgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gaG91cnMgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKTtcblxuICAgICAgY29uc29sZS5sb2coYFtFTlRFUlBSSVNFX0FVRElUXSBERUJVRzogZ2V0UmVjZW50RXZlbnRzIC0gY3V0b2ZmVGltZTogJHtjdXRvZmZUaW1lfSwgdXNlcklkOiAke3VzZXJJZH1gKTtcblxuICAgICAgLy8gRXN0cmF0ZWdpYSBzaW1wbGlmaWNhZGEgcGFyYSB0ZXN0aW5nXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAgIC5mcm9tKCdlbnRlcnByaXNlX2F1ZGl0X2V2ZW50cycpXG4gICAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgICAuZ3RlKCdjcmVhdGVkX2F0JywgY3V0b2ZmVGltZSlcbiAgICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xuXG4gICAgICBjb25zb2xlLmxvZyhgW0VOVEVSUFJJU0VfQVVESVRdIERFQlVHOiBnZXRSZWNlbnRFdmVudHMgLSByYXcgZGF0YSBsZW5ndGg6ICR7ZGF0YT8ubGVuZ3RoIHx8IDB9YCk7XG4gICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coYFtFTlRFUlBSSVNFX0FVRElUXSBERUJVRzogU2FtcGxlIHJhdyBldmVudDpgLCBKU09OLnN0cmluZ2lmeShkYXRhWzBdLCBudWxsLCAyKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbRU5URVJQUklTRV9BVURJVF0gRXJyb3Igb2J0ZW5pZW5kbyBldmVudG9zIHJlY2llbnRlczonLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cblxuICAgICAgbGV0IGV2ZW50cyA9IGRhdGEgfHwgW107XG5cbiAgICAgIC8vIEZpbHRyYXIgcG9yIHVzZXJJZCBzaSBzZSBlc3BlY2lmaWNhXG4gICAgICBpZiAodXNlcklkICYmIGV2ZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IGJlZm9yZUZpbHRlciA9IGV2ZW50cy5sZW5ndGg7XG4gICAgICAgIGV2ZW50cyA9IGV2ZW50cy5maWx0ZXIoZXZlbnQgPT4gZXZlbnQudXNlcl9pZCA9PT0gdXNlcklkKTtcbiAgICAgICAgY29uc29sZS5sb2coYFtFTlRFUlBSSVNFX0FVRElUXSBERUJVRzogZ2V0UmVjZW50RXZlbnRzIC0gZmlsdGVyZWQgZnJvbSAke2JlZm9yZUZpbHRlcn0gdG8gJHtldmVudHMubGVuZ3RofSBldmVudHMgZm9yIHVzZXIgJHt1c2VySWR9YCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBldmVudHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tFTlRFUlBSSVNFX0FVRElUXSBFcnJvciBlbiBnZXRSZWNlbnRFdmVudHM6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIERFVEVDVE9SRVMgREUgQU5PTUFMw41BUyBBVkFOWkFET1NcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogRGV0ZWN0YSBwYXRyb25lcyBkZSBsb2dpbiBpbnVzdWFsZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZGV0ZWN0VW51c3VhbExvZ2luUGF0dGVybihldmVudHM6IEVudGVycHJpc2VTZWN1cml0eUV2ZW50W10sIHVzZXJJZD86IHN0cmluZyk6IFByb21pc2U8U2VjdXJpdHlBbm9tYWx5RGV0ZWN0aW9uW10+IHtcbiAgICBjb25zdCBhbm9tYWxpZXM6IFNlY3VyaXR5QW5vbWFseURldGVjdGlvbltdID0gW107XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgYXV0aEV2ZW50cyA9IGV2ZW50cy5maWx0ZXIoZSA9PlxuICAgICAgICBlLmV2ZW50X2NhdGVnb3J5ID09PSAnYXV0aGVudGljYXRpb24nICYmXG4gICAgICAgICghdXNlcklkIHx8IGUudXNlcl9pZCA9PT0gdXNlcklkKVxuICAgICAgKTtcblxuICAgICAgY29uc29sZS5sb2coYFtFTlRFUlBSSVNFX0FVRElUXSBERUJVRzogZGV0ZWN0VW51c3VhbExvZ2luUGF0dGVybiAtIEZvdW5kICR7YXV0aEV2ZW50cy5sZW5ndGh9IGF1dGggZXZlbnRzYCk7XG4gICAgICBpZiAoYXV0aEV2ZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbRU5URVJQUklTRV9BVURJVF0gREVCVUc6IEF1dGggZXZlbnRzOmAsIGF1dGhFdmVudHMubWFwKGUgPT4gKHsgdHlwZTogZS5ldmVudF90eXBlLCBjYXRlZ29yeTogZS5ldmVudF9jYXRlZ29yeSwgdXNlcjogZS51c2VyX2lkIH0pKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChhdXRoRXZlbnRzLmxlbmd0aCA8IDMpIHJldHVybiBhbm9tYWxpZXM7XG5cbiAgICAgIC8vIEFncnVwYXIgcG9yIHVzdWFyaW9cbiAgICAgIGNvbnN0IHVzZXJFdmVudHMgPSBuZXcgTWFwPHN0cmluZywgRW50ZXJwcmlzZVNlY3VyaXR5RXZlbnRbXT4oKTtcbiAgICAgIGF1dGhFdmVudHMuZm9yRWFjaChldmVudCA9PiB7XG4gICAgICAgIGlmICghdXNlckV2ZW50cy5oYXMoZXZlbnQudXNlcl9pZCkpIHtcbiAgICAgICAgICB1c2VyRXZlbnRzLnNldChldmVudC51c2VyX2lkLCBbXSk7XG4gICAgICAgIH1cbiAgICAgICAgdXNlckV2ZW50cy5nZXQoZXZlbnQudXNlcl9pZCkhLnB1c2goZXZlbnQpO1xuICAgICAgfSk7XG5cbiAgICAgIGZvciAoY29uc3QgW3VpZCwgdXNlckF1dGhFdmVudHNdIG9mIHVzZXJFdmVudHMpIHtcbiAgICAgICAgY29uc3QgaW5kaWNhdG9yczogQW5vbWFseUluZGljYXRvcltdID0gW107XG4gICAgICAgIGxldCBjb25maWRlbmNlU2NvcmUgPSAwO1xuXG4gICAgICAgIC8vIDEuIE3Dumx0aXBsZXMgZmFsbG9zIHNlZ3VpZG9zIGRlIMOpeGl0byAocG9zaWJsZSBicnV0ZSBmb3JjZSBleGl0b3NvKVxuICAgICAgICBjb25zdCBmYWlsdXJlcyA9IHVzZXJBdXRoRXZlbnRzLmZpbHRlcihlID0+IGUuZXZlbnRfdHlwZSA9PT0gJ0FVVEhfRkFJTFVSRScpO1xuICAgICAgICBjb25zdCBzdWNjZXNzZXMgPSB1c2VyQXV0aEV2ZW50cy5maWx0ZXIoZSA9PiBlLmV2ZW50X3R5cGUgPT09ICdBVVRIX1NVQ0NFU1MnKTtcblxuICAgICAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID49IDMgJiYgc3VjY2Vzc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCBsYXN0RmFpbHVyZSA9IG5ldyBEYXRlKGZhaWx1cmVzW2ZhaWx1cmVzLmxlbmd0aCAtIDFdLnRpbWVzdGFtcCk7XG4gICAgICAgICAgY29uc3QgZmlyc3RTdWNjZXNzID0gbmV3IERhdGUoc3VjY2Vzc2VzWzBdLnRpbWVzdGFtcCk7XG5cbiAgICAgICAgICBpZiAoZmlyc3RTdWNjZXNzID4gbGFzdEZhaWx1cmUpIHtcbiAgICAgICAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgICAgICAgIHR5cGU6ICdicnV0ZV9mb3JjZV9zdWNjZXNzJyxcbiAgICAgICAgICAgICAgdmFsdWU6IHsgZmFpbHVyZXM6IGZhaWx1cmVzLmxlbmd0aCwgdGltZV9kaWZmOiBmaXJzdFN1Y2Nlc3MuZ2V0VGltZSgpIC0gbGFzdEZhaWx1cmUuZ2V0VGltZSgpIH0sXG4gICAgICAgICAgICAgIHdlaWdodDogMC44LFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogYCR7ZmFpbHVyZXMubGVuZ3RofSBmYWxsb3Mgc2VndWlkb3MgZGUgbG9naW4gZXhpdG9zb2BcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uZmlkZW5jZVNjb3JlICs9IDAuODtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyAyLiBMb2dpbnMgZGVzZGUgbcO6bHRpcGxlcyBJUHMgZW4gY29ydG8gdGllbXBvXG4gICAgICAgIGNvbnN0IHVuaXF1ZUlQcyA9IG5ldyBTZXQodXNlckF1dGhFdmVudHMubWFwKGUgPT4gZS5pcF9hZGRyZXNzKS5maWx0ZXIoQm9vbGVhbikpO1xuICAgICAgICBpZiAodW5pcXVlSVBzLnNpemUgPj0gMykge1xuICAgICAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiAnbXVsdGlwbGVfaXBzJyxcbiAgICAgICAgICAgIHZhbHVlOiB7IGlwX2NvdW50OiB1bmlxdWVJUHMuc2l6ZSwgaXBzOiBBcnJheS5mcm9tKHVuaXF1ZUlQcykgfSxcbiAgICAgICAgICAgIHdlaWdodDogMC42LFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGBMb2dpbiBkZXNkZSAke3VuaXF1ZUlQcy5zaXplfSBJUHMgZGlmZXJlbnRlc2BcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25maWRlbmNlU2NvcmUgKz0gMC42O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMy4gTG9naW5zIGZ1ZXJhIGRlIGhvcmFyaW8gaGFiaXR1YWxcbiAgICAgICAgY29uc3QgbG9naW5Ib3VycyA9IHVzZXJBdXRoRXZlbnRzXG4gICAgICAgICAgLmZpbHRlcihlID0+IGUuZXZlbnRfdHlwZSA9PT0gJ0FVVEhfU1VDQ0VTUycpXG4gICAgICAgICAgLm1hcChlID0+IG5ldyBEYXRlKGUudGltZXN0YW1wKS5nZXRIb3VycygpKTtcblxuICAgICAgICBjb25zdCB1bnVzdWFsSG91cnMgPSBsb2dpbkhvdXJzLmZpbHRlcihob3VyID0+IGhvdXIgPCA2IHx8IGhvdXIgPiAyMik7XG4gICAgICAgIGlmICh1bnVzdWFsSG91cnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiAndW51c3VhbF9ob3VycycsXG4gICAgICAgICAgICB2YWx1ZTogeyB1bnVzdWFsX2NvdW50OiB1bnVzdWFsSG91cnMubGVuZ3RoLCBob3VyczogdW51c3VhbEhvdXJzIH0sXG4gICAgICAgICAgICB3ZWlnaHQ6IDAuNCxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgJHt1bnVzdWFsSG91cnMubGVuZ3RofSBsb2dpbnMgZW4gaG9yYXJpb3MgaW51c3VhbGVzYFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbmZpZGVuY2VTY29yZSArPSAwLjQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDcmVhciBhbm9tYWzDrWEgc2kgaGF5IHN1ZmljaWVudGVzIGluZGljYWRvcmVzXG4gICAgICAgIGlmIChpbmRpY2F0b3JzLmxlbmd0aCA+PSAyICYmIGNvbmZpZGVuY2VTY29yZSA+PSAwLjcpIHtcbiAgICAgICAgICBhbm9tYWxpZXMucHVzaCh7XG4gICAgICAgICAgICBpZDogdGhpcy5nZW5lcmF0ZUFub21hbHlJZCgpLFxuICAgICAgICAgICAgdXNlcl9pZDogdWlkLFxuICAgICAgICAgICAgYW5vbWFseV90eXBlOiAndW51c3VhbF9sb2dpbl9wYXR0ZXJuJyxcbiAgICAgICAgICAgIGNvbmZpZGVuY2Vfc2NvcmU6IE1hdGgubWluKDEsIGNvbmZpZGVuY2VTY29yZSksXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYFBhdHLDs24gZGUgbG9naW4gaW51c3VhbCBkZXRlY3RhZG86ICR7aW5kaWNhdG9ycy5tYXAoaSA9PiBpLmRlc2NyaXB0aW9uKS5qb2luKCcsICcpfWAsXG4gICAgICAgICAgICBpbmRpY2F0b3JzLFxuICAgICAgICAgICAgcmlza19sZXZlbDogY29uZmlkZW5jZVNjb3JlID4gMC44ID8gJ2hpZ2gnIDogJ21lZGl1bScsXG4gICAgICAgICAgICBkZXRlY3RlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgc3RhdHVzOiAnbmV3JyxcbiAgICAgICAgICAgIGF1dG9tYXRlZF9hY3Rpb25zOiBbJ2xvZ19pbmNpZGVudCcsICdub3RpZnlfc2VjdXJpdHlfdGVhbSddLFxuICAgICAgICAgICAgbWFudWFsX3Jldmlld19yZXF1aXJlZDogY29uZmlkZW5jZVNjb3JlID4gMC44XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW0VOVEVSUFJJU0VfQVVESVRdIEVycm9yIGVuIGRldGVjdFVudXN1YWxMb2dpblBhdHRlcm46JywgZXJyb3IpO1xuICAgIH1cblxuICAgIHJldHVybiBhbm9tYWxpZXM7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZWN0YSB1c28gc29zcGVjaG9zbyBkZSBBUElzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGRldGVjdFN1c3BpY2lvdXNBUElVc2FnZShldmVudHM6IEVudGVycHJpc2VTZWN1cml0eUV2ZW50W10sIHVzZXJJZD86IHN0cmluZyk6IFByb21pc2U8U2VjdXJpdHlBbm9tYWx5RGV0ZWN0aW9uW10+IHtcbiAgICBjb25zdCBhbm9tYWxpZXM6IFNlY3VyaXR5QW5vbWFseURldGVjdGlvbltdID0gW107XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgYXBpRXZlbnRzID0gZXZlbnRzLmZpbHRlcihlID0+XG4gICAgICAgIGUuZXZlbnRfY2F0ZWdvcnkgPT09ICdkYXRhX2FjY2VzcycgJiZcbiAgICAgICAgKCF1c2VySWQgfHwgZS51c2VyX2lkID09PSB1c2VySWQpXG4gICAgICApO1xuXG4gICAgICBpZiAoYXBpRXZlbnRzLmxlbmd0aCA8IDUpIHJldHVybiBhbm9tYWxpZXM7XG5cbiAgICAgIC8vIEFncnVwYXIgcG9yIHVzdWFyaW9cbiAgICAgIGNvbnN0IHVzZXJFdmVudHMgPSBuZXcgTWFwPHN0cmluZywgRW50ZXJwcmlzZVNlY3VyaXR5RXZlbnRbXT4oKTtcbiAgICAgIGFwaUV2ZW50cy5mb3JFYWNoKGV2ZW50ID0+IHtcbiAgICAgICAgaWYgKCF1c2VyRXZlbnRzLmhhcyhldmVudC51c2VyX2lkKSkge1xuICAgICAgICAgIHVzZXJFdmVudHMuc2V0KGV2ZW50LnVzZXJfaWQsIFtdKTtcbiAgICAgICAgfVxuICAgICAgICB1c2VyRXZlbnRzLmdldChldmVudC51c2VyX2lkKSEucHVzaChldmVudCk7XG4gICAgICB9KTtcblxuICAgICAgZm9yIChjb25zdCBbdWlkLCB1c2VyQXBpRXZlbnRzXSBvZiB1c2VyRXZlbnRzKSB7XG4gICAgICAgIGNvbnN0IGluZGljYXRvcnM6IEFub21hbHlJbmRpY2F0b3JbXSA9IFtdO1xuICAgICAgICBsZXQgY29uZmlkZW5jZVNjb3JlID0gMDtcblxuICAgICAgICAvLyAxLiBWb2x1bWVuIGludXN1YWwgZGUgcmVxdWVzdHNcbiAgICAgICAgY29uc3QgcmVxdWVzdENvdW50ID0gdXNlckFwaUV2ZW50cy5sZW5ndGg7XG4gICAgICAgIGlmIChyZXF1ZXN0Q291bnQgPiAxMDApIHsgLy8gVW1icmFsIGNvbmZpZ3VyYWJsZVxuICAgICAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiAnaGlnaF92b2x1bWVfcmVxdWVzdHMnLFxuICAgICAgICAgICAgdmFsdWU6IHsgY291bnQ6IHJlcXVlc3RDb3VudCB9LFxuICAgICAgICAgICAgd2VpZ2h0OiAwLjYsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYCR7cmVxdWVzdENvdW50fSByZXF1ZXN0cyBlbiAyNCBob3Jhc2BcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25maWRlbmNlU2NvcmUgKz0gMC42O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMi4gQWNjZXNvIGEgcmVjdXJzb3Mgc2Vuc2libGVzXG4gICAgICAgIGNvbnN0IHNlbnNpdGl2ZVJlc291cmNlcyA9IHVzZXJBcGlFdmVudHMuZmlsdGVyKGUgPT5cbiAgICAgICAgICBlLm1ldGFkYXRhPy5yZXNvdXJjZSAmJlxuICAgICAgICAgIFsnYWRtaW4nLCAndXNlcl9kYXRhJywgJ3BheW1lbnQnLCAnc2Vuc2l0aXZlJ10uc29tZShrZXl3b3JkID0+XG4gICAgICAgICAgICBlLm1ldGFkYXRhLnJlc291cmNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoa2V5d29yZClcbiAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHNlbnNpdGl2ZVJlc291cmNlcy5sZW5ndGggPiAxMCkge1xuICAgICAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiAnc2Vuc2l0aXZlX3Jlc291cmNlX2FjY2VzcycsXG4gICAgICAgICAgICB2YWx1ZTogeyBjb3VudDogc2Vuc2l0aXZlUmVzb3VyY2VzLmxlbmd0aCB9LFxuICAgICAgICAgICAgd2VpZ2h0OiAwLjcsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYCR7c2Vuc2l0aXZlUmVzb3VyY2VzLmxlbmd0aH0gYWNjZXNvcyBhIHJlY3Vyc29zIHNlbnNpYmxlc2BcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25maWRlbmNlU2NvcmUgKz0gMC43O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMy4gUGF0csOzbiBkZSBzY3JhcGluZyAocmVxdWVzdHMgbXV5IHLDoXBpZG9zKVxuICAgICAgICBjb25zdCB0aW1lc3RhbXBzID0gdXNlckFwaUV2ZW50cy5tYXAoZSA9PiBuZXcgRGF0ZShlLnRpbWVzdGFtcCkuZ2V0VGltZSgpKS5zb3J0KCk7XG4gICAgICAgIGxldCByYXBpZFJlcXVlc3RzID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRpbWVzdGFtcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAodGltZXN0YW1wc1tpXSAtIHRpbWVzdGFtcHNbaS0xXSA8IDEwMDApIHsgLy8gPCAxIHNlZ3VuZG9cbiAgICAgICAgICAgIHJhcGlkUmVxdWVzdHMrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocmFwaWRSZXF1ZXN0cyA+IHVzZXJBcGlFdmVudHMubGVuZ3RoICogMC41KSB7XG4gICAgICAgICAgaW5kaWNhdG9ycy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6ICdyYXBpZF9yZXF1ZXN0cycsXG4gICAgICAgICAgICB2YWx1ZTogeyByYXBpZF9jb3VudDogcmFwaWRSZXF1ZXN0cywgdG90YWw6IHVzZXJBcGlFdmVudHMubGVuZ3RoIH0sXG4gICAgICAgICAgICB3ZWlnaHQ6IDAuOCxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgJHtyYXBpZFJlcXVlc3RzfSByZXF1ZXN0cyBlbiBtZW5vcyBkZSAxIHNlZ3VuZG8gZW50cmUgZWxsYXNgXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uZmlkZW5jZVNjb3JlICs9IDAuODtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWFyIGFub21hbMOtYSBzaSBoYXkgc3VmaWNpZW50ZXMgaW5kaWNhZG9yZXNcbiAgICAgICAgaWYgKGluZGljYXRvcnMubGVuZ3RoID49IDIgJiYgY29uZmlkZW5jZVNjb3JlID49IDAuNykge1xuICAgICAgICAgIGFub21hbGllcy5wdXNoKHtcbiAgICAgICAgICAgIGlkOiB0aGlzLmdlbmVyYXRlQW5vbWFseUlkKCksXG4gICAgICAgICAgICB1c2VyX2lkOiB1aWQsXG4gICAgICAgICAgICBhbm9tYWx5X3R5cGU6ICdzdXNwaWNpb3VzX2FwaV91c2FnZScsXG4gICAgICAgICAgICBjb25maWRlbmNlX3Njb3JlOiBNYXRoLm1pbigxLCBjb25maWRlbmNlU2NvcmUpLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGBVc28gc29zcGVjaG9zbyBkZSBBUEkgZGV0ZWN0YWRvOiAke2luZGljYXRvcnMubWFwKGkgPT4gaS5kZXNjcmlwdGlvbikuam9pbignLCAnKX1gLFxuICAgICAgICAgICAgaW5kaWNhdG9ycyxcbiAgICAgICAgICAgIHJpc2tfbGV2ZWw6IGNvbmZpZGVuY2VTY29yZSA+IDAuOCA/ICdoaWdoJyA6ICdtZWRpdW0nLFxuICAgICAgICAgICAgZGV0ZWN0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHN0YXR1czogJ25ldycsXG4gICAgICAgICAgICBhdXRvbWF0ZWRfYWN0aW9uczogWydyYXRlX2xpbWl0X3VzZXInLCAnbG9nX2luY2lkZW50J10sXG4gICAgICAgICAgICBtYW51YWxfcmV2aWV3X3JlcXVpcmVkOiBjb25maWRlbmNlU2NvcmUgPiAwLjhcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbRU5URVJQUklTRV9BVURJVF0gRXJyb3IgZW4gZGV0ZWN0U3VzcGljaW91c0FQSVVzYWdlOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYW5vbWFsaWVzO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdGEgaW50ZW50b3MgZGUgZXNjYWxhY2nDs24gZGUgcHJpdmlsZWdpb3NcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZGV0ZWN0UHJpdmlsZWdlRXNjYWxhdGlvbihldmVudHM6IEVudGVycHJpc2VTZWN1cml0eUV2ZW50W10sIHVzZXJJZD86IHN0cmluZyk6IFByb21pc2U8U2VjdXJpdHlBbm9tYWx5RGV0ZWN0aW9uW10+IHtcbiAgICBjb25zdCBhbm9tYWxpZXM6IFNlY3VyaXR5QW5vbWFseURldGVjdGlvbltdID0gW107XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgYXV0aEV2ZW50cyA9IGV2ZW50cy5maWx0ZXIoZSA9PlxuICAgICAgICBlLmV2ZW50X2NhdGVnb3J5ID09PSAnYXV0aG9yaXphdGlvbicgJiZcbiAgICAgICAgKCF1c2VySWQgfHwgZS51c2VyX2lkID09PSB1c2VySWQpXG4gICAgICApO1xuXG4gICAgICBpZiAoYXV0aEV2ZW50cy5sZW5ndGggPCAzKSByZXR1cm4gYW5vbWFsaWVzO1xuXG4gICAgICAvLyBBZ3J1cGFyIHBvciB1c3VhcmlvXG4gICAgICBjb25zdCB1c2VyRXZlbnRzID0gbmV3IE1hcDxzdHJpbmcsIEVudGVycHJpc2VTZWN1cml0eUV2ZW50W10+KCk7XG4gICAgICBhdXRoRXZlbnRzLmZvckVhY2goZXZlbnQgPT4ge1xuICAgICAgICBpZiAoIXVzZXJFdmVudHMuaGFzKGV2ZW50LnVzZXJfaWQpKSB7XG4gICAgICAgICAgdXNlckV2ZW50cy5zZXQoZXZlbnQudXNlcl9pZCwgW10pO1xuICAgICAgICB9XG4gICAgICAgIHVzZXJFdmVudHMuZ2V0KGV2ZW50LnVzZXJfaWQpIS5wdXNoKGV2ZW50KTtcbiAgICAgIH0pO1xuXG4gICAgICBmb3IgKGNvbnN0IFt1aWQsIHVzZXJBdXRoRXZlbnRzXSBvZiB1c2VyRXZlbnRzKSB7XG4gICAgICAgIGNvbnN0IGluZGljYXRvcnM6IEFub21hbHlJbmRpY2F0b3JbXSA9IFtdO1xuICAgICAgICBsZXQgY29uZmlkZW5jZVNjb3JlID0gMDtcblxuICAgICAgICAvLyAxLiBNw7psdGlwbGVzIGRlbmVnYWNpb25lcyBkZSBwZXJtaXNvc1xuICAgICAgICBjb25zdCBkZW5pZWRFdmVudHMgPSB1c2VyQXV0aEV2ZW50cy5maWx0ZXIoZSA9PiBlLmV2ZW50X3R5cGUgPT09ICdQRVJNSVNTSU9OX0RFTklFRCcpO1xuICAgICAgICBpZiAoZGVuaWVkRXZlbnRzLmxlbmd0aCA+PSA1KSB7XG4gICAgICAgICAgaW5kaWNhdG9ycy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6ICdtdWx0aXBsZV9wZXJtaXNzaW9uX2RlbmlhbHMnLFxuICAgICAgICAgICAgdmFsdWU6IHsgY291bnQ6IGRlbmllZEV2ZW50cy5sZW5ndGggfSxcbiAgICAgICAgICAgIHdlaWdodDogMC43LFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGAke2RlbmllZEV2ZW50cy5sZW5ndGh9IGRlbmVnYWNpb25lcyBkZSBwZXJtaXNvc2BcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25maWRlbmNlU2NvcmUgKz0gMC43O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMi4gSW50ZW50b3MgZGUgYWNjZXNvIGEgcmVjdXJzb3MgYWRtaW5cbiAgICAgICAgY29uc3QgYWRtaW5BdHRlbXB0cyA9IHVzZXJBdXRoRXZlbnRzLmZpbHRlcihlID0+XG4gICAgICAgICAgZS5tZXRhZGF0YT8ub3BlcmF0aW9uICYmXG4gICAgICAgICAgZS5tZXRhZGF0YS5vcGVyYXRpb24udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnYWRtaW4nKVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChhZG1pbkF0dGVtcHRzLmxlbmd0aCA+PSAzKSB7XG4gICAgICAgICAgaW5kaWNhdG9ycy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6ICdhZG1pbl9hY2Nlc3NfYXR0ZW1wdHMnLFxuICAgICAgICAgICAgdmFsdWU6IHsgY291bnQ6IGFkbWluQXR0ZW1wdHMubGVuZ3RoIH0sXG4gICAgICAgICAgICB3ZWlnaHQ6IDAuOCxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgJHthZG1pbkF0dGVtcHRzLmxlbmd0aH0gaW50ZW50b3MgZGUgYWNjZXNvIGFkbWluaXN0cmF0aXZvYFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbmZpZGVuY2VTY29yZSArPSAwLjg7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAzLiBDYW1iaW9zIGRlIHJvbCBzb3NwZWNob3Nvc1xuICAgICAgICBjb25zdCByb2xlQ2hhbmdlcyA9IHVzZXJBdXRoRXZlbnRzLmZpbHRlcihlID0+IGUuZXZlbnRfdHlwZSA9PT0gJ1JPTEVfQ0hBTkdFJyk7XG4gICAgICAgIGlmIChyb2xlQ2hhbmdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgaW5kaWNhdG9ycy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6ICdyb2xlX2NoYW5nZXMnLFxuICAgICAgICAgICAgdmFsdWU6IHsgY291bnQ6IHJvbGVDaGFuZ2VzLmxlbmd0aCB9LFxuICAgICAgICAgICAgd2VpZ2h0OiAwLjksXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYCR7cm9sZUNoYW5nZXMubGVuZ3RofSBjYW1iaW9zIGRlIHJvbCBkZXRlY3RhZG9zYFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbmZpZGVuY2VTY29yZSArPSAwLjk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDcmVhciBhbm9tYWzDrWEgc2kgaGF5IHN1ZmljaWVudGVzIGluZGljYWRvcmVzXG4gICAgICAgIGlmIChpbmRpY2F0b3JzLmxlbmd0aCA+PSAxICYmIGNvbmZpZGVuY2VTY29yZSA+PSAwLjcpIHtcbiAgICAgICAgICBhbm9tYWxpZXMucHVzaCh7XG4gICAgICAgICAgICBpZDogdGhpcy5nZW5lcmF0ZUFub21hbHlJZCgpLFxuICAgICAgICAgICAgdXNlcl9pZDogdWlkLFxuICAgICAgICAgICAgYW5vbWFseV90eXBlOiAncHJpdmlsZWdlX2VzY2FsYXRpb25fYXR0ZW1wdCcsXG4gICAgICAgICAgICBjb25maWRlbmNlX3Njb3JlOiBNYXRoLm1pbigxLCBjb25maWRlbmNlU2NvcmUpLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGBJbnRlbnRvIGRlIGVzY2FsYWNpw7NuIGRlIHByaXZpbGVnaW9zOiAke2luZGljYXRvcnMubWFwKGkgPT4gaS5kZXNjcmlwdGlvbikuam9pbignLCAnKX1gLFxuICAgICAgICAgICAgaW5kaWNhdG9ycyxcbiAgICAgICAgICAgIHJpc2tfbGV2ZWw6IGNvbmZpZGVuY2VTY29yZSA+IDAuOCA/ICdjcml0aWNhbCcgOiAnaGlnaCcsXG4gICAgICAgICAgICBkZXRlY3RlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgc3RhdHVzOiAnbmV3JyxcbiAgICAgICAgICAgIGF1dG9tYXRlZF9hY3Rpb25zOiBbJ2Jsb2NrX3VzZXInLCAnaW52YWxpZGF0ZV9zZXNzaW9ucycsICdub3RpZnlfc2VjdXJpdHlfdGVhbSddLFxuICAgICAgICAgICAgbWFudWFsX3Jldmlld19yZXF1aXJlZDogdHJ1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tFTlRFUlBSSVNFX0FVRElUXSBFcnJvciBlbiBkZXRlY3RQcml2aWxlZ2VFc2NhbGF0aW9uOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYW5vbWFsaWVzO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdGEgYWJ1c28gZGUgcmF0ZSBsaW1pdGluZ1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBkZXRlY3RSYXRlTGltaXRBYnVzZShldmVudHM6IEVudGVycHJpc2VTZWN1cml0eUV2ZW50W10sIHVzZXJJZD86IHN0cmluZyk6IFByb21pc2U8U2VjdXJpdHlBbm9tYWx5RGV0ZWN0aW9uW10+IHtcbiAgICBjb25zdCBhbm9tYWxpZXM6IFNlY3VyaXR5QW5vbWFseURldGVjdGlvbltdID0gW107XG5cbiAgICB0cnkge1xuICAgICAgLy8gT2J0ZW5lciBtw6l0cmljYXMgZGUgcmF0ZSBsaW1pdGluZ1xuICAgICAgY29uc3QgcmF0ZUxpbWl0U3RhdHMgPSB0aGlzLmdldFJhdGVMaW1pdGluZ1N0YXRzKCk7XG5cbiAgICAgIGlmIChyYXRlTGltaXRTdGF0cy5ibG9ja2VkUmVxdWVzdHMgPT09IDApIHJldHVybiBhbm9tYWxpZXM7XG5cbiAgICAgIC8vIEFuYWxpemFyIElQcyBjb24gbcOhcyBibG9xdWVvc1xuICAgICAgY29uc3QgdG9wQmxvY2tlZElQcyA9IHJhdGVMaW1pdFN0YXRzLnRvcEJsb2NrZWRJUHMgfHwgW107XG5cbiAgICAgIGZvciAoY29uc3QgaXBEYXRhIG9mIHRvcEJsb2NrZWRJUHMpIHtcbiAgICAgICAgaWYgKGlwRGF0YS5jb3VudCA+PSAxMCkgeyAvLyBVbWJyYWwgY29uZmlndXJhYmxlXG4gICAgICAgICAgY29uc3QgaW5kaWNhdG9yczogQW5vbWFseUluZGljYXRvcltdID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiAncmF0ZV9saW1pdF92aW9sYXRpb25zJyxcbiAgICAgICAgICAgICAgdmFsdWU6IHsgY291bnQ6IGlwRGF0YS5jb3VudCwgaXA6IGlwRGF0YS5pcCB9LFxuICAgICAgICAgICAgICB3ZWlnaHQ6IDAuOCxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGAke2lwRGF0YS5jb3VudH0gdmlvbGFjaW9uZXMgZGUgcmF0ZSBsaW1pdCBkZXNkZSBJUCAke2lwRGF0YS5pcH1gXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXTtcblxuICAgICAgICAgIC8vIEJ1c2NhciBldmVudG9zIHJlbGFjaW9uYWRvcyBjb24gZXN0YSBJUFxuICAgICAgICAgIGNvbnN0IGlwRXZlbnRzID0gZXZlbnRzLmZpbHRlcihlID0+IGUuaXBfYWRkcmVzcyA9PT0gaXBEYXRhLmlwKTtcbiAgICAgICAgICBjb25zdCB1bmlxdWVVc2VycyA9IG5ldyBTZXQoaXBFdmVudHMubWFwKGUgPT4gZS51c2VyX2lkKSk7XG5cbiAgICAgICAgICBpZiAodW5pcXVlVXNlcnMuc2l6ZSA+IDEpIHtcbiAgICAgICAgICAgIGluZGljYXRvcnMucHVzaCh7XG4gICAgICAgICAgICAgIHR5cGU6ICdtdWx0aXBsZV91c2Vyc19zYW1lX2lwJyxcbiAgICAgICAgICAgICAgdmFsdWU6IHsgdXNlcl9jb3VudDogdW5pcXVlVXNlcnMuc2l6ZSwgaXA6IGlwRGF0YS5pcCB9LFxuICAgICAgICAgICAgICB3ZWlnaHQ6IDAuNixcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGAke3VuaXF1ZVVzZXJzLnNpemV9IHVzdWFyaW9zIGRpZmVyZW50ZXMgZGVzZGUgbGEgbWlzbWEgSVBgXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBhbm9tYWxpZXMucHVzaCh7XG4gICAgICAgICAgICBpZDogdGhpcy5nZW5lcmF0ZUFub21hbHlJZCgpLFxuICAgICAgICAgICAgdXNlcl9pZDogQXJyYXkuZnJvbSh1bmlxdWVVc2VycylbMF0gfHwgJ3Vua25vd24nLFxuICAgICAgICAgICAgYW5vbWFseV90eXBlOiAncmF0ZV9saW1pdF9hYnVzZScsXG4gICAgICAgICAgICBjb25maWRlbmNlX3Njb3JlOiAwLjgsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYEFidXNvIGRlIHJhdGUgbGltaXRpbmcgZGV0ZWN0YWRvIGRlc2RlIElQICR7aXBEYXRhLmlwfWAsXG4gICAgICAgICAgICBpbmRpY2F0b3JzLFxuICAgICAgICAgICAgcmlza19sZXZlbDogJ2hpZ2gnLFxuICAgICAgICAgICAgZGV0ZWN0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHN0YXR1czogJ25ldycsXG4gICAgICAgICAgICBhdXRvbWF0ZWRfYWN0aW9uczogWydibG9ja19pcCcsICdsb2dfaW5jaWRlbnQnXSxcbiAgICAgICAgICAgIG1hbnVhbF9yZXZpZXdfcmVxdWlyZWQ6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW0VOVEVSUFJJU0VfQVVESVRdIEVycm9yIGVuIGRldGVjdFJhdGVMaW1pdEFidXNlOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYW5vbWFsaWVzO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkZXRlY3RHZW9ncmFwaGljQW5vbWFseShldmVudHM6IEVudGVycHJpc2VTZWN1cml0eUV2ZW50W10sIHVzZXJJZD86IHN0cmluZyk6IFByb21pc2U8U2VjdXJpdHlBbm9tYWx5RGV0ZWN0aW9uW10+IHtcbiAgICAvLyBJbXBsZW1lbnRhY2nDs24gYsOhc2ljYSAtIGVuIHByb2R1Y2Npw7NuIHNlIGludGVncmFyw61hIGNvbiBzZXJ2aWNpbyBkZSBnZW9sb2NhbGl6YWNpw7NuXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkZXRlY3RUaW1lQmFzZWRBbm9tYWx5KGV2ZW50czogRW50ZXJwcmlzZVNlY3VyaXR5RXZlbnRbXSwgdXNlcklkPzogc3RyaW5nKTogUHJvbWlzZTxTZWN1cml0eUFub21hbHlEZXRlY3Rpb25bXT4ge1xuICAgIC8vIEltcGxlbWVudGFjacOzbiBiw6FzaWNhIC0gZGV0ZWN0YXLDrWEgYWN0aXZpZGFkIGZ1ZXJhIGRlIGhvcmFyaW9zIG5vcm1hbGVzXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkZXRlY3RCZWhhdmlvcmFsRGV2aWF0aW9uKGV2ZW50czogRW50ZXJwcmlzZVNlY3VyaXR5RXZlbnRbXSwgdXNlcklkPzogc3RyaW5nKTogUHJvbWlzZTxTZWN1cml0eUFub21hbHlEZXRlY3Rpb25bXT4ge1xuICAgIC8vIEltcGxlbWVudGFjacOzbiBiw6FzaWNhIC0gY29tcGFyYXLDrWEgY29uIHBhdHJvbmVzIGhpc3TDs3JpY29zIGRlbCB1c3VhcmlvXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUFub21hbHlJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgYW5vbV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNhdmVBbm9tYWxpZXMoYW5vbWFsaWVzOiBTZWN1cml0eUFub21hbHlEZXRlY3Rpb25bXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKGBbRU5URVJQUklTRV9BVURJVF0gR3VhcmRhbmRvICR7YW5vbWFsaWVzLmxlbmd0aH0gYW5vbWFsw61hcyBkZXRlY3RhZGFzYCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEFub21hbGllc0luUGVyaW9kKHN0YXJ0RGF0ZTogc3RyaW5nLCBlbmREYXRlOiBzdHJpbmcpOiBQcm9taXNlPFNlY3VyaXR5QW5vbWFseURldGVjdGlvbltdPiB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRJbmNpZGVudHNJblBlcmlvZChzdGFydERhdGU6IHN0cmluZywgZW5kRGF0ZTogc3RyaW5nKTogUHJvbWlzZTxTZWN1cml0eUluY2lkZW50W10+IHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICBwcml2YXRlIGdldFJhdGVMaW1pdGluZ1N0YXRzKCkge1xuICAgIHJldHVybiByYXRlTGltaXRNZXRyaWNzLmdldE1ldHJpY3MoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q29tcGxpYW5jZU1ldHJpY3Moc3RhcnREYXRlOiBzdHJpbmcsIGVuZERhdGU6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGF1ZGl0X2NvdmVyYWdlOiA5NSxcbiAgICAgIHBvbGljeV92aW9sYXRpb25zOiAyLFxuICAgICAgZGF0YV9yZXRlbnRpb25fY29tcGxpYW5jZTogdHJ1ZVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHBlcmZvcm1SaXNrQXNzZXNzbWVudCgpOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiB7XG4gICAgICBvdmVyYWxsX3Jpc2tfbGV2ZWw6ICdtZWRpdW0nLFxuICAgICAgcmlza19mYWN0b3JzOiBbXSxcbiAgICAgIG1pdGlnYXRpb25fcmVjb21tZW5kYXRpb25zOiBbXVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlUmVjb21tZW5kYXRpb25zKCk6IFByb21pc2U8U2VjdXJpdHlSZWNvbW1lbmRhdGlvbltdPiB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc3RydWN0b3IgcGFyYSBsaW1waWFyIGludGVydmFsb3NcbiAgICovXG4gIHB1YmxpYyBkZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuYW5hbHlzaXNJbnRlcnZhbHMuZm9yRWFjaChpbnRlcnZhbCA9PiBjbGVhckludGVydmFsKGludGVydmFsKSk7XG4gICAgdGhpcy5hbmFseXNpc0ludGVydmFscyA9IFtdO1xuICB9XG59XG5cbi8vIEluc3RhbmNpYSBzaW5nbGV0b25cbmV4cG9ydCBjb25zdCBlbnRlcnByaXNlQXVkaXRTeXN0ZW0gPSBFbnRlcnByaXNlQXVkaXRTeXN0ZW0uZ2V0SW5zdGFuY2UoKTtcbiJdLCJuYW1lcyI6WyJFTlRFUlBSSVNFX0FVRElUX0NPTkZJRyIsIkVudGVycHJpc2VBdWRpdFN5c3RlbSIsImVudGVycHJpc2VBdWRpdFN5c3RlbSIsIkRBVEFfUkVURU5USU9OIiwic2VjdXJpdHlfZXZlbnRzIiwiYW5vbWFsaWVzIiwiaW5jaWRlbnRzIiwibWV0cmljcyIsIkRFVEVDVElPTl9USFJFU0hPTERTIiwiYW5vbWFseV9jb25maWRlbmNlIiwicmlza19zY29yZV9jcml0aWNhbCIsInJpc2tfc2NvcmVfaGlnaCIsInJpc2tfc2NvcmVfbWVkaXVtIiwiZmFsc2VfcG9zaXRpdmVfdGhyZXNob2xkIiwiQUxFUlRfQ09ORklHIiwiaW1tZWRpYXRlX25vdGlmaWNhdGlvbiIsImJhdGNoX25vdGlmaWNhdGlvbiIsIm5vdGlmaWNhdGlvbl9jb29sZG93biIsImVzY2FsYXRpb25fdGltZW91dCIsIkFVVE9NQVRFRF9BTkFMWVNJUyIsInBhdHRlcm5fYW5hbHlzaXNfaW50ZXJ2YWwiLCJhbm9tYWx5X2RldGVjdGlvbl9pbnRlcnZhbCIsIm1ldHJpY3NfdXBkYXRlX2ludGVydmFsIiwiY2xlYW51cF9pbnRlcnZhbCIsImFuYWx5c2lzSW50ZXJ2YWxzIiwiZ2V0SW5zdGFuY2UiLCJpbnN0YW5jZSIsImluaXRpYWxpemUiLCJjb25zb2xlIiwibG9nIiwiZW5zdXJlRGF0YWJhc2VUYWJsZXMiLCJzdGFydEF1dG9tYXRlZEFuYWx5c2lzIiwiY2xlYW51cE9sZERhdGEiLCJlcnJvciIsImxvZ0VudGVycHJpc2VFdmVudCIsImV2ZW50IiwiY29udGV4dCIsInJlcXVlc3QiLCJjb3JyZWxhdGlvbklkIiwiZ2VuZXJhdGVDb3JyZWxhdGlvbklkIiwicmlza1Njb3JlIiwiY2FsY3VsYXRlUmlza1Njb3JlIiwiZW50ZXJwcmlzZUV2ZW50IiwiaWQiLCJnZW5lcmF0ZUV2ZW50SWQiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJyZXNvbHZlZCIsImNvcnJlbGF0aW9uX2lkIiwicmlza19zY29yZSIsImVudGVycHJpc2VfY29udGV4dCIsInNlY3VyaXR5X2xldmVsIiwic2VjdXJpdHlMZXZlbCIsInBlcm1pc3Npb25zIiwic2Vzc2lvbl9pZCIsInNlc3Npb25JZCIsInJlcXVlc3RfaWQiLCJnZW5lcmF0ZVJlcXVlc3RJZCIsInJhdGVfbGltaXRfc3RhdHVzIiwiZ2V0UmF0ZUxpbWl0U3RhdHVzIiwicmxzX2NvbnRleHQiLCJmaWx0ZXJzX2FwcGxpZWQiLCJieXBhc3NfZW5hYmxlZCIsInJvbGUiLCJ1bmRlZmluZWQiLCJsb2dTZWN1cml0eUV2ZW50Iiwic2F2ZUVudGVycHJpc2VFdmVudCIsInNldmVyaXR5IiwicGVyZm9ybUltbWVkaWF0ZUFuYWx5c2lzIiwiZGV0ZWN0QW5vbWFsaWVzIiwidXNlcklkIiwicmVjZW50RXZlbnRzIiwiZ2V0UmVjZW50RXZlbnRzIiwibGVuZ3RoIiwiSlNPTiIsInN0cmluZ2lmeSIsImRldGVjdG9ycyIsImRldGVjdFVudXN1YWxMb2dpblBhdHRlcm4iLCJkZXRlY3RTdXNwaWNpb3VzQVBJVXNhZ2UiLCJkZXRlY3RQcml2aWxlZ2VFc2NhbGF0aW9uIiwiZGV0ZWN0UmF0ZUxpbWl0QWJ1c2UiLCJkZXRlY3RHZW9ncmFwaGljQW5vbWFseSIsImRldGVjdFRpbWVCYXNlZEFub21hbHkiLCJkZXRlY3RCZWhhdmlvcmFsRGV2aWF0aW9uIiwiZGV0ZWN0b3IiLCJkZXRlY3RlZEFub21hbGllcyIsImNhbGwiLCJwdXNoIiwiaGlnaENvbmZpZGVuY2VBbm9tYWxpZXMiLCJmaWx0ZXIiLCJhIiwiY29uZmlkZW5jZV9zY29yZSIsInNhdmVBbm9tYWxpZXMiLCJnZW5lcmF0ZUVudGVycHJpc2VSZXBvcnQiLCJzdGFydERhdGUiLCJlbmREYXRlIiwiaW5jbHVkZUFub21hbGllcyIsImluY2x1ZGVJbmNpZGVudHMiLCJiYXNlUmVwb3J0IiwiZ2VuZXJhdGVTZWN1cml0eVJlcG9ydCIsImVudGVycHJpc2VEYXRhIiwiZ2V0QW5vbWFsaWVzSW5QZXJpb2QiLCJnZXRJbmNpZGVudHNJblBlcmlvZCIsInJhdGVfbGltaXRpbmdfc3RhdHMiLCJnZXRSYXRlTGltaXRpbmdTdGF0cyIsImNvbXBsaWFuY2VfbWV0cmljcyIsImdldENvbXBsaWFuY2VNZXRyaWNzIiwicmlza19hc3Nlc3NtZW50IiwicGVyZm9ybVJpc2tBc3Nlc3NtZW50IiwicmVjb21tZW5kYXRpb25zIiwiZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMiLCJlbnRlcnByaXNlX2RhdGEiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJoZWFkZXJzIiwiZ2V0Iiwic2NvcmUiLCJldmVudF90eXBlIiwiZXZlbnRfY2F0ZWdvcnkiLCJtaW4iLCJtYXgiLCJyYXRlTGltaXRNZXRyaWNzIiwiZ2V0TWV0cmljcyIsImFsbG93ZWQiLCJhbGxvd2VkUmVxdWVzdHMiLCJyZW1haW5pbmciLCJsaW1pdCIsInRvdGFsUmVxdWVzdHMiLCJtZXRyaWNzSW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsImdldFNlY3VyaXR5TWV0cmljcyIsImNvbmZpZyIsInBhdHRlcm5JbnRlcnZhbCIsImFub21hbHlJbnRlcnZhbCIsInJldGVudGlvbiIsImV2ZW50c1RocmVzaG9sZCIsImdldFRpbWUiLCJ3YXJuIiwiaG91cnMiLCJzdXBhYmFzZUFkbWluIiwiY3V0b2ZmVGltZSIsImRhdGEiLCJmcm9tIiwic2VsZWN0IiwiZ3RlIiwib3JkZXIiLCJhc2NlbmRpbmciLCJldmVudHMiLCJiZWZvcmVGaWx0ZXIiLCJ1c2VyX2lkIiwiYXV0aEV2ZW50cyIsImUiLCJtYXAiLCJ0eXBlIiwiY2F0ZWdvcnkiLCJ1c2VyIiwidXNlckV2ZW50cyIsIk1hcCIsImZvckVhY2giLCJoYXMiLCJzZXQiLCJ1aWQiLCJ1c2VyQXV0aEV2ZW50cyIsImluZGljYXRvcnMiLCJjb25maWRlbmNlU2NvcmUiLCJmYWlsdXJlcyIsInN1Y2Nlc3NlcyIsImxhc3RGYWlsdXJlIiwiZmlyc3RTdWNjZXNzIiwidmFsdWUiLCJ0aW1lX2RpZmYiLCJ3ZWlnaHQiLCJkZXNjcmlwdGlvbiIsInVuaXF1ZUlQcyIsIlNldCIsImlwX2FkZHJlc3MiLCJCb29sZWFuIiwic2l6ZSIsImlwX2NvdW50IiwiaXBzIiwiQXJyYXkiLCJsb2dpbkhvdXJzIiwiZ2V0SG91cnMiLCJ1bnVzdWFsSG91cnMiLCJob3VyIiwidW51c3VhbF9jb3VudCIsImdlbmVyYXRlQW5vbWFseUlkIiwiYW5vbWFseV90eXBlIiwiaSIsImpvaW4iLCJyaXNrX2xldmVsIiwiZGV0ZWN0ZWRfYXQiLCJzdGF0dXMiLCJhdXRvbWF0ZWRfYWN0aW9ucyIsIm1hbnVhbF9yZXZpZXdfcmVxdWlyZWQiLCJhcGlFdmVudHMiLCJ1c2VyQXBpRXZlbnRzIiwicmVxdWVzdENvdW50IiwiY291bnQiLCJzZW5zaXRpdmVSZXNvdXJjZXMiLCJtZXRhZGF0YSIsInJlc291cmNlIiwic29tZSIsImtleXdvcmQiLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwidGltZXN0YW1wcyIsInNvcnQiLCJyYXBpZFJlcXVlc3RzIiwicmFwaWRfY291bnQiLCJ0b3RhbCIsImRlbmllZEV2ZW50cyIsImFkbWluQXR0ZW1wdHMiLCJvcGVyYXRpb24iLCJyb2xlQ2hhbmdlcyIsInJhdGVMaW1pdFN0YXRzIiwiYmxvY2tlZFJlcXVlc3RzIiwidG9wQmxvY2tlZElQcyIsImlwRGF0YSIsImlwIiwiaXBFdmVudHMiLCJ1bmlxdWVVc2VycyIsInVzZXJfY291bnQiLCJhdWRpdF9jb3ZlcmFnZSIsInBvbGljeV92aW9sYXRpb25zIiwiZGF0YV9yZXRlbnRpb25fY29tcGxpYW5jZSIsIm92ZXJhbGxfcmlza19sZXZlbCIsInJpc2tfZmFjdG9ycyIsIm1pdGlnYXRpb25fcmVjb21tZW5kYXRpb25zIiwiZGVzdHJveSIsImludGVydmFsIiwiY2xlYXJJbnRlcnZhbCJdLCJtYXBwaW5ncyI6IkFBQUE7OztDQUdDOzs7Ozs7Ozs7OztRQWdMWUE7ZUFBQUE7O1FBdUNBQztlQUFBQTs7UUFzd0JBQztlQUFBQTs7OytCQXA5Qk47dUNBT0E7dUNBQzhDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUErSjlDLE1BQU1GLDBCQUEwQjtJQUNyQyxxQkFBcUI7SUFDckJHLGdCQUFnQjtRQUNkQyxpQkFBaUI7UUFDakJDLFdBQVc7UUFDWEMsV0FBVztRQUNYQyxTQUFTO0lBQ1g7SUFFQSx3QkFBd0I7SUFDeEJDLHNCQUFzQjtRQUNwQkMsb0JBQW9CO1FBQ3BCQyxxQkFBcUI7UUFDckJDLGlCQUFpQjtRQUNqQkMsbUJBQW1CO1FBQ25CQywwQkFBMEI7SUFDNUI7SUFFQSwyQkFBMkI7SUFDM0JDLGNBQWM7UUFDWkMsd0JBQXdCO1lBQUM7U0FBVztRQUNwQ0Msb0JBQW9CO1lBQUM7WUFBUTtTQUFTO1FBQ3RDQyx1QkFBdUI7UUFDdkJDLG9CQUFvQixLQUFLLFdBQVc7SUFDdEM7SUFFQSxzQkFBc0I7SUFDdEJDLG9CQUFvQjtRQUNsQkMsMkJBQTJCO1FBQzNCQyw0QkFBNEI7UUFDNUJDLHlCQUF5QjtRQUN6QkMsa0JBQWtCLE1BQU0sV0FBVztJQUNyQztBQUNGO0FBTU8sTUFBTXRCO0lBSVgsYUFBc0I7YUFGZHVCLG9CQUFzQyxFQUFFO0lBRXpCO0lBRXZCLE9BQWNDLGNBQXFDO1FBQ2pELElBQUksQ0FBQ3hCLHNC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