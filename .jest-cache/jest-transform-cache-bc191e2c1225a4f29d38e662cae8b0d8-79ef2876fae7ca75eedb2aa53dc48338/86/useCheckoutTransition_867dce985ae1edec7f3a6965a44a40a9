ba36979edebd929c23bc8b26781b9916
"use client";
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get default () {
        return _default;
    },
    get useCheckoutTransition () {
        return useCheckoutTransition;
    }
});
const _react = require("react");
const _navigation = require("next/navigation");
function useCheckoutTransition(options = {}) {
    const { onTransitionStart, onTransitionComplete, onTransitionError, enableAnimation = true, enablePerformanceTracking = true, customDuration, skipAnimationThreshold = 100 } = options;
    const router = (0, _navigation.useRouter)();
    const [isTransitioning, setIsTransitioning] = (0, _react.useState)(false);
    const [skipAnimation, setSkipAnimation] = (0, _react.useState)(false);
    const [transitionProgress, setTransitionProgress] = (0, _react.useState)(0);
    // Refs para cleanup y performance tracking
    const timeoutRef = (0, _react.useRef)(null);
    const progressIntervalRef = (0, _react.useRef)(null);
    const performanceRef = (0, _react.useRef)({
        startTime: null,
        endTime: null,
        duration: null
    });
    // Memoizar duración para evitar recálculos
    const animationDuration = (0, _react.useMemo)(()=>{
        if (customDuration) return customDuration;
        return skipAnimation ? 200 : 2800;
    }, [
        skipAnimation,
        customDuration
    ]);
    // Detectar preferencia de movimiento reducido con mejor manejo de errores
    (0, _react.useEffect)(()=>{
        try {
            const mediaQuery = window.matchMedia("(prefers-reduced-motion: reduce)");
            const handleChange = (e)=>{
                const shouldSkip = e.matches || !enableAnimation;
                setSkipAnimation(shouldSkip);
                // Performance tracking para preferencias de accesibilidad
                if (enablePerformanceTracking && shouldSkip) {
                    console.debug('[useCheckoutTransition] Animation skipped due to accessibility preferences');
                }
            };
            // Configuración inicial
            setSkipAnimation(mediaQuery.matches || !enableAnimation);
            // Escuchar cambios con soporte para navegadores antiguos
            if (mediaQuery.addEventListener) {
                mediaQuery.addEventListener("change", handleChange);
            } else {
                // Fallback para navegadores antiguos
                mediaQuery.addListener(handleChange);
            }
            return ()=>{
                if (mediaQuery.removeEventListener) {
                    mediaQuery.removeEventListener("change", handleChange);
                } else {
                    mediaQuery.removeListener(handleChange);
                }
            };
        } catch (error) {
            console.warn('[useCheckoutTransition] Error setting up media query listener:', error);
            setSkipAnimation(!enableAnimation);
        }
    }, [
        enableAnimation,
        enablePerformanceTracking
    ]);
    // Cleanup en unmount
    (0, _react.useEffect)(()=>{
        return ()=>{
            if (timeoutRef.current) {
                clearTimeout(timeoutRef.current);
            }
            if (progressIntervalRef.current) {
                clearInterval(progressIntervalRef.current);
            }
        };
    }, []);
    // Función optimizada para iniciar la transición
    const startTransition = (0, _react.useCallback)(()=>{
        if (isTransitioning) {
            console.warn('[useCheckoutTransition] Transition already in progress, ignoring duplicate call');
            return;
        }
        try {
            // Performance tracking
            const startTime = enablePerformanceTracking ? performance.now() : 0;
            performanceRef.current.startTime = startTime;
            setIsTransitioning(true);
            setTransitionProgress(0);
            // Callback de inicio con error handling
            try {
                onTransitionStart?.();
            } catch (error) {
                console.error('[useCheckoutTransition] Error in onTransitionStart callback:', error);
                onTransitionError?.(error);
            }
            // Progress tracking para animaciones largas
            if (!skipAnimation && animationDuration > skipAnimationThreshold) {
                const progressInterval = setInterval(()=>{
                    setTransitionProgress((prev)=>{
                        const elapsed = performance.now() - startTime;
                        const progress = Math.min(elapsed / animationDuration * 100, 100);
                        return progress;
                    });
                }, 16); // 60fps updates
                progressIntervalRef.current = progressInterval;
            }
            // Auto-reset con cleanup mejorado
            const timeout = setTimeout(()=>{
                try {
                    const endTime = enablePerformanceTracking ? performance.now() : 0;
                    performanceRef.current.endTime = endTime;
                    performanceRef.current.duration = endTime - startTime;
                    setIsTransitioning(false);
                    setTransitionProgress(100);
                    // Cleanup progress interval
                    if (progressIntervalRef.current) {
                        clearInterval(progressIntervalRef.current);
                        progressIntervalRef.current = null;
                    }
                    // Performance logging
                    if (enablePerformanceTracking) {
                        console.debug('[useCheckoutTransition] Transition completed', {
                            duration: performanceRef.current.duration,
                            skipAnimation,
                            animationDuration
                        });
                    }
                    // Callback de finalización con error handling
                    try {
                        onTransitionComplete?.();
                    } catch (error) {
                        console.error('[useCheckoutTransition] Error in onTransitionComplete callback:', error);
                        onTransitionError?.(error);
                    }
                    // Navegación con error handling
                    try {
                        router.push('/checkout');
                    } catch (error) {
                        console.error('[useCheckoutTransition] Error during navigation:', error);
                        onTransitionError?.(error);
                    }
                } catch (error) {
                    console.error('[useCheckoutTransition] Error during transition completion:', error);
                    onTransitionError?.(error);
                    setIsTransitioning(false);
                }
            }, animationDuration);
            timeoutRef.current = timeout;
        } catch (error) {
            console.error('[useCheckoutTransition] Error starting transition:', error);
            onTransitionError?.(error);
            setIsTransitioning(false);
        }
    }, [
        isTransitioning,
        skipAnimation,
        animationDuration,
        skipAnimationThreshold,
        enablePerformanceTracking,
        onTransitionStart,
        onTransitionComplete,
        onTransitionError,
        router
    ]);
    return {
        isTransitioning,
        startTransition,
        skipAnimation,
        isButtonDisabled: isTransitioning,
        transitionProgress,
        performanceMetrics: performanceRef.current
    };
}
const _default = useCheckoutTransition;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZUNoZWNrb3V0VHJhbnNpdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBjbGllbnRcIjtcblxuaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZVJlZiwgdXNlTWVtbyB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSBcIm5leHQvbmF2aWdhdGlvblwiO1xuXG5pbnRlcmZhY2UgVXNlQ2hlY2tvdXRUcmFuc2l0aW9uT3B0aW9ucyB7XG4gIG9uVHJhbnNpdGlvblN0YXJ0PzogKCkgPT4gdm9pZDtcbiAgb25UcmFuc2l0aW9uQ29tcGxldGU/OiAoKSA9PiB2b2lkO1xuICBvblRyYW5zaXRpb25FcnJvcj86IChlcnJvcjogRXJyb3IpID0+IHZvaWQ7XG4gIGVuYWJsZUFuaW1hdGlvbj86IGJvb2xlYW47XG4gIGVuYWJsZVBlcmZvcm1hbmNlVHJhY2tpbmc/OiBib29sZWFuO1xuICBjdXN0b21EdXJhdGlvbj86IG51bWJlcjtcbiAgc2tpcEFuaW1hdGlvblRocmVzaG9sZD86IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFVzZUNoZWNrb3V0VHJhbnNpdGlvblJldHVybiB7XG4gIGlzVHJhbnNpdGlvbmluZzogYm9vbGVhbjtcbiAgc3RhcnRUcmFuc2l0aW9uOiAoKSA9PiB2b2lkO1xuICBza2lwQW5pbWF0aW9uOiBib29sZWFuO1xuICBpc0J1dHRvbkRpc2FibGVkOiBib29sZWFuO1xuICB0cmFuc2l0aW9uUHJvZ3Jlc3M6IG51bWJlcjtcbiAgcGVyZm9ybWFuY2VNZXRyaWNzOiB7XG4gICAgc3RhcnRUaW1lOiBudW1iZXIgfCBudWxsO1xuICAgIGVuZFRpbWU6IG51bWJlciB8IG51bGw7XG4gICAgZHVyYXRpb246IG51bWJlciB8IG51bGw7XG4gIH07XG59XG5cbmludGVyZmFjZSBQZXJmb3JtYW5jZU1ldHJpY3Mge1xuICBzdGFydFRpbWU6IG51bWJlciB8IG51bGw7XG4gIGVuZFRpbWU6IG51bWJlciB8IG51bGw7XG4gIGR1cmF0aW9uOiBudW1iZXIgfCBudWxsO1xufVxuXG4vKipcbiAqIEhvb2sgb3B0aW1pemFkbyBwYXJhIG1hbmVqYXIgYW5pbWFjaW9uZXMgZGUgdHJhbnNpY2nDs24gYWwgY2hlY2tvdXRcbiAqXG4gKiBDYXJhY3RlcsOtc3RpY2FzIEVudGVycHJpc2U6XG4gKiAtIFBlcmZvcm1hbmNlIHRyYWNraW5nIGNvbiBtw6l0cmljYXMgZGV0YWxsYWRhc1xuICogLSBNYW5lam8gcm9idXN0byBkZSBlcnJvcmVzIHkgY2xlYW51cFxuICogLSBSZXNwZXRhIHByZWZlcmVuY2lhcyBkZSBhY2Nlc2liaWxpZGFkIChwcmVmZXJzLXJlZHVjZWQtbW90aW9uKVxuICogLSBDb250cm9sIGdyYW51bGFyIHNvYnJlIGVsIGVzdGFkbyBkZWwgYm90w7NuXG4gKiAtIENhbGxiYWNrcyBwYXJhIGV2ZW50b3MgZGUgdHJhbnNpY2nDs24gY29uIGVycm9yIGhhbmRsaW5nXG4gKiAtIE9wdGltaXphY2nDs24gZGUgbWVtb3JpYSB5IHByZXZlbmNpw7NuIGRlIG1lbW9yeSBsZWFrc1xuICogLSBTb3BvcnRlIHBhcmEgdGVzdGluZyBjb24gbW9ja3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUNoZWNrb3V0VHJhbnNpdGlvbihcbiAgb3B0aW9uczogVXNlQ2hlY2tvdXRUcmFuc2l0aW9uT3B0aW9ucyA9IHt9XG4pOiBVc2VDaGVja291dFRyYW5zaXRpb25SZXR1cm4ge1xuXG4gIGNvbnN0IHtcbiAgICBvblRyYW5zaXRpb25TdGFydCxcbiAgICBvblRyYW5zaXRpb25Db21wbGV0ZSxcbiAgICBvblRyYW5zaXRpb25FcnJvcixcbiAgICBlbmFibGVBbmltYXRpb24gPSB0cnVlLFxuICAgIGVuYWJsZVBlcmZvcm1hbmNlVHJhY2tpbmcgPSB0cnVlLFxuICAgIGN1c3RvbUR1cmF0aW9uLFxuICAgIHNraXBBbmltYXRpb25UaHJlc2hvbGQgPSAxMDAsXG4gIH0gPSBvcHRpb25zO1xuXG4gIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpO1xuICBjb25zdCBbaXNUcmFuc2l0aW9uaW5nLCBzZXRJc1RyYW5zaXRpb25pbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbc2tpcEFuaW1hdGlvbiwgc2V0U2tpcEFuaW1hdGlvbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFt0cmFuc2l0aW9uUHJvZ3Jlc3MsIHNldFRyYW5zaXRpb25Qcm9ncmVzc10gPSB1c2VTdGF0ZSgwKTtcblxuICAvLyBSZWZzIHBhcmEgY2xlYW51cCB5IHBlcmZvcm1hbmNlIHRyYWNraW5nXG4gIGNvbnN0IHRpbWVvdXRSZWYgPSB1c2VSZWY8Tm9kZUpTLlRpbWVvdXQgfCBudWxsPihudWxsKTtcbiAgY29uc3QgcHJvZ3Jlc3NJbnRlcnZhbFJlZiA9IHVzZVJlZjxOb2RlSlMuVGltZW91dCB8IG51bGw+KG51bGwpO1xuICBjb25zdCBwZXJmb3JtYW5jZVJlZiA9IHVzZVJlZjxQZXJmb3JtYW5jZU1ldHJpY3M+KHtcbiAgICBzdGFydFRpbWU6IG51bGwsXG4gICAgZW5kVGltZTogbnVsbCxcbiAgICBkdXJhdGlvbjogbnVsbCxcbiAgfSk7XG5cbiAgLy8gTWVtb2l6YXIgZHVyYWNpw7NuIHBhcmEgZXZpdGFyIHJlY8OhbGN1bG9zXG4gIGNvbnN0IGFuaW1hdGlvbkR1cmF0aW9uID0gdXNlTWVtbygoKSA9PiB7XG4gICAgaWYgKGN1c3RvbUR1cmF0aW9uKSByZXR1cm4gY3VzdG9tRHVyYXRpb247XG4gICAgcmV0dXJuIHNraXBBbmltYXRpb24gPyAyMDAgOiAyODAwO1xuICB9LCBbc2tpcEFuaW1hdGlvbiwgY3VzdG9tRHVyYXRpb25dKTtcblxuICAvLyBEZXRlY3RhciBwcmVmZXJlbmNpYSBkZSBtb3ZpbWllbnRvIHJlZHVjaWRvIGNvbiBtZWpvciBtYW5lam8gZGUgZXJyb3Jlc1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtZWRpYVF1ZXJ5ID0gd2luZG93Lm1hdGNoTWVkaWEoXCIocHJlZmVycy1yZWR1Y2VkLW1vdGlvbjogcmVkdWNlKVwiKTtcblxuICAgICAgY29uc3QgaGFuZGxlQ2hhbmdlID0gKGU6IE1lZGlhUXVlcnlMaXN0RXZlbnQpID0+IHtcbiAgICAgICAgY29uc3Qgc2hvdWxkU2tpcCA9IGUubWF0Y2hlcyB8fCAhZW5hYmxlQW5pbWF0aW9uO1xuICAgICAgICBzZXRTa2lwQW5pbWF0aW9uKHNob3VsZFNraXApO1xuXG4gICAgICAgIC8vIFBlcmZvcm1hbmNlIHRyYWNraW5nIHBhcmEgcHJlZmVyZW5jaWFzIGRlIGFjY2VzaWJpbGlkYWRcbiAgICAgICAgaWYgKGVuYWJsZVBlcmZvcm1hbmNlVHJhY2tpbmcgJiYgc2hvdWxkU2tpcCkge1xuICAgICAgICAgIGNvbnNvbGUuZGVidWcoJ1t1c2VDaGVja291dFRyYW5zaXRpb25dIEFuaW1hdGlvbiBza2lwcGVkIGR1ZSB0byBhY2Nlc3NpYmlsaXR5IHByZWZlcmVuY2VzJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIENvbmZpZ3VyYWNpw7NuIGluaWNpYWxcbiAgICAgIHNldFNraXBBbmltYXRpb24obWVkaWFRdWVyeS5tYXRjaGVzIHx8ICFlbmFibGVBbmltYXRpb24pO1xuXG4gICAgICAvLyBFc2N1Y2hhciBjYW1iaW9zIGNvbiBzb3BvcnRlIHBhcmEgbmF2ZWdhZG9yZXMgYW50aWd1b3NcbiAgICAgIGlmIChtZWRpYVF1ZXJ5LmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgbWVkaWFRdWVyeS5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGhhbmRsZUNoYW5nZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGYWxsYmFjayBwYXJhIG5hdmVnYWRvcmVzIGFudGlndW9zXG4gICAgICAgIG1lZGlhUXVlcnkuYWRkTGlzdGVuZXIoaGFuZGxlQ2hhbmdlKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgaWYgKG1lZGlhUXVlcnkucmVtb3ZlRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgIG1lZGlhUXVlcnkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBoYW5kbGVDaGFuZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1lZGlhUXVlcnkucmVtb3ZlTGlzdGVuZXIoaGFuZGxlQ2hhbmdlKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdbdXNlQ2hlY2tvdXRUcmFuc2l0aW9uXSBFcnJvciBzZXR0aW5nIHVwIG1lZGlhIHF1ZXJ5IGxpc3RlbmVyOicsIGVycm9yKTtcbiAgICAgIHNldFNraXBBbmltYXRpb24oIWVuYWJsZUFuaW1hdGlvbik7XG4gICAgfVxuICB9LCBbZW5hYmxlQW5pbWF0aW9uLCBlbmFibGVQZXJmb3JtYW5jZVRyYWNraW5nXSk7XG5cbiAgLy8gQ2xlYW51cCBlbiB1bm1vdW50XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGlmICh0aW1lb3V0UmVmLmN1cnJlbnQpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRSZWYuY3VycmVudCk7XG4gICAgICB9XG4gICAgICBpZiAocHJvZ3Jlc3NJbnRlcnZhbFJlZi5jdXJyZW50KSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NJbnRlcnZhbFJlZi5jdXJyZW50KTtcbiAgICAgIH1cbiAgICB9O1xuICB9LCBbXSk7XG5cbiAgLy8gRnVuY2nDs24gb3B0aW1pemFkYSBwYXJhIGluaWNpYXIgbGEgdHJhbnNpY2nDs25cbiAgY29uc3Qgc3RhcnRUcmFuc2l0aW9uID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGlmIChpc1RyYW5zaXRpb25pbmcpIHtcbiAgICAgIGNvbnNvbGUud2FybignW3VzZUNoZWNrb3V0VHJhbnNpdGlvbl0gVHJhbnNpdGlvbiBhbHJlYWR5IGluIHByb2dyZXNzLCBpZ25vcmluZyBkdXBsaWNhdGUgY2FsbCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBQZXJmb3JtYW5jZSB0cmFja2luZ1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gZW5hYmxlUGVyZm9ybWFuY2VUcmFja2luZyA/IHBlcmZvcm1hbmNlLm5vdygpIDogMDtcbiAgICAgIHBlcmZvcm1hbmNlUmVmLmN1cnJlbnQuc3RhcnRUaW1lID0gc3RhcnRUaW1lO1xuXG4gICAgICBzZXRJc1RyYW5zaXRpb25pbmcodHJ1ZSk7XG4gICAgICBzZXRUcmFuc2l0aW9uUHJvZ3Jlc3MoMCk7XG5cbiAgICAgIC8vIENhbGxiYWNrIGRlIGluaWNpbyBjb24gZXJyb3IgaGFuZGxpbmdcbiAgICAgIHRyeSB7XG4gICAgICAgIG9uVHJhbnNpdGlvblN0YXJ0Py4oKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1t1c2VDaGVja291dFRyYW5zaXRpb25dIEVycm9yIGluIG9uVHJhbnNpdGlvblN0YXJ0IGNhbGxiYWNrOicsIGVycm9yKTtcbiAgICAgICAgb25UcmFuc2l0aW9uRXJyb3I/LihlcnJvciBhcyBFcnJvcik7XG4gICAgICB9XG5cbiAgICAgIC8vIFByb2dyZXNzIHRyYWNraW5nIHBhcmEgYW5pbWFjaW9uZXMgbGFyZ2FzXG4gICAgICBpZiAoIXNraXBBbmltYXRpb24gJiYgYW5pbWF0aW9uRHVyYXRpb24gPiBza2lwQW5pbWF0aW9uVGhyZXNob2xkKSB7XG4gICAgICAgIGNvbnN0IHByb2dyZXNzSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgc2V0VHJhbnNpdGlvblByb2dyZXNzKHByZXYgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxhcHNlZCA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBNYXRoLm1pbigoZWxhcHNlZCAvIGFuaW1hdGlvbkR1cmF0aW9uKSAqIDEwMCwgMTAwKTtcbiAgICAgICAgICAgIHJldHVybiBwcm9ncmVzcztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwgMTYpOyAvLyA2MGZwcyB1cGRhdGVzXG5cbiAgICAgICAgcHJvZ3Jlc3NJbnRlcnZhbFJlZi5jdXJyZW50ID0gcHJvZ3Jlc3NJbnRlcnZhbDtcbiAgICAgIH1cblxuICAgICAgLy8gQXV0by1yZXNldCBjb24gY2xlYW51cCBtZWpvcmFkb1xuICAgICAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGVuZFRpbWUgPSBlbmFibGVQZXJmb3JtYW5jZVRyYWNraW5nID8gcGVyZm9ybWFuY2Uubm93KCkgOiAwO1xuICAgICAgICAgIHBlcmZvcm1hbmNlUmVmLmN1cnJlbnQuZW5kVGltZSA9IGVuZFRpbWU7XG4gICAgICAgICAgcGVyZm9ybWFuY2VSZWYuY3VycmVudC5kdXJhdGlvbiA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XG5cbiAgICAgICAgICBzZXRJc1RyYW5zaXRpb25pbmcoZmFsc2UpO1xuICAgICAgICAgIHNldFRyYW5zaXRpb25Qcm9ncmVzcygxMDApO1xuXG4gICAgICAgICAgLy8gQ2xlYW51cCBwcm9ncmVzcyBpbnRlcnZhbFxuICAgICAgICAgIGlmIChwcm9ncmVzc0ludGVydmFsUmVmLmN1cnJlbnQpIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocHJvZ3Jlc3NJbnRlcnZhbFJlZi5jdXJyZW50KTtcbiAgICAgICAgICAgIHByb2dyZXNzSW50ZXJ2YWxSZWYuY3VycmVudCA9IG51bGw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gUGVyZm9ybWFuY2UgbG9nZ2luZ1xuICAgICAgICAgIGlmIChlbmFibGVQZXJmb3JtYW5jZVRyYWNraW5nKSB7XG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKCdbdXNlQ2hlY2tvdXRUcmFuc2l0aW9uXSBUcmFuc2l0aW9uIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgICAgICAgZHVyYXRpb246IHBlcmZvcm1hbmNlUmVmLmN1cnJlbnQuZHVyYXRpb24sXG4gICAgICAgICAgICAgIHNraXBBbmltYXRpb24sXG4gICAgICAgICAgICAgIGFuaW1hdGlvbkR1cmF0aW9uLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ2FsbGJhY2sgZGUgZmluYWxpemFjacOzbiBjb24gZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgb25UcmFuc2l0aW9uQ29tcGxldGU/LigpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbdXNlQ2hlY2tvdXRUcmFuc2l0aW9uXSBFcnJvciBpbiBvblRyYW5zaXRpb25Db21wbGV0ZSBjYWxsYmFjazonLCBlcnJvcik7XG4gICAgICAgICAgICBvblRyYW5zaXRpb25FcnJvcj8uKGVycm9yIGFzIEVycm9yKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBOYXZlZ2FjacOzbiBjb24gZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgcm91dGVyLnB1c2goJy9jaGVja291dCcpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbdXNlQ2hlY2tvdXRUcmFuc2l0aW9uXSBFcnJvciBkdXJpbmcgbmF2aWdhdGlvbjonLCBlcnJvcik7XG4gICAgICAgICAgICBvblRyYW5zaXRpb25FcnJvcj8uKGVycm9yIGFzIEVycm9yKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbdXNlQ2hlY2tvdXRUcmFuc2l0aW9uXSBFcnJvciBkdXJpbmcgdHJhbnNpdGlvbiBjb21wbGV0aW9uOicsIGVycm9yKTtcbiAgICAgICAgICBvblRyYW5zaXRpb25FcnJvcj8uKGVycm9yIGFzIEVycm9yKTtcbiAgICAgICAgICBzZXRJc1RyYW5zaXRpb25pbmcoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9LCBhbmltYXRpb25EdXJhdGlvbik7XG5cbiAgICAgIHRpbWVvdXRSZWYuY3VycmVudCA9IHRpbWVvdXQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW3VzZUNoZWNrb3V0VHJhbnNpdGlvbl0gRXJyb3Igc3RhcnRpbmcgdHJhbnNpdGlvbjonLCBlcnJvcik7XG4gICAgICBvblRyYW5zaXRpb25FcnJvcj8uKGVycm9yIGFzIEVycm9yKTtcbiAgICAgIHNldElzVHJhbnNpdGlvbmluZyhmYWxzZSk7XG4gICAgfVxuICB9LCBbXG4gICAgaXNUcmFuc2l0aW9uaW5nLFxuICAgIHNraXBBbmltYXRpb24sXG4gICAgYW5pbWF0aW9uRHVyYXRpb24sXG4gICAgc2tpcEFuaW1hdGlvblRocmVzaG9sZCxcbiAgICBlbmFibGVQZXJmb3JtYW5jZVRyYWNraW5nLFxuICAgIG9uVHJhbnNpdGlvblN0YXJ0LFxuICAgIG9uVHJhbnNpdGlvbkNvbXBsZXRlLFxuICAgIG9uVHJhbnNpdGlvbkVycm9yLFxuICAgIHJvdXRlclxuICBdKTtcblxuICByZXR1cm4ge1xuICAgIGlzVHJhbnNpdGlvbmluZyxcbiAgICBzdGFydFRyYW5zaXRpb24sXG4gICAgc2tpcEFuaW1hdGlvbixcbiAgICBpc0J1dHRvbkRpc2FibGVkOiBpc1RyYW5zaXRpb25pbmcsXG4gICAgdHJhbnNpdGlvblByb2dyZXNzLFxuICAgIHBlcmZvcm1hbmNlTWV0cmljczogcGVyZm9ybWFuY2VSZWYuY3VycmVudCxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgdXNlQ2hlY2tvdXRUcmFuc2l0aW9uO1xuIl0sIm5hbWVzIjpbInVzZUNoZWNrb3V0VHJhbnNpdGlvbiIsIm9wdGlvbnMiLCJvblRyYW5zaXRpb25TdGFydCIsIm9uVHJhbnNpdGlvbkNvbXBsZXRlIiwib25UcmFuc2l0aW9uRXJyb3IiLCJlbmFibGVBbmltYXRpb24iLCJlbmFibGVQZXJmb3JtYW5jZVRyYWNraW5nIiwiY3VzdG9tRHVyYXRpb24iLCJza2lwQW5pbWF0aW9uVGhyZXNob2xkIiwicm91dGVyIiwidXNlUm91dGVyIiwiaXNUcmFuc2l0aW9uaW5nIiwic2V0SXNUcmFuc2l0aW9uaW5nIiwidXNlU3RhdGUiLCJza2lwQW5pbWF0aW9uIiwic2V0U2tpcEFuaW1hdGlvbiIsInRyYW5zaXRpb25Qcm9ncmVzcyIsInNldFRyYW5zaXRpb25Qcm9ncmVzcyIsInRpbWVvdXRSZWYiLCJ1c2VSZWYiLCJwcm9ncmVzc0ludGVydmFsUmVmIiwicGVyZm9ybWFuY2VSZWYiLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwiZHVyYXRpb24iLCJhbmltYXRpb25EdXJhdGlvbiIsInVzZU1lbW8iLCJ1c2VFZmZlY3QiLCJtZWRpYVF1ZXJ5Iiwid2luZG93IiwibWF0Y2hNZWRpYSIsImhhbmRsZUNoYW5nZSIsImUiLCJzaG91bGRTa2lwIiwibWF0Y2hlcyIsImNvbnNvbGUiLCJkZWJ1ZyIsImFkZEV2ZW50TGlzdGVuZXIiLCJhZGRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZW1vdmVMaXN0ZW5lciIsImVycm9yIiwid2FybiIsImN1cnJlbnQiLCJjbGVhclRpbWVvdXQiLCJjbGVhckludGVydmFsIiwic3RhcnRUcmFuc2l0aW9uIiwidXNlQ2FsbGJhY2siLCJwZXJmb3JtYW5jZSIsIm5vdyIsInByb2dyZXNzSW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsInByZXYiLCJlbGFwc2VkIiwicHJvZ3Jlc3MiLCJNYXRoIiwibWluIiwidGltZW91dCIsInNldFRpbWVvdXQiLCJwdXNoIiwiaXNCdXR0b25EaXNhYmxlZCIsInBlcmZvcm1hbmNlTWV0cmljcyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7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