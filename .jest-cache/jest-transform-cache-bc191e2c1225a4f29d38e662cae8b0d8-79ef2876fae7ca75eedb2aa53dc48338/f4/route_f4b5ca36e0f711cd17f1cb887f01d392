08859f4be854363d76720e88db223530
// ===================================
// PINTEYA E-COMMERCE - API DE ÓRDENES DE USUARIO
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "GET", {
    enumerable: true,
    get: function() {
        return GET;
    }
});
const _server = require("next/server");
const _supabase = require("../../../../lib/supabase");
const _auth = require("../../../../auth");
async function GET(request) {
    try {
        // Verificar que el cliente administrativo esté disponible
        if (!_supabase.supabaseAdmin) {
            console.error('Cliente administrativo de Supabase no disponible en GET /api/user/orders');
            return _server.NextResponse.json({
                error: 'Servicio de base de datos no disponible'
            }, {
                status: 503
            });
        }
        // Autenticación con Clerk
        const session = await (0, _auth.auth)();
        if (!session?.user) {
            const errorResponse = {
                data: null,
                success: false,
                error: 'Usuario no autenticado'
            };
            return _server.NextResponse.json(errorResponse, {
                status: 401
            });
        }
        const { searchParams } = new URL(request.url);
        const page = parseInt(searchParams.get('page') || '1');
        const limit = parseInt(searchParams.get('limit') || '10');
        const status = searchParams.get('status');
        // Obtener usuario primero
        let { data: user } = await _supabase.supabaseAdmin.from('users').select('id').eq('clerk_id', userId).single();
        if (!session?.user) {
            // Crear usuario demo si no existe
            const { data: newUser, error: createError } = await _supabase.supabaseAdmin.from('users').insert([
                {
                    clerk_id: userId,
                    email: 'usuario@demo.com',
                    name: 'Usuario Demo'
                }
            ]).select('id').single();
            if (createError) {
                console.error('Error al crear usuario demo:', createError);
                return _server.NextResponse.json({
                    error: 'Error al obtener usuario'
                }, {
                    status: 500
                });
            }
            if (!newUser) {
                console.error('Error: newUser es null después de la inserción');
                return _server.NextResponse.json({
                    error: 'Error al crear usuario'
                }, {
                    status: 500
                });
            }
            // Crear algunas órdenes demo para el usuario
            await createDemoOrders(newUser.id);
            // Usar el nuevo usuario
            user = newUser;
        }
        // Construir query base
        let query = _supabase.supabaseAdmin.from('orders').select(`
        *,
        order_items (
          id,
          quantity,
          price,
          products (
            id,
            name,
            images
          )
        )
      `).eq('user_id', user.id);
        // Filtrar por status si se especifica
        if (status && status !== 'all') {
            query = query.eq('status', status);
        }
        // Aplicar paginación y ordenamiento
        const from = (page - 1) * limit;
        const to = from + limit - 1;
        const { data: orders, error, count } = await query.order('created_at', {
            ascending: false
        }).range(from, to);
        if (error) {
            console.error('Error al obtener órdenes:', error);
            return _server.NextResponse.json({
                error: 'Error al obtener órdenes'
            }, {
                status: 500
            });
        }
        // Calcular estadísticas
        const { data: stats } = await _supabase.supabaseAdmin.from('orders').select('status, total').eq('user_id', user.id);
        const statistics = {
            total_orders: stats?.length || 0,
            total_spent: stats?.reduce((sum, order)=>sum + parseFloat(order.total), 0) || 0,
            pending_orders: stats?.filter((order)=>order.status === 'pending').length || 0,
            completed_orders: stats?.filter((order)=>order.status === 'delivered').length || 0
        };
        return _server.NextResponse.json({
            success: true,
            orders: orders || [],
            pagination: {
                page,
                limit,
                total: count || 0,
                pages: Math.ceil((count || 0) / limit)
            },
            statistics
        });
    } catch (error) {
        console.error('Error en GET /api/user/orders:', error);
        return _server.NextResponse.json({
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}
// ===================================
// Función auxiliar para crear órdenes demo
// ===================================
async function createDemoOrders(userId1) {
    if (!_supabase.supabaseAdmin) return;
    try {
        // Obtener algunos productos para las órdenes demo
        const { data: products } = await _supabase.supabaseAdmin.from('products').select('id, name, price').limit(5);
        if (!products || products.length === 0) return;
        // Crear órdenes demo
        const demoOrders = [
            {
                user_id: userId1,
                total: 15000.00,
                status: 'delivered',
                payment_id: 'demo_payment_1',
                shipping_address: {
                    name: 'Usuario Demo',
                    street: 'Av. Corrientes 1234',
                    city: 'Buenos Aires',
                    postal_code: '1043',
                    country: 'Argentina'
                }
            },
            {
                user_id: userId1,
                total: 8500.00,
                status: 'shipped',
                payment_id: 'demo_payment_2',
                shipping_address: {
                    name: 'Usuario Demo',
                    street: 'Av. Corrientes 1234',
                    city: 'Buenos Aires',
                    postal_code: '1043',
                    country: 'Argentina'
                }
            },
            {
                user_id: userId1,
                total: 12300.00,
                status: 'pending',
                payment_id: 'demo_payment_3',
                shipping_address: {
                    name: 'Usuario Demo',
                    street: 'Av. Corrientes 1234',
                    city: 'Buenos Aires',
                    postal_code: '1043',
                    country: 'Argentina'
                }
            }
        ];
        const { data: createdOrders } = await _supabase.supabaseAdmin.from('orders').insert(demoOrders).select();
        // Crear items para cada orden
        if (createdOrders && products.length >= 2) {
            for (const order of createdOrders){
                const orderItems = [
                    {
                        order_id: order.id,
                        product_id: products[0].id,
                        quantity: 2,
                        price: products[0].price
                    },
                    {
                        order_id: order.id,
                        product_id: products[1].id,
                        quantity: 1,
                        price: products[1].price
                    }
                ];
                await _supabase.supabaseAdmin.from('order_items').insert(orderItems);
            }
        }
    } catch (error) {
        console.error('Error al crear órdenes demo:', error);
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXHVzZXJcXG9yZGVyc1xccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gUElOVEVZQSBFLUNPTU1FUkNFIC0gQVBJIERFIMOTUkRFTkVTIERFIFVTVUFSSU9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICdAL2xpYi9zdXBhYmFzZSc7XHJcbmltcG9ydCB7IGF1dGggfSBmcm9tICdAL2F1dGgnO1xyXG5pbXBvcnQgeyBBcGlSZXNwb25zZSB9IGZyb20gJ0AvdHlwZXMvYXBpJztcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEdFVCAtIE9idGVuZXIgw7NyZGVuZXMgZGVsIHVzdWFyaW9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBWZXJpZmljYXIgcXVlIGVsIGNsaWVudGUgYWRtaW5pc3RyYXRpdm8gZXN0w6kgZGlzcG9uaWJsZVxyXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NsaWVudGUgYWRtaW5pc3RyYXRpdm8gZGUgU3VwYWJhc2Ugbm8gZGlzcG9uaWJsZSBlbiBHRVQgL2FwaS91c2VyL29yZGVycycpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ1NlcnZpY2lvIGRlIGJhc2UgZGUgZGF0b3Mgbm8gZGlzcG9uaWJsZScgfSxcclxuICAgICAgICB7IHN0YXR1czogNTAzIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBdXRlbnRpY2FjacOzbiBjb24gQ2xlcmtcclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKCk7XHJcbiAgICBpZiAoIXNlc3Npb24/LnVzZXIpIHtcclxuICAgICAgY29uc3QgZXJyb3JSZXNwb25zZTogQXBpUmVzcG9uc2U8bnVsbD4gPSB7XHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogJ1VzdWFyaW8gbm8gYXV0ZW50aWNhZG8nLFxyXG4gICAgICB9O1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oZXJyb3JSZXNwb25zZSwgeyBzdGF0dXM6IDQwMSB9KTtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcclxuICAgIGNvbnN0IHBhZ2UgPSBwYXJzZUludChzZWFyY2hQYXJhbXMuZ2V0KCdwYWdlJykgfHwgJzEnKTtcclxuICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKSB8fCAnMTAnKTtcclxuICAgIGNvbnN0IHN0YXR1cyA9IHNlYXJjaFBhcmFtcy5nZXQoJ3N0YXR1cycpO1xyXG5cclxuICAgIC8vIE9idGVuZXIgdXN1YXJpbyBwcmltZXJvXHJcbiAgICBsZXQgeyBkYXRhOiB1c2VyIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VycycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgLmVxKCdjbGVya19pZCcsIHVzZXJJZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xyXG4gICAgICAvLyBDcmVhciB1c3VhcmlvIGRlbW8gc2kgbm8gZXhpc3RlXHJcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3VXNlciwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ3VzZXJzJylcclxuICAgICAgICAuaW5zZXJ0KFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgY2xlcmtfaWQ6IHVzZXJJZCxcclxuICAgICAgICAgICAgZW1haWw6ICd1c3VhcmlvQGRlbW8uY29tJyxcclxuICAgICAgICAgICAgbmFtZTogJ1VzdWFyaW8gRGVtbycsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIF0pXHJcbiAgICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChjcmVhdGVFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIGNyZWFyIHVzdWFyaW8gZGVtbzonLCBjcmVhdGVFcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgICAgeyBlcnJvcjogJ0Vycm9yIGFsIG9idGVuZXIgdXN1YXJpbycgfSxcclxuICAgICAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghbmV3VXNlcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOiBuZXdVc2VyIGVzIG51bGwgZGVzcHXDqXMgZGUgbGEgaW5zZXJjacOzbicpO1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICAgIHsgZXJyb3I6ICdFcnJvciBhbCBjcmVhciB1c3VhcmlvJyB9LFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ3JlYXIgYWxndW5hcyDDs3JkZW5lcyBkZW1vIHBhcmEgZWwgdXN1YXJpb1xyXG4gICAgICBhd2FpdCBjcmVhdGVEZW1vT3JkZXJzKG5ld1VzZXIuaWQpO1xyXG5cclxuICAgICAgLy8gVXNhciBlbCBudWV2byB1c3VhcmlvXHJcbiAgICAgIHVzZXIgPSBuZXdVc2VyO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENvbnN0cnVpciBxdWVyeSBiYXNlXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdvcmRlcnMnKVxyXG4gICAgICAuc2VsZWN0KGBcclxuICAgICAgICAqLFxyXG4gICAgICAgIG9yZGVyX2l0ZW1zIChcclxuICAgICAgICAgIGlkLFxyXG4gICAgICAgICAgcXVhbnRpdHksXHJcbiAgICAgICAgICBwcmljZSxcclxuICAgICAgICAgIHByb2R1Y3RzIChcclxuICAgICAgICAgICAgaWQsXHJcbiAgICAgICAgICAgIG5hbWUsXHJcbiAgICAgICAgICAgIGltYWdlc1xyXG4gICAgICAgICAgKVxyXG4gICAgICAgIClcclxuICAgICAgYClcclxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlci5pZCk7XHJcblxyXG4gICAgLy8gRmlsdHJhciBwb3Igc3RhdHVzIHNpIHNlIGVzcGVjaWZpY2FcclxuICAgIGlmIChzdGF0dXMgJiYgc3RhdHVzICE9PSAnYWxsJykge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdzdGF0dXMnLCBzdGF0dXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFwbGljYXIgcGFnaW5hY2nDs24geSBvcmRlbmFtaWVudG9cclxuICAgIGNvbnN0IGZyb20gPSAocGFnZSAtIDEpICogbGltaXQ7XHJcbiAgICBjb25zdCB0byA9IGZyb20gKyBsaW1pdCAtIDE7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBvcmRlcnMsIGVycm9yLCBjb3VudCB9ID0gYXdhaXQgcXVlcnlcclxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgIC5yYW5nZShmcm9tLCB0byk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIG9idGVuZXIgw7NyZGVuZXM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ0Vycm9yIGFsIG9idGVuZXIgw7NyZGVuZXMnIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2FsY3VsYXIgZXN0YWTDrXN0aWNhc1xyXG4gICAgY29uc3QgeyBkYXRhOiBzdGF0cyB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnb3JkZXJzJylcclxuICAgICAgLnNlbGVjdCgnc3RhdHVzLCB0b3RhbCcpXHJcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpO1xyXG5cclxuICAgIGNvbnN0IHN0YXRpc3RpY3MgPSB7XHJcbiAgICAgIHRvdGFsX29yZGVyczogc3RhdHM/Lmxlbmd0aCB8fCAwLFxyXG4gICAgICB0b3RhbF9zcGVudDogc3RhdHM/LnJlZHVjZSgoc3VtLCBvcmRlcikgPT4gc3VtICsgcGFyc2VGbG9hdChvcmRlci50b3RhbCksIDApIHx8IDAsXHJcbiAgICAgIHBlbmRpbmdfb3JkZXJzOiBzdGF0cz8uZmlsdGVyKG9yZGVyID0+IG9yZGVyLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKS5sZW5ndGggfHwgMCxcclxuICAgICAgY29tcGxldGVkX29yZGVyczogc3RhdHM/LmZpbHRlcihvcmRlciA9PiBvcmRlci5zdGF0dXMgPT09ICdkZWxpdmVyZWQnKS5sZW5ndGggfHwgMCxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgb3JkZXJzOiBvcmRlcnMgfHwgW10sXHJcbiAgICAgIHBhZ2luYXRpb246IHtcclxuICAgICAgICBwYWdlLFxyXG4gICAgICAgIGxpbWl0LFxyXG4gICAgICAgIHRvdGFsOiBjb3VudCB8fCAwLFxyXG4gICAgICAgIHBhZ2VzOiBNYXRoLmNlaWwoKGNvdW50IHx8IDApIC8gbGltaXQpLFxyXG4gICAgICB9LFxyXG4gICAgICBzdGF0aXN0aWNzLFxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIEdFVCAvYXBpL3VzZXIvb3JkZXJzOicsIGVycm9yKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBlcnJvcjogJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBGdW5jacOzbiBhdXhpbGlhciBwYXJhIGNyZWFyIMOzcmRlbmVzIGRlbW9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlRGVtb09yZGVycyh1c2VySWQ6IHN0cmluZykge1xyXG4gIGlmICghc3VwYWJhc2VBZG1pbikgcmV0dXJuO1xyXG5cclxuICB0cnkge1xyXG4gICAgLy8gT2J0ZW5lciBhbGd1bm9zIHByb2R1Y3RvcyBwYXJhIGxhcyDDs3JkZW5lcyBkZW1vXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2R1Y3RzIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdwcm9kdWN0cycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkLCBuYW1lLCBwcmljZScpXHJcbiAgICAgIC5saW1pdCg1KTtcclxuXHJcbiAgICBpZiAoIXByb2R1Y3RzIHx8IHByb2R1Y3RzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG5cclxuICAgIC8vIENyZWFyIMOzcmRlbmVzIGRlbW9cclxuICAgIGNvbnN0IGRlbW9PcmRlcnMgPSBbXHJcbiAgICAgIHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgdG90YWw6IDE1MDAwLjAwLFxyXG4gICAgICAgIHN0YXR1czogJ2RlbGl2ZXJlZCcsXHJcbiAgICAgICAgcGF5bWVudF9pZDogJ2RlbW9fcGF5bWVudF8xJyxcclxuICAgICAgICBzaGlwcGluZ19hZGRyZXNzOiB7XHJcbiAgICAgICAgICBuYW1lOiAnVXN1YXJpbyBEZW1vJyxcclxuICAgICAgICAgIHN0cmVldDogJ0F2LiBDb3JyaWVudGVzIDEyMzQnLFxyXG4gICAgICAgICAgY2l0eTogJ0J1ZW5vcyBBaXJlcycsXHJcbiAgICAgICAgICBwb3N0YWxfY29kZTogJzEwNDMnLFxyXG4gICAgICAgICAgY291bnRyeTogJ0FyZ2VudGluYSdcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgdG90YWw6IDg1MDAuMDAsXHJcbiAgICAgICAgc3RhdHVzOiAnc2hpcHBlZCcsXHJcbiAgICAgICAgcGF5bWVudF9pZDogJ2RlbW9fcGF5bWVudF8yJyxcclxuICAgICAgICBzaGlwcGluZ19hZGRyZXNzOiB7XHJcbiAgICAgICAgICBuYW1lOiAnVXN1YXJpbyBEZW1vJyxcclxuICAgICAgICAgIHN0cmVldDogJ0F2LiBDb3JyaWVudGVzIDEyMzQnLFxyXG4gICAgICAgICAgY2l0eTogJ0J1ZW5vcyBBaXJlcycsXHJcbiAgICAgICAgICBwb3N0YWxfY29kZTogJzEwNDMnLFxyXG4gICAgICAgICAgY291bnRyeTogJ0FyZ2VudGluYSdcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgdG90YWw6IDEyMzAwLjAwLFxyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIHBheW1lbnRfaWQ6ICdkZW1vX3BheW1lbnRfMycsXHJcbiAgICAgICAgc2hpcHBpbmdfYWRkcmVzczoge1xyXG4gICAgICAgICAgbmFtZTogJ1VzdWFyaW8gRGVtbycsXHJcbiAgICAgICAgICBzdHJlZXQ6ICdBdi4gQ29ycmllbnRlcyAxMjM0JyxcclxuICAgICAgICAgIGNpdHk6ICdCdWVub3MgQWlyZXMnLFxyXG4gICAgICAgICAgcG9zdGFsX2NvZGU6ICcxMDQzJyxcclxuICAgICAgICAgIGNvdW50cnk6ICdBcmdlbnRpbmEnXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICBdO1xyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogY3JlYXRlZE9yZGVycyB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnb3JkZXJzJylcclxuICAgICAgLmluc2VydChkZW1vT3JkZXJzKVxyXG4gICAgICAuc2VsZWN0KCk7XHJcblxyXG4gICAgLy8gQ3JlYXIgaXRlbXMgcGFyYSBjYWRhIG9yZGVuXHJcbiAgICBpZiAoY3JlYXRlZE9yZGVycyAmJiBwcm9kdWN0cy5sZW5ndGggPj0gMikge1xyXG4gICAgICBmb3IgKGNvbnN0IG9yZGVyIG9mIGNyZWF0ZWRPcmRlcnMpIHtcclxuICAgICAgICBjb25zdCBvcmRlckl0ZW1zID0gW1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBvcmRlcl9pZDogb3JkZXIuaWQsXHJcbiAgICAgICAgICAgIHByb2R1Y3RfaWQ6IHByb2R1Y3RzWzBdLmlkLFxyXG4gICAgICAgICAgICBxdWFudGl0eTogMixcclxuICAgICAgICAgICAgcHJpY2U6IHByb2R1Y3RzWzBdLnByaWNlXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBvcmRlcl9pZDogb3JkZXIuaWQsXHJcbiAgICAgICAgICAgIHByb2R1Y3RfaWQ6IHByb2R1Y3RzWzFdLmlkLFxyXG4gICAgICAgICAgICBxdWFudGl0eTogMSxcclxuICAgICAgICAgICAgcHJpY2U6IHByb2R1Y3RzWzFdLnByaWNlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgLmZyb20oJ29yZGVyX2l0ZW1zJylcclxuICAgICAgICAgIC5pbnNlcnQob3JkZXJJdGVtcyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgY3JlYXIgw7NyZGVuZXMgZGVtbzonLCBlcnJvcik7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJHRVQiLCJyZXF1ZXN0Iiwic3VwYWJhc2VBZG1pbiIsImNvbnNvbGUiLCJlcnJvciIsIk5leHRSZXNwb25zZSIsImpzb24iLCJzdGF0dXMiLCJzZXNzaW9uIiwiYXV0aCIsInVzZXIiLCJlcnJvclJlc3BvbnNlIiwiZGF0YSIsInN1Y2Nlc3MiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJwYWdlIiwicGFyc2VJbnQiLCJnZXQiLCJsaW1pdCIsImZyb20iLCJzZWxlY3QiLCJlcSIsInVzZXJJZCIsInNpbmdsZSIsIm5ld1VzZXIiLCJjcmVhdGVFcnJvciIsImluc2VydCIsImNsZXJrX2lkIiwiZW1haWwiLCJuYW1lIiwiY3JlYXRlRGVtb09yZGVycyIsImlkIiwicXVlcnkiLCJ0byIsIm9yZGVycyIsImNvdW50Iiwib3JkZXIiLCJhc2NlbmRpbmciLCJyYW5nZSIsInN0YXRzIiwic3RhdGlzdGljcyIsInRvdGFsX29yZGVycyIsImxlbmd0aCIsInRvdGFsX3NwZW50IiwicmVkdWNlIiwic3VtIiwicGFyc2VGbG9hdCIsInRvdGFsIiwicGVuZGluZ19vcmRlcnMiLCJmaWx0ZXIiLCJjb21wbGV0ZWRfb3JkZXJzIiwicGFnaW5hdGlvbiIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJwcm9kdWN0cyIsImRlbW9PcmRlcnMiLCJ1c2VyX2lkIiwicGF5bWVudF9pZCIsInNoaXBwaW5nX2FkZHJlc3MiLCJzdHJlZXQiLCJjaXR5IiwicG9zdGFsX2NvZGUiLCJjb3VudHJ5IiwiY3JlYXRlZE9yZGVycyIsIm9yZGVySXRlbXMiLCJvcmRlcl9pZCIsInByb2R1Y3RfaWQiLCJxdWFudGl0eSIsInByaWNlIl0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMsaURBQWlEO0FBQ2pELHNDQUFzQzs7Ozs7K0JBVWhCQTs7O2VBQUFBOzs7d0JBUm9COzBCQUNaO3NCQUNUO0FBTWQsZUFBZUEsSUFBSUMsT0FBb0I7SUFDNUMsSUFBSTtRQUNGLDBEQUEwRDtRQUMxRCxJQUFJLENBQUNDLHVCQUFhLEVBQUU7WUFDbEJDLFFBQVFDLEtBQUssQ0FBQztZQUNkLE9BQU9DLG9CQUFZLENBQUNDLElBQUksQ0FDdEI7Z0JBQUVGLE9BQU87WUFBMEMsR0FDbkQ7Z0JBQUVHLFFBQVE7WUFBSTtRQUVsQjtRQUVBLDBCQUEwQjtRQUMxQixNQUFNQyxVQUFVLE1BQU1DLElBQUFBLFVBQUk7UUFDMUIsSUFBSSxDQUFDRCxTQUFTRSxNQUFNO1lBQ2xCLE1BQU1DLGdCQUFtQztnQkFDdkNDLE1BQU07Z0JBQ05DLFNBQVM7Z0JBQ1RULE9BQU87WUFDVDtZQUNBLE9BQU9DLG9CQUFZLENBQUNDLElBQUksQ0FBQ0ssZUFBZTtnQkFBRUosUUFBUTtZQUFJO1FBQ3hEO1FBQ0EsTUFBTSxFQUFFTyxZQUFZLEVBQUUsR0FBRyxJQUFJQyxJQUFJZCxRQUFRZSxHQUFHO1FBQzVDLE1BQU1DLE9BQU9DLFNBQVNKLGFBQWFLLEdBQUcsQ0FBQyxXQUFXO1FBQ2xELE1BQU1DLFFBQVFGLFNBQVNKLGFBQWFLLEdBQUcsQ0FBQyxZQUFZO1FBQ3BELE1BQU1aLFNBQVNPLGFBQWFLLEdBQUcsQ0FBQztRQUVoQywwQkFBMEI7UUFDMUIsSUFBSSxFQUFFUCxNQUFNRixJQUFJLEVBQUUsR0FBRyxNQUFNUix1QkFBYSxDQUNyQ21CLElBQUksQ0FBQyxTQUNMQyxNQUFNLENBQUMsTUFDUEMsRUFBRSxDQUFDLFlBQVlDLFFBQ2ZDLE1BQU07UUFFVCxJQUFJ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