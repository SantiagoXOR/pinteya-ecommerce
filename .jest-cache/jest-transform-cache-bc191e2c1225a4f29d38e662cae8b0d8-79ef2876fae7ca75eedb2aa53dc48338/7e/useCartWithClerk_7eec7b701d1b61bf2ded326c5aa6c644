7ab28185d309a278ee8f7644d1441bde
// ===================================
// PINTEYA E-COMMERCE - CART HOOK WITH CLERK INTEGRATION
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get useCart () {
        return useCart;
    },
    get useCartWithClerk () {
        return useCartWithClerk;
    }
});
const _react = require("react");
const _useAuth = require("./useAuth");
const _store = require("../redux/store");
const _cartslice = require("../redux/features/cart-slice");
const _cartPersistence = require("../redux/middleware/cartPersistence");
const useCartWithClerk = ()=>{
    const { user, isLoaded } = (0, _useAuth.useAuth)();
    const dispatch = (0, _store.useAppDispatch)();
    const cartItems = (0, _store.useAppSelector)(_cartslice.selectCartItems);
    // Función para migrar carrito temporal a usuario autenticado
    const migrateCart = (0, _react.useCallback)(async (userId)=>{
        try {
            // Obtener items del localStorage
            const temporaryItems = (0, _cartPersistence.loadCartFromStorage)();
            if (temporaryItems.length > 0) {
                // Migrar items al backend (implementación futura)
                const migrationSuccess = await (0, _cartPersistence.migrateTemporaryCart)(temporaryItems, userId);
                if (migrationSuccess) {
                    // Limpiar localStorage después de migración exitosa
                    (0, _cartPersistence.clearCartFromStorage)();
                }
            }
            // Cargar carrito del usuario desde el backend (implementación futura)
            const userCartItems = await (0, _cartPersistence.loadUserCart)(userId);
            // Si hay items del usuario, reemplazar el carrito actual
            if (userCartItems.length > 0) {
                dispatch((0, _cartslice.replaceCart)(userCartItems));
            }
        } catch (error) {
            console.error('Error during cart migration:', error);
        }
    }, [
        dispatch
    ]);
    // Función para guardar carrito del usuario autenticado
    const saveCart = (0, _react.useCallback)(async (userId)=>{
        try {
            if (cartItems.length > 0) {
                await (0, _cartPersistence.saveUserCart)(userId, cartItems);
            }
        } catch (error) {
            console.error('Error saving user cart:', error);
        }
    }, [
        cartItems
    ]);
    // Efecto para manejar cambios en el estado de autenticación
    (0, _react.useEffect)(()=>{
        if (!isLoaded) return;
        if (user) {
            // Usuario autenticado - migrar carrito temporal si existe
            migrateCart(user.id);
        } else {
            // Usuario no autenticado - cargar desde localStorage
            const persistedItems = (0, _cartPersistence.loadCartFromStorage)();
            if (persistedItems.length > 0) {
                dispatch((0, _cartslice.hydrateCart)(persistedItems));
            }
        }
    }, [
        user,
        isLoaded,
        dispatch,
        migrateCart
    ]);
    // Efecto para guardar carrito de usuario autenticado cuando cambie
    (0, _react.useEffect)(()=>{
        if (!isLoaded || !user) return;
        // Debounce para evitar guardados excesivos
        const timeoutId = setTimeout(()=>{
            saveCart(user.id);
        }, 1000);
        return ()=>clearTimeout(timeoutId);
    }, [
        cartItems,
        user,
        isLoaded,
        saveCart
    ]);
    // Función para limpiar carrito al cerrar sesión
    const handleSignOut = (0, _react.useCallback)(()=>{
        dispatch((0, _cartslice.removeAllItemsFromCart)());
        (0, _cartPersistence.clearCartFromStorage)();
    }, [
        dispatch
    ]);
    return {
        isAuthenticated: !!user,
        userId: user?.id,
        cartItems,
        migrateCart,
        saveCart,
        handleSignOut
    };
};
const useCart = ()=>{
    const cartItems = (0, _store.useAppSelector)(_cartslice.selectCartItems);
    const dispatch = (0, _store.useAppDispatch)();
    return {
        cartItems,
        dispatch
    };
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZUNhcnRXaXRoQ2xlcmsudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gUElOVEVZQSBFLUNPTU1FUkNFIC0gQ0FSVCBIT09LIFdJVEggQ0xFUksgSU5URUdSQVRJT05cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCB7IHVzZUF1dGggfSBmcm9tICcuL3VzZUF1dGgnO1xyXG5pbXBvcnQgeyB1c2VBcHBEaXNwYXRjaCwgdXNlQXBwU2VsZWN0b3IgfSBmcm9tICdAL3JlZHV4L3N0b3JlJztcclxuaW1wb3J0IHsgXHJcbiAgc2VsZWN0Q2FydEl0ZW1zLCBcclxuICBoeWRyYXRlQ2FydCwgXHJcbiAgcmVwbGFjZUNhcnQsXHJcbiAgcmVtb3ZlQWxsSXRlbXNGcm9tQ2FydCBcclxufSBmcm9tICdAL3JlZHV4L2ZlYXR1cmVzL2NhcnQtc2xpY2UnO1xyXG5pbXBvcnQgeyBcclxuICBsb2FkQ2FydEZyb21TdG9yYWdlLCBcclxuICBjbGVhckNhcnRGcm9tU3RvcmFnZSxcclxuICBtaWdyYXRlVGVtcG9yYXJ5Q2FydCxcclxuICBsb2FkVXNlckNhcnQsXHJcbiAgc2F2ZVVzZXJDYXJ0IFxyXG59IGZyb20gJ0AvcmVkdXgvbWlkZGxld2FyZS9jYXJ0UGVyc2lzdGVuY2UnO1xyXG5cclxuLy8gSG9vayBwZXJzb25hbGl6YWRvIHBhcmEgbWFuZWphciBlbCBjYXJyaXRvIGNvbiBpbnRlZ3JhY2nDs24gTmV4dEF1dGhcclxuZXhwb3J0IGNvbnN0IHVzZUNhcnRXaXRoQ2xlcmsgPSAoKSA9PiB7XHJcbiAgY29uc3QgeyB1c2VyLCBpc0xvYWRlZCB9ID0gdXNlQXV0aCgpO1xyXG4gIGNvbnN0IGRpc3BhdGNoID0gdXNlQXBwRGlzcGF0Y2goKTtcclxuICBjb25zdCBjYXJ0SXRlbXMgPSB1c2VBcHBTZWxlY3RvcihzZWxlY3RDYXJ0SXRlbXMpO1xyXG5cclxuICAvLyBGdW5jacOzbiBwYXJhIG1pZ3JhciBjYXJyaXRvIHRlbXBvcmFsIGEgdXN1YXJpbyBhdXRlbnRpY2Fkb1xyXG4gIGNvbnN0IG1pZ3JhdGVDYXJ0ID0gdXNlQ2FsbGJhY2soYXN5bmMgKHVzZXJJZDogc3RyaW5nKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBPYnRlbmVyIGl0ZW1zIGRlbCBsb2NhbFN0b3JhZ2VcclxuICAgICAgY29uc3QgdGVtcG9yYXJ5SXRlbXMgPSBsb2FkQ2FydEZyb21TdG9yYWdlKCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAodGVtcG9yYXJ5SXRlbXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIE1pZ3JhciBpdGVtcyBhbCBiYWNrZW5kIChpbXBsZW1lbnRhY2nDs24gZnV0dXJhKVxyXG4gICAgICAgIGNvbnN0IG1pZ3JhdGlvblN1Y2Nlc3MgPSBhd2FpdCBtaWdyYXRlVGVtcG9yYXJ5Q2FydCh0ZW1wb3JhcnlJdGVtcywgdXNlcklkKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAobWlncmF0aW9uU3VjY2Vzcykge1xyXG4gICAgICAgICAgLy8gTGltcGlhciBsb2NhbFN0b3JhZ2UgZGVzcHXDqXMgZGUgbWlncmFjacOzbiBleGl0b3NhXHJcbiAgICAgICAgICBjbGVhckNhcnRGcm9tU3RvcmFnZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gQ2FyZ2FyIGNhcnJpdG8gZGVsIHVzdWFyaW8gZGVzZGUgZWwgYmFja2VuZCAoaW1wbGVtZW50YWNpw7NuIGZ1dHVyYSlcclxuICAgICAgY29uc3QgdXNlckNhcnRJdGVtcyA9IGF3YWl0IGxvYWRVc2VyQ2FydCh1c2VySWQpO1xyXG4gICAgICBcclxuICAgICAgLy8gU2kgaGF5IGl0ZW1zIGRlbCB1c3VhcmlvLCByZWVtcGxhemFyIGVsIGNhcnJpdG8gYWN0dWFsXHJcbiAgICAgIGlmICh1c2VyQ2FydEl0ZW1zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBkaXNwYXRjaChyZXBsYWNlQ2FydCh1c2VyQ2FydEl0ZW1zKSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkdXJpbmcgY2FydCBtaWdyYXRpb246JywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH0sIFtkaXNwYXRjaF0pO1xyXG5cclxuICAvLyBGdW5jacOzbiBwYXJhIGd1YXJkYXIgY2Fycml0byBkZWwgdXN1YXJpbyBhdXRlbnRpY2Fkb1xyXG4gIGNvbnN0IHNhdmVDYXJ0ID0gdXNlQ2FsbGJhY2soYXN5bmMgKHVzZXJJZDogc3RyaW5nKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoY2FydEl0ZW1zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBhd2FpdCBzYXZlVXNlckNhcnQodXNlcklkLCBjYXJ0SXRlbXMpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgdXNlciBjYXJ0OicsIGVycm9yKTtcclxuICAgIH1cclxuICB9LCBbY2FydEl0ZW1zXSk7XHJcblxyXG4gIC8vIEVmZWN0byBwYXJhIG1hbmVqYXIgY2FtYmlvcyBlbiBlbCBlc3RhZG8gZGUgYXV0ZW50aWNhY2nDs25cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKCFpc0xvYWRlZCkgcmV0dXJuO1xyXG5cclxuICAgIGlmICh1c2VyKSB7XHJcbiAgICAgIC8vIFVzdWFyaW8gYXV0ZW50aWNhZG8gLSBtaWdyYXIgY2Fycml0byB0ZW1wb3JhbCBzaSBleGlzdGVcclxuICAgICAgbWlncmF0ZUNhcnQodXNlci5pZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBVc3VhcmlvIG5vIGF1dGVudGljYWRvIC0gY2FyZ2FyIGRlc2RlIGxvY2FsU3RvcmFnZVxyXG4gICAgICBjb25zdCBwZXJzaXN0ZWRJdGVtcyA9IGxvYWRDYXJ0RnJvbVN0b3JhZ2UoKTtcclxuICAgICAgaWYgKHBlcnNpc3RlZEl0ZW1zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBkaXNwYXRjaChoeWRyYXRlQ2FydChwZXJzaXN0ZWRJdGVtcykpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSwgW3VzZXIsIGlzTG9hZGVkLCBkaXNwYXRjaCwgbWlncmF0ZUNhcnRdKTtcclxuXHJcbiAgLy8gRWZlY3RvIHBhcmEgZ3VhcmRhciBjYXJyaXRvIGRlIHVzdWFyaW8gYXV0ZW50aWNhZG8gY3VhbmRvIGNhbWJpZVxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBpZiAoIWlzTG9hZGVkIHx8ICF1c2VyKSByZXR1cm47XHJcblxyXG4gICAgLy8gRGVib3VuY2UgcGFyYSBldml0YXIgZ3VhcmRhZG9zIGV4Y2VzaXZvc1xyXG4gICAgY29uc3QgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHNhdmVDYXJ0KHVzZXIuaWQpO1xyXG4gICAgfSwgMTAwMCk7XHJcblxyXG4gICAgcmV0dXJuICgpID0+IGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xyXG4gIH0sIFtjYXJ0SXRlbXMsIHVzZXIsIGlzTG9hZGVkLCBzYXZlQ2FydF0pO1xyXG5cclxuICAvLyBGdW5jacOzbiBwYXJhIGxpbXBpYXIgY2Fycml0byBhbCBjZXJyYXIgc2VzacOzblxyXG4gIGNvbnN0IGhhbmRsZVNpZ25PdXQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XHJcbiAgICBkaXNwYXRjaChyZW1vdmVBbGxJdGVtc0Zyb21DYXJ0KCkpO1xyXG4gICAgY2xlYXJDYXJ0RnJvbVN0b3JhZ2UoKTtcclxuICB9LCBbZGlzcGF0Y2hdKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGlzQXV0aGVudGljYXRlZDogISF1c2VyLFxyXG4gICAgdXNlcklkOiB1c2VyPy5pZCxcclxuICAgIGNhcnRJdGVtcyxcclxuICAgIG1pZ3JhdGVDYXJ0LFxyXG4gICAgc2F2ZUNhcnQsXHJcbiAgICBoYW5kbGVTaWduT3V0LFxyXG4gIH07XHJcbn07XHJcblxyXG4vLyBIb29rIHNpbXBsaWZpY2FkbyBwYXJhIGNvbXBvbmVudGVzIHF1ZSBzb2xvIG5lY2VzaXRhbiBlbCBlc3RhZG8gZGVsIGNhcnJpdG9cclxuZXhwb3J0IGNvbnN0IHVzZUNhcnQgPSAoKSA9PiB7XHJcbiAgY29uc3QgY2FydEl0ZW1zID0gdXNlQXBwU2VsZWN0b3Ioc2VsZWN0Q2FydEl0ZW1zKTtcclxuICBjb25zdCBkaXNwYXRjaCA9IHVzZUFwcERpc3BhdGNoKCk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBjYXJ0SXRlbXMsXHJcbiAgICBkaXNwYXRjaCxcclxuICB9O1xyXG59O1xyXG4iXSwibmFtZXMiOlsidXNlQ2FydCIsInVzZUNhcnRXaXRoQ2xlcmsiLCJ1c2VyIiwiaXNMb2FkZWQiLCJ1c2VBdXRoIiwiZGlzcGF0Y2giLCJ1c2VBcHBEaXNwYXRjaCIsImNhcnRJdGVtcyIsInVzZUFwcFNlbGVjdG9yIiwic2VsZWN0Q2FydEl0ZW1zIiwibWlncmF0ZUNhcnQiLCJ1c2VDYWxsYmFjayIsInVzZXJJZCIsInRlbXBvcmFyeUl0ZW1zIiwibG9hZENhcnRGcm9tU3RvcmFnZSIsImxlbmd0aCIsIm1pZ3JhdGlvblN1Y2Nlc3MiLCJtaWdyYXRlVGVtcG9yYXJ5Q2FydCIsImNsZWFyQ2FydEZyb21TdG9yYWdlIiwidXNlckNhcnRJdGVtcyIsImxvYWRVc2VyQ2FydCIsInJlcGxhY2VDYXJ0IiwiZXJyb3IiLCJjb25zb2xlIiwic2F2ZUNhcnQiLCJzYXZlVXNlckNhcnQiLCJ1c2VFZmZlY3QiLCJpZCIsInBlcnNpc3RlZEl0ZW1zIiwiaHlkcmF0ZUNhcnQiLCJ0aW1lb3V0SWQiLCJzZXRUaW1lb3V0IiwiY2xlYXJUaW1lb3V0IiwiaGFuZGxlU2lnbk91dCIsInJlbW92ZUFsbEl0ZW1zRnJvbUNhcnQiLCJpc0F1dGhlbnRpY2F0ZWQiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0Qyx3REFBd0Q7QUFDeEQsc0NBQXNDOzs7Ozs7Ozs7Ozs7UUErR3pCQTtlQUFBQTs7UUEzRkFDO2VBQUFBOzs7dUJBbEIwQjt5QkFDZjt1QkFDdUI7MkJBTXhDO2lDQU9BO0FBR0EsTUFBTUEsbUJBQW1CO0lBQzlCLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxRQUFRLEVBQUUsR0FBR0MsSUFBQUEsZ0JBQU87SUFDbEMsTUFBTUMsV0FBV0MsSUFBQUEscUJBQWM7SUFDL0IsTUFBTUMsWUFBWUMsSUFBQUEscUJBQWMsRUFBQ0MsMEJBQWU7SUFFaEQsNkRBQTZEO0lBQzdELE1BQU1DLGNBQWNDLElBQUFBLGtCQUFXLEVBQUMsT0FBT0M7UUFDckMsSUFBSTtZQUNGLGlDQUFpQztZQUNqQyxNQUFNQyxpQkFBaUJDLElBQUFBLG9DQUFtQjtZQUUxQyxJQUFJRCxlQUFlRSxNQUFNLEdBQUcsR0FBRztnQkFFN0Isa0RBQWtEO2dCQUNsRCxNQUFNQyxtQkFBbUIsTUFBTUMsSUFBQUEscUNBQW9CLEVBQUNKLGdCQUFnQkQ7Z0JBRXBFLElBQUlJLGtCQUFrQjtvQkFDcEIsb0RBQW9EO29CQUNwREUsSUFBQUEscUNBQW9CO2dCQUN0QjtZQUNGO1lBRUEsc0VBQXNFO1lBQ3RFLE1BQU1DLGdCQUFnQixNQUFNQyxJQUFBQSw2QkFBWSxFQUFDUjtZQUV6Qyx5REFBeUQ7WUFDekQsSUFBSU8sY0FBY0osTUFBTSxHQUFHLEdBQUc7Z0JBQzVCVixTQUFTZ0IsSUFBQUEsc0JBQVcsRUFBQ0Y7WUFDdkI7UUFFRixFQUFFLE9BQU9HLE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLGdDQUFnQ0E7UUFDaEQ7SUFDRixHQUFHO1FBQUNqQjtLQUFTO0lBRWIsdURBQXVEO0lBQ3ZELE1BQU1tQixXQUFXYixJQUFBQSxrQkFBVyxFQUFDLE9BQU9DO1FBQ2xDLElBQUk7WUFDRixJQUFJTCxVQUFVUSxNQUFNLEdBQUcsR0FBRztnQkFDeEIsTUFBTVUsSUFBQUEsNkJBQVksRUFBQ2IsUUFBUUw7WUFDN0I7UUFDRixFQUFFLE9BQU9lLE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLDJCQUEyQkE7UUFDM0M7SUFDRixHQUFHO1FBQUNmO0tBQVU7SUFFZCw0REFBNEQ7SUFDNURtQixJQUFBQSxnQkFBUyxFQUFDO1FBQ1IsSUFBSSxDQUFDdkIsVUFBVTtRQUVmLElBQUlELE1BQU07WUFDUiwwREFBMEQ7WUFDMURRLFlBQVlSLEtBQUt5QixFQUFFO1FBQ3JCLE9BQU87WUFDTCxxREFBcUQ7WUFDckQsTUFBTUMsaUJBQWlCZCxJQUFBQSxvQ0FBbUI7WUFDMUMsSUFBSWMsZUFBZWIsTUFBTSxHQUFHLEdBQUc7Z0JBQzdCVixTQUFTd0IsSUFBQUEsc0JBQVcsRUFBQ0Q7WUFDdkI7UUFDRjtJQUNGLEdBQUc7UUFBQzFCO1FBQU1DO1FBQVVFO1FBQVVLO0tBQVk7SUFFMUMsbUVBQW1FO0lBQ25FZ0IsSUFBQUEsZ0JBQVMsRUFBQztRQUNSLElBQUksQ0FBQ3ZCLFlBQVksQ0FBQ0QsTUFBTTtRQUV4QiwyQ0FBMkM7UUFDM0MsTUFBTTRCLFlBQVlDLFdBQVc7WUFDM0JQLFNBQVN0QixLQUFLeUIsRUFBRTtRQUNsQixHQUFHO1FBRUgsT0FBTyxJQUFNSyxhQUFhRjtJQUM1QixHQUFHO1FBQUN2QjtRQUFXTDtRQUFNQztRQUFVcUI7S0FBUztJQUV4QyxnREFBZ0Q7SUFDaEQsTUFBTVMsZ0JBQWdCdEIsSUFBQUEsa0JBQVcsRUFBQztRQUNoQ04sU0FBUzZCLElBQUFBLGlDQUFzQjtRQUMvQmhCLElBQUFBLHFDQUFvQjtJQUN0QixHQUFHO1FBQUNiO0tBQVM7SUFFYixPQUFPO1FBQ0w4QixpQkFBaUIsQ0FBQyxDQUFDakM7UUFDbkJVLFFBQVFWLE1BQU15QjtRQUNkcEI7UUFDQUc7UUFDQWM7UUFDQVM7SUFDRjtBQUNGO0FBR08sTUFBTWpDLFVBQVU7SUFDckIsTUFBTU8sWUFBWUMsSUFBQUEscUJBQWMsRUFBQ0MsMEJBQWU7SUFDaEQsTUFBTUosV0FBV0MsSUFBQUEscUJBQWM7SUFFL0IsT0FBTztRQUNMQztRQUNBRjtJQUNGO0FBQ0YifQ==