{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\hooks\\useOrdersEnterprise-validation.test.js"],"sourcesContent":["// ===================================\n// PINTEYA E-COMMERCE - VALIDATION TESTS\n// Pruebas específicas para validación de datos en useOrdersEnterprise\n// ===================================\n\nimport { renderHook, act, waitFor } from '@testing-library/react';\nimport { describe, it, expect, beforeEach, afterEach } from '@jest/globals';\nimport { jest } from '@jest/globals';\nimport { useOrdersEnterprise } from '@/hooks/useOrdersEnterprise';\n\n// ===================================\n// MOCKS\n// ===================================\n\nconst mockFetch = jest.fn();\nglobal.fetch = mockFetch;\n\nconst mockConsoleWarn = jest.spyOn(console, 'warn').mockImplementation(() => {});\n\n// Datos de prueba con valores problemáticos\nconst mockOrdersWithInvalidData = [\n  {\n    id: 'order-1',\n    order_number: 'ORD-001',\n    status: 'pending',\n    total: undefined, // Valor problemático\n    created_at: '2024-01-01T10:00:00Z'\n  },\n  {\n    id: 'order-2', \n    order_number: 'ORD-002',\n    status: 'confirmed',\n    total: NaN, // Valor problemático\n    created_at: '2024-01-02T10:00:00Z'\n  },\n  {\n    id: 'order-3',\n    order_number: 'ORD-003', \n    status: 'shipped',\n    total: 'invalid', // Valor problemático\n    created_at: '2024-01-03T10:00:00Z'\n  },\n  {\n    id: 'order-4',\n    order_number: 'ORD-004',\n    status: 'delivered',\n    total: 15000, // Valor válido\n    created_at: '2024-01-04T10:00:00Z'\n  },\n  {\n    id: 'order-5',\n    order_number: 'ORD-005',\n    status: 'cancelled',\n    total: 25000, // Valor válido pero cancelado\n    created_at: '2024-01-05T10:00:00Z'\n  }\n];\n\nconst mockApiResponse = {\n  data: {\n    orders: mockOrdersWithInvalidData,\n    pagination: {\n      page: 1,\n      limit: 20,\n      total: mockOrdersWithInvalidData.length,\n      totalPages: 1,\n      hasNextPage: false,\n      hasPreviousPage: false\n    },\n    filters: {}\n  }\n};\n\n// ===================================\n// SETUP Y CLEANUP\n// ===================================\n\nbeforeEach(() => {\n  jest.clearAllMocks();\n  \n  mockFetch.mockResolvedValue({\n    ok: true,\n    status: 200,\n    json: async () => mockApiResponse\n  });\n});\n\nafterEach(() => {\n  jest.clearAllTimers();\n});\n\n// ===================================\n// TESTS DE VALIDACIÓN\n// ===================================\n\ndescribe('useOrdersEnterprise - Validación de Datos', () => {\n  it('debe manejar valores undefined en total sin retornar NaN', async () => {\n    // Arrange\n    const { result } = renderHook(() => useOrdersEnterprise());\n\n    // Wait for initial fetch\n    await waitFor(() => {\n      expect(result.current.loading).toBe(false);\n    });\n\n    // Act\n    const totalRevenue = result.current.getTotalRevenue();\n    const avgOrderValue = result.current.getAverageOrderValue();\n\n    // Assert\n    expect(totalRevenue).not.toBeNaN();\n    expect(avgOrderValue).not.toBeNaN();\n    expect(typeof totalRevenue).toBe('number');\n    expect(typeof avgOrderValue).toBe('number');\n    \n    // Solo debe contar la orden válida (order-4: 15000)\n    expect(totalRevenue).toBe(15000);\n    expect(avgOrderValue).toBe(15000);\n    \n    // Debe mostrar warnings para valores inválidos\n    expect(mockConsoleWarn).toHaveBeenCalledWith(\n      '[useOrdersEnterprise] Invalid order total detected:', \n      undefined\n    );\n    expect(mockConsoleWarn).toHaveBeenCalledWith(\n      '[useOrdersEnterprise] Invalid order total detected:', \n      NaN\n    );\n    expect(mockConsoleWarn).toHaveBeenCalledWith(\n      '[useOrdersEnterprise] Invalid order total detected:', \n      'invalid'\n    );\n  });\n\n  it('debe excluir órdenes canceladas del cálculo', async () => {\n    // Arrange\n    const { result } = renderHook(() => useOrdersEnterprise());\n\n    await waitFor(() => {\n      expect(result.current.loading).toBe(false);\n    });\n\n    // Act\n    const totalRevenue = result.current.getTotalRevenue();\n    const avgOrderValue = result.current.getAverageOrderValue();\n\n    // Assert\n    // No debe incluir la orden cancelada (order-5: 25000)\n    expect(totalRevenue).toBe(15000); // Solo order-4\n    expect(avgOrderValue).toBe(15000); // Solo order-4\n  });\n\n  it('debe retornar 0 cuando no hay órdenes válidas', async () => {\n    // Arrange - Mock con solo órdenes inválidas\n    const invalidOrdersOnly = mockOrdersWithInvalidData.filter(order => \n      order.status === 'cancelled' || order.total === undefined || isNaN(order.total) || typeof order.total === 'string'\n    );\n    \n    mockFetch.mockResolvedValue({\n      ok: true,\n      status: 200,\n      json: async () => ({\n        data: {\n          orders: invalidOrdersOnly,\n          pagination: { page: 1, limit: 20, total: invalidOrdersOnly.length, totalPages: 1 },\n          filters: {}\n        }\n      })\n    });\n\n    const { result } = renderHook(() => useOrdersEnterprise());\n\n    await waitFor(() => {\n      expect(result.current.loading).toBe(false);\n    });\n\n    // Act\n    const totalRevenue = result.current.getTotalRevenue();\n    const avgOrderValue = result.current.getAverageOrderValue();\n\n    // Assert\n    expect(totalRevenue).toBe(0);\n    expect(avgOrderValue).toBe(0);\n    expect(totalRevenue).not.toBeNaN();\n    expect(avgOrderValue).not.toBeNaN();\n  });\n\n  it('debe redondear correctamente el valor promedio', async () => {\n    // Arrange - Mock con valores que requieren redondeo\n    const ordersWithDecimals = [\n      { id: 'order-1', status: 'delivered', total: 33.33, created_at: '2024-01-01T10:00:00Z' },\n      { id: 'order-2', status: 'delivered', total: 33.33, created_at: '2024-01-02T10:00:00Z' },\n      { id: 'order-3', status: 'delivered', total: 33.34, created_at: '2024-01-03T10:00:00Z' }\n    ];\n    \n    mockFetch.mockResolvedValue({\n      ok: true,\n      status: 200,\n      json: async () => ({\n        data: {\n          orders: ordersWithDecimals,\n          pagination: { page: 1, limit: 20, total: ordersWithDecimals.length, totalPages: 1 },\n          filters: {}\n        }\n      })\n    });\n\n    const { result } = renderHook(() => useOrdersEnterprise());\n\n    await waitFor(() => {\n      expect(result.current.loading).toBe(false);\n    });\n\n    // Act\n    const avgOrderValue = result.current.getAverageOrderValue();\n\n    // Assert\n    // (33.33 + 33.33 + 33.34) / 3 = 33.333... -> redondeado a 33.33\n    expect(avgOrderValue).toBe(33.33);\n    expect(avgOrderValue).not.toBeNaN();\n  });\n});\n"],"names":["mockFetch","jest","fn","global","fetch","mockConsoleWarn","spyOn","console","mockImplementation","mockOrdersWithInvalidData","id","order_number","status","total","undefined","created_at","NaN","mockApiResponse","data","orders","pagination","page","limit","length","totalPages","hasNextPage","hasPreviousPage","filters","beforeEach","clearAllMocks","mockResolvedValue","ok","json","afterEach","clearAllTimers","describe","it","result","renderHook","useOrdersEnterprise","waitFor","expect","current","loading","toBe","totalRevenue","getTotalRevenue","avgOrderValue","getAverageOrderValue","not","toBeNaN","toHaveBeenCalledWith","invalidOrdersOnly","filter","order","isNaN","ordersWithDecimals"],"mappings":"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"}