ead1acc4df7b538b61d084dcb6a9a6b8
/**
 * Utilidades de autenticaci√≥n usando Supabase Auth directamente
 * Reemplazo para enterprise-auth-utils.ts que evita conflictos con Clerk
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    checkPermission: function() {
        return checkPermission;
    },
    getSecurityMetrics: function() {
        return getSecurityMetrics;
    },
    logAdminAction: function() {
        return logAdminAction;
    },
    requireAdminAuth: function() {
        return requireAdminAuth;
    },
    validateInput: function() {
        return validateInput;
    },
    withAdminAuth: function() {
        return withAdminAuth;
    }
});
const _supabasejs = require("@supabase/supabase-js");
const _backend = require("@clerk/backend");
const _adminauth = require("./admin-auth");
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
// Cliente admin para operaciones del servidor
const supabaseAdmin = (0, _supabasejs.createClient)(supabaseUrl, supabaseServiceKey);
// Rate limiting simple en memoria (para producci√≥n usar Redis)
const rateLimitMap = new Map();
/**
 * Verificar rate limiting
 */ function checkRateLimit(identifier, maxRequests = 100, windowMs = 60000) {
    const now = Date.now();
    const key = identifier;
    const current = rateLimitMap.get(key);
    if (!current || now > current.resetTime) {
        rateLimitMap.set(key, {
            count: 1,
            resetTime: now + windowMs
        });
        return true;
    }
    if (current.count >= maxRequests) {
        return false;
    }
    current.count++;
    return true;
}
/**
 * Obtener usuario autenticado desde JWT token (Clerk o Supabase)
 */ async function getAuthenticatedUser(request) {
    try {
        // Obtener token del header Authorization
        const authHeader = request.headers.get('authorization');
        if (!authHeader || !authHeader.startsWith('Bearer ')) {
            return {
                success: false,
                error: 'Token de autorizaci√≥n requerido',
                status: 401
            };
        }
        const token = authHeader.substring(7); // Remover "Bearer "
        // Intentar verificar con Clerk primero
        try {
            const clerkPayload = await (0, _backend.verifyToken)(token, {
                secretKey: process.env.CLERK_SECRET_KEY
            });
            if (clerkPayload && clerkPayload.sub) {
                // Token de Clerk v√°lido, buscar usuario en Supabase
                const supabase = (0, _supabasejs.createClient)(supabaseUrl, process.env.SUPABASE_SERVICE_ROLE_KEY);
                const { data: profile, error: profileError } = await supabase.from('user_profiles').select(`
            id,
            email,
            supabase_user_id,
            user_roles (
              role_name
            )
          `).eq('clerk_user_id', clerkPayload.sub).single();
                if (profileError || !profile) {
                    console.error('‚ùå Error obteniendo perfil de usuario:', {
                        clerkUserId: clerkPayload.sub,
                        profileError: profileError?.message,
                        profile
                    });
                    return {
                        success: false,
                        error: 'Usuario no encontrado en el sistema',
                        status: 401
                    };
                }
                console.log('‚úÖ Usuario encontrado:', {
                    email: profile.email,
                    role: profile.user_roles?.role_name,
                    clerkId: clerkPayload.sub
                });
                // Crear objeto user compatible
                const user = {
                    id: profile.supabase_user_id,
                    email: profile.email,
                    clerk_id: clerkPayload.sub
                };
                const isAdmin = profile.user_roles?.role_name === 'admin';
                console.log('üîê Verificaci√≥n de admin:', {
                    isAdmin,
                    roleName: profile.user_roles?.role_name
                });
                return {
                    success: true,
                    user,
                    supabase,
                    isAdmin
                };
            }
        } catch (clerkError) {
            console.log('Token no es de Clerk, intentando con Supabase...');
        }
        // Si no es token de Clerk, intentar con Supabase
        const supabase = (0, _supabasejs.createClient)(supabaseUrl, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);
        // Verificar el token JWT de Supabase
        const { data: { user }, error: authError } = await supabase.auth.getUser(token);
        if (authError || !user) {
            return {
                success: false,
                error: 'Token inv√°lido o expirado',
                status: 401
            };
        }
        // Obtener perfil y rol del usuario usando service role key
        const supabaseAdmin = (0, _supabasejs.createClient)(supabaseUrl, process.env.SUPABASE_SERVICE_ROLE_KEY);
        const { data: profile, error: profileError } = await supabaseAdmin.from('user_profiles').select(`
        id,
        email,
        role_id,
        is_active,
        user_roles (
          role_name,
          permissions
        )
      `).eq('supabase_user_id', user.id).eq('is_active', true).single();
        if (profileError || !profile) {
            return {
                success: false,
                error: 'Perfil de usuario no encontrado',
                status: 403
            };
        }
        return {
            success: true,
            user: {
                id: user.id,
                email: profile.email,
                role: profile.user_roles?.role_name || 'customer',
                permissions: profile.user_roles?.permissions || {}
            },
            supabase: supabaseAdmin
        };
    } catch (error) {
        console.error('Error en autenticaci√≥n:', error);
        return {
            success: false,
            error: 'Error interno de autenticaci√≥n',
            status: 500
        };
    }
}
async function requireAdminAuth(request, permissions) {
    try {
        // Rate limiting
        const clientIP = request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown';
        if (!checkRateLimit(`admin_${clientIP}`, 50, 60000)) {
            return {
                success: false,
                error: 'Demasiadas solicitudes',
                status: 429
            };
        }
        // ‚úÖ CORREGIDO: Usar getAuthenticatedAdmin que tiene la verificaci√≥n de roles corregida
        const authResult = await (0, _adminauth.getAuthenticatedAdmin)(request);
        if (!authResult.userId || !authResult.isAdmin) {
            console.warn('‚ùå Acceso denegado en requireAdminAuth:', {
                userId: authResult.userId,
                isAdmin: authResult.isAdmin,
                error: authResult.error
            });
            return {
                success: false,
                error: authResult.error || 'Acceso denegado: se requiere rol de administrador',
                status: authResult.status || 403
            };
        }
        console.log('‚úÖ Acceso de admin autorizado via requireAdminAuth:', authResult.user?.email || authResult.userId);
        // Convertir resultado a formato AuthResult compatible
        return {
            success: true,
            user: authResult.user ? {
                id: authResult.user.id || authResult.userId,
                email: authResult.user.email || 'unknown',
                role: 'admin',
                permissions: {}
            } : {
                id: authResult.userId,
                email: 'unknown',
                role: 'admin',
                permissions: {}
            },
            supabase: authResult.supabase,
            isAdmin: true
        };
    } catch (error) {
        console.error('Error en requireAdminAuth:', error);
        return {
            success: false,
            error: 'Error interno del servidor',
            status: 500
        };
    }
}
async function checkPermission(request, resource, action) {
    try {
        const authResult = await requireAdminAuth(request);
        if (!authResult.success) {
            return authResult;
        }
        const permissions = authResult.user?.permissions;
        if (!permissions || !permissions[resource] || !permissions[resource][action]) {
            return {
                success: false,
                error: `Permiso denegado: ${resource}.${action}`,
                status: 403
            };
        }
        return authResult;
    } catch (error) {
        console.error('Error en checkPermission:', error);
        return {
            success: false,
            error: 'Error interno del servidor',
            status: 500
        };
    }
}
async function logAdminAction(userId, action, resource, resourceId, oldData, newData) {
    try {
        await supabaseAdmin.from('admin_audit_log').insert({
            user_id: userId,
            action,
            resource,
            resource_id: resourceId,
            old_data: oldData,
            new_data: newData,
            timestamp: new Date().toISOString(),
            ip_address: 'server',
            user_agent: 'admin-api'
        });
    } catch (error) {
        console.error('Error logging admin action:', error);
    }
}
function validateInput(data, allowedFields) {
    if (!data || typeof data !== 'object') {
        throw new Error('Datos inv√°lidos');
    }
    const sanitized = {};
    for (const field of allowedFields){
        if (data[field] !== undefined) {
            sanitized[field] = data[field];
        }
    }
    return sanitized;
}
function withAdminAuth(handler) {
    return async (request)=>{
        const authResult = await requireAdminAuth(request);
        if (!authResult.success) {
            return new Response(JSON.stringify({
                error: authResult.error,
                timestamp: new Date().toISOString()
            }), {
                status: authResult.status || 401,
                headers: {
                    'Content-Type': 'application/json'
                }
            });
        }
        return handler(request, authResult);
    };
}
async function getSecurityMetrics() {
    try {
        const now = Date.now();
        const oneHourAgo = now - 60 * 60 * 1000;
        // Contar solicitudes por IP en la √∫ltima hora
        const rateLimitStats = Array.from(rateLimitMap.entries()).filter(([_, data])=>data.resetTime > oneHourAgo).reduce((acc, [ip, data])=>{
            acc.totalRequests += data.count;
            acc.uniqueIPs++;
            return acc;
        }, {
            totalRequests: 0,
            uniqueIPs: 0
        });
        return {
            rateLimiting: rateLimitStats,
            timestamp: new Date().toISOString()
        };
    } catch (error) {
        console.error('Error obteniendo m√©tricas de seguridad:', error);
        return null;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhdXRoXFxzdXBhYmFzZS1hdXRoLXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVXRpbGlkYWRlcyBkZSBhdXRlbnRpY2FjacOzbiB1c2FuZG8gU3VwYWJhc2UgQXV0aCBkaXJlY3RhbWVudGVcbiAqIFJlZW1wbGF6byBwYXJhIGVudGVycHJpc2UtYXV0aC11dGlscy50cyBxdWUgZXZpdGEgY29uZmxpY3RvcyBjb24gQ2xlcmtcbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQgeyB2ZXJpZnlUb2tlbiB9IGZyb20gJ0BjbGVyay9iYWNrZW5kJztcbmltcG9ydCB7IGdldEF1dGhlbnRpY2F0ZWRBZG1pbiB9IGZyb20gJ0AvbGliL2F1dGgvYWRtaW4tYXV0aCc7XG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMITtcbmNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkhO1xuXG4vLyBDbGllbnRlIGFkbWluIHBhcmEgb3BlcmFjaW9uZXMgZGVsIHNlcnZpZG9yXG5jb25zdCBzdXBhYmFzZUFkbWluID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlcnZpY2VLZXkpO1xuXG4vLyBUaXBvcyBwYXJhIGF1dGVudGljYWNpw7NuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhSZXN1bHQge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICB1c2VyPzoge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgZW1haWw6IHN0cmluZztcbiAgICByb2xlOiBzdHJpbmc7XG4gICAgcGVybWlzc2lvbnM6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIH07XG4gIHN1cGFiYXNlPzogYW55O1xuICBlcnJvcj86IHN0cmluZztcbiAgc3RhdHVzPzogbnVtYmVyO1xufVxuXG4vLyBSYXRlIGxpbWl0aW5nIHNpbXBsZSBlbiBtZW1vcmlhIChwYXJhIHByb2R1Y2Npw7NuIHVzYXIgUmVkaXMpXG5jb25zdCByYXRlTGltaXRNYXAgPSBuZXcgTWFwPHN0cmluZywgeyBjb3VudDogbnVtYmVyOyByZXNldFRpbWU6IG51bWJlciB9PigpO1xuXG4vKipcbiAqIFZlcmlmaWNhciByYXRlIGxpbWl0aW5nXG4gKi9cbmZ1bmN0aW9uIGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXI6IHN0cmluZywgbWF4UmVxdWVzdHMgPSAxMDAsIHdpbmRvd01zID0gNjAwMDApOiBib29sZWFuIHtcbiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgY29uc3Qga2V5ID0gaWRlbnRpZmllcjtcbiAgXG4gIGNvbnN0IGN1cnJlbnQgPSByYXRlTGltaXRNYXAuZ2V0KGtleSk7XG4gIFxuICBpZiAoIWN1cnJlbnQgfHwgbm93ID4gY3VycmVudC5yZXNldFRpbWUpIHtcbiAgICByYXRlTGltaXRNYXAuc2V0KGtleSwgeyBjb3VudDogMSwgcmVzZXRUaW1lOiBub3cgKyB3aW5kb3dNcyB9KTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBcbiAgaWYgKGN1cnJlbnQuY291bnQgPj0gbWF4UmVxdWVzdHMpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgXG4gIGN1cnJlbnQuY291bnQrKztcbiAgcmV0dXJuIHRydWU7XG59XG5cbi8qKlxuICogT2J0ZW5lciB1c3VhcmlvIGF1dGVudGljYWRvIGRlc2RlIEpXVCB0b2tlbiAoQ2xlcmsgbyBTdXBhYmFzZSlcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0QXV0aGVudGljYXRlZFVzZXIocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPEF1dGhSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICAvLyBPYnRlbmVyIHRva2VuIGRlbCBoZWFkZXIgQXV0aG9yaXphdGlvblxuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJyk7XG5cbiAgICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdUb2tlbiBkZSBhdXRvcml6YWNpw7NuIHJlcXVlcmlkbycsXG4gICAgICAgIHN0YXR1czogNDAxXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5zdWJzdHJpbmcoNyk7IC8vIFJlbW92ZXIgXCJCZWFyZXIgXCJcblxuICAgIC8vIEludGVudGFyIHZlcmlmaWNhciBjb24gQ2xlcmsgcHJpbWVyb1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjbGVya1BheWxvYWQgPSBhd2FpdCB2ZXJpZnlUb2tlbih0b2tlbiwge1xuICAgICAgICBzZWNyZXRLZXk6IHByb2Nlc3MuZW52LkNMRVJLX1NFQ1JFVF9LRVkhXG4gICAgICB9KTtcblxuICAgICAgaWYgKGNsZXJrUGF5bG9hZCAmJiBjbGVya1BheWxvYWQuc3ViKSB7XG4gICAgICAgIC8vIFRva2VuIGRlIENsZXJrIHbDoWxpZG8sIGJ1c2NhciB1c3VhcmlvIGVuIFN1cGFiYXNlXG4gICAgICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZISk7XG5cbiAgICAgICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcbiAgICAgICAgICAuc2VsZWN0KGBcbiAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgZW1haWwsXG4gICAgICAgICAgICBzdXBhYmFzZV91c2VyX2lkLFxuICAgICAgICAgICAgdXNlcl9yb2xlcyAoXG4gICAgICAgICAgICAgIHJvbGVfbmFtZVxuICAgICAgICAgICAgKVxuICAgICAgICAgIGApXG4gICAgICAgICAgLmVxKCdjbGVya191c2VyX2lkJywgY2xlcmtQYXlsb2FkLnN1YilcbiAgICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgICAgaWYgKHByb2ZpbGVFcnJvciB8fCAhcHJvZmlsZSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBvYnRlbmllbmRvIHBlcmZpbCBkZSB1c3VhcmlvOicsIHtcbiAgICAgICAgICAgIGNsZXJrVXNlcklkOiBjbGVya1BheWxvYWQuc3ViLFxuICAgICAgICAgICAgcHJvZmlsZUVycm9yOiBwcm9maWxlRXJyb3I/Lm1lc3NhZ2UsXG4gICAgICAgICAgICBwcm9maWxlXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6ICdVc3VhcmlvIG5vIGVuY29udHJhZG8gZW4gZWwgc2lzdGVtYScsXG4gICAgICAgICAgICBzdGF0dXM6IDQwMVxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZygn4pyFIFVzdWFyaW8gZW5jb250cmFkbzonLCB7XG4gICAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgICAgcm9sZTogcHJvZmlsZS51c2VyX3JvbGVzPy5yb2xlX25hbWUsXG4gICAgICAgICAgY2xlcmtJZDogY2xlcmtQYXlsb2FkLnN1YlxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDcmVhciBvYmpldG8gdXNlciBjb21wYXRpYmxlXG4gICAgICAgIGNvbnN0IHVzZXIgPSB7XG4gICAgICAgICAgaWQ6IHByb2ZpbGUuc3VwYWJhc2VfdXNlcl9pZCxcbiAgICAgICAgICBlbWFpbDogcHJvZmlsZS5lbWFpbCxcbiAgICAgICAgICBjbGVya19pZDogY2xlcmtQYXlsb2FkLnN1YlxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGlzQWRtaW4gPSBwcm9maWxlLnVzZXJfcm9sZXM/LnJvbGVfbmFtZSA9PT0gJ2FkbWluJztcblxuICAgICAgICBjb25zb2xlLmxvZygn8J+UkCBWZXJpZmljYWNpw7NuIGRlIGFkbWluOicsIHtcbiAgICAgICAgICBpc0FkbWluLFxuICAgICAgICAgIHJvbGVOYW1lOiBwcm9maWxlLnVzZXJfcm9sZXM/LnJvbGVfbmFtZVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgdXNlcixcbiAgICAgICAgICBzdXBhYmFzZSxcbiAgICAgICAgICBpc0FkbWluXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoY2xlcmtFcnJvcikge1xuICAgICAgY29uc29sZS5sb2coJ1Rva2VuIG5vIGVzIGRlIENsZXJrLCBpbnRlbnRhbmRvIGNvbiBTdXBhYmFzZS4uLicpO1xuICAgIH1cblxuICAgIC8vIFNpIG5vIGVzIHRva2VuIGRlIENsZXJrLCBpbnRlbnRhciBjb24gU3VwYWJhc2VcbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhKTtcblxuICAgIC8vIFZlcmlmaWNhciBlbCB0b2tlbiBKV1QgZGUgU3VwYWJhc2VcbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogYXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIodG9rZW4pO1xuXG4gICAgaWYgKGF1dGhFcnJvciB8fCAhdXNlcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnVG9rZW4gaW52w6FsaWRvIG8gZXhwaXJhZG8nLFxuICAgICAgICBzdGF0dXM6IDQwMVxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBPYnRlbmVyIHBlcmZpbCB5IHJvbCBkZWwgdXN1YXJpbyB1c2FuZG8gc2VydmljZSByb2xlIGtleVxuICAgIGNvbnN0IHN1cGFiYXNlQWRtaW4gPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkhKTtcbiAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUsIGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcbiAgICAgIC5zZWxlY3QoYFxuICAgICAgICBpZCxcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHJvbGVfaWQsXG4gICAgICAgIGlzX2FjdGl2ZSxcbiAgICAgICAgdXNlcl9yb2xlcyAoXG4gICAgICAgICAgcm9sZV9uYW1lLFxuICAgICAgICAgIHBlcm1pc3Npb25zXG4gICAgICAgIClcbiAgICAgIGApXG4gICAgICAuZXEoJ3N1cGFiYXNlX3VzZXJfaWQnLCB1c2VyLmlkKVxuICAgICAgLmVxKCdpc19hY3RpdmUnLCB0cnVlKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKHByb2ZpbGVFcnJvciB8fCAhcHJvZmlsZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnUGVyZmlsIGRlIHVzdWFyaW8gbm8gZW5jb250cmFkbycsXG4gICAgICAgIHN0YXR1czogNDAzXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWwsXG4gICAgICAgIHJvbGU6IHByb2ZpbGUudXNlcl9yb2xlcz8ucm9sZV9uYW1lIHx8ICdjdXN0b21lcicsXG4gICAgICAgIHBlcm1pc3Npb25zOiBwcm9maWxlLnVzZXJfcm9sZXM/LnBlcm1pc3Npb25zIHx8IHt9XG4gICAgICB9LFxuICAgICAgc3VwYWJhc2U6IHN1cGFiYXNlQWRtaW5cbiAgICB9O1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gYXV0ZW50aWNhY2nDs246JywgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnRXJyb3IgaW50ZXJubyBkZSBhdXRlbnRpY2FjacOzbicsXG4gICAgICBzdGF0dXM6IDUwMFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBWZXJpZmljYXIgc2kgZWwgdXN1YXJpbyB0aWVuZSByb2wgZGUgYWRtaW5pc3RyYWRvclxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVxdWlyZUFkbWluQXV0aChyZXF1ZXN0OiBOZXh0UmVxdWVzdCwgcGVybWlzc2lvbnM/OiBzdHJpbmdbXSk6IFByb21pc2U8QXV0aFJlc3VsdD4ge1xuICB0cnkge1xuICAgIC8vIFJhdGUgbGltaXRpbmdcbiAgICBjb25zdCBjbGllbnRJUCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3gtZm9yd2FyZGVkLWZvcicpIHx8XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuaGVhZGVycy5nZXQoJ3gtcmVhbC1pcCcpIHx8XG4gICAgICAgICAgICAgICAgICAgICd1bmtub3duJztcblxuICAgIGlmICghY2hlY2tSYXRlTGltaXQoYGFkbWluXyR7Y2xpZW50SVB9YCwgNTAsIDYwMDAwKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnRGVtYXNpYWRhcyBzb2xpY2l0dWRlcycsXG4gICAgICAgIHN0YXR1czogNDI5XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIOKchSBDT1JSRUdJRE86IFVzYXIgZ2V0QXV0aGVudGljYXRlZEFkbWluIHF1ZSB0aWVuZSBsYSB2ZXJpZmljYWNpw7NuIGRlIHJvbGVzIGNvcnJlZ2lkYVxuICAgIGNvbnN0IGF1dGhSZXN1bHQgPSBhd2FpdCBnZXRBdXRoZW50aWNhdGVkQWRtaW4ocmVxdWVzdCk7XG5cbiAgICBpZiAoIWF1dGhSZXN1bHQudXNlcklkIHx8ICFhdXRoUmVzdWx0LmlzQWRtaW4pIHtcbiAgICAgIGNvbnNvbGUud2Fybign4p2MIEFjY2VzbyBkZW5lZ2FkbyBlbiByZXF1aXJlQWRtaW5BdXRoOicsIHtcbiAgICAgICAgdXNlcklkOiBhdXRoUmVzdWx0LnVzZXJJZCxcbiAgICAgICAgaXNBZG1pbjogYXV0aFJlc3VsdC5pc0FkbWluLFxuICAgICAgICBlcnJvcjogYXV0aFJlc3VsdC5lcnJvclxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogYXV0aFJlc3VsdC5lcnJvciB8fCAnQWNjZXNvIGRlbmVnYWRvOiBzZSByZXF1aWVyZSByb2wgZGUgYWRtaW5pc3RyYWRvcicsXG4gICAgICAgIHN0YXR1czogYXV0aFJlc3VsdC5zdGF0dXMgfHwgNDAzXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCfinIUgQWNjZXNvIGRlIGFkbWluIGF1dG9yaXphZG8gdmlhIHJlcXVpcmVBZG1pbkF1dGg6JywgYXV0aFJlc3VsdC51c2VyPy5lbWFpbCB8fCBhdXRoUmVzdWx0LnVzZXJJZCk7XG5cbiAgICAvLyBDb252ZXJ0aXIgcmVzdWx0YWRvIGEgZm9ybWF0byBBdXRoUmVzdWx0IGNvbXBhdGlibGVcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHVzZXI6IGF1dGhSZXN1bHQudXNlciA/IHtcbiAgICAgICAgaWQ6IGF1dGhSZXN1bHQudXNlci5pZCB8fCBhdXRoUmVzdWx0LnVzZXJJZCxcbiAgICAgICAgZW1haWw6IGF1dGhSZXN1bHQudXNlci5lbWFpbCB8fCAndW5rbm93bicsXG4gICAgICAgIHJvbGU6ICdhZG1pbicsXG4gICAgICAgIHBlcm1pc3Npb25zOiB7fVxuICAgICAgfSA6IHtcbiAgICAgICAgaWQ6IGF1dGhSZXN1bHQudXNlcklkLFxuICAgICAgICBlbWFpbDogJ3Vua25vd24nLFxuICAgICAgICByb2xlOiAnYWRtaW4nLFxuICAgICAgICBwZXJtaXNzaW9uczoge31cbiAgICAgIH0sXG4gICAgICBzdXBhYmFzZTogYXV0aFJlc3VsdC5zdXBhYmFzZSxcbiAgICAgIGlzQWRtaW46IHRydWVcbiAgICB9O1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gcmVxdWlyZUFkbWluQXV0aDonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicsXG4gICAgICBzdGF0dXM6IDUwMFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBWZXJpZmljYXIgcGVybWlzb3MgZXNwZWPDrWZpY29zXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1Blcm1pc3Npb24oXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCBcbiAgcmVzb3VyY2U6IHN0cmluZywgXG4gIGFjdGlvbjogc3RyaW5nXG4pOiBQcm9taXNlPEF1dGhSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgcmVxdWlyZUFkbWluQXV0aChyZXF1ZXN0KTtcbiAgICBcbiAgICBpZiAoIWF1dGhSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIGF1dGhSZXN1bHQ7XG4gICAgfVxuXG4gICAgY29uc3QgcGVybWlzc2lvbnMgPSBhdXRoUmVzdWx0LnVzZXI/LnBlcm1pc3Npb25zO1xuICAgIFxuICAgIGlmICghcGVybWlzc2lvbnMgfHwgIXBlcm1pc3Npb25zW3Jlc291cmNlXSB8fCAhcGVybWlzc2lvbnNbcmVzb3VyY2VdW2FjdGlvbl0pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogYFBlcm1pc28gZGVuZWdhZG86ICR7cmVzb3VyY2V9LiR7YWN0aW9ufWAsXG4gICAgICAgIHN0YXR1czogNDAzXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBhdXRoUmVzdWx0O1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gY2hlY2tQZXJtaXNzaW9uOicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyxcbiAgICAgIHN0YXR1czogNTAwXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIExvZ2dpbmcgZGUgYWNjaW9uZXMgYWRtaW5pc3RyYXRpdmFzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dBZG1pbkFjdGlvbihcbiAgdXNlcklkOiBzdHJpbmcsXG4gIGFjdGlvbjogc3RyaW5nLFxuICByZXNvdXJjZTogc3RyaW5nLFxuICByZXNvdXJjZUlkPzogc3RyaW5nLFxuICBvbGREYXRhPzogYW55LFxuICBuZXdEYXRhPzogYW55XG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgnYWRtaW5fYXVkaXRfbG9nJylcbiAgICAgIC5pbnNlcnQoe1xuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgIGFjdGlvbixcbiAgICAgICAgcmVzb3VyY2UsXG4gICAgICAgIHJlc291cmNlX2lkOiByZXNvdXJjZUlkLFxuICAgICAgICBvbGRfZGF0YTogb2xkRGF0YSxcbiAgICAgICAgbmV3X2RhdGE6IG5ld0RhdGEsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBpcF9hZGRyZXNzOiAnc2VydmVyJyxcbiAgICAgICAgdXNlcl9hZ2VudDogJ2FkbWluLWFwaSdcbiAgICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvZ2dpbmcgYWRtaW4gYWN0aW9uOicsIGVycm9yKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXIgeSBzYW5pdGl6YXIgaW5wdXRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlSW5wdXQoZGF0YTogYW55LCBhbGxvd2VkRmllbGRzOiBzdHJpbmdbXSk6IGFueSB7XG4gIGlmICghZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdG9zIGludsOhbGlkb3MnKTtcbiAgfVxuXG4gIGNvbnN0IHNhbml0aXplZDogYW55ID0ge307XG4gIFxuICBmb3IgKGNvbnN0IGZpZWxkIG9mIGFsbG93ZWRGaWVsZHMpIHtcbiAgICBpZiAoZGF0YVtmaWVsZF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgc2FuaXRpemVkW2ZpZWxkXSA9IGRhdGFbZmllbGRdO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBzYW5pdGl6ZWQ7XG59XG5cbi8qKlxuICogTWlkZGxld2FyZSB3cmFwcGVyIHBhcmEgQVBJcyBhZG1pblxuICovXG5leHBvcnQgZnVuY3Rpb24gd2l0aEFkbWluQXV0aChoYW5kbGVyOiAocmVxdWVzdDogTmV4dFJlcXVlc3QsIGF1dGhSZXN1bHQ6IEF1dGhSZXN1bHQpID0+IFByb21pc2U8UmVzcG9uc2U+KSB7XG4gIHJldHVybiBhc3luYyAocmVxdWVzdDogTmV4dFJlcXVlc3QpID0+IHtcbiAgICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgcmVxdWlyZUFkbWluQXV0aChyZXF1ZXN0KTtcbiAgICBcbiAgICBpZiAoIWF1dGhSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGVycm9yOiBhdXRoUmVzdWx0LmVycm9yLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH0pLFxuICAgICAgICB7XG4gICAgICAgICAgc3RhdHVzOiBhdXRoUmVzdWx0LnN0YXR1cyB8fCA0MDEsXG4gICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaGFuZGxlcihyZXF1ZXN0LCBhdXRoUmVzdWx0KTtcbiAgfTtcbn1cblxuLyoqXG4gKiBPYnRlbmVyIG3DqXRyaWNhcyBkZSBzZWd1cmlkYWRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlY3VyaXR5TWV0cmljcygpOiBQcm9taXNlPGFueT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgY29uc3Qgb25lSG91ckFnbyA9IG5vdyAtICg2MCAqIDYwICogMTAwMCk7XG4gICAgXG4gICAgLy8gQ29udGFyIHNvbGljaXR1ZGVzIHBvciBJUCBlbiBsYSDDumx0aW1hIGhvcmFcbiAgICBjb25zdCByYXRlTGltaXRTdGF0cyA9IEFycmF5LmZyb20ocmF0ZUxpbWl0TWFwLmVudHJpZXMoKSlcbiAgICAgIC5maWx0ZXIoKFtfLCBkYXRhXSkgPT4gZGF0YS5yZXNldFRpbWUgPiBvbmVIb3VyQWdvKVxuICAgICAgLnJlZHVjZSgoYWNjLCBbaXAsIGRhdGFdKSA9PiB7XG4gICAgICAgIGFjYy50b3RhbFJlcXVlc3RzICs9IGRhdGEuY291bnQ7XG4gICAgICAgIGFjYy51bmlxdWVJUHMrKztcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH0sIHsgdG90YWxSZXF1ZXN0czogMCwgdW5pcXVlSVBzOiAwIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJhdGVMaW1pdGluZzogcmF0ZUxpbWl0U3RhdHMsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH07XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBvYnRlbmllbmRvIG3DqXRyaWNhcyBkZSBzZWd1cmlkYWQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG4iXSwibmFtZXMiOlsiY2hlY2tQZXJtaXNzaW9uIiwiZ2V0U2VjdXJpdHlNZXRyaWNzIiwibG9nQWRtaW5BY3Rpb24iLCJyZXF1aXJlQWRtaW5BdXRoIiwidmFsaWRhdGVJbnB1dCIsIndpdGhBZG1pbkF1dGgiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZVNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwic3VwYWJhc2VBZG1pbiIsImNyZWF0ZUNsaWVudCIsInJhdGVMaW1pdE1hcCIsIk1hcCIsImNoZWNrUmF0ZUxpbWl0IiwiaWRlbnRpZmllciIsIm1heFJlcXVlc3RzIiwid2luZG93TXMiLCJub3ciLCJEYXRlIiwia2V5IiwiY3VycmVudCIsImdldCIsInJlc2V0VGltZSIsInNldCIsImNvdW50IiwiZ2V0QXV0aGVudGljYXRlZFVzZXIiLCJyZXF1ZXN0IiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJzdGFydHNXaXRoIiwic3VjY2VzcyIsImVycm9yIiwic3RhdHVzIiwidG9rZW4iLCJzdWJzdHJpbmciLCJjbGVya1BheWxvYWQiLCJ2ZXJpZnlUb2tlbiIsInNlY3JldEtleSIsIkNMRVJLX1NFQ1JFVF9LRVkiLCJzdWIiLCJzdXBhYmFzZSIsImRhdGEiLCJwcm9maWxlIiwicHJvZmlsZUVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiY29uc29sZSIsImNsZXJrVXNlcklkIiwibWVzc2FnZSIsImxvZyIsImVtYWlsIiwicm9sZSIsInVzZXJfcm9sZXMiLCJyb2xlX25hbWUiLCJjbGVya0lkIiwidXNlciIsImlkIiwic3VwYWJhc2VfdXNlcl9pZCIsImNsZXJrX2lkIiwiaXNBZG1pbiIsInJvbGVOYW1lIiwiY2xlcmtFcnJvciIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiYXV0aEVycm9yIiwiYXV0aCIsImdldFVzZXIiLCJwZXJtaXNzaW9ucyIsImNsaWVudElQIiwiYXV0aFJlc3VsdCIsImdldEF1dGhlbnRpY2F0ZWRBZG1pbiIsInVzZXJJZCIsIndhcm4iLCJyZXNvdXJjZSIsImFjdGlvbiIsInJlc291cmNlSWQiLCJvbGREYXRhIiwibmV3RGF0YSIsImluc2VydCIsInVzZXJfaWQiLCJyZXNvdXJjZV9pZCIsIm9sZF9kYXRhIiwibmV3X2RhdGEiLCJ0aW1lc3RhbXAiLCJ0b0lTT1N0cmluZyIsImlwX2FkZHJlc3MiLCJ1c2VyX2FnZW50IiwiYWxsb3dlZEZpZWxkcyIsIkVycm9yIiwic2FuaXRpemVkIiwiZmllbGQiLCJ1bmRlZmluZWQiLCJoYW5kbGVyIiwiUmVzcG9uc2UiLCJKU09OIiwic3RyaW5naWZ5Iiwib25lSG91ckFnbyIsInJhdGVMaW1pdFN0YXRzIiwiQXJyYXkiLCJlbnRyaWVzIiwiZmlsdGVyIiwiXyIsInJlZHVjZSIsImFjYyIsImlwIiwidG90YWxSZXF1ZXN0cyIsInVuaXF1ZUlQcyIsInJhdGVMaW1pdGluZyJdLCJtYXBwaW5ncyI6IkFBQUE7OztDQUdDOzs7Ozs7Ozs7OztJQTBRcUJBLGVBQWU7ZUFBZkE7O0lBOEdBQyxrQkFBa0I7ZUFBbEJBOztJQXpFQUMsY0FBYztlQUFkQTs7SUF0R0FDLGdCQUFnQjtlQUFoQkE7O0lBb0lOQyxhQUFhO2VBQWJBOztJQW1CQUMsYUFBYTtlQUFiQTs7OzRCQTdWYTt5QkFDRDsyQkFDVTtBQUV0QyxNQUFNQyxjQUFjQyxRQUFRQyxHQUFHLENBQUNDLHdCQUF3QjtBQUN4RCxNQUFNQyxxQkFBcUJILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRWhFLDhDQUE4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