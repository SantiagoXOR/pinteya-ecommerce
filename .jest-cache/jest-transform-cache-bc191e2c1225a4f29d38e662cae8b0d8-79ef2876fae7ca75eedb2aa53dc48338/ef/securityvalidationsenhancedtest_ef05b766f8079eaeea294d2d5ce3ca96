036ea5cdb252f786351769095c5ecb20
/**
 * Tests para las validaciones de seguridad mejoradas
 * Verifica JWT validation, CSRF protection, Rate limiting
 */ // Mock de Clerk
"use strict";
jest.mock('@clerk/nextjs/server', ()=>({
        getAuth: jest.fn(),
        auth: jest.fn()
    }));
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _jwtvalidation = require("../lib/auth/jwt-validation");
const _csrfprotection = require("../lib/auth/csrf-protection");
const _ratelimiting = require("../lib/auth/rate-limiting");
const _server = require("@clerk/nextjs/server");
describe('Validaciones de Seguridad Mejoradas', ()=>{
    let mockGetAuth;
    let mockAuth;
    beforeEach(()=>{
        mockGetAuth = _server.getAuth;
        mockAuth = _server.auth;
        jest.clearAllMocks();
    });
    describe('Validación JWT', ()=>{
        it('debe validar token JWT válido', async ()=>{
            const mockRequest = {
                query: {},
                headers: {}
            };
            mockGetAuth.mockReturnValue({
                userId: 'user_123',
                sessionId: 'sess_123',
                getToken: jest.fn().mockResolvedValue('eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyXzEyMyIsImlzcyI6ImNsZXJrIiwiYXVkIjoidGVzdCIsImV4cCI6OTk5OTk5OTk5OSwiaWF0IjoxNjQwOTk1MjAwLCJtZXRhZGF0YSI6eyJyb2xlIjoiYWRtaW4ifX0.signature')
            });
            const result = await (0, _jwtvalidation.validateJWTIntegrity)(mockRequest);
            expect(result.valid).toBe(true);
            expect(result.payload).toBeDefined();
            expect(result.details?.subject).toBe('user_123');
        });
        it('debe rechazar token JWT inválido', async ()=>{
            const mockRequest = {
                query: {},
                headers: {}
            };
            mockGetAuth.mockReturnValue({
                userId: 'user_123',
                sessionId: 'sess_123',
                getToken: jest.fn().mockResolvedValue('invalid_token')
            });
            const result = await (0, _jwtvalidation.validateJWTIntegrity)(mockRequest);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Formato de token JWT inválido');
            expect(result.code).toBe('INVALID_TOKEN_FORMAT');
        });
        it('debe validar permisos en JWT', async ()=>{
            const mockRequest = {
                query: {},
                headers: {}
            };
            mockGetAuth.mockReturnValue({
                userId: 'user_123',
                sessionId: 'sess_123',
                getToken: jest.fn().mockResolvedValue('eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyXzEyMyIsImlzcyI6ImNsZXJrIiwiYXVkIjoidGVzdCIsImV4cCI6OTk5OTk5OTk5OSwiaWF0IjoxNjQwOTk1MjAwLCJtZXRhZGF0YSI6eyJyb2xlIjoiYWRtaW4iLCJwZXJtaXNzaW9ucyI6WyJhZG1pbl9hY2Nlc3MiXX19.signature')
            });
            const result = await (0, _jwtvalidation.validateJWTPermissions)('admin', [
                'admin_access'
            ], mockRequest);
            expect(result.valid).toBe(true);
            expect(result.payload?.metadata?.role).toBe('admin');
        });
        it('debe rechazar permisos insuficientes en JWT', async ()=>{
            const mockRequest = {
                query: {},
                headers: {}
            };
            mockGetAuth.mockReturnValue({
                userId: 'user_123',
                sessionId: 'sess_123',
                getToken: jest.fn().mockResolvedValue('eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyXzEyMyIsImlzcyI6ImNsZXJrIiwiYXVkIjoidGVzdCIsImV4cCI6OTk5OTk5OTk5OSwiaWF0IjoxNjQwOTk1MjAwLCJtZXRhZGF0YSI6eyJyb2xlIjoidXNlciJ9fQ.signature')
            });
            const result = await (0, _jwtvalidation.validateJWTPermissions)('admin', [
                'admin_access'
            ], mockRequest);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Rol requerido: admin');
            expect(result.code).toBe('INSUFFICIENT_ROLE');
        });
    });
    describe('Protección CSRF', ()=>{
        it('debe permitir requests GET sin validación estricta', async ()=>{
            const mockRequest = {
                method: 'GET',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            const result = await (0, _csrfprotection.validateRequestOrigin)(mockRequest);
            expect(result.valid).toBe(true);
        });
        it('debe validar origen para requests POST', async ()=>{
            // Mock NODE_ENV para desarrollo para que sea menos estricto
            const originalEnv = process.env.NODE_ENV;
            process.env.NODE_ENV = 'development';
            const mockRequest = {
                method: 'POST',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'origin') return 'http://localhost:3000';
                        if (header === 'referer') return 'http://localhost:3000/admin';
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            const result = await (0, _csrfprotection.validateRequestOrigin)(mockRequest);
            expect(result.valid).toBe(true);
            // Restaurar NODE_ENV
            process.env.NODE_ENV = originalEnv;
        });
        it('debe rechazar origen no permitido', async ()=>{
            const mockRequest = {
                method: 'POST',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'origin') return 'http://malicious-site.com';
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            const result = await (0, _csrfprotection.validateRequestOrigin)(mockRequest);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('Origen no permitido');
            expect(result.code).toBe('INVALID_ORIGIN');
        });
        it('debe detectar User-Agent sospechoso', async ()=>{
            // Forzar modo producción para validación estricta
            const originalEnv = process.env.NODE_ENV;
            process.env.NODE_ENV = 'production';
            const mockRequest = {
                method: 'POST',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'origin') return process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';
                        if (header === 'referer') return process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';
                        if (header === 'user-agent') return 'curl/7.68.0';
                        return null;
                    })
                }
            };
            const result = await (0, _csrfprotection.validateRequestOrigin)(mockRequest);
            expect(result.valid).toBe(false);
            expect(result.error).toContain('User-Agent sospechoso');
            expect(result.code).toBe('SUSPICIOUS_USER_AGENT');
            // Restaurar NODE_ENV
            process.env.NODE_ENV = originalEnv;
        });
    });
    describe('Rate Limiting', ()=>{
        it('debe permitir requests dentro del límite', async ()=>{
            const mockRequest = {
                method: 'GET',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'x-forwarded-for') return '192.168.1.1';
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            const result = await (0, _ratelimiting.checkRateLimit)(mockRequest, _ratelimiting.RATE_LIMIT_CONFIGS.general, 'test');
            expect(result.allowed).toBe(true);
            expect(result.remaining).toBeLessThan(result.limit);
        });
        it('debe rechazar requests que excedan el límite', async ()=>{
            const mockRequest = {
                method: 'POST',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'x-forwarded-for') return '192.168.1.2';
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            // Simular múltiples requests
            const config = {
                windowMs: 60000,
                maxRequests: 2,
                message: 'Rate limit exceeded'
            };
            // Primera request - debe pasar
            const result1 = await (0, _ratelimiting.checkRateLimit)(mockRequest, config, 'test_limit');
            expect(result1.allowed).toBe(true);
            // Segunda request - debe pasar
            const result2 = await (0, _ratelimiting.checkRateLimit)(mockRequest, config, 'test_limit');
            expect(result2.allowed).toBe(true);
            // Tercera request - debe fallar
            const result3 = await (0, _ratelimiting.checkRateLimit)(mockRequest, config, 'test_limit');
            expect(result3.allowed).toBe(false);
            expect(result3.error).toBe('Rate limit exceeded');
            expect(result3.code).toBe('RATE_LIMIT_EXCEEDED');
        });
        it('debe proporcionar información de rate limiting', async ()=>{
            const mockRequest = {
                method: 'GET',
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'x-forwarded-for') return '192.168.1.3';
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        return null;
                    })
                }
            };
            const result = await (0, _ratelimiting.checkRateLimit)(mockRequest, _ratelimiting.RATE_LIMIT_CONFIGS.admin, 'test_info');
            expect(result).toHaveProperty('limit');
            expect(result).toHaveProperty('remaining');
            expect(result).toHaveProperty('resetTime');
            expect(typeof result.limit).toBe('number');
            expect(typeof result.remaining).toBe('number');
            expect(typeof result.resetTime).toBe('number');
        });
    });
    describe('Integración de validaciones', ()=>{
        it('debe combinar todas las validaciones correctamente', async ()=>{
            // Test que verifica que todas las validaciones pueden trabajar juntas
            const mockRequest = {
                method: 'POST',
                query: {},
                headers: {
                    get: jest.fn().mockImplementation((header)=>{
                        if (header === 'origin') return 'http://localhost:3000';
                        if (header === 'referer') return 'http://localhost:3000/admin';
                        if (header === 'user-agent') return 'Mozilla/5.0 Test Browser';
                        if (header === 'x-forwarded-for') return '192.168.1.4';
                        return null;
                    })
                }
            };
            mockGetAuth.mockReturnValue({
                userId: 'user_123',
                sessionId: 'sess_123',
                getToken: jest.fn().mockResolvedValue('eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyXzEyMyIsImlzcyI6ImNsZXJrIiwiYXVkIjoidGVzdCIsImV4cCI6OTk5OTk5OTk5OSwiaWF0IjoxNjQwOTk1MjAwLCJtZXRhZGF0YSI6eyJyb2xlIjoiYWRtaW4ifX0.signature')
            });
            // Validar JWT
            const jwtResult = await (0, _jwtvalidation.validateJWTIntegrity)(mockRequest);
            expect(jwtResult.valid).toBe(true);
            // Validar CSRF
            const csrfResult = await (0, _csrfprotection.validateRequestOrigin)(mockRequest);
            expect(csrfResult.valid).toBe(true);
            // Validar Rate Limiting
            const rateLimitResult = await (0, _ratelimiting.checkRateLimit)(mockRequest, _ratelimiting.RATE_LIMIT_CONFIGS.admin, 'integration_test');
            expect(rateLimitResult.allowed).toBe(true);
            // Todas las validaciones deben pasar
            expect(jwtResult.valid && csrfResult.valid && rateLimitResult.allowed).toBe(true);
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcX190ZXN0c19fXFxzZWN1cml0eS12YWxpZGF0aW9ucy1lbmhhbmNlZC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgcGFyYSBsYXMgdmFsaWRhY2lvbmVzIGRlIHNlZ3VyaWRhZCBtZWpvcmFkYXNcbiAqIFZlcmlmaWNhIEpXVCB2YWxpZGF0aW9uLCBDU1JGIHByb3RlY3Rpb24sIFJhdGUgbGltaXRpbmdcbiAqL1xuXG4vLyBNb2NrIGRlIENsZXJrXG5qZXN0Lm1vY2soJ0BjbGVyay9uZXh0anMvc2VydmVyJywgKCkgPT4gKHtcbiAgZ2V0QXV0aDogamVzdC5mbigpLFxuICBhdXRoOiBqZXN0LmZuKClcbn0pKTtcblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0IH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQge1xuICB2YWxpZGF0ZUpXVEludGVncml0eSxcbiAgdmFsaWRhdGVKV1RQZXJtaXNzaW9uc1xufSBmcm9tICdAL2xpYi9hdXRoL2p3dC12YWxpZGF0aW9uJztcbmltcG9ydCB7XG4gIHZhbGlkYXRlUmVxdWVzdE9yaWdpblxufSBmcm9tICdAL2xpYi9hdXRoL2NzcmYtcHJvdGVjdGlvbic7XG5pbXBvcnQge1xuICBjaGVja1JhdGVMaW1pdCxcbiAgUkFURV9MSU1JVF9DT05GSUdTXG59IGZyb20gJ0AvbGliL2F1dGgvcmF0ZS1saW1pdGluZyc7XG5pbXBvcnQgeyBnZXRBdXRoLCBhdXRoIH0gZnJvbSAnQGNsZXJrL25leHRqcy9zZXJ2ZXInO1xuXG5kZXNjcmliZSgnVmFsaWRhY2lvbmVzIGRlIFNlZ3VyaWRhZCBNZWpvcmFkYXMnLCAoKSA9PiB7XG4gIGxldCBtb2NrR2V0QXV0aDogamVzdC5Nb2NrZWRGdW5jdGlvbjx0eXBlb2YgZ2V0QXV0aD47XG4gIGxldCBtb2NrQXV0aDogamVzdC5Nb2NrZWRGdW5jdGlvbjx0eXBlb2YgYXV0aD47XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja0dldEF1dGggPSBnZXRBdXRoIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIGdldEF1dGg+O1xuICAgIG1vY2tBdXRoID0gYXV0aCBhcyBqZXN0Lk1vY2tlZEZ1bmN0aW9uPHR5cGVvZiBhdXRoPjtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1ZhbGlkYWNpw7NuIEpXVCcsICgpID0+IHtcbiAgICBpdCgnZGViZSB2YWxpZGFyIHRva2VuIEpXVCB2w6FsaWRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIHF1ZXJ5OiB7fSxcbiAgICAgICAgaGVhZGVyczoge31cbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBtb2NrR2V0QXV0aC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB1c2VySWQ6ICd1c2VyXzEyMycsXG4gICAgICAgIHNlc3Npb25JZDogJ3Nlc3NfMTIzJyxcbiAgICAgICAgZ2V0VG9rZW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnZXlKaGJHY2lPaUpTVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lKMWMyVnlYekV5TXlJc0ltbHpjeUk2SW1Oc1pYSnJJaXdpWVhWa0lqb2lkR1Z6ZENJc0ltVjRjQ0k2T1RrNU9UazVPVGs1T1N3aWFXRjBJam94TmpRd09UazFNakF3TENKdFpYUmhaR0YwWVNJNmV5SnliMnhsSWpvaVlXUnRhVzRpZlgwLnNpZ25hdHVyZScpXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVKV1RJbnRlZ3JpdHkobW9ja1JlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wYXlsb2FkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXRhaWxzPy5zdWJqZWN0KS50b0JlKCd1c2VyXzEyMycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgcmVjaGF6YXIgdG9rZW4gSldUIGludsOhbGlkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBxdWVyeToge30sXG4gICAgICAgIGhlYWRlcnM6IHt9XG4gICAgICB9IGFzIGFueTtcblxuICAgICAgbW9ja0dldEF1dGgubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgdXNlcklkOiAndXNlcl8xMjMnLFxuICAgICAgICBzZXNzaW9uSWQ6ICdzZXNzXzEyMycsXG4gICAgICAgIGdldFRva2VuOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJ2ludmFsaWRfdG9rZW4nKVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlSldUSW50ZWdyaXR5KG1vY2tSZXF1ZXN0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0NvbnRhaW4oJ0Zvcm1hdG8gZGUgdG9rZW4gSldUIGludsOhbGlkbycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb2RlKS50b0JlKCdJTlZBTElEX1RPS0VOX0ZPUk1BVCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgdmFsaWRhciBwZXJtaXNvcyBlbiBKV1QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgcXVlcnk6IHt9LFxuICAgICAgICBoZWFkZXJzOiB7fVxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIG1vY2tHZXRBdXRoLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHVzZXJJZDogJ3VzZXJfMTIzJyxcbiAgICAgICAgc2Vzc2lvbklkOiAnc2Vzc18xMjMnLFxuICAgICAgICBnZXRUb2tlbjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdleUpoYkdjaU9pSlNVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKemRXSWlPaUoxYzJWeVh6RXlNeUlzSW1semN5STZJbU5zWlhKcklpd2lZWFZrSWpvaWRHVnpkQ0lzSW1WNGNDSTZPVGs1T1RrNU9UazVPU3dpYVdGMElqb3hOalF3T1RrMU1qQXdMQ0p0WlhSaFpHRjBZU0k2ZXlKeWIyeGxJam9pWVdSdGFXNGlMQ0p3WlhKdGFYTnphVzl1Y3lJNld5SmhaRzFwYmw5aFkyTmxjM01pWFgxOS5zaWduYXR1cmUnKVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlSldUUGVybWlzc2lvbnMoXG4gICAgICAgICdhZG1pbicsXG4gICAgICAgIFsnYWRtaW5fYWNjZXNzJ10sXG4gICAgICAgIG1vY2tSZXF1ZXN0XG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wYXlsb2FkPy5tZXRhZGF0YT8ucm9sZSkudG9CZSgnYWRtaW4nKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWJlIHJlY2hhemFyIHBlcm1pc29zIGluc3VmaWNpZW50ZXMgZW4gSldUJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIHF1ZXJ5OiB7fSxcbiAgICAgICAgaGVhZGVyczoge31cbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBtb2NrR2V0QXV0aC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB1c2VySWQ6ICd1c2VyXzEyMycsXG4gICAgICAgIHNlc3Npb25JZDogJ3Nlc3NfMTIzJyxcbiAgICAgICAgZ2V0VG9rZW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnZXlKaGJHY2lPaUpTVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lKMWMyVnlYekV5TXlJc0ltbHpjeUk2SW1Oc1pYSnJJaXdpWVhWa0lqb2lkR1Z6ZENJc0ltVjRjQ0k2T1RrNU9UazVPVGs1T1N3aWFXRjBJam94TmpRd09UazFNakF3TENKdFpYUmhaR0YwWVNJNmV5SnliMnhsSWpvaWRYTmxjaUo5ZlEuc2lnbmF0dXJlJylcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZUpXVFBlcm1pc3Npb25zKFxuICAgICAgICAnYWRtaW4nLFxuICAgICAgICBbJ2FkbWluX2FjY2VzcyddLFxuICAgICAgICBtb2NrUmVxdWVzdFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0NvbnRhaW4oJ1JvbCByZXF1ZXJpZG86IGFkbWluJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvZGUpLnRvQmUoJ0lOU1VGRklDSUVOVF9ST0xFJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQcm90ZWNjacOzbiBDU1JGJywgKCkgPT4ge1xuICAgIGl0KCdkZWJlIHBlcm1pdGlyIHJlcXVlc3RzIEdFVCBzaW4gdmFsaWRhY2nDs24gZXN0cmljdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGVhZGVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAndXNlci1hZ2VudCcpIHJldHVybiAnTW96aWxsYS81LjAgVGVzdCBCcm93c2VyJztcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZVJlcXVlc3RPcmlnaW4obW9ja1JlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgdmFsaWRhciBvcmlnZW4gcGFyYSByZXF1ZXN0cyBQT1NUJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBOT0RFX0VOViBwYXJhIGRlc2Fycm9sbG8gcGFyYSBxdWUgc2VhIG1lbm9zIGVzdHJpY3RvXG4gICAgICBjb25zdCBvcmlnaW5hbEVudiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WO1xuICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAnZGV2ZWxvcG1lbnQnO1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGhlYWRlcikgPT4ge1xuICAgICAgICAgICAgaWYgKGhlYWRlciA9PT0gJ29yaWdpbicpIHJldHVybiAnaHR0cDovL2xvY2FsaG9zdDozMDAwJztcbiAgICAgICAgICAgIGlmIChoZWFkZXIgPT09ICdyZWZlcmVyJykgcmV0dXJuICdodHRwOi8vbG9jYWxob3N0OjMwMDAvYWRtaW4nO1xuICAgICAgICAgICAgaWYgKGhlYWRlciA9PT0gJ3VzZXItYWdlbnQnKSByZXR1cm4gJ01vemlsbGEvNS4wIFRlc3QgQnJvd3Nlcic7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9IGFzIGFueTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVSZXF1ZXN0T3JpZ2luKG1vY2tSZXF1ZXN0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gUmVzdGF1cmFyIE5PREVfRU5WXG4gICAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9IG9yaWdpbmFsRW52O1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgcmVjaGF6YXIgb3JpZ2VuIG5vIHBlcm1pdGlkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGVhZGVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAnb3JpZ2luJykgcmV0dXJuICdodHRwOi8vbWFsaWNpb3VzLXNpdGUuY29tJztcbiAgICAgICAgICAgIGlmIChoZWFkZXIgPT09ICd1c2VyLWFnZW50JykgcmV0dXJuICdNb3ppbGxhLzUuMCBUZXN0IEJyb3dzZXInO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlUmVxdWVzdE9yaWdpbihtb2NrUmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9Db250YWluKCdPcmlnZW4gbm8gcGVybWl0aWRvJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvZGUpLnRvQmUoJ0lOVkFMSURfT1JJR0lOJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGViZSBkZXRlY3RhciBVc2VyLUFnZW50IHNvc3BlY2hvc28nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBGb3J6YXIgbW9kbyBwcm9kdWNjacOzbiBwYXJhIHZhbGlkYWNpw7NuIGVzdHJpY3RhXG4gICAgICBjb25zdCBvcmlnaW5hbEVudiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WO1xuICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAncHJvZHVjdGlvbic7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGVhZGVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAnb3JpZ2luJykgcmV0dXJuIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQUF9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCc7XG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAncmVmZXJlcicpIHJldHVybiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUFBfVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnO1xuICAgICAgICAgICAgaWYgKGhlYWRlciA9PT0gJ3VzZXItYWdlbnQnKSByZXR1cm4gJ2N1cmwvNy42OC4wJztcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0ZVJlcXVlc3RPcmlnaW4obW9ja1JlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQ29udGFpbignVXNlci1BZ2VudCBzb3NwZWNob3NvJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvZGUpLnRvQmUoJ1NVU1BJQ0lPVVNfVVNFUl9BR0VOVCcpO1xuXG4gICAgICAvLyBSZXN0YXVyYXIgTk9ERV9FTlZcbiAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gb3JpZ2luYWxFbnY7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSYXRlIExpbWl0aW5nJywgKCkgPT4ge1xuICAgIGl0KCdkZWJlIHBlcm1pdGlyIHJlcXVlc3RzIGRlbnRybyBkZWwgbMOtbWl0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChoZWFkZXIpID0+IHtcbiAgICAgICAgICAgIGlmIChoZWFkZXIgPT09ICd4LWZvcndhcmRlZC1mb3InKSByZXR1cm4gJzE5Mi4xNjguMS4xJztcbiAgICAgICAgICAgIGlmIChoZWFkZXIgPT09ICd1c2VyLWFnZW50JykgcmV0dXJuICdNb3ppbGxhLzUuMCBUZXN0IEJyb3dzZXInO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNoZWNrUmF0ZUxpbWl0KFxuICAgICAgICBtb2NrUmVxdWVzdCxcbiAgICAgICAgUkFURV9MSU1JVF9DT05GSUdTLmdlbmVyYWwsXG4gICAgICAgICd0ZXN0J1xuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5hbGxvd2VkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZW1haW5pbmcpLnRvQmVMZXNzVGhhbihyZXN1bHQubGltaXQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgcmVjaGF6YXIgcmVxdWVzdHMgcXVlIGV4Y2VkYW4gZWwgbMOtbWl0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGVhZGVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAneC1mb3J3YXJkZWQtZm9yJykgcmV0dXJuICcxOTIuMTY4LjEuMic7XG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAndXNlci1hZ2VudCcpIHJldHVybiAnTW96aWxsYS81LjAgVGVzdCBCcm93c2VyJztcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICAvLyBTaW11bGFyIG3Dumx0aXBsZXMgcmVxdWVzdHNcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgd2luZG93TXM6IDYwMDAwLFxuICAgICAgICBtYXhSZXF1ZXN0czogMixcbiAgICAgICAgbWVzc2FnZTogJ1JhdGUgbGltaXQgZXhjZWVkZWQnXG4gICAgICB9O1xuXG4gICAgICAvLyBQcmltZXJhIHJlcXVlc3QgLSBkZWJlIHBhc2FyXG4gICAgICBjb25zdCByZXN1bHQxID0gYXdhaXQgY2hlY2tSYXRlTGltaXQobW9ja1JlcXVlc3QsIGNvbmZpZywgJ3Rlc3RfbGltaXQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQxLmFsbG93ZWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIFNlZ3VuZGEgcmVxdWVzdCAtIGRlYmUgcGFzYXJcbiAgICAgIGNvbnN0IHJlc3VsdDIgPSBhd2FpdCBjaGVja1JhdGVMaW1pdChtb2NrUmVxdWVzdCwgY29uZmlnLCAndGVzdF9saW1pdCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdDIuYWxsb3dlZCkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gVGVyY2VyYSByZXF1ZXN0IC0gZGViZSBmYWxsYXJcbiAgICAgIGNvbnN0IHJlc3VsdDMgPSBhd2FpdCBjaGVja1JhdGVMaW1pdChtb2NrUmVxdWVzdCwgY29uZmlnLCAndGVzdF9saW1pdCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdDMuYWxsb3dlZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0My5lcnJvcikudG9CZSgnUmF0ZSBsaW1pdCBleGNlZWRlZCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdDMuY29kZSkudG9CZSgnUkFURV9MSU1JVF9FWENFRURFRCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlYmUgcHJvcG9yY2lvbmFyIGluZm9ybWFjacOzbiBkZSByYXRlIGxpbWl0aW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGhlYWRlcikgPT4ge1xuICAgICAgICAgICAgaWYgKGhlYWRlciA9PT0gJ3gtZm9yd2FyZGVkLWZvcicpIHJldHVybiAnMTkyLjE2OC4xLjMnO1xuICAgICAgICAgICAgaWYgKGhlYWRlciA9PT0gJ3VzZXItYWdlbnQnKSByZXR1cm4gJ01vemlsbGEvNS4wIFRlc3QgQnJvd3Nlcic7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9IGFzIGFueTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2hlY2tSYXRlTGltaXQoXG4gICAgICAgIG1vY2tSZXF1ZXN0LFxuICAgICAgICBSQVRFX0xJTUlUX0NPTkZJR1MuYWRtaW4sXG4gICAgICAgICd0ZXN0X2luZm8nXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnbGltaXQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdyZW1haW5pbmcnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdyZXNldFRpbWUnKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmxpbWl0KS50b0JlKCdudW1iZXInKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LnJlbWFpbmluZykudG9CZSgnbnVtYmVyJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5yZXNldFRpbWUpLnRvQmUoJ251bWJlcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW50ZWdyYWNpw7NuIGRlIHZhbGlkYWNpb25lcycsICgpID0+IHtcbiAgICBpdCgnZGViZSBjb21iaW5hciB0b2RhcyBsYXMgdmFsaWRhY2lvbmVzIGNvcnJlY3RhbWVudGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHF1ZSB2ZXJpZmljYSBxdWUgdG9kYXMgbGFzIHZhbGlkYWNpb25lcyBwdWVkZW4gdHJhYmFqYXIganVudGFzXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIHF1ZXJ5OiB7fSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaGVhZGVyKSA9PiB7XG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAnb3JpZ2luJykgcmV0dXJuICdodHRwOi8vbG9jYWxob3N0OjMwMDAnO1xuICAgICAgICAgICAgaWYgKGhlYWRlciA9PT0gJ3JlZmVyZXInKSByZXR1cm4gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hZG1pbic7XG4gICAgICAgICAgICBpZiAoaGVhZGVyID09PSAndXNlci1hZ2VudCcpIHJldHVybiAnTW96aWxsYS81LjAgVGVzdCBCcm93c2VyJztcbiAgICAgICAgICAgIGlmIChoZWFkZXIgPT09ICd4LWZvcndhcmRlZC1mb3InKSByZXR1cm4gJzE5Mi4xNjguMS40JztcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBtb2NrR2V0QXV0aC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICB1c2VySWQ6ICd1c2VyXzEyMycsXG4gICAgICAgIHNlc3Npb25JZDogJ3Nlc3NfMTIzJyxcbiAgICAgICAgZ2V0VG9rZW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnZXlKaGJHY2lPaUpTVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lKMWMyVnlYekV5TXlJc0ltbHpjeUk2SW1Oc1pYSnJJaXdpWVhWa0lqb2lkR1Z6ZENJc0ltVjRjQ0k2T1RrNU9UazVPVGs1T1N3aWFXRjBJam94TmpRd09UazFNakF3TENKdFpYUmhaR0YwWVNJNmV5SnliMnhsSWpvaVlXUnRhVzRpZlgwLnNpZ25hdHVyZScpXG4gICAgICB9KTtcblxuICAgICAgLy8gVmFsaWRhciBKV1RcbiAgICAgIGNvbnN0IGp3dFJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlSldUSW50ZWdyaXR5KG1vY2tSZXF1ZXN0KTtcbiAgICAgIGV4cGVjdChqd3RSZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIFZhbGlkYXIgQ1NSRlxuICAgICAgY29uc3QgY3NyZlJlc3VsdCA9IGF3YWl0IHZhbGlkYXRlUmVxdWVzdE9yaWdpbihtb2NrUmVxdWVzdCk7XG4gICAgICBleHBlY3QoY3NyZlJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gVmFsaWRhciBSYXRlIExpbWl0aW5nXG4gICAgICBjb25zdCByYXRlTGltaXRSZXN1bHQgPSBhd2FpdCBjaGVja1JhdGVMaW1pdChcbiAgICAgICAgbW9ja1JlcXVlc3QsXG4gICAgICAgIFJBVEVfTElNSVRfQ09ORklHUy5hZG1pbixcbiAgICAgICAgJ2ludGVncmF0aW9uX3Rlc3QnXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJhdGVMaW1pdFJlc3VsdC5hbGxvd2VkKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBUb2RhcyBsYXMgdmFsaWRhY2lvbmVzIGRlYmVuIHBhc2FyXG4gICAgICBleHBlY3Qoand0UmVzdWx0LnZhbGlkICYmIGNzcmZSZXN1bHQudmFsaWQgJiYgcmF0ZUxpbWl0UmVzdWx0LmFsbG93ZWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJnZXRBdXRoIiwiZm4iLCJhdXRoIiwiZGVzY3JpYmUiLCJtb2NrR2V0QXV0aCIsIm1vY2tBdXRoIiwiYmVmb3JlRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJpdCIsIm1vY2tSZXF1ZXN0IiwicXVlcnkiLCJoZWFkZXJzIiwibW9ja1JldHVyblZhbHVlIiwidXNlcklkIiwic2Vzc2lvbklkIiwiZ2V0VG9rZW4iLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInJlc3VsdCIsInZhbGlkYXRlSldUSW50ZWdyaXR5IiwiZXhwZWN0IiwidmFsaWQiLCJ0b0JlIiwicGF5bG9hZCIsInRvQmVEZWZpbmVkIiwiZGV0YWlscyIsInN1YmplY3QiLCJlcnJvciIsInRvQ29udGFpbiIsImNvZGUiLCJ2YWxpZGF0ZUpXVFBlcm1pc3Npb25zIiwibWV0YWRhdGEiLCJyb2xlIiwibWV0aG9kIiwiZ2V0IiwibW9ja0ltcGxlbWVudGF0aW9uIiwiaGVhZGVyIiwidmFsaWRhdGVSZXF1ZXN0T3JpZ2luIiwib3JpZ2luYWxFbnYiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJORVhUX1BVQkxJQ19BUFBfVVJMIiwiY2hlY2tSYXRlTGltaXQiLCJSQVRFX0xJTUlUX0NPTkZJR1MiLCJnZW5lcmFsIiwiYWxsb3dlZCIsInJlbWFpbmluZyIsInRvQmVMZXNzVGhhbiIsImxpbWl0IiwiY29uZmlnIiwid2luZG93TXMiLCJtYXhSZXF1ZXN0cyIsIm1lc3NhZ2UiLCJyZXN1bHQxIiwicmVzdWx0MiIsInJlc3VsdDMiLCJhZG1pbiIsInRvSGF2ZVByb3BlcnR5IiwicmVzZXRUaW1lIiwiand0UmVzdWx0IiwiY3NyZlJlc3VsdCIsInJhdGVMaW1pdFJlc3VsdCJdLCJtYXBwaW5ncyI6IkFBQUE7OztDQUdDLEdBRUQsZ0JBQWdCOztBQUNoQkEsS0FBS0MsSUFBSSxDQUFDLHdCQUF3QixJQUFPLENBQUE7UUFDdkNDLFNBQVNGLEtBQUtHLEVBQUU7UUFDaEJDLE1BQU1KLEtBQUtHLEVBQUU7SUFDZixDQUFBOzs7OytCQU9PO2dDQUdBOzhCQUlBO3dCQUN1QjtBQUU5QkUsU0FBUyx1Q0FBdUM7SUFDOUMsSUFBSUM7SUFDSixJQUFJQztJQUVKQyxXQUFXO1FBQ1RG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