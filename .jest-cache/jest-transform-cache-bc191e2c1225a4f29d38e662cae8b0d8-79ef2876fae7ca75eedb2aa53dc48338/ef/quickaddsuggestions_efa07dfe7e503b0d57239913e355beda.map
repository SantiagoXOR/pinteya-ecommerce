{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\components\\ui\\quick-add-suggestions.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus, Star, Loader2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { getProducts } from \"@/lib/api/products\";\nimport { ProductWithCategory } from \"@/types/api\";\nimport { getValidImageUrl } from \"@/lib/adapters/product-adapter\";\nimport Image from \"next/image\";\nimport { useDispatch } from \"react-redux\";\nimport { AppDispatch } from \"@/redux/store\";\nimport { addItemToCart } from \"@/redux/features/cart-slice\";\n\ninterface QuickAddSuggestionsProps {\n  onAddToCart?: (productId: string) => void;\n  onClose?: () => void;\n  className?: string;\n}\n\nconst QuickAddSuggestions: React.FC<QuickAddSuggestionsProps> = ({\n  onAddToCart,\n  onClose,\n  className\n}) => {\n  const [products, setProducts] = useState<ProductWithCategory[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const dispatch = useDispatch<AppDispatch>();\n\n  useEffect(() => {\n    const abortController = new AbortController();\n\n    const fetchPopularProducts = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n\n        // Obtener productos con descuento (populares) limitados a 3\n        const response = await getProducts({\n          limit: 3,\n          sortBy: 'created_at',\n          sortOrder: 'desc'\n        }, abortController.signal);\n\n        // Verificar si el componente aún está montado\n        if (abortController.signal.aborted) {\n          return;\n        }\n\n        if (response.success && response.data) {\n          setProducts(response.data);\n        } else {\n          setError('No se pudieron cargar los productos');\n        }\n      } catch (err) {\n        // Solo mostrar error si no fue cancelado\n        if (!abortController.signal.aborted && err instanceof Error && err.name !== 'AbortError') {\n          console.error('Error fetching popular products:', err);\n          setError('Error al cargar productos populares');\n        }\n      } finally {\n        // Solo actualizar loading si no fue cancelado\n        if (!abortController.signal.aborted) {\n          setLoading(false);\n        }\n      }\n    };\n\n    fetchPopularProducts();\n\n    // Cleanup: cancelar la request si el componente se desmonta\n    return () => {\n      abortController.abort();\n    };\n  }, []);\n\n  const handleAddToCart = (productId: string) => {\n    // Buscar el producto en la lista\n    const product = products.find(p => p.id.toString() === productId);\n\n    if (product) {\n      // Convertir el producto al formato esperado por el carrito\n      const cartItem = {\n        id: product.id,\n        title: product.name,\n        brand: product.brand || '',\n        price: product.price,\n        discountedPrice: product.discounted_price || product.price,\n        imgs: {\n          thumbnails: product.images ? [product.images[0]] : [],\n          previews: product.images || []\n        },\n        reviews: 0, // No tenemos reviews en la API actual\n        quantity: 1\n      };\n\n      dispatch(addItemToCart(cartItem));\n    }\n\n    // Llamar callback personalizado si existe\n    if (onAddToCart) {\n      onAddToCart(productId);\n    }\n  };\n\n  return (\n    <div className={cn(\"bg-white rounded-xl border border-gray-200 p-4\", className)}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4\">\n        <div>\n          <h4 className=\"font-bold text-gray-900 text-sm\">Productos Populares</h4>\n          <p className=\"text-xs text-gray-600\">Agrega rápidamente a tu carrito</p>\n        </div>\n      </div>\n\n      {/* Lista de productos */}\n      <div className=\"space-y-3\">\n        {loading ? (\n          <div className=\"flex items-center justify-center py-8\">\n            <Loader2 className=\"w-6 h-6 animate-spin text-gray-400\" />\n            <span className=\"ml-2 text-sm text-gray-500\">Cargando productos...</span>\n          </div>\n        ) : error ? (\n          <div className=\"text-center py-4\">\n            <p className=\"text-sm text-red-500\">{error}</p>\n          </div>\n        ) : products.length === 0 ? (\n          <div className=\"text-center py-4\">\n            <p className=\"text-sm text-gray-500\">No hay productos disponibles</p>\n          </div>\n        ) : (\n          products.map((product) => {\n            const currentPrice = product.discounted_price || product.price;\n            const originalPrice = product.discounted_price ? product.price : null;\n            const hasDiscount = originalPrice && currentPrice < originalPrice;\n\n            return (\n              <div\n                key={product.id}\n                className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200\"\n              >\n                {/* Imagen del producto */}\n                <div className=\"w-16 h-16 bg-gray-200 rounded-xl overflow-hidden flex-shrink-0 shadow-sm border border-gray-300\">\n                  <Image\n                    src={getValidImageUrl(product.images?.[0])}\n                    alt={product.name}\n                    width={64}\n                    height={64}\n                    className=\"w-full h-full object-cover\"\n                  />\n                </div>\n\n                {/* Info del producto */}\n                <div className=\"flex-1 min-w-0\">\n                  <h5 className=\"font-semibold text-xs text-gray-900 line-clamp-1\">\n                    {product.name}\n                  </h5>\n                  <p className=\"text-2xs text-gray-500 mb-1\">{product.brand || 'Sin marca'}</p>\n\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-bold text-sm\" style={{ color: '#ea5a17' }}>\n                      ${currentPrice.toLocaleString()}\n                    </span>\n                    {hasDiscount && (\n                      <span className=\"text-2xs text-gray-400 line-through\">\n                        ${originalPrice!.toLocaleString()}\n                      </span>\n                    )}\n                  </div>\n\n                  {/* Categoría */}\n                  <div className=\"flex items-center gap-1 mt-1\">\n                    <span className=\"text-2xs text-gray-600\">{product.category?.name || 'General'}</span>\n                  </div>\n                </div>\n\n                {/* Botón agregar */}\n                <Button\n                  size=\"sm\"\n                  onClick={() => handleAddToCart(product.id.toString())}\n                  className=\"h-10 w-10 p-0 bg-yellow-400 hover:bg-yellow-500 text-black rounded-xl shadow-md hover:shadow-lg transition-all duration-200\"\n                >\n                  <Plus className=\"w-5 h-5\" />\n                </Button>\n              </div>\n            );\n          })\n        )}\n      </div>\n\n      {/* Footer con enlace a ver más */}\n      <div className=\"mt-4 pt-3 border-t border-gray-200\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={onClose}\n          className=\"w-full text-xs text-gray-600 hover:text-gray-900\"\n        >\n          Ver todos los productos →\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport default QuickAddSuggestions;\n"],"names":["QuickAddSuggestions","onAddToCart","onClose","className","products","setProducts","useState","loading","setLoading","error","setError","dispatch","useDispatch","useEffect","abortController","AbortController","fetchPopularProducts","response","getProducts","limit","sortBy","sortOrder","signal","aborted","success","data","err","Error","name","console","abort","handleAddToCart","productId","product","find","p","id","toString","cartItem","title","brand","price","discountedPrice","discounted_price","imgs","thumbnails","images","previews","reviews","quantity","addItemToCart","div","cn","h4","Loader2","span","length","map","currentPrice","originalPrice","hasDiscount","Image","src","getValidImageUrl","alt","width","height","h5","style","color","toLocaleString","category","Button","size","onClick","Plus","variant"],"mappings":"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"}