{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\components\\Checkout\\index.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nimport Shipping from \"./Shipping\";\r\n\r\nimport PaymentMethod from \"./PaymentMethod\";\r\nimport Billing from \"./Billing\";\r\nimport Coupon from \"./Coupon\";\r\nimport UserInfo from \"./UserInfo\";\r\nimport { useCheckout } from \"@/hooks/useCheckout\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { FormMessage } from \"@/components/ui/form\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport {\r\n  Loader2,\r\n  CreditCard,\r\n  AlertTriangle,\r\n  ShoppingCart,\r\n  Truck,\r\n  CheckCircle,\r\n  User,\r\n  MapPin,\r\n  Shield,\r\n  Phone,\r\n  Mail,\r\n  MessageCircle,\r\n  Zap,\r\n  Gift,\r\n  Star,\r\n  Users,\r\n  Clock,\r\n  Eye,\r\n  TrendingUp\r\n} from \"lucide-react\";\r\nimport MercadoPagoWallet, { MercadoPagoWalletFallback } from \"./MercadoPagoWallet\";\r\nimport { CartSummary } from \"@/components/ui/cart-summary\";\r\nimport {\r\n  UrgencyTimer,\r\n  StockIndicator,\r\n  TrustSignals,\r\n  SocialProof,\r\n  PurchaseIncentives,\r\n  ExitIntentModal\r\n} from \"./ConversionOptimizer\";\r\n\r\nconst Checkout = () => {\r\n  const router = useRouter();\r\n  const [showExitIntent, setShowExitIntent] = useState(false);\r\n  const [isExpressMode, setIsExpressMode] = useState(false);\r\n\r\n  const {\r\n    formData,\r\n    isLoading,\r\n    errors,\r\n    step,\r\n    cartItems,\r\n    totalPrice,\r\n    shippingCost,\r\n    discount,\r\n    finalTotal,\r\n    appliedCoupon,\r\n    applyCoupon,\r\n    updateBillingData,\r\n    updateShippingData,\r\n    updateFormData,\r\n    processCheckout,\r\n    // ✅ Propiedades para Wallet Brick\r\n    preferenceId,\r\n    initPoint,\r\n    handleWalletReady,\r\n    handleWalletError,\r\n    handleWalletSubmit,\r\n  } = useCheckout();\r\n\r\n  // ✅ UNIFICADO: Pasos del checkout\r\n  const checkoutSteps = [\r\n    {\r\n      id: 'info',\r\n      title: 'Información',\r\n      description: 'Datos de contacto y envío',\r\n      icon: User,\r\n      isCompleted: step !== 'form',\r\n      isActive: step === 'form',\r\n    },\r\n    {\r\n      id: 'payment',\r\n      title: 'Pago',\r\n      description: 'Método de pago seguro',\r\n      icon: CreditCard,\r\n      isCompleted: step === 'success',\r\n      isActive: step === 'payment',\r\n    },\r\n    {\r\n      id: 'confirmation',\r\n      title: 'Confirmación',\r\n      description: 'Pedido completado',\r\n      icon: CheckCircle,\r\n      isCompleted: step === 'success',\r\n      isActive: step === 'success',\r\n    },\r\n  ];\r\n\r\n  // Calcular progreso\r\n  const getProgressValue = () => {\r\n    switch (step) {\r\n      case 'form': return 33;\r\n      case 'processing': return 66;\r\n      case 'payment': return 66;\r\n      case 'redirect': return 90;\r\n      case 'success': return 100;\r\n      default: return 0;\r\n    }\r\n  };\r\n\r\n  // ✅ NUEVO: Exit intent detection para conversión\r\n  useEffect(() => {\r\n    const handleMouseLeave = (e: MouseEvent) => {\r\n      if (e.clientY <= 0 && !showExitIntent && step === 'form') {\r\n        setShowExitIntent(true);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mouseleave', handleMouseLeave);\r\n    return () => document.removeEventListener('mouseleave', handleMouseLeave);\r\n  }, [showExitIntent, step]);\r\n\r\n  // Redirigir si el carrito está vacío\r\n  useEffect(() => {\r\n    if (cartItems.length === 0 && step === 'form') {\r\n      router.push('/cart');\r\n    }\r\n  }, [cartItems.length, step, router]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    await processCheckout();\r\n  };\r\n\r\n  const handlePaymentMethodChange = (method: string) => {\r\n    updateFormData({ paymentMethod: method as 'mercadopago' | 'bank' | 'cash' });\r\n  };\r\n\r\n\r\n\r\n  // ✅ NUEVO: Toggle entre modo normal y express\r\n  const toggleExpressMode = () => {\r\n    setIsExpressMode(!isExpressMode);\r\n  };\r\n\r\n  if (step === 'processing') {\r\n    return (\r\n      <>\r\n        <Breadcrumb title={\"Checkout\"} pages={[\"checkout\"]} />\r\n        <section className=\"overflow-hidden py-8 md:py-20 bg-gray-50\">\r\n          <div className=\"max-w-4xl w-full mx-auto px-4 sm:px-8 xl:px-0\">\r\n            {/* Progress indicator */}\r\n            <div className=\"mb-8\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h1 className=\"text-2xl font-bold text-gray-900\">Checkout</h1>\r\n                <Badge variant=\"secondary\" className=\"bg-blaze-orange-100 text-blaze-orange-700\">\r\n                  Paso 2 de 3\r\n                </Badge>\r\n              </div>\r\n              <Progress value={getProgressValue()} className=\"h-2\" />\r\n            </div>\r\n\r\n            <Card className=\"max-w-md mx-auto shadow-lg\">\r\n              <CardContent className=\"p-8 md:p-12 text-center\">\r\n                <div className=\"flex flex-col items-center gap-6\">\r\n                  <div className=\"w-20 h-20 rounded-full bg-blaze-orange-100 flex items-center justify-center\">\r\n                    <Loader2 className=\"w-10 h-10 text-blaze-orange-600 animate-spin\" />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <h2 className=\"text-xl md:text-2xl font-semibold text-gray-900\">\r\n                      Procesando tu pedido...\r\n                    </h2>\r\n                    <p className=\"text-gray-600 text-sm md:text-base\">\r\n                      Por favor espera mientras preparamos tu pago seguro.\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                    <div className=\"bg-blaze-orange-600 h-2 rounded-full animate-pulse\" style={{ width: '66%' }}></div>\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </section>\r\n      </>\r\n    );\r\n  }\r\n\r\n  // ✅ MEJORADO: Paso de pago con Wallet Brick y Design System\r\n  if (step === 'payment') {\r\n    return (\r\n      <>\r\n        <Breadcrumb title={\"Checkout - Pago\"} pages={[\"checkout\", \"pago\"]} />\r\n        <section className=\"overflow-hidden py-8 md:py-20 bg-gray-50\">\r\n          <div className=\"max-w-6xl w-full mx-auto px-4 sm:px-8 xl:px-0\">\r\n            {/* Progress indicator */}\r\n            <div className=\"mb-8\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900\">Finalizar Pago</h1>\r\n                <Badge variant=\"secondary\" className=\"bg-blaze-orange-100 text-blaze-orange-700\">\r\n                  Paso 3 de 3\r\n                </Badge>\r\n              </div>\r\n              <Progress value={getProgressValue()} className=\"h-2\" />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n              {/* Payment Section */}\r\n              <div className=\"lg:col-span-2\">\r\n                <Card className=\"shadow-lg\">\r\n                  <CardHeader className=\"bg-blaze-orange-50 border-b\">\r\n                    <CardTitle className=\"flex items-center gap-2 text-blaze-orange-700\">\r\n                      <CreditCard className=\"w-5 h-5\" />\r\n                      Método de Pago Seguro\r\n                    </CardTitle>\r\n                    <p className=\"text-sm text-gray-600 mt-1\">\r\n                      Completa tu compra de forma segura con MercadoPago\r\n                    </p>\r\n                  </CardHeader>\r\n                  <CardContent className=\"p-6\">\r\n                    {/* Wallet Brick */}\r\n                    {preferenceId ? (\r\n                      <MercadoPagoWallet\r\n                        preferenceId={preferenceId}\r\n                        onReady={handleWalletReady}\r\n                        onError={handleWalletError}\r\n                        onSubmit={handleWalletSubmit}\r\n                        className=\"min-h-[400px]\"\r\n                      />\r\n                    ) : (\r\n                      // Fallback si no hay preferenceId\r\n                      initPoint && (\r\n                        <MercadoPagoWalletFallback\r\n                          initPoint={initPoint}\r\n                        />\r\n                      )\r\n                    )}\r\n                  </CardContent>\r\n                </Card>\r\n              </div>\r\n\r\n              {/* Order Summary */}\r\n              <div className=\"lg:col-span-1\">\r\n                <CartSummary\r\n                  cartItems={cartItems}\r\n                  totalPrice={totalPrice}\r\n                  shippingCost={shippingCost}\r\n                  discount={discount}\r\n                  finalTotal={finalTotal}\r\n                  shippingMethod={formData.shippingMethod}\r\n                  appliedCoupon={appliedCoupon}\r\n                  variant=\"detailed\"\r\n                  showProductCards={false}\r\n                  productCardContext=\"checkout\"\r\n                  className=\"sticky top-4\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </section>\r\n      </>\r\n    );\r\n  }\r\n\r\n  if (step === 'redirect') {\r\n    return (\r\n      <>\r\n        <Breadcrumb title={\"Checkout\"} pages={[\"checkout\"]} />\r\n        <section className=\"overflow-hidden py-8 md:py-20 bg-gray-50\">\r\n          <div className=\"max-w-4xl w-full mx-auto px-4 sm:px-8 xl:px-0\">\r\n            {/* Progress indicator */}\r\n            <div className=\"mb-8\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <h1 className=\"text-2xl font-bold text-gray-900\">Checkout</h1>\r\n                <Badge variant=\"secondary\" className=\"bg-yellow-100 text-yellow-700\">\r\n                  Finalizando...\r\n                </Badge>\r\n              </div>\r\n              <Progress value={getProgressValue()} className=\"h-2\" />\r\n            </div>\r\n\r\n            <Card className=\"max-w-md mx-auto shadow-lg\">\r\n              <CardContent className=\"p-8 md:p-12 text-center\">\r\n                <div className=\"flex flex-col items-center gap-6\">\r\n                  <div className=\"w-20 h-20 rounded-full bg-yellow-100 flex items-center justify-center\">\r\n                    <CreditCard className=\"w-10 h-10 text-yellow-600 animate-pulse\" />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <h2 className=\"text-xl md:text-2xl font-semibold text-gray-900\">\r\n                      Procesando Pago...\r\n                    </h2>\r\n                    <p className=\"text-gray-600 text-sm md:text-base\">\r\n                      Tu pago está siendo procesado. Serás redirigido automáticamente.\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2 text-sm text-gray-500\">\r\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                    <span>Conectando con MercadoPago...</span>\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </section>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <section className=\"overflow-hidden py-4 md:py-8 bg-gray-50\">\r\n        <div className=\"max-w-6xl w-full mx-auto px-4 sm:px-8 xl:px-0\">\r\n          {/* ✅ UNIFICADO: Header con progreso y modo express */}\r\n          <div className=\"mb-8\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900\">Checkout</h1>\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={toggleExpressMode}\r\n                  className=\"hidden md:flex items-center gap-2\"\r\n                >\r\n                  <Zap className=\"w-4 h-4\" />\r\n                  {isExpressMode ? 'Modo Completo' : 'Modo Express'}\r\n                </Button>\r\n              </div>\r\n              <div className=\"flex items-center gap-3\">\r\n                <Badge variant=\"secondary\" className=\"bg-blaze-orange-100 text-blaze-orange-700\">\r\n                  Paso {step === 'form' ? '1' : step === 'payment' ? '2' : '3'} de 3\r\n                </Badge>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  className=\"flex items-center gap-2\"\r\n                  onClick={() => window.open('https://wa.me/5493515551234', '_blank')}\r\n                >\r\n                  <MessageCircle className=\"w-4 h-4\" />\r\n                  <span className=\"hidden md:inline\">Ayuda</span>\r\n                </Button>\r\n              </div>\r\n            </div>\r\n            <Progress value={getProgressValue()} className=\"h-3\" />\r\n          </div>\r\n\r\n          {/* ✅ OPTIMIZADO: Elementos de conversión simplificados */}\r\n          <div className=\"mb-6 space-y-3\">\r\n            {/* Timer de Urgencia */}\r\n            <UrgencyTimer\r\n              initialMinutes={15}\r\n              message=\"Completa tu compra para mantener el precio y envío gratis desde $15.000\"\r\n              variant=\"warning\"\r\n              showProgress={true}\r\n            />\r\n\r\n            {/* Trust Signals */}\r\n            <TrustSignals />\r\n          </div>\r\n\r\n          <form onSubmit={handleSubmit} role=\"form\">\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n              {/* Checkout form */}\r\n              <div className=\"lg:col-span-2 space-y-6\">\r\n                {/* Error general - Mejorado con Design System */}\r\n                {errors.general && (\r\n                  <Card className=\"border-red-200 bg-red-50 shadow-sm\">\r\n                    <CardContent className=\"p-4\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <AlertTriangle className=\"w-5 h-5 text-red-600 flex-shrink-0\" />\r\n                        <div>\r\n                          <h4 className=\"font-medium text-red-800\">Error en el checkout</h4>\r\n                          <p className=\"text-sm text-red-700 mt-1\">{errors.general}</p>\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                )}\r\n\r\n                {/* Error de carrito vacío */}\r\n                {errors.cart && (\r\n                  <Card className=\"border-yellow-200 bg-yellow-50 shadow-sm\">\r\n                    <CardContent className=\"p-4\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <ShoppingCart className=\"w-5 h-5 text-yellow-600 flex-shrink-0\" />\r\n                        <p className=\"text-yellow-800 font-medium\">{errors.cart}</p>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                )}\r\n\r\n                {/* ✅ SIMPLIFICADO: Formulario optimizado */}\r\n                {isExpressMode ? (\r\n                  /* Modo Express - Formulario ultra simplificado */\r\n                  <Card className=\"shadow-lg\">\r\n                    <CardHeader className=\"bg-gradient-to-r from-blaze-orange-50 to-yellow-50 border-b\">\r\n                      <CardTitle className=\"flex items-center gap-2 text-blaze-orange-700\">\r\n                        <Zap className=\"w-5 h-5\" />\r\n                        Checkout Express\r\n                      </CardTitle>\r\n                      <p className=\"text-sm text-gray-600 mt-1\">\r\n                        Solo 3 datos y listo\r\n                      </p>\r\n                    </CardHeader>\r\n                    <CardContent className=\"p-6 space-y-4\">\r\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        {/* Email */}\r\n                        <div className=\"space-y-2\">\r\n                          <label className=\"flex items-center gap-2 text-sm font-medium\">\r\n                            <Mail className=\"w-4 h-4 text-blaze-orange-600\" />\r\n                            Email\r\n                          </label>\r\n                          <input\r\n                            type=\"email\"\r\n                            placeholder=\"tu@email.com\"\r\n                            value={formData.billing.email}\r\n                            onChange={(e) => updateBillingData({ email: e.target.value })}\r\n                            className=\"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blaze-orange-500 focus:border-transparent\"\r\n                          />\r\n                        </div>\r\n\r\n                        {/* Teléfono */}\r\n                        <div className=\"space-y-2\">\r\n                          <label className=\"flex items-center gap-2 text-sm font-medium\">\r\n                            <Phone className=\"w-4 h-4 text-blaze-orange-600\" />\r\n                            Teléfono\r\n                          </label>\r\n                          <input\r\n                            type=\"tel\"\r\n                            placeholder=\"11 1234-5678\"\r\n                            value={formData.billing.phone}\r\n                            onChange={(e) => updateBillingData({ phone: e.target.value })}\r\n                            className=\"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blaze-orange-500 focus:border-transparent\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Dirección */}\r\n                      <div className=\"space-y-2\">\r\n                        <label className=\"flex items-center gap-2 text-sm font-medium\">\r\n                          <MapPin className=\"w-4 h-4 text-blaze-orange-600\" />\r\n                          Dirección completa\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          placeholder=\"Calle 123, Ciudad, Provincia\"\r\n                          value={formData.billing.streetAddress}\r\n                          onChange={(e) => updateBillingData({ streetAddress: e.target.value })}\r\n                          className=\"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blaze-orange-500 focus:border-transparent\"\r\n                        />\r\n                      </div>\r\n\r\n                      {/* Payment Method Express */}\r\n                      <div className=\"space-y-3\">\r\n                        <h3 className=\"font-semibold flex items-center gap-2\">\r\n                          <CreditCard className=\"w-5 h-5 text-blaze-orange-600\" />\r\n                          Método de Pago\r\n                        </h3>\r\n                        <PaymentMethod\r\n                          selectedMethod={formData.paymentMethod}\r\n                          onMethodChange={handlePaymentMethodChange}\r\n                        />\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ) : (\r\n                  /* Modo Completo - Formulario tradicional */\r\n                  <>\r\n                    {/* Billing details */}\r\n                    <Card className=\"shadow-sm\">\r\n                      <CardHeader className=\"bg-blaze-orange-50 border-b\">\r\n                        <CardTitle className=\"flex items-center gap-2 text-blaze-orange-700\">\r\n                          <User className=\"w-5 h-5\" />\r\n                          Información de Facturación\r\n                        </CardTitle>\r\n                      </CardHeader>\r\n                      <CardContent className=\"p-6\">\r\n                        <Billing\r\n                          billingData={formData.billing}\r\n                          errors={errors}\r\n                          onBillingChange={updateBillingData}\r\n                        />\r\n                      </CardContent>\r\n                    </Card>\r\n\r\n                    {/* Shipping address */}\r\n                    <Card className=\"shadow-sm\">\r\n                      <CardHeader className=\"bg-blue-50 border-b\">\r\n                        <CardTitle className=\"flex items-center gap-2 text-blue-700\">\r\n                          <Truck className=\"w-5 h-5\" />\r\n                          Dirección de Envío\r\n                        </CardTitle>\r\n                      </CardHeader>\r\n                      <CardContent className=\"p-6\">\r\n                        <Shipping\r\n                          shippingData={formData.shipping}\r\n                          billingData={formData.billing}\r\n                          errors={errors}\r\n                          onShippingChange={updateShippingData}\r\n                        />\r\n                      </CardContent>\r\n                    </Card>\r\n\r\n\r\n\r\n                    {/* Payment method */}\r\n                    <Card className=\"shadow-sm\">\r\n                      <CardHeader className=\"bg-purple-50 border-b\">\r\n                        <CardTitle className=\"flex items-center gap-2 text-purple-700\">\r\n                          <CreditCard className=\"w-5 h-5\" />\r\n                          Método de Pago\r\n                        </CardTitle>\r\n                      </CardHeader>\r\n                      <CardContent className=\"p-6\">\r\n                        <PaymentMethod\r\n                          selectedMethod={formData.paymentMethod}\r\n                          onMethodChange={handlePaymentMethodChange}\r\n                        />\r\n                      </CardContent>\r\n                    </Card>\r\n                  </>\r\n                )}\r\n              </div>\r\n\r\n              {/* ✅ SIMPLIFICADO: Sidebar optimizado */}\r\n              <div className=\"lg:col-span-1 space-y-4\">\r\n                {/* Stock Indicator - Solo elemento principal */}\r\n                <StockIndicator\r\n                  quantity={3}\r\n                  lowStockThreshold={5}\r\n                  viewers={0}\r\n                  recentPurchases={0}\r\n                  showSocialProof={false}\r\n                />\r\n\r\n                {/* Order summary - CartSummary del Design System */}\r\n                <CartSummary\r\n                  cartItems={cartItems}\r\n                  totalPrice={totalPrice}\r\n                  shippingCost={shippingCost}\r\n                  discount={discount}\r\n                  finalTotal={finalTotal}\r\n                  shippingMethod=\"free\"\r\n                  appliedCoupon={appliedCoupon}\r\n                  variant=\"detailed\"\r\n                  showProductCards={false}\r\n                  productCardContext=\"checkout\"\r\n                  className=\"sticky top-4\"\r\n                />\r\n\r\n                {/* Social Proof sutil */}\r\n                <SocialProof showTestimonials={false} />\r\n\r\n                {/* Coupon simplificado */}\r\n                <Card className=\"shadow-sm\">\r\n                  <CardContent className=\"p-4\">\r\n                    <Coupon\r\n                      onCouponApply={applyCoupon}\r\n                      appliedCoupon={appliedCoupon}\r\n                      isLoading={isLoading}\r\n                    />\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                {/* Checkout button - Simplificado */}\r\n                <Card className=\"shadow-lg border-2 border-yellow-200\">\r\n                  <CardContent className=\"p-4\">\r\n                    <Button\r\n                      type=\"submit\"\r\n                      disabled={isLoading || cartItems.length === 0}\r\n                      className={`w-full h-16 text-2xl font-bold transition-all duration-200 ${\r\n                        isLoading || cartItems.length === 0\r\n                          ? 'bg-gray-400 cursor-not-allowed'\r\n                          : 'bg-blaze-orange-600 hover:bg-blaze-orange-700 text-white shadow-lg hover:shadow-xl'\r\n                      }`}\r\n                    >\r\n                      {isLoading ? (\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Loader2 className=\"w-6 h-6 animate-spin\" />\r\n                          Procesando...\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <CreditCard className=\"w-6 h-6\" />\r\n                          FINALIZAR COMPRA - ${finalTotal.toLocaleString()}\r\n                        </div>\r\n                      )}\r\n                    </Button>\r\n\r\n                    {/* Trust indicators simplificados */}\r\n                    <div className=\"mt-3 flex items-center justify-center gap-4 text-sm text-gray-600\">\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <Shield className=\"w-4 h-4 text-green-600\" />\r\n                        <span>Pago Seguro</span>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <Truck className=\"w-4 h-4 text-blue-600\" />\r\n                        <span>Envío Gratis +$15.000</span>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        {/* ✅ NUEVO: Exit Intent Modal para conversión */}\r\n        {showExitIntent && (\r\n          <ExitIntentModal\r\n            onClose={() => setShowExitIntent(false)}\r\n            onAccept={() => {\r\n              setShowExitIntent(false);\r\n              // TODO: Aplicar descuento del 10%\r\n              // applyCoupon('EXIT10');\r\n            }}\r\n            discount={10}\r\n          />\r\n        )}\r\n      </section>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Checkout;\r\n"],"names":["Checkout","router","useRouter","showExitIntent","setShowExitIntent","useState","isExpressMode","setIsExpressMode","formData","isLoading","errors","step","cartItems","totalPrice","shippingCost","discount","finalTotal","appliedCoupon","applyCoupon","updateBillingData","updateShippingData","updateFormData","processCheckout","preferenceId","initPoint","handleWalletReady","handleWalletError","handleWalletSubmit","useCheckout","checkoutSteps","id","title","description","icon","User","isCompleted","isActive","CreditCard","CheckCircle","getProgressValue","useEffect","handleMouseLeave","e","clientY","document","addEventListener","removeEventListener","length","push","handleSubmit","preventDefault","handlePaymentMethodChange","method","paymentMethod","toggleExpressMode","Breadcrumb","pages","section","className","div","h1","Badge","variant","Progress","value","Card","CardContent","Loader2","h2","p","style","width","CardHeader","CardTitle","MercadoPagoWallet","onReady","onError","onSubmit","MercadoPagoWalletFallback","CartSummary","shippingMethod","showProductCards","productCardContext","span","Button","type","size","onClick","Zap","window","open","MessageCircle","UrgencyTimer","initialMinutes","message","showProgress","TrustSignals","form","role","general","AlertTriangle","h4","cart","ShoppingCart","label","Mail","input","placeholder","billing","email","onChange","target","Phone","phone","MapPin","streetAddress","h3","PaymentMethod","selectedMethod","onMethodChange","Billing","billingData","onBillingChange","Truck","Shipping","shippingData","shipping","onShippingChange","StockIndicator","quantity","lowStockThreshold","viewers","recentPurchases","showSocialProof","SocialProof","showTestimonials","Coupon","onCouponApply","disabled","toLocaleString","Shield","ExitIntentModal","onClose","onAccept"],"mappings":"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"}