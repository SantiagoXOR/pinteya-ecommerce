3f72c3835710dec16adef90093226d17
/**
 * Sistema de Autenticación y Autorización para Panel Administrativo
 * Implementa verificación de roles y permisos granulares
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    checkAdminAccess: function() {
        return checkAdminAccess;
    },
    checkAdminPermissions: function() {
        return checkAdminPermissions;
    },
    checkAdvancedSecurity: function() {
        return checkAdvancedSecurity;
    },
    checkCRUDPermissions: function() {
        return checkCRUDPermissions;
    },
    getAuthFromApiRoute: function() {
        return getAuthFromApiRoute;
    },
    getAuthFromRouteHandler: function() {
        return getAuthFromRouteHandler;
    },
    getAuthenticatedUser: function() {
        return getAuthenticatedUser;
    },
    getRequestInfo: function() {
        return getRequestInfo;
    },
    getUnifiedAuth: function() {
        return getUnifiedAuth;
    },
    getUserProfile: function() {
        return getUserProfile;
    },
    hasAllPermissions: function() {
        return hasAllPermissions;
    },
    hasAnyPermission: function() {
        return hasAnyPermission;
    },
    hasPermission: function() {
        return hasPermission;
    },
    isAdmin: function() {
        return isAdmin;
    },
    isModeratorOrAdmin: function() {
        return isModeratorOrAdmin;
    },
    logAdminAccess: function() {
        return logAdminAccess;
    },
    logAdminAction: function() {
        return logAdminAction;
    },
    withAdminAuth: function() {
        return withAdminAuth;
    },
    withAdminAuthPages: function() {
        return withAdminAuthPages;
    }
});
const _server = require("@clerk/nextjs/server");
const _supabase = require("../supabase");
const _securityvalidations = require("./security-validations");
const _securityaudit = require("./security-audit");
async function getAuthenticatedUser(request) {
    try {
        // Método 1: Usar getAuth oficial de Clerk para API Routes (PREFERIDO)
        if (request && 'query' in request) {
            // Es NextApiRequest (Pages Router)
            const { userId, sessionId } = (0, _server.getAuth)(request);
            if (userId) {
                console.log(`[AUTH] Usuario autenticado via getAuth: ${userId}`);
                return {
                    userId,
                    sessionId
                };
            }
        }
        // Método 2: Usar auth() para App Router Route Handlers
        if (!request || !('query' in request)) {
            try {
                const { userId, sessionId } = await (0, _server.auth)();
                if (userId) {
                    console.log(`[AUTH] Usuario autenticado via auth(): ${userId}`);
                    return {
                        userId,
                        sessionId
                    };
                }
            } catch (authError) {
                console.warn('[AUTH] Error usando auth():', authError);
            // Continuar con métodos fallback
            }
        }
        // Método 3: Fallback a headers (compatibilidad con implementación anterior)
        if (request && 'headers' in request) {
            const clerkUserId = request.headers.get?.('x-clerk-user-id') || request.headers['x-clerk-user-id'];
            if (clerkUserId) {
                console.warn('[AUTH] Usando header fallback para userId - considera migrar a getAuth()');
                return {
                    userId: clerkUserId
                };
            }
        }
        // Método 4: Fallback a JWT en cookies (último recurso)
        if (request && 'cookies' in request) {
            try {
                const sessionToken = request.cookies.get?.('__session')?.value || request.cookies['__session'];
                if (sessionToken) {
                    // Decodificar el JWT para obtener el userId
                    const payload = JSON.parse(atob(sessionToken.split('.')[1]));
                    if (payload.sub) {
                        console.warn('[AUTH] Usando JWT fallback para userId');
                        return {
                            userId: payload.sub
                        };
                    }
                }
            } catch (jwtError) {
                console.warn('[AUTH] Error decoding JWT:', jwtError);
            }
        }
        return {
            userId: null,
            error: 'No autorizado'
        };
    } catch (error) {
        console.error('[AUTH] Error getting authenticated user:', error);
        return {
            userId: null,
            error: 'Error de autenticación'
        };
    }
}
function getAuthFromApiRoute(req, res) {
    const { userId, sessionId, getToken } = (0, _server.getAuth)(req);
    if (!userId) {
        throw new Error('Usuario no autenticado');
    }
    console.log(`[AUTH] API Route autenticada: ${userId}`);
    return {
        userId,
        sessionId,
        getToken
    };
}
async function getAuthFromRouteHandler() {
    const { userId, sessionId, getToken } = await (0, _server.auth)();
    if (!userId) {
        throw new Error('Usuario no autenticado');
    }
    console.log(`[AUTH] Route Handler autenticado: ${userId}`);
    return {
        userId,
        sessionId,
        getToken
    };
}
async function getUnifiedAuth(request) {
    try {
        // Detectar si es API Route (Pages Router)
        if (request && 'query' in request) {
            try {
                return getAuthFromApiRoute(request, {});
            } catch (apiError) {
                console.warn('[AUTH] Error en API Route, usando fallback:', apiError);
                // Fallback a función original
                return await getAuthenticatedUser(request);
            }
        }
        // Detectar si es Route Handler (App Router) o sin request
        if (!request || !('query' in request)) {
            try {
                return await getAuthFromRouteHandler();
            } catch (routeError) {
                console.warn('[AUTH] Error en Route Handler, usando fallback:', routeError);
                // Fallback a función original
                return await getAuthenticatedUser(request);
            }
        }
        // Fallback a función original
        return await getAuthenticatedUser(request);
    } catch (error) {
        console.error('[AUTH] Error en getUnifiedAuth:', error);
        // En lugar de lanzar error, retornar resultado de fallback
        return await getAuthenticatedUser(request);
    }
}
async function getUserProfile(clerkUserId) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client not available');
        }
        // Primero obtener el perfil del usuario
        const { data: profile, error: profileError } = await _supabase.supabaseAdmin.from('user_profiles').select('*').eq('clerk_user_id', clerkUserId).eq('is_active', true).single();
        if (profileError) {
            console.error('Error fetching user profile:', profileError);
            return null;
        }
        if (!profile) {
            return null;
        }
        // Luego obtener el rol del usuario
        const { data: role, error: roleError } = await _supabase.supabaseAdmin.from('user_roles').select('*').eq('id', profile.role_id).single();
        if (roleError) {
            console.error('Error fetching user role:', roleError);
            return null;
        }
        // Combinar los datos
        const userProfile = {
            ...profile,
            user_roles: role
        };
        return userProfile;
    } catch (error) {
        console.error('Error in getUserProfile:', error);
        return null;
    }
}
async function checkAdminAccess(clerkUserId) {
    try {
        const profile = await getUserProfile(clerkUserId);
        if (!profile) {
            return {
                success: false,
                error: 'Perfil de usuario no encontrado',
                status: 404
            };
        }
        if (!profile.user_roles || !profile.is_active) {
            return {
                success: false,
                error: 'Rol de usuario no válido',
                status: 403
            };
        }
        // Verificar si tiene acceso al panel admin
        const hasAdminAccess = hasPermission(profile, [
            'admin_panel',
            'access'
        ]);
        if (!hasAdminAccess) {
            return {
                success: false,
                error: 'Acceso denegado al panel administrativo',
                status: 403
            };
        }
        return {
            success: true,
            user: profile
        };
    } catch (error) {
        console.error('Error in checkAdminAccess:', error);
        return {
            success: false,
            error: 'Error interno del servidor',
            status: 500
        };
    }
}
function hasPermission(userProfile, permissionPath) {
    try {
        if (!userProfile.user_roles || !userProfile.user_roles.permissions) {
            return false;
        }
        let current = userProfile.user_roles.permissions;
        for (const path of permissionPath){
            if (current[path] === undefined) {
                return false;
            }
            current = current[path];
        }
        // Manejar diferentes tipos de valores de permisos
        if (typeof current === 'boolean') {
            return current;
        }
        if (typeof current === 'string') {
            // Para permisos como "own", "own_limited", etc.
            return current !== 'false';
        }
        return false;
    } catch (error) {
        console.error('Error checking permission:', error);
        return false;
    }
}
function hasAnyPermission(userProfile, permissions) {
    return permissions.some((permission)=>hasPermission(userProfile, permission));
}
function hasAllPermissions(userProfile, permissions) {
    return permissions.every((permission)=>hasPermission(userProfile, permission));
}
function isAdmin(userProfile) {
    return userProfile.user_roles?.role_name === 'admin';
}
function isModeratorOrAdmin(userProfile) {
    const role = userProfile.user_roles?.role_name;
    return role === 'admin' || role === 'moderator';
}
async function checkAdminPermissions(requiredPermissions, request) {
    try {
        // 1. Verificar autenticación con Clerk usando métodos oficiales
        let userId;
        let sessionId;
        try {
            const authResult = await getUnifiedAuth(request);
            userId = authResult.userId;
            sessionId = authResult.sessionId;
            // Log autenticación exitosa
            const securityContext = await (0, _securityvalidations.getSecurityContext)(userId, request);
            if (securityContext) {
                await (0, _securityaudit.logAuthSuccess)(userId, securityContext, request);
            }
        } catch (authError) {
            console.warn('[AUTH] Error en autenticación unificada, intentando fallback');
            await (0, _securityaudit.logAuthFailure)(null, `Error de autenticación: ${authError.message}`, request);
            const fallbackResult = await getAuthenticatedUser(request);
            if (!fallbackResult.userId) {
                await (0, _securityaudit.logAuthFailure)(null, fallbackResult.error || 'No autorizado', request);
                return {
                    success: false,
                    error: fallbackResult.error || 'No autorizado',
                    status: 401
                };
            }
            userId = fallbackResult.userId;
            sessionId = fallbackResult.sessionId;
        }
        // 2. Ejecutar detección de seguridad
        await (0, _securityaudit.runSecurityDetection)(userId);
        // 3. Obtener contexto de seguridad completo
        const securityContext = await (0, _securityvalidations.getSecurityContext)(userId, request);
        if (!securityContext) {
            await (0, _securityaudit.logAuthFailure)(userId, 'No se pudo obtener contexto de seguridad', request);
            return {
                success: false,
                error: 'Error obteniendo contexto de seguridad',
                status: 500
            };
        }
        // 4. Verificar disponibilidad de Supabase
        if (!_supabase.supabaseAdmin) {
            return {
                success: false,
                error: 'Servicio administrativo no disponible',
                status: 503
            };
        }
        // 5. Verificar acceso administrativo básico
        const adminCheck = await checkAdminAccess(userId);
        if (!adminCheck.success) {
            await (0, _securityaudit.logPermissionDenied)(userId, 'ADMIN_ACCESS', [
                'admin_panel'
            ], securityContext);
            return adminCheck;
        }
        const userProfile = adminCheck.user;
        // 6. Verificar permisos específicos con validaciones de seguridad
        if (requiredPermissions && requiredPermissions.length > 0) {
            const hasRequiredPermissions = hasAnyPermission(userProfile, requiredPermissions);
            if (!hasRequiredPermissions) {
                await (0, _securityaudit.logPermissionDenied)(userId, 'SPECIFIC_PERMISSIONS', requiredPermissions.flat(), securityContext);
                return {
                    success: false,
                    error: 'Permisos insuficientes para esta operación',
                    status: 403
                };
            }
        }
        // 7. Registrar acceso en audit log
        await logAdminAccess(userProfile.id, 'API_ACCESS');
        return {
            success: true,
            user: userProfile,
            supabase: _supabase.supabaseAdmin,
            securityContext
        };
    } catch (error) {
        console.error('Error in checkAdminPermissions:', error);
        return {
            success: false,
            error: 'Error interno del servidor',
            status: 500
        };
    }
}
async function checkCRUDPermissions(resource, action, request) {
    const requiredPermissions = [
        [
            resource,
            action
        ]
    ];
    return checkAdminPermissions(requiredPermissions, request);
}
async function checkAdvancedSecurity(userId, operation, requiredPermissions, request) {
    try {
        // 1. Ejecutar detección de seguridad
        await (0, _securityaudit.runSecurityDetection)(userId);
        // 2. Validar contexto de seguridad
        const securityValidation = await (0, _securityvalidations.validateSecurityContext)(userId, operation, requiredPermissions, request);
        if (!securityValidation.valid) {
            return securityValidation;
        }
        // 3. Obtener perfil de usuario desde Supabase
        const userProfile = await getUserProfile(userId);
        if (!userProfile) {
            return {
                valid: false,
                error: 'Perfil de usuario no encontrado',
                code: 'USER_PROFILE_NOT_FOUND',
                severity: 'high'
            };
        }
        // 4. Verificar disponibilidad de Supabase
        if (!_supabase.supabaseAdmin) {
            return {
                valid: false,
                error: 'Servicio administrativo no disponible',
                code: 'SERVICE_UNAVAILABLE',
                severity: 'critical'
            };
        }
        return {
            valid: true,
            context: securityValidation.context,
            userProfile,
            supabase: _supabase.supabaseAdmin
        };
    } catch (error) {
        console.error('[SECURITY] Error en checkAdvancedSecurity:', error);
        return {
            valid: false,
            error: 'Error interno en validación de seguridad',
            code: 'SECURITY_VALIDATION_ERROR',
            severity: 'critical'
        };
    }
}
async function logAdminAccess(userProfileId, action, resourceType, resourceId, additionalData) {
    try {
        if (!_supabase.supabaseAdmin) return;
        await _supabase.supabaseAdmin.from('admin_audit_log').insert({
            user_id: userProfileId,
            action,
            resource_type: resourceType || 'system',
            resource_id: resourceId,
            new_values: additionalData ? JSON.stringify(additionalData) : null
        });
    } catch (error) {
        console.error('Error logging admin access:', error);
    // No lanzar error para no interrumpir el flujo principal
    }
}
async function logAdminAction(userProfileId, action, resourceType, resourceId, oldValues, newValues) {
    try {
        if (!_supabase.supabaseAdmin) return;
        await _supabase.supabaseAdmin.from('admin_audit_log').insert({
            user_id: userProfileId,
            action,
            resource_type: resourceType,
            resource_id: resourceId,
            old_values: oldValues ? JSON.stringify(oldValues) : null,
            new_values: newValues ? JSON.stringify(newValues) : null
        });
    } catch (error) {
        console.error('Error logging admin action:', error);
    }
}
function withAdminAuth(handler, requiredPermissions) {
    return async (request)=>{
        const authResult = await checkAdminPermissions(requiredPermissions, request);
        if (!authResult.success) {
            return new Response(JSON.stringify({
                success: false,
                error: authResult.error
            }), {
                status: authResult.status || 500,
                headers: {
                    'Content-Type': 'application/json'
                }
            });
        }
        return handler(request, {
            user: authResult.user,
            supabase: authResult.supabase
        });
    };
}
function withAdminAuthPages(handler, requiredPermissions) {
    return async (req, res)=>{
        const authResult = await checkAdminPermissions(requiredPermissions, req);
        if (!authResult.success) {
            return res.status(authResult.status || 500).json({
                success: false,
                error: authResult.error
            });
        }
        return handler(req, res, {
            user: authResult.user,
            supabase: authResult.supabase
        });
    };
}
function getRequestInfo(request) {
    if ('query' in request) {
        // NextApiRequest (Pages Router)
        const req = request;
        return {
            method: req.method || 'GET',
            url: req.url || 'unknown',
            userAgent: req.headers['user-agent'] || 'unknown',
            ip: req.headers['x-forwarded-for'] || req.headers['x-real-ip'] || req.connection?.remoteAddress || 'unknown'
        };
    } else {
        // NextRequest (App Router)
        const req = request;
        return {
            method: req.method,
            url: req.url,
            userAgent: req.headers.get('user-agent') || 'unknown',
            ip: req.headers.get('x-forwarded-for') || req.headers.get('x-real-ip') || 'unknown'
        };
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhdXRoXFxhZG1pbi1hdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2lzdGVtYSBkZSBBdXRlbnRpY2FjacOzbiB5IEF1dG9yaXphY2nDs24gcGFyYSBQYW5lbCBBZG1pbmlzdHJhdGl2b1xuICogSW1wbGVtZW50YSB2ZXJpZmljYWNpw7NuIGRlIHJvbGVzIHkgcGVybWlzb3MgZ3JhbnVsYXJlc1xuICovXG5cbmltcG9ydCB7IGF1dGgsIGN1cnJlbnRVc2VyLCBnZXRBdXRoIH0gZnJvbSAnQGNsZXJrL25leHRqcy9zZXJ2ZXInO1xuaW1wb3J0IHsgc3VwYWJhc2VBZG1pbiB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJztcbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQge1xuICB2YWxpZGF0ZVNlY3VyaXR5Q29udGV4dCxcbiAgZ2V0U2VjdXJpdHlDb250ZXh0LFxuICB0eXBlIFNlY3VyaXR5VmFsaWRhdGlvblJlc3VsdCxcbiAgdHlwZSBTZWN1cml0eUNvbnRleHRcbn0gZnJvbSAnLi9zZWN1cml0eS12YWxpZGF0aW9ucyc7XG5pbXBvcnQge1xuICBsb2dBdXRoU3VjY2VzcyxcbiAgbG9nQXV0aEZhaWx1cmUsXG4gIGxvZ1Blcm1pc3Npb25EZW5pZWQsXG4gIHJ1blNlY3VyaXR5RGV0ZWN0aW9uXG59IGZyb20gJy4vc2VjdXJpdHktYXVkaXQnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVElQT1MgWSBJTlRFUkZBQ0VTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzZXJQcm9maWxlIHtcbiAgaWQ6IHN0cmluZztcbiAgc3VwYWJhc2VfdXNlcl9pZDogc3RyaW5nIHwgbnVsbDtcbiAgY2xlcmtfdXNlcl9pZDogc3RyaW5nIHwgbnVsbDtcbiAgZW1haWw6IHN0cmluZztcbiAgZmlyc3RfbmFtZTogc3RyaW5nIHwgbnVsbDtcbiAgbGFzdF9uYW1lOiBzdHJpbmcgfCBudWxsO1xuICByb2xlX2lkOiBudW1iZXI7XG4gIGlzX2FjdGl2ZTogYm9vbGVhbjtcbiAgaXNfdmVyaWZpZWQ6IGJvb2xlYW47XG4gIHVzZXJfcm9sZXM6IHtcbiAgICBpZDogbnVtYmVyO1xuICAgIHJvbGVfbmFtZTogc3RyaW5nO1xuICAgIGRpc3BsYXlfbmFtZTogc3RyaW5nO1xuICAgIHBlcm1pc3Npb25zOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIGlzX2FjdGl2ZTogYm9vbGVhbjtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBZG1pbkF1dGhSZXN1bHQge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICB1c2VyPzogVXNlclByb2ZpbGU7XG4gIGVycm9yPzogc3RyaW5nO1xuICBzdGF0dXM/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVybWlzc2lvbkNoZWNrIHtcbiAgcmVzb3VyY2U6IHN0cmluZztcbiAgYWN0aW9uOiBzdHJpbmc7XG4gIHVzZXJJZD86IHN0cmluZztcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZVTkNJT05FUyBERSBWRVJJRklDQUNJw5NOIERFIEFVVEVOVElDQUNJw5NOXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIE9idGllbmUgZWwgdXN1YXJpbyBhdXRlbnRpY2FkbyB1c2FuZG8gbcOpdG9kb3Mgb2ZpY2lhbGVzIGRlIENsZXJrXG4gKiBNYW50aWVuZSBjb21wYXRpYmlsaWRhZCBjb24gaW1wbGVtZW50YWNpw7NuIGFudGVyaW9yIGNvbW8gZmFsbGJhY2tcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEF1dGhlbnRpY2F0ZWRVc2VyKFxuICByZXF1ZXN0PzogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdFxuKTogUHJvbWlzZTx7IHVzZXJJZDogc3RyaW5nIHwgbnVsbDsgc2Vzc2lvbklkPzogc3RyaW5nOyBlcnJvcj86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgLy8gTcOpdG9kbyAxOiBVc2FyIGdldEF1dGggb2ZpY2lhbCBkZSBDbGVyayBwYXJhIEFQSSBSb3V0ZXMgKFBSRUZFUklETylcbiAgICBpZiAocmVxdWVzdCAmJiAncXVlcnknIGluIHJlcXVlc3QpIHtcbiAgICAgIC8vIEVzIE5leHRBcGlSZXF1ZXN0IChQYWdlcyBSb3V0ZXIpXG4gICAgICBjb25zdCB7IHVzZXJJZCwgc2Vzc2lvbklkIH0gPSBnZXRBdXRoKHJlcXVlc3QgYXMgTmV4dEFwaVJlcXVlc3QpO1xuICAgICAgaWYgKHVzZXJJZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgW0FVVEhdIFVzdWFyaW8gYXV0ZW50aWNhZG8gdmlhIGdldEF1dGg6ICR7dXNlcklkfWApO1xuICAgICAgICByZXR1cm4geyB1c2VySWQsIHNlc3Npb25JZCB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE3DqXRvZG8gMjogVXNhciBhdXRoKCkgcGFyYSBBcHAgUm91dGVyIFJvdXRlIEhhbmRsZXJzXG4gICAgaWYgKCFyZXF1ZXN0IHx8ICEoJ3F1ZXJ5JyBpbiByZXF1ZXN0KSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyB1c2VySWQsIHNlc3Npb25JZCB9ID0gYXdhaXQgYXV0aCgpO1xuICAgICAgICBpZiAodXNlcklkKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtBVVRIXSBVc3VhcmlvIGF1dGVudGljYWRvIHZpYSBhdXRoKCk6ICR7dXNlcklkfWApO1xuICAgICAgICAgIHJldHVybiB7IHVzZXJJZCwgc2Vzc2lvbklkIH07XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGF1dGhFcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tBVVRIXSBFcnJvciB1c2FuZG8gYXV0aCgpOicsIGF1dGhFcnJvcik7XG4gICAgICAgIC8vIENvbnRpbnVhciBjb24gbcOpdG9kb3MgZmFsbGJhY2tcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBNw6l0b2RvIDM6IEZhbGxiYWNrIGEgaGVhZGVycyAoY29tcGF0aWJpbGlkYWQgY29uIGltcGxlbWVudGFjacOzbiBhbnRlcmlvcilcbiAgICBpZiAocmVxdWVzdCAmJiAnaGVhZGVycycgaW4gcmVxdWVzdCkge1xuICAgICAgY29uc3QgY2xlcmtVc2VySWQgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0Py4oJ3gtY2xlcmstdXNlci1pZCcpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgKHJlcXVlc3QuaGVhZGVycyBhcyBhbnkpWyd4LWNsZXJrLXVzZXItaWQnXTtcbiAgICAgIGlmIChjbGVya1VzZXJJZCkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tBVVRIXSBVc2FuZG8gaGVhZGVyIGZhbGxiYWNrIHBhcmEgdXNlcklkIC0gY29uc2lkZXJhIG1pZ3JhciBhIGdldEF1dGgoKScpO1xuICAgICAgICByZXR1cm4geyB1c2VySWQ6IGNsZXJrVXNlcklkIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTcOpdG9kbyA0OiBGYWxsYmFjayBhIEpXVCBlbiBjb29raWVzICjDumx0aW1vIHJlY3Vyc28pXG4gICAgaWYgKHJlcXVlc3QgJiYgJ2Nvb2tpZXMnIGluIHJlcXVlc3QpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHNlc3Npb25Ub2tlbiA9IHJlcXVlc3QuY29va2llcy5nZXQ/LignX19zZXNzaW9uJyk/LnZhbHVlIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlcXVlc3QuY29va2llcyBhcyBhbnkpWydfX3Nlc3Npb24nXTtcbiAgICAgICAgaWYgKHNlc3Npb25Ub2tlbikge1xuICAgICAgICAgIC8vIERlY29kaWZpY2FyIGVsIEpXVCBwYXJhIG9idGVuZXIgZWwgdXNlcklkXG4gICAgICAgICAgY29uc3QgcGF5bG9hZCA9IEpTT04ucGFyc2UoYXRvYihzZXNzaW9uVG9rZW4uc3BsaXQoJy4nKVsxXSkpO1xuICAgICAgICAgIGlmIChwYXlsb2FkLnN1Yikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdbQVVUSF0gVXNhbmRvIEpXVCBmYWxsYmFjayBwYXJhIHVzZXJJZCcpO1xuICAgICAgICAgICAgcmV0dXJuIHsgdXNlcklkOiBwYXlsb2FkLnN1YiB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoand0RXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbQVVUSF0gRXJyb3IgZGVjb2RpbmcgSldUOicsIGp3dEVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geyB1c2VySWQ6IG51bGwsIGVycm9yOiAnTm8gYXV0b3JpemFkbycgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbQVVUSF0gRXJyb3IgZ2V0dGluZyBhdXRoZW50aWNhdGVkIHVzZXI6JywgZXJyb3IpO1xuICAgIHJldHVybiB7IHVzZXJJZDogbnVsbCwgZXJyb3I6ICdFcnJvciBkZSBhdXRlbnRpY2FjacOzbicgfTtcbiAgfVxufVxuXG4vKipcbiAqIE51ZXZhIGZ1bmNpw7NuIGVzcGVjw61maWNhIHBhcmEgUGFnZXMgUm91dGVyIEFQSSBSb3V0ZXNcbiAqIFVzYSBnZXRBdXRoKHJlcSkgb2ZpY2lhbCBkZSBDbGVya1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXV0aEZyb21BcGlSb3V0ZShyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xuICBjb25zdCB7IHVzZXJJZCwgc2Vzc2lvbklkLCBnZXRUb2tlbiB9ID0gZ2V0QXV0aChyZXEpO1xuXG4gIGlmICghdXNlcklkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVc3VhcmlvIG5vIGF1dGVudGljYWRvJyk7XG4gIH1cblxuICBjb25zb2xlLmxvZyhgW0FVVEhdIEFQSSBSb3V0ZSBhdXRlbnRpY2FkYTogJHt1c2VySWR9YCk7XG4gIHJldHVybiB7IHVzZXJJZCwgc2Vzc2lvbklkLCBnZXRUb2tlbiB9O1xufVxuXG4vKipcbiAqIE51ZXZhIGZ1bmNpw7NuIGVzcGVjw61maWNhIHBhcmEgQXBwIFJvdXRlciBSb3V0ZSBIYW5kbGVyc1xuICogVXNhIGF1dGgoKSBvZmljaWFsIGRlIENsZXJrXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoRnJvbVJvdXRlSGFuZGxlcigpIHtcbiAgY29uc3QgeyB1c2VySWQsIHNlc3Npb25JZCwgZ2V0VG9rZW4gfSA9IGF3YWl0IGF1dGgoKTtcblxuICBpZiAoIXVzZXJJZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignVXN1YXJpbyBubyBhdXRlbnRpY2FkbycpO1xuICB9XG5cbiAgY29uc29sZS5sb2coYFtBVVRIXSBSb3V0ZSBIYW5kbGVyIGF1dGVudGljYWRvOiAke3VzZXJJZH1gKTtcbiAgcmV0dXJuIHsgdXNlcklkLCBzZXNzaW9uSWQsIGdldFRva2VuIH07XG59XG5cbi8qKlxuICogRnVuY2nDs24gdW5pZmljYWRhIHF1ZSBkZXRlY3RhIGF1dG9tw6F0aWNhbWVudGUgZWwgdGlwbyBkZSBydXRhXG4gKiBDb24gbWFuZWpvIHJvYnVzdG8gZGUgZXJyb3JlcyB5IGZhbGxiYWNrc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VW5pZmllZEF1dGgocmVxdWVzdD86IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyBEZXRlY3RhciBzaSBlcyBBUEkgUm91dGUgKFBhZ2VzIFJvdXRlcilcbiAgICBpZiAocmVxdWVzdCAmJiAncXVlcnknIGluIHJlcXVlc3QpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBnZXRBdXRoRnJvbUFwaVJvdXRlKHJlcXVlc3QgYXMgTmV4dEFwaVJlcXVlc3QsIHt9IGFzIE5leHRBcGlSZXNwb25zZSk7XG4gICAgICB9IGNhdGNoIChhcGlFcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tBVVRIXSBFcnJvciBlbiBBUEkgUm91dGUsIHVzYW5kbyBmYWxsYmFjazonLCBhcGlFcnJvcik7XG4gICAgICAgIC8vIEZhbGxiYWNrIGEgZnVuY2nDs24gb3JpZ2luYWxcbiAgICAgICAgcmV0dXJuIGF3YWl0IGdldEF1dGhlbnRpY2F0ZWRVc2VyKHJlcXVlc3QpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIERldGVjdGFyIHNpIGVzIFJvdXRlIEhhbmRsZXIgKEFwcCBSb3V0ZXIpIG8gc2luIHJlcXVlc3RcbiAgICBpZiAoIXJlcXVlc3QgfHwgISgncXVlcnknIGluIHJlcXVlc3QpKSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYXdhaXQgZ2V0QXV0aEZyb21Sb3V0ZUhhbmRsZXIoKTtcbiAgICAgIH0gY2F0Y2ggKHJvdXRlRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbQVVUSF0gRXJyb3IgZW4gUm91dGUgSGFuZGxlciwgdXNhbmRvIGZhbGxiYWNrOicsIHJvdXRlRXJyb3IpO1xuICAgICAgICAvLyBGYWxsYmFjayBhIGZ1bmNpw7NuIG9yaWdpbmFsXG4gICAgICAgIHJldHVybiBhd2FpdCBnZXRBdXRoZW50aWNhdGVkVXNlcihyZXF1ZXN0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjayBhIGZ1bmNpw7NuIG9yaWdpbmFsXG4gICAgcmV0dXJuIGF3YWl0IGdldEF1dGhlbnRpY2F0ZWRVc2VyKHJlcXVlc3QpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tBVVRIXSBFcnJvciBlbiBnZXRVbmlmaWVkQXV0aDonLCBlcnJvcik7XG4gICAgLy8gRW4gbHVnYXIgZGUgbGFuemFyIGVycm9yLCByZXRvcm5hciByZXN1bHRhZG8gZGUgZmFsbGJhY2tcbiAgICByZXR1cm4gYXdhaXQgZ2V0QXV0aGVudGljYXRlZFVzZXIocmVxdWVzdCk7XG4gIH1cbn1cblxuLyoqXG4gKiBPYnRpZW5lIGVsIHBlcmZpbCBjb21wbGV0byBkZWwgdXN1YXJpbyBkZXNkZSBTdXBhYmFzZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlclByb2ZpbGUoY2xlcmtVc2VySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlclByb2ZpbGUgfCBudWxsPiB7XG4gIHRyeSB7XG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGFkbWluIGNsaWVudCBub3QgYXZhaWxhYmxlJyk7XG4gICAgfVxuXG4gICAgLy8gUHJpbWVybyBvYnRlbmVyIGVsIHBlcmZpbCBkZWwgdXN1YXJpb1xuICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZSwgZXJyb3I6IHByb2ZpbGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ2NsZXJrX3VzZXJfaWQnLCBjbGVya1VzZXJJZClcbiAgICAgIC5lcSgnaXNfYWN0aXZlJywgdHJ1ZSlcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChwcm9maWxlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHVzZXIgcHJvZmlsZTonLCBwcm9maWxlRXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKCFwcm9maWxlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBMdWVnbyBvYnRlbmVyIGVsIHJvbCBkZWwgdXN1YXJpb1xuICAgIGNvbnN0IHsgZGF0YTogcm9sZSwgZXJyb3I6IHJvbGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oJ3VzZXJfcm9sZXMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ2lkJywgcHJvZmlsZS5yb2xlX2lkKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKHJvbGVFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgdXNlciByb2xlOicsIHJvbGVFcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBDb21iaW5hciBsb3MgZGF0b3NcbiAgICBjb25zdCB1c2VyUHJvZmlsZTogVXNlclByb2ZpbGUgPSB7XG4gICAgICAuLi5wcm9maWxlLFxuICAgICAgdXNlcl9yb2xlczogcm9sZVxuICAgIH07XG5cbiAgICByZXR1cm4gdXNlclByb2ZpbGU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0VXNlclByb2ZpbGU6JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8qKlxuICogVmVyaWZpY2Egc2kgdW4gdXN1YXJpbyB0aWVuZSBhY2Nlc28gYWwgcGFuZWwgYWRtaW5pc3RyYXRpdm9cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrQWRtaW5BY2Nlc3MoY2xlcmtVc2VySWQ6IHN0cmluZyk6IFByb21pc2U8QWRtaW5BdXRoUmVzdWx0PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcHJvZmlsZSA9IGF3YWl0IGdldFVzZXJQcm9maWxlKGNsZXJrVXNlcklkKTtcbiAgICBcbiAgICBpZiAoIXByb2ZpbGUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ1BlcmZpbCBkZSB1c3VhcmlvIG5vIGVuY29udHJhZG8nLFxuICAgICAgICBzdGF0dXM6IDQwNFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoIXByb2ZpbGUudXNlcl9yb2xlcyB8fCAhcHJvZmlsZS5pc19hY3RpdmUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ1JvbCBkZSB1c3VhcmlvIG5vIHbDoWxpZG8nLFxuICAgICAgICBzdGF0dXM6IDQwM1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgc2kgdGllbmUgYWNjZXNvIGFsIHBhbmVsIGFkbWluXG4gICAgY29uc3QgaGFzQWRtaW5BY2Nlc3MgPSBoYXNQZXJtaXNzaW9uKHByb2ZpbGUsIFsnYWRtaW5fcGFuZWwnLCAnYWNjZXNzJ10pO1xuICAgIFxuICAgIGlmICghaGFzQWRtaW5BY2Nlc3MpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ0FjY2VzbyBkZW5lZ2FkbyBhbCBwYW5lbCBhZG1pbmlzdHJhdGl2bycsXG4gICAgICAgIHN0YXR1czogNDAzXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdXNlcjogcHJvZmlsZVxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY2hlY2tBZG1pbkFjY2VzczonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicsXG4gICAgICBzdGF0dXM6IDUwMFxuICAgIH07XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZVTkNJT05FUyBERSBWRVJJRklDQUNJw5NOIERFIFBFUk1JU09TXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFZlcmlmaWNhIHNpIHVuIHVzdWFyaW8gdGllbmUgdW4gcGVybWlzbyBlc3BlY8OtZmljb1xuICovXG5leHBvcnQgZnVuY3Rpb24gaGFzUGVybWlzc2lvbihcbiAgdXNlclByb2ZpbGU6IFVzZXJQcm9maWxlLFxuICBwZXJtaXNzaW9uUGF0aDogc3RyaW5nW11cbik6IGJvb2xlYW4ge1xuICB0cnkge1xuICAgIGlmICghdXNlclByb2ZpbGUudXNlcl9yb2xlcyB8fCAhdXNlclByb2ZpbGUudXNlcl9yb2xlcy5wZXJtaXNzaW9ucykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGxldCBjdXJyZW50OiBhbnkgPSB1c2VyUHJvZmlsZS51c2VyX3JvbGVzLnBlcm1pc3Npb25zO1xuICAgIFxuICAgIGZvciAoY29uc3QgcGF0aCBvZiBwZXJtaXNzaW9uUGF0aCkge1xuICAgICAgaWYgKGN1cnJlbnRbcGF0aF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjdXJyZW50ID0gY3VycmVudFtwYXRoXTtcbiAgICB9XG5cbiAgICAvLyBNYW5lamFyIGRpZmVyZW50ZXMgdGlwb3MgZGUgdmFsb3JlcyBkZSBwZXJtaXNvc1xuICAgIGlmICh0eXBlb2YgY3VycmVudCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICByZXR1cm4gY3VycmVudDtcbiAgICB9XG4gICAgXG4gICAgaWYgKHR5cGVvZiBjdXJyZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgLy8gUGFyYSBwZXJtaXNvcyBjb21vIFwib3duXCIsIFwib3duX2xpbWl0ZWRcIiwgZXRjLlxuICAgICAgcmV0dXJuIGN1cnJlbnQgIT09ICdmYWxzZSc7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIHBlcm1pc3Npb246JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIFZlcmlmaWNhIG3Dumx0aXBsZXMgcGVybWlzb3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhhc0FueVBlcm1pc3Npb24oXG4gIHVzZXJQcm9maWxlOiBVc2VyUHJvZmlsZSxcbiAgcGVybWlzc2lvbnM6IHN0cmluZ1tdW11cbik6IGJvb2xlYW4ge1xuICByZXR1cm4gcGVybWlzc2lvbnMuc29tZShwZXJtaXNzaW9uID0+IGhhc1Blcm1pc3Npb24odXNlclByb2ZpbGUsIHBlcm1pc3Npb24pKTtcbn1cblxuLyoqXG4gKiBWZXJpZmljYSB0b2RvcyBsb3MgcGVybWlzb3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhhc0FsbFBlcm1pc3Npb25zKFxuICB1c2VyUHJvZmlsZTogVXNlclByb2ZpbGUsXG4gIHBlcm1pc3Npb25zOiBzdHJpbmdbXVtdXG4pOiBib29sZWFuIHtcbiAgcmV0dXJuIHBlcm1pc3Npb25zLmV2ZXJ5KHBlcm1pc3Npb24gPT4gaGFzUGVybWlzc2lvbih1c2VyUHJvZmlsZSwgcGVybWlzc2lvbikpO1xufVxuXG4vKipcbiAqIFZlcmlmaWNhIHNpIGVsIHVzdWFyaW8gZXMgYWRtaW5pc3RyYWRvclxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNBZG1pbih1c2VyUHJvZmlsZTogVXNlclByb2ZpbGUpOiBib29sZWFuIHtcbiAgcmV0dXJuIHVzZXJQcm9maWxlLnVzZXJfcm9sZXM/LnJvbGVfbmFtZSA9PT0gJ2FkbWluJztcbn1cblxuLyoqXG4gKiBWZXJpZmljYSBzaSBlbCB1c3VhcmlvIGVzIG1vZGVyYWRvciBvIGFkbWluaXN0cmFkb3JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzTW9kZXJhdG9yT3JBZG1pbih1c2VyUHJvZmlsZTogVXNlclByb2ZpbGUpOiBib29sZWFuIHtcbiAgY29uc3Qgcm9sZSA9IHVzZXJQcm9maWxlLnVzZXJfcm9sZXM/LnJvbGVfbmFtZTtcbiAgcmV0dXJuIHJvbGUgPT09ICdhZG1pbicgfHwgcm9sZSA9PT0gJ21vZGVyYXRvcic7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNSURETEVXQVJFIERFIEFVVE9SSVpBQ0nDk05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogTWlkZGxld2FyZSBwcmluY2lwYWwgcGFyYSB2ZXJpZmljYXIgcGVybWlzb3MgYWRtaW5pc3RyYXRpdm9zXG4gKiBBY3R1YWxpemFkbyBjb24gdmFsaWRhY2lvbmVzIGRlIHNlZ3VyaWRhZCBhdmFuemFkYXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrQWRtaW5QZXJtaXNzaW9ucyhcbiAgcmVxdWlyZWRQZXJtaXNzaW9ucz86IHN0cmluZ1tdW10sXG4gIHJlcXVlc3Q/OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0XG4pOiBQcm9taXNlPEFkbWluQXV0aFJlc3VsdCAmIHsgc3VwYWJhc2U/OiB0eXBlb2Ygc3VwYWJhc2VBZG1pbjsgc2VjdXJpdHlDb250ZXh0PzogU2VjdXJpdHlDb250ZXh0IH0+IHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBWZXJpZmljYXIgYXV0ZW50aWNhY2nDs24gY29uIENsZXJrIHVzYW5kbyBtw6l0b2RvcyBvZmljaWFsZXNcbiAgICBsZXQgdXNlcklkOiBzdHJpbmc7XG4gICAgbGV0IHNlc3Npb25JZDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGF1dGhSZXN1bHQgPSBhd2FpdCBnZXRVbmlmaWVkQXV0aChyZXF1ZXN0KTtcbiAgICAgIHVzZXJJZCA9IGF1dGhSZXN1bHQudXNlcklkO1xuICAgICAgc2Vzc2lvbklkID0gYXV0aFJlc3VsdC5zZXNzaW9uSWQ7XG5cbiAgICAgIC8vIExvZyBhdXRlbnRpY2FjacOzbiBleGl0b3NhXG4gICAgICBjb25zdCBzZWN1cml0eUNvbnRleHQgPSBhd2FpdCBnZXRTZWN1cml0eUNvbnRleHQodXNlcklkLCByZXF1ZXN0KTtcbiAgICAgIGlmIChzZWN1cml0eUNvbnRleHQpIHtcbiAgICAgICAgYXdhaXQgbG9nQXV0aFN1Y2Nlc3ModXNlcklkLCBzZWN1cml0eUNvbnRleHQsIHJlcXVlc3QpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGF1dGhFcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdbQVVUSF0gRXJyb3IgZW4gYXV0ZW50aWNhY2nDs24gdW5pZmljYWRhLCBpbnRlbnRhbmRvIGZhbGxiYWNrJyk7XG4gICAgICBhd2FpdCBsb2dBdXRoRmFpbHVyZShudWxsLCBgRXJyb3IgZGUgYXV0ZW50aWNhY2nDs246ICR7YXV0aEVycm9yLm1lc3NhZ2V9YCwgcmVxdWVzdCk7XG5cbiAgICAgIGNvbnN0IGZhbGxiYWNrUmVzdWx0ID0gYXdhaXQgZ2V0QXV0aGVudGljYXRlZFVzZXIocmVxdWVzdCk7XG4gICAgICBpZiAoIWZhbGxiYWNrUmVzdWx0LnVzZXJJZCkge1xuICAgICAgICBhd2FpdCBsb2dBdXRoRmFpbHVyZShudWxsLCBmYWxsYmFja1Jlc3VsdC5lcnJvciB8fCAnTm8gYXV0b3JpemFkbycsIHJlcXVlc3QpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiBmYWxsYmFja1Jlc3VsdC5lcnJvciB8fCAnTm8gYXV0b3JpemFkbycsXG4gICAgICAgICAgc3RhdHVzOiA0MDFcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHVzZXJJZCA9IGZhbGxiYWNrUmVzdWx0LnVzZXJJZDtcbiAgICAgIHNlc3Npb25JZCA9IGZhbGxiYWNrUmVzdWx0LnNlc3Npb25JZDtcbiAgICB9XG5cbiAgICAvLyAyLiBFamVjdXRhciBkZXRlY2Npw7NuIGRlIHNlZ3VyaWRhZFxuICAgIGF3YWl0IHJ1blNlY3VyaXR5RGV0ZWN0aW9uKHVzZXJJZCk7XG5cbiAgICAvLyAzLiBPYnRlbmVyIGNvbnRleHRvIGRlIHNlZ3VyaWRhZCBjb21wbGV0b1xuICAgIGNvbnN0IHNlY3VyaXR5Q29udGV4dCA9IGF3YWl0IGdldFNlY3VyaXR5Q29udGV4dCh1c2VySWQsIHJlcXVlc3QpO1xuICAgIGlmICghc2VjdXJpdHlDb250ZXh0KSB7XG4gICAgICBhd2FpdCBsb2dBdXRoRmFpbHVyZSh1c2VySWQsICdObyBzZSBwdWRvIG9idGVuZXIgY29udGV4dG8gZGUgc2VndXJpZGFkJywgcmVxdWVzdCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdFcnJvciBvYnRlbmllbmRvIGNvbnRleHRvIGRlIHNlZ3VyaWRhZCcsXG4gICAgICAgIHN0YXR1czogNTAwXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIDQuIFZlcmlmaWNhciBkaXNwb25pYmlsaWRhZCBkZSBTdXBhYmFzZVxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnU2VydmljaW8gYWRtaW5pc3RyYXRpdm8gbm8gZGlzcG9uaWJsZScsXG4gICAgICAgIHN0YXR1czogNTAzXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIDUuIFZlcmlmaWNhciBhY2Nlc28gYWRtaW5pc3RyYXRpdm8gYsOhc2ljb1xuICAgIGNvbnN0IGFkbWluQ2hlY2sgPSBhd2FpdCBjaGVja0FkbWluQWNjZXNzKHVzZXJJZCk7XG5cbiAgICBpZiAoIWFkbWluQ2hlY2suc3VjY2Vzcykge1xuICAgICAgYXdhaXQgbG9nUGVybWlzc2lvbkRlbmllZCh1c2VySWQsICdBRE1JTl9BQ0NFU1MnLCBbJ2FkbWluX3BhbmVsJ10sIHNlY3VyaXR5Q29udGV4dCk7XG4gICAgICByZXR1cm4gYWRtaW5DaGVjaztcbiAgICB9XG5cbiAgICBjb25zdCB1c2VyUHJvZmlsZSA9IGFkbWluQ2hlY2sudXNlciE7XG5cbiAgICAvLyA2LiBWZXJpZmljYXIgcGVybWlzb3MgZXNwZWPDrWZpY29zIGNvbiB2YWxpZGFjaW9uZXMgZGUgc2VndXJpZGFkXG4gICAgaWYgKHJlcXVpcmVkUGVybWlzc2lvbnMgJiYgcmVxdWlyZWRQZXJtaXNzaW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBoYXNSZXF1aXJlZFBlcm1pc3Npb25zID0gaGFzQW55UGVybWlzc2lvbih1c2VyUHJvZmlsZSwgcmVxdWlyZWRQZXJtaXNzaW9ucyk7XG5cbiAgICAgIGlmICghaGFzUmVxdWlyZWRQZXJtaXNzaW9ucykge1xuICAgICAgICBhd2FpdCBsb2dQZXJtaXNzaW9uRGVuaWVkKFxuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAnU1BFQ0lGSUNfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIHJlcXVpcmVkUGVybWlzc2lvbnMuZmxhdCgpLFxuICAgICAgICAgIHNlY3VyaXR5Q29udGV4dFxuICAgICAgICApO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnUGVybWlzb3MgaW5zdWZpY2llbnRlcyBwYXJhIGVzdGEgb3BlcmFjacOzbicsXG4gICAgICAgICAgc3RhdHVzOiA0MDNcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyA3LiBSZWdpc3RyYXIgYWNjZXNvIGVuIGF1ZGl0IGxvZ1xuICAgIGF3YWl0IGxvZ0FkbWluQWNjZXNzKHVzZXJQcm9maWxlLmlkLCAnQVBJX0FDQ0VTUycpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB1c2VyOiB1c2VyUHJvZmlsZSxcbiAgICAgIHN1cGFiYXNlOiBzdXBhYmFzZUFkbWluLFxuICAgICAgc2VjdXJpdHlDb250ZXh0XG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBjaGVja0FkbWluUGVybWlzc2lvbnM6JywgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3InLFxuICAgICAgc3RhdHVzOiA1MDBcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogTWlkZGxld2FyZSBlc3BlY8OtZmljbyBwYXJhIG9wZXJhY2lvbmVzIENSVUQgY29uIHZhbGlkYWNpb25lcyBkZSBzZWd1cmlkYWRcbiAqIEFjdHVhbGl6YWRvIHBhcmEgc29wb3J0YXIgdGFudG8gTmV4dFJlcXVlc3QgY29tbyBOZXh0QXBpUmVxdWVzdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tDUlVEUGVybWlzc2lvbnMoXG4gIHJlc291cmNlOiBzdHJpbmcsXG4gIGFjdGlvbjogJ2NyZWF0ZScgfCAncmVhZCcgfCAndXBkYXRlJyB8ICdkZWxldGUnLFxuICByZXF1ZXN0PzogTmV4dFJlcXVlc3QgfCBOZXh0QXBpUmVxdWVzdFxuKTogUHJvbWlzZTxBZG1pbkF1dGhSZXN1bHQgJiB7IHN1cGFiYXNlPzogdHlwZW9mIHN1cGFiYXNlQWRtaW47IHNlY3VyaXR5Q29udGV4dD86IFNlY3VyaXR5Q29udGV4dCB9PiB7XG4gIGNvbnN0IHJlcXVpcmVkUGVybWlzc2lvbnMgPSBbW3Jlc291cmNlLCBhY3Rpb25dXTtcbiAgcmV0dXJuIGNoZWNrQWRtaW5QZXJtaXNzaW9ucyhyZXF1aXJlZFBlcm1pc3Npb25zLCByZXF1ZXN0KTtcbn1cblxuLyoqXG4gKiBOdWV2YSBmdW5jacOzbiBkZSB2YWxpZGFjacOzbiBkZSBzZWd1cmlkYWQgYXZhbnphZGFcbiAqIEludGVncmEgdG9kYXMgbGFzIHZhbGlkYWNpb25lcyBkZSBzZWd1cmlkYWQgZW4gdW5hIHNvbGEgZnVuY2nDs25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrQWR2YW5jZWRTZWN1cml0eShcbiAgdXNlcklkOiBzdHJpbmcsXG4gIG9wZXJhdGlvbjogc3RyaW5nLFxuICByZXF1aXJlZFBlcm1pc3Npb25zOiBzdHJpbmdbXSxcbiAgcmVxdWVzdD86IE5leHRSZXF1ZXN0IHwgTmV4dEFwaVJlcXVlc3Rcbik6IFByb21pc2U8U2VjdXJpdHlWYWxpZGF0aW9uUmVzdWx0ICYgeyB1c2VyUHJvZmlsZT86IFVzZXJQcm9maWxlOyBzdXBhYmFzZT86IHR5cGVvZiBzdXBhYmFzZUFkbWluIH0+IHtcbiAgdHJ5IHtcbiAgICAvLyAxLiBFamVjdXRhciBkZXRlY2Npw7NuIGRlIHNlZ3VyaWRhZFxuICAgIGF3YWl0IHJ1blNlY3VyaXR5RGV0ZWN0aW9uKHVzZXJJZCk7XG5cbiAgICAvLyAyLiBWYWxpZGFyIGNvbnRleHRvIGRlIHNlZ3VyaWRhZFxuICAgIGNvbnN0IHNlY3VyaXR5VmFsaWRhdGlvbiA9IGF3YWl0IHZhbGlkYXRlU2VjdXJpdHlDb250ZXh0KFxuICAgICAgdXNlcklkLFxuICAgICAgb3BlcmF0aW9uLFxuICAgICAgcmVxdWlyZWRQZXJtaXNzaW9ucyBhcyBhbnksXG4gICAgICByZXF1ZXN0XG4gICAgKTtcblxuICAgIGlmICghc2VjdXJpdHlWYWxpZGF0aW9uLnZhbGlkKSB7XG4gICAgICByZXR1cm4gc2VjdXJpdHlWYWxpZGF0aW9uO1xuICAgIH1cblxuICAgIC8vIDMuIE9idGVuZXIgcGVyZmlsIGRlIHVzdWFyaW8gZGVzZGUgU3VwYWJhc2VcbiAgICBjb25zdCB1c2VyUHJvZmlsZSA9IGF3YWl0IGdldFVzZXJQcm9maWxlKHVzZXJJZCk7XG4gICAgaWYgKCF1c2VyUHJvZmlsZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ1BlcmZpbCBkZSB1c3VhcmlvIG5vIGVuY29udHJhZG8nLFxuICAgICAgICBjb2RlOiAnVVNFUl9QUk9GSUxFX05PVF9GT1VORCcsXG4gICAgICAgIHNldmVyaXR5OiAnaGlnaCdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gNC4gVmVyaWZpY2FyIGRpc3BvbmliaWxpZGFkIGRlIFN1cGFiYXNlXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnU2VydmljaW8gYWRtaW5pc3RyYXRpdm8gbm8gZGlzcG9uaWJsZScsXG4gICAgICAgIGNvZGU6ICdTRVJWSUNFX1VOQVZBSUxBQkxFJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdjcml0aWNhbCdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgY29udGV4dDogc2VjdXJpdHlWYWxpZGF0aW9uLmNvbnRleHQsXG4gICAgICB1c2VyUHJvZmlsZSxcbiAgICAgIHN1cGFiYXNlOiBzdXBhYmFzZUFkbWluXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIGVuIGNoZWNrQWR2YW5jZWRTZWN1cml0eTonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnRXJyb3IgaW50ZXJubyBlbiB2YWxpZGFjacOzbiBkZSBzZWd1cmlkYWQnLFxuICAgICAgY29kZTogJ1NFQ1VSSVRZX1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgc2V2ZXJpdHk6ICdjcml0aWNhbCdcbiAgICB9O1xuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBGVU5DSU9ORVMgREUgTE9HR0lORyBZIEFVRElUT1LDjUFcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogUmVnaXN0cmEgYWNjZXNvIGFkbWluaXN0cmF0aXZvIGVuIGVsIGF1ZGl0IGxvZ1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nQWRtaW5BY2Nlc3MoXG4gIHVzZXJQcm9maWxlSWQ6IHN0cmluZyxcbiAgYWN0aW9uOiBzdHJpbmcsXG4gIHJlc291cmNlVHlwZT86IHN0cmluZyxcbiAgcmVzb3VyY2VJZD86IHN0cmluZyxcbiAgYWRkaXRpb25hbERhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgdHJ5IHtcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHJldHVybjtcblxuICAgIGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKCdhZG1pbl9hdWRpdF9sb2cnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHVzZXJfaWQ6IHVzZXJQcm9maWxlSWQsXG4gICAgICAgIGFjdGlvbixcbiAgICAgICAgcmVzb3VyY2VfdHlwZTogcmVzb3VyY2VUeXBlIHx8ICdzeXN0ZW0nLFxuICAgICAgICByZXNvdXJjZV9pZDogcmVzb3VyY2VJZCxcbiAgICAgICAgbmV3X3ZhbHVlczogYWRkaXRpb25hbERhdGEgPyBKU09OLnN0cmluZ2lmeShhZGRpdGlvbmFsRGF0YSkgOiBudWxsXG4gICAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2dnaW5nIGFkbWluIGFjY2VzczonLCBlcnJvcik7XG4gICAgLy8gTm8gbGFuemFyIGVycm9yIHBhcmEgbm8gaW50ZXJydW1waXIgZWwgZmx1am8gcHJpbmNpcGFsXG4gIH1cbn1cblxuLyoqXG4gKiBSZWdpc3RyYSBjYW1iaW9zIGVuIHJlY3Vyc29zIGFkbWluaXN0cmF0aXZvc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nQWRtaW5BY3Rpb24oXG4gIHVzZXJQcm9maWxlSWQ6IHN0cmluZyxcbiAgYWN0aW9uOiBzdHJpbmcsXG4gIHJlc291cmNlVHlwZTogc3RyaW5nLFxuICByZXNvdXJjZUlkOiBzdHJpbmcsXG4gIG9sZFZhbHVlcz86IGFueSxcbiAgbmV3VmFsdWVzPzogYW55XG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgdHJ5IHtcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHJldHVybjtcblxuICAgIGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKCdhZG1pbl9hdWRpdF9sb2cnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHVzZXJfaWQ6IHVzZXJQcm9maWxlSWQsXG4gICAgICAgIGFjdGlvbixcbiAgICAgICAgcmVzb3VyY2VfdHlwZTogcmVzb3VyY2VUeXBlLFxuICAgICAgICByZXNvdXJjZV9pZDogcmVzb3VyY2VJZCxcbiAgICAgICAgb2xkX3ZhbHVlczogb2xkVmFsdWVzID8gSlNPTi5zdHJpbmdpZnkob2xkVmFsdWVzKSA6IG51bGwsXG4gICAgICAgIG5ld192YWx1ZXM6IG5ld1ZhbHVlcyA/IEpTT04uc3RyaW5naWZ5KG5ld1ZhbHVlcykgOiBudWxsXG4gICAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2dnaW5nIGFkbWluIGFjdGlvbjonLCBlcnJvcik7XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFVUSUxJREFERVMgUEFSQSBORVhULkpTIEFQSSBST1VURVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogV3JhcHBlciBwYXJhIEFQSSByb3V0ZXMgcXVlIHJlcXVpZXJlbiBhdXRlbnRpY2FjacOzbiBhZG1pbiAoQXBwIFJvdXRlcilcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhBZG1pbkF1dGgoXG4gIGhhbmRsZXI6IChcbiAgICByZXF1ZXN0OiBOZXh0UmVxdWVzdCxcbiAgICBjb250ZXh0OiB7IHVzZXI6IFVzZXJQcm9maWxlOyBzdXBhYmFzZTogdHlwZW9mIHN1cGFiYXNlQWRtaW4gfVxuICApID0+IFByb21pc2U8UmVzcG9uc2U+LFxuICByZXF1aXJlZFBlcm1pc3Npb25zPzogc3RyaW5nW11bXVxuKSB7XG4gIHJldHVybiBhc3luYyAocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPFJlc3BvbnNlPiA9PiB7XG4gICAgY29uc3QgYXV0aFJlc3VsdCA9IGF3YWl0IGNoZWNrQWRtaW5QZXJtaXNzaW9ucyhyZXF1aXJlZFBlcm1pc3Npb25zLCByZXF1ZXN0KTtcblxuICAgIGlmICghYXV0aFJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IGF1dGhSZXN1bHQuZXJyb3JcbiAgICAgICAgfSksXG4gICAgICAgIHtcbiAgICAgICAgICBzdGF0dXM6IGF1dGhSZXN1bHQuc3RhdHVzIHx8IDUwMCxcbiAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBoYW5kbGVyKHJlcXVlc3QsIHtcbiAgICAgIHVzZXI6IGF1dGhSZXN1bHQudXNlciEsXG4gICAgICBzdXBhYmFzZTogYXV0aFJlc3VsdC5zdXBhYmFzZSFcbiAgICB9KTtcbiAgfTtcbn1cblxuLyoqXG4gKiBXcmFwcGVyIHBhcmEgUGFnZXMgUm91dGVyIEFQSSBSb3V0ZXMgcXVlIHJlcXVpZXJlbiBhdXRlbnRpY2FjacOzbiBhZG1pblxuICovXG5leHBvcnQgZnVuY3Rpb24gd2l0aEFkbWluQXV0aFBhZ2VzKFxuICBoYW5kbGVyOiAoXG4gICAgcmVxOiBOZXh0QXBpUmVxdWVzdCxcbiAgICByZXM6IE5leHRBcGlSZXNwb25zZSxcbiAgICBjb250ZXh0OiB7IHVzZXI6IFVzZXJQcm9maWxlOyBzdXBhYmFzZTogdHlwZW9mIHN1cGFiYXNlQWRtaW4gfVxuICApID0+IFByb21pc2U8dm9pZD4sXG4gIHJlcXVpcmVkUGVybWlzc2lvbnM/OiBzdHJpbmdbXVtdXG4pIHtcbiAgcmV0dXJuIGFzeW5jIChyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIGNvbnN0IGF1dGhSZXN1bHQgPSBhd2FpdCBjaGVja0FkbWluUGVybWlzc2lvbnMocmVxdWlyZWRQZXJtaXNzaW9ucywgcmVxKTtcblxuICAgIGlmICghYXV0aFJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyhhdXRoUmVzdWx0LnN0YXR1cyB8fCA1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGF1dGhSZXN1bHQuZXJyb3JcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBoYW5kbGVyKHJlcSwgcmVzLCB7XG4gICAgICB1c2VyOiBhdXRoUmVzdWx0LnVzZXIhLFxuICAgICAgc3VwYWJhc2U6IGF1dGhSZXN1bHQuc3VwYWJhc2UhXG4gICAgfSk7XG4gIH07XG59XG5cbi8qKlxuICogRXh0cmFlIGluZm9ybWFjacOzbiBkZSBsYSByZXF1ZXN0IHBhcmEgbG9nZ2luZ1xuICogU29wb3J0YSB0YW50byBOZXh0UmVxdWVzdCBjb21vIE5leHRBcGlSZXF1ZXN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRSZXF1ZXN0SW5mbyhyZXF1ZXN0OiBOZXh0UmVxdWVzdCB8IE5leHRBcGlSZXF1ZXN0KSB7XG4gIGlmICgncXVlcnknIGluIHJlcXVlc3QpIHtcbiAgICAvLyBOZXh0QXBpUmVxdWVzdCAoUGFnZXMgUm91dGVyKVxuICAgIGNvbnN0IHJlcSA9IHJlcXVlc3QgYXMgTmV4dEFwaVJlcXVlc3Q7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1ldGhvZDogcmVxLm1ldGhvZCB8fCAnR0VUJyxcbiAgICAgIHVybDogcmVxLnVybCB8fCAndW5rbm93bicsXG4gICAgICB1c2VyQWdlbnQ6IHJlcS5oZWFkZXJzWyd1c2VyLWFnZW50J10gfHwgJ3Vua25vd24nLFxuICAgICAgaXA6IHJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXSB8fFxuICAgICAgICAgIHJlcS5oZWFkZXJzWyd4LXJlYWwtaXAnXSB8fFxuICAgICAgICAgIHJlcS5jb25uZWN0aW9uPy5yZW1vdGVBZGRyZXNzIHx8XG4gICAgICAgICAgJ3Vua25vd24nXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICAvLyBOZXh0UmVxdWVzdCAoQXBwIFJvdXRlcilcbiAgICBjb25zdCByZXEgPSByZXF1ZXN0IGFzIE5leHRSZXF1ZXN0O1xuICAgIHJldHVybiB7XG4gICAgICBtZXRob2Q6IHJlcS5tZXRob2QsXG4gICAgICB1cmw6IHJlcS51cmwsXG4gICAgICB1c2VyQWdlbnQ6IHJlcS5oZWFkZXJzLmdldCgndXNlci1hZ2VudCcpIHx8ICd1bmtub3duJyxcbiAgICAgIGlwOiByZXEuaGVhZGVycy5nZXQoJ3gtZm9yd2FyZGVkLWZvcicpIHx8XG4gICAgICAgICAgcmVxLmhlYWRlcnMuZ2V0KCd4LXJlYWwtaXAnKSB8fFxuICAgICAgICAgICd1bmtub3duJ1xuICAgIH07XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJjaGVja0FkbWluQWNjZXNzIiwiY2hlY2tBZG1pblBlcm1pc3Npb25zIiwiY2hlY2tBZHZhbmNlZFNlY3VyaXR5IiwiY2hlY2tDUlVEUGVybWlzc2lvbnMiLCJnZXRBdXRoRnJvbUFwaVJvdXRlIiwiZ2V0QXV0aEZyb21Sb3V0ZUhhbmRsZXIiLCJnZXRBdXRoZW50aWNhdGVkVXNlciIsImdldFJlcXVlc3RJbmZvIiwiZ2V0VW5pZmllZEF1dGgiLCJnZXRVc2VyUHJvZmlsZSIsImhhc0FsbFBlcm1pc3Npb25zIiwiaGFzQW55UGVybWlzc2lvbiIsImhhc1Blcm1pc3Npb24iLCJpc0FkbWluIiwiaXNNb2RlcmF0b3JPckFkbWluIiwibG9nQWRtaW5BY2Nlc3MiLCJsb2dBZG1pbkFjdGlvbiIsIndpdGhBZG1pbkF1dGgiLCJ3aXRoQWRtaW5BdXRoUGFnZXMiLCJyZXF1ZXN0IiwidXNlcklkIiwic2Vzc2lvbklkIiwiZ2V0QXV0aCIsImNvbnNvbGUiLCJsb2ciLCJhdXRoIiwiYXV0aEVycm9yIiwid2FybiIsImNsZXJrVXNlcklkIiwiaGVhZGVycyIsImdldCIsInNlc3Npb25Ub2tlbiIsImNvb2tpZXMiLCJ2YWx1ZSIsInBheWxvYWQiLCJKU09OIiwicGFyc2UiLCJhdG9iIiwic3BsaXQiLCJzdWIiLCJqd3RFcnJvciIsImVycm9yIiwicmVxIiwicmVzIiwiZ2V0VG9rZW4iLCJFcnJvciIsImFwaUVycm9yIiwicm91dGVFcnJvciIsInN1cGFiYXNlQWRtaW4iLCJkYXRhIiwicHJvZmlsZSIsInByb2ZpbGVFcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsInJvbGUiLCJyb2xlRXJyb3IiLCJyb2xlX2lkIiwidXNlclByb2ZpbGUiLCJ1c2VyX3JvbGVzIiwic3VjY2VzcyIsInN0YXR1cyIsImlzX2FjdGl2ZSIsImhhc0FkbWluQWNjZXNzIiwidXNlciIsInBlcm1pc3Npb25QYXRoIiwicGVybWlzc2lvbnMiLCJjdXJyZW50IiwicGF0aCIsInVuZGVmaW5lZCIsInNvbWUiLCJwZXJtaXNzaW9uIiwiZXZlcnkiLCJyb2xlX25hbWUiLCJyZXF1aXJlZFBlcm1pc3Npb25zIiwiYXV0aFJlc3VsdCIsInNlY3VyaXR5Q29udGV4dCIsImdldFNlY3VyaXR5Q29udGV4dCIsImxvZ0F1dGhTdWNjZXNzIiwibG9nQXV0aEZhaWx1cmUiLCJtZXNzYWdlIiwiZmFsbGJhY2tSZXN1bHQiLCJydW5TZWN1cml0eURldGVjdGlvbiIsImFkbWluQ2hlY2siLCJsb2dQZXJtaXNzaW9uRGVuaWVkIiwibGVuZ3RoIiwiaGFzUmVxdWlyZWRQZXJtaXNzaW9ucyIsImZsYXQiLCJpZCIsInN1cGFiYXNlIiwicmVzb3VyY2UiLCJhY3Rpb24iLCJvcGVyYXRpb24iLCJzZWN1cml0eVZhbGlkYXRpb24iLCJ2YWxpZGF0ZVNlY3VyaXR5Q29udGV4dCIsInZhbGlkIiwiY29kZSIsInNldmVyaXR5IiwiY29udGV4dCIsInVzZXJQcm9maWxlSWQiLCJyZXNvdXJjZVR5cGUiLCJyZXNvdXJjZUlkIiwiYWRkaXRpb25hbERhdGEiLCJpbnNlcnQiLCJ1c2VyX2lkIiwicmVzb3VyY2VfdHlwZSIsInJlc291cmNlX2lkIiwibmV3X3ZhbHVlcyIsInN0cmluZ2lmeSIsIm9sZFZhbHVlcyIsIm5ld1ZhbHVlcyIsIm9sZF92YWx1ZXMiLCJoYW5kbGVyIiwiUmVzcG9uc2UiLCJqc29uIiwibWV0aG9kIiwidXJsIiwidXNlckFnZW50IiwiaXAiLCJjb25uZWN0aW9uIiwicmVtb3RlQWRkcmVzcyJdLCJtYXBwaW5ncyI6IkFBQUE7OztDQUdDOzs7Ozs7Ozs7OztJQXVQcUJBLGdCQUFnQjtlQUFoQkE7O0lBa0lBQyxxQkFBcUI7ZUFBckJBOztJQTRIQUMscUJBQXFCO2VBQXJCQTs7SUFiQUMsb0JBQW9CO2VBQXBCQTs7SUF0V05DLG1CQUFtQjtlQUFuQkE7O0lBZU1DLHVCQUF1QjtlQUF2QkE7O0lBbEZBQyxvQkFBb0I7ZUFBcEJBOztJQW9uQk5DLGNBQWM7ZUFBZEE7O0lBbmhCTUMsY0FBYztlQUFkQTs7SUFvQ0FDLGNBQWM7ZUFBZEE7O0lBdUpOQyxpQkFBaUI7ZUFBakJBOztJQVZBQyxnQkFBZ0I7ZUFBaEJBOztJQXRDQUMsYUFBYTtlQUFiQTs7SUEwREFDLE9BQU87ZUFBUEE7O0lBT0FDLGtCQUFrQjtlQUFsQkE7O0lBNE1NQyxjQUFjO2VBQWRBOztJQTRCQUMsY0FBYztlQUFkQTs7SUFpQ05DLGFBQWE7ZUFBYkE7O0lBaUNBQyxrQkFBa0I7ZUFBbEJBOzs7d0JBcHBCMkI7MEJBQ2I7cUNBUXZCOytCQU1BO0FBOENBLGVBQWVaLHFCQUNwQmEsT0FBc0M7SUFFdEMsSUFBSTtRQUNGLHNFQUFzRTtRQUN0RSxJQUFJQSxXQUFXLFdBQVdBLFNBQVM7WUFDakMsbUNBQW1DO1lBQ25DLE1BQU0sRUFBRUMsTUFBTSxFQUFFQyxTQUFTLEVBQUUsR0FBR0MsSUFBQUEsZUFBTyxFQUFDSDtZQUN0QyxJQUFJQyxRQUFRO2dCQUNWRyxRQUFRQyxHQUFHLENBQUMsQ0FBQyx3Q0FBd0MsRUFBRUosUUFBUTtnQkFDL0QsT0FBTztvQkFBRUE7b0JB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