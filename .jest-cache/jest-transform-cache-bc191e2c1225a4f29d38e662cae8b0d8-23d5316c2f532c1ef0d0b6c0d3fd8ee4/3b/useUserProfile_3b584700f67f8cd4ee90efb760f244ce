07966e278d5af6c7cd16fcd9d587ed4e
// ===================================
// PINTEYA E-COMMERCE - HOOK PARA PERFIL DE USUARIO
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "useUserProfile", {
    enumerable: true,
    get: function() {
        return useUserProfile;
    }
});
const _react = require("react");
const _useAuth = require("./useAuth");
const _sonner = require("sonner");
const _useNotifications = require("./useNotifications");
function useUserProfile() {
    const { isSignedIn, isLoaded } = (0, _useAuth.useAuth)();
    const { notifyProfileChange, notifySecurityAlert } = (0, _useNotifications.useNotifications)();
    const [profile, setProfile] = (0, _react.useState)(null);
    const [loading, setLoading] = (0, _react.useState)(true);
    const [error, setError] = (0, _react.useState)(null);
    const fetchProfile = (0, _react.useCallback)(async ()=>{
        if (!isSignedIn || !isLoaded) {
            setLoading(false);
            return;
        }
        try {
            setLoading(true);
            setError(null);
            const response = await fetch('/api/user/profile', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            if (!response.ok) {
                throw new Error('Error al obtener el perfil');
            }
            const data = await response.json();
            if (data.success && data.user) {
                setProfile(data.user);
            } else {
                throw new Error(data.error || 'Error al cargar el perfil');
            }
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'Error desconocido';
            setError(errorMessage);
            console.error('Error al obtener perfil:', err);
        } finally{
            setLoading(false);
        }
    }, [
        isSignedIn,
        isLoaded
    ]);
    const updateProfile = (0, _react.useCallback)(async (data)=>{
        if (!isSignedIn) {
            _sonner.toast.error('Debes estar autenticado para actualizar tu perfil');
            return false;
        }
        try {
            setLoading(true);
            setError(null);
            // Guardar valores anteriores para notificaciones
            const oldEmail = profile?.email;
            const oldPhone = profile?.phone;
            const response = await fetch('/api/user/profile', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            if (!response.ok) {
                throw new Error('Error al actualizar el perfil');
            }
            const result = await response.json();
            if (result.success && result.user) {
                setProfile(result.user);
                // Notificaciones básicas
                await notifyProfileChange('Perfil actualizado correctamente');
                // Notificaciones por email para cambios críticos
                if (data.email && data.email !== oldEmail) {
                    await notifySecurityAlert('Tu email ha sido actualizado. Revisa tu bandeja de entrada.', {
                        type: 'profile_email_changed',
                        oldValue: oldEmail,
                        newValue: data.email
                    }, {
                        toastType: 'info',
                        toastDuration: 6000
                    });
                }
                if (data.phone && data.phone !== oldPhone) {
                    await notifySecurityAlert('Tu teléfono ha sido actualizado.', {
                        type: 'profile_phone_changed',
                        oldValue: oldPhone,
                        newValue: data.phone
                    }, {
                        toastType: 'info',
                        toastDuration: 4000
                    });
                }
                return true;
            } else {
                throw new Error(result.error || 'Error al actualizar el perfil');
            }
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'Error desconocido';
            setError(errorMessage);
            _sonner.toast.error(errorMessage);
            console.error('Error al actualizar perfil:', err);
            return false;
        } finally{
            setLoading(false);
        }
    }, [
        isSignedIn,
        profile,
        notifyProfileChange,
        notifySecurityAlert
    ]);
    const uploadAvatar = (0, _react.useCallback)(async (file)=>{
        if (!isSignedIn) {
            _sonner.toast.error('Debes estar autenticado para subir un avatar');
            return false;
        }
        try {
            setLoading(true);
            setError(null);
            const formData = new FormData();
            formData.append('avatar', file);
            const response = await fetch('/api/user/avatar', {
                method: 'POST',
                body: formData
            });
            if (!response.ok) {
                throw new Error('Error al subir el avatar');
            }
            const result = await response.json();
            if (result.success) {
                if (profile) {
                    setProfile({
                        ...profile,
                        avatar_url: result.avatar_url,
                        updated_at: new Date().toISOString()
                    });
                }
                _sonner.toast.success('Avatar actualizado correctamente');
                return true;
            } else {
                throw new Error(result.error || 'Error al subir el avatar');
            }
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'Error desconocido';
            setError(errorMessage);
            _sonner.toast.error(errorMessage);
            console.error('Error al subir avatar:', err);
            return false;
        } finally{
            setLoading(false);
        }
    }, [
        isSignedIn,
        profile
    ]);
    const deleteAvatar = (0, _react.useCallback)(async ()=>{
        if (!isSignedIn) {
            _sonner.toast.error('Debes estar autenticado para eliminar tu avatar');
            return false;
        }
        try {
            setLoading(true);
            setError(null);
            const response = await fetch('/api/user/avatar', {
                method: 'DELETE'
            });
            if (!response.ok) {
                throw new Error('Error al eliminar el avatar');
            }
            const result = await response.json();
            if (result.success) {
                if (profile) {
                    setProfile({
                        ...profile,
                        avatar_url: undefined,
                        updated_at: new Date().toISOString()
                    });
                }
                _sonner.toast.success('Avatar eliminado correctamente');
                return true;
            } else {
                throw new Error(result.error || 'Error al eliminar el avatar');
            }
        } catch (err) {
            const errorMessage = err instanceof Error ? err.message : 'Error desconocido';
            setError(errorMessage);
            _sonner.toast.error(errorMessage);
            console.error('Error al eliminar avatar:', err);
            return false;
        } finally{
            setLoading(false);
        }
    }, [
        isSignedIn,
        profile
    ]);
    const refreshProfile = (0, _react.useCallback)(async ()=>{
        await fetchProfile();
    }, [
        fetchProfile
    ]);
    (0, _react.useEffect)(()=>{
        fetchProfile();
    }, [
        fetchProfile
    ]);
    return {
        profile,
        loading,
        error,
        updateProfile,
        refreshProfile,
        uploadAvatar,
        deleteAvatar
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZVVzZXJQcm9maWxlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIFBJTlRFWUEgRS1DT01NRVJDRSAtIEhPT0sgUEFSQSBQRVJGSUwgREUgVVNVQVJJT1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCB7IHVzZUF1dGggfSBmcm9tICcuL3VzZUF1dGgnO1xyXG5pbXBvcnQgeyB0b2FzdCB9IGZyb20gJ3Nvbm5lcic7XHJcbmltcG9ydCB7IHVzZU5vdGlmaWNhdGlvbnMgfSBmcm9tICcuL3VzZU5vdGlmaWNhdGlvbnMnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBVc2VyUHJvZmlsZSB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBjbGVya19pZDogc3RyaW5nO1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBlbWFpbDogc3RyaW5nO1xyXG4gIHBob25lPzogc3RyaW5nO1xyXG4gIGF2YXRhcl91cmw/OiBzdHJpbmc7XHJcbiAgY3JlYXRlZF9hdDogc3RyaW5nO1xyXG4gIHVwZGF0ZWRfYXQ6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVQcm9maWxlRGF0YSB7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbiAgcGhvbmU/OiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVXNlVXNlclByb2ZpbGVSZXR1cm4ge1xyXG4gIHByb2ZpbGU6IFVzZXJQcm9maWxlIHwgbnVsbDtcclxuICBsb2FkaW5nOiBib29sZWFuO1xyXG4gIGVycm9yOiBzdHJpbmcgfCBudWxsO1xyXG4gIHVwZGF0ZVByb2ZpbGU6IChkYXRhOiBVcGRhdGVQcm9maWxlRGF0YSkgPT4gUHJvbWlzZTxib29sZWFuPjtcclxuICByZWZyZXNoUHJvZmlsZTogKCkgPT4gUHJvbWlzZTx2b2lkPjtcclxuICB1cGxvYWRBdmF0YXI6IChmaWxlOiBGaWxlKSA9PiBQcm9taXNlPGJvb2xlYW4+O1xyXG4gIGRlbGV0ZUF2YXRhcjogKCkgPT4gUHJvbWlzZTxib29sZWFuPjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVzZVVzZXJQcm9maWxlKCk6IFVzZVVzZXJQcm9maWxlUmV0dXJuIHtcclxuICBjb25zdCB7IGlzU2lnbmVkSW4sIGlzTG9hZGVkIH0gPSB1c2VBdXRoKCk7XHJcbiAgY29uc3QgeyBub3RpZnlQcm9maWxlQ2hhbmdlLCBub3RpZnlTZWN1cml0eUFsZXJ0IH0gPSB1c2VOb3RpZmljYXRpb25zKCk7XHJcbiAgY29uc3QgW3Byb2ZpbGUsIHNldFByb2ZpbGVdID0gdXNlU3RhdGU8VXNlclByb2ZpbGUgfCBudWxsPihudWxsKTtcclxuICBjb25zdCBbbG9hZGluZywgc2V0TG9hZGluZ10gPSB1c2VTdGF0ZSh0cnVlKTtcclxuICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xyXG5cclxuICBjb25zdCBmZXRjaFByb2ZpbGUgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XHJcbiAgICBpZiAoIWlzU2lnbmVkSW4gfHwgIWlzTG9hZGVkKSB7XHJcbiAgICAgIHNldExvYWRpbmcoZmFsc2UpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgc2V0TG9hZGluZyh0cnVlKTtcclxuICAgICAgc2V0RXJyb3IobnVsbCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL3VzZXIvcHJvZmlsZScsIHtcclxuICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBhbCBvYnRlbmVyIGVsIHBlcmZpbCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG5cclxuICAgICAgaWYgKGRhdGEuc3VjY2VzcyAmJiBkYXRhLnVzZXIpIHtcclxuICAgICAgICBzZXRQcm9maWxlKGRhdGEudXNlcik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3IgfHwgJ0Vycm9yIGFsIGNhcmdhciBlbCBwZXJmaWwnKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiAnRXJyb3IgZGVzY29ub2NpZG8nO1xyXG4gICAgICBzZXRFcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBvYnRlbmVyIHBlcmZpbDonLCBlcnIpO1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICB9XHJcbiAgfSwgW2lzU2lnbmVkSW4sIGlzTG9hZGVkXSk7XHJcblxyXG4gIGNvbnN0IHVwZGF0ZVByb2ZpbGUgPSB1c2VDYWxsYmFjayhhc3luYyAoZGF0YTogVXBkYXRlUHJvZmlsZURhdGEpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcclxuICAgIGlmICghaXNTaWduZWRJbikge1xyXG4gICAgICB0b2FzdC5lcnJvcignRGViZXMgZXN0YXIgYXV0ZW50aWNhZG8gcGFyYSBhY3R1YWxpemFyIHR1IHBlcmZpbCcpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgc2V0TG9hZGluZyh0cnVlKTtcclxuICAgICAgc2V0RXJyb3IobnVsbCk7XHJcblxyXG4gICAgICAvLyBHdWFyZGFyIHZhbG9yZXMgYW50ZXJpb3JlcyBwYXJhIG5vdGlmaWNhY2lvbmVzXHJcbiAgICAgIGNvbnN0IG9sZEVtYWlsID0gcHJvZmlsZT8uZW1haWw7XHJcbiAgICAgIGNvbnN0IG9sZFBob25lID0gcHJvZmlsZT8ucGhvbmU7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL3VzZXIvcHJvZmlsZScsIHtcclxuICAgICAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBhbCBhY3R1YWxpemFyIGVsIHBlcmZpbCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcblxyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0LnVzZXIpIHtcclxuICAgICAgICBzZXRQcm9maWxlKHJlc3VsdC51c2VyKTtcclxuXHJcbiAgICAgICAgLy8gTm90aWZpY2FjaW9uZXMgYsOhc2ljYXNcclxuICAgICAgICBhd2FpdCBub3RpZnlQcm9maWxlQ2hhbmdlKCdQZXJmaWwgYWN0dWFsaXphZG8gY29ycmVjdGFtZW50ZScpO1xyXG5cclxuICAgICAgICAvLyBOb3RpZmljYWNpb25lcyBwb3IgZW1haWwgcGFyYSBjYW1iaW9zIGNyw610aWNvc1xyXG4gICAgICAgIGlmIChkYXRhLmVtYWlsICYmIGRhdGEuZW1haWwgIT09IG9sZEVtYWlsKSB7XHJcbiAgICAgICAgICBhd2FpdCBub3RpZnlTZWN1cml0eUFsZXJ0KFxyXG4gICAgICAgICAgICAnVHUgZW1haWwgaGEgc2lkbyBhY3R1YWxpemFkby4gUmV2aXNhIHR1IGJhbmRlamEgZGUgZW50cmFkYS4nLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgdHlwZTogJ3Byb2ZpbGVfZW1haWxfY2hhbmdlZCcsXHJcbiAgICAgICAgICAgICAgb2xkVmFsdWU6IG9sZEVtYWlsLFxyXG4gICAgICAgICAgICAgIG5ld1ZhbHVlOiBkYXRhLmVtYWlsLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7IHRvYXN0VHlwZTogJ2luZm8nLCB0b2FzdER1cmF0aW9uOiA2MDAwIH1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZGF0YS5waG9uZSAmJiBkYXRhLnBob25lICE9PSBvbGRQaG9uZSkge1xyXG4gICAgICAgICAgYXdhaXQgbm90aWZ5U2VjdXJpdHlBbGVydChcclxuICAgICAgICAgICAgJ1R1IHRlbMOpZm9ubyBoYSBzaWRvIGFjdHVhbGl6YWRvLicsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICB0eXBlOiAncHJvZmlsZV9waG9uZV9jaGFuZ2VkJyxcclxuICAgICAgICAgICAgICBvbGRWYWx1ZTogb2xkUGhvbmUsXHJcbiAgICAgICAgICAgICAgbmV3VmFsdWU6IGRhdGEucGhvbmUsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHsgdG9hc3RUeXBlOiAnaW5mbycsIHRvYXN0RHVyYXRpb246IDQwMDAgfVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQuZXJyb3IgfHwgJ0Vycm9yIGFsIGFjdHVhbGl6YXIgZWwgcGVyZmlsJyk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogJ0Vycm9yIGRlc2Nvbm9jaWRvJztcclxuICAgICAgc2V0RXJyb3IoZXJyb3JNZXNzYWdlKTtcclxuICAgICAgdG9hc3QuZXJyb3IoZXJyb3JNZXNzYWdlKTtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgYWN0dWFsaXphciBwZXJmaWw6JywgZXJyKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICB9XHJcbiAgfSwgW2lzU2lnbmVkSW4sIHByb2ZpbGUsIG5vdGlmeVByb2ZpbGVDaGFuZ2UsIG5vdGlmeVNlY3VyaXR5QWxlcnRdKTtcclxuXHJcbiAgY29uc3QgdXBsb2FkQXZhdGFyID0gdXNlQ2FsbGJhY2soYXN5bmMgKGZpbGU6IEZpbGUpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcclxuICAgIGlmICghaXNTaWduZWRJbikge1xyXG4gICAgICB0b2FzdC5lcnJvcignRGViZXMgZXN0YXIgYXV0ZW50aWNhZG8gcGFyYSBzdWJpciB1biBhdmF0YXInKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIHNldExvYWRpbmcodHJ1ZSk7XHJcbiAgICAgIHNldEVycm9yKG51bGwpO1xyXG5cclxuICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgZm9ybURhdGEuYXBwZW5kKCdhdmF0YXInLCBmaWxlKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvdXNlci9hdmF0YXInLCB7XHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgYm9keTogZm9ybURhdGEsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRXJyb3IgYWwgc3ViaXIgZWwgYXZhdGFyJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuXHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgIGlmIChwcm9maWxlKSB7XHJcbiAgICAgICAgICBzZXRQcm9maWxlKHtcclxuICAgICAgICAgICAgLi4ucHJvZmlsZSxcclxuICAgICAgICAgICAgYXZhdGFyX3VybDogcmVzdWx0LmF2YXRhcl91cmwsXHJcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0b2FzdC5zdWNjZXNzKCdBdmF0YXIgYWN0dWFsaXphZG8gY29ycmVjdGFtZW50ZScpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQuZXJyb3IgfHwgJ0Vycm9yIGFsIHN1YmlyIGVsIGF2YXRhcicpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIubWVzc2FnZSA6ICdFcnJvciBkZXNjb25vY2lkbyc7XHJcbiAgICAgIHNldEVycm9yKGVycm9yTWVzc2FnZSk7XHJcbiAgICAgIHRvYXN0LmVycm9yKGVycm9yTWVzc2FnZSk7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIHN1YmlyIGF2YXRhcjonLCBlcnIpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICBzZXRMb2FkaW5nKGZhbHNlKTtcclxuICAgIH1cclxuICB9LCBbaXNTaWduZWRJbiwgcHJvZmlsZV0pO1xyXG5cclxuICBjb25zdCBkZWxldGVBdmF0YXIgPSB1c2VDYWxsYmFjayhhc3luYyAoKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XHJcbiAgICBpZiAoIWlzU2lnbmVkSW4pIHtcclxuICAgICAgdG9hc3QuZXJyb3IoJ0RlYmVzIGVzdGFyIGF1dGVudGljYWRvIHBhcmEgZWxpbWluYXIgdHUgYXZhdGFyJyk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBzZXRMb2FkaW5nKHRydWUpO1xyXG4gICAgICBzZXRFcnJvcihudWxsKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvdXNlci9hdmF0YXInLCB7XHJcbiAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBhbCBlbGltaW5hciBlbCBhdmF0YXInKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG5cclxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgaWYgKHByb2ZpbGUpIHtcclxuICAgICAgICAgIHNldFByb2ZpbGUoe1xyXG4gICAgICAgICAgICAuLi5wcm9maWxlLFxyXG4gICAgICAgICAgICBhdmF0YXJfdXJsOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0b2FzdC5zdWNjZXNzKCdBdmF0YXIgZWxpbWluYWRvIGNvcnJlY3RhbWVudGUnKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzdWx0LmVycm9yIHx8ICdFcnJvciBhbCBlbGltaW5hciBlbCBhdmF0YXInKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiAnRXJyb3IgZGVzY29ub2NpZG8nO1xyXG4gICAgICBzZXRFcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICB0b2FzdC5lcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBlbGltaW5hciBhdmF0YXI6JywgZXJyKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICB9XHJcbiAgfSwgW2lzU2lnbmVkSW4sIHByb2ZpbGVdKTtcclxuXHJcbiAgY29uc3QgcmVmcmVzaFByb2ZpbGUgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XHJcbiAgICBhd2FpdCBmZXRjaFByb2ZpbGUoKTtcclxuICB9LCBbZmV0Y2hQcm9maWxlXSk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBmZXRjaFByb2ZpbGUoKTtcclxuICB9LCBbZmV0Y2hQcm9maWxlXSk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBwcm9maWxlLFxyXG4gICAgbG9hZGluZyxcclxuICAgIGVycm9yLFxyXG4gICAgdXBkYXRlUHJvZmlsZSxcclxuICAgIHJlZnJlc2hQcm9maWxlLFxyXG4gICAgdXBsb2FkQXZhdGFyLFxyXG4gICAgZGVsZXRlQXZhdGFyLFxyXG4gIH07XHJcbn1cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbInVzZVVzZXJQcm9maWxlIiwiaXNTaWduZWRJbiIsImlzTG9hZGVkIiwidXNlQXV0aCIsIm5vdGlmeVByb2ZpbGVDaGFuZ2UiLCJub3RpZnlTZWN1cml0eUFsZXJ0IiwidXNlTm90aWZpY2F0aW9ucyIsInByb2ZpbGUiLCJzZXRQcm9maWxlIiwidXNlU3RhdGUiLCJsb2FkaW5nIiwic2V0TG9hZGluZyIsImVycm9yIiwic2V0RXJyb3IiLCJmZXRjaFByb2ZpbGUiLCJ1c2VDYWxsYmFjayIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwib2siLCJFcnJvciIsImRhdGEiLCJqc29uIiwic3VjY2VzcyIsInVzZXIiLCJlcnIiLCJlcnJvck1lc3NhZ2UiLCJtZXNzYWdlIiwiY29uc29sZSIsInVwZGF0ZVByb2ZpbGUiLCJ0b2FzdCIsIm9sZEVtYWlsIiwiZW1haWwiLCJvbGRQaG9uZSIsInBob25lIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXN1bHQiLCJ0eXBlIiwib2xkVmFsdWUiLCJuZXdWYWx1ZSIsInRvYXN0VHlwZSIsInRvYXN0RHVyYXRpb24iLCJ1cGxvYWRBdmF0YXIiLCJmaWxlIiwiZm9ybURhdGEiLCJGb3JtRGF0YSIsImFwcGVuZCIsImF2YXRhcl91cmwiLCJ1cGRhdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiZGVsZXRlQXZhdGFyIiwidW5kZWZpbmVkIiwicmVmcmVzaFByb2ZpbGUiLCJ1c2VFZmZlY3QiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0QyxtREFBbUQ7QUFDbkQsc0NBQXNDOzs7OzsrQkFrQ3RCQTs7O2VBQUFBOzs7dUJBaENpQzt5QkFDekI7d0JBQ0Y7a0NBQ1c7QUE2QjFCLFNBQVNBO0lBQ2QsTUFBTSxFQUFFQyxVQUFVLEVBQUVDLFFBQVEsRUFBRSxHQUFHQyxJQUFBQSxnQkFBTztJQUN4QyxNQUFNLEVBQUVDLG1CQUFtQixFQUFFQyxtQkFBbUIsRUFBRSxHQUFHQyxJQUFB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