{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\useFilterAnalytics.ts"],"sourcesContent":["// ===================================\r\n// HOOK: useFilterAnalytics - Sistema de Analytics para Filtros\r\n// ===================================\r\n\r\nimport { useCallback, useEffect, useRef } from 'react';\r\nimport { ProductFilterState } from './useProductFilters';\r\n\r\n// ===================================\r\n// TIPOS\r\n// ===================================\r\n\r\nexport interface FilterAnalyticsEvent {\r\n  event: string;\r\n  category: 'filter';\r\n  action: string;\r\n  label?: string;\r\n  value?: number;\r\n  custom_parameters?: Record<string, any>;\r\n  timestamp: number;\r\n  session_id: string;\r\n  user_id?: string;\r\n  page_url: string;\r\n  page_title: string;\r\n}\r\n\r\nexport interface FilterMetrics {\r\n  filter_applied: {\r\n    filter_type: string;\r\n    filter_value: string;\r\n    results_count: number;\r\n    time_to_apply: number;\r\n  };\r\n  filter_removed: {\r\n    filter_type: string;\r\n    filter_value: string;\r\n    remaining_filters: number;\r\n  };\r\n  filter_cleared: {\r\n    total_filters_cleared: number;\r\n    filter_types: string[];\r\n  };\r\n  search_performed: {\r\n    query: string;\r\n    results_count: number;\r\n    has_filters: boolean;\r\n    filter_count: number;\r\n  };\r\n  pagination_used: {\r\n    from_page: number;\r\n    to_page: number;\r\n    total_pages: number;\r\n    results_per_page: number;\r\n  };\r\n  sort_changed: {\r\n    from_sort: string;\r\n    to_sort: string;\r\n    results_count: number;\r\n  };\r\n}\r\n\r\nexport interface UseFilterAnalyticsOptions {\r\n  enabled?: boolean;\r\n  debug?: boolean;\r\n  sessionId?: string;\r\n  userId?: string;\r\n}\r\n\r\n// ===================================\r\n// UTILIDADES\r\n// ===================================\r\n\r\n// Generar ID de sesión único\r\nconst generateSessionId = (): string => {\r\n  return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n};\r\n\r\n// Obtener o crear session ID\r\nconst getSessionId = (): string => {\r\n  if (typeof window === 'undefined') {return generateSessionId();}\r\n  \r\n  let sessionId = sessionStorage.getItem('filter_analytics_session');\r\n  if (!sessionId) {\r\n    sessionId = generateSessionId();\r\n    sessionStorage.setItem('filter_analytics_session', sessionId);\r\n  }\r\n  return sessionId;\r\n};\r\n\r\n// Enviar evento a Google Analytics 4\r\nconst sendToGA4 = (event: FilterAnalyticsEvent) => {\r\n  if (typeof window === 'undefined' || !window.gtag) {return;}\r\n\r\n  window.gtag('event', event.action, {\r\n    event_category: event.category,\r\n    event_label: event.label,\r\n    value: event.value,\r\n    custom_map: event.custom_parameters,\r\n    session_id: event.session_id,\r\n    page_location: event.page_url,\r\n    page_title: event.page_title,\r\n  });\r\n};\r\n\r\n// Enviar evento a Supabase Analytics\r\nconst sendToSupabase = async (event: FilterAnalyticsEvent) => {\r\n  try {\r\n    await fetch('/api/analytics/events', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify(event),\r\n    });\r\n  } catch (error) {\r\n    console.warn('Failed to send analytics event to Supabase:', error);\r\n  }\r\n};\r\n\r\n// ===================================\r\n// HOOK PRINCIPAL\r\n// ===================================\r\n\r\nexport function useFilterAnalytics(options: UseFilterAnalyticsOptions = {}) {\r\n  const {\r\n    enabled = true,\r\n    debug = process.env.NODE_ENV === 'development',\r\n    sessionId: providedSessionId,\r\n    userId,\r\n  } = options;\r\n\r\n  const sessionId = useRef(providedSessionId || getSessionId());\r\n  const startTime = useRef<number>(Date.now());\r\n\r\n  // Función para crear evento base\r\n  const createBaseEvent = useCallback((\r\n    action: string,\r\n    label?: string,\r\n    value?: number,\r\n    customParameters?: Record<string, any>\r\n  ): FilterAnalyticsEvent => {\r\n    return {\r\n      event: `filter_${action}`,\r\n      category: 'filter',\r\n      action,\r\n      label,\r\n      value,\r\n      custom_parameters: customParameters,\r\n      timestamp: Date.now(),\r\n      session_id: sessionId.current,\r\n      user_id: userId,\r\n      page_url: typeof window !== 'undefined' ? window.location.href : '',\r\n      page_title: typeof window !== 'undefined' ? document.title : '',\r\n    };\r\n  }, [userId]);\r\n\r\n  // Función para enviar evento\r\n  const trackEvent = useCallback(async (event: FilterAnalyticsEvent) => {\r\n    if (!enabled) {return;}\r\n\r\n    if (debug) {\r\n    }\r\n\r\n    // Enviar a múltiples destinos\r\n    try {\r\n      // Google Analytics 4\r\n      sendToGA4(event);\r\n      \r\n      // Supabase Analytics\r\n      await sendToSupabase(event);\r\n    } catch (error) {\r\n      console.warn('Analytics tracking error:', error);\r\n    }\r\n  }, [enabled, debug]);\r\n\r\n  // ===================================\r\n  // MÉTODOS DE TRACKING ESPECÍFICOS\r\n  // ===================================\r\n\r\n  const trackFilterApplied = useCallback((\r\n    filterType: string,\r\n    filterValue: string,\r\n    resultsCount: number\r\n  ) => {\r\n    const timeToApply = Date.now() - startTime.current;\r\n    const event = createBaseEvent('applied', `${filterType}:${filterValue}`, resultsCount, {\r\n      filter_type: filterType,\r\n      filter_value: filterValue,\r\n      results_count: resultsCount,\r\n      time_to_apply: timeToApply,\r\n    });\r\n    trackEvent(event);\r\n    startTime.current = Date.now(); // Reset para próxima medición\r\n  }, [createBaseEvent, trackEvent]);\r\n\r\n  const trackFilterRemoved = useCallback((\r\n    filterType: string,\r\n    filterValue: string,\r\n    remainingFilters: number\r\n  ) => {\r\n    const event = createBaseEvent('removed', `${filterType}:${filterValue}`, remainingFilters, {\r\n      filter_type: filterType,\r\n      filter_value: filterValue,\r\n      remaining_filters: remainingFilters,\r\n    });\r\n    trackEvent(event);\r\n  }, [createBaseEvent, trackEvent]);\r\n\r\n  const trackFiltersCleared = useCallback((\r\n    totalFiltersCleared: number,\r\n    filterTypes: string[]\r\n  ) => {\r\n    const event = createBaseEvent('cleared', 'all_filters', totalFiltersCleared, {\r\n      total_filters_cleared: totalFiltersCleared,\r\n      filter_types: filterTypes,\r\n    });\r\n    trackEvent(event);\r\n  }, [createBaseEvent, trackEvent]);\r\n\r\n  const trackSearchPerformed = useCallback((\r\n    query: string,\r\n    resultsCount: number,\r\n    hasFilters: boolean,\r\n    filterCount: number\r\n  ) => {\r\n    const event = createBaseEvent('search', query, resultsCount, {\r\n      query,\r\n      results_count: resultsCount,\r\n      has_filters: hasFilters,\r\n      filter_count: filterCount,\r\n    });\r\n    trackEvent(event);\r\n  }, [createBaseEvent, trackEvent]);\r\n\r\n  const trackPaginationUsed = useCallback((\r\n    fromPage: number,\r\n    toPage: number,\r\n    totalPages: number,\r\n    resultsPerPage: number\r\n  ) => {\r\n    const event = createBaseEvent('pagination', `${fromPage}_to_${toPage}`, toPage, {\r\n      from_page: fromPage,\r\n      to_page: toPage,\r\n      total_pages: totalPages,\r\n      results_per_page: resultsPerPage,\r\n    });\r\n    trackEvent(event);\r\n  }, [createBaseEvent, trackEvent]);\r\n\r\n  const trackSortChanged = useCallback((\r\n    fromSort: string,\r\n    toSort: string,\r\n    resultsCount: number\r\n  ) => {\r\n    const event = createBaseEvent('sort_changed', `${fromSort}_to_${toSort}`, resultsCount, {\r\n      from_sort: fromSort,\r\n      to_sort: toSort,\r\n      results_count: resultsCount,\r\n    });\r\n    trackEvent(event);\r\n  }, [createBaseEvent, trackEvent]);\r\n\r\n  // Tracking automático de cambios en filtros\r\n  const trackFilterChanges = useCallback((\r\n    previousFilters: ProductFilterState,\r\n    currentFilters: ProductFilterState,\r\n    resultsCount: number\r\n  ) => {\r\n    // Detectar filtros añadidos\r\n    const addedCategories = currentFilters.categories.filter(\r\n      cat => !previousFilters.categories.includes(cat)\r\n    );\r\n    const addedBrands = currentFilters.brands.filter(\r\n      brand => !previousFilters.brands.includes(brand)\r\n    );\r\n\r\n    // Detectar filtros removidos\r\n    const removedCategories = previousFilters.categories.filter(\r\n      cat => !currentFilters.categories.includes(cat)\r\n    );\r\n    const removedBrands = previousFilters.brands.filter(\r\n      brand => !currentFilters.brands.includes(brand)\r\n    );\r\n\r\n    // Track filtros añadidos\r\n    addedCategories.forEach(category => {\r\n      trackFilterApplied('category', category, resultsCount);\r\n    });\r\n    addedBrands.forEach(brand => {\r\n      trackFilterApplied('brand', brand, resultsCount);\r\n    });\r\n\r\n    // Track filtros removidos\r\n    const remainingFilters = currentFilters.categories.length + currentFilters.brands.length;\r\n    removedCategories.forEach(category => {\r\n      trackFilterRemoved('category', category, remainingFilters);\r\n    });\r\n    removedBrands.forEach(brand => {\r\n      trackFilterRemoved('brand', brand, remainingFilters);\r\n    });\r\n\r\n    // Track cambios de precio\r\n    if (previousFilters.priceMin !== currentFilters.priceMin || \r\n        previousFilters.priceMax !== currentFilters.priceMax) {\r\n      const priceRange = `${currentFilters.priceMin || 0}-${currentFilters.priceMax || 'max'}`;\r\n      trackFilterApplied('price_range', priceRange, resultsCount);\r\n    }\r\n\r\n    // Track cambios de búsqueda\r\n    if (previousFilters.search !== currentFilters.search && currentFilters.search) {\r\n      const hasFilters = currentFilters.categories.length > 0 || currentFilters.brands.length > 0;\r\n      const filterCount = currentFilters.categories.length + currentFilters.brands.length;\r\n      trackSearchPerformed(currentFilters.search, resultsCount, hasFilters, filterCount);\r\n    }\r\n\r\n    // Track cambios de ordenamiento\r\n    if (previousFilters.sortBy !== currentFilters.sortBy) {\r\n      trackSortChanged(previousFilters.sortBy, currentFilters.sortBy, resultsCount);\r\n    }\r\n\r\n    // Track cambios de página\r\n    if (previousFilters.page !== currentFilters.page) {\r\n      trackPaginationUsed(\r\n        previousFilters.page,\r\n        currentFilters.page,\r\n        Math.ceil(resultsCount / currentFilters.limit),\r\n        currentFilters.limit\r\n      );\r\n    }\r\n  }, [\r\n    trackFilterApplied,\r\n    trackFilterRemoved,\r\n    trackSearchPerformed,\r\n    trackSortChanged,\r\n    trackPaginationUsed,\r\n  ]);\r\n\r\n  // Tracking de sesión al montar\r\n  useEffect(() => {\r\n    if (!enabled) {return;}\r\n\r\n    const event = createBaseEvent('session_started', 'filter_system', 1, {\r\n      user_agent: typeof window !== 'undefined' ? navigator.userAgent : '',\r\n      screen_resolution: typeof window !== 'undefined' \r\n        ? `${window.screen.width}x${window.screen.height}` \r\n        : '',\r\n      viewport_size: typeof window !== 'undefined'\r\n        ? `${window.innerWidth}x${window.innerHeight}`\r\n        : '',\r\n    });\r\n\r\n    trackEvent(event);\r\n\r\n    // Cleanup al desmontar\r\n    return () => {\r\n      const endEvent = createBaseEvent('session_ended', 'filter_system', 1, {\r\n        session_duration: Date.now() - startTime.current,\r\n      });\r\n      trackEvent(endEvent);\r\n    };\r\n  }, [enabled, createBaseEvent, trackEvent]);\r\n\r\n  return {\r\n    // Métodos de tracking específicos\r\n    trackFilterApplied,\r\n    trackFilterRemoved,\r\n    trackFiltersCleared,\r\n    trackSearchPerformed,\r\n    trackPaginationUsed,\r\n    trackSortChanged,\r\n    trackFilterChanges,\r\n    \r\n    // Método genérico\r\n    trackEvent,\r\n    \r\n    // Información de sesión\r\n    sessionId: sessionId.current,\r\n    userId,\r\n    enabled,\r\n  };\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["useFilterAnalytics","generateSessionId","Date","now","Math","random","toString","substr","getSessionId","window","sessionId","sessionStorage","getItem","setItem","sendToGA4","event","gtag","action","event_category","category","event_label","label","value","custom_map","custom_parameters","session_id","page_location","page_url","page_title","sendToSupabase","fetch","method","headers","body","JSON","stringify","error","console","warn","options","enabled","debug","process","env","NODE_ENV","providedSessionId","userId","useRef","startTime","createBaseEvent","useCallback","customParameters","timestamp","current","user_id","location","href","document","title","trackEvent","trackFilterApplied","filterType","filterValue","resultsCount","timeToApply","filter_type","filter_value","results_count","time_to_apply","trackFilterRemoved","remainingFilters","remaining_filters","trackFiltersCleared","totalFiltersCleared","filterTypes","total_filters_cleared","filter_types","trackSearchPerformed","query","hasFilters","filterCount","has_filters","filter_count","trackPaginationUsed","fromPage","toPage","totalPages","resultsPerPage","from_page","to_page","total_pages","results_per_page","trackSortChanged","fromSort","toSort","from_sort","to_sort","trackFilterChanges","previousFilters","currentFilters","addedCategories","categories","filter","cat","includes","addedBrands","brands","brand","removedCategories","removedBrands","forEach","length","priceMin","priceMax","priceRange","search","sortBy","page","ceil","limit","useEffect","user_agent","navigator","userAgent","screen_resolution","screen","width","height","viewport_size","innerWidth","innerHeight","endEvent","session_duration"],"mappings":"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"}