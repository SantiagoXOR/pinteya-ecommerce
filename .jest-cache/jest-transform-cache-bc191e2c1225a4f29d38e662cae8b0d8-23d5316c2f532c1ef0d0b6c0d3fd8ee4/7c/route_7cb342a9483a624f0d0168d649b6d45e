b47486a45609905e18b3ed90d9659ed1
// Configuración para Node.js Runtime
"use strict";

/* istanbul ignore next */
function cov_zjzdeo6qj() {
  var path = "C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\user\\avatar\\route.ts";
  var hash = "44206bedcbd87e776bb8d81d6ed343abf0392685";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\user\\avatar\\route.ts",
    statementMap: {
      "0": {
        start: {
          line: 3,
          column: 0
        },
        end: {
          line: 5,
          column: 3
        }
      },
      "1": {
        start: {
          line: 7,
          column: 4
        },
        end: {
          line: 10,
          column: 7
        }
      },
      "2": {
        start: {
          line: 7,
          column: 24
        },
        end: {
          line: 10,
          column: 7
        }
      },
      "3": {
        start: {
          line: 12,
          column: 0
        },
        end: {
          line: 22,
          column: 3
        }
      },
      "4": {
        start: {
          line: 14,
          column: 8
        },
        end: {
          line: 14,
          column: 22
        }
      },
      "5": {
        start: {
          line: 17,
          column: 8
        },
        end: {
          line: 17,
          column: 20
        }
      },
      "6": {
        start: {
          line: 20,
          column: 8
        },
        end: {
          line: 20,
          column: 23
        }
      },
      "7": {
        start: {
          line: 23,
          column: 16
        },
        end: {
          line: 23,
          column: 38
        }
      },
      "8": {
        start: {
          line: 24,
          column: 18
        },
        end: {
          line: 24,
          column: 66
        }
      },
      "9": {
        start: {
          line: 25,
          column: 16
        },
        end: {
          line: 25,
          column: 54
        }
      },
      "10": {
        start: {
          line: 26,
          column: 20
        },
        end: {
          line: 26,
          column: 52
        }
      },
      "11": {
        start: {
          line: 27,
          column: 16
        },
        end: {
          line: 27,
          column: 24
        }
      },
      "12": {
        start: {
          line: 29,
          column: 20
        },
        end: {
          line: 29,
          column: 56
        }
      },
      "13": {
        start: {
          line: 30,
          column: 27
        },
        end: {
          line: 30,
          column: 64
        }
      },
      "14": {
        start: {
          line: 31,
          column: 24
        },
        end: {
          line: 31,
          column: 86
        }
      },
      "15": {
        start: {
          line: 33,
          column: 22
        },
        end: {
          line: 38,
          column: 1
        }
      },
      "16": {
        start: {
          line: 39,
          column: 22
        },
        end: {
          line: 39,
          column: 37
        }
      },
      "17": {
        start: {
          line: 40,
          column: 22
        },
        end: {
          line: 40,
          column: 31
        }
      },
      "18": {
        start: {
          line: 42,
          column: 4
        },
        end: {
          line: 148,
          column: 5
        }
      },
      "19": {
        start: {
          line: 44,
          column: 24
        },
        end: {
          line: 44,
          column: 49
        }
      },
      "20": {
        start: {
          line: 45,
          column: 8
        },
        end: {
          line: 52,
          column: 9
        }
      },
      "21": {
        start: {
          line: 46,
          column: 12
        },
        end: {
          line: 51,
          column: 15
        }
      },
      "22": {
        start: {
          line: 53,
          column: 23
        },
        end: {
          line: 53,
          column: 38
        }
      },
      "23": {
        start: {
          line: 55,
          column: 25
        },
        end: {
          line: 55,
          column: 49
        }
      },
      "24": {
        start: {
          line: 56,
          column: 21
        },
        end: {
          line: 56,
          column: 43
        }
      },
      "25": {
        start: {
          line: 57,
          column: 8
        },
        end: {
          line: 64,
          column: 9
        }
      },
      "26": {
        start: {
          line: 58,
          column: 12
        },
        end: {
          line: 63,
          column: 15
        }
      },
      "27": {
        start: {
          line: 66,
          column: 8
        },
        end: {
          line: 73,
          column: 9
        }
      },
      "28": {
        start: {
          line: 67,
          column: 12
        },
        end: {
          line: 72,
          column: 15
        }
      },
      "29": {
        start: {
          line: 75,
          column: 8
        },
        end: {
          line: 82,
          column: 9
        }
      },
      "30": {
        start: {
          line: 76,
          column: 12
        },
        end: {
          line: 81,
          column: 15
        }
      },
      "31": {
        start: {
          line: 84,
          column: 30
        },
        end: {
          line: 84,
          column: 56
        }
      },
      "32": {
        start: {
          line: 85,
          column: 25
        },
        end: {
          line: 85,
          column: 67
        }
      },
      "33": {
        start: {
          line: 86,
          column: 25
        },
        end: {
          line: 86,
          column: 46
        }
      },
      "34": {
        start: {
          line: 88,
          column: 28
        },
        end: {
          line: 88,
          column: 52
        }
      },
      "35": {
        start: {
          line: 89,
          column: 23
        },
        end: {
          line: 89,
          column: 50
        }
      },
      "36": {
        start: {
          line: 91,
          column: 35
        },
        end: {
          line: 91,
          column: 131
        }
      },
      "37": {
        start: {
          line: 92,
          column: 8
        },
        end: {
          line: 98,
          column: 9
        }
      },
      "38": {
        start: {
          line: 94,
          column: 28
        },
        end: {
          line: 94,
          column: 78
        }
      },
      "39": {
        start: {
          line: 95,
          column: 12
        },
        end: {
          line: 97,
          column: 15
        }
      },
      "40": {
        start: {
          line: 100,
          column: 57
        },
        end: {
          line: 103,
          column: 10
        }
      },
      "41": {
        start: {
          line: 104,
          column: 8
        },
        end: {
          line: 112,
          column: 9
        }
      },
      "42": {
        start: {
          line: 105,
          column: 12
        },
        end: {
          line: 105,
          column: 66
        }
      },
      "43": {
        start: {
          line: 106,
          column: 12
        },
        end: {
          line: 111,
          column: 15
        }
      },
      "44": {
        start: {
          line: 114,
          column: 34
        },
        end: {
          line: 114,
          column: 100
        }
      },
      "45": {
        start: {
          line: 115,
          column: 26
        },
        end: {
          line: 115,
          column: 43
        }
      },
      "46": {
        start: {
          line: 117,
          column: 58
        },
        end: {
          line: 120,
          column: 51
        }
      },
      "47": {
        start: {
          line: 121,
          column: 8
        },
        end: {
          line: 133,
          column: 9
        }
      },
      "48": {
        start: {
          line: 122,
          column: 12
        },
        end: {
          line: 122,
          column: 71
        }
      },
      "49": {
        start: {
          line: 124,
          column: 12
        },
        end: {
          line: 126,
          column: 15
        }
      },
      "50": {
        start: {
          line: 127,
          column: 12
        },
        end: {
          line: 132,
          column: 15
        }
      },
      "51": {
        start: {
          line: 134,
          column: 8
        },
        end: {
          line: 139,
          column: 11
        }
      },
      "52": {
        start: {
          line: 141,
          column: 8
        },
        end: {
          line: 141,
          column: 64
        }
      },
      "53": {
        start: {
          line: 142,
          column: 8
        },
        end: {
          line: 147,
          column: 11
        }
      },
      "54": {
        start: {
          line: 151,
          column: 4
        },
        end: {
          line: 219,
          column: 5
        }
      },
      "55": {
        start: {
          line: 153,
          column: 24
        },
        end: {
          line: 153,
          column: 49
        }
      },
      "56": {
        start: {
          line: 154,
          column: 8
        },
        end: {
          line: 161,
          column: 9
        }
      },
      "57": {
        start: {
          line: 155,
          column: 12
        },
        end: {
          line: 160,
          column: 15
        }
      },
      "58": {
        start: {
          line: 162,
          column: 23
        },
        end: {
          line: 162,
          column: 38
        }
      },
      "59": {
        start: {
          line: 164,
          column: 53
        },
        end: {
          line: 164,
          column: 149
        }
      },
      "60": {
        start: {
          line: 165,
          column: 8
        },
        end: {
          line: 173,
          column: 9
        }
      },
      "61": {
        start: {
          line: 166,
          column: 12
        },
        end: {
          line: 166,
          column: 66
        }
      },
      "62": {
        start: {
          line: 167,
          column: 12
        },
        end: {
          line: 172,
          column: 15
        }
      },
      "63": {
        start: {
          line: 174,
          column: 8
        },
        end: {
          line: 181,
          column: 9
        }
      },
      "64": {
        start: {
          line: 175,
          column: 12
        },
        end: {
          line: 180,
          column: 15
        }
      },
      "65": {
        start: {
          line: 183,
          column: 27
        },
        end: {
          line: 183,
          column: 77
        }
      },
      "66": {
        start: {
          line: 185,
          column: 39
        },
        end: {
          line: 187,
          column: 10
        }
      },
      "67": {
        start: {
          line: 188,
          column: 8
        },
        end: {
          line: 191,
          column: 9
        }
      },
      "68": {
        start: {
          line: 189,
          column: 12
        },
        end: {
          line: 189,
          column: 69
        }
      },
      "69": {
        start: {
          line: 193,
          column: 58
        },
        end: {
          line: 196,
          column: 51
        }
      },
      "70": {
        start: {
          line: 197,
          column: 8
        },
        end: {
          line: 205,
          column: 9
        }
      },
      "71": {
        start: {
          line: 198,
          column: 12
        },
        end: {
          line: 198,
          column: 71
        }
      },
      "72": {
        start: {
          line: 199,
          column: 12
        },
        end: {
          line: 204,
          column: 15
        }
      },
      "73": {
        start: {
          line: 206,
          column: 8
        },
        end: {
          line: 210,
          column: 11
        }
      },
      "74": {
        start: {
          line: 212,
          column: 8
        },
        end: {
          line: 212,
          column: 66
        }
      },
      "75": {
        start: {
          line: 213,
          column: 8
        },
        end: {
          line: 218,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "_export",
        decl: {
          start: {
            line: 6,
            column: 9
          },
          end: {
            line: 6,
            column: 16
          }
        },
        loc: {
          start: {
            line: 6,
            column: 30
          },
          end: {
            line: 11,
            column: 1
          }
        },
        line: 6
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 13,
            column: 4
          },
          end: {
            line: 13,
            column: 5
          }
        },
        loc: {
          start: {
            line: 13,
            column: 18
          },
          end: {
            line: 15,
            column: 5
          }
        },
        line: 13
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 16,
            column: 4
          },
          end: {
            line: 16,
            column: 5
          }
        },
        loc: {
          start: {
            line: 16,
            column: 16
          },
          end: {
            line: 18,
            column: 5
          }
        },
        line: 16
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 19,
            column: 4
          },
          end: {
            line: 19,
            column: 5
          }
        },
        loc: {
          start: {
            line: 19,
            column: 19
          },
          end: {
            line: 21,
            column: 5
          }
        },
        line: 19
      },
      "4": {
        name: "POST",
        decl: {
          start: {
            line: 41,
            column: 15
          },
          end: {
            line: 41,
            column: 19
          }
        },
        loc: {
          start: {
            line: 41,
            column: 29
          },
          end: {
            line: 149,
            column: 1
          }
        },
        line: 41
      },
      "5": {
        name: "DELETE",
        decl: {
          start: {
            line: 150,
            column: 15
          },
          end: {
            line: 150,
            column: 21
          }
        },
        loc: {
          start: {
            line: 150,
            column: 31
          },
          end: {
            line: 220,
            column: 1
          }
        },
        line: 150
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 45,
            column: 8
          },
          end: {
            line: 52,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 45,
            column: 8
          },
          end: {
            line: 52,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 45
      },
      "1": {
        loc: {
          start: {
            line: 57,
            column: 8
          },
          end: {
            line: 64,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 57,
            column: 8
          },
          end: {
            line: 64,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 57
      },
      "2": {
        loc: {
          start: {
            line: 66,
            column: 8
          },
          end: {
            line: 73,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 66,
            column: 8
          },
          end: {
            line: 73,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 66
      },
      "3": {
        loc: {
          start: {
            line: 75,
            column: 8
          },
          end: {
            line: 82,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 75,
            column: 8
          },
          end: {
            line: 82,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 75
      },
      "4": {
        loc: {
          start: {
            line: 92,
            column: 8
          },
          end: {
            line: 98,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 92,
            column: 8
          },
          end: {
            line: 98,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 92
      },
      "5": {
        loc: {
          start: {
            line: 104,
            column: 8
          },
          end: {
            line: 112,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 104,
            column: 8
          },
          end: {
            line: 112,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 104
      },
      "6": {
        loc: {
          start: {
            line: 121,
            column: 8
          },
          end: {
            line: 133,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 121,
            column: 8
          },
          end: {
            line: 133,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 121
      },
      "7": {
        loc: {
          start: {
            line: 154,
            column: 8
          },
          end: {
            line: 161,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 154,
            column: 8
          },
          end: {
            line: 161,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 154
      },
      "8": {
        loc: {
          start: {
            line: 165,
            column: 8
          },
          end: {
            line: 173,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 165,
            column: 8
          },
          end: {
            line: 173,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 165
      },
      "9": {
        loc: {
          start: {
            line: 174,
            column: 8
          },
          end: {
            line: 181,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 174,
            column: 8
          },
          end: {
            line: 181,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 174
      },
      "10": {
        loc: {
          start: {
            line: 188,
            column: 8
          },
          end: {
            line: 191,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 188,
            column: 8
          },
          end: {
            line: 191,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 188
      },
      "11": {
        loc: {
          start: {
            line: 197,
            column: 8
          },
          end: {
            line: 205,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 197,
            column: 8
          },
          end: {
            line: 205,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 197
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0,
      "65": 0,
      "66": 0,
      "67": 0,
      "68": 0,
      "69": 0,
      "70": 0,
      "71": 0,
      "72": 0,
      "73": 0,
      "74": 0,
      "75": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\user\\avatar\\route.ts"],
      sourcesContent: ["// Configuraci\xF3n para Node.js Runtime\r\nexport const runtime = 'nodejs';\r\n\r\n// ===================================\r\n// PINTEYA E-COMMERCE - API DE AVATAR DE USUARIO\r\n// ===================================\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { supabaseAdmin } from '@/lib/integrations/supabase';\r\nimport { auth } from '@/lib/auth/config';\r\nimport { createClient } from '@supabase/supabase-js';\r\n\r\n// Configuraci\xF3n de Supabase Storage\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\r\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\r\nconst supabaseStorage = createClient(supabaseUrl, supabaseServiceKey);\r\n\r\n// Configuraci\xF3n de archivos\r\nconst ALLOWED_TYPES = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\r\nconst AVATAR_BUCKET = 'avatars';\r\n\r\n// ===================================\r\n// POST - Subir avatar\r\n// ===================================\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    // Verificar autenticaci\xF3n\r\n    const session = await auth();\r\n    if (!session?.user) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Usuario no autenticado' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const userId = session.user.id;\r\n\r\n    // Obtener archivo del FormData\r\n    const formData = await request.formData();\r\n    const file = formData.get('avatar') as File;\r\n\r\n    if (!file) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'No se proporcion\xF3 ning\xFAn archivo' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validar tipo de archivo\r\n    if (!ALLOWED_TYPES.includes(file.type)) {\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: 'Tipo de archivo no permitido. Solo se permiten im\xE1genes JPG, PNG y WebP.' \r\n        },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Validar tama\xF1o\r\n    if (file.size > MAX_FILE_SIZE) {\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: 'El archivo es demasiado grande. El tama\xF1o m\xE1ximo es 5MB.' \r\n        },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Generar nombre \xFAnico para el archivo\r\n    const fileExtension = file.name.split('.').pop();\r\n    const fileName = `${userId}-${Date.now()}.${fileExtension}`;\r\n    const filePath = `avatars/${fileName}`;\r\n\r\n    // Convertir archivo a ArrayBuffer\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const buffer = new Uint8Array(arrayBuffer);\r\n\r\n    // Eliminar avatar anterior si existe\r\n    const { data: userData } = await supabaseAdmin\r\n      .from('users')\r\n      .select('avatar_url')\r\n      .eq('clerk_id', userId)\r\n      .single();\r\n\r\n    if (userData?.avatar_url) {\r\n      // Extraer el path del avatar anterior\r\n      const oldPath = userData.avatar_url.split('/').slice(-2).join('/');\r\n      await supabaseStorage.storage\r\n        .from(AVATAR_BUCKET)\r\n        .remove([oldPath]);\r\n    }\r\n\r\n    // Subir nuevo archivo a Supabase Storage\r\n    const { data: uploadData, error: uploadError } = await supabaseStorage.storage\r\n      .from(AVATAR_BUCKET)\r\n      .upload(filePath, buffer, {\r\n        contentType: file.type,\r\n        upsert: true,\r\n      });\r\n\r\n    if (uploadError) {\r\n      console.error('Error al subir archivo:', uploadError);\r\n      return NextResponse.json(\r\n        { success: false, error: 'Error al subir el archivo' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Obtener URL p\xFAblica del archivo\r\n    const { data: urlData } = supabaseStorage.storage\r\n      .from(AVATAR_BUCKET)\r\n      .getPublicUrl(filePath);\r\n\r\n    const avatarUrl = urlData.publicUrl;\r\n\r\n    // Actualizar URL del avatar en la base de datos\r\n    const { data: updatedUser, error: updateError } = await supabaseAdmin\r\n      .from('users')\r\n      .update({\r\n        avatar_url: avatarUrl,\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n      .eq('clerk_id', userId)\r\n      .select()\r\n      .single();\r\n\r\n    if (updateError) {\r\n      console.error('Error al actualizar usuario:', updateError);\r\n      // Intentar eliminar el archivo subido si falla la actualizaci\xF3n\r\n      await supabaseStorage.storage\r\n        .from(AVATAR_BUCKET)\r\n        .remove([filePath]);\r\n      \r\n      return NextResponse.json(\r\n        { success: false, error: 'Error al actualizar el perfil' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      avatar_url: avatarUrl,\r\n      user: updatedUser,\r\n      message: 'Avatar subido correctamente',\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Error en POST /api/user/avatar:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: 'Error interno del servidor' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// ===================================\r\n// DELETE - Eliminar avatar\r\n// ===================================\r\nexport async function DELETE(request: NextRequest) {\r\n  try {\r\n    // Verificar autenticaci\xF3n\r\n    const session = await auth();\r\n    if (!session?.user) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'Usuario no autenticado' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const userId = session.user.id;\r\n\r\n    // Obtener datos del usuario\r\n    const { data: userData, error: userError } = await supabaseAdmin\r\n      .from('users')\r\n      .select('avatar_url')\r\n      .eq('clerk_id', userId)\r\n      .single();\r\n\r\n    if (userError) {\r\n      console.error('Error al obtener usuario:', userError);\r\n      return NextResponse.json(\r\n        { success: false, error: 'Error al obtener datos del usuario' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    if (!userData?.avatar_url) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'No hay avatar para eliminar' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Extraer el path del archivo del avatar\r\n    const avatarPath = userData.avatar_url.split('/').slice(-2).join('/');\r\n\r\n    // Eliminar archivo de Supabase Storage\r\n    const { error: deleteError } = await supabaseStorage.storage\r\n      .from(AVATAR_BUCKET)\r\n      .remove([avatarPath]);\r\n\r\n    if (deleteError) {\r\n      console.error('Error al eliminar archivo:', deleteError);\r\n      // Continuar con la actualizaci\xF3n de la base de datos aunque falle la eliminaci\xF3n del archivo\r\n    }\r\n\r\n    // Actualizar base de datos para remover la URL del avatar\r\n    const { data: updatedUser, error: updateError } = await supabaseAdmin\r\n      .from('users')\r\n      .update({\r\n        avatar_url: null,\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n      .eq('clerk_id', userId)\r\n      .select()\r\n      .single();\r\n\r\n    if (updateError) {\r\n      console.error('Error al actualizar usuario:', updateError);\r\n      return NextResponse.json(\r\n        { success: false, error: 'Error al actualizar el perfil' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      user: updatedUser,\r\n      message: 'Avatar eliminado correctamente',\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Error en DELETE /api/user/avatar:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: 'Error interno del servidor' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],
      names: ["DELETE", "POST", "runtime", "supabaseUrl", "process", "env", "NEXT_PUBLIC_SUPABASE_URL", "supabaseServiceKey", "SUPABASE_SERVICE_ROLE_KEY", "supabaseStorage", "createClient", "ALLOWED_TYPES", "MAX_FILE_SIZE", "AVATAR_BUCKET", "request", "session", "auth", "user", "NextResponse", "json", "success", "error", "status", "userId", "id", "formData", "file", "get", "includes", "type", "size", "fileExtension", "name", "split", "pop", "fileName", "Date", "now", "filePath", "arrayBuffer", "buffer", "Uint8Array", "data", "userData", "supabaseAdmin", "from", "select", "eq", "single", "avatar_url", "oldPath", "slice", "join", "storage", "remove", "uploadData", "uploadError", "upload", "contentType", "upsert", "console", "urlData", "getPublicUrl", "avatarUrl", "publicUrl", "updatedUser", "updateError", "update", "updated_at", "toISOString", "message", "userError", "avatarPath", "deleteError"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "44206bedcbd87e776bb8d81d6ed343abf0392685"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_zjzdeo6qj = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_zjzdeo6qj();
cov_zjzdeo6qj().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function _export(target, all) {
  /* istanbul ignore next */
  cov_zjzdeo6qj().f[0]++;
  cov_zjzdeo6qj().s[1]++;
  for (var name in all) {
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[2]++;
    Object.defineProperty(target, name, {
      enumerable: true,
      get: Object.getOwnPropertyDescriptor(all, name).get
    });
  }
}
/* istanbul ignore next */
cov_zjzdeo6qj().s[3]++;
_export(exports, {
  get DELETE() {
    /* istanbul ignore next */
    cov_zjzdeo6qj().f[1]++;
    cov_zjzdeo6qj().s[4]++;
    return DELETE;
  },
  get POST() {
    /* istanbul ignore next */
    cov_zjzdeo6qj().f[2]++;
    cov_zjzdeo6qj().s[5]++;
    return POST;
  },
  get runtime() {
    /* istanbul ignore next */
    cov_zjzdeo6qj().f[3]++;
    cov_zjzdeo6qj().s[6]++;
    return runtime;
  }
});
const _server =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[7]++, require("next/server"));
const _supabase =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[8]++, require("../../../../lib/integrations/supabase"));
const _config =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[9]++, require("../../../../lib/auth/config"));
const _supabasejs =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[10]++, require("@supabase/supabase-js"));
const runtime =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[11]++, 'nodejs');
// Configuración de Supabase Storage
const supabaseUrl =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[12]++, process.env.NEXT_PUBLIC_SUPABASE_URL);
const supabaseServiceKey =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[13]++, process.env.SUPABASE_SERVICE_ROLE_KEY);
const supabaseStorage =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[14]++, (0, _supabasejs.createClient)(supabaseUrl, supabaseServiceKey));
// Configuración de archivos
const ALLOWED_TYPES =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[15]++, ['image/jpeg', 'image/jpg', 'image/png', 'image/webp']);
const MAX_FILE_SIZE =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[16]++, 5 * 1024 * 1024); // 5MB
const AVATAR_BUCKET =
/* istanbul ignore next */
(cov_zjzdeo6qj().s[17]++, 'avatars');
async function POST(request) {
  /* istanbul ignore next */
  cov_zjzdeo6qj().f[4]++;
  cov_zjzdeo6qj().s[18]++;
  try {
    // Verificar autenticación
    const session =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[19]++, await (0, _config.auth)());
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[20]++;
    if (!session?.user) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[0][0]++;
      cov_zjzdeo6qj().s[21]++;
      return _server.NextResponse.json({
        success: false,
        error: 'Usuario no autenticado'
      }, {
        status: 401
      });
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[0][1]++;
    }
    const userId =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[22]++, session.user.id);
    // Obtener archivo del FormData
    const formData =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[23]++, await request.formData());
    const file =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[24]++, formData.get('avatar'));
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[25]++;
    if (!file) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[1][0]++;
      cov_zjzdeo6qj().s[26]++;
      return _server.NextResponse.json({
        success: false,
        error: 'No se proporcionó ningún archivo'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[1][1]++;
    }
    // Validar tipo de archivo
    cov_zjzdeo6qj().s[27]++;
    if (!ALLOWED_TYPES.includes(file.type)) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[2][0]++;
      cov_zjzdeo6qj().s[28]++;
      return _server.NextResponse.json({
        success: false,
        error: 'Tipo de archivo no permitido. Solo se permiten imágenes JPG, PNG y WebP.'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[2][1]++;
    }
    // Validar tamaño
    cov_zjzdeo6qj().s[29]++;
    if (file.size > MAX_FILE_SIZE) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[3][0]++;
      cov_zjzdeo6qj().s[30]++;
      return _server.NextResponse.json({
        success: false,
        error: 'El archivo es demasiado grande. El tamaño máximo es 5MB.'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[3][1]++;
    }
    // Generar nombre único para el archivo
    const fileExtension =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[31]++, file.name.split('.').pop());
    const fileName =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[32]++, `${userId}-${Date.now()}.${fileExtension}`);
    const filePath =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[33]++, `avatars/${fileName}`);
    // Convertir archivo a ArrayBuffer
    const arrayBuffer =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[34]++, await file.arrayBuffer());
    const buffer =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[35]++, new Uint8Array(arrayBuffer));
    // Eliminar avatar anterior si existe
    const {
      data: userData
    } =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[36]++, await _supabase.supabaseAdmin.from('users').select('avatar_url').eq('clerk_id', userId).single());
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[37]++;
    if (userData?.avatar_url) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[4][0]++;
      // Extraer el path del avatar anterior
      const oldPath =
      /* istanbul ignore next */
      (cov_zjzdeo6qj().s[38]++, userData.avatar_url.split('/').slice(-2).join('/'));
      /* istanbul ignore next */
      cov_zjzdeo6qj().s[39]++;
      await supabaseStorage.storage.from(AVATAR_BUCKET).remove([oldPath]);
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[4][1]++;
    }
    // Subir nuevo archivo a Supabase Storage
    const {
      data: uploadData,
      error: uploadError
    } =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[40]++, await supabaseStorage.storage.from(AVATAR_BUCKET).upload(filePath, buffer, {
      contentType: file.type,
      upsert: true
    }));
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[41]++;
    if (uploadError) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[5][0]++;
      cov_zjzdeo6qj().s[42]++;
      console.error('Error al subir archivo:', uploadError);
      /* istanbul ignore next */
      cov_zjzdeo6qj().s[43]++;
      return _server.NextResponse.json({
        success: false,
        error: 'Error al subir el archivo'
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[5][1]++;
    }
    // Obtener URL pública del archivo
    const {
      data: urlData
    } =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[44]++, supabaseStorage.storage.from(AVATAR_BUCKET).getPublicUrl(filePath));
    const avatarUrl =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[45]++, urlData.publicUrl);
    // Actualizar URL del avatar en la base de datos
    const {
      data: updatedUser,
      error: updateError
    } =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[46]++, await _supabase.supabaseAdmin.from('users').update({
      avatar_url: avatarUrl,
      updated_at: new Date().toISOString()
    }).eq('clerk_id', userId).select().single());
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[47]++;
    if (updateError) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[6][0]++;
      cov_zjzdeo6qj().s[48]++;
      console.error('Error al actualizar usuario:', updateError);
      // Intentar eliminar el archivo subido si falla la actualización
      /* istanbul ignore next */
      cov_zjzdeo6qj().s[49]++;
      await supabaseStorage.storage.from(AVATAR_BUCKET).remove([filePath]);
      /* istanbul ignore next */
      cov_zjzdeo6qj().s[50]++;
      return _server.NextResponse.json({
        success: false,
        error: 'Error al actualizar el perfil'
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[6][1]++;
    }
    cov_zjzdeo6qj().s[51]++;
    return _server.NextResponse.json({
      success: true,
      avatar_url: avatarUrl,
      user: updatedUser,
      message: 'Avatar subido correctamente'
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[52]++;
    console.error('Error en POST /api/user/avatar:', error);
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[53]++;
    return _server.NextResponse.json({
      success: false,
      error: 'Error interno del servidor'
    }, {
      status: 500
    });
  }
}
async function DELETE(request) {
  /* istanbul ignore next */
  cov_zjzdeo6qj().f[5]++;
  cov_zjzdeo6qj().s[54]++;
  try {
    // Verificar autenticación
    const session =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[55]++, await (0, _config.auth)());
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[56]++;
    if (!session?.user) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[7][0]++;
      cov_zjzdeo6qj().s[57]++;
      return _server.NextResponse.json({
        success: false,
        error: 'Usuario no autenticado'
      }, {
        status: 401
      });
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[7][1]++;
    }
    const userId =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[58]++, session.user.id);
    // Obtener datos del usuario
    const {
      data: userData,
      error: userError
    } =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[59]++, await _supabase.supabaseAdmin.from('users').select('avatar_url').eq('clerk_id', userId).single());
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[60]++;
    if (userError) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[8][0]++;
      cov_zjzdeo6qj().s[61]++;
      console.error('Error al obtener usuario:', userError);
      /* istanbul ignore next */
      cov_zjzdeo6qj().s[62]++;
      return _server.NextResponse.json({
        success: false,
        error: 'Error al obtener datos del usuario'
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[8][1]++;
    }
    cov_zjzdeo6qj().s[63]++;
    if (!userData?.avatar_url) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[9][0]++;
      cov_zjzdeo6qj().s[64]++;
      return _server.NextResponse.json({
        success: false,
        error: 'No hay avatar para eliminar'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[9][1]++;
    }
    // Extraer el path del archivo del avatar
    const avatarPath =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[65]++, userData.avatar_url.split('/').slice(-2).join('/'));
    // Eliminar archivo de Supabase Storage
    const {
      error: deleteError
    } =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[66]++, await supabaseStorage.storage.from(AVATAR_BUCKET).remove([avatarPath]));
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[67]++;
    if (deleteError) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[10][0]++;
      cov_zjzdeo6qj().s[68]++;
      console.error('Error al eliminar archivo:', deleteError);
      // Continuar con la actualización de la base de datos aunque falle la eliminación del archivo
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[10][1]++;
    }
    // Actualizar base de datos para remover la URL del avatar
    const {
      data: updatedUser,
      error: updateError
    } =
    /* istanbul ignore next */
    (cov_zjzdeo6qj().s[69]++, await _supabase.supabaseAdmin.from('users').update({
      avatar_url: null,
      updated_at: new Date().toISOString()
    }).eq('clerk_id', userId).select().single());
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[70]++;
    if (updateError) {
      /* istanbul ignore next */
      cov_zjzdeo6qj().b[11][0]++;
      cov_zjzdeo6qj().s[71]++;
      console.error('Error al actualizar usuario:', updateError);
      /* istanbul ignore next */
      cov_zjzdeo6qj().s[72]++;
      return _server.NextResponse.json({
        success: false,
        error: 'Error al actualizar el perfil'
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_zjzdeo6qj().b[11][1]++;
    }
    cov_zjzdeo6qj().s[73]++;
    return _server.NextResponse.json({
      success: true,
      user: updatedUser,
      message: 'Avatar eliminado correctamente'
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[74]++;
    console.error('Error en DELETE /api/user/avatar:', error);
    /* istanbul ignore next */
    cov_zjzdeo6qj().s[75]++;
    return _server.NextResponse.json({
      success: false,
      error: 'Error interno del servidor'
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3Zfemp6ZGVvNnFqIiwiYWN0dWFsQ292ZXJhZ2UiLCJzIiwiREVMRVRFIiwiZiIsIlBPU1QiLCJydW50aW1lIiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VTZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsInN1cGFiYXNlU3RvcmFnZSIsIl9zdXBhYmFzZWpzIiwiY3JlYXRlQ2xpZW50IiwiQUxMT1dFRF9UWVBFUyIsIk1BWF9GSUxFX1NJWkUiLCJBVkFUQVJfQlVDS0VUIiwicmVxdWVzdCIsInNlc3Npb24iLCJfY29uZmlnIiwiYXV0aCIsInVzZXIiLCJiIiwiX3NlcnZlciIsIk5leHRSZXNwb25zZSIsImpzb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJzdGF0dXMiLCJ1c2VySWQiLCJpZCIsImZvcm1EYXRhIiwiZmlsZSIsImdldCIsImluY2x1ZGVzIiwidHlwZSIsInNpemUiLCJmaWxlRXh0ZW5zaW9uIiwibmFtZSIsInNwbGl0IiwicG9wIiwiZmlsZU5hbWUiLCJEYXRlIiwibm93IiwiZmlsZVBhdGgiLCJhcnJheUJ1ZmZlciIsImJ1ZmZlciIsIlVpbnQ4QXJyYXkiLCJkYXRhIiwidXNlckRhdGEiLCJfc3VwYWJhc2UiLCJzdXBhYmFzZUFkbWluIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiYXZhdGFyX3VybCIsIm9sZFBhdGgiLCJzbGljZSIsImpvaW4iLCJzdG9yYWdlIiwicmVtb3ZlIiwidXBsb2FkRGF0YSIsInVwbG9hZEVycm9yIiwidXBsb2FkIiwiY29udGVudFR5cGUiLCJ1cHNlcnQiLCJjb25zb2xlIiwidXJsRGF0YSIsImdldFB1YmxpY1VybCIsImF2YXRhclVybCIsInB1YmxpY1VybCIsInVwZGF0ZWRVc2VyIiwidXBkYXRlRXJyb3IiLCJ1cGRhdGUiLCJ1cGRhdGVkX2F0IiwidG9JU09TdHJpbmciLCJtZXNzYWdlIiwidXNlckVycm9yIiwiYXZhdGFyUGF0aCIsImRlbGV0ZUVycm9yIl0sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxtYXJ0aVxcRGVza3RvcFxcREVTQVJST0xMT1NXXFxCT0lMRVJQTEFUVEUgRS1DT01NRVJDRVxcc3JjXFxhcHBcXGFwaVxcdXNlclxcYXZhdGFyXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb25maWd1cmFjacOzbiBwYXJhIE5vZGUuanMgUnVudGltZVxyXG5leHBvcnQgY29uc3QgcnVudGltZSA9ICdub2RlanMnO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gUElOVEVZQSBFLUNPTU1FUkNFIC0gQVBJIERFIEFWQVRBUiBERSBVU1VBUklPXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBzdXBhYmFzZUFkbWluIH0gZnJvbSAnQC9saWIvaW50ZWdyYXRpb25zL3N1cGFiYXNlJztcclxuaW1wb3J0IHsgYXV0aCB9IGZyb20gJ0AvbGliL2F1dGgvY29uZmlnJztcclxuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcclxuXHJcbi8vIENvbmZpZ3VyYWNpw7NuIGRlIFN1cGFiYXNlIFN0b3JhZ2VcclxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhO1xyXG5jb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZITtcclxuY29uc3Qgc3VwYWJhc2VTdG9yYWdlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlcnZpY2VLZXkpO1xyXG5cclxuLy8gQ29uZmlndXJhY2nDs24gZGUgYXJjaGl2b3NcclxuY29uc3QgQUxMT1dFRF9UWVBFUyA9IFsnaW1hZ2UvanBlZycsICdpbWFnZS9qcGcnLCAnaW1hZ2UvcG5nJywgJ2ltYWdlL3dlYnAnXTtcclxuY29uc3QgTUFYX0ZJTEVfU0laRSA9IDUgKiAxMDI0ICogMTAyNDsgLy8gNU1CXHJcbmNvbnN0IEFWQVRBUl9CVUNLRVQgPSAnYXZhdGFycyc7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQT1NUIC0gU3ViaXIgYXZhdGFyXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIFZlcmlmaWNhciBhdXRlbnRpY2FjacOzblxyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGgoKTtcclxuICAgIGlmICghc2Vzc2lvbj8udXNlcikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdVc3VhcmlvIG5vIGF1dGVudGljYWRvJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHVzZXJJZCA9IHNlc3Npb24udXNlci5pZDtcclxuXHJcbiAgICAvLyBPYnRlbmVyIGFyY2hpdm8gZGVsIEZvcm1EYXRhXHJcbiAgICBjb25zdCBmb3JtRGF0YSA9IGF3YWl0IHJlcXVlc3QuZm9ybURhdGEoKTtcclxuICAgIGNvbnN0IGZpbGUgPSBmb3JtRGF0YS5nZXQoJ2F2YXRhcicpIGFzIEZpbGU7XHJcblxyXG4gICAgaWYgKCFmaWxlKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIHNlIHByb3BvcmNpb27DsyBuaW5nw7puIGFyY2hpdm8nIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmFsaWRhciB0aXBvIGRlIGFyY2hpdm9cclxuICAgIGlmICghQUxMT1dFRF9UWVBFUy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6ICdUaXBvIGRlIGFyY2hpdm8gbm8gcGVybWl0aWRvLiBTb2xvIHNlIHBlcm1pdGVuIGltw6FnZW5lcyBKUEcsIFBORyB5IFdlYlAuJyBcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZhbGlkYXIgdGFtYcOxb1xyXG4gICAgaWYgKGZpbGUuc2l6ZSA+IE1BWF9GSUxFX1NJWkUpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgXHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXHJcbiAgICAgICAgICBlcnJvcjogJ0VsIGFyY2hpdm8gZXMgZGVtYXNpYWRvIGdyYW5kZS4gRWwgdGFtYcOxbyBtw6F4aW1vIGVzIDVNQi4nIFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhciBub21icmUgw7puaWNvIHBhcmEgZWwgYXJjaGl2b1xyXG4gICAgY29uc3QgZmlsZUV4dGVuc2lvbiA9IGZpbGUubmFtZS5zcGxpdCgnLicpLnBvcCgpO1xyXG4gICAgY29uc3QgZmlsZU5hbWUgPSBgJHt1c2VySWR9LSR7RGF0ZS5ub3coKX0uJHtmaWxlRXh0ZW5zaW9ufWA7XHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGBhdmF0YXJzLyR7ZmlsZU5hbWV9YDtcclxuXHJcbiAgICAvLyBDb252ZXJ0aXIgYXJjaGl2byBhIEFycmF5QnVmZmVyXHJcbiAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTtcclxuICAgIGNvbnN0IGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyKTtcclxuXHJcbiAgICAvLyBFbGltaW5hciBhdmF0YXIgYW50ZXJpb3Igc2kgZXhpc3RlXHJcbiAgICBjb25zdCB7IGRhdGE6IHVzZXJEYXRhIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VycycpXHJcbiAgICAgIC5zZWxlY3QoJ2F2YXRhcl91cmwnKVxyXG4gICAgICAuZXEoJ2NsZXJrX2lkJywgdXNlcklkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKHVzZXJEYXRhPy5hdmF0YXJfdXJsKSB7XHJcbiAgICAgIC8vIEV4dHJhZXIgZWwgcGF0aCBkZWwgYXZhdGFyIGFudGVyaW9yXHJcbiAgICAgIGNvbnN0IG9sZFBhdGggPSB1c2VyRGF0YS5hdmF0YXJfdXJsLnNwbGl0KCcvJykuc2xpY2UoLTIpLmpvaW4oJy8nKTtcclxuICAgICAgYXdhaXQgc3VwYWJhc2VTdG9yYWdlLnN0b3JhZ2VcclxuICAgICAgICAuZnJvbShBVkFUQVJfQlVDS0VUKVxyXG4gICAgICAgIC5yZW1vdmUoW29sZFBhdGhdKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTdWJpciBudWV2byBhcmNoaXZvIGEgU3VwYWJhc2UgU3RvcmFnZVxyXG4gICAgY29uc3QgeyBkYXRhOiB1cGxvYWREYXRhLCBlcnJvcjogdXBsb2FkRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlU3RvcmFnZS5zdG9yYWdlXHJcbiAgICAgIC5mcm9tKEFWQVRBUl9CVUNLRVQpXHJcbiAgICAgIC51cGxvYWQoZmlsZVBhdGgsIGJ1ZmZlciwge1xyXG4gICAgICAgIGNvbnRlbnRUeXBlOiBmaWxlLnR5cGUsXHJcbiAgICAgICAgdXBzZXJ0OiB0cnVlLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodXBsb2FkRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgc3ViaXIgYXJjaGl2bzonLCB1cGxvYWRFcnJvcik7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0Vycm9yIGFsIHN1YmlyIGVsIGFyY2hpdm8nIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT2J0ZW5lciBVUkwgcMO6YmxpY2EgZGVsIGFyY2hpdm9cclxuICAgIGNvbnN0IHsgZGF0YTogdXJsRGF0YSB9ID0gc3VwYWJhc2VTdG9yYWdlLnN0b3JhZ2VcclxuICAgICAgLmZyb20oQVZBVEFSX0JVQ0tFVClcclxuICAgICAgLmdldFB1YmxpY1VybChmaWxlUGF0aCk7XHJcblxyXG4gICAgY29uc3QgYXZhdGFyVXJsID0gdXJsRGF0YS5wdWJsaWNVcmw7XHJcblxyXG4gICAgLy8gQWN0dWFsaXphciBVUkwgZGVsIGF2YXRhciBlbiBsYSBiYXNlIGRlIGRhdG9zXHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRVc2VyLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3VzZXJzJylcclxuICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgYXZhdGFyX3VybDogYXZhdGFyVXJsLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgfSlcclxuICAgICAgLmVxKCdjbGVya19pZCcsIHVzZXJJZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAodXBkYXRlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWwgYWN0dWFsaXphciB1c3VhcmlvOicsIHVwZGF0ZUVycm9yKTtcclxuICAgICAgLy8gSW50ZW50YXIgZWxpbWluYXIgZWwgYXJjaGl2byBzdWJpZG8gc2kgZmFsbGEgbGEgYWN0dWFsaXphY2nDs25cclxuICAgICAgYXdhaXQgc3VwYWJhc2VTdG9yYWdlLnN0b3JhZ2VcclxuICAgICAgICAuZnJvbShBVkFUQVJfQlVDS0VUKVxyXG4gICAgICAgIC5yZW1vdmUoW2ZpbGVQYXRoXSk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFcnJvciBhbCBhY3R1YWxpemFyIGVsIHBlcmZpbCcgfSxcclxuICAgICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBhdmF0YXJfdXJsOiBhdmF0YXJVcmwsXHJcbiAgICAgIHVzZXI6IHVwZGF0ZWRVc2VyLFxyXG4gICAgICBtZXNzYWdlOiAnQXZhdGFyIHN1YmlkbyBjb3JyZWN0YW1lbnRlJyxcclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gUE9TVCAvYXBpL3VzZXIvYXZhdGFyOicsIGVycm9yKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gREVMRVRFIC0gRWxpbWluYXIgYXZhdGFyXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgLy8gVmVyaWZpY2FyIGF1dGVudGljYWNpw7NuXHJcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aCgpO1xyXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VzdWFyaW8gbm8gYXV0ZW50aWNhZG8nIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXNlcklkID0gc2Vzc2lvbi51c2VyLmlkO1xyXG5cclxuICAgIC8vIE9idGVuZXIgZGF0b3MgZGVsIHVzdWFyaW9cclxuICAgIGNvbnN0IHsgZGF0YTogdXNlckRhdGEsIGVycm9yOiB1c2VyRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3VzZXJzJylcclxuICAgICAgLnNlbGVjdCgnYXZhdGFyX3VybCcpXHJcbiAgICAgIC5lcSgnY2xlcmtfaWQnLCB1c2VySWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAodXNlckVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIG9idGVuZXIgdXN1YXJpbzonLCB1c2VyRXJyb3IpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFcnJvciBhbCBvYnRlbmVyIGRhdG9zIGRlbCB1c3VhcmlvJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghdXNlckRhdGE/LmF2YXRhcl91cmwpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gaGF5IGF2YXRhciBwYXJhIGVsaW1pbmFyJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEV4dHJhZXIgZWwgcGF0aCBkZWwgYXJjaGl2byBkZWwgYXZhdGFyXHJcbiAgICBjb25zdCBhdmF0YXJQYXRoID0gdXNlckRhdGEuYXZhdGFyX3VybC5zcGxpdCgnLycpLnNsaWNlKC0yKS5qb2luKCcvJyk7XHJcblxyXG4gICAgLy8gRWxpbWluYXIgYXJjaGl2byBkZSBTdXBhYmFzZSBTdG9yYWdlXHJcbiAgICBjb25zdCB7IGVycm9yOiBkZWxldGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VTdG9yYWdlLnN0b3JhZ2VcclxuICAgICAgLmZyb20oQVZBVEFSX0JVQ0tFVClcclxuICAgICAgLnJlbW92ZShbYXZhdGFyUGF0aF0pO1xyXG5cclxuICAgIGlmIChkZWxldGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBlbGltaW5hciBhcmNoaXZvOicsIGRlbGV0ZUVycm9yKTtcclxuICAgICAgLy8gQ29udGludWFyIGNvbiBsYSBhY3R1YWxpemFjacOzbiBkZSBsYSBiYXNlIGRlIGRhdG9zIGF1bnF1ZSBmYWxsZSBsYSBlbGltaW5hY2nDs24gZGVsIGFyY2hpdm9cclxuICAgIH1cclxuXHJcbiAgICAvLyBBY3R1YWxpemFyIGJhc2UgZGUgZGF0b3MgcGFyYSByZW1vdmVyIGxhIFVSTCBkZWwgYXZhdGFyXHJcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRVc2VyLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3VzZXJzJylcclxuICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgYXZhdGFyX3VybDogbnVsbCxcclxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIH0pXHJcbiAgICAgIC5lcSgnY2xlcmtfaWQnLCB1c2VySWQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIGFjdHVhbGl6YXIgdXN1YXJpbzonLCB1cGRhdGVFcnJvcik7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0Vycm9yIGFsIGFjdHVhbGl6YXIgZWwgcGVyZmlsJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIHVzZXI6IHVwZGF0ZWRVc2VyLFxyXG4gICAgICBtZXNzYWdlOiAnQXZhdGFyIGVsaW1pbmFkbyBjb3JyZWN0YW1lbnRlJyxcclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gREVMRVRFIC9hcGkvdXNlci9hdmF0YXI6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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