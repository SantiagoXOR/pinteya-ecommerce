{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\lib\\notifications\\email.ts"],"sourcesContent":["'use client'\r\n\r\nimport { toast } from '@/components/ui/use-toast'\r\n\r\nexport interface EmailNotificationConfig {\r\n  to: string | string[]\r\n  subject: string\r\n  template: string\r\n  data?: Record<string, any>\r\n  priority?: 'low' | 'normal' | 'high'\r\n  scheduledAt?: Date\r\n}\r\n\r\nexport interface EmailTemplate {\r\n  id: string\r\n  name: string\r\n  subject: string\r\n  htmlContent: string\r\n  textContent?: string\r\n  variables: string[]\r\n}\r\n\r\nexport class EmailNotificationService {\r\n  private static instance: EmailNotificationService\r\n  private apiEndpoint = '/api/notifications/email'\r\n\r\n  static getInstance(): EmailNotificationService {\r\n    if (!EmailNotificationService.instance) {\r\n      EmailNotificationService.instance = new EmailNotificationService()\r\n    }\r\n    return EmailNotificationService.instance\r\n  }\r\n\r\n  async sendNotification(config: EmailNotificationConfig): Promise<boolean> {\r\n    try {\r\n      const response = await fetch(this.apiEndpoint, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(config)\r\n      })\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Error al enviar notificación por email')\r\n      }\r\n\r\n      const result = await response.json()\r\n      return result.success\r\n    } catch (error) {\r\n      console.error('Error sending email notification:', error)\r\n      toast({\r\n        title: 'Error',\r\n        description: 'No se pudo enviar la notificación por email',\r\n        variant: 'destructive'\r\n      })\r\n      return false\r\n    }\r\n  }\r\n\r\n  async sendOrderConfirmation(orderData: {\r\n    customerEmail: string\r\n    orderId: string\r\n    customerName: string\r\n    items: Array<{ name: string; quantity: number; price: number }>\r\n    total: number\r\n    shippingAddress: any\r\n  }): Promise<boolean> {\r\n    return this.sendNotification({\r\n      to: orderData.customerEmail,\r\n      subject: `Confirmación de pedido #${orderData.orderId}`,\r\n      template: 'order-confirmation',\r\n      data: orderData,\r\n      priority: 'high'\r\n    })\r\n  }\r\n\r\n  async sendShippingNotification(shippingData: {\r\n    customerEmail: string\r\n    orderId: string\r\n    trackingNumber: string\r\n    estimatedDelivery: string\r\n  }): Promise<boolean> {\r\n    return this.sendNotification({\r\n      to: shippingData.customerEmail,\r\n      subject: `Tu pedido #${shippingData.orderId} está en camino`,\r\n      template: 'shipping-notification',\r\n      data: shippingData,\r\n      priority: 'normal'\r\n    })\r\n  }\r\n\r\n  async sendPasswordReset(userData: {\r\n    email: string\r\n    resetToken: string\r\n    userName: string\r\n  }): Promise<boolean> {\r\n    return this.sendNotification({\r\n      to: userData.email,\r\n      subject: 'Restablecer contraseña',\r\n      template: 'password-reset',\r\n      data: userData,\r\n      priority: 'high'\r\n    })\r\n  }\r\n\r\n  async sendWelcomeEmail(userData: {\r\n    email: string\r\n    userName: string\r\n    verificationToken?: string\r\n  }): Promise<boolean> {\r\n    return this.sendNotification({\r\n      to: userData.email,\r\n      subject: '¡Bienvenido a nuestra tienda!',\r\n      template: 'welcome',\r\n      data: userData,\r\n      priority: 'normal'\r\n    })\r\n  }\r\n\r\n  async sendLowStockAlert(productData: {\r\n    adminEmails: string[]\r\n    productName: string\r\n    currentStock: number\r\n    minimumStock: number\r\n    productId: string\r\n  }): Promise<boolean> {\r\n    return this.sendNotification({\r\n      to: productData.adminEmails,\r\n      subject: `Alerta: Stock bajo - ${productData.productName}`,\r\n      template: 'low-stock-alert',\r\n      data: productData,\r\n      priority: 'high'\r\n    })\r\n  }\r\n\r\n  async sendOrderStatusUpdate(statusData: {\r\n    customerEmail: string\r\n    orderId: string\r\n    newStatus: string\r\n    customerName: string\r\n    statusMessage?: string\r\n  }): Promise<boolean> {\r\n    return this.sendNotification({\r\n      to: statusData.customerEmail,\r\n      subject: `Actualización de pedido #${statusData.orderId}`,\r\n      template: 'order-status-update',\r\n      data: statusData,\r\n      priority: 'normal'\r\n    })\r\n  }\r\n\r\n  async sendPromotionalEmail(promoData: {\r\n    recipients: string[]\r\n    subject: string\r\n    promoCode?: string\r\n    discount?: number\r\n    validUntil?: string\r\n    products?: Array<{ name: string; price: number; image: string }>\r\n  }): Promise<boolean> {\r\n    return this.sendNotification({\r\n      to: promoData.recipients,\r\n      subject: promoData.subject,\r\n      template: 'promotional',\r\n      data: promoData,\r\n      priority: 'low'\r\n    })\r\n  }\r\n\r\n  async getEmailTemplates(): Promise<EmailTemplate[]> {\r\n    try {\r\n      const response = await fetch('/api/notifications/email/templates')\r\n      if (!response.ok) {\r\n        throw new Error('Error al obtener plantillas')\r\n      }\r\n      return await response.json()\r\n    } catch (error) {\r\n      console.error('Error fetching email templates:', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  async scheduleEmail(config: EmailNotificationConfig): Promise<boolean> {\r\n    if (!config.scheduledAt) {\r\n      throw new Error('scheduledAt is required for scheduled emails')\r\n    }\r\n\r\n    try {\r\n      const response = await fetch('/api/notifications/email/schedule', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(config)\r\n      })\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Error al programar email')\r\n      }\r\n\r\n      return true\r\n    } catch (error) {\r\n      console.error('Error scheduling email:', error)\r\n      return false\r\n    }\r\n  }\r\n}\r\n\r\n// Instancia singleton para uso global\r\nexport const emailService = EmailNotificationService.getInstance()\r\n\r\n// Funciones de conveniencia\r\nexport const sendOrderConfirmation = (orderData: Parameters<EmailNotificationService['sendOrderConfirmation']>[0]) => \r\n  emailService.sendOrderConfirmation(orderData)\r\n\r\nexport const sendShippingNotification = (shippingData: Parameters<EmailNotificationService['sendShippingNotification']>[0]) => \r\n  emailService.sendShippingNotification(shippingData)\r\n\r\nexport const sendPasswordReset = (userData: Parameters<EmailNotificationService['sendPasswordReset']>[0]) => \r\n  emailService.sendPasswordReset(userData)\r\n\r\nexport const sendWelcomeEmail = (userData: Parameters<EmailNotificationService['sendWelcomeEmail']>[0]) => \r\n  emailService.sendWelcomeEmail(userData)\r\n\r\nexport const sendLowStockAlert = (productData: Parameters<EmailNotificationService['sendLowStockAlert']>[0]) => \r\n  emailService.sendLowStockAlert(productData)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["EmailNotificationService","emailService","sendLowStockAlert","sendOrderConfirmation","sendPasswordReset","sendShippingNotification","sendWelcomeEmail","getInstance","instance","sendNotification","config","response","fetch","apiEndpoint","method","headers","body","JSON","stringify","ok","Error","result","json","success","error","console","toast","title","description","variant","orderData","to","customerEmail","subject","orderId","template","data","priority","shippingData","userData","email","productData","adminEmails","productName","sendOrderStatusUpdate","statusData","sendPromotionalEmail","promoData","recipients","getEmailTemplates","scheduleEmail","scheduledAt"],"mappings":"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"}