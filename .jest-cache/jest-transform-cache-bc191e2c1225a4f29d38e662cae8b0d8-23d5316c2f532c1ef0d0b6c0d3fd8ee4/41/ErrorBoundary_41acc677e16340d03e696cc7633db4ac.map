{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\components\\ErrorBoundary.tsx"],"sourcesContent":["'use client'\n\nimport React, { Component, ErrorInfo, ReactNode } from 'react'\nimport { Button } from './ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from './ui/card'\nimport { Alert, AlertDescription } from './ui/alert'\nimport { proactiveMonitoring } from '../lib/monitoring/proactive-monitoring'\nimport { logger, LogLevel, LogCategory } from '@/lib/enterprise/logger'\nimport { AlertTriangle, RefreshCw, Home, Bug } from 'lucide-react'\n\ninterface Props {\n  children: ReactNode\n  fallback?: ReactNode\n  onError?: (error: Error, errorInfo: ErrorInfo) => void\n  showDetails?: boolean\n  enableReporting?: boolean\n}\n\ninterface State {\n  hasError: boolean\n  error: Error | null\n  errorInfo: ErrorInfo | null\n  errorId: string | null\n}\n\nexport class ErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props)\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorId: null,\n    }\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<State> {\n    // Actualizar el estado para mostrar la UI de error\n    return {\n      hasError: true,\n      error,\n      errorId: `error_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n    }\n  }\n\n  async componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    // Actualizar estado con información del error\n    this.setState({ errorInfo })\n\n    // Llamar callback personalizado si existe\n    if (this.props.onError) {\n      this.props.onError(error, errorInfo)\n    }\n\n    // Reportar error al sistema de monitoreo si está habilitado\n    if (this.props.enableReporting !== false) {\n      try {\n        await proactiveMonitoring.reportError(error, {\n          errorBoundary: true,\n          componentStack: errorInfo.componentStack,\n          errorInfo: {\n            componentStack: errorInfo.componentStack,\n            errorBoundary: true,\n          },\n          timestamp: new Date().toISOString(),\n          userAgent: typeof window !== 'undefined' ? window.navigator.userAgent : 'unknown',\n          url: typeof window !== 'undefined' ? window.location.href : 'unknown',\n          errorId: this.state.errorId,\n        })\n      } catch (reportingError) {\n        logger.error(\n          LogLevel.ERROR,\n          'Failed to report error to monitoring system',\n          {\n            originalError: error.message,\n            reportingError:\n              reportingError instanceof Error ? reportingError.message : 'Unknown error',\n          },\n          LogCategory.SYSTEM\n        )\n      }\n    }\n\n    // Log del error\n    logger.error(\n      LogLevel.ERROR,\n      'React Error Boundary caught an error',\n      {\n        error: error.message,\n        stack: error.stack,\n        componentStack: errorInfo.componentStack,\n        errorId: this.state.errorId,\n      },\n      LogCategory.UI\n    )\n  }\n\n  handleRetry = () => {\n    this.setState({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorId: null,\n    })\n  }\n\n  handleReload = () => {\n    if (typeof window !== 'undefined') {\n      window.location.reload()\n    }\n  }\n\n  handleGoHome = () => {\n    if (typeof window !== 'undefined') {\n      window.location.href = '/'\n    }\n  }\n\n  render() {\n    if (this.state.hasError) {\n      // Usar fallback personalizado si se proporciona\n      if (this.props.fallback) {\n        return this.props.fallback\n      }\n\n      // UI de error por defecto\n      return (\n        <div className='min-h-screen flex items-center justify-center bg-gray-50 px-4'>\n          <Card className='w-full max-w-2xl'>\n            <CardHeader className='text-center'>\n              <div className='mx-auto mb-4 h-12 w-12 text-red-500'>\n                <AlertTriangle className='h-full w-full' />\n              </div>\n              <CardTitle className='text-2xl font-bold text-red-600'>\n                ¡Oops! Algo salió mal\n              </CardTitle>\n              <CardDescription className='text-lg'>\n                Se ha producido un error inesperado en la aplicación\n              </CardDescription>\n            </CardHeader>\n\n            <CardContent className='space-y-6'>\n              {/* Error ID para soporte */}\n              {this.state.errorId && (\n                <Alert>\n                  <Bug className='h-4 w-4' />\n                  <AlertDescription>\n                    <strong>ID del Error:</strong> {this.state.errorId}\n                    <br />\n                    <span className='text-sm text-muted-foreground'>\n                      Proporciona este ID al equipo de soporte para una asistencia más rápida\n                    </span>\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              {/* Detalles del error (solo en desarrollo o si se habilita explícitamente) */}\n              {this.props.showDetails && this.state.error && (\n                <div className='space-y-4'>\n                  <Alert variant='destructive'>\n                    <AlertDescription>\n                      <strong>Error:</strong> {this.state.error.message}\n                    </AlertDescription>\n                  </Alert>\n\n                  {this.state.error.stack && (\n                    <details className='text-sm'>\n                      <summary className='cursor-pointer font-medium text-gray-700 hover:text-gray-900'>\n                        Ver detalles técnicos\n                      </summary>\n                      <pre className='mt-2 whitespace-pre-wrap bg-gray-100 p-3 rounded text-xs overflow-auto max-h-40'>\n                        {this.state.error.stack}\n                      </pre>\n                    </details>\n                  )}\n\n                  {this.state.errorInfo?.componentStack && (\n                    <details className='text-sm'>\n                      <summary className='cursor-pointer font-medium text-gray-700 hover:text-gray-900'>\n                        Ver stack de componentes\n                      </summary>\n                      <pre className='mt-2 whitespace-pre-wrap bg-gray-100 p-3 rounded text-xs overflow-auto max-h-40'>\n                        {this.state.errorInfo.componentStack}\n                      </pre>\n                    </details>\n                  )}\n                </div>\n              )}\n\n              {/* Acciones */}\n              <div className='flex flex-col sm:flex-row gap-3 justify-center'>\n                <Button onClick={this.handleRetry} className='flex items-center'>\n                  <RefreshCw className='h-4 w-4 mr-2' />\n                  Intentar de nuevo\n                </Button>\n\n                <Button variant='outline' onClick={this.handleReload} className='flex items-center'>\n                  <RefreshCw className='h-4 w-4 mr-2' />\n                  Recargar página\n                </Button>\n\n                <Button variant='outline' onClick={this.handleGoHome} className='flex items-center'>\n                  <Home className='h-4 w-4 mr-2' />\n                  Ir al inicio\n                </Button>\n              </div>\n\n              {/* Información adicional */}\n              <div className='text-center text-sm text-muted-foreground'>\n                <p>Si el problema persiste, por favor contacta al equipo de soporte.</p>\n                {this.props.enableReporting !== false && (\n                  <p className='mt-1'>\n                    Este error ha sido reportado automáticamente para su revisión.\n                  </p>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )\n    }\n\n    return this.props.children\n  }\n}\n\n/**\n * Hook para usar Error Boundary de forma funcional\n */\nexport function useErrorHandler() {\n  const reportError = React.useCallback(async (error: Error, context?: Record<string, any>) => {\n    try {\n      await proactiveMonitoring.reportError(error, {\n        ...context,\n        source: 'useErrorHandler',\n        timestamp: new Date().toISOString(),\n        url: typeof window !== 'undefined' ? window.location.href : 'unknown',\n      })\n    } catch (reportingError) {\n      logger.error(\n        LogLevel.ERROR,\n        'Failed to report error via useErrorHandler',\n        {\n          originalError: error.message,\n          reportingError:\n            reportingError instanceof Error ? reportingError.message : 'Unknown error',\n        },\n        LogCategory.SYSTEM\n      )\n    }\n  }, [])\n\n  return { reportError }\n}\n\n/**\n * Componente wrapper para facilitar el uso de Error Boundary\n */\ninterface ErrorBoundaryWrapperProps {\n  children: ReactNode\n  fallback?: ReactNode\n  showDetails?: boolean\n  enableReporting?: boolean\n}\n\nexport function ErrorBoundaryWrapper({\n  children,\n  fallback,\n  showDetails = process.env.NODE_ENV === 'development',\n  enableReporting = true,\n}: ErrorBoundaryWrapperProps) {\n  return (\n    <ErrorBoundary fallback={fallback} showDetails={showDetails} enableReporting={enableReporting}>\n      {children}\n    </ErrorBoundary>\n  )\n}\n\n/**\n * Error Boundary específico para páginas\n */\nexport function PageErrorBoundary({ children }: { children: ReactNode }) {\n  return (\n    <ErrorBoundary\n      showDetails={process.env.NODE_ENV === 'development'}\n      enableReporting={true}\n      fallback={\n        <div className='min-h-screen flex items-center justify-center'>\n          <Card className='w-full max-w-md'>\n            <CardHeader className='text-center'>\n              <AlertTriangle className='h-12 w-12 text-red-500 mx-auto mb-4' />\n              <CardTitle>Error en la página</CardTitle>\n              <CardDescription>No se pudo cargar esta página correctamente</CardDescription>\n            </CardHeader>\n            <CardContent className='text-center'>\n              <Button onClick={() => window.location.reload()} className='mr-2'>\n                <RefreshCw className='h-4 w-4 mr-2' />\n                Recargar\n              </Button>\n              <Button variant='outline' onClick={() => (window.location.href = '/')}>\n                <Home className='h-4 w-4 mr-2' />\n                Inicio\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      }\n    >\n      {children}\n    </ErrorBoundary>\n  )\n}\n"],"names":["ErrorBoundary","ErrorBoundaryWrapper","PageErrorBoundary","useErrorHandler","Component","props","handleRetry","setState","hasError","error","errorInfo","errorId","handleReload","window","location","reload","handleGoHome","href","state","getDerivedStateFromError","Date","now","Math","random","toString","substr","componentDidCatch","onError","enableReporting","proactiveMonitoring","reportError","errorBoundary","componentStack","timestamp","toISOString","userAgent","navigator","url","reportingError","logger","LogLevel","ERROR","originalError","message","Error","LogCategory","SYSTEM","stack","UI","render","fallback","div","className","Card","CardHeader","AlertTriangle","CardTitle","CardDescription","CardContent","Alert","Bug","AlertDescription","strong","br","span","showDetails","variant","details","summary","pre","Button","onClick","RefreshCw","Home","p","children","React","useCallback","context","source","process","env","NODE_ENV"],"mappings":"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"}