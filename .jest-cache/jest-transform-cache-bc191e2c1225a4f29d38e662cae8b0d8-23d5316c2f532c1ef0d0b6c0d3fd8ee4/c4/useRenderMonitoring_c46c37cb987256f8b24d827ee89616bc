fe7393316c69d431e523e471f8355d92
// ===================================
// PINTEYA E-COMMERCE - RENDER MONITORING SYSTEM
// Sistema de monitoreo en tiempo real para detectar problemas de renderizado
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get clearAllAlerts () {
        return clearAllAlerts;
    },
    get exportMonitoringData () {
        return exportMonitoringData;
    },
    get getActiveAlerts () {
        return getActiveAlerts;
    },
    get getComponentMetrics () {
        return getComponentMetrics;
    },
    get useGlobalMonitoring () {
        return useGlobalMonitoring;
    },
    get useRenderMonitoring () {
        return useRenderMonitoring;
    },
    get withRenderMonitoring () {
        return withRenderMonitoring;
    }
});
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _usetoast = require("../use-toast");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
// ===================================
// CONFIGURACIÓN POR DEFECTO
// ===================================
const DEFAULT_THRESHOLDS = {
    slowRenderThreshold: 16,
    maxRenderCount: 60,
    memoryThreshold: 100,
    errorThreshold: 5
};
const DEFAULT_OPTIONS = {
    enabled: process.env.NODE_ENV === 'development',
    thresholds: DEFAULT_THRESHOLDS,
    enableToasts: true,
    enableConsoleLogging: true,
    enableLocalStorage: true,
    sampleRate: 1.0
};
// ===================================
// ALMACENAMIENTO GLOBAL
// ===================================
class MonitoringStore {
    static getInstance() {
        if (!MonitoringStore.instance) {
            MonitoringStore.instance = new MonitoringStore();
        }
        return MonitoringStore.instance;
    }
    addListener(listener) {
        this.listeners.add(listener);
        return ()=>this.listeners.delete(listener);
    }
    notifyListeners() {
        // Debounce para evitar loops infinitos
        if (this.notifyTimeout) {
            clearTimeout(this.notifyTimeout);
        }
        this.notifyTimeout = setTimeout(()=>{
            const state = this.getState();
            this.listeners.forEach((listener)=>listener(state));
            this.notifyTimeout = null;
        }, 16); // 16ms = ~60fps
    }
    getState() {
        const totalRenders = Array.from(this.metrics.values()).reduce((sum, metric)=>sum + metric.renderCount, 0);
        const averageRenderTime = Array.from(this.metrics.values()).reduce((sum, metric, _, arr)=>sum + metric.averageRenderTime / arr.length, 0);
        return {
            isEnabled: true,
            metrics: new Map(this.metrics),
            alerts: [
                ...this.alerts
            ],
            globalStats: {
                totalComponents: this.metrics.size,
                totalRenders,
                averageRenderTime,
                activeAlerts: this.alerts.filter((alert)=>!alert.resolved).length
            }
        };
    }
    updateMetrics(componentName, metrics) {
        const existing = this.metrics.get(componentName);
        const updated = {
            componentName,
            renderCount: 0,
            averageRenderTime: 0,
            lastRenderTime: 0,
            slowRenders: 0,
            errorCount: 0,
            timestamp: Date.now(),
            ...existing,
            ...metrics
        };
        this.metrics.set(componentName, updated);
        this.notifyListeners();
    }
    addAlert(alert) {
        const newAlert = {
            ...alert,
            id: `alert-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
            timestamp: Date.now(),
            resolved: false
        };
        this.alerts.unshift(newAlert);
        // Mantener solo las últimas 100 alertas
        if (this.alerts.length > 100) {
            this.alerts = this.alerts.slice(0, 100);
        }
        this.notifyListeners();
    }
    resolveAlert(alertId) {
        const alert = this.alerts.find((a)=>a.id === alertId);
        if (alert) {
            ;
            alert.resolved = true;
            this.notifyListeners();
        }
    }
    clearAlerts() {
        this.alerts = [];
        this.notifyListeners();
    }
    exportData() {
        return JSON.stringify({
            metrics: Array.from(this.metrics.entries()),
            alerts: this.alerts,
            timestamp: Date.now()
        }, null, 2);
    }
    constructor(){
        this.metrics = new Map();
        this.alerts = [];
        this.listeners = new Set();
        this.notifyTimeout = null;
    }
}
const monitoringStore = MonitoringStore.getInstance();
// ===================================
// UTILIDADES DE PERFORMANCE
// ===================================
function measureRenderTime(fn) {
    const start = performance.now();
    const result = fn();
    const duration = performance.now() - start;
    return {
        result,
        duration
    };
}
function getMemoryUsage() {
    if ('memory' in performance) {
        return performance.memory.usedJSHeapSize / 1024 / 1024 // MB
        ;
    }
    return 0;
}
function shouldSample(sampleRate) {
    return Math.random() < sampleRate;
}
function useRenderMonitoring(options) {
    const opts = {
        ...DEFAULT_OPTIONS,
        ...options
    };
    const { toast } = (0, _usetoast.useToast)();
    // Referencias para tracking
    const renderCountRef = (0, _react.useRef)(0);
    const renderTimesRef = (0, _react.useRef)([]);
    const lastRenderTimeRef = (0, _react.useRef)(0);
    const slowRendersRef = (0, _react.useRef)(0);
    const errorCountRef = (0, _react.useRef)(0);
    const mountTimeRef = (0, _react.useRef)(Date.now());
    // Estado local
    const [monitoringState, setMonitoringState] = (0, _react.useState)(monitoringStore.getState());
    // ===================================
    // FUNCIONES DE ANÁLISIS
    // ===================================
    const analyzePerformance = (0, _react.useCallback)((renderTime)=>{
        const { componentName, thresholds } = opts;
        // Detectar render lento
        if (renderTime > thresholds.slowRenderThreshold) {
            slowRendersRef.current++;
            monitoringStore.addAlert({
                type: 'performance',
                severity: renderTime > thresholds.slowRenderThreshold * 2 ? 'high' : 'medium',
                message: `Render lento detectado: ${renderTime.toFixed(2)}ms (umbral: ${thresholds.slowRenderThreshold}ms)`,
                componentName,
                metrics: {
                    lastRenderTime: renderTime
                }
            });
            if (opts.enableConsoleLogging) {
                console.warn(`[RenderMonitoring] Slow render in ${componentName}: ${renderTime.toFixed(2)}ms`);
            }
        }
        // Detectar posible render loop
        const now = Date.now();
        const oneMinuteAgo = now - 60000;
        const recentRenders = renderTimesRef.current.filter((time)=>time > oneMinuteAgo).length;
        if (recentRenders > thresholds.maxRenderCount) {
            monitoringStore.addAlert({
                type: 'render-loop',
                severity: 'critical',
                message: `Posible render loop: ${recentRenders} renders en el último minuto (máximo: ${thresholds.maxRenderCount})`,
                componentName,
                metrics: {
                    renderCount: recentRenders
                }
            });
            if (opts.enableToasts) {
                toast({
                    title: 'Render Loop Detectado',
                    description: `${componentName}: ${recentRenders} renders/min`,
                    variant: 'destructive'
                });
            }
        }
        // Detectar uso excesivo de memoria
        const memoryUsage = getMemoryUsage();
        if (memoryUsage > thresholds.memoryThreshold) {
            monitoringStore.addAlert({
                type: 'memory',
                severity: 'high',
                message: `Uso de memoria elevado: ${memoryUsage.toFixed(2)}MB (umbral: ${thresholds.memoryThreshold}MB)`,
                componentName,
                metrics: {
                    memoryUsage
                }
            });
        }
    }, [
        opts,
        toast
    ]);
    // ===================================
    // FUNCIÓN DE TRACKING DE RENDER
    // ===================================
    const trackRender = (0, _react.useCallback)(()=>{
        if (!opts.enabled || !shouldSample(opts.sampleRate)) {
            return;
        }
        const renderTime = performance.now() - lastRenderTimeRef.current;
        renderCountRef.current++;
        renderTimesRef.current.push(Date.now());
        // Mantener solo los últimos 100 renders
        if (renderTimesRef.current.length > 100) {
            renderTimesRef.current = renderTimesRef.current.slice(-100);
        }
        // Calcular promedio de tiempo de render
        const recentTimes = renderTimesRef.current.slice(-10) // Últimos 10 renders
        ;
        const averageRenderTime = recentTimes.reduce((sum, time, i, arr)=>{
            if (i === 0) {
                return 0;
            }
            return sum + (time - arr[i - 1]) / (arr.length - 1);
        }, 0);
        // Actualizar métricas
        const metrics = {
            renderCount: renderCountRef.current,
            averageRenderTime,
            lastRenderTime: renderTime,
            slowRenders: slowRendersRef.current,
            errorCount: errorCountRef.current,
            memoryUsage: getMemoryUsage(),
            timestamp: Date.now()
        };
        monitoringStore.updateMetrics(opts.componentName, metrics);
        // Analizar performance
        analyzePerformance(renderTime);
        // Guardar en localStorage si está habilitado
        if (opts.enableLocalStorage) {
            try {
                localStorage.setItem(`render-monitoring-${opts.componentName}`, JSON.stringify(metrics));
            } catch (error) {
            // Ignorar errores de localStorage
            }
        }
        lastRenderTimeRef.current = performance.now();
    }, [
        opts,
        analyzePerformance
    ]);
    // ===================================
    // FUNCIÓN DE TRACKING DE ERRORES
    // ===================================
    const trackError = (0, _react.useCallback)((error, errorInfo)=>{
        if (!opts.enabled) {
            return;
        }
        errorCountRef.current++;
        monitoringStore.addAlert({
            type: 'error',
            severity: 'high',
            message: `Error en componente: ${error.message}`,
            componentName: opts.componentName,
            metrics: {
                errorCount: errorCountRef.current
            }
        });
        if (opts.enableConsoleLogging) {
            console.error(`[RenderMonitoring] Error in ${opts.componentName}:`, error, errorInfo);
        }
        if (opts.enableToasts) {
            toast({
                title: 'Error de Componente',
                description: `${opts.componentName}: ${error.message}`,
                variant: 'destructive'
            });
        }
    }, [
        opts,
        toast
    ]);
    // ===================================
    // EFECTOS
    // ===================================
    // Suscribirse a cambios del store
    (0, _react.useEffect)(()=>{
        const unsubscribe = monitoringStore.addListener(setMonitoringState);
        return unsubscribe;
    }, []);
    // Track render en cada render del componente
    (0, _react.useEffect)(()=>{
        trackRender();
    });
    // Cleanup al desmontar
    (0, _react.useEffect)(()=>{
        return ()=>{
            if (opts.enableConsoleLogging) {
                const totalTime = Date.now() - mountTimeRef.current;
                console.log(`[RenderMonitoring] ${opts.componentName} unmounted after ${totalTime}ms, ` + `${renderCountRef.current} renders, ` + `${slowRendersRef.current} slow renders, ` + `${errorCountRef.current} errors`);
            }
        };
    }, [
        opts
    ]);
    // ===================================
    // API PÚBLICA
    // ===================================
    return {
        // Estado
        isEnabled: opts.enabled,
        metrics: monitoringState.metrics.get(opts.componentName),
        globalStats: monitoringState.globalStats,
        alerts: monitoringState.alerts.filter((alert)=>alert.componentName === opts.componentName),
        // Funciones
        trackError,
        trackRender,
        // Utilidades
        exportData: ()=>monitoringStore.exportData(),
        clearAlerts: ()=>monitoringStore.clearAlerts(),
        resolveAlert: (alertId)=>monitoringStore.resolveAlert(alertId)
    };
}
function useGlobalMonitoring() {
    const [state, setState] = (0, _react.useState)(monitoringStore.getState());
    (0, _react.useEffect)(()=>{
        const unsubscribe = monitoringStore.addListener(setState);
        return unsubscribe;
    }, []);
    return {
        ...state,
        exportData: ()=>monitoringStore.exportData(),
        clearAlerts: ()=>monitoringStore.clearAlerts(),
        resolveAlert: (alertId)=>monitoringStore.resolveAlert(alertId)
    };
}
function withRenderMonitoring(Component, options) {
    const componentName = Component.displayName || Component.name || 'UnknownComponent';
    const WrappedComponent = (props)=>{
        const { trackError } = useRenderMonitoring({
            ...options,
            componentName
        });
        // Error boundary simple
        (0, _react.useEffect)(()=>{
            const handleError = (event)=>{
                trackError(new Error(event.message));
            };
            window.addEventListener('error', handleError);
            return ()=>window.removeEventListener('error', handleError);
        }, [
            trackError
        ]);
        return _react.default.createElement(Component, props);
    };
    WrappedComponent.displayName = `withRenderMonitoring(${componentName})`;
    return WrappedComponent;
}
function getComponentMetrics(componentName) {
    return monitoringStore.getState().metrics.get(componentName);
}
function getActiveAlerts() {
    return monitoringStore.getState().alerts.filter((alert)=>!alert.resolved);
}
function exportMonitoringData() {
    return monitoringStore.exportData();
}
function clearAllAlerts() {
    monitoringStore.clearAlerts();
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXG1vbml0b3JpbmdcXHVzZVJlbmRlck1vbml0b3JpbmcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBJTlRFWUEgRS1DT01NRVJDRSAtIFJFTkRFUiBNT05JVE9SSU5HIFNZU1RFTVxuLy8gU2lzdGVtYSBkZSBtb25pdG9yZW8gZW4gdGllbXBvIHJlYWwgcGFyYSBkZXRlY3RhciBwcm9ibGVtYXMgZGUgcmVuZGVyaXphZG9cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCBSZWFjdCwgeyB1c2VFZmZlY3QsIHVzZVJlZiwgdXNlU3RhdGUsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyB1c2VUb2FzdCB9IGZyb20gJ0AvaG9va3MvdXNlLXRvYXN0J1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVElQT1MgWSBJTlRFUkZBQ0VTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlbmRlck1ldHJpY3Mge1xuICByZWFkb25seSBjb21wb25lbnROYW1lOiBzdHJpbmdcbiAgcmVhZG9ubHkgcmVuZGVyQ291bnQ6IG51bWJlclxuICByZWFkb25seSBhdmVyYWdlUmVuZGVyVGltZTogbnVtYmVyXG4gIHJlYWRvbmx5IGxhc3RSZW5kZXJUaW1lOiBudW1iZXJcbiAgcmVhZG9ubHkgc2xvd1JlbmRlcnM6IG51bWJlclxuICByZWFkb25seSBlcnJvckNvdW50OiBudW1iZXJcbiAgcmVhZG9ubHkgbWVtb3J5VXNhZ2U/OiBudW1iZXJcbiAgcmVhZG9ubHkgdGltZXN0YW1wOiBudW1iZXJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZVRocmVzaG9sZHMge1xuICByZWFkb25seSBzbG93UmVuZGVyVGhyZXNob2xkOiBudW1iZXIgLy8gbXNcbiAgcmVhZG9ubHkgbWF4UmVuZGVyQ291bnQ6IG51bWJlciAvLyByZW5kZXJzIHBlciBtaW51dGVcbiAgcmVhZG9ubHkgbWVtb3J5VGhyZXNob2xkOiBudW1iZXIgLy8gTUJcbiAgcmVhZG9ubHkgZXJyb3JUaHJlc2hvbGQ6IG51bWJlciAvLyBlcnJvcnMgcGVyIG1pbnV0ZVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1vbml0b3JpbmdBbGVydCB7XG4gIHJlYWRvbmx5IGlkOiBzdHJpbmdcbiAgcmVhZG9ubHkgdHlwZTogJ3BlcmZvcm1hbmNlJyB8ICdlcnJvcicgfCAnbWVtb3J5JyB8ICdyZW5kZXItbG9vcCdcbiAgcmVhZG9ubHkgc2V2ZXJpdHk6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnXG4gIHJlYWRvbmx5IG1lc3NhZ2U6IHN0cmluZ1xuICByZWFkb25seSBjb21wb25lbnROYW1lOiBzdHJpbmdcbiAgcmVhZG9ubHkgbWV0cmljczogUGFydGlhbDxSZW5kZXJNZXRyaWNzPlxuICByZWFkb25seSB0aW1lc3RhbXA6IG51bWJlclxuICByZWFkb25seSByZXNvbHZlZDogYm9vbGVhblxufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1vbml0b3JpbmdTdGF0ZSB7XG4gIHJlYWRvbmx5IGlzRW5hYmxlZDogYm9vbGVhblxuICByZWFkb25seSBtZXRyaWNzOiBNYXA8c3RyaW5nLCBSZW5kZXJNZXRyaWNzPlxuICByZWFkb25seSBhbGVydHM6IE1vbml0b3JpbmdBbGVydFtdXG4gIHJlYWRvbmx5IGdsb2JhbFN0YXRzOiB7XG4gICAgcmVhZG9ubHkgdG90YWxDb21wb25lbnRzOiBudW1iZXJcbiAgICByZWFkb25seSB0b3RhbFJlbmRlcnM6IG51bWJlclxuICAgIHJlYWRvbmx5IGF2ZXJhZ2VSZW5kZXJUaW1lOiBudW1iZXJcbiAgICByZWFkb25seSBhY3RpdmVBbGVydHM6IG51bWJlclxuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9uaXRvcmluZ09wdGlvbnMge1xuICByZWFkb25seSBlbmFibGVkPzogYm9vbGVhblxuICByZWFkb25seSBjb21wb25lbnROYW1lOiBzdHJpbmdcbiAgcmVhZG9ubHkgdGhyZXNob2xkcz86IFBhcnRpYWw8UGVyZm9ybWFuY2VUaHJlc2hvbGRzPlxuICByZWFkb25seSBlbmFibGVUb2FzdHM/OiBib29sZWFuXG4gIHJlYWRvbmx5IGVuYWJsZUNvbnNvbGVMb2dnaW5nPzogYm9vbGVhblxuICByZWFkb25seSBlbmFibGVMb2NhbFN0b3JhZ2U/OiBib29sZWFuXG4gIHJlYWRvbmx5IHNhbXBsZVJhdGU/OiBudW1iZXIgLy8gMC0xLCBwZXJjZW50YWdlIG9mIHJlbmRlcnMgdG8gbW9uaXRvclxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09ORklHVVJBQ0nDk04gUE9SIERFRkVDVE9cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNvbnN0IERFRkFVTFRfVEhSRVNIT0xEUzogUGVyZm9ybWFuY2VUaHJlc2hvbGRzID0ge1xuICBzbG93UmVuZGVyVGhyZXNob2xkOiAxNiwgLy8gMTZtcyA9IDYwZnBzXG4gIG1heFJlbmRlckNvdW50OiA2MCwgLy8gNjAgcmVuZGVycyBwZXIgbWludXRlXG4gIG1lbW9yeVRocmVzaG9sZDogMTAwLCAvLyAxMDBNQlxuICBlcnJvclRocmVzaG9sZDogNSwgLy8gNSBlcnJvcnMgcGVyIG1pbnV0ZVxufVxuXG5jb25zdCBERUZBVUxUX09QVElPTlM6IFJlcXVpcmVkPE9taXQ8TW9uaXRvcmluZ09wdGlvbnMsICdjb21wb25lbnROYW1lJz4+ID0ge1xuICBlbmFibGVkOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyxcbiAgdGhyZXNob2xkczogREVGQVVMVF9USFJFU0hPTERTLFxuICBlbmFibGVUb2FzdHM6IHRydWUsXG4gIGVuYWJsZUNvbnNvbGVMb2dnaW5nOiB0cnVlLFxuICBlbmFibGVMb2NhbFN0b3JhZ2U6IHRydWUsXG4gIHNhbXBsZVJhdGU6IDEuMCxcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEFMTUFDRU5BTUlFTlRPIEdMT0JBTFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuY2xhc3MgTW9uaXRvcmluZ1N0b3JlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IE1vbml0b3JpbmdTdG9yZVxuICBwcml2YXRlIG1ldHJpY3MgPSBuZXcgTWFwPHN0cmluZywgUmVuZGVyTWV0cmljcz4oKVxuICBwcml2YXRlIGFsZXJ0czogTW9uaXRvcmluZ0FsZXJ0W10gPSBbXVxuICBwcml2YXRlIGxpc3RlbmVycyA9IG5ldyBTZXQ8KHN0YXRlOiBNb25pdG9yaW5nU3RhdGUpID0+IHZvaWQ+KClcblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogTW9uaXRvcmluZ1N0b3JlIHtcbiAgICBpZiAoIU1vbml0b3JpbmdTdG9yZS5pbnN0YW5jZSkge1xuICAgICAgTW9uaXRvcmluZ1N0b3JlLmluc3RhbmNlID0gbmV3IE1vbml0b3JpbmdTdG9yZSgpXG4gICAgfVxuICAgIHJldHVybiBNb25pdG9yaW5nU3RvcmUuaW5zdGFuY2VcbiAgfVxuXG4gIGFkZExpc3RlbmVyKGxpc3RlbmVyOiAoc3RhdGU6IE1vbml0b3JpbmdTdGF0ZSkgPT4gdm9pZCk6ICgpID0+IHZvaWQge1xuICAgIHRoaXMubGlzdGVuZXJzLmFkZChsaXN0ZW5lcilcbiAgICByZXR1cm4gKCkgPT4gdGhpcy5saXN0ZW5lcnMuZGVsZXRlKGxpc3RlbmVyKVxuICB9XG5cbiAgcHJpdmF0ZSBub3RpZnlMaXN0ZW5lcnMoKTogdm9pZCB7XG4gICAgLy8gRGVib3VuY2UgcGFyYSBldml0YXIgbG9vcHMgaW5maW5pdG9zXG4gICAgaWYgKHRoaXMubm90aWZ5VGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMubm90aWZ5VGltZW91dClcbiAgICB9XG5cbiAgICB0aGlzLm5vdGlmeVRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5nZXRTdGF0ZSgpXG4gICAgICB0aGlzLmxpc3RlbmVycy5mb3JFYWNoKGxpc3RlbmVyID0+IGxpc3RlbmVyKHN0YXRlKSlcbiAgICAgIHRoaXMubm90aWZ5VGltZW91dCA9IG51bGxcbiAgICB9LCAxNikgLy8gMTZtcyA9IH42MGZwc1xuICB9XG5cbiAgcHJpdmF0ZSBub3RpZnlUaW1lb3V0OiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsXG5cbiAgZ2V0U3RhdGUoKTogTW9uaXRvcmluZ1N0YXRlIHtcbiAgICBjb25zdCB0b3RhbFJlbmRlcnMgPSBBcnJheS5mcm9tKHRoaXMubWV0cmljcy52YWx1ZXMoKSkucmVkdWNlKFxuICAgICAgKHN1bSwgbWV0cmljKSA9PiBzdW0gKyBtZXRyaWMucmVuZGVyQ291bnQsXG4gICAgICAwXG4gICAgKVxuXG4gICAgY29uc3QgYXZlcmFnZVJlbmRlclRpbWUgPSBBcnJheS5mcm9tKHRoaXMubWV0cmljcy52YWx1ZXMoKSkucmVkdWNlKFxuICAgICAgKHN1bSwgbWV0cmljLCBfLCBhcnIpID0+IHN1bSArIG1ldHJpYy5hdmVyYWdlUmVuZGVyVGltZSAvIGFyci5sZW5ndGgsXG4gICAgICAwXG4gICAgKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzRW5hYmxlZDogdHJ1ZSxcbiAgICAgIG1ldHJpY3M6IG5ldyBNYXAodGhpcy5tZXRyaWNzKSxcbiAgICAgIGFsZXJ0czogWy4uLnRoaXMuYWxlcnRzXSxcbiAgICAgIGdsb2JhbFN0YXRzOiB7XG4gICAgICAgIHRvdGFsQ29tcG9uZW50czogdGhpcy5tZXRyaWNzLnNpemUsXG4gICAgICAgIHRvdGFsUmVuZGVycyxcbiAgICAgICAgYXZlcmFnZVJlbmRlclRpbWUsXG4gICAgICAgIGFjdGl2ZUFsZXJ0czogdGhpcy5hbGVydHMuZmlsdGVyKGFsZXJ0ID0+ICFhbGVydC5yZXNvbHZlZCkubGVuZ3RoLFxuICAgICAgfSxcbiAgICB9XG4gIH1cblxuICB1cGRhdGVNZXRyaWNzKGNvbXBvbmVudE5hbWU6IHN0cmluZywgbWV0cmljczogUGFydGlhbDxSZW5kZXJNZXRyaWNzPik6IHZvaWQge1xuICAgIGNvbnN0IGV4aXN0aW5nID0gdGhpcy5tZXRyaWNzLmdldChjb21wb25lbnROYW1lKVxuICAgIGNvbnN0IHVwZGF0ZWQ6IFJlbmRlck1ldHJpY3MgPSB7XG4gICAgICBjb21wb25lbnROYW1lLFxuICAgICAgcmVuZGVyQ291bnQ6IDAsXG4gICAgICBhdmVyYWdlUmVuZGVyVGltZTogMCxcbiAgICAgIGxhc3RSZW5kZXJUaW1lOiAwLFxuICAgICAgc2xvd1JlbmRlcnM6IDAsXG4gICAgICBlcnJvckNvdW50OiAwLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgLi4uZXhpc3RpbmcsXG4gICAgICAuLi5tZXRyaWNzLFxuICAgIH1cblxuICAgIHRoaXMubWV0cmljcy5zZXQoY29tcG9uZW50TmFtZSwgdXBkYXRlZClcbiAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygpXG4gIH1cblxuICBhZGRBbGVydChhbGVydDogT21pdDxNb25pdG9yaW5nQWxlcnQsICdpZCcgfCAndGltZXN0YW1wJyB8ICdyZXNvbHZlZCc+KTogdm9pZCB7XG4gICAgY29uc3QgbmV3QWxlcnQ6IE1vbml0b3JpbmdBbGVydCA9IHtcbiAgICAgIC4uLmFsZXJ0LFxuICAgICAgaWQ6IGBhbGVydC0ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICByZXNvbHZlZDogZmFsc2UsXG4gICAgfVxuXG4gICAgdGhpcy5hbGVydHMudW5zaGlmdChuZXdBbGVydClcblxuICAgIC8vIE1hbnRlbmVyIHNvbG8gbGFzIMO6bHRpbWFzIDEwMCBhbGVydGFzXG4gICAgaWYgKHRoaXMuYWxlcnRzLmxlbmd0aCA+IDEwMCkge1xuICAgICAgdGhpcy5hbGVydHMgPSB0aGlzLmFsZXJ0cy5zbGljZSgwLCAxMDApXG4gICAgfVxuXG4gICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoKVxuICB9XG5cbiAgcmVzb2x2ZUFsZXJ0KGFsZXJ0SWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGFsZXJ0ID0gdGhpcy5hbGVydHMuZmluZChhID0+IGEuaWQgPT09IGFsZXJ0SWQpXG4gICAgaWYgKGFsZXJ0KSB7XG4gICAgICA7KGFsZXJ0IGFzIGFueSkucmVzb2x2ZWQgPSB0cnVlXG4gICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycygpXG4gICAgfVxuICB9XG5cbiAgY2xlYXJBbGVydHMoKTogdm9pZCB7XG4gICAgdGhpcy5hbGVydHMgPSBbXVxuICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKClcbiAgfVxuXG4gIGV4cG9ydERhdGEoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoXG4gICAgICB7XG4gICAgICAgIG1ldHJpY3M6IEFycmF5LmZyb20odGhpcy5tZXRyaWNzLmVudHJpZXMoKSksXG4gICAgICAgIGFsZXJ0czogdGhpcy5hbGVydHMsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIH0sXG4gICAgICBudWxsLFxuICAgICAgMlxuICAgIClcbiAgfVxufVxuXG5jb25zdCBtb25pdG9yaW5nU3RvcmUgPSBNb25pdG9yaW5nU3RvcmUuZ2V0SW5zdGFuY2UoKVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVVRJTElEQURFUyBERSBQRVJGT1JNQU5DRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZnVuY3Rpb24gbWVhc3VyZVJlbmRlclRpbWU8VD4oZm46ICgpID0+IFQpOiB7IHJlc3VsdDogVDsgZHVyYXRpb246IG51bWJlciB9IHtcbiAgY29uc3Qgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKVxuICBjb25zdCByZXN1bHQgPSBmbigpXG4gIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFxuICByZXR1cm4geyByZXN1bHQsIGR1cmF0aW9uIH1cbn1cblxuZnVuY3Rpb24gZ2V0TWVtb3J5VXNhZ2UoKTogbnVtYmVyIHtcbiAgaWYgKCdtZW1vcnknIGluIHBlcmZvcm1hbmNlKSB7XG4gICAgcmV0dXJuIChwZXJmb3JtYW5jZSBhcyBhbnkpLm1lbW9yeS51c2VkSlNIZWFwU2l6ZSAvIDEwMjQgLyAxMDI0IC8vIE1CXG4gIH1cbiAgcmV0dXJuIDBcbn1cblxuZnVuY3Rpb24gc2hvdWxkU2FtcGxlKHNhbXBsZVJhdGU6IG51bWJlcik6IGJvb2xlYW4ge1xuICByZXR1cm4gTWF0aC5yYW5kb20oKSA8IHNhbXBsZVJhdGVcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEhPT0sgUFJJTkNJUEFMIERFIE1PTklUT1JFT1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIHVzZVJlbmRlck1vbml0b3Jpbmcob3B0aW9uczogTW9uaXRvcmluZ09wdGlvbnMpIHtcbiAgY29uc3Qgb3B0cyA9IHsgLi4uREVGQVVMVF9PUFRJT05TLCAuLi5vcHRpb25zIH1cbiAgY29uc3QgeyB0b2FzdCB9ID0gdXNlVG9hc3QoKVxuXG4gIC8vIFJlZmVyZW5jaWFzIHBhcmEgdHJhY2tpbmdcbiAgY29uc3QgcmVuZGVyQ291bnRSZWYgPSB1c2VSZWYoMClcbiAgY29uc3QgcmVuZGVyVGltZXNSZWYgPSB1c2VSZWY8bnVtYmVyW10+KFtdKVxuICBjb25zdCBsYXN0UmVuZGVyVGltZVJlZiA9IHVzZVJlZigwKVxuICBjb25zdCBzbG93UmVuZGVyc1JlZiA9IHVzZVJlZigwKVxuICBjb25zdCBlcnJvckNvdW50UmVmID0gdXNlUmVmKDApXG4gIGNvbnN0IG1vdW50VGltZVJlZiA9IHVzZVJlZihEYXRlLm5vdygpKVxuXG4gIC8vIEVzdGFkbyBsb2NhbFxuICBjb25zdCBbbW9uaXRvcmluZ1N0YXRlLCBzZXRNb25pdG9yaW5nU3RhdGVdID0gdXNlU3RhdGU8TW9uaXRvcmluZ1N0YXRlPihcbiAgICBtb25pdG9yaW5nU3RvcmUuZ2V0U3RhdGUoKVxuICApXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gRlVOQ0lPTkVTIERFIEFOw4FMSVNJU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGNvbnN0IGFuYWx5emVQZXJmb3JtYW5jZSA9IHVzZUNhbGxiYWNrKFxuICAgIChyZW5kZXJUaW1lOiBudW1iZXIpID0+IHtcbiAgICAgIGNvbnN0IHsgY29tcG9uZW50TmFtZSwgdGhyZXNob2xkcyB9ID0gb3B0c1xuXG4gICAgICAvLyBEZXRlY3RhciByZW5kZXIgbGVudG9cbiAgICAgIGlmIChyZW5kZXJUaW1lID4gdGhyZXNob2xkcy5zbG93UmVuZGVyVGhyZXNob2xkKSB7XG4gICAgICAgIHNsb3dSZW5kZXJzUmVmLmN1cnJlbnQrK1xuXG4gICAgICAgIG1vbml0b3JpbmdTdG9yZS5hZGRBbGVydCh7XG4gICAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyxcbiAgICAgICAgICBzZXZlcml0eTogcmVuZGVyVGltZSA+IHRocmVzaG9sZHMuc2xvd1JlbmRlclRocmVzaG9sZCAqIDIgPyAnaGlnaCcgOiAnbWVkaXVtJyxcbiAgICAgICAgICBtZXNzYWdlOiBgUmVuZGVyIGxlbnRvIGRldGVjdGFkbzogJHtyZW5kZXJUaW1lLnRvRml4ZWQoMil9bXMgKHVtYnJhbDogJHt0aHJlc2hvbGRzLnNsb3dSZW5kZXJUaHJlc2hvbGR9bXMpYCxcbiAgICAgICAgICBjb21wb25lbnROYW1lLFxuICAgICAgICAgIG1ldHJpY3M6IHsgbGFzdFJlbmRlclRpbWU6IHJlbmRlclRpbWUgfSxcbiAgICAgICAgfSlcblxuICAgICAgICBpZiAob3B0cy5lbmFibGVDb25zb2xlTG9nZ2luZykge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgIGBbUmVuZGVyTW9uaXRvcmluZ10gU2xvdyByZW5kZXIgaW4gJHtjb21wb25lbnROYW1lfTogJHtyZW5kZXJUaW1lLnRvRml4ZWQoMil9bXNgXG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIERldGVjdGFyIHBvc2libGUgcmVuZGVyIGxvb3BcbiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcbiAgICAgIGNvbnN0IG9uZU1pbnV0ZUFnbyA9IG5vdyAtIDYwMDAwXG4gICAgICBjb25zdCByZWNlbnRSZW5kZXJzID0gcmVuZGVyVGltZXNSZWYuY3VycmVudC5maWx0ZXIodGltZSA9PiB0aW1lID4gb25lTWludXRlQWdvKS5sZW5ndGhcblxuICAgICAgaWYgKHJlY2VudFJlbmRlcnMgPiB0aHJlc2hvbGRzLm1heFJlbmRlckNvdW50KSB7XG4gICAgICAgIG1vbml0b3JpbmdTdG9yZS5hZGRBbGVydCh7XG4gICAgICAgICAgdHlwZTogJ3JlbmRlci1sb29wJyxcbiAgICAgICAgICBzZXZlcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgICBtZXNzYWdlOiBgUG9zaWJsZSByZW5kZXIgbG9vcDogJHtyZWNlbnRSZW5kZXJzfSByZW5kZXJzIGVuIGVsIMO6bHRpbW8gbWludXRvIChtw6F4aW1vOiAke3RocmVzaG9sZHMubWF4UmVuZGVyQ291bnR9KWAsXG4gICAgICAgICAgY29tcG9uZW50TmFtZSxcbiAgICAgICAgICBtZXRyaWNzOiB7IHJlbmRlckNvdW50OiByZWNlbnRSZW5kZXJzIH0sXG4gICAgICAgIH0pXG5cbiAgICAgICAgaWYgKG9wdHMuZW5hYmxlVG9hc3RzKSB7XG4gICAgICAgICAgdG9hc3Qoe1xuICAgICAgICAgICAgdGl0bGU6ICdSZW5kZXIgTG9vcCBEZXRlY3RhZG8nLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGAke2NvbXBvbmVudE5hbWV9OiAke3JlY2VudFJlbmRlcnN9IHJlbmRlcnMvbWluYCxcbiAgICAgICAgICAgIHZhcmlhbnQ6ICdkZXN0cnVjdGl2ZScsXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBEZXRlY3RhciB1c28gZXhjZXNpdm8gZGUgbWVtb3JpYVxuICAgICAgY29uc3QgbWVtb3J5VXNhZ2UgPSBnZXRNZW1vcnlVc2FnZSgpXG4gICAgICBpZiAobWVtb3J5VXNhZ2UgPiB0aHJlc2hvbGRzLm1lbW9yeVRocmVzaG9sZCkge1xuICAgICAgICBtb25pdG9yaW5nU3RvcmUuYWRkQWxlcnQoe1xuICAgICAgICAgIHR5cGU6ICdtZW1vcnknLFxuICAgICAgICAgIHNldmVyaXR5OiAnaGlnaCcsXG4gICAgICAgICAgbWVzc2FnZTogYFVzbyBkZSBtZW1vcmlhIGVsZXZhZG86ICR7bWVtb3J5VXNhZ2UudG9GaXhlZCgyKX1NQiAodW1icmFsOiAke3RocmVzaG9sZHMubWVtb3J5VGhyZXNob2xkfU1CKWAsXG4gICAgICAgICAgY29tcG9uZW50TmFtZSxcbiAgICAgICAgICBtZXRyaWNzOiB7IG1lbW9yeVVzYWdlIH0sXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSxcbiAgICBbb3B0cywgdG9hc3RdXG4gIClcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBGVU5DScOTTiBERSBUUkFDS0lORyBERSBSRU5ERVJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBjb25zdCB0cmFja1JlbmRlciA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoIW9wdHMuZW5hYmxlZCB8fCAhc2hvdWxkU2FtcGxlKG9wdHMuc2FtcGxlUmF0ZSkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IHJlbmRlclRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIGxhc3RSZW5kZXJUaW1lUmVmLmN1cnJlbnRcbiAgICByZW5kZXJDb3VudFJlZi5jdXJyZW50KytcbiAgICByZW5kZXJUaW1lc1JlZi5jdXJyZW50LnB1c2goRGF0ZS5ub3coKSlcblxuICAgIC8vIE1hbnRlbmVyIHNvbG8gbG9zIMO6bHRpbW9zIDEwMCByZW5kZXJzXG4gICAgaWYgKHJlbmRlclRpbWVzUmVmLmN1cnJlbnQubGVuZ3RoID4gMTAwKSB7XG4gICAgICByZW5kZXJUaW1lc1JlZi5jdXJyZW50ID0gcmVuZGVyVGltZXNSZWYuY3VycmVudC5zbGljZSgtMTAwKVxuICAgIH1cblxuICAgIC8vIENhbGN1bGFyIHByb21lZGlvIGRlIHRpZW1wbyBkZSByZW5kZXJcbiAgICBjb25zdCByZWNlbnRUaW1lcyA9IHJlbmRlclRpbWVzUmVmLmN1cnJlbnQuc2xpY2UoLTEwKSAvLyDDmmx0aW1vcyAxMCByZW5kZXJzXG4gICAgY29uc3QgYXZlcmFnZVJlbmRlclRpbWUgPSByZWNlbnRUaW1lcy5yZWR1Y2UoKHN1bSwgdGltZSwgaSwgYXJyKSA9PiB7XG4gICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICByZXR1cm4gMFxuICAgICAgfVxuICAgICAgcmV0dXJuIHN1bSArICh0aW1lIC0gYXJyW2kgLSAxXSkgLyAoYXJyLmxlbmd0aCAtIDEpXG4gICAgfSwgMClcblxuICAgIC8vIEFjdHVhbGl6YXIgbcOpdHJpY2FzXG4gICAgY29uc3QgbWV0cmljczogUGFydGlhbDxSZW5kZXJNZXRyaWNzPiA9IHtcbiAgICAgIHJlbmRlckNvdW50OiByZW5kZXJDb3VudFJlZi5jdXJyZW50LFxuICAgICAgYXZlcmFnZVJlbmRlclRpbWUsXG4gICAgICBsYXN0UmVuZGVyVGltZTogcmVuZGVyVGltZSxcbiAgICAgIHNsb3dSZW5kZXJzOiBzbG93UmVuZGVyc1JlZi5jdXJyZW50LFxuICAgICAgZXJyb3JDb3VudDogZXJyb3JDb3VudFJlZi5jdXJyZW50LFxuICAgICAgbWVtb3J5VXNhZ2U6IGdldE1lbW9yeVVzYWdlKCksXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgfVxuXG4gICAgbW9uaXRvcmluZ1N0b3JlLnVwZGF0ZU1ldHJpY3Mob3B0cy5jb21wb25lbnROYW1lLCBtZXRyaWNzKVxuXG4gICAgLy8gQW5hbGl6YXIgcGVyZm9ybWFuY2VcbiAgICBhbmFseXplUGVyZm9ybWFuY2UocmVuZGVyVGltZSlcblxuICAgIC8vIEd1YXJkYXIgZW4gbG9jYWxTdG9yYWdlIHNpIGVzdMOhIGhhYmlsaXRhZG9cbiAgICBpZiAob3B0cy5lbmFibGVMb2NhbFN0b3JhZ2UpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGByZW5kZXItbW9uaXRvcmluZy0ke29wdHMuY29tcG9uZW50TmFtZX1gLCBKU09OLnN0cmluZ2lmeShtZXRyaWNzKSlcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIElnbm9yYXIgZXJyb3JlcyBkZSBsb2NhbFN0b3JhZ2VcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsYXN0UmVuZGVyVGltZVJlZi5jdXJyZW50ID0gcGVyZm9ybWFuY2Uubm93KClcbiAgfSwgW29wdHMsIGFuYWx5emVQZXJmb3JtYW5jZV0pXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gRlVOQ0nDk04gREUgVFJBQ0tJTkcgREUgRVJST1JFU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGNvbnN0IHRyYWNrRXJyb3IgPSB1c2VDYWxsYmFjayhcbiAgICAoZXJyb3I6IEVycm9yLCBlcnJvckluZm8/OiBhbnkpID0+IHtcbiAgICAgIGlmICghb3B0cy5lbmFibGVkKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBlcnJvckNvdW50UmVmLmN1cnJlbnQrK1xuXG4gICAgICBtb25pdG9yaW5nU3RvcmUuYWRkQWxlcnQoe1xuICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICBzZXZlcml0eTogJ2hpZ2gnLFxuICAgICAgICBtZXNzYWdlOiBgRXJyb3IgZW4gY29tcG9uZW50ZTogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgIGNvbXBvbmVudE5hbWU6IG9wdHMuY29tcG9uZW50TmFtZSxcbiAgICAgICAgbWV0cmljczogeyBlcnJvckNvdW50OiBlcnJvckNvdW50UmVmLmN1cnJlbnQgfSxcbiAgICAgIH0pXG5cbiAgICAgIGlmIChvcHRzLmVuYWJsZUNvbnNvbGVMb2dnaW5nKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFtSZW5kZXJNb25pdG9yaW5nXSBFcnJvciBpbiAke29wdHMuY29tcG9uZW50TmFtZX06YCwgZXJyb3IsIGVycm9ySW5mbylcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdHMuZW5hYmxlVG9hc3RzKSB7XG4gICAgICAgIHRvYXN0KHtcbiAgICAgICAgICB0aXRsZTogJ0Vycm9yIGRlIENvbXBvbmVudGUnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBgJHtvcHRzLmNvbXBvbmVudE5hbWV9OiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICB2YXJpYW50OiAnZGVzdHJ1Y3RpdmUnLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0sXG4gICAgW29wdHMsIHRvYXN0XVxuICApXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gRUZFQ1RPU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIC8vIFN1c2NyaWJpcnNlIGEgY2FtYmlvcyBkZWwgc3RvcmVcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCB1bnN1YnNjcmliZSA9IG1vbml0b3JpbmdTdG9yZS5hZGRMaXN0ZW5lcihzZXRNb25pdG9yaW5nU3RhdGUpXG4gICAgcmV0dXJuIHVuc3Vic2NyaWJlXG4gIH0sIFtdKVxuXG4gIC8vIFRyYWNrIHJlbmRlciBlbiBjYWRhIHJlbmRlciBkZWwgY29tcG9uZW50ZVxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHRyYWNrUmVuZGVyKClcbiAgfSlcblxuICAvLyBDbGVhbnVwIGFsIGRlc21vbnRhclxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpZiAob3B0cy5lbmFibGVDb25zb2xlTG9nZ2luZykge1xuICAgICAgICBjb25zdCB0b3RhbFRpbWUgPSBEYXRlLm5vdygpIC0gbW91bnRUaW1lUmVmLmN1cnJlbnRcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYFtSZW5kZXJNb25pdG9yaW5nXSAke29wdHMuY29tcG9uZW50TmFtZX0gdW5tb3VudGVkIGFmdGVyICR7dG90YWxUaW1lfW1zLCBgICtcbiAgICAgICAgICAgIGAke3JlbmRlckNvdW50UmVmLmN1cnJlbnR9IHJlbmRlcnMsIGAgK1xuICAgICAgICAgICAgYCR7c2xvd1JlbmRlcnNSZWYuY3VycmVudH0gc2xvdyByZW5kZXJzLCBgICtcbiAgICAgICAgICAgIGAke2Vycm9yQ291bnRSZWYuY3VycmVudH0gZXJyb3JzYFxuICAgICAgICApXG4gICAgICB9XG4gICAgfVxuICB9LCBbb3B0c10pXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQVBJIFDDmkJMSUNBXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgcmV0dXJuIHtcbiAgICAvLyBFc3RhZG9cbiAgICBpc0VuYWJsZWQ6IG9wdHMuZW5hYmxlZCxcbiAgICBtZXRyaWNzOiBtb25pdG9yaW5nU3RhdGUubWV0cmljcy5nZXQob3B0cy5jb21wb25lbnROYW1lKSxcbiAgICBnbG9iYWxTdGF0czogbW9uaXRvcmluZ1N0YXRlLmdsb2JhbFN0YXRzLFxuICAgIGFsZXJ0czogbW9uaXRvcmluZ1N0YXRlLmFsZXJ0cy5maWx0ZXIoYWxlcnQgPT4gYWxlcnQuY29tcG9uZW50TmFtZSA9PT0gb3B0cy5jb21wb25lbnROYW1lKSxcblxuICAgIC8vIEZ1bmNpb25lc1xuICAgIHRyYWNrRXJyb3IsXG4gICAgdHJhY2tSZW5kZXIsXG5cbiAgICAvLyBVdGlsaWRhZGVzXG4gICAgZXhwb3J0RGF0YTogKCkgPT4gbW9uaXRvcmluZ1N0b3JlLmV4cG9ydERhdGEoKSxcbiAgICBjbGVhckFsZXJ0czogKCkgPT4gbW9uaXRvcmluZ1N0b3JlLmNsZWFyQWxlcnRzKCksXG4gICAgcmVzb2x2ZUFsZXJ0OiAoYWxlcnRJZDogc3RyaW5nKSA9PiBtb25pdG9yaW5nU3RvcmUucmVzb2x2ZUFsZXJ0KGFsZXJ0SWQpLFxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIT09LIFBBUkEgTU9OSVRPUkVPIEdMT0JBTFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIHVzZUdsb2JhbE1vbml0b3JpbmcoKSB7XG4gIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gdXNlU3RhdGU8TW9uaXRvcmluZ1N0YXRlPihtb25pdG9yaW5nU3RvcmUuZ2V0U3RhdGUoKSlcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gbW9uaXRvcmluZ1N0b3JlLmFkZExpc3RlbmVyKHNldFN0YXRlKVxuICAgIHJldHVybiB1bnN1YnNjcmliZVxuICB9LCBbXSlcblxuICByZXR1cm4ge1xuICAgIC4uLnN0YXRlLFxuICAgIGV4cG9ydERhdGE6ICgpID0+IG1vbml0b3JpbmdTdG9yZS5leHBvcnREYXRhKCksXG4gICAgY2xlYXJBbGVydHM6ICgpID0+IG1vbml0b3JpbmdTdG9yZS5jbGVhckFsZXJ0cygpLFxuICAgIHJlc29sdmVBbGVydDogKGFsZXJ0SWQ6IHN0cmluZykgPT4gbW9uaXRvcmluZ1N0b3JlLnJlc29sdmVBbGVydChhbGVydElkKSxcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSE9DIFBBUkEgTU9OSVRPUkVPIEFVVE9Nw4FUSUNPXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gd2l0aFJlbmRlck1vbml0b3Jpbmc8UCBleHRlbmRzIG9iamVjdD4oXG4gIENvbXBvbmVudDogUmVhY3QuQ29tcG9uZW50VHlwZTxQPixcbiAgb3B0aW9uczogT21pdDxNb25pdG9yaW5nT3B0aW9ucywgJ2NvbXBvbmVudE5hbWUnPlxuKTogUmVhY3QuQ29tcG9uZW50VHlwZTxQPiB7XG4gIGNvbnN0IGNvbXBvbmVudE5hbWUgPSBDb21wb25lbnQuZGlzcGxheU5hbWUgfHwgQ29tcG9uZW50Lm5hbWUgfHwgJ1Vua25vd25Db21wb25lbnQnXG5cbiAgY29uc3QgV3JhcHBlZENvbXBvbmVudDogUmVhY3QuRkM8UD4gPSBwcm9wcyA9PiB7XG4gICAgY29uc3QgeyB0cmFja0Vycm9yIH0gPSB1c2VSZW5kZXJNb25pdG9yaW5nKHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICBjb21wb25lbnROYW1lLFxuICAgIH0pXG5cbiAgICAvLyBFcnJvciBib3VuZGFyeSBzaW1wbGVcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgY29uc3QgaGFuZGxlRXJyb3IgPSAoZXZlbnQ6IEVycm9yRXZlbnQpID0+IHtcbiAgICAgICAgdHJhY2tFcnJvcihuZXcgRXJyb3IoZXZlbnQubWVzc2FnZSkpXG4gICAgICB9XG5cbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGhhbmRsZUVycm9yKVxuICAgICAgcmV0dXJuICgpID0+IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGhhbmRsZUVycm9yKVxuICAgIH0sIFt0cmFja0Vycm9yXSlcblxuICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KENvbXBvbmVudCwgcHJvcHMpXG4gIH1cblxuICBXcmFwcGVkQ29tcG9uZW50LmRpc3BsYXlOYW1lID0gYHdpdGhSZW5kZXJNb25pdG9yaW5nKCR7Y29tcG9uZW50TmFtZX0pYFxuICByZXR1cm4gV3JhcHBlZENvbXBvbmVudFxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVVRJTElEQURFUyBFWFBPUlRBREFTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIE9idGllbmUgbcOpdHJpY2FzIGRlIHVuIGNvbXBvbmVudGUgZXNwZWPDrWZpY29cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbXBvbmVudE1ldHJpY3MoY29tcG9uZW50TmFtZTogc3RyaW5nKTogUmVuZGVyTWV0cmljcyB8IHVuZGVmaW5lZCB7XG4gIHJldHVybiBtb25pdG9yaW5nU3RvcmUuZ2V0U3RhdGUoKS5tZXRyaWNzLmdldChjb21wb25lbnROYW1lKVxufVxuXG4vKipcbiAqIE9idGllbmUgdG9kYXMgbGFzIGFsZXJ0YXMgYWN0aXZhc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWN0aXZlQWxlcnRzKCk6IE1vbml0b3JpbmdBbGVydFtdIHtcbiAgcmV0dXJuIG1vbml0b3JpbmdTdG9yZS5nZXRTdGF0ZSgpLmFsZXJ0cy5maWx0ZXIoYWxlcnQgPT4gIWFsZXJ0LnJlc29sdmVkKVxufVxuXG4vKipcbiAqIEV4cG9ydGEgdG9kb3MgbG9zIGRhdG9zIGRlIG1vbml0b3Jlb1xuICovXG5leHBvcnQgZnVuY3Rpb24gZXhwb3J0TW9uaXRvcmluZ0RhdGEoKTogc3RyaW5nIHtcbiAgcmV0dXJuIG1vbml0b3JpbmdTdG9yZS5leHBvcnREYXRhKClcbn1cblxuLyoqXG4gKiBMaW1waWEgdG9kYXMgbGFzIGFsZXJ0YXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyQWxsQWxlcnRzKCk6IHZvaWQge1xuICBtb25pdG9yaW5nU3RvcmUuY2xlYXJBbGVydHMoKVxufVxuIl0sIm5hbWVzIjpbImNsZWFyQWxsQWxlcnRzIiwiZXhwb3J0TW9uaXRvcmluZ0RhdGEiLCJnZXRBY3RpdmVBbGVydHMiLCJnZXRDb21wb25lbnRNZXRyaWNzIiwidXNlR2xvYmFsTW9uaXRvcmluZyIsInVzZVJlbmRlck1vbml0b3JpbmciLCJ3aXRoUmVuZGVyTW9uaXRvcmluZyIsIkRFRkFVTFRfVEhSRVNIT0xEUyIsInNsb3dSZW5kZXJUaHJlc2hvbGQiLCJtYXhSZW5kZXJDb3VudCIsIm1lbW9yeVRocmVzaG9sZCIsImVycm9yVGhyZXNob2xkIiwiREVGQVVMVF9PUFRJT05TIiwiZW5hYmxlZCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsInRocmVzaG9sZHMiLCJlbmFibGVUb2FzdHMiLCJlbmFibGVDb25zb2xlTG9nZ2luZyIsImVuYWJsZUxvY2FsU3RvcmFnZSIsInNhbXBsZVJhdGUiLCJNb25pdG9yaW5nU3RvcmUiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiYWRkTGlzdGVuZXIiLCJsaXN0ZW5lciIsImxpc3RlbmVycyIsImFkZCIsImRlbGV0ZSIsIm5vdGlmeUxpc3RlbmVycyIsIm5vdGlmeVRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0Iiwic3RhdGUiLCJnZXRTdGF0ZSIsImZvckVhY2giLCJ0b3RhbFJlbmRlcnMiLCJBcnJheSIsImZyb20iLCJtZXRyaWNzIiwidmFsdWVzIiwicmVkdWNlIiwic3VtIiwibWV0cmljIiwicmVuZGVyQ291bnQiLCJhdmVyYWdlUmVuZGVyVGltZSIsIl8iLCJhcnIiLCJsZW5ndGgiLCJpc0VuYWJsZWQiLCJNYXAiLCJhbGVydHMiLCJnbG9iYWxTdGF0cyIsInRvdGFsQ29tcG9uZW50cyIsInNpemUiLCJhY3RpdmVBbGVydHMiLCJmaWx0ZXIiLCJhbGVydCIsInJlc29sdmVkIiwidXBkYXRlTWV0cmljcyIsImNvbXBvbmVudE5hbWUiLCJleGlzdGluZyIsImdldCIsInVwZGF0ZWQiLCJsYXN0UmVuZGVyVGltZSIsInNsb3dSZW5kZXJzIiwiZXJyb3JDb3VudCIsInRpbWVzdGFtcCIsIkRhdGUiLCJub3ciLCJzZXQiLCJhZGRBbGVydCIsIm5ld0FsZXJ0IiwiaWQiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJ1bnNoaWZ0Iiwic2xpY2UiLCJyZXNvbHZlQWxlcnQiLCJhbGVydElkIiwiZmluZCIsImEiLCJjbGVhckFsZXJ0cyIsImV4cG9ydERhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwiZW50cmllcyIsIlNldCIsIm1vbml0b3JpbmdTdG9yZSIsIm1lYXN1cmVSZW5kZXJUaW1lIiwiZm4iLCJzdGFydCIsInBlcmZvcm1hbmNlIiwicmVzdWx0IiwiZHVyYXRpb24iLCJnZXRNZW1vcnlVc2FnZSIsIm1lbW9yeSIsInVzZWRKU0hlYXBTaXplIiwic2hvdWxkU2FtcGxlIiwib3B0aW9ucyIsIm9wdHMiLCJ0b2FzdCIsInVzZVRvYXN0IiwicmVuZGVyQ291bnRSZWYiLCJ1c2VSZWYiLCJyZW5kZXJUaW1lc1JlZiIsImxhc3RSZW5kZXJUaW1lUmVmIiwic2xvd1JlbmRlcnNSZWYiLCJlcnJvckNvdW50UmVmIiwibW91bnRUaW1lUmVmIiwibW9uaXRvcmluZ1N0YXRlIiwic2V0TW9uaXRvcmluZ1N0YXRlIiwidXNlU3RhdGUiLCJhbmFseXplUGVyZm9ybWFuY2UiLCJ1c2VDYWxsYmFjayIsInJlbmRlclRpbWUiLCJjdXJyZW50IiwidHlwZSIsInNldmVyaXR5IiwibWVzc2FnZSIsInRvRml4ZWQiLCJjb25zb2xlIiwid2FybiIsIm9uZU1pbnV0ZUFnbyIsInJlY2VudFJlbmRlcnMiLCJ0aW1lIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInZhcmlhbnQiLCJtZW1vcnlVc2FnZSIsInRyYWNrUmVuZGVyIiwicHVzaCIsInJlY2VudFRpbWVzIiwiaSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJlcnJvciIsInRyYWNrRXJyb3IiLCJlcnJvckluZm8iLCJ1c2VFZmZlY3QiLCJ1bnN1YnNjcmliZSIsInRvdGFsVGltZSIsImxvZyIsInNldFN0YXRlIiwiQ29tcG9uZW50IiwiZGlzcGxheU5hbWUiLCJuYW1lIiwiV3JhcHBlZENvbXBvbmVudCIsInByb3BzIiwiaGFuZGxlRXJyb3IiLCJldmVudCIsIkVycm9yIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJSZWFjdCIsImNyZWF0ZUVsZW1lbnQiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0QyxnREFBZ0Q7QUFDaEQsNkVBQTZFO0FBQzdFLHNDQUFzQzs7Ozs7Ozs7Ozs7O1FBd2hCdEJBO2VBQUFBOztRQVBBQztlQUFBQTs7UUFQQUM7ZUFBQUE7O1FBUEFDO2VBQUFBOztRQXhEQUM7ZUFBQUE7O1FBcE9BQztlQUFBQTs7UUF3UEFDO2VBQUFBOzs7K0RBN2RnRDswQkFDdkM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlEekIsc0NBQXNDO0FBQ3RDLDRCQUE0QjtBQUM1QixzQ0FBc0M7QUFFdEMsTUFBTUMscUJBQTRDO0lBQ2hEQyxxQkFBcUI7SUFDckJDLGdCQUFnQjtJQUNoQkMsaUJBQWlCO0lBQ2pCQyxnQkFBZ0I7QUFDbEI7QUFFQSxNQUFNQyxrQkFBc0U7SUFDMUVDLFNBQVNDLFFBQVFDLEdBQUcsQ0FBQ0MsUUFBUSxLQUFLO0lBQ2xDQyxZQUFZVjtJQUNaVyxjQUFjO0lBQ2RDLHNCQUFzQjtJQUN0QkMsb0JBQW9CO0lBQ3BCQyxZQUFZO0FBQ2Q7QUFFQSxzQ0FBc0M7QUFDdEMsd0JBQXdCO0FBQ3hCLHNDQUFzQztBQUV0QyxNQUFNQztJQU1KLE9BQU9DLGNBQStCO1FBQ3BDLElBQUksQ0FBQ0QsZ0JBQWdCRSxRQUFRLEVBQUU7WUFDN0JGLGdCQUFnQkUsUUFBUSxHQUFHLElBQUlGO1FBQ2pDO1FBQ0EsT0FBT0EsZ0JBQWdCRSxRQUFRO0lBQ2pDO0lBRUFDLFlBQVlDLFFBQTBDLEVBQWM7UUFDbEUsSUFBSSxDQUFDQyxTQUFTLENBQUNDLEdBQUcsQ0FBQ0Y7UUFDbkIsT0FBTyxJQUFNLElBQUksQ0FBQ0MsU0FBUyxDQUFD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