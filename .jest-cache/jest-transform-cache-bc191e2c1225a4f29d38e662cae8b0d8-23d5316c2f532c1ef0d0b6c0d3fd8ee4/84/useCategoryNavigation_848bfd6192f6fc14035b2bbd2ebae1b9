530bc23e34afba1ed6f87b1afab8fdde
/**
 * useCategoryNavigation Hook
 * Manages URL navigation for category filters
 * Pinteya E-commerce - Enterprise-ready implementation
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get /**
 * Default export for convenience
 */ default () {
        return _default;
    },
    get extractCategoriesFromUrl () {
        return extractCategoriesFromUrl;
    },
    get hasCategories () {
        return hasCategories;
    },
    get useCategoryNavigation () {
        return useCategoryNavigation;
    }
});
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _navigation = require("next/navigation");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const useCategoryNavigation = (options = {})=>{
    const { paramName = 'categories', basePath = '/', debounceDelay = 300, preserveParams = true, onNavigationStart, onNavigationComplete, enableAnalytics = true } = options;
    const router = (0, _navigation.useRouter)();
    const searchParams = (0, _navigation.useSearchParams)();
    const pathname = (0, _navigation.usePathname)();
    const [isNavigating, setIsNavigating] = (0, _react.useState)(false);
    const [debounceTimer, setDebounceTimer] = (0, _react.useState)(null);
    /**
   * Track navigation analytics if enabled
   */ const trackNavigation = (0, _react.useCallback)((categories, action)=>{
        if (!enableAnalytics) {
            return;
        }
        // Track with analytics service
        if (typeof window !== 'undefined' && window.gtag) {
            window.gtag('event', 'category_navigation', {
                event_category: 'navigation',
                event_label: action,
                value: categories.length,
                custom_parameters: {
                    categories: categories.join(','),
                    path: pathname
                }
            });
        }
        // Console log for development
        if (process.env.NODE_ENV === 'development') {}
    }, [
        enableAnalytics,
        pathname
    ]);
    /**
   * Build URL with category parameters
   */ const buildUrl = (0, _react.useCallback)((categories)=>{
        const params = new URLSearchParams();
        // Preserve existing parameters if enabled
        if (preserveParams) {
            searchParams.forEach((value, key)=>{
                if (key !== paramName) {
                    params.set(key, value);
                }
            });
        }
        // Add categories parameter if there are categories
        if (categories.length > 0) {
            params.set(paramName, categories.join(','));
        }
        // Build final URL
        const queryString = params.toString();
        return queryString ? `${basePath}?${queryString}` : basePath;
    }, [
        basePath,
        paramName,
        preserveParams,
        searchParams
    ]);
    /**
   * Perform navigation with debouncing
   */ const performNavigation = (0, _react.useCallback)((url)=>{
        // Clear existing timer
        if (debounceTimer) {
            clearTimeout(debounceTimer);
        }
        // Set navigation state
        setIsNavigating(true);
        onNavigationStart?.();
        // Debounced navigation
        const timer = setTimeout(()=>{
            try {
                router.push(url);
                // Reset navigation state after a short delay
                setTimeout(()=>{
                    setIsNavigating(false);
                    onNavigationComplete?.();
                }, 100);
            } catch (error) {
                console.error('Navigation error:', error);
                setIsNavigating(false);
                onNavigationComplete?.();
            }
        }, debounceDelay);
        setDebounceTimer(timer);
    }, [
        debounceTimer,
        debounceDelay,
        router,
        onNavigationStart,
        onNavigationComplete
    ]);
    /**
   * Navigate to filtered view with selected categories
   */ const navigateToFiltered = (0, _react.useCallback)((categories)=>{
        // Validate categories
        const validCategories = categories.filter((cat)=>typeof cat === 'string' && cat.trim().length > 0);
        // Build URL and navigate
        const url = buildUrl(validCategories);
        performNavigation(url);
        // Track analytics
        trackNavigation(validCategories, 'filter');
    }, [
        buildUrl,
        performNavigation,
        trackNavigation
    ]);
    /**
   * Navigate to home (clear all filters)
   */ const navigateToHome = (0, _react.useCallback)(()=>{
        const url = buildUrl([]);
        performNavigation(url);
        // Track analytics
        trackNavigation([], 'clear');
    }, [
        buildUrl,
        performNavigation,
        trackNavigation
    ]);
    /**
   * Get current URL with categories
   */ const getCurrentUrl = (0, _react.useCallback)(()=>{
        const currentCategories = searchParams.get(paramName);
        const categories = currentCategories ? currentCategories.split(',') : [];
        return buildUrl(categories);
    }, [
        searchParams,
        paramName,
        buildUrl
    ]);
    /**
   * Get current categories from URL
   */ const getCurrentCategories = (0, _react.useCallback)(()=>{
        const categoriesParam = searchParams.get(paramName);
        return categoriesParam ? categoriesParam.split(',').filter(Boolean) : [];
    }, [
        searchParams,
        paramName
    ]);
    /**
   * Check if specific categories are currently active
   */ const areCategoriesToActive = (0, _react.useCallback)((categories)=>{
        const currentCategories = getCurrentCategories();
        return categories.every((cat)=>currentCategories.includes(cat)) && currentCategories.every((cat)=>categories.includes(cat));
    }, [
        getCurrentCategories
    ]);
    /**
   * Cleanup effect for debounce timer
   */ const cleanup = (0, _react.useCallback)(()=>{
        if (debounceTimer) {
            clearTimeout(debounceTimer);
            setDebounceTimer(null);
        }
    }, [
        debounceTimer
    ]);
    // Cleanup on unmount
    _react.default.useEffect(()=>{
        return cleanup;
    }, [
        cleanup
    ]);
    /**
   * Memoized return object for performance
   */ const returnValue = (0, _react.useMemo)(()=>({
            navigateToFiltered,
            navigateToHome,
            getCurrentUrl,
            isNavigating
        }), [
        navigateToFiltered,
        navigateToHome,
        getCurrentUrl,
        isNavigating
    ]);
    return returnValue;
};
const extractCategoriesFromUrl = (url, paramName = 'categories')=>{
    try {
        const urlObj = new URL(url, window.location.origin);
        const categoriesParam = urlObj.searchParams.get(paramName);
        return categoriesParam ? categoriesParam.split(',').filter(Boolean) : [];
    } catch  {
        return [];
    }
};
const hasCategories = (url, paramName = 'categories')=>{
    return extractCategoriesFromUrl(url, paramName).length > 0;
};
const _default = useCategoryNavigation;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZUNhdGVnb3J5TmF2aWdhdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIHVzZUNhdGVnb3J5TmF2aWdhdGlvbiBIb29rXG4gKiBNYW5hZ2VzIFVSTCBuYXZpZ2F0aW9uIGZvciBjYXRlZ29yeSBmaWx0ZXJzXG4gKiBQaW50ZXlhIEUtY29tbWVyY2UgLSBFbnRlcnByaXNlLXJlYWR5IGltcGxlbWVudGF0aW9uXG4gKi9cblxuaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VTdGF0ZSwgdXNlTWVtbyB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgdXNlUm91dGVyLCB1c2VTZWFyY2hQYXJhbXMsIHVzZVBhdGhuYW1lIH0gZnJvbSAnbmV4dC9uYXZpZ2F0aW9uJ1xuaW1wb3J0IHR5cGUgeyBDYXRlZ29yeUlkLCBVc2VDYXRlZ29yeU5hdmlnYXRpb25SZXR1cm4gfSBmcm9tICdAL3R5cGVzL2NhdGVnb3JpZXMnXG5cbi8qKlxuICogQ29uZmlndXJhdGlvbiBvcHRpb25zIGZvciB0aGUgY2F0ZWdvcnkgbmF2aWdhdGlvbiBob29rXG4gKi9cbmludGVyZmFjZSBVc2VDYXRlZ29yeU5hdmlnYXRpb25PcHRpb25zIHtcbiAgLyoqIFVSTCBwYXJhbWV0ZXIgbmFtZSBmb3IgY2F0ZWdvcmllcyAqL1xuICBwYXJhbU5hbWU/OiBzdHJpbmdcbiAgLyoqIEJhc2UgcGF0aCBmb3IgbmF2aWdhdGlvbiAqL1xuICBiYXNlUGF0aD86IHN0cmluZ1xuICAvKiogRGVib3VuY2UgZGVsYXkgZm9yIFVSTCB1cGRhdGVzIGluIG1pbGxpc2Vjb25kcyAqL1xuICBkZWJvdW5jZURlbGF5PzogbnVtYmVyXG4gIC8qKiBXaGV0aGVyIHRvIHByZXNlcnZlIG90aGVyIFVSTCBwYXJhbWV0ZXJzICovXG4gIHByZXNlcnZlUGFyYW1zPzogYm9vbGVhblxuICAvKiogQ2FsbGJhY2sgd2hlbiBuYXZpZ2F0aW9uIHN0YXJ0cyAqL1xuICBvbk5hdmlnYXRpb25TdGFydD86ICgpID0+IHZvaWRcbiAgLyoqIENhbGxiYWNrIHdoZW4gbmF2aWdhdGlvbiBjb21wbGV0ZXMgKi9cbiAgb25OYXZpZ2F0aW9uQ29tcGxldGU/OiAoKSA9PiB2b2lkXG4gIC8qKiBXaGV0aGVyIHRvIGVuYWJsZSBhbmFseXRpY3MgdHJhY2tpbmcgKi9cbiAgZW5hYmxlQW5hbHl0aWNzPzogYm9vbGVhblxufVxuXG4vKipcbiAqIEN1c3RvbSBob29rIGZvciBtYW5hZ2luZyBjYXRlZ29yeSBmaWx0ZXIgbmF2aWdhdGlvblxuICpcbiAqIEZlYXR1cmVzOlxuICogLSBVUkwgcGFyYW1ldGVyIG1hbmFnZW1lbnRcbiAqIC0gRGVib3VuY2VkIG5hdmlnYXRpb25cbiAqIC0gU3RhdGUgcHJlc2VydmF0aW9uXG4gKiAtIEFuYWx5dGljcyB0cmFja2luZ1xuICogLSBQZXJmb3JtYW5jZSBvcHRpbWl6YXRpb25cbiAqXG4gKiBAcGFyYW0gb3B0aW9ucyBDb25maWd1cmF0aW9uIG9wdGlvbnNcbiAqIEByZXR1cm5zIE5hdmlnYXRpb24gc3RhdGUgYW5kIGFjdGlvbnNcbiAqL1xuZXhwb3J0IGNvbnN0IHVzZUNhdGVnb3J5TmF2aWdhdGlvbiA9IChcbiAgb3B0aW9uczogVXNlQ2F0ZWdvcnlOYXZpZ2F0aW9uT3B0aW9ucyA9IHt9XG4pOiBVc2VDYXRlZ29yeU5hdmlnYXRpb25SZXR1cm4gPT4ge1xuICBjb25zdCB7XG4gICAgcGFyYW1OYW1lID0gJ2NhdGVnb3JpZXMnLFxuICAgIGJhc2VQYXRoID0gJy8nLFxuICAgIGRlYm91bmNlRGVsYXkgPSAzMDAsXG4gICAgcHJlc2VydmVQYXJhbXMgPSB0cnVlLFxuICAgIG9uTmF2aWdhdGlvblN0YXJ0LFxuICAgIG9uTmF2aWdhdGlvbkNvbXBsZXRlLFxuICAgIGVuYWJsZUFuYWx5dGljcyA9IHRydWUsXG4gIH0gPSBvcHRpb25zXG5cbiAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKClcbiAgY29uc3Qgc2VhcmNoUGFyYW1zID0gdXNlU2VhcmNoUGFyYW1zKClcbiAgY29uc3QgcGF0aG5hbWUgPSB1c2VQYXRobmFtZSgpXG5cbiAgY29uc3QgW2lzTmF2aWdhdGluZywgc2V0SXNOYXZpZ2F0aW5nXSA9IHVzZVN0YXRlKGZhbHNlKVxuICBjb25zdCBbZGVib3VuY2VUaW1lciwgc2V0RGVib3VuY2VUaW1lcl0gPSB1c2VTdGF0ZTxOb2RlSlMuVGltZW91dCB8IG51bGw+KG51bGwpXG5cbiAgLyoqXG4gICAqIFRyYWNrIG5hdmlnYXRpb24gYW5hbHl0aWNzIGlmIGVuYWJsZWRcbiAgICovXG4gIGNvbnN0IHRyYWNrTmF2aWdhdGlvbiA9IHVzZUNhbGxiYWNrKFxuICAgIChjYXRlZ29yaWVzOiBDYXRlZ29yeUlkW10sIGFjdGlvbjogJ2ZpbHRlcicgfCAnY2xlYXInKSA9PiB7XG4gICAgICBpZiAoIWVuYWJsZUFuYWx5dGljcykge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgLy8gVHJhY2sgd2l0aCBhbmFseXRpY3Mgc2VydmljZVxuICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5ndGFnKSB7XG4gICAgICAgIHdpbmRvdy5ndGFnKCdldmVudCcsICdjYXRlZ29yeV9uYXZpZ2F0aW9uJywge1xuICAgICAgICAgIGV2ZW50X2NhdGVnb3J5OiAnbmF2aWdhdGlvbicsXG4gICAgICAgICAgZXZlbnRfbGFiZWw6IGFjdGlvbixcbiAgICAgICAgICB2YWx1ZTogY2F0ZWdvcmllcy5sZW5ndGgsXG4gICAgICAgICAgY3VzdG9tX3BhcmFtZXRlcnM6IHtcbiAgICAgICAgICAgIGNhdGVnb3JpZXM6IGNhdGVnb3JpZXMuam9pbignLCcpLFxuICAgICAgICAgICAgcGF0aDogcGF0aG5hbWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgIH1cblxuICAgICAgLy8gQ29uc29sZSBsb2cgZm9yIGRldmVsb3BtZW50XG4gICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICAgIH1cbiAgICB9LFxuICAgIFtlbmFibGVBbmFseXRpY3MsIHBhdGhuYW1lXVxuICApXG5cbiAgLyoqXG4gICAqIEJ1aWxkIFVSTCB3aXRoIGNhdGVnb3J5IHBhcmFtZXRlcnNcbiAgICovXG4gIGNvbnN0IGJ1aWxkVXJsID0gdXNlQ2FsbGJhY2soXG4gICAgKGNhdGVnb3JpZXM6IENhdGVnb3J5SWRbXSk6IHN0cmluZyA9PiB7XG4gICAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKClcblxuICAgICAgLy8gUHJlc2VydmUgZXhpc3RpbmcgcGFyYW1ldGVycyBpZiBlbmFibGVkXG4gICAgICBpZiAocHJlc2VydmVQYXJhbXMpIHtcbiAgICAgICAgc2VhcmNoUGFyYW1zLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgICBpZiAoa2V5ICE9PSBwYXJhbU5hbWUpIHtcbiAgICAgICAgICAgIHBhcmFtcy5zZXQoa2V5LCB2YWx1ZSlcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBjYXRlZ29yaWVzIHBhcmFtZXRlciBpZiB0aGVyZSBhcmUgY2F0ZWdvcmllc1xuICAgICAgaWYgKGNhdGVnb3JpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBwYXJhbXMuc2V0KHBhcmFtTmFtZSwgY2F0ZWdvcmllcy5qb2luKCcsJykpXG4gICAgICB9XG5cbiAgICAgIC8vIEJ1aWxkIGZpbmFsIFVSTFxuICAgICAgY29uc3QgcXVlcnlTdHJpbmcgPSBwYXJhbXMudG9TdHJpbmcoKVxuICAgICAgcmV0dXJuIHF1ZXJ5U3RyaW5nID8gYCR7YmFzZVBhdGh9PyR7cXVlcnlTdHJpbmd9YCA6IGJhc2VQYXRoXG4gICAgfSxcbiAgICBbYmFzZVBhdGgsIHBhcmFtTmFtZSwgcHJlc2VydmVQYXJhbXMsIHNlYXJjaFBhcmFtc11cbiAgKVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIG5hdmlnYXRpb24gd2l0aCBkZWJvdW5jaW5nXG4gICAqL1xuICBjb25zdCBwZXJmb3JtTmF2aWdhdGlvbiA9IHVzZUNhbGxiYWNrKFxuICAgICh1cmw6IHN0cmluZykgPT4ge1xuICAgICAgLy8gQ2xlYXIgZXhpc3RpbmcgdGltZXJcbiAgICAgIGlmIChkZWJvdW5jZVRpbWVyKSB7XG4gICAgICAgIGNsZWFyVGltZW91dChkZWJvdW5jZVRpbWVyKVxuICAgICAgfVxuXG4gICAgICAvLyBTZXQgbmF2aWdhdGlvbiBzdGF0ZVxuICAgICAgc2V0SXNOYXZpZ2F0aW5nKHRydWUpXG4gICAgICBvbk5hdmlnYXRpb25TdGFydD8uKClcblxuICAgICAgLy8gRGVib3VuY2VkIG5hdmlnYXRpb25cbiAgICAgIGNvbnN0IHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcm91dGVyLnB1c2godXJsKVxuXG4gICAgICAgICAgLy8gUmVzZXQgbmF2aWdhdGlvbiBzdGF0ZSBhZnRlciBhIHNob3J0IGRlbGF5XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBzZXRJc05hdmlnYXRpbmcoZmFsc2UpXG4gICAgICAgICAgICBvbk5hdmlnYXRpb25Db21wbGV0ZT8uKClcbiAgICAgICAgICB9LCAxMDApXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignTmF2aWdhdGlvbiBlcnJvcjonLCBlcnJvcilcbiAgICAgICAgICBzZXRJc05hdmlnYXRpbmcoZmFsc2UpXG4gICAgICAgICAgb25OYXZpZ2F0aW9uQ29tcGxldGU/LigpXG4gICAgICAgIH1cbiAgICAgIH0sIGRlYm91bmNlRGVsYXkpXG5cbiAgICAgIHNldERlYm91bmNlVGltZXIodGltZXIpXG4gICAgfSxcbiAgICBbZGVib3VuY2VUaW1lciwgZGVib3VuY2VEZWxheSwgcm91dGVyLCBvbk5hdmlnYXRpb25TdGFydCwgb25OYXZpZ2F0aW9uQ29tcGxldGVdXG4gIClcblxuICAvKipcbiAgICogTmF2aWdhdGUgdG8gZmlsdGVyZWQgdmlldyB3aXRoIHNlbGVjdGVkIGNhdGVnb3JpZXNcbiAgICovXG4gIGNvbnN0IG5hdmlnYXRlVG9GaWx0ZXJlZCA9IHVzZUNhbGxiYWNrKFxuICAgIChjYXRlZ29yaWVzOiBDYXRlZ29yeUlkW10pID0+IHtcbiAgICAgIC8vIFZhbGlkYXRlIGNhdGVnb3JpZXNcbiAgICAgIGNvbnN0IHZhbGlkQ2F0ZWdvcmllcyA9IGNhdGVnb3JpZXMuZmlsdGVyKFxuICAgICAgICBjYXQgPT4gdHlwZW9mIGNhdCA9PT0gJ3N0cmluZycgJiYgY2F0LnRyaW0oKS5sZW5ndGggPiAwXG4gICAgICApXG5cbiAgICAgIC8vIEJ1aWxkIFVSTCBhbmQgbmF2aWdhdGVcbiAgICAgIGNvbnN0IHVybCA9IGJ1aWxkVXJsKHZhbGlkQ2F0ZWdvcmllcylcbiAgICAgIHBlcmZvcm1OYXZpZ2F0aW9uKHVybClcblxuICAgICAgLy8gVHJhY2sgYW5hbHl0aWNzXG4gICAgICB0cmFja05hdmlnYXRpb24odmFsaWRDYXRlZ29yaWVzLCAnZmlsdGVyJylcbiAgICB9LFxuICAgIFtidWlsZFVybCwgcGVyZm9ybU5hdmlnYXRpb24sIHRyYWNrTmF2aWdhdGlvbl1cbiAgKVxuXG4gIC8qKlxuICAgKiBOYXZpZ2F0ZSB0byBob21lIChjbGVhciBhbGwgZmlsdGVycylcbiAgICovXG4gIGNvbnN0IG5hdmlnYXRlVG9Ib21lID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGNvbnN0IHVybCA9IGJ1aWxkVXJsKFtdKVxuICAgIHBlcmZvcm1OYXZpZ2F0aW9uKHVybClcblxuICAgIC8vIFRyYWNrIGFuYWx5dGljc1xuICAgIHRyYWNrTmF2aWdhdGlvbihbXSwgJ2NsZWFyJylcbiAgfSwgW2J1aWxkVXJsLCBwZXJmb3JtTmF2aWdhdGlvbiwgdHJhY2tOYXZpZ2F0aW9uXSlcblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgVVJMIHdpdGggY2F0ZWdvcmllc1xuICAgKi9cbiAgY29uc3QgZ2V0Q3VycmVudFVybCA9IHVzZUNhbGxiYWNrKCgpOiBzdHJpbmcgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRDYXRlZ29yaWVzID0gc2VhcmNoUGFyYW1zLmdldChwYXJhbU5hbWUpXG4gICAgY29uc3QgY2F0ZWdvcmllcyA9IGN1cnJlbnRDYXRlZ29yaWVzID8gY3VycmVudENhdGVnb3JpZXMuc3BsaXQoJywnKSA6IFtdXG4gICAgcmV0dXJuIGJ1aWxkVXJsKGNhdGVnb3JpZXMpXG4gIH0sIFtzZWFyY2hQYXJhbXMsIHBhcmFtTmFtZSwgYnVpbGRVcmxdKVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBjYXRlZ29yaWVzIGZyb20gVVJMXG4gICAqL1xuICBjb25zdCBnZXRDdXJyZW50Q2F0ZWdvcmllcyA9IHVzZUNhbGxiYWNrKCgpOiBDYXRlZ29yeUlkW10gPT4ge1xuICAgIGNvbnN0IGNhdGVnb3JpZXNQYXJhbSA9IHNlYXJjaFBhcmFtcy5nZXQocGFyYW1OYW1lKVxuICAgIHJldHVybiBjYXRlZ29yaWVzUGFyYW0gPyBjYXRlZ29yaWVzUGFyYW0uc3BsaXQoJywnKS5maWx0ZXIoQm9vbGVhbikgOiBbXVxuICB9LCBbc2VhcmNoUGFyYW1zLCBwYXJhbU5hbWVdKVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBzcGVjaWZpYyBjYXRlZ29yaWVzIGFyZSBjdXJyZW50bHkgYWN0aXZlXG4gICAqL1xuICBjb25zdCBhcmVDYXRlZ29yaWVzVG9BY3RpdmUgPSB1c2VDYWxsYmFjayhcbiAgICAoY2F0ZWdvcmllczogQ2F0ZWdvcnlJZFtdKTogYm9vbGVhbiA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50Q2F0ZWdvcmllcyA9IGdldEN1cnJlbnRDYXRlZ29yaWVzKClcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGNhdGVnb3JpZXMuZXZlcnkoY2F0ID0+IGN1cnJlbnRDYXRlZ29yaWVzLmluY2x1ZGVzKGNhdCkpICYmXG4gICAgICAgIGN1cnJlbnRDYXRlZ29yaWVzLmV2ZXJ5KGNhdCA9PiBjYXRlZ29yaWVzLmluY2x1ZGVzKGNhdCkpXG4gICAgICApXG4gICAgfSxcbiAgICBbZ2V0Q3VycmVudENhdGVnb3JpZXNdXG4gIClcblxuICAvKipcbiAgICogQ2xlYW51cCBlZmZlY3QgZm9yIGRlYm91bmNlIHRpbWVyXG4gICAqL1xuICBjb25zdCBjbGVhbnVwID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGlmIChkZWJvdW5jZVRpbWVyKSB7XG4gICAgICBjbGVhclRpbWVvdXQoZGVib3VuY2VUaW1lcilcbiAgICAgIHNldERlYm91bmNlVGltZXIobnVsbClcbiAgICB9XG4gIH0sIFtkZWJvdW5jZVRpbWVyXSlcblxuICAvLyBDbGVhbnVwIG9uIHVubW91bnRcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICByZXR1cm4gY2xlYW51cFxuICB9LCBbY2xlYW51cF0pXG5cbiAgLyoqXG4gICAqIE1lbW9pemVkIHJldHVybiBvYmplY3QgZm9yIHBlcmZvcm1hbmNlXG4gICAqL1xuICBjb25zdCByZXR1cm5WYWx1ZSA9IHVzZU1lbW8oXG4gICAgKCk6IFVzZUNhdGVnb3J5TmF2aWdhdGlvblJldHVybiA9PiAoe1xuICAgICAgbmF2aWdhdGVUb0ZpbHRlcmVkLFxuICAgICAgbmF2aWdhdGVUb0hvbWUsXG4gICAgICBnZXRDdXJyZW50VXJsLFxuICAgICAgaXNOYXZpZ2F0aW5nLFxuICAgIH0pLFxuICAgIFtuYXZpZ2F0ZVRvRmlsdGVyZWQsIG5hdmlnYXRlVG9Ib21lLCBnZXRDdXJyZW50VXJsLCBpc05hdmlnYXRpbmddXG4gIClcblxuICByZXR1cm4gcmV0dXJuVmFsdWVcbn1cblxuLyoqXG4gKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGV4dHJhY3QgY2F0ZWdvcmllcyBmcm9tIFVSTFxuICovXG5leHBvcnQgY29uc3QgZXh0cmFjdENhdGVnb3JpZXNGcm9tVXJsID0gKHVybDogc3RyaW5nLCBwYXJhbU5hbWUgPSAnY2F0ZWdvcmllcycpOiBDYXRlZ29yeUlkW10gPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVybE9iaiA9IG5ldyBVUkwodXJsLCB3aW5kb3cubG9jYXRpb24ub3JpZ2luKVxuICAgIGNvbnN0IGNhdGVnb3JpZXNQYXJhbSA9IHVybE9iai5zZWFyY2hQYXJhbXMuZ2V0KHBhcmFtTmFtZSlcbiAgICByZXR1cm4gY2F0ZWdvcmllc1BhcmFtID8gY2F0ZWdvcmllc1BhcmFtLnNwbGl0KCcsJykuZmlsdGVyKEJvb2xlYW4pIDogW11cbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIFtdXG4gIH1cbn1cblxuLyoqXG4gKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGNoZWNrIGlmIFVSTCBoYXMgY2F0ZWdvcnkgZmlsdGVyc1xuICovXG5leHBvcnQgY29uc3QgaGFzQ2F0ZWdvcmllcyA9ICh1cmw6IHN0cmluZywgcGFyYW1OYW1lID0gJ2NhdGVnb3JpZXMnKTogYm9vbGVhbiA9PiB7XG4gIHJldHVybiBleHRyYWN0Q2F0ZWdvcmllc0Zyb21VcmwodXJsLCBwYXJhbU5hbWUpLmxlbmd0aCA+IDBcbn1cblxuLyoqXG4gKiBEZWZhdWx0IGV4cG9ydCBmb3IgY29udmVuaWVuY2VcbiAqL1xuZXhwb3J0IGRlZmF1bHQgdXNlQ2F0ZWdvcnlOYXZpZ2F0aW9uXG4iXSwibmFtZXMiOlsiZXh0cmFjdENhdGVnb3JpZXNGcm9tVXJsIiwiaGFzQ2F0ZWdvcmllcyIsInVzZUNhdGVnb3J5TmF2aWdhdGlvbiIsIm9wdGlvbnMiLCJwYXJhbU5hbWUiLCJiYXNlUGF0aCIsImRlYm91bmNlRGVsYXkiLCJwcmVzZXJ2ZVBhcmFtcyIsIm9uTmF2aWdhdGlvblN0YXJ0Iiwib25OYXZpZ2F0aW9uQ29tcGxldGUiLCJlbmFibGVBbmFseXRpY3MiLCJyb3V0ZXIiLCJ1c2VSb3V0ZXIiLCJzZWFyY2hQYXJhbXMiLCJ1c2VTZWFyY2hQYXJhbXMiLCJwYXRobmFtZSIsInVzZVBhdGhuYW1lIiwiaXNOYXZpZ2F0aW5nIiwic2V0SXNOYXZpZ2F0aW5nIiwidXNlU3RhdGUiLCJkZWJvdW5jZVRpbWVyIiwic2V0RGVib3VuY2VUaW1lciIsInRyYWNrTmF2aWdhdGlvbiIsInVzZUNhbGxiYWNrIiwiY2F0ZWdvcmllcyIsImFjdGlvbiIsIndpbmRvdyIsImd0YWciLCJldmVudF9jYXRlZ29yeSIsImV2ZW50X2xhYmVsIiwidmFsdWUiLCJsZW5ndGgiLCJjdXN0b21fcGFyYW1ldGVycyIsImpvaW4iLCJwYXRoIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiYnVpbGRVcmwiLCJwYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJmb3JFYWNoIiwia2V5Iiwic2V0IiwicXVlcnlTdHJpbmciLCJ0b1N0cmluZyIsInBlcmZvcm1OYXZpZ2F0aW9uIiwidXJsIiwiY2xlYXJUaW1lb3V0IiwidGltZXIiLCJzZXRUaW1lb3V0IiwicHVzaCIsImVycm9yIiwiY29uc29sZSIsIm5hdmlnYXRlVG9GaWx0ZXJlZCIsInZhbGlkQ2F0ZWdvcmllcyIsImZpbHRlciIsImNhdCIsInRyaW0iLCJuYXZpZ2F0ZVRvSG9tZSIsImdldEN1cnJlbnRVcmwiLCJjdXJyZW50Q2F0ZWdvcmllcyIsImdldCIsInNwbGl0IiwiZ2V0Q3VycmVudENhdGVnb3JpZXMiLCJjYXRlZ29yaWVzUGFyYW0iLCJCb29sZWFuIiwiYXJlQ2F0ZWdvcmllc1RvQWN0aXZlIiwiZXZlcnkiLCJpbmNsdWRlcyIsImNsZWFudXAiLCJSZWFjdCIsInVzZUVmZmVjdCIsInJldHVyblZhbHVlIiwidXNlTWVtbyIsInVybE9iaiIsIlVSTCIsImxvY2F0aW9uIiwib3JpZ2luIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztDQUlDOzs7Ozs7Ozs7OztRQXlRRDs7Q0FFQyxHQUNEO2VBQUE7O1FBcEJhQTtlQUFBQTs7UUFhQUM7ZUFBQUE7O1FBOU5BQztlQUFBQTs7OytEQXJDeUM7NEJBQ0U7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9DakQsTUFBTUEsd0JBQXdCLENBQ25DQyxVQUF3QyxDQUFDLENBQUM7SUFF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