53f1fa939e022dfcce6f30645fb9e400
// Configuración para Node.js Runtime
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get GET () {
        return GET;
    },
    get POST () {
        return POST;
    },
    get runtime () {
        return runtime;
    }
});
const _server = require("next/server");
const _config = require("../../../../lib/auth/config");
const _server1 = require("../../../../lib/integrations/supabase/server");
const runtime = 'nodejs';
async function POST(request) {
    try {
        // Verificar autenticación
        const session = await (0, _config.auth)();
        if (!session?.user?.email) {
            return _server.NextResponse.json({
                error: 'No autorizado'
            }, {
                status: 401
            });
        }
        const body = await request.json();
        const { location, speed, heading, accuracy } = body;
        // Validar datos de ubicación
        if (!location || typeof location.lat !== 'number' || typeof location.lng !== 'number') {
            return _server.NextResponse.json({
                error: 'Datos de ubicación inválidos'
            }, {
                status: 400
            });
        }
        const supabase = await (0, _server1.createClient)();
        // Obtener información del driver
        const { data: driver, error: driverError } = await supabase.from('drivers').select('id, status').eq('email', session.user.email).single();
        if (driverError || !driver) {
            return _server.NextResponse.json({
                error: 'Driver no encontrado'
            }, {
                status: 404
            });
        }
        // Preparar datos de ubicación
        const locationData = {
            lat: location.lat,
            lng: location.lng,
            timestamp: new Date().toISOString(),
            speed: speed || 0,
            heading: heading || 0,
            accuracy: accuracy || 0
        };
        // Actualizar ubicación del driver
        const { data: updatedDriver, error: updateError } = await supabase.from('drivers').update({
            current_location: locationData,
            updated_at: new Date().toISOString()
        }).eq('id', driver.id).select().single();
        if (updateError) {
            console.error('Error updating driver location:', updateError);
            return _server.NextResponse.json({
                error: 'Error actualizando ubicación'
            }, {
                status: 500
            });
        }
        // Opcional: Guardar historial de ubicaciones para tracking
        try {
            await supabase.from('driver_location_history').insert({
                driver_id: driver.id,
                location: locationData,
                created_at: new Date().toISOString()
            });
        } catch (historyError) {
            // No fallar si no se puede guardar el historial
            console.warn('Could not save location history:', historyError);
        }
        // Si el driver está en una ruta activa, verificar proximidad a destinos
        if (driver.status === 'busy') {
            await checkProximityToDestinations(driver.id, location);
        }
        return _server.NextResponse.json({
            success: true,
            location: locationData,
            driver: {
                id: updatedDriver.id,
                status: updatedDriver.status,
                current_location: updatedDriver.current_location
            }
        });
    } catch (error) {
        console.error('Error in driver location API:', error);
        return _server.NextResponse.json({
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}
async function GET(request) {
    try {
        // Verificar autenticación
        const session = await (0, _config.auth)();
        if (!session?.user?.email) {
            return _server.NextResponse.json({
                error: 'No autorizado'
            }, {
                status: 401
            });
        }
        const supabase = await (0, _server1.createClient)();
        // Obtener ubicación actual del driver
        const { data: driver, error: driverError } = await supabase.from('drivers').select('id, current_location, status, updated_at').eq('email', session.user.email).single();
        if (driverError || !driver) {
            return _server.NextResponse.json({
                error: 'Driver no encontrado'
            }, {
                status: 404
            });
        }
        return _server.NextResponse.json({
            location: driver.current_location,
            status: driver.status,
            last_updated: driver.updated_at
        });
    } catch (error) {
        console.error('Error getting driver location:', error);
        return _server.NextResponse.json({
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}
/**
 * Función helper para verificar proximidad a destinos de entrega
 */ async function checkProximityToDestinations(driverId, currentLocation) {
    try {
        const supabase = await (0, _server1.createClient)();
        // Obtener rutas activas del driver
        const { data: activeRoutes, error } = await supabase.from('optimized_routes').select('*').eq('driver_id', driverId).eq('status', 'active');
        if (error || !activeRoutes?.length) return;
        // Verificar proximidad a cada destino
        for (const route of activeRoutes){
            if (!route.shipments) continue;
            for(let i = 0; i < route.shipments.length; i++){
                const shipment = route.shipments[i];
                if (shipment.status === 'delivered') continue;
                const destination = shipment.destination?.coordinates;
                if (!destination) continue;
                const distance = calculateDistance(currentLocation, destination);
                // Si está a menos de 100 metros del destino
                if (distance < 100) {
                    // Opcional: Enviar notificación o actualizar estado
                    console.log(`Driver ${driverId} is near delivery destination: ${shipment.customer_name}`);
                // Aquí se podría implementar:
                // - Notificación push al cliente
                // - Actualización automática de estado
                // - Alerta al dashboard administrativo
                }
            }
        }
    } catch (error) {
        console.error('Error checking proximity:', error);
    }
}
/**
 * Calcular distancia entre dos puntos en metros
 */ function calculateDistance(point1, point2) {
    const R = 6371000 // Radio de la Tierra en metros
    ;
    const dLat = (point2.lat - point1.lat) * Math.PI / 180;
    const dLon = (point2.lng - point1.lng) * Math.PI / 180;
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(point1.lat * Math.PI / 180) * Math.cos(point2.lat * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXGRyaXZlclxcbG9jYXRpb25cXHJvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvbmZpZ3VyYWNpw7NuIHBhcmEgTm9kZS5qcyBSdW50aW1lXG5leHBvcnQgY29uc3QgcnVudGltZSA9ICdub2RlanMnXG5cbi8qKlxuICogQVBJIHBhcmEgYWN0dWFsaXphciBsYSB1YmljYWNpw7NuIGRlbCBkcml2ZXIgZW4gdGllbXBvIHJlYWxcbiAqIFBPU1QgL2FwaS9kcml2ZXIvbG9jYXRpb25cbiAqL1xuXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBhdXRoIH0gZnJvbSAnQC9saWIvYXV0aC9jb25maWcnXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAL2xpYi9pbnRlZ3JhdGlvbnMvc3VwYWJhc2Uvc2VydmVyJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIC8vIFZlcmlmaWNhciBhdXRlbnRpY2FjacOzblxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKClcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcj8uZW1haWwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTm8gYXV0b3JpemFkbycgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgIH1cblxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuICAgIGNvbnN0IHsgbG9jYXRpb24sIHNwZWVkLCBoZWFkaW5nLCBhY2N1cmFjeSB9ID0gYm9keVxuXG4gICAgLy8gVmFsaWRhciBkYXRvcyBkZSB1YmljYWNpw7NuXG4gICAgaWYgKCFsb2NhdGlvbiB8fCB0eXBlb2YgbG9jYXRpb24ubGF0ICE9PSAnbnVtYmVyJyB8fCB0eXBlb2YgbG9jYXRpb24ubG5nICE9PSAnbnVtYmVyJykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdEYXRvcyBkZSB1YmljYWNpw7NuIGludsOhbGlkb3MnIH0sIHsgc3RhdHVzOiA0MDAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpXG5cbiAgICAvLyBPYnRlbmVyIGluZm9ybWFjacOzbiBkZWwgZHJpdmVyXG4gICAgY29uc3QgeyBkYXRhOiBkcml2ZXIsIGVycm9yOiBkcml2ZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdkcml2ZXJzJylcbiAgICAgIC5zZWxlY3QoJ2lkLCBzdGF0dXMnKVxuICAgICAgLmVxKCdlbWFpbCcsIHNlc3Npb24udXNlci5lbWFpbClcbiAgICAgIC5zaW5nbGUoKVxuXG4gICAgaWYgKGRyaXZlckVycm9yIHx8ICFkcml2ZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnRHJpdmVyIG5vIGVuY29udHJhZG8nIH0sIHsgc3RhdHVzOiA0MDQgfSlcbiAgICB9XG5cbiAgICAvLyBQcmVwYXJhciBkYXRvcyBkZSB1YmljYWNpw7NuXG4gICAgY29uc3QgbG9jYXRpb25EYXRhID0ge1xuICAgICAgbGF0OiBsb2NhdGlvbi5sYXQsXG4gICAgICBsbmc6IGxvY2F0aW9uLmxuZyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgc3BlZWQ6IHNwZWVkIHx8IDAsXG4gICAgICBoZWFkaW5nOiBoZWFkaW5nIHx8IDAsXG4gICAgICBhY2N1cmFjeTogYWNjdXJhY3kgfHwgMCxcbiAgICB9XG5cbiAgICAvLyBBY3R1YWxpemFyIHViaWNhY2nDs24gZGVsIGRyaXZlclxuICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZERyaXZlciwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2RyaXZlcnMnKVxuICAgICAgLnVwZGF0ZSh7XG4gICAgICAgIGN1cnJlbnRfbG9jYXRpb246IGxvY2F0aW9uRGF0YSxcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgfSlcbiAgICAgIC5lcSgnaWQnLCBkcml2ZXIuaWQpXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5zaW5nbGUoKVxuXG4gICAgaWYgKHVwZGF0ZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBkcml2ZXIgbG9jYXRpb246JywgdXBkYXRlRXJyb3IpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0Vycm9yIGFjdHVhbGl6YW5kbyB1YmljYWNpw7NuJyB9LCB7IHN0YXR1czogNTAwIH0pXG4gICAgfVxuXG4gICAgLy8gT3BjaW9uYWw6IEd1YXJkYXIgaGlzdG9yaWFsIGRlIHViaWNhY2lvbmVzIHBhcmEgdHJhY2tpbmdcbiAgICB0cnkge1xuICAgICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnZHJpdmVyX2xvY2F0aW9uX2hpc3RvcnknKS5pbnNlcnQoe1xuICAgICAgICBkcml2ZXJfaWQ6IGRyaXZlci5pZCxcbiAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uRGF0YSxcbiAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgfSlcbiAgICB9IGNhdGNoIChoaXN0b3J5RXJyb3IpIHtcbiAgICAgIC8vIE5vIGZhbGxhciBzaSBubyBzZSBwdWVkZSBndWFyZGFyIGVsIGhpc3RvcmlhbFxuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3Qgc2F2ZSBsb2NhdGlvbiBoaXN0b3J5OicsIGhpc3RvcnlFcnJvcilcbiAgICB9XG5cbiAgICAvLyBTaSBlbCBkcml2ZXIgZXN0w6EgZW4gdW5hIHJ1dGEgYWN0aXZhLCB2ZXJpZmljYXIgcHJveGltaWRhZCBhIGRlc3Rpbm9zXG4gICAgaWYgKGRyaXZlci5zdGF0dXMgPT09ICdidXN5Jykge1xuICAgICAgYXdhaXQgY2hlY2tQcm94aW1pdHlUb0Rlc3RpbmF0aW9ucyhkcml2ZXIuaWQsIGxvY2F0aW9uKVxuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbG9jYXRpb246IGxvY2F0aW9uRGF0YSxcbiAgICAgIGRyaXZlcjoge1xuICAgICAgICBpZDogdXBkYXRlZERyaXZlci5pZCxcbiAgICAgICAgc3RhdHVzOiB1cGRhdGVkRHJpdmVyLnN0YXR1cyxcbiAgICAgICAgY3VycmVudF9sb2NhdGlvbjogdXBkYXRlZERyaXZlci5jdXJyZW50X2xvY2F0aW9uLFxuICAgICAgfSxcbiAgICB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGRyaXZlciBsb2NhdGlvbiBBUEk6JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicgfSwgeyBzdGF0dXM6IDUwMCB9KVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyBWZXJpZmljYXIgYXV0ZW50aWNhY2nDs25cbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aCgpXG5cbiAgICBpZiAoIXNlc3Npb24/LnVzZXI/LmVtYWlsKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ05vIGF1dG9yaXphZG8nIH0sIHsgc3RhdHVzOiA0MDEgfSlcbiAgICB9XG5cbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpXG5cbiAgICAvLyBPYnRlbmVyIHViaWNhY2nDs24gYWN0dWFsIGRlbCBkcml2ZXJcbiAgICBjb25zdCB7IGRhdGE6IGRyaXZlciwgZXJyb3I6IGRyaXZlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2RyaXZlcnMnKVxuICAgICAgLnNlbGVjdCgnaWQsIGN1cnJlbnRfbG9jYXRpb24sIHN0YXR1cywgdXBkYXRlZF9hdCcpXG4gICAgICAuZXEoJ2VtYWlsJywgc2Vzc2lvbi51c2VyLmVtYWlsKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAoZHJpdmVyRXJyb3IgfHwgIWRyaXZlcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdEcml2ZXIgbm8gZW5jb250cmFkbycgfSwgeyBzdGF0dXM6IDQwNCB9KVxuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBsb2NhdGlvbjogZHJpdmVyLmN1cnJlbnRfbG9jYXRpb24sXG4gICAgICBzdGF0dXM6IGRyaXZlci5zdGF0dXMsXG4gICAgICBsYXN0X3VwZGF0ZWQ6IGRyaXZlci51cGRhdGVkX2F0LFxuICAgIH0pXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBkcml2ZXIgbG9jYXRpb246JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicgfSwgeyBzdGF0dXM6IDUwMCB9KVxuICB9XG59XG5cbi8qKlxuICogRnVuY2nDs24gaGVscGVyIHBhcmEgdmVyaWZpY2FyIHByb3hpbWlkYWQgYSBkZXN0aW5vcyBkZSBlbnRyZWdhXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNoZWNrUHJveGltaXR5VG9EZXN0aW5hdGlvbnMoXG4gIGRyaXZlcklkOiBzdHJpbmcsXG4gIGN1cnJlbnRMb2NhdGlvbjogeyBsYXQ6IG51bWJlcjsgbG5nOiBudW1iZXIgfVxuKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKVxuXG4gICAgLy8gT2J0ZW5lciBydXRhcyBhY3RpdmFzIGRlbCBkcml2ZXJcbiAgICBjb25zdCB7IGRhdGE6IGFjdGl2ZVJvdXRlcywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnb3B0aW1pemVkX3JvdXRlcycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnZHJpdmVyX2lkJywgZHJpdmVySWQpXG4gICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKVxuXG4gICAgaWYgKGVycm9yIHx8ICFhY3RpdmVSb3V0ZXM/Lmxlbmd0aCkgcmV0dXJuXG5cbiAgICAvLyBWZXJpZmljYXIgcHJveGltaWRhZCBhIGNhZGEgZGVzdGlub1xuICAgIGZvciAoY29uc3Qgcm91dGUgb2YgYWN0aXZlUm91dGVzKSB7XG4gICAgICBpZiAoIXJvdXRlLnNoaXBtZW50cykgY29udGludWVcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3V0ZS5zaGlwbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc2hpcG1lbnQgPSByb3V0ZS5zaGlwbWVudHNbaV1cblxuICAgICAgICBpZiAoc2hpcG1lbnQuc3RhdHVzID09PSAnZGVsaXZlcmVkJykgY29udGludWVcblxuICAgICAgICBjb25zdCBkZXN0aW5hdGlvbiA9IHNoaXBtZW50LmRlc3RpbmF0aW9uPy5jb29yZGluYXRlc1xuICAgICAgICBpZiAoIWRlc3RpbmF0aW9uKSBjb250aW51ZVxuXG4gICAgICAgIGNvbnN0IGRpc3RhbmNlID0gY2FsY3VsYXRlRGlzdGFuY2UoY3VycmVudExvY2F0aW9uLCBkZXN0aW5hdGlvbilcblxuICAgICAgICAvLyBTaSBlc3TDoSBhIG1lbm9zIGRlIDEwMCBtZXRyb3MgZGVsIGRlc3Rpbm9cbiAgICAgICAgaWYgKGRpc3RhbmNlIDwgMTAwKSB7XG4gICAgICAgICAgLy8gT3BjaW9uYWw6IEVudmlhciBub3RpZmljYWNpw7NuIG8gYWN0dWFsaXphciBlc3RhZG9cbiAgICAgICAgICBjb25zb2xlLmxvZyhgRHJpdmVyICR7ZHJpdmVySWR9IGlzIG5lYXIgZGVsaXZlcnkgZGVzdGluYXRpb246ICR7c2hpcG1lbnQuY3VzdG9tZXJfbmFtZX1gKVxuXG4gICAgICAgICAgLy8gQXF1w60gc2UgcG9kcsOtYSBpbXBsZW1lbnRhcjpcbiAgICAgICAgICAvLyAtIE5vdGlmaWNhY2nDs24gcHVzaCBhbCBjbGllbnRlXG4gICAgICAgICAgLy8gLSBBY3R1YWxpemFjacOzbiBhdXRvbcOhdGljYSBkZSBlc3RhZG9cbiAgICAgICAgICAvLyAtIEFsZXJ0YSBhbCBkYXNoYm9hcmQgYWRtaW5pc3RyYXRpdm9cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyBwcm94aW1pdHk6JywgZXJyb3IpXG4gIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhciBkaXN0YW5jaWEgZW50cmUgZG9zIHB1bnRvcyBlbiBtZXRyb3NcbiAqL1xuZnVuY3Rpb24gY2FsY3VsYXRlRGlzdGFuY2UoXG4gIHBvaW50MTogeyBsYXQ6IG51bWJlcjsgbG5nOiBudW1iZXIgfSxcbiAgcG9pbnQyOiB7IGxhdDogbnVtYmVyOyBsbmc6IG51bWJlciB9XG4pOiBudW1iZXIge1xuICBjb25zdCBSID0gNjM3MTAwMCAvLyBSYWRpbyBkZSBsYSBUaWVycmEgZW4gbWV0cm9zXG4gIGNvbnN0IGRMYXQgPSAoKHBvaW50Mi5sYXQgLSBwb2ludDEubGF0KSAqIE1hdGguUEkpIC8gMTgwXG4gIGNvbnN0IGRMb24gPSAoKHBvaW50Mi5sbmcgLSBwb2ludDEubG5nKSAqIE1hdGguUEkpIC8gMTgwXG4gIGNvbnN0IGEgPVxuICAgIE1hdGguc2luKGRMYXQgLyAyKSAqIE1hdGguc2luKGRMYXQgLyAyKSArXG4gICAgTWF0aC5jb3MoKHBvaW50MS5sYXQgKiBNYXRoLlBJKSAvIDE4MCkgKlxuICAgICAgTWF0aC5jb3MoKHBvaW50Mi5sYXQgKiBNYXRoLlBJKSAvIDE4MCkgKlxuICAgICAgTWF0aC5zaW4oZExvbiAvIDIpICpcbiAgICAgIE1hdGguc2luKGRMb24gLyAyKVxuICBjb25zdCBjID0gMiAqIE1hdGguYXRhbjIoTWF0aC5zcXJ0KGEpLCBNYXRoLnNxcnQoMSAtIGEpKVxuICByZXR1cm4gUiAqIGNcbn1cbiJdLCJuYW1lcyI6WyJHRVQiLCJQT1NUIiwicnVudGltZSIsInJlcXVlc3QiLCJzZXNzaW9uIiwiYXV0aCIsInVzZXIiLCJlbWFpbCIsIk5leHRSZXNwb25zZSIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsImJvZHkiLCJsb2NhdGlvbiIsInNwZWVkIiwiaGVhZGluZyIsImFjY3VyYWN5IiwibGF0IiwibG5nIiwic3VwYWJhc2UiLCJjcmVhdGVDbGllbnQiLCJkYXRhIiwiZHJpdmVyIiwiZHJpdmVyRXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJsb2NhdGlvbkRhdGEiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJ1cGRhdGVkRHJpdmVyIiwidXBkYXRlRXJyb3IiLCJ1cGRhdGUiLCJjdXJyZW50X2xvY2F0aW9uIiwidXBkYXRlZF9hdCIsImlkIiwiY29uc29sZSIsImluc2VydCIsImRyaXZlcl9pZCIsImNyZWF0ZWRfYXQiLCJoaXN0b3J5RXJyb3IiLCJ3YXJuIiwiY2hlY2tQcm94aW1pdHlUb0Rlc3RpbmF0aW9ucyIsInN1Y2Nlc3MiLCJsYXN0X3VwZGF0ZWQiLCJkcml2ZXJJZCIsImN1cnJlbnRMb2NhdGlvbiIsImFjdGl2ZVJvdXRlcyIsImxlbmd0aCIsInJvdXRlIiwic2hpcG1lbnRzIiwiaSIsInNoaXBtZW50IiwiZGVzdGluYXRpb24iLCJjb29yZGluYXRlcyIsImRpc3RhbmNlIiwiY2FsY3VsYXRlRGlzdGFuY2UiLCJsb2ciLCJjdXN0b21lcl9uYW1lIiwicG9pbnQxIiwicG9pbnQyIiwiUiIsImRMYXQiLCJNYXRoIiwiUEkiLCJkTG9u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