{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\useGeolocation.ts"],"sourcesContent":["/**\r\n * Hook para geolocalizaci√≥n autom√°tica y detecci√≥n de zona de entrega\r\n * Detecta la ubicaci√≥n del usuario y determina la zona de entrega m√°s cercana\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\n\r\nexport interface DeliveryZone {\r\n  id: string;\r\n  name: string;\r\n  available: boolean;\r\n  coordinates?: {\r\n    lat: number;\r\n    lng: number;\r\n  };\r\n  radius?: number; // Radio en km\r\n}\r\n\r\nexport interface GeolocationState {\r\n  location: {\r\n    lat: number;\r\n    lng: number;\r\n  } | null;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  permissionStatus: 'granted' | 'denied' | 'prompt' | 'unknown';\r\n  detectedZone: DeliveryZone | null;\r\n}\r\n\r\n// Zonas de entrega con coordenadas aproximadas\r\nconst DELIVERY_ZONES: DeliveryZone[] = [\r\n  {\r\n    id: \"cordoba-capital\",\r\n    name: \"C√≥rdoba Capital\",\r\n    available: true,\r\n    coordinates: { lat: -31.4201, lng: -64.1888 },\r\n    radius: 15\r\n  },\r\n  {\r\n    id: \"cordoba-interior\",\r\n    name: \"Interior de C√≥rdoba\",\r\n    available: true,\r\n    coordinates: { lat: -31.4201, lng: -64.1888 },\r\n    radius: 100\r\n  },\r\n  {\r\n    id: \"buenos-aires\",\r\n    name: \"Buenos Aires\",\r\n    available: false,\r\n    coordinates: { lat: -34.6118, lng: -58.3960 },\r\n    radius: 50\r\n  },\r\n  {\r\n    id: \"rosario\",\r\n    name: \"Rosario\",\r\n    available: false,\r\n    coordinates: { lat: -32.9442, lng: -60.6505 },\r\n    radius: 30\r\n  },\r\n];\r\n\r\n// Funci√≥n para calcular distancia entre dos puntos (f√≥rmula de Haversine)\r\nfunction calculateDistance(lat1: number, lng1: number, lat2: number, lng2: number): number {\r\n  const R = 6371; // Radio de la Tierra en km\r\n  const dLat = (lat2 - lat1) * Math.PI / 180;\r\n  const dLng = (lng2 - lng1) * Math.PI / 180;\r\n  const a = \r\n    Math.sin(dLat/2) * Math.sin(dLat/2) +\r\n    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * \r\n    Math.sin(dLng/2) * Math.sin(dLng/2);\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n  return R * c;\r\n}\r\n\r\n// Funci√≥n para detectar la zona m√°s cercana\r\nfunction detectNearestZone(userLat: number, userLng: number): DeliveryZone | null {\r\n\r\n  let nearestZone: DeliveryZone | null = null;\r\n  let minDistance = Infinity;\r\n\r\n  for (const zone of DELIVERY_ZONES) {\r\n\r\n    if (zone.coordinates) {\r\n      const distance = calculateDistance(\r\n        userLat,\r\n        userLng,\r\n        zone.coordinates.lat,\r\n        zone.coordinates.lng\r\n      );\r\n\r\n      console.log(`üó∫Ô∏è Distance to ${zone.name}: ${distance.toFixed(2)}km (radius: ${zone.radius}km)`);\r\n\r\n      // Verificar si est√° dentro del radio de la zona\r\n      if (zone.radius && distance <= zone.radius && distance < minDistance) {\r\n        nearestZone = zone;\r\n        minDistance = distance;\r\n      } else {\r\n      }\r\n    } else {\r\n    }\r\n  }\r\n\r\n  // Si no encuentra una zona espec√≠fica, usar C√≥rdoba Interior como fallback\r\n  const fallbackZone = DELIVERY_ZONES.find(zone => zone.id === \"cordoba-interior\");\r\n  const result = nearestZone || fallbackZone || null;\r\n\r\n\r\n  return result;\r\n}\r\n\r\nexport const useGeolocation = () => {\r\n  const [state, setState] = useState<GeolocationState>({\r\n    location: null,\r\n    isLoading: false,\r\n    error: null,\r\n    permissionStatus: 'unknown',\r\n    detectedZone: null\r\n  });\r\n\r\n  // Funci√≥n para solicitar geolocalizaci√≥n\r\n  const requestLocation = useCallback(() => {\r\n\r\n    if (!navigator.geolocation) {\r\n      setState(prev => ({\r\n        ...prev,\r\n        error: 'Geolocalizaci√≥n no soportada por este navegador',\r\n        permissionStatus: 'denied'\r\n      }));\r\n      return;\r\n    }\r\n\r\n\r\n    setState(prev => {\r\n      const newState = { ...prev, isLoading: true, error: null };\r\n      return newState;\r\n    });\r\n\r\n    // Usar Promise para mejor manejo de errores\r\n    const getCurrentPositionPromise = () => {\r\n      return new Promise<GeolocationPosition>((resolve, reject) => {\r\n        navigator.geolocation.getCurrentPosition(resolve, reject, {\r\n          enableHighAccuracy: false,\r\n          timeout: 30000,\r\n          maximumAge: 0\r\n        });\r\n      });\r\n    };\r\n\r\n    // Ejecutar con async/await para mejor control\r\n    getCurrentPositionPromise()\r\n      .then((position) => {\r\n\r\n        const { latitude, longitude, accuracy } = position.coords;\r\n\r\n        const detectedZone = detectNearestZone(latitude, longitude);\r\n\r\n\r\n        // Usar setTimeout para asegurar que el setState se ejecute en el pr√≥ximo tick\r\n        setTimeout(() => {\r\n          setState(prev => {\r\n            const newState = {\r\n              ...prev,\r\n              location: { lat: latitude, lng: longitude },\r\n              detectedZone,\r\n              isLoading: false,\r\n              permissionStatus: 'granted' as const,\r\n              error: null\r\n            };\r\n            return newState;\r\n          });\r\n        }, 0);\r\n      })\r\n      .catch((error) => {\r\n        let errorMessage = 'Error al obtener ubicaci√≥n';\r\n        let permissionStatus: 'denied' | 'unknown' = 'unknown';\r\n\r\n        switch (error.code) {\r\n          case error.PERMISSION_DENIED:\r\n            errorMessage = 'Permisos de ubicaci√≥n denegados';\r\n            permissionStatus = 'denied';\r\n            break;\r\n          case error.POSITION_UNAVAILABLE:\r\n            errorMessage = 'Ubicaci√≥n no disponible';\r\n            break;\r\n          case error.TIMEOUT:\r\n            errorMessage = 'Tiempo de espera agotado';\r\n            break;\r\n        }\r\n\r\n        // Tambi√©n usar setTimeout para el manejo de errores\r\n        setTimeout(() => {\r\n          setState(prev => ({\r\n            ...prev,\r\n            error: errorMessage,\r\n            isLoading: false,\r\n            permissionStatus\r\n          }));\r\n        }, 0);\r\n      });\r\n  }, []);\r\n\r\n  // Verificar permisos al montar el componente\r\n  useEffect(() => {\r\n\r\n    if ('permissions' in navigator) {\r\n      navigator.permissions.query({ name: 'geolocation' }).then((result) => {\r\n        setState(prev => ({ ...prev, permissionStatus: result.state as any }));\r\n\r\n        // Si ya tiene permisos, solicitar ubicaci√≥n autom√°ticamente\r\n        if (result.state === 'granted') {\r\n          // No solicitar autom√°ticamente para evitar bucles infinitos\r\n        } else if (result.state === 'prompt') {\r\n          // No solicitar autom√°ticamente si es 'prompt' para evitar popup inesperado\r\n        } else {\r\n        }\r\n      }).catch((error) => {\r\n        setState(prev => ({ ...prev, permissionStatus: 'unknown' }));\r\n      });\r\n    } else {\r\n      setState(prev => ({ ...prev, permissionStatus: 'unknown' }));\r\n    }\r\n  }, []); // Sin dependencias para evitar bucles\r\n\r\n  // Funci√≥n para obtener todas las zonas disponibles\r\n  const getAvailableZones = useCallback(() => {\r\n    return DELIVERY_ZONES;\r\n  }, []);\r\n\r\n  // Funci√≥n para seleccionar zona manualmente\r\n  const selectZone = useCallback((zoneId: string) => {\r\n    const zone = DELIVERY_ZONES.find(z => z.id === zoneId);\r\n    if (zone) {\r\n      setState(prev => ({ ...prev, detectedZone: zone }));\r\n    }\r\n  }, []);\r\n\r\n  // Funci√≥n de test para simular geolocalizaci√≥n exitosa\r\n  const testLocation = useCallback((lat: number = -31.4201, lng: number = -64.1888) => {\r\n\r\n    const detectedZone = detectNearestZone(lat, lng);\r\n\r\n    setState(prev => {\r\n      const newState = {\r\n        ...prev,\r\n        location: { lat, lng },\r\n        detectedZone,\r\n        isLoading: false,\r\n        permissionStatus: 'granted' as const,\r\n        error: null\r\n      };\r\n      return newState;\r\n    });\r\n\r\n  }, []);\r\n\r\n  return {\r\n    ...state,\r\n    requestLocation,\r\n    getAvailableZones,\r\n    selectZone,\r\n    deliveryZones: DELIVERY_ZONES,\r\n    testLocation // Funci√≥n de test para debugging\r\n  };\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["useGeolocation","DELIVERY_ZONES","id","name","available","coordinates","lat","lng","radius","calculateDistance","lat1","lng1","lat2","lng2","R","dLat","Math","PI","dLng","a","sin","cos","c","atan2","sqrt","detectNearestZone","userLat","userLng","nearestZone","minDistance","Infinity","zone","distance","console","log","toFixed","fallbackZone","find","result","state","setState","useState","location","isLoading","error","permissionStatus","detectedZone","requestLocation","useCallback","navigator","geolocation","prev","newState","getCurrentPositionPromise","Promise","resolve","reject","getCurrentPosition","enableHighAccuracy","timeout","maximumAge","then","position","latitude","longitude","accuracy","coords","setTimeout","catch","errorMessage","code","PERMISSION_DENIED","POSITION_UNAVAILABLE","TIMEOUT","useEffect","permissions","query","getAvailableZones","selectZone","zoneId","z","testLocation","deliveryZones"],"mappings":"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"}