01c88c156c816b443387a8a076606fd2
// Configuraci√≥n para Node.js Runtime
"use strict";

/* istanbul ignore next */
function cov_k9n1f2cl8() {
  var path = "C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\cart\\add\\route.ts";
  var hash = "131773b6a1d3973cd72261586786fbf083e83a03";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\cart\\add\\route.ts",
    statementMap: {
      "0": {
        start: {
          line: 3,
          column: 0
        },
        end: {
          line: 5,
          column: 3
        }
      },
      "1": {
        start: {
          line: 7,
          column: 4
        },
        end: {
          line: 10,
          column: 7
        }
      },
      "2": {
        start: {
          line: 7,
          column: 24
        },
        end: {
          line: 10,
          column: 7
        }
      },
      "3": {
        start: {
          line: 12,
          column: 0
        },
        end: {
          line: 22,
          column: 3
        }
      },
      "4": {
        start: {
          line: 14,
          column: 8
        },
        end: {
          line: 14,
          column: 19
        }
      },
      "5": {
        start: {
          line: 17,
          column: 8
        },
        end: {
          line: 17,
          column: 20
        }
      },
      "6": {
        start: {
          line: 20,
          column: 8
        },
        end: {
          line: 20,
          column: 23
        }
      },
      "7": {
        start: {
          line: 23,
          column: 16
        },
        end: {
          line: 23,
          column: 38
        }
      },
      "8": {
        start: {
          line: 24,
          column: 18
        },
        end: {
          line: 24,
          column: 66
        }
      },
      "9": {
        start: {
          line: 25,
          column: 16
        },
        end: {
          line: 25,
          column: 54
        }
      },
      "10": {
        start: {
          line: 26,
          column: 16
        },
        end: {
          line: 26,
          column: 24
        }
      },
      "11": {
        start: {
          line: 28,
          column: 4
        },
        end: {
          line: 215,
          column: 5
        }
      },
      "12": {
        start: {
          line: 29,
          column: 8
        },
        end: {
          line: 29,
          column: 80
        }
      },
      "13": {
        start: {
          line: 31,
          column: 24
        },
        end: {
          line: 31,
          column: 49
        }
      },
      "14": {
        start: {
          line: 32,
          column: 8
        },
        end: {
          line: 41,
          column: 9
        }
      },
      "15": {
        start: {
          line: 33,
          column: 12
        },
        end: {
          line: 33,
          column: 66
        }
      },
      "16": {
        start: {
          line: 34,
          column: 12
        },
        end: {
          line: 40,
          column: 15
        }
      },
      "17": {
        start: {
          line: 42,
          column: 23
        },
        end: {
          line: 42,
          column: 38
        }
      },
      "18": {
        start: {
          line: 44,
          column: 21
        },
        end: {
          line: 44,
          column: 41
        }
      },
      "19": {
        start: {
          line: 45,
          column: 61
        },
        end: {
          line: 45,
          column: 65
        }
      },
      "20": {
        start: {
          line: 47,
          column: 8
        },
        end: {
          line: 55,
          column: 9
        }
      },
      "21": {
        start: {
          line: 48,
          column: 12
        },
        end: {
          line: 54,
          column: 15
        }
      },
      "22": {
        start: {
          line: 56,
          column: 8
        },
        end: {
          line: 64,
          column: 9
        }
      },
      "23": {
        start: {
          line: 57,
          column: 12
        },
        end: {
          line: 63,
          column: 15
        }
      },
      "24": {
        start: {
          line: 65,
          column: 8
        },
        end: {
          line: 65,
          column: 140
        }
      },
      "25": {
        start: {
          line: 67,
          column: 25
        },
        end: {
          line: 67,
          column: 63
        }
      },
      "26": {
        start: {
          line: 68,
          column: 8
        },
        end: {
          line: 77,
          column: 9
        }
      },
      "27": {
        start: {
          line: 69,
          column: 12
        },
        end: {
          line: 69,
          column: 79
        }
      },
      "28": {
        start: {
          line: 70,
          column: 12
        },
        end: {
          line: 76,
          column: 15
        }
      },
      "29": {
        start: {
          line: 79,
          column: 55
        },
        end: {
          line: 91,
          column: 37
        }
      },
      "30": {
        start: {
          line: 92,
          column: 8
        },
        end: {
          line: 101,
          column: 9
        }
      },
      "31": {
        start: {
          line: 93,
          column: 12
        },
        end: {
          line: 93,
          column: 79
        }
      },
      "32": {
        start: {
          line: 94,
          column: 12
        },
        end: {
          line: 100,
          column: 15
        }
      },
      "33": {
        start: {
          line: 103,
          column: 8
        },
        end: {
          line: 114,
          column: 9
        }
      },
      "34": {
        start: {
          line: 104,
          column: 12
        },
        end: {
          line: 104,
          column: 139
        }
      },
      "35": {
        start: {
          line: 105,
          column: 12
        },
        end: {
          line: 113,
          column: 15
        }
      },
      "36": {
        start: {
          line: 116,
          column: 61
        },
        end: {
          line: 116,
          column: 176
        }
      },
      "37": {
        start: {
          line: 117,
          column: 28
        },
        end: {
          line: 117,
          column: 36
        }
      },
      "38": {
        start: {
          line: 118,
          column: 24
        },
        end: {
          line: 118,
          column: 31
        }
      },
      "39": {
        start: {
          line: 119,
          column: 8
        },
        end: {
          line: 141,
          column: 9
        }
      },
      "40": {
        start: {
          line: 120,
          column: 12
        },
        end: {
          line: 128,
          column: 13
        }
      },
      "41": {
        start: {
          line: 122,
          column: 16
        },
        end: {
          line: 122,
          column: 41
        }
      },
      "42": {
        start: {
          line: 123,
          column: 16
        },
        end: {
          line: 123,
          column: 38
        }
      },
      "43": {
        start: {
          line: 126,
          column: 16
        },
        end: {
          line: 126,
          column: 65
        }
      },
      "44": {
        start: {
          line: 127,
          column: 16
        },
        end: {
          line: 127,
          column: 40
        }
      },
      "45": {
        start: {
          line: 130,
          column: 12
        },
        end: {
          line: 140,
          column: 13
        }
      },
      "46": {
        start: {
          line: 131,
          column: 16
        },
        end: {
          line: 139,
          column: 19
        }
      },
      "47": {
        start: {
          line: 143,
          column: 53
        },
        end: {
          line: 156,
          column: 17
        }
      },
      "48": {
        start: {
          line: 157,
          column: 8
        },
        end: {
          line: 167,
          column: 9
        }
      },
      "49": {
        start: {
          line: 158,
          column: 12
        },
        end: {
          line: 158,
          column: 84
        }
      },
      "50": {
        start: {
          line: 159,
          column: 12
        },
        end: {
          line: 166,
          column: 15
        }
      },
      "51": {
        start: {
          line: 169,
          column: 59
        },
        end: {
          line: 169,
          column: 133
        }
      },
      "52": {
        start: {
          line: 170,
          column: 27
        },
        end: {
          line: 170,
          column: 88
        }
      },
      "53": {
        start: {
          line: 170,
          column: 60
        },
        end: {
          line: 170,
          column: 79
        }
      },
      "54": {
        start: {
          line: 171,
          column: 30
        },
        end: {
          line: 171,
          column: 54
        }
      },
      "55": {
        start: {
          line: 173,
          column: 32
        },
        end: {
          line: 177,
          column: 20
        }
      },
      "56": {
        start: {
          line: 178,
          column: 8
        },
        end: {
          line: 178,
          column: 87
        }
      },
      "57": {
        start: {
          line: 179,
          column: 8
        },
        end: {
          line: 204,
          column: 11
        }
      },
      "58": {
        start: {
          line: 206,
          column: 8
        },
        end: {
          line: 206,
          column: 66
        }
      },
      "59": {
        start: {
          line: 207,
          column: 8
        },
        end: {
          line: 214,
          column: 11
        }
      },
      "60": {
        start: {
          line: 218,
          column: 4
        },
        end: {
          line: 240,
          column: 7
        }
      }
    },
    fnMap: {
      "0": {
        name: "_export",
        decl: {
          start: {
            line: 6,
            column: 9
          },
          end: {
            line: 6,
            column: 16
          }
        },
        loc: {
          start: {
            line: 6,
            column: 30
          },
          end: {
            line: 11,
            column: 1
          }
        },
        line: 6
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 13,
            column: 4
          },
          end: {
            line: 13,
            column: 5
          }
        },
        loc: {
          start: {
            line: 13,
            column: 15
          },
          end: {
            line: 15,
            column: 5
          }
        },
        line: 13
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 16,
            column: 4
          },
          end: {
            line: 16,
            column: 5
          }
        },
        loc: {
          start: {
            line: 16,
            column: 16
          },
          end: {
            line: 18,
            column: 5
          }
        },
        line: 16
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 19,
            column: 4
          },
          end: {
            line: 19,
            column: 5
          }
        },
        loc: {
          start: {
            line: 19,
            column: 19
          },
          end: {
            line: 21,
            column: 5
          }
        },
        line: 19
      },
      "4": {
        name: "POST",
        decl: {
          start: {
            line: 27,
            column: 15
          },
          end: {
            line: 27,
            column: 19
          }
        },
        loc: {
          start: {
            line: 27,
            column: 29
          },
          end: {
            line: 216,
            column: 1
          }
        },
        line: 27
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 170,
            column: 47
          },
          end: {
            line: 170,
            column: 48
          }
        },
        loc: {
          start: {
            line: 170,
            column: 60
          },
          end: {
            line: 170,
            column: 79
          }
        },
        line: 170
      },
      "6": {
        name: "GET",
        decl: {
          start: {
            line: 217,
            column: 15
          },
          end: {
            line: 217,
            column: 18
          }
        },
        loc: {
          start: {
            line: 217,
            column: 21
          },
          end: {
            line: 241,
            column: 1
          }
        },
        line: 217
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 32,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 32,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 32
      },
      "1": {
        loc: {
          start: {
            line: 45,
            column: 27
          },
          end: {
            line: 45,
            column: 39
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 45,
            column: 38
          },
          end: {
            line: 45,
            column: 39
          }
        }],
        line: 45
      },
      "2": {
        loc: {
          start: {
            line: 45,
            column: 41
          },
          end: {
            line: 45,
            column: 56
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 45,
            column: 51
          },
          end: {
            line: 45,
            column: 56
          }
        }],
        line: 45
      },
      "3": {
        loc: {
          start: {
            line: 47,
            column: 8
          },
          end: {
            line: 55,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 47,
            column: 8
          },
          end: {
            line: 55,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 47
      },
      "4": {
        loc: {
          start: {
            line: 56,
            column: 8
          },
          end: {
            line: 64,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 56,
            column: 8
          },
          end: {
            line: 64,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 56
      },
      "5": {
        loc: {
          start: {
            line: 56,
            column: 12
          },
          end: {
            line: 56,
            column: 73
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 56,
            column: 12
          },
          end: {
            line: 56,
            column: 39
          }
        }, {
          start: {
            line: 56,
            column: 43
          },
          end: {
            line: 56,
            column: 56
          }
        }, {
          start: {
            line: 56,
            column: 60
          },
          end: {
            line: 56,
            column: 73
          }
        }],
        line: 56
      },
      "6": {
        loc: {
          start: {
            line: 68,
            column: 8
          },
          end: {
            line: 77,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 68,
            column: 8
          },
          end: {
            line: 77,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 68
      },
      "7": {
        loc: {
          start: {
            line: 92,
            column: 8
          },
          end: {
            line: 101,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 92,
            column: 8
          },
          end: {
            line: 101,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 92
      },
      "8": {
        loc: {
          start: {
            line: 92,
            column: 12
          },
          end: {
            line: 92,
            column: 36
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 92,
            column: 12
          },
          end: {
            line: 92,
            column: 24
          }
        }, {
          start: {
            line: 92,
            column: 28
          },
          end: {
            line: 92,
            column: 36
          }
        }],
        line: 92
      },
      "9": {
        loc: {
          start: {
            line: 103,
            column: 8
          },
          end: {
            line: 114,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 103,
            column: 8
          },
          end: {
            line: 114,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 103
      },
      "10": {
        loc: {
          start: {
            line: 119,
            column: 8
          },
          end: {
            line: 141,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 119,
            column: 8
          },
          end: {
            line: 141,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 119
      },
      "11": {
        loc: {
          start: {
            line: 119,
            column: 12
          },
          end: {
            line: 119,
            column: 42
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 119,
            column: 12
          },
          end: {
            line: 119,
            column: 24
          }
        }, {
          start: {
            line: 119,
            column: 28
          },
          end: {
            line: 119,
            column: 42
          }
        }],
        line: 119
      },
      "12": {
        loc: {
          start: {
            line: 120,
            column: 12
          },
          end: {
            line: 128,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 120,
            column: 12
          },
          end: {
            line: 128,
            column: 13
          }
        }, {
          start: {
            line: 124,
            column: 19
          },
          end: {
            line: 128,
            column: 13
          }
        }],
        line: 120
      },
      "13": {
        loc: {
          start: {
            line: 130,
            column: 12
          },
          end: {
            line: 140,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 130,
            column: 12
          },
          end: {
            line: 140,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 130
      },
      "14": {
        loc: {
          start: {
            line: 157,
            column: 8
          },
          end: {
            line: 167,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 157,
            column: 8
          },
          end: {
            line: 167,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 157
      },
      "15": {
        loc: {
          start: {
            line: 170,
            column: 27
          },
          end: {
            line: 170,
            column: 88
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 170,
            column: 27
          },
          end: {
            line: 170,
            column: 83
          }
        }, {
          start: {
            line: 170,
            column: 87
          },
          end: {
            line: 170,
            column: 88
          }
        }],
        line: 170
      },
      "16": {
        loc: {
          start: {
            line: 171,
            column: 30
          },
          end: {
            line: 171,
            column: 54
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 171,
            column: 30
          },
          end: {
            line: 171,
            column: 49
          }
        }, {
          start: {
            line: 171,
            column: 53
          },
          end: {
            line: 171,
            column: 54
          }
        }],
        line: 171
      },
      "17": {
        loc: {
          start: {
            line: 188,
            column: 23
          },
          end: {
            line: 188,
            column: 64
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 188,
            column: 23
          },
          end: {
            line: 188,
            column: 47
          }
        }, {
          start: {
            line: 188,
            column: 51
          },
          end: {
            line: 188,
            column: 64
          }
        }],
        line: 188
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0
    },
    b: {
      "0": [0, 0],
      "1": [0],
      "2": [0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0],
      "15": [0, 0],
      "16": [0, 0],
      "17": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\cart\\add\\route.ts"],
      sourcesContent: ["// Configuraci\xF3n para Node.js Runtime\r\nexport const runtime = 'nodejs';\r\n\r\n// ===================================\r\n// PINTEYA E-COMMERCE - API AGREGAR AL CARRITO\r\n// ===================================\r\n// Endpoint espec\xEDfico para agregar productos al carrito\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { getSupabaseClient } from '@/lib/integrations/supabase';\r\nimport { auth } from '@/lib/auth/config';\r\n\r\n/**\r\n * POST /api/cart/add\r\n * Agregar un producto espec\xEDfico al carrito\r\n * Endpoint optimizado para botones \"Agregar al carrito\"\r\n */\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    console.log('\uD83D\uDED2 Cart Add API: Iniciando proceso de agregar al carrito');\r\n\r\n    // Verificar autenticaci\xF3n\r\n    const session = await auth();\r\n    if (!session?.user?.id) {\r\n      console.log('\u274C Cart Add API: Usuario no autenticado');\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: 'Debes iniciar sesi\xF3n para agregar productos al carrito',\r\n          requiresAuth: true\r\n        }, \r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const userId = session.user.id;\r\n\r\n    // Obtener datos del request\r\n    const body = await request.json();\r\n    const { productId, quantity = 1, replace = false } = body;\r\n\r\n    // Validaciones de entrada\r\n    if (!productId) {\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: 'ID del producto es requerido',\r\n          field: 'productId'\r\n        }, \r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    if (!Number.isInteger(quantity) || quantity <= 0 || quantity > 99) {\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: 'La cantidad debe ser un n\xFAmero entero entre 1 y 99',\r\n          field: 'quantity'\r\n        }, \r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    console.log(`\uD83D\uDD0D Cart Add API: Agregando producto ${productId} (cantidad: ${quantity}, replace: ${replace}) para usuario ${userId}`);\r\n\r\n    // Obtener cliente de Supabase\r\n    const supabase = getSupabaseClient(true);\r\n    if (!supabase) {\r\n      console.error('\u274C Cart Add API: Cliente de Supabase no disponible');\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: 'Servicio de base de datos temporalmente no disponible',\r\n          retry: true\r\n        }, \r\n        { status: 503 }\r\n      );\r\n    }\r\n\r\n    // 1. Verificar que el producto existe y obtener informaci\xF3n\r\n    const { data: product, error: productError } = await supabase\r\n      .from('products')\r\n      .select(`\r\n        id,\r\n        name,\r\n        price,\r\n        discounted_price,\r\n        stock,\r\n        images,\r\n        brand,\r\n        category:categories (\r\n          id,\r\n          name\r\n        )\r\n      `)\r\n      .eq('id', productId)\r\n      .single();\r\n\r\n    if (productError || !product) {\r\n      console.log(`\u274C Cart Add API: Producto ${productId} no encontrado`);\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: 'El producto solicitado no existe o no est\xE1 disponible',\r\n          productId\r\n        }, \r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // 2. Verificar stock disponible\r\n    if (product.stock < quantity) {\r\n      console.log(`\u274C Cart Add API: Stock insuficiente para producto ${productId}. Stock: ${product.stock}, Solicitado: ${quantity}`);\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: `Stock insuficiente. Solo quedan ${product.stock} unidades disponibles`,\r\n          availableStock: product.stock,\r\n          requestedQuantity: quantity,\r\n          productName: product.name\r\n        }, \r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // 3. Verificar si el producto ya est\xE1 en el carrito\r\n    const { data: existingItem, error: existingError } = await supabase\r\n      .from('cart_items')\r\n      .select('id, quantity')\r\n      .eq('user_id', userId)\r\n      .eq('product_id', productId)\r\n      .single();\r\n\r\n    let finalQuantity = quantity;\r\n    let operation = 'added';\r\n\r\n    if (existingItem && !existingError) {\r\n      if (replace) {\r\n        // Reemplazar cantidad existente\r\n        finalQuantity = quantity;\r\n        operation = 'updated';\r\n      } else {\r\n        // Sumar a la cantidad existente\r\n        finalQuantity = existingItem.quantity + quantity;\r\n        operation = 'increased';\r\n      }\r\n\r\n      // Verificar que la cantidad final no exceda el stock\r\n      if (finalQuantity > product.stock) {\r\n        return NextResponse.json(\r\n          { \r\n            success: false, \r\n            error: `No se puede agregar. Ya tienes ${existingItem.quantity} en el carrito. Stock disponible: ${product.stock}`,\r\n            currentQuantity: existingItem.quantity,\r\n            availableStock: product.stock,\r\n            maxCanAdd: product.stock - existingItem.quantity\r\n          }, \r\n          { status: 400 }\r\n        );\r\n      }\r\n    }\r\n\r\n    // 4. Agregar o actualizar item en carrito\r\n    const { data: cartItem, error: cartError } = await supabase\r\n      .from('cart_items')\r\n      .upsert({\r\n        user_id: userId,\r\n        product_id: productId,\r\n        quantity: finalQuantity\r\n      }, {\r\n        onConflict: 'user_id,product_id'\r\n      })\r\n      .select(`\r\n        id,\r\n        user_id,\r\n        product_id,\r\n        quantity,\r\n        created_at,\r\n        updated_at\r\n      `)\r\n      .single();\r\n\r\n    if (cartError) {\r\n      console.error('\u274C Cart Add API: Error agregando al carrito:', cartError);\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: 'Error agregando producto al carrito. Intenta nuevamente.',\r\n          details: cartError.message,\r\n          retry: true\r\n        }, \r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // 5. Obtener resumen actualizado del carrito\r\n    const { data: cartSummary, error: summaryError } = await supabase\r\n      .from('cart_items')\r\n      .select('quantity')\r\n      .eq('user_id', userId);\r\n\r\n    const totalItems = cartSummary?.reduce((sum, item) => sum + item.quantity, 0) || 0;\r\n    const totalProducts = cartSummary?.length || 0;\r\n\r\n    // 6. Preparar respuesta\r\n    const responseMessage = {\r\n      added: `${product.name} agregado al carrito`,\r\n      updated: `Cantidad de ${product.name} actualizada en el carrito`,\r\n      increased: `Se agregaron ${quantity} m\xE1s de ${product.name} al carrito`\r\n    }[operation];\r\n\r\n    console.log(`\u2705 Cart Add API: ${responseMessage} - Total items: ${totalItems}`);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: responseMessage,\r\n      operation,\r\n      item: {\r\n        id: cartItem.id,\r\n        productId: product.id,\r\n        productName: product.name,\r\n        quantity: cartItem.quantity,\r\n        price: product.discounted_price || product.price,\r\n        addedQuantity: quantity\r\n      },\r\n      cart: {\r\n        totalItems,\r\n        totalProducts\r\n      },\r\n      product: {\r\n        id: product.id,\r\n        name: product.name,\r\n        price: product.price,\r\n        discounted_price: product.discounted_price,\r\n        images: product.images,\r\n        brand: product.brand,\r\n        category: product.category\r\n      }\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error('\u274C Cart Add API: Error inesperado:', error);\r\n    return NextResponse.json(\r\n      { \r\n        success: false, \r\n        error: 'Error interno del servidor. Intenta nuevamente.',\r\n        details: error.message,\r\n        retry: true\r\n      }, \r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/cart/add\r\n * Informaci\xF3n sobre c\xF3mo usar este endpoint\r\n */\r\nexport async function GET() {\r\n  return NextResponse.json({\r\n    endpoint: '/api/cart/add',\r\n    method: 'POST',\r\n    description: 'Agregar productos al carrito de compras',\r\n    parameters: {\r\n      productId: 'number - ID del producto (requerido)',\r\n      quantity: 'number - Cantidad a agregar (opcional, default: 1)',\r\n      replace: 'boolean - Si true, reemplaza cantidad existente (opcional, default: false)'\r\n    },\r\n    example: {\r\n      productId: 123,\r\n      quantity: 2,\r\n      replace: false\r\n    },\r\n    authentication: 'Requerida - Usuario debe estar autenticado',\r\n    responses: {\r\n      200: 'Producto agregado exitosamente',\r\n      400: 'Datos inv\xE1lidos o stock insuficiente',\r\n      401: 'Usuario no autenticado',\r\n      404: 'Producto no encontrado',\r\n      500: 'Error interno del servidor'\r\n    }\r\n  });\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],
      names: ["GET", "POST", "runtime", "request", "console", "log", "session", "auth", "user", "id", "NextResponse", "json", "success", "error", "requiresAuth", "status", "userId", "body", "productId", "quantity", "replace", "field", "Number", "isInteger", "supabase", "getSupabaseClient", "retry", "data", "product", "productError", "from", "select", "eq", "single", "stock", "availableStock", "requestedQuantity", "productName", "name", "existingItem", "existingError", "finalQuantity", "operation", "currentQuantity", "maxCanAdd", "cartItem", "cartError", "upsert", "user_id", "product_id", "onConflict", "details", "message", "cartSummary", "summaryError", "totalItems", "reduce", "sum", "item", "totalProducts", "length", "responseMessage", "added", "updated", "increased", "price", "discounted_price", "addedQuantity", "cart", "images", "brand", "category", "endpoint", "method", "description", "parameters", "example", "authentication", "responses"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "131773b6a1d3973cd72261586786fbf083e83a03"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_k9n1f2cl8 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_k9n1f2cl8();
cov_k9n1f2cl8().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function _export(target, all) {
  /* istanbul ignore next */
  cov_k9n1f2cl8().f[0]++;
  cov_k9n1f2cl8().s[1]++;
  for (var name in all) {
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[2]++;
    Object.defineProperty(target, name, {
      enumerable: true,
      get: Object.getOwnPropertyDescriptor(all, name).get
    });
  }
}
/* istanbul ignore next */
cov_k9n1f2cl8().s[3]++;
_export(exports, {
  get GET() {
    /* istanbul ignore next */
    cov_k9n1f2cl8().f[1]++;
    cov_k9n1f2cl8().s[4]++;
    return GET;
  },
  get POST() {
    /* istanbul ignore next */
    cov_k9n1f2cl8().f[2]++;
    cov_k9n1f2cl8().s[5]++;
    return POST;
  },
  get runtime() {
    /* istanbul ignore next */
    cov_k9n1f2cl8().f[3]++;
    cov_k9n1f2cl8().s[6]++;
    return runtime;
  }
});
const _server =
/* istanbul ignore next */
(cov_k9n1f2cl8().s[7]++, require("next/server"));
const _supabase =
/* istanbul ignore next */
(cov_k9n1f2cl8().s[8]++, require("../../../../lib/integrations/supabase"));
const _config =
/* istanbul ignore next */
(cov_k9n1f2cl8().s[9]++, require("../../../../lib/auth/config"));
const runtime =
/* istanbul ignore next */
(cov_k9n1f2cl8().s[10]++, 'nodejs');
async function POST(request) {
  /* istanbul ignore next */
  cov_k9n1f2cl8().f[4]++;
  cov_k9n1f2cl8().s[11]++;
  try {
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[12]++;
    console.log('üõí Cart Add API: Iniciando proceso de agregar al carrito');
    // Verificar autenticaci√≥n
    const session =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[13]++, await (0, _config.auth)());
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[14]++;
    if (!session?.user?.id) {
      /* istanbul ignore next */
      cov_k9n1f2cl8().b[0][0]++;
      cov_k9n1f2cl8().s[15]++;
      console.log('‚ùå Cart Add API: Usuario no autenticado');
      /* istanbul ignore next */
      cov_k9n1f2cl8().s[16]++;
      return _server.NextResponse.json({
        success: false,
        error: 'Debes iniciar sesi√≥n para agregar productos al carrito',
        requiresAuth: true
      }, {
        status: 401
      });
    } else
    /* istanbul ignore next */
    {
      cov_k9n1f2cl8().b[0][1]++;
    }
    const userId =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[17]++, session.user.id);
    // Obtener datos del request
    const body =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[18]++, await request.json());
    const {
      productId,
      quantity =
      /* istanbul ignore next */
      (cov_k9n1f2cl8().b[1][0]++, 1),
      replace =
      /* istanbul ignore next */
      (cov_k9n1f2cl8().b[2][0]++, false)
    } =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[19]++, body);
    // Validaciones de entrada
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[20]++;
    if (!productId) {
      /* istanbul ignore next */
      cov_k9n1f2cl8().b[3][0]++;
      cov_k9n1f2cl8().s[21]++;
      return _server.NextResponse.json({
        success: false,
        error: 'ID del producto es requerido',
        field: 'productId'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_k9n1f2cl8().b[3][1]++;
    }
    cov_k9n1f2cl8().s[22]++;
    if (
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[5][0]++, !Number.isInteger(quantity)) ||
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[5][1]++, quantity <= 0) ||
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[5][2]++, quantity > 99)) {
      /* istanbul ignore next */
      cov_k9n1f2cl8().b[4][0]++;
      cov_k9n1f2cl8().s[23]++;
      return _server.NextResponse.json({
        success: false,
        error: 'La cantidad debe ser un n√∫mero entero entre 1 y 99',
        field: 'quantity'
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_k9n1f2cl8().b[4][1]++;
    }
    cov_k9n1f2cl8().s[24]++;
    console.log(`üîç Cart Add API: Agregando producto ${productId} (cantidad: ${quantity}, replace: ${replace}) para usuario ${userId}`);
    // Obtener cliente de Supabase
    const supabase =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[25]++, (0, _supabase.getSupabaseClient)(true));
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[26]++;
    if (!supabase) {
      /* istanbul ignore next */
      cov_k9n1f2cl8().b[6][0]++;
      cov_k9n1f2cl8().s[27]++;
      console.error('‚ùå Cart Add API: Cliente de Supabase no disponible');
      /* istanbul ignore next */
      cov_k9n1f2cl8().s[28]++;
      return _server.NextResponse.json({
        success: false,
        error: 'Servicio de base de datos temporalmente no disponible',
        retry: true
      }, {
        status: 503
      });
    } else
    /* istanbul ignore next */
    {
      cov_k9n1f2cl8().b[6][1]++;
    }
    // 1. Verificar que el producto existe y obtener informaci√≥n
    const {
      data: product,
      error: productError
    } =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[29]++, await supabase.from('products').select(`
        id,
        name,
        price,
        discounted_price,
        stock,
        images,
        brand,
        category:categories (
          id,
          name
        )
      `).eq('id', productId).single());
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[30]++;
    if (
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[8][0]++, productError) ||
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[8][1]++, !product)) {
      /* istanbul ignore next */
      cov_k9n1f2cl8().b[7][0]++;
      cov_k9n1f2cl8().s[31]++;
      console.log(`‚ùå Cart Add API: Producto ${productId} no encontrado`);
      /* istanbul ignore next */
      cov_k9n1f2cl8().s[32]++;
      return _server.NextResponse.json({
        success: false,
        error: 'El producto solicitado no existe o no est√° disponible',
        productId
      }, {
        status: 404
      });
    } else
    /* istanbul ignore next */
    {
      cov_k9n1f2cl8().b[7][1]++;
    }
    // 2. Verificar stock disponible
    cov_k9n1f2cl8().s[33]++;
    if (product.stock < quantity) {
      /* istanbul ignore next */
      cov_k9n1f2cl8().b[9][0]++;
      cov_k9n1f2cl8().s[34]++;
      console.log(`‚ùå Cart Add API: Stock insuficiente para producto ${productId}. Stock: ${product.stock}, Solicitado: ${quantity}`);
      /* istanbul ignore next */
      cov_k9n1f2cl8().s[35]++;
      return _server.NextResponse.json({
        success: false,
        error: `Stock insuficiente. Solo quedan ${product.stock} unidades disponibles`,
        availableStock: product.stock,
        requestedQuantity: quantity,
        productName: product.name
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_k9n1f2cl8().b[9][1]++;
    }
    // 3. Verificar si el producto ya est√° en el carrito
    const {
      data: existingItem,
      error: existingError
    } =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[36]++, await supabase.from('cart_items').select('id, quantity').eq('user_id', userId).eq('product_id', productId).single());
    let finalQuantity =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[37]++, quantity);
    let operation =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[38]++, 'added');
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[39]++;
    if (
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[11][0]++, existingItem) &&
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[11][1]++, !existingError)) {
      /* istanbul ignore next */
      cov_k9n1f2cl8().b[10][0]++;
      cov_k9n1f2cl8().s[40]++;
      if (replace) {
        /* istanbul ignore next */
        cov_k9n1f2cl8().b[12][0]++;
        cov_k9n1f2cl8().s[41]++;
        // Reemplazar cantidad existente
        finalQuantity = quantity;
        /* istanbul ignore next */
        cov_k9n1f2cl8().s[42]++;
        operation = 'updated';
      } else {
        /* istanbul ignore next */
        cov_k9n1f2cl8().b[12][1]++;
        cov_k9n1f2cl8().s[43]++;
        // Sumar a la cantidad existente
        finalQuantity = existingItem.quantity + quantity;
        /* istanbul ignore next */
        cov_k9n1f2cl8().s[44]++;
        operation = 'increased';
      }
      // Verificar que la cantidad final no exceda el stock
      /* istanbul ignore next */
      cov_k9n1f2cl8().s[45]++;
      if (finalQuantity > product.stock) {
        /* istanbul ignore next */
        cov_k9n1f2cl8().b[13][0]++;
        cov_k9n1f2cl8().s[46]++;
        return _server.NextResponse.json({
          success: false,
          error: `No se puede agregar. Ya tienes ${existingItem.quantity} en el carrito. Stock disponible: ${product.stock}`,
          currentQuantity: existingItem.quantity,
          availableStock: product.stock,
          maxCanAdd: product.stock - existingItem.quantity
        }, {
          status: 400
        });
      } else
      /* istanbul ignore next */
      {
        cov_k9n1f2cl8().b[13][1]++;
      }
    } else
    /* istanbul ignore next */
    {
      cov_k9n1f2cl8().b[10][1]++;
    }
    // 4. Agregar o actualizar item en carrito
    const {
      data: cartItem,
      error: cartError
    } =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[47]++, await supabase.from('cart_items').upsert({
      user_id: userId,
      product_id: productId,
      quantity: finalQuantity
    }, {
      onConflict: 'user_id,product_id'
    }).select(`
        id,
        user_id,
        product_id,
        quantity,
        created_at,
        updated_at
      `).single());
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[48]++;
    if (cartError) {
      /* istanbul ignore next */
      cov_k9n1f2cl8().b[14][0]++;
      cov_k9n1f2cl8().s[49]++;
      console.error('‚ùå Cart Add API: Error agregando al carrito:', cartError);
      /* istanbul ignore next */
      cov_k9n1f2cl8().s[50]++;
      return _server.NextResponse.json({
        success: false,
        error: 'Error agregando producto al carrito. Intenta nuevamente.',
        details: cartError.message,
        retry: true
      }, {
        status: 500
      });
    } else
    /* istanbul ignore next */
    {
      cov_k9n1f2cl8().b[14][1]++;
    }
    // 5. Obtener resumen actualizado del carrito
    const {
      data: cartSummary,
      error: summaryError
    } =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[51]++, await supabase.from('cart_items').select('quantity').eq('user_id', userId));
    const totalItems =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[52]++,
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[15][0]++, cartSummary?.reduce((sum, item) => {
      /* istanbul ignore next */
      cov_k9n1f2cl8().f[5]++;
      cov_k9n1f2cl8().s[53]++;
      return sum + item.quantity;
    }, 0)) ||
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[15][1]++, 0));
    const totalProducts =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[54]++,
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[16][0]++, cartSummary?.length) ||
    /* istanbul ignore next */
    (cov_k9n1f2cl8().b[16][1]++, 0));
    // 6. Preparar respuesta
    const responseMessage =
    /* istanbul ignore next */
    (cov_k9n1f2cl8().s[55]++, {
      added: `${product.name} agregado al carrito`,
      updated: `Cantidad de ${product.name} actualizada en el carrito`,
      increased: `Se agregaron ${quantity} m√°s de ${product.name} al carrito`
    }[operation]);
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[56]++;
    console.log(`‚úÖ Cart Add API: ${responseMessage} - Total items: ${totalItems}`);
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[57]++;
    return _server.NextResponse.json({
      success: true,
      message: responseMessage,
      operation,
      item: {
        id: cartItem.id,
        productId: product.id,
        productName: product.name,
        quantity: cartItem.quantity,
        price:
        /* istanbul ignore next */
        (cov_k9n1f2cl8().b[17][0]++, product.discounted_price) ||
        /* istanbul ignore next */
        (cov_k9n1f2cl8().b[17][1]++, product.price),
        addedQuantity: quantity
      },
      cart: {
        totalItems,
        totalProducts
      },
      product: {
        id: product.id,
        name: product.name,
        price: product.price,
        discounted_price: product.discounted_price,
        images: product.images,
        brand: product.brand,
        category: product.category
      }
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[58]++;
    console.error('‚ùå Cart Add API: Error inesperado:', error);
    /* istanbul ignore next */
    cov_k9n1f2cl8().s[59]++;
    return _server.NextResponse.json({
      success: false,
      error: 'Error interno del servidor. Intenta nuevamente.',
      details: error.message,
      retry: true
    }, {
      status: 500
    });
  }
}
async function GET() {
  /* istanbul ignore next */
  cov_k9n1f2cl8().f[6]++;
  cov_k9n1f2cl8().s[60]++;
  return _server.NextResponse.json({
    endpoint: '/api/cart/add',
    method: 'POST',
    description: 'Agregar productos al carrito de compras',
    parameters: {
      productId: 'number - ID del producto (requerido)',
      quantity: 'number - Cantidad a agregar (opcional, default: 1)',
      replace: 'boolean - Si true, reemplaza cantidad existente (opcional, default: false)'
    },
    example: {
      productId: 123,
      quantity: 2,
      replace: false
    },
    authentication: 'Requerida - Usuario debe estar autenticado',
    responses: {
      200: 'Producto agregado exitosamente',
      400: 'Datos inv√°lidos o stock insuficiente',
      401: 'Usuario no autenticado',
      404: 'Producto no encontrado',
      500: 'Error interno del servidor'
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfazluMWYyY2w4IiwiYWN0dWFsQ292ZXJhZ2UiLCJzIiwiR0VUIiwiZiIsIlBPU1QiLCJydW50aW1lIiwicmVxdWVzdCIsImNvbnNvbGUiLCJsb2ciLCJzZXNzaW9uIiwiX2NvbmZpZyIsImF1dGgiLCJ1c2VyIiwiaWQiLCJiIiwiX3NlcnZlciIsIk5leHRSZXNwb25zZSIsImpzb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJyZXF1aXJlc0F1dGgiLCJzdGF0dXMiLCJ1c2VySWQiLCJib2R5IiwicHJvZHVjdElkIiwicXVhbnRpdHkiLCJyZXBsYWNlIiwiZmllbGQiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJzdXBhYmFzZSIsIl9zdXBhYmFzZSIsImdldFN1cGFiYXNlQ2xpZW50IiwicmV0cnkiLCJkYXRhIiwicHJvZHVjdCIsInByb2R1Y3RFcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsInN0b2NrIiwiYXZhaWxhYmxlU3RvY2siLCJyZXF1ZXN0ZWRRdWFudGl0eSIsInByb2R1Y3ROYW1lIiwibmFtZSIsImV4aXN0aW5nSXRlbSIsImV4aXN0aW5nRXJyb3IiLCJmaW5hbFF1YW50aXR5Iiwib3BlcmF0aW9uIiwiY3VycmVudFF1YW50aXR5IiwibWF4Q2FuQWRkIiwiY2FydEl0ZW0iLCJjYXJ0RXJyb3IiLCJ1cHNlcnQiLCJ1c2VyX2lkIiwicHJvZHVjdF9pZCIsIm9uQ29uZmxpY3QiLCJkZXRhaWxzIiwibWVzc2FnZSIsImNhcnRTdW1tYXJ5Iiwic3VtbWFyeUVycm9yIiwidG90YWxJdGVtcyIsInJlZHVjZSIsInN1bSIsIml0ZW0iLCJ0b3RhbFByb2R1Y3RzIiwibGVuZ3RoIiwicmVzcG9uc2VNZXNzYWdlIiwiYWRkZWQiLCJ1cGRhdGVkIiwiaW5jcmVhc2VkIiwicHJpY2UiLCJkaXNjb3VudGVkX3ByaWNlIiwiYWRkZWRRdWFudGl0eSIsImNhcnQiLCJpbWFnZXMiLCJicmFuZCIsImNhdGVnb3J5IiwiZW5kcG9pbnQiLCJtZXRob2QiLCJkZXNjcmlwdGlvbiIsInBhcmFtZXRlcnMiLCJleGFtcGxlIiwiYXV0aGVudGljYXRpb24iLCJyZXNwb25zZXMiXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXG1hcnRpXFxEZXNrdG9wXFxERVNBUlJPTExPU1dcXEJPSUxFUlBMQVRURSBFLUNPTU1FUkNFXFxzcmNcXGFwcFxcYXBpXFxjYXJ0XFxhZGRcXHJvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvbmZpZ3VyYWNpw7NuIHBhcmEgTm9kZS5qcyBSdW50aW1lXHJcbmV4cG9ydCBjb25zdCBydW50aW1lID0gJ25vZGVqcyc7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQSU5URVlBIEUtQ09NTUVSQ0UgLSBBUEkgQUdSRUdBUiBBTCBDQVJSSVRPXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEVuZHBvaW50IGVzcGVjw61maWNvIHBhcmEgYWdyZWdhciBwcm9kdWN0b3MgYWwgY2Fycml0b1xyXG5cclxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcclxuaW1wb3J0IHsgZ2V0U3VwYWJhc2VDbGllbnQgfSBmcm9tICdAL2xpYi9pbnRlZ3JhdGlvbnMvc3VwYWJhc2UnO1xyXG5pbXBvcnQgeyBhdXRoIH0gZnJvbSAnQC9saWIvYXV0aC9jb25maWcnO1xyXG5cclxuLyoqXHJcbiAqIFBPU1QgL2FwaS9jYXJ0L2FkZFxyXG4gKiBBZ3JlZ2FyIHVuIHByb2R1Y3RvIGVzcGVjw61maWNvIGFsIGNhcnJpdG9cclxuICogRW5kcG9pbnQgb3B0aW1pemFkbyBwYXJhIGJvdG9uZXMgXCJBZ3JlZ2FyIGFsIGNhcnJpdG9cIlxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coJ/Cfm5IgQ2FydCBBZGQgQVBJOiBJbmljaWFuZG8gcHJvY2VzbyBkZSBhZ3JlZ2FyIGFsIGNhcnJpdG8nKTtcclxuXHJcbiAgICAvLyBWZXJpZmljYXIgYXV0ZW50aWNhY2nDs25cclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKCk7XHJcbiAgICBpZiAoIXNlc3Npb24/LnVzZXI/LmlkKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfinYwgQ2FydCBBZGQgQVBJOiBVc3VhcmlvIG5vIGF1dGVudGljYWRvJyk7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6ICdEZWJlcyBpbmljaWFyIHNlc2nDs24gcGFyYSBhZ3JlZ2FyIHByb2R1Y3RvcyBhbCBjYXJyaXRvJyxcclxuICAgICAgICAgIHJlcXVpcmVzQXV0aDogdHJ1ZVxyXG4gICAgICAgIH0sIFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHVzZXJJZCA9IHNlc3Npb24udXNlci5pZDtcclxuXHJcbiAgICAvLyBPYnRlbmVyIGRhdG9zIGRlbCByZXF1ZXN0XHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICBjb25zdCB7IHByb2R1Y3RJZCwgcXVhbnRpdHkgPSAxLCByZXBsYWNlID0gZmFsc2UgfSA9IGJvZHk7XHJcblxyXG4gICAgLy8gVmFsaWRhY2lvbmVzIGRlIGVudHJhZGFcclxuICAgIGlmICghcHJvZHVjdElkKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6ICdJRCBkZWwgcHJvZHVjdG8gZXMgcmVxdWVyaWRvJyxcclxuICAgICAgICAgIGZpZWxkOiAncHJvZHVjdElkJ1xyXG4gICAgICAgIH0sIFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihxdWFudGl0eSkgfHwgcXVhbnRpdHkgPD0gMCB8fCBxdWFudGl0eSA+IDk5KSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6ICdMYSBjYW50aWRhZCBkZWJlIHNlciB1biBuw7ptZXJvIGVudGVybyBlbnRyZSAxIHkgOTknLFxyXG4gICAgICAgICAgZmllbGQ6ICdxdWFudGl0eSdcclxuICAgICAgICB9LCBcclxuICAgICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZyhg8J+UjSBDYXJ0IEFkZCBBUEk6IEFncmVnYW5kbyBwcm9kdWN0byAke3Byb2R1Y3RJZH0gKGNhbnRpZGFkOiAke3F1YW50aXR5fSwgcmVwbGFjZTogJHtyZXBsYWNlfSkgcGFyYSB1c3VhcmlvICR7dXNlcklkfWApO1xyXG5cclxuICAgIC8vIE9idGVuZXIgY2xpZW50ZSBkZSBTdXBhYmFzZVxyXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZUNsaWVudCh0cnVlKTtcclxuICAgIGlmICghc3VwYWJhc2UpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign4p2MIENhcnQgQWRkIEFQSTogQ2xpZW50ZSBkZSBTdXBhYmFzZSBubyBkaXNwb25pYmxlJyk7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6ICdTZXJ2aWNpbyBkZSBiYXNlIGRlIGRhdG9zIHRlbXBvcmFsbWVudGUgbm8gZGlzcG9uaWJsZScsXHJcbiAgICAgICAgICByZXRyeTogdHJ1ZVxyXG4gICAgICAgIH0sIFxyXG4gICAgICAgIHsgc3RhdHVzOiA1MDMgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDEuIFZlcmlmaWNhciBxdWUgZWwgcHJvZHVjdG8gZXhpc3RlIHkgb2J0ZW5lciBpbmZvcm1hY2nDs25cclxuICAgIGNvbnN0IHsgZGF0YTogcHJvZHVjdCwgZXJyb3I6IHByb2R1Y3RFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2R1Y3RzJylcclxuICAgICAgLnNlbGVjdChgXHJcbiAgICAgICAgaWQsXHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBwcmljZSxcclxuICAgICAgICBkaXNjb3VudGVkX3ByaWNlLFxyXG4gICAgICAgIHN0b2NrLFxyXG4gICAgICAgIGltYWdlcyxcclxuICAgICAgICBicmFuZCxcclxuICAgICAgICBjYXRlZ29yeTpjYXRlZ29yaWVzIChcclxuICAgICAgICAgIGlkLFxyXG4gICAgICAgICAgbmFtZVxyXG4gICAgICAgIClcclxuICAgICAgYClcclxuICAgICAgLmVxKCdpZCcsIHByb2R1Y3RJZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChwcm9kdWN0RXJyb3IgfHwgIXByb2R1Y3QpIHtcclxuICAgICAgY29uc29sZS5sb2coYOKdjCBDYXJ0IEFkZCBBUEk6IFByb2R1Y3RvICR7cHJvZHVjdElkfSBubyBlbmNvbnRyYWRvYCk7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6ICdFbCBwcm9kdWN0byBzb2xpY2l0YWRvIG5vIGV4aXN0ZSBvIG5vIGVzdMOhIGRpc3BvbmlibGUnLFxyXG4gICAgICAgICAgcHJvZHVjdElkXHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwNCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMi4gVmVyaWZpY2FyIHN0b2NrIGRpc3BvbmlibGVcclxuICAgIGlmIChwcm9kdWN0LnN0b2NrIDwgcXVhbnRpdHkpIHtcclxuICAgICAgY29uc29sZS5sb2coYOKdjCBDYXJ0IEFkZCBBUEk6IFN0b2NrIGluc3VmaWNpZW50ZSBwYXJhIHByb2R1Y3RvICR7cHJvZHVjdElkfS4gU3RvY2s6ICR7cHJvZHVjdC5zdG9ja30sIFNvbGljaXRhZG86ICR7cXVhbnRpdHl9YCk7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6IGBTdG9jayBpbnN1ZmljaWVudGUuIFNvbG8gcXVlZGFuICR7cHJvZHVjdC5zdG9ja30gdW5pZGFkZXMgZGlzcG9uaWJsZXNgLFxyXG4gICAgICAgICAgYXZhaWxhYmxlU3RvY2s6IHByb2R1Y3Quc3RvY2ssXHJcbiAgICAgICAgICByZXF1ZXN0ZWRRdWFudGl0eTogcXVhbnRpdHksXHJcbiAgICAgICAgICBwcm9kdWN0TmFtZTogcHJvZHVjdC5uYW1lXHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMy4gVmVyaWZpY2FyIHNpIGVsIHByb2R1Y3RvIHlhIGVzdMOhIGVuIGVsIGNhcnJpdG9cclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdJdGVtLCBlcnJvcjogZXhpc3RpbmdFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2NhcnRfaXRlbXMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCwgcXVhbnRpdHknKVxyXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXHJcbiAgICAgIC5lcSgncHJvZHVjdF9pZCcsIHByb2R1Y3RJZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGxldCBmaW5hbFF1YW50aXR5ID0gcXVhbnRpdHk7XHJcbiAgICBsZXQgb3BlcmF0aW9uID0gJ2FkZGVkJztcclxuXHJcbiAgICBpZiAoZXhpc3RpbmdJdGVtICYmICFleGlzdGluZ0Vycm9yKSB7XHJcbiAgICAgIGlmIChyZXBsYWNlKSB7XHJcbiAgICAgICAgLy8gUmVlbXBsYXphciBjYW50aWRhZCBleGlzdGVudGVcclxuICAgICAgICBmaW5hbFF1YW50aXR5ID0gcXVhbnRpdHk7XHJcbiAgICAgICAgb3BlcmF0aW9uID0gJ3VwZGF0ZWQnO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIFN1bWFyIGEgbGEgY2FudGlkYWQgZXhpc3RlbnRlXHJcbiAgICAgICAgZmluYWxRdWFudGl0eSA9IGV4aXN0aW5nSXRlbS5xdWFudGl0eSArIHF1YW50aXR5O1xyXG4gICAgICAgIG9wZXJhdGlvbiA9ICdpbmNyZWFzZWQnO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBWZXJpZmljYXIgcXVlIGxhIGNhbnRpZGFkIGZpbmFsIG5vIGV4Y2VkYSBlbCBzdG9ja1xyXG4gICAgICBpZiAoZmluYWxRdWFudGl0eSA+IHByb2R1Y3Quc3RvY2spIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICB7IFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXHJcbiAgICAgICAgICAgIGVycm9yOiBgTm8gc2UgcHVlZGUgYWdyZWdhci4gWWEgdGllbmVzICR7ZXhpc3RpbmdJdGVtLnF1YW50aXR5fSBlbiBlbCBjYXJyaXRvLiBTdG9jayBkaXNwb25pYmxlOiAke3Byb2R1Y3Quc3RvY2t9YCxcclxuICAgICAgICAgICAgY3VycmVudFF1YW50aXR5OiBleGlzdGluZ0l0ZW0ucXVhbnRpdHksXHJcbiAgICAgICAgICAgIGF2YWlsYWJsZVN0b2NrOiBwcm9kdWN0LnN0b2NrLFxyXG4gICAgICAgICAgICBtYXhDYW5BZGQ6IHByb2R1Y3Quc3RvY2sgLSBleGlzdGluZ0l0ZW0ucXVhbnRpdHlcclxuICAgICAgICAgIH0sIFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIDQuIEFncmVnYXIgbyBhY3R1YWxpemFyIGl0ZW0gZW4gY2Fycml0b1xyXG4gICAgY29uc3QgeyBkYXRhOiBjYXJ0SXRlbSwgZXJyb3I6IGNhcnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ2NhcnRfaXRlbXMnKVxyXG4gICAgICAudXBzZXJ0KHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgcHJvZHVjdF9pZDogcHJvZHVjdElkLFxyXG4gICAgICAgIHF1YW50aXR5OiBmaW5hbFF1YW50aXR5XHJcbiAgICAgIH0sIHtcclxuICAgICAgICBvbkNvbmZsaWN0OiAndXNlcl9pZCxwcm9kdWN0X2lkJ1xyXG4gICAgICB9KVxyXG4gICAgICAuc2VsZWN0KGBcclxuICAgICAgICBpZCxcclxuICAgICAgICB1c2VyX2lkLFxyXG4gICAgICAgIHByb2R1Y3RfaWQsXHJcbiAgICAgICAgcXVhbnRpdHksXHJcbiAgICAgICAgY3JlYXRlZF9hdCxcclxuICAgICAgICB1cGRhdGVkX2F0XHJcbiAgICAgIGApXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoY2FydEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBDYXJ0IEFkZCBBUEk6IEVycm9yIGFncmVnYW5kbyBhbCBjYXJyaXRvOicsIGNhcnRFcnJvcik7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsIFxyXG4gICAgICAgICAgZXJyb3I6ICdFcnJvciBhZ3JlZ2FuZG8gcHJvZHVjdG8gYWwgY2Fycml0by4gSW50ZW50YSBudWV2YW1lbnRlLicsXHJcbiAgICAgICAgICBkZXRhaWxzOiBjYXJ0RXJyb3IubWVzc2FnZSxcclxuICAgICAgICAgIHJldHJ5OiB0cnVlXHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gNS4gT2J0ZW5lciByZXN1bWVuIGFjdHVhbGl6YWRvIGRlbCBjYXJyaXRvXHJcbiAgICBjb25zdCB7IGRhdGE6IGNhcnRTdW1tYXJ5LCBlcnJvcjogc3VtbWFyeUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbSgnY2FydF9pdGVtcycpXHJcbiAgICAgIC5zZWxlY3QoJ3F1YW50aXR5JylcclxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKTtcclxuXHJcbiAgICBjb25zdCB0b3RhbEl0ZW1zID0gY2FydFN1bW1hcnk/LnJlZHVjZSgoc3VtLCBpdGVtKSA9PiBzdW0gKyBpdGVtLnF1YW50aXR5LCAwKSB8fCAwO1xyXG4gICAgY29uc3QgdG90YWxQcm9kdWN0cyA9IGNhcnRTdW1tYXJ5Py5sZW5ndGggfHwgMDtcclxuXHJcbiAgICAvLyA2LiBQcmVwYXJhciByZXNwdWVzdGFcclxuICAgIGNvbnN0IHJlc3BvbnNlTWVzc2FnZSA9IHtcclxuICAgICAgYWRkZWQ6IGAke3Byb2R1Y3QubmFtZX0gYWdyZWdhZG8gYWwgY2Fycml0b2AsXHJcbiAgICAgIHVwZGF0ZWQ6IGBDYW50aWRhZCBkZSAke3Byb2R1Y3QubmFtZX0gYWN0dWFsaXphZGEgZW4gZWwgY2Fycml0b2AsXHJcbiAgICAgIGluY3JlYXNlZDogYFNlIGFncmVnYXJvbiAke3F1YW50aXR5fSBtw6FzIGRlICR7cHJvZHVjdC5uYW1lfSBhbCBjYXJyaXRvYFxyXG4gICAgfVtvcGVyYXRpb25dO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGDinIUgQ2FydCBBZGQgQVBJOiAke3Jlc3BvbnNlTWVzc2FnZX0gLSBUb3RhbCBpdGVtczogJHt0b3RhbEl0ZW1zfWApO1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlTWVzc2FnZSxcclxuICAgICAgb3BlcmF0aW9uLFxyXG4gICAgICBpdGVtOiB7XHJcbiAgICAgICAgaWQ6IGNhcnRJdGVtLmlkLFxyXG4gICAgICAgIHByb2R1Y3RJZDogcHJvZHVjdC5pZCxcclxuICAgICAgICBwcm9kdWN0TmFtZTogcHJvZHVjdC5uYW1lLFxyXG4gICAgICAgIHF1YW50aXR5OiBjYXJ0SXRlbS5xdWFudGl0eSxcclxuICAgICAgICBwcmljZTogcHJvZHVjdC5kaXNjb3VudGVkX3ByaWNlIHx8IHByb2R1Y3QucHJpY2UsXHJcbiAgICAgICAgYWRkZWRRdWFudGl0eTogcXVhbnRpdHlcclxuICAgICAgfSxcclxuICAgICAgY2FydDoge1xyXG4gICAgICAgIHRvdGFsSXRlbXMsXHJcbiAgICAgICAgdG90YWxQcm9kdWN0c1xyXG4gICAgICB9LFxyXG4gICAgICBwcm9kdWN0OiB7XHJcbiAgICAgICAgaWQ6IHByb2R1Y3QuaWQsXHJcbiAgICAgICAgbmFtZTogcHJvZHVjdC5uYW1lLFxyXG4gICAgICAgIHByaWNlOiBwcm9kdWN0LnByaWNlLFxyXG4gICAgICAgIGRpc2NvdW50ZWRfcHJpY2U6IHByb2R1Y3QuZGlzY291bnRlZF9wcmljZSxcclxuICAgICAgICBpbWFnZXM6IHByb2R1Y3QuaW1hZ2VzLFxyXG4gICAgICAgIGJyYW5kOiBwcm9kdWN0LmJyYW5kLFxyXG4gICAgICAgIGNhdGVnb3J5OiBwcm9kdWN0LmNhdGVnb3J5XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfinYwgQ2FydCBBZGQgQVBJOiBFcnJvciBpbmVzcGVyYWRvOicsIGVycm9yKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXHJcbiAgICAgICAgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvci4gSW50ZW50YSBudWV2YW1lbnRlLicsXHJcbiAgICAgICAgZGV0YWlsczogZXJyb3IubWVzc2FnZSxcclxuICAgICAgICByZXRyeTogdHJ1ZVxyXG4gICAgICB9LCBcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEdFVCAvYXBpL2NhcnQvYWRkXHJcbiAqIEluZm9ybWFjacOzbiBzb2JyZSBjw7NtbyB1c2FyIGVzdGUgZW5kcG9pbnRcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoKSB7XHJcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgIGVuZHBvaW50OiAnL2FwaS9jYXJ0L2FkZCcsXHJcbiAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgIGRlc2NyaXB0aW9uOiAnQWdyZWdhciBwcm9kdWN0b3MgYWwgY2Fycml0byBkZSBjb21wcmFzJyxcclxuICAgIHBhcmFtZXRlcnM6IHtcclxuICAgICAgcHJvZHVjdElkOiAnbnVtYmVyIC0gSUQgZGVsIHByb2R1Y3RvIChyZXF1ZXJpZG8pJyxcclxuICAgICAgcXVhbnRpdHk6ICdudW1iZXIgLSBDYW50aWRhZCBhIGFncmVnYXIgKG9wY2lvbmFsLCBkZWZhdWx0OiAxKScsXHJcbiAgICAgIHJlcGxhY2U6ICdib29sZWFuIC0gU2kgdHJ1ZSwgcmVlbXBsYXphIGNhbnRpZGFkIGV4aXN0ZW50ZSAob3BjaW9uYWwsIGRlZmF1bHQ6IGZhbHNlKSdcclxuICAgIH0sXHJcbiAgICBleGFtcGxlOiB7XHJcbiAgICAgIHByb2R1Y3RJZDogMTIzLFxyXG4gICAgICBxdWFudGl0eTogMixcclxuICAgICAgcmVwbGFjZTogZmFsc2VcclxuICAgIH0sXHJcbiAgICBhdXRoZW50aWNhdGlvbjogJ1JlcXVlcmlkYSAtIFVzdWFyaW8gZGViZSBlc3RhciBhdXRlbnRpY2FkbycsXHJcbiAgICByZXNwb25zZXM6IHtcclxuICAgICAgMjAwOiAnUHJvZHVjdG8gYWdyZWdhZG8gZXhpdG9zYW1lbnRlJyxcclxuICAgICAgNDAwOiAnRGF0b3MgaW52w6FsaWRvcyBvIHN0b2NrIGluc3VmaWNpZW50ZScsXHJcbiAgICAgIDQwMTogJ1VzdWFyaW8gbm8gYXV0ZW50aWNhZG8nLFxyXG4gICAgICA0MDQ6ICdQcm9kdWN0byBubyBlbmNvbnRyYWRvJyxcclxuICAgICAgNTAwOiAnRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3InXHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQWlCc0I7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