{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\useCheckoutTransition.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useCallback, useEffect, useRef, useMemo } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\ninterface UseCheckoutTransitionOptions {\r\n  onTransitionStart?: () => void;\r\n  onTransitionComplete?: () => void;\r\n  onTransitionError?: (error: Error) => void;\r\n  enableAnimation?: boolean;\r\n  enablePerformanceTracking?: boolean;\r\n  customDuration?: number;\r\n  skipAnimationThreshold?: number;\r\n}\r\n\r\ninterface UseCheckoutTransitionReturn {\r\n  isTransitioning: boolean;\r\n  startTransition: () => void;\r\n  skipAnimation: boolean;\r\n  isButtonDisabled: boolean;\r\n  transitionProgress: number;\r\n  performanceMetrics: {\r\n    startTime: number | null;\r\n    endTime: number | null;\r\n    duration: number | null;\r\n  };\r\n}\r\n\r\ninterface PerformanceMetrics {\r\n  startTime: number | null;\r\n  endTime: number | null;\r\n  duration: number | null;\r\n}\r\n\r\n/**\r\n * Hook optimizado para manejar animaciones de transición al checkout\r\n *\r\n * Características Enterprise:\r\n * - Performance tracking con métricas detalladas\r\n * - Manejo robusto de errores y cleanup\r\n * - Respeta preferencias de accesibilidad (prefers-reduced-motion)\r\n * - Control granular sobre el estado del botón\r\n * - Callbacks para eventos de transición con error handling\r\n * - Optimización de memoria y prevención de memory leaks\r\n * - Soporte para testing con mocks\r\n */\r\nexport function useCheckoutTransition(\r\n  options: UseCheckoutTransitionOptions = {}\r\n): UseCheckoutTransitionReturn {\r\n\r\n  const {\r\n    onTransitionStart,\r\n    onTransitionComplete,\r\n    onTransitionError,\r\n    enableAnimation = true,\r\n    enablePerformanceTracking = true,\r\n    customDuration,\r\n    skipAnimationThreshold = 100,\r\n  } = options;\r\n\r\n  const router = useRouter();\r\n  const [isTransitioning, setIsTransitioning] = useState(false);\r\n  const [skipAnimation, setSkipAnimation] = useState(false);\r\n  const [transitionProgress, setTransitionProgress] = useState(0);\r\n\r\n  // Refs para cleanup y performance tracking\r\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const progressIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n  const performanceRef = useRef<PerformanceMetrics>({\r\n    startTime: null,\r\n    endTime: null,\r\n    duration: null,\r\n  });\r\n\r\n  // Memoizar duración para evitar recálculos\r\n  const animationDuration = useMemo(() => {\r\n    if (customDuration) {return customDuration;}\r\n    return skipAnimation ? 200 : 2800;\r\n  }, [skipAnimation, customDuration]);\r\n\r\n  // Detectar preferencia de movimiento reducido con mejor manejo de errores\r\n  useEffect(() => {\r\n    try {\r\n      const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\r\n\r\n      const handleChange = (e: MediaQueryListEvent) => {\r\n        const shouldSkip = e.matches || !enableAnimation;\r\n        setSkipAnimation(shouldSkip);\r\n\r\n        // Performance tracking para preferencias de accesibilidad\r\n        if (enablePerformanceTracking && shouldSkip) {\r\n          console.debug('[useCheckoutTransition] Animation skipped due to accessibility preferences');\r\n        }\r\n      };\r\n\r\n      // Configuración inicial\r\n      setSkipAnimation(mediaQuery.matches || !enableAnimation);\r\n\r\n      // Escuchar cambios con soporte para navegadores antiguos\r\n      if (mediaQuery.addEventListener) {\r\n        mediaQuery.addEventListener(\"change\", handleChange);\r\n      } else {\r\n        // Fallback para navegadores antiguos\r\n        mediaQuery.addListener(handleChange);\r\n      }\r\n\r\n      return () => {\r\n        if (mediaQuery.removeEventListener) {\r\n          mediaQuery.removeEventListener(\"change\", handleChange);\r\n        } else {\r\n          mediaQuery.removeListener(handleChange);\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.warn('[useCheckoutTransition] Error setting up media query listener:', error);\r\n      setSkipAnimation(!enableAnimation);\r\n    }\r\n  }, [enableAnimation, enablePerformanceTracking]);\r\n\r\n  // Cleanup en unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n      if (progressIntervalRef.current) {\r\n        clearInterval(progressIntervalRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Función optimizada para iniciar la transición\r\n  const startTransition = useCallback(() => {\r\n    if (isTransitioning) {\r\n      console.warn('[useCheckoutTransition] Transition already in progress, ignoring duplicate call');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Performance tracking\r\n      const startTime = enablePerformanceTracking ? performance.now() : 0;\r\n      performanceRef.current.startTime = startTime;\r\n\r\n      setIsTransitioning(true);\r\n      setTransitionProgress(0);\r\n\r\n      // Callback de inicio con error handling\r\n      try {\r\n        onTransitionStart?.();\r\n      } catch (error) {\r\n        console.error('[useCheckoutTransition] Error in onTransitionStart callback:', error);\r\n        onTransitionError?.(error as Error);\r\n      }\r\n\r\n      // Progress tracking para animaciones largas\r\n      if (!skipAnimation && animationDuration > skipAnimationThreshold) {\r\n        const progressInterval = setInterval(() => {\r\n          setTransitionProgress(prev => {\r\n            const elapsed = performance.now() - startTime;\r\n            const progress = Math.min((elapsed / animationDuration) * 100, 100);\r\n            return progress;\r\n          });\r\n        }, 16); // 60fps updates\r\n\r\n        progressIntervalRef.current = progressInterval;\r\n      }\r\n\r\n      // Auto-reset con cleanup mejorado\r\n      const timeout = setTimeout(() => {\r\n        try {\r\n          const endTime = enablePerformanceTracking ? performance.now() : 0;\r\n          performanceRef.current.endTime = endTime;\r\n          performanceRef.current.duration = endTime - startTime;\r\n\r\n          setIsTransitioning(false);\r\n          setTransitionProgress(100);\r\n\r\n          // Cleanup progress interval\r\n          if (progressIntervalRef.current) {\r\n            clearInterval(progressIntervalRef.current);\r\n            progressIntervalRef.current = null;\r\n          }\r\n\r\n          // Performance logging\r\n          if (enablePerformanceTracking) {\r\n            console.debug('[useCheckoutTransition] Transition completed', {\r\n              duration: performanceRef.current.duration,\r\n              skipAnimation,\r\n              animationDuration,\r\n            });\r\n          }\r\n\r\n          // Callback de finalización con error handling\r\n          try {\r\n            onTransitionComplete?.();\r\n          } catch (error) {\r\n            console.error('[useCheckoutTransition] Error in onTransitionComplete callback:', error);\r\n            onTransitionError?.(error as Error);\r\n          }\r\n\r\n          // Navegación con error handling\r\n          try {\r\n            router.push('/checkout');\r\n          } catch (error) {\r\n            console.error('[useCheckoutTransition] Error during navigation:', error);\r\n            onTransitionError?.(error as Error);\r\n          }\r\n\r\n        } catch (error) {\r\n          console.error('[useCheckoutTransition] Error during transition completion:', error);\r\n          onTransitionError?.(error as Error);\r\n          setIsTransitioning(false);\r\n        }\r\n      }, animationDuration);\r\n\r\n      timeoutRef.current = timeout;\r\n\r\n    } catch (error) {\r\n      console.error('[useCheckoutTransition] Error starting transition:', error);\r\n      onTransitionError?.(error as Error);\r\n      setIsTransitioning(false);\r\n    }\r\n  }, [\r\n    isTransitioning,\r\n    skipAnimation,\r\n    animationDuration,\r\n    skipAnimationThreshold,\r\n    enablePerformanceTracking,\r\n    onTransitionStart,\r\n    onTransitionComplete,\r\n    onTransitionError,\r\n    router\r\n  ]);\r\n\r\n  return {\r\n    isTransitioning,\r\n    startTransition,\r\n    skipAnimation,\r\n    isButtonDisabled: isTransitioning,\r\n    transitionProgress,\r\n    performanceMetrics: performanceRef.current,\r\n  };\r\n}\r\n\r\nexport default useCheckoutTransition;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["useCheckoutTransition","options","onTransitionStart","onTransitionComplete","onTransitionError","enableAnimation","enablePerformanceTracking","customDuration","skipAnimationThreshold","router","useRouter","isTransitioning","setIsTransitioning","useState","skipAnimation","setSkipAnimation","transitionProgress","setTransitionProgress","timeoutRef","useRef","progressIntervalRef","performanceRef","startTime","endTime","duration","animationDuration","useMemo","useEffect","mediaQuery","window","matchMedia","handleChange","e","shouldSkip","matches","console","debug","addEventListener","addListener","removeEventListener","removeListener","error","warn","current","clearTimeout","clearInterval","startTransition","useCallback","performance","now","progressInterval","setInterval","prev","elapsed","progress","Math","min","timeout","setTimeout","push","isButtonDisabled","performanceMetrics"],"mappings":"AAAA;;;;;;;;;;;;QAoPA;eAAA;;QAtMgBA;eAAAA;;;uBA5CkD;4BACxC;AA2CnB,SAASA,sBACdC,UAAwC,CAAC,CAAC;IAG1C,MAAM,EACJC,iBAAiB,EACjBC,oBAAoB,EACpBC,iBAAiB,EACjBC,kBAAkB,IAAI,EACtBC,4BAA4B,IAAI,EAChCC,cAAc,EACdC,yBAAyB,GAAG,EAC7B,GAAGP;IAEJ,MAAMQ,SAASC,IAAAA,qBAAS;IACxB,MAAM,CAACC,iBAAiBC,mBAAmB,GAAGC,IAAAA,eAAQ,EAAC;IACvD,MAAM,CAACC,eAAeC,iBAAiB,GAAGF,IAAAA,eAAQ,EAAC;IACnD,MAAM,CAACG,oBAAoBC,sBAAsB,GAAGJ,IAAAA,eAAQ,EAAC;IAE7D,2CAA2C;IAC3C,MAAMK,aAAaC,IAAAA,aAAM,EAAwB;IACjD,MAAMC,sBAAsBD,IAAAA,aAAM,EAAwB;IAC1D,MAAME,iBAAiBF,IAAAA,aAAM,EAAqB;QAChDG,WAAW;QACXC,SAAS;QACTC,UAAU;IACZ;IAEA,2CAA2C;IAC3C,MAAMC,oBAAoBC,IAAAA,cAAO,EAAC;QAChC,IAAInB,gBAAgB;YAAC,OAAOA;QAAe;QAC3C,OAAOO,gBAAgB,MAAM;IAC/B,GAAG;QAACA;QAAeP;KAAe;IAElC,0EAA0E;IAC1EoB,IAAAA,gBAAS,EAAC;QACR,IAAI;YACF,MAAMC,aAAaC,OAAOC,UAAU,CAAC;YAErC,MAAMC,eAAe,CAACC;gBACpB,MAAMC,aAAaD,EAAEE,OAAO,IAAI,CAAC7B;gBACjCU,iBAAiBkB;gBAEjB,0DAA0D;gBAC1D,IAAI3B,6BAA6B2B,YAAY;oBAC3CE,QAAQC,KAAK,CAAC;gBAChB;YACF;YAEA,wBAAwB;YACxBrB,iBAAiBa,WAAWM,OAAO,IAAI,CAAC7B;YAExC,yDAAyD;YACzD,IAAIuB,WAAWS,gBAAgB,EAAE;gBAC/BT,WAAWS,gBAAgB,CAAC,UAAUN;YACxC,OAAO;gBACL,qCAAqC;gBACrCH,WAAWU,WAAW,CAACP;YACzB;YAEA,OAAO;gBACL,IAAIH,WAAWW,mBAAmB,EAAE;oBAClCX,WAAWW,mBAAmB,CAAC,UAAUR;gBAC3C,OAAO;oBACLH,WAAWY,cAAc,CAACT;gBAC5B;YACF;QACF,EAAE,OAAOU,OAAO;YACdN,QAAQO,IAAI,CAAC,kEAAkED;YAC/E1B,iBAAiB,CAACV;QACpB;IACF,GAAG;QAACA;QAAiBC;KAA0B;IAE/C,qBAAqB;IACrBqB,IAAAA,gBAAS,EAAC;QACR,OAAO;YACL,IAAIT,WAAWyB,OAAO,EAAE;gBACtBC,aAAa1B,WAAWyB,OAAO;YACjC;YACA,IAAIvB,oBAAoBuB,OAAO,EAAE;gBAC/BE,cAAczB,oBAAoBuB,OAAO;YAC3C;QACF;IACF,GAAG,EAAE;IAEL,gDAAgD;IAChD,MAAMG,kBAAkBC,IAAAA,kBAAW,EAAC;QAClC,IAAIpC,iBAAiB;YACnBwB,QAAQO,IAAI,CAAC;YACb;QACF;QAEA,IAAI;YACF,uBAAuB;YACvB,MAAMpB,YAAYhB,4BAA4B0C,YAAYC,GAAG,KAAK;YAClE5B,eAAesB,OAAO,CAACrB,SAAS,GAAGA;YAEnCV,mBAAmB;YACnBK,sBAAsB;YAEtB,wCAAwC;YACxC,IAAI;gBACFf;YACF,EAAE,OAAOuC,OAAO;gBACdN,QAAQM,KAAK,CAAC,gEAAgEA;gBAC9ErC,oBAAoBqC;YACtB;YAEA,4CAA4C;YAC5C,IAAI,CAAC3B,iBAAiBW,oBAAoBjB,wBAAwB;gBAChE,MAAM0C,mBAAmBC,YAAY;oBACnClC,sBAAsBmC,CAAAA;wBACpB,MAAMC,UAAUL,YAAYC,GAAG,KAAK3B;wBACpC,MAAMgC,WAAWC,KAAKC,GAAG,CAAC,AAACH,UAAU5B,oBAAqB,KAAK;wBAC/D,OAAO6B;oBACT;gBACF,GAAG,KAAK,gBAAgB;gBAExBlC,oBAAoBuB,OAAO,GAAGO;YAChC;YAEA,kCAAkC;YAClC,MAAMO,UAAUC,WAAW;gBACzB,IAAI;oBACF,MAAMnC,UAAUjB,4BAA4B0C,YAAYC,GAAG,KAAK;oBAChE5B,eAAesB,OAAO,CAACpB,OAAO,GAAGA;oBACjCF,eAAesB,OAAO,CAACnB,QAAQ,GAAGD,UAAUD;oBAE5CV,mBAAmB;oBACnBK,sBAAsB;oBAEtB,4BAA4B;oBAC5B,IAAIG,oBAAoBuB,OAAO,EAAE;wBAC/BE,cAAczB,oBAAoBuB,OAAO;wBACzCvB,oBAAoBuB,OAAO,GAAG;oBAChC;oBAEA,sBAAsB;oBACtB,IAAIrC,2BAA2B;wBAC7B6B,QAAQC,KAAK,CAAC,gDAAgD;4BAC5DZ,UAAUH,eAAesB,OAAO,CAACnB,QAAQ;4BACzCV;4BACAW;wBACF;oBACF;oBAEA,8CAA8C;oBAC9C,IAAI;wBACFtB;oBACF,EAAE,OAAOsC,OAAO;wBACdN,QAAQM,KAAK,CAAC,mEAAmEA;wBACjFrC,oBAAoBqC;oBACtB;oBAEA,gCAAgC;oBAChC,IAAI;wBACFhC,OAAOkD,IAAI,CAAC;oBACd,EAAE,OAAOlB,OAAO;wBACdN,QAAQM,KAAK,CAAC,oDAAoDA;wBAClErC,oBAAoBqC;oBACtB;gBAEF,EAAE,OAAOA,OAAO;oBACdN,QAAQM,KAAK,CAAC,+DAA+DA;oBAC7ErC,oBAAoBqC;oBACpB7B,mBAAmB;gBACrB;YACF,GAAGa;YAEHP,WAAWyB,OAAO,GAAGc;QAEvB,EAAE,OAAOhB,OAAO;YACdN,QAAQM,KAAK,CAAC,sDAAsDA;YACpErC,oBAAoBqC;YACpB7B,mBAAmB;QACrB;IACF,GAAG;QACDD;QACAG;QACAW;QACAjB;QACAF;QACAJ;QACAC;QACAC;QACAK;KACD;IAED,OAAO;QACLE;QACAmC;QACAhC;QACA8C,kBAAkBjD;QAClBK;QACA6C,oBAAoBxC,eAAesB,OAAO;IAC5C;AACF;MAEA,WAAe3C"}