{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\hooks\\useAuth.test.tsx"],"sourcesContent":["// ===================================\r\n// TESTS PARA HOOK DE AUTENTICACIÓN\r\n// Tests unitarios e integración para useAuth\r\n// ===================================\r\n\r\nimport { renderHook, act, waitFor } from '@testing-library/react';\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport { useAuth } from '@/hooks/useAuth';\r\nimport { useSession, signIn, signOut } from 'next-auth/react';\r\nimport { toast } from 'sonner';\r\nimport { useRouter } from 'next/navigation';\r\nimport React from 'react';\r\n\r\n// Mocks\r\njest.mock('next-auth/react');\r\njest.mock('sonner', () => ({\r\n  toast: {\r\n    success: jest.fn(),\r\n    error: jest.fn(),\r\n    loading: jest.fn()\r\n  }\r\n}));\r\n\r\njest.mock('next/navigation', () => ({\r\n  useRouter: jest.fn()\r\n}));\r\n\r\nconst mockRouter = {\r\n  push: jest.fn(),\r\n  replace: jest.fn(),\r\n  refresh: jest.fn()\r\n};\r\n\r\n// Wrapper para React Query\r\nconst createWrapper = () => {\r\n  const queryClient = new QueryClient({\r\n    defaultOptions: {\r\n      queries: {\r\n        retry: false,\r\n      },\r\n    },\r\n  });\r\n  \r\n  return ({ children }: { children: React.ReactNode }) => (\r\n    <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n  );\r\n};\r\n\r\ndescribe('useAuth Hook', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    (useRouter as jest.Mock).mockReturnValue(mockRouter);\r\n    \r\n    // Mock default NextAuth session\r\n    (useSession as jest.Mock).mockReturnValue({\r\n      data: {\r\n        user: {\r\n          id: 'test-user-id',\r\n          email: 'test@example.com',\r\n          name: 'Test User',\r\n          image: 'https://example.com/avatar.jpg',\r\n        },\r\n        expires: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),\r\n      },\r\n      status: 'authenticated',\r\n    });\r\n  });\r\n\r\n  describe('Autenticación con NextAuth', () => {\r\n    it('debe iniciar sesión exitosamente', async () => {\r\n      (signIn as jest.Mock).mockResolvedValue({ ok: true, error: null });\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper()\r\n      });\r\n\r\n      await act(async () => {\r\n        await result.current.signIn('google', { callbackUrl: '/dashboard' });\r\n      });\r\n\r\n      expect(signIn).toHaveBeenCalledWith('google', {\r\n        callbackUrl: '/dashboard',\r\n        redirect: true,\r\n      });\r\n    });\r\n\r\n    it('debe cerrar sesión exitosamente', async () => {\r\n      (signOut as jest.Mock).mockResolvedValue({ url: '/api/auth/signin' });\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper()\r\n      });\r\n\r\n      await act(async () => {\r\n        await result.current.signOut({ callbackUrl: '/' });\r\n      });\r\n\r\n      expect(signOut).toHaveBeenCalledWith({\r\n        callbackUrl: '/',\r\n        redirect: true,\r\n      });\r\n    });\r\n\r\n    it('debe retornar información del usuario autenticado', () => {\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper()\r\n      });\r\n\r\n      expect(result.current.user).toEqual({\r\n        id: 'test-user-id',\r\n        email: 'test@example.com',\r\n        name: 'Test User',\r\n        image: 'https://example.com/avatar.jpg',\r\n      });\r\n      expect(result.current.isSignedIn).toBe(true);\r\n      expect(result.current.isLoaded).toBe(true);\r\n    });\r\n\r\n    it('debe manejar estado de carga', () => {\r\n      (useSession as jest.Mock).mockReturnValue({\r\n        data: null,\r\n        status: 'loading',\r\n      });\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper()\r\n      });\r\n\r\n      expect(result.current.isLoaded).toBe(false);\r\n      expect(result.current.isSignedIn).toBe(false);\r\n      expect(result.current.user).toBeNull();\r\n    });\r\n\r\n    it('debe manejar estado no autenticado', () => {\r\n      (useSession as jest.Mock).mockReturnValue({\r\n        data: null,\r\n        status: 'unauthenticated',\r\n      });\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper()\r\n      });\r\n\r\n      expect(result.current.isLoaded).toBe(true);\r\n      expect(result.current.isSignedIn).toBe(false);\r\n      expect(result.current.user).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('Hooks de utilidad', () => {\r\n    it('useIsAdmin debe retornar false para usuario normal', () => {\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper()\r\n      });\r\n\r\n      // useIsAdmin está incluido en el hook useAuth\r\n      expect(result.current.user?.email).toBe('test@example.com');\r\n    });\r\n\r\n    it('useRequireAuth debe redirigir si no está autenticado', async () => {\r\n      (useSession as jest.Mock).mockReturnValue({\r\n        data: null,\r\n        status: 'unauthenticated',\r\n      });\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper()\r\n      });\r\n\r\n      expect(result.current.isSignedIn).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('Manejo de errores', () => {\r\n    it('debe manejar error en signIn', async () => {\r\n      (signIn as jest.Mock).mockResolvedValue({ ok: false, error: 'Authentication failed' });\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper()\r\n      });\r\n\r\n      await act(async () => {\r\n        await result.current.signIn('google');\r\n      });\r\n\r\n      expect(signIn).toHaveBeenCalledWith('google', {\r\n        callbackUrl: '/admin',\r\n        redirect: true,\r\n      });\r\n    });\r\n\r\n    it('debe manejar error en signOut', async () => {\r\n      (signOut as jest.Mock).mockRejectedValue(new Error('Sign out failed'));\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper()\r\n      });\r\n\r\n      await act(async () => {\r\n        try {\r\n          await result.current.signOut();\r\n        } catch (error) {\r\n          expect(error).toBeInstanceOf(Error);\r\n        }\r\n      });\r\n\r\n      expect(signOut).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Integración con Router', () => {\r\n    it('debe usar el router correctamente', () => {\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper()\r\n      });\r\n\r\n      // El hook debe tener acceso al router\r\n      expect(result.current).toBeDefined();\r\n      expect(typeof result.current.signIn).toBe('function');\r\n      expect(typeof result.current.signOut).toBe('function');\r\n    });\r\n  });\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["jest","mock","toast","success","fn","error","loading","useRouter","mockRouter","push","replace","refresh","createWrapper","queryClient","QueryClient","defaultOptions","queries","retry","children","QueryClientProvider","client","describe","beforeEach","clearAllMocks","mockReturnValue","useSession","data","user","id","email","name","image","expires","Date","now","toISOString","status","it","signIn","mockResolvedValue","ok","result","renderHook","useAuth","wrapper","act","current","callbackUrl","expect","toHaveBeenCalledWith","redirect","signOut","url","toEqual","isSignedIn","toBe","isLoaded","toBeNull","mockRejectedValue","Error","toBeInstanceOf","toHaveBeenCalled","toBeDefined"],"mappings":"AAAA,sCAAsC;AACtC,mCAAmC;AACnC,6CAA6C;AAC7C,sCAAsC;;AAUtC,QAAQ;AACRA,KAAKC,IAAI,CAAC;AACVD,KAAKC,IAAI,CAAC,UAAU,IAAO,CAAA;QACzBC,OAAO;YACLC,SAASH,KAAKI,EAAE;YAChBC,OAAOL,KAAKI,EAAE;YACdE,SAASN,KAAKI,EAAE;QAClB;IACF,CAAA;AAEAJ,KAAKC,IAAI,CAAC,mBAAmB,IAAO,CAAA;QAClCM,WAAWP,KAAKI,EAAE;IACpB,CAAA;;;;;uBApByC;4BACQ;yBACzB;wBACoB;4BAElB;+DACR;;;;;;AAgBlB,MAAMI,aAAa;IACjBC,MAAMT,KAAKI,EAAE;IACbM,SAASV,KAAKI,EAAE;IAChBO,SAASX,KAAKI,EAAE;AAClB;AAEA,2BAA2B;AAC3B,MAAMQ,gBAAgB;IACpB,MAAMC,cAAc,IAAIC,uBAAW,CAAC;QAClCC,gBAAgB;YACdC,SAAS;gBACPC,OAAO;YACT;QACF;IACF;IAEA,OAAO,CAAC,EAAEC,QAAQ,EAAiC,iBACjD,qBAACC,+BAAmB;YAACC,QAAQP;sBAAcK;;AAE/C;AAEAG,SAAS,gBAAgB;IACvBC,WAAW;QACTtB,KAAKuB,aAAa;QACjBhB,qBAAS,CAAeiB,eAAe,CAAChB;QAEzC,gCAAgC;QAC/BiB,kBAAU,CAAeD,eAAe,CAAC;YACxCE,MAAM;gBACJC,MAAM;oBACJC,IAAI;oBACJC,OAAO;oBACPC,MAAM;oBACNC,OAAO;gBACT;gBACAC,SAAS,IAAIC,KAAKA,KAAKC,GAAG,KAAK,KAAK,KAAK,KAAK,MAAMC,WAAW;YACjE;YACAC,QAAQ;QACV;IACF;IAEAf,SAAS,8BAA8B;QACrCgB,GAAG,oCAAoC;YACpCC,cAAM,CAAeC,iBAAiB,CAAC;gBAAEC,IAAI;gBAAMnC,OAAO;YAAK;YAEhE,MAAM,EAAEoC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,gBAAO,KAAI;gBAC7CC,SAAShC;YACX;YAEA,MAAMiC,IAAAA,UAAG,EAAC;gBACR,MAAMJ,OAAOK,OAAO,CAACR,MAAM,CAAC,UAAU;oBAAES,aAAa;gBAAa;YACpE;YAEAC,OAAOV,cAAM,EAAEW,oBAAoB,CAAC,UAAU;gBAC5CF,aAAa;gBACbG,UAAU;YACZ;QACF;QAEAb,GAAG,mCAAmC;YACnCc,eAAO,CAAeZ,iBAAiB,CAAC;gBAAEa,KAAK;YAAmB;YAEnE,MAAM,EAAEX,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,gBAAO,KAAI;gBAC7CC,SAAShC;YACX;YAEA,MAAMiC,IAAAA,UAAG,EAAC;gBACR,MAAMJ,OAAOK,OAAO,CAACK,OAAO,CAAC;oBAAEJ,aAAa;gBAAI;YAClD;YAEAC,OAAOG,eAAO,EAAEF,oBAAoB,CAAC;gBACnCF,aAAa;gBACbG,UAAU;YACZ;QACF;QAEAb,GAAG,qDAAqD;YACtD,MAAM,EAAEI,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,gBAAO,KAAI;gBAC7CC,SAAShC;YACX;YAEAoC,OAAOP,OAAOK,OAAO,CAACnB,IAAI,EAAE0B,OAAO,CAAC;gBAClCzB,IAAI;gBACJC,OAAO;gBACPC,MAAM;gBACNC,OAAO;YACT;YACAiB,OAAOP,OAAOK,OAAO,CAACQ,UAAU,EAAEC,IAAI,CAAC;YACvCP,OAAOP,OAAOK,OAAO,CAACU,QAAQ,EAAED,IAAI,CAAC;QACvC;QAEAlB,GAAG,gCAAgC;YAChCZ,kBAAU,CAAeD,eAAe,CAAC;gBACxCE,MAAM;gBACNU,QAAQ;YACV;YAEA,MAAM,EAAEK,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,gBAAO,KAAI;gBAC7CC,SAAShC;YACX;YAEAoC,OAAOP,OAAOK,OAAO,CAACU,QAAQ,EAAED,IAAI,CAAC;YACrCP,OAAOP,OAAOK,OAAO,CAACQ,UAAU,EAAEC,IAAI,CAAC;YACvCP,OAAOP,OAAOK,OAAO,CAACnB,IAAI,EAAE8B,QAAQ;QACtC;QAEApB,GAAG,sCAAsC;YACtCZ,kBAAU,CAAeD,eAAe,CAAC;gBACxCE,MAAM;gBACNU,QAAQ;YACV;YAEA,MAAM,EAAEK,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,gBAAO,KAAI;gBAC7CC,SAAShC;YACX;YAEAoC,OAAOP,OAAOK,OAAO,CAACU,QAAQ,EAAED,IAAI,CAAC;YACrCP,OAAOP,OAAOK,OAAO,CAACQ,UAAU,EAAEC,IAAI,CAAC;YACvCP,OAAOP,OAAOK,OAAO,CAACnB,IAAI,EAAE8B,QAAQ;QACtC;IACF;IAEApC,SAAS,qBAAqB;QAC5BgB,GAAG,sDAAsD;YACvD,MAAM,EAAEI,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,gBAAO,KAAI;gBAC7CC,SAAShC;YACX;YAEA,8CAA8C;YAC9CoC,OAAOP,OAAOK,OAAO,CAACnB,IAAI,EAAEE,OAAO0B,IAAI,CAAC;QAC1C;QAEAlB,GAAG,wDAAwD;YACxDZ,kBAAU,CAAeD,eAAe,CAAC;gBACxCE,MAAM;gBACNU,QAAQ;YACV;YAEA,MAAM,EAAEK,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,gBAAO,KAAI;gBAC7CC,SAAShC;YACX;YAEAoC,OAAOP,OAAOK,OAAO,CAACQ,UAAU,EAAEC,IAAI,CAAC;QACzC;IACF;IAEAlC,SAAS,qBAAqB;QAC5BgB,GAAG,gCAAgC;YAChCC,cAAM,CAAeC,iBAAiB,CAAC;gBAAEC,IAAI;gBAAOnC,OAAO;YAAwB;YAEpF,MAAM,EAAEoC,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,gBAAO,KAAI;gBAC7CC,SAAShC;YACX;YAEA,MAAMiC,IAAAA,UAAG,EAAC;gBACR,MAAMJ,OAAOK,OAAO,CAACR,MAAM,CAAC;YAC9B;YAEAU,OAAOV,cAAM,EAAEW,oBAAoB,CAAC,UAAU;gBAC5CF,aAAa;gBACbG,UAAU;YACZ;QACF;QAEAb,GAAG,iCAAiC;YACjCc,eAAO,CAAeO,iBAAiB,CAAC,IAAIC,MAAM;YAEnD,MAAM,EAAElB,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,gBAAO,KAAI;gBAC7CC,SAAShC;YACX;YAEA,MAAMiC,IAAAA,UAAG,EAAC;gBACR,IAAI;oBACF,MAAMJ,OAAOK,OAAO,CAACK,OAAO;gBAC9B,EAAE,OAAO9C,OAAO;oBACd2C,OAAO3C,OAAOuD,cAAc,CAACD;gBAC/B;YACF;YAEAX,OAAOG,eAAO,EAAEU,gBAAgB;QAClC;IACF;IAEAxC,SAAS,0BAA0B;QACjCgB,GAAG,qCAAqC;YACtC,MAAM,EAAEI,MAAM,EAAE,GAAGC,IAAAA,iBAAU,EAAC,IAAMC,IAAAA,gBAAO,KAAI;gBAC7CC,SAAShC;YACX;YAEA,sCAAsC;YACtCoC,OAAOP,OAAOK,OAAO,EAAEgB,WAAW;YAClCd,OAAO,OAAOP,OAAOK,OAAO,CAACR,MAAM,EAAEiB,IAAI,CAAC;YAC1CP,OAAO,OAAOP,OAAOK,OAAO,CAACK,OAAO,EAAEI,IAAI,CAAC;QAC7C;IACF;AACF"}