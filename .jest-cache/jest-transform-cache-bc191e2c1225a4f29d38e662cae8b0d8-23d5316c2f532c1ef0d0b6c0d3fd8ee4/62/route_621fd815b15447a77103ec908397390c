98a9e9f080f18cece3186828feaaff14
// Configuración para Node.js Runtime
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get GET () {
        return GET;
    },
    get POST () {
        return POST;
    },
    get runtime () {
        return runtime;
    }
});
const _server = require("next/server");
const _supabase = require("../../../../lib/integrations/supabase");
const _ratelimiter = require("../../../../lib/rate-limiting/rate-limiter");
const _apitimeouts = require("../../../../lib/config/api-timeouts");
const _securitylogger = require("../../../../lib/logging/security-logger");
const runtime = 'nodejs';
// Búsquedas trending generadas dinámicamente basadas en productos reales
async function generateDynamicTrendingSearches(supabase, limit = 6) {
    try {
        // Obtener productos más populares y marcas para generar búsquedas trending realistas
        const { data: products, error: productsError } = await supabase.from('products').select('name, brand, category_id, categories(name)').eq('is_active', true).limit(20);
        if (productsError || !products) {
            console.warn('Error obteniendo productos para trending:', productsError);
            return getFallbackTrendingSearches(limit);
        }
        // Generar búsquedas trending basadas en productos reales
        const trendingSearches = [];
        const usedQueries = new Set();
        // Agregar búsquedas por marca
        const brands = [
            ...new Set(products.map((p)=>p.brand).filter(Boolean))
        ];
        brands.slice(0, 2).forEach((brand, index)=>{
            if (brand && !usedQueries.has(brand.toLowerCase())) {
                trendingSearches.push({
                    id: `trending-brand-${index + 1}`,
                    query: brand,
                    count: Math.floor(Math.random() * 50) + 20,
                    category: "marcas",
                    href: `/search?q=${encodeURIComponent(brand)}`,
                    type: "trending"
                });
                usedQueries.add(brand.toLowerCase());
            }
        });
        // Agregar búsquedas por categoría
        const categories = [
            ...new Set(products.map((p)=>p.categories?.name).filter(Boolean))
        ];
        categories.slice(0, 2).forEach((category, index)=>{
            if (category && !usedQueries.has(category.toLowerCase())) {
                trendingSearches.push({
                    id: `trending-category-${index + 1}`,
                    query: category,
                    count: Math.floor(Math.random() * 40) + 15,
                    category: "pinturas",
                    href: `/search?q=${encodeURIComponent(category)}`,
                    type: "trending"
                });
                usedQueries.add(category.toLowerCase());
            }
        });
        // Agregar búsquedas por productos específicos
        const popularProducts = products.slice(0, 2);
        popularProducts.forEach((product, index)=>{
            const productName = product.name;
            if (productName && !usedQueries.has(productName.toLowerCase())) {
                trendingSearches.push({
                    id: `trending-product-${index + 1}`,
                    query: productName,
                    count: Math.floor(Math.random() * 30) + 10,
                    category: "productos",
                    href: `/search?q=${encodeURIComponent(productName)}`,
                    type: "trending"
                });
                usedQueries.add(productName.toLowerCase());
            }
        });
        // Ordenar por count descendente y limitar
        return trendingSearches.sort((a, b)=>b.count - a.count).slice(0, limit);
    } catch (error) {
        console.error('Error generando trending searches dinámicas:', error);
        return getFallbackTrendingSearches(limit);
    }
}
// Fallback con datos mínimos (solo si falla todo lo demás)
function getFallbackTrendingSearches(limit = 6) {
    const fallbackSearches = [
        {
            query: "Pintura",
            category: "pinturas"
        },
        {
            query: "Esmalte",
            category: "pinturas"
        },
        {
            query: "Látex",
            category: "pinturas"
        },
        {
            query: "Barniz",
            category: "pinturas"
        },
        {
            query: "Imprimación",
            category: "pinturas"
        },
        {
            query: "Rodillos",
            category: "herramientas"
        }
    ];
    return fallbackSearches.slice(0, limit).map((search, index)=>({
            id: `fallback-${index + 1}`,
            query: search.query,
            count: Math.floor(Math.random() * 20) + 5,
            category: search.category,
            href: `/search?q=${encodeURIComponent(search.query.toLowerCase())}`,
            type: "trending"
        }));
}
async function GET(request) {
    // Crear logger de seguridad con contexto
    const securityLogger = (0, _securitylogger.createSecurityLogger)(request);
    // Aplicar rate limiting para APIs de búsqueda
    const rateLimitResult = await (0, _ratelimiter.withRateLimit)(request, _ratelimiter.RATE_LIMIT_CONFIGS.search, async ()=>{
        // Log de acceso a la API
        securityLogger.log({
            type: 'data_access',
            severity: 'low',
            message: 'Trending search API accessed',
            context: securityLogger.context,
            metadata: {
                endpoint: '/api/search/trending',
                method: 'GET',
                userAgent: request.headers.get('user-agent')
            }
        });
        try {
            const { searchParams } = new URL(request.url);
            const limit = parseInt(searchParams.get('limit') || '6');
            const days = parseInt(searchParams.get('days') || '7');
            const category = searchParams.get('category');
            console.log('🔥 API /api/search/trending: Obteniendo búsquedas trending', {
                limit,
                days,
                category
            });
            const supabase = (0, _supabase.getSupabaseClient)();
            let trendingSearches = [];
            // Intentar obtener búsquedas trending reales del sistema de analytics
            if (supabase) {
                try {
                    const startDate = new Date();
                    startDate.setDate(startDate.getDate() - days);
                    // Query para obtener búsquedas más populares de analytics_events
                    let query = supabase.from('analytics_events').select('label, metadata').eq('category', 'search').eq('action', 'search_query').gte('created_at', startDate.toISOString()).not('label', 'is', null);
                    if (category) {
                        query = query.eq('metadata->>category', category);
                    }
                    const { data: analyticsData, error } = await (0, _apitimeouts.withDatabaseTimeout)(async (signal)=>await query, _apitimeouts.API_TIMEOUTS.database);
                    if (!error && analyticsData && analyticsData.length > 0) {
                        // Procesar datos de analytics para obtener trending
                        const searchCounts = new Map();
                        const searchCategories = new Map();
                        analyticsData.forEach((event)=>{
                            if (event.label) {
                                const query = event.label.toLowerCase().trim();
                                if (query.length > 2) {
                                    searchCounts.set(query, (searchCounts.get(query) || 0) + 1);
                                    // Extraer categoría del metadata si existe
                                    if (event.metadata && event.metadata.category) {
                                        searchCategories.set(query, event.metadata.category);
                                    }
                                }
                            }
                        });
                        // Convertir a array y ordenar por popularidad
                        const sortedSearches = Array.from(searchCounts.entries()).sort((a, b)=>b[1] - a[1]).slice(0, limit);
                        trendingSearches = sortedSearches.map(([query, count], index)=>({
                                id: `trending-real-${index + 1}`,
                                query: query.charAt(0).toUpperCase() + query.slice(1),
                                count,
                                category: searchCategories.get(query),
                                href: `/search?q=${encodeURIComponent(query)}`,
                                type: 'trending'
                            }));
                    }
                } catch (analyticsError) {
                    console.warn('⚠️ Error obteniendo trending de analytics, usando fallback:', analyticsError);
                }
            }
            // Si no hay datos reales o hay pocos, generar dinámicamente
            if (trendingSearches.length < 3) {
                console.log('🔄 Generando búsquedas trending dinámicas desde productos');
                try {
                    const dynamicSearches = await generateDynamicTrendingSearches(supabase, limit);
                    // Filtrar por categoría si se especifica
                    let filteredSearches = dynamicSearches;
                    if (category) {
                        filteredSearches = dynamicSearches.filter((search)=>search.category === category);
                    }
                    // Combinar datos reales con dinámicos si es necesario
                    const needed = limit - trendingSearches.length;
                    const additionalSearches = filteredSearches.slice(0, needed);
                    trendingSearches = [
                        ...trendingSearches,
                        ...additionalSearches
                    ];
                } catch (error) {
                    console.error('Error generando trending dinámicas, usando fallback:', error);
                    const fallbackSearches = getFallbackTrendingSearches(limit - trendingSearches.length);
                    trendingSearches = [
                        ...trendingSearches,
                        ...fallbackSearches
                    ];
                }
            }
            // Limitar al número solicitado
            trendingSearches = trendingSearches.slice(0, limit);
            const response = {
                data: {
                    trending: trendingSearches,
                    lastUpdated: new Date().toISOString()
                },
                success: true
            };
            console.log('🔥 Trending searches response:', {
                count: trendingSearches.length,
                hasRealData: trendingSearches.some((s)=>s.id.includes('real')),
                categories: [
                    ...new Set(trendingSearches.map((s)=>s.category).filter(Boolean))
                ]
            });
            // Log de operación exitosa
            securityLogger.log({
                type: 'data_access',
                severity: 'low',
                message: 'Trending searches retrieved successfully',
                context: securityLogger.context,
                metadata: {
                    searchesCount: trendingSearches.length,
                    limit: limit,
                    days: days,
                    category: category
                }
            });
            return _server.NextResponse.json(response);
        } catch (error) {
            console.error('❌ Error en /api/search/trending:', error);
            // Log de error de seguridad
            securityLogger.logApiError(securityLogger.context, error instanceof Error ? error : new Error('Unknown error'), {
                endpoint: '/api/search/trending'
            });
            // En caso de error, devolver búsquedas por defecto
            const fallbackResponse = {
                data: {
                    trending: defaultTrendingSearches.slice(0, parseInt(request.nextUrl.searchParams.get('limit') || '6')),
                    lastUpdated: new Date().toISOString()
                },
                success: true
            };
            return _server.NextResponse.json(fallbackResponse);
        }
    });
    // Manejar rate limit excedido
    if (rateLimitResult instanceof _server.NextResponse) {
        securityLogger.logRateLimitExceeded(securityLogger.context, {
            endpoint: '/api/search/trending',
            method: 'GET'
        });
        return rateLimitResult;
    }
    return rateLimitResult;
}
async function POST(request) {
    try {
        // Validar que el request tenga contenido
        const contentType = request.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            return _server.NextResponse.json({
                error: 'Content-Type debe ser application/json'
            }, {
                status: 400
            });
        }
        // Obtener el texto del body primero para validar
        const bodyText = await request.text();
        if (!bodyText || bodyText.trim() === '' || bodyText === '""' || bodyText === "''") {
            return _server.NextResponse.json({
                error: 'Body de la request no puede estar vacío'
            }, {
                status: 400
            });
        }
        // Parsear JSON de forma segura
        let requestData;
        try {
            requestData = JSON.parse(bodyText);
        } catch (parseError) {
            console.error('Error parsing JSON in POST /api/search/trending:', parseError);
            return _server.NextResponse.json({
                error: 'JSON inválido en el body de la request'
            }, {
                status: 400
            });
        }
        const { query, category, userId, sessionId } = requestData;
        if (!query || typeof query !== 'string') {
            return _server.NextResponse.json({
                error: 'Query de búsqueda requerida'
            }, {
                status: 400
            });
        }
        const supabase = (0, _supabase.getSupabaseClient)();
        if (supabase) {
            // Registrar la búsqueda en analytics usando función optimizada
            const { error } = await supabase.rpc('insert_analytics_event_optimized', {
                p_event_name: 'search',
                p_category: 'search',
                p_action: 'search',
                p_label: query.toLowerCase().trim().substring(0, 50),
                p_user_id: userId,
                p_session_id: sessionId || 'anonymous',
                p_page: '/search',
                p_user_agent: null
            });
            if (error) {
                console.error('Error registrando búsqueda en analytics:', error);
            } else {}
        }
        return _server.NextResponse.json({
            success: true
        });
    } catch (error) {
        console.error('❌ Error registrando búsqueda:', error);
        return _server.NextResponse.json({
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXHNlYXJjaFxcdHJlbmRpbmdcXHJvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvbmZpZ3VyYWNpw7NuIHBhcmEgTm9kZS5qcyBSdW50aW1lXHJcbmV4cG9ydCBjb25zdCBydW50aW1lID0gJ25vZGVqcyc7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBBUEk6IC9hcGkvc2VhcmNoL3RyZW5kaW5nIC0gQsO6c3F1ZWRhcyBwb3B1bGFyZXMvdHJlbmRpbmdcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGdldFN1cGFiYXNlQ2xpZW50IH0gZnJvbSAnQC9saWIvaW50ZWdyYXRpb25zL3N1cGFiYXNlJztcclxuaW1wb3J0IHsgQXBpUmVzcG9uc2UgfSBmcm9tICdAL3R5cGVzL2FwaSc7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBNRUpPUkFTIERFIFNFR1VSSURBRCAtIEFMVEEgUFJJT1JJREFEXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbmltcG9ydCB7XHJcbiAgd2l0aFJhdGVMaW1pdCxcclxuICBSQVRFX0xJTUlUX0NPTkZJR1NcclxufSBmcm9tICdAL2xpYi9yYXRlLWxpbWl0aW5nL3JhdGUtbGltaXRlcic7XHJcbmltcG9ydCB7XHJcbiAgQVBJX1RJTUVPVVRTLFxyXG4gIHdpdGhEYXRhYmFzZVRpbWVvdXQsXHJcbiAgZ2V0RW5kcG9pbnRUaW1lb3V0c1xyXG59IGZyb20gJ0AvbGliL2NvbmZpZy9hcGktdGltZW91dHMnO1xyXG5pbXBvcnQgeyBjcmVhdGVTZWN1cml0eUxvZ2dlciB9IGZyb20gJ0AvbGliL2xvZ2dpbmcvc2VjdXJpdHktbG9nZ2VyJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHJlbmRpbmdTZWFyY2gge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgcXVlcnk6IHN0cmluZztcclxuICBjb3VudDogbnVtYmVyO1xyXG4gIGNhdGVnb3J5Pzogc3RyaW5nO1xyXG4gIGhyZWY6IHN0cmluZztcclxuICB0eXBlOiAndHJlbmRpbmcnO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRyZW5kaW5nU2VhcmNoZXNSZXNwb25zZSB7XHJcbiAgdHJlbmRpbmc6IFRyZW5kaW5nU2VhcmNoW107XHJcbiAgbGFzdFVwZGF0ZWQ6IHN0cmluZztcclxufVxyXG5cclxuLy8gQsO6c3F1ZWRhcyB0cmVuZGluZyBnZW5lcmFkYXMgZGluw6FtaWNhbWVudGUgYmFzYWRhcyBlbiBwcm9kdWN0b3MgcmVhbGVzXHJcbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlRHluYW1pY1RyZW5kaW5nU2VhcmNoZXMoc3VwYWJhc2U6IGFueSwgbGltaXQ6IG51bWJlciA9IDYpOiBQcm9taXNlPFRyZW5kaW5nU2VhcmNoW10+IHtcclxuICB0cnkge1xyXG4gICAgLy8gT2J0ZW5lciBwcm9kdWN0b3MgbcOhcyBwb3B1bGFyZXMgeSBtYXJjYXMgcGFyYSBnZW5lcmFyIGLDunNxdWVkYXMgdHJlbmRpbmcgcmVhbGlzdGFzXHJcbiAgICBjb25zdCB7IGRhdGE6IHByb2R1Y3RzLCBlcnJvcjogcHJvZHVjdHNFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2R1Y3RzJylcclxuICAgICAgLnNlbGVjdCgnbmFtZSwgYnJhbmQsIGNhdGVnb3J5X2lkLCBjYXRlZ29yaWVzKG5hbWUpJylcclxuICAgICAgLmVxKCdpc19hY3RpdmUnLCB0cnVlKVxyXG4gICAgICAubGltaXQoMjApO1xyXG5cclxuICAgIGlmIChwcm9kdWN0c0Vycm9yIHx8ICFwcm9kdWN0cykge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ0Vycm9yIG9idGVuaWVuZG8gcHJvZHVjdG9zIHBhcmEgdHJlbmRpbmc6JywgcHJvZHVjdHNFcnJvcik7XHJcbiAgICAgIHJldHVybiBnZXRGYWxsYmFja1RyZW5kaW5nU2VhcmNoZXMobGltaXQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXIgYsO6c3F1ZWRhcyB0cmVuZGluZyBiYXNhZGFzIGVuIHByb2R1Y3RvcyByZWFsZXNcclxuICAgIGNvbnN0IHRyZW5kaW5nU2VhcmNoZXM6IFRyZW5kaW5nU2VhcmNoW10gPSBbXTtcclxuICAgIGNvbnN0IHVzZWRRdWVyaWVzID0gbmV3IFNldDxzdHJpbmc+KCk7XHJcblxyXG4gICAgLy8gQWdyZWdhciBiw7pzcXVlZGFzIHBvciBtYXJjYVxyXG4gICAgY29uc3QgYnJhbmRzID0gWy4uLm5ldyBTZXQocHJvZHVjdHMubWFwKHAgPT4gcC5icmFuZCkuZmlsdGVyKEJvb2xlYW4pKV07XHJcbiAgICBicmFuZHMuc2xpY2UoMCwgMikuZm9yRWFjaCgoYnJhbmQsIGluZGV4KSA9PiB7XHJcbiAgICAgIGlmIChicmFuZCAmJiAhdXNlZFF1ZXJpZXMuaGFzKGJyYW5kLnRvTG93ZXJDYXNlKCkpKSB7XHJcbiAgICAgICAgdHJlbmRpbmdTZWFyY2hlcy5wdXNoKHtcclxuICAgICAgICAgIGlkOiBgdHJlbmRpbmctYnJhbmQtJHtpbmRleCArIDF9YCxcclxuICAgICAgICAgIHF1ZXJ5OiBicmFuZCxcclxuICAgICAgICAgIGNvdW50OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA1MCkgKyAyMCwgLy8gUmFuZ28gcmVhbGlzdGEgMjAtNzBcclxuICAgICAgICAgIGNhdGVnb3J5OiBcIm1hcmNhc1wiLFxyXG4gICAgICAgICAgaHJlZjogYC9zZWFyY2g/cT0ke2VuY29kZVVSSUNvbXBvbmVudChicmFuZCl9YCxcclxuICAgICAgICAgIHR5cGU6IFwidHJlbmRpbmdcIlxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHVzZWRRdWVyaWVzLmFkZChicmFuZC50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQWdyZWdhciBiw7pzcXVlZGFzIHBvciBjYXRlZ29yw61hXHJcbiAgICBjb25zdCBjYXRlZ29yaWVzID0gWy4uLm5ldyBTZXQocHJvZHVjdHMubWFwKHAgPT4gcC5jYXRlZ29yaWVzPy5uYW1lKS5maWx0ZXIoQm9vbGVhbikpXTtcclxuICAgIGNhdGVnb3JpZXMuc2xpY2UoMCwgMikuZm9yRWFjaCgoY2F0ZWdvcnksIGluZGV4KSA9PiB7XHJcbiAgICAgIGlmIChjYXRlZ29yeSAmJiAhdXNlZFF1ZXJpZXMuaGFzKGNhdGVnb3J5LnRvTG93ZXJDYXNlKCkpKSB7XHJcbiAgICAgICAgdHJlbmRpbmdTZWFyY2hlcy5wdXNoKHtcclxuICAgICAgICAgIGlkOiBgdHJlbmRpbmctY2F0ZWdvcnktJHtpbmRleCArIDF9YCxcclxuICAgICAgICAgIHF1ZXJ5OiBjYXRlZ29yeSxcclxuICAgICAgICAgIGNvdW50OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0MCkgKyAxNSwgLy8gUmFuZ28gcmVhbGlzdGEgMTUtNTVcclxuICAgICAgICAgIGNhdGVnb3J5OiBcInBpbnR1cmFzXCIsXHJcbiAgICAgICAgICBocmVmOiBgL3NlYXJjaD9xPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGNhdGVnb3J5KX1gLFxyXG4gICAgICAgICAgdHlwZTogXCJ0cmVuZGluZ1wiXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdXNlZFF1ZXJpZXMuYWRkKGNhdGVnb3J5LnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBZ3JlZ2FyIGLDunNxdWVkYXMgcG9yIHByb2R1Y3RvcyBlc3BlY8OtZmljb3NcclxuICAgIGNvbnN0IHBvcHVsYXJQcm9kdWN0cyA9IHByb2R1Y3RzLnNsaWNlKDAsIDIpO1xyXG4gICAgcG9wdWxhclByb2R1Y3RzLmZvckVhY2goKHByb2R1Y3QsIGluZGV4KSA9PiB7XHJcbiAgICAgIGNvbnN0IHByb2R1Y3ROYW1lID0gcHJvZHVjdC5uYW1lO1xyXG4gICAgICBpZiAocHJvZHVjdE5hbWUgJiYgIXVzZWRRdWVyaWVzLmhhcyhwcm9kdWN0TmFtZS50b0xvd2VyQ2FzZSgpKSkge1xyXG4gICAgICAgIHRyZW5kaW5nU2VhcmNoZXMucHVzaCh7XHJcbiAgICAgICAgICBpZDogYHRyZW5kaW5nLXByb2R1Y3QtJHtpbmRleCArIDF9YCxcclxuICAgICAgICAgIHF1ZXJ5OiBwcm9kdWN0TmFtZSxcclxuICAgICAgICAgIGNvdW50OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzMCkgKyAxMCwgLy8gUmFuZ28gcmVhbGlzdGEgMTAtNDBcclxuICAgICAgICAgIGNhdGVnb3J5OiBcInByb2R1Y3Rvc1wiLFxyXG4gICAgICAgICAgaHJlZjogYC9zZWFyY2g/cT0ke2VuY29kZVVSSUNvbXBvbmVudChwcm9kdWN0TmFtZSl9YCxcclxuICAgICAgICAgIHR5cGU6IFwidHJlbmRpbmdcIlxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHVzZWRRdWVyaWVzLmFkZChwcm9kdWN0TmFtZS50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gT3JkZW5hciBwb3IgY291bnQgZGVzY2VuZGVudGUgeSBsaW1pdGFyXHJcbiAgICByZXR1cm4gdHJlbmRpbmdTZWFyY2hlc1xyXG4gICAgICAuc29ydCgoYSwgYikgPT4gYi5jb3VudCAtIGEuY291bnQpXHJcbiAgICAgIC5zbGljZSgwLCBsaW1pdCk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZW5lcmFuZG8gdHJlbmRpbmcgc2VhcmNoZXMgZGluw6FtaWNhczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gZ2V0RmFsbGJhY2tUcmVuZGluZ1NlYXJjaGVzKGxpbWl0KTtcclxuICB9XHJcbn1cclxuXHJcbi8vIEZhbGxiYWNrIGNvbiBkYXRvcyBtw61uaW1vcyAoc29sbyBzaSBmYWxsYSB0b2RvIGxvIGRlbcOhcylcclxuZnVuY3Rpb24gZ2V0RmFsbGJhY2tUcmVuZGluZ1NlYXJjaGVzKGxpbWl0OiBudW1iZXIgPSA2KTogVHJlbmRpbmdTZWFyY2hbXSB7XHJcbiAgY29uc3QgZmFsbGJhY2tTZWFyY2hlcyA9IFtcclxuICAgIHsgcXVlcnk6IFwiUGludHVyYVwiLCBjYXRlZ29yeTogXCJwaW50dXJhc1wiIH0sXHJcbiAgICB7IHF1ZXJ5OiBcIkVzbWFsdGVcIiwgY2F0ZWdvcnk6IFwicGludHVyYXNcIiB9LFxyXG4gICAgeyBxdWVyeTogXCJMw6F0ZXhcIiwgY2F0ZWdvcnk6IFwicGludHVyYXNcIiB9LFxyXG4gICAgeyBxdWVyeTogXCJCYXJuaXpcIiwgY2F0ZWdvcnk6IFwicGludHVyYXNcIiB9LFxyXG4gICAgeyBxdWVyeTogXCJJbXByaW1hY2nDs25cIiwgY2F0ZWdvcnk6IFwicGludHVyYXNcIiB9LFxyXG4gICAgeyBxdWVyeTogXCJSb2RpbGxvc1wiLCBjYXRlZ29yeTogXCJoZXJyYW1pZW50YXNcIiB9XHJcbiAgXTtcclxuXHJcbiAgcmV0dXJuIGZhbGxiYWNrU2VhcmNoZXMuc2xpY2UoMCwgbGltaXQpLm1hcCgoc2VhcmNoLCBpbmRleCkgPT4gKHtcclxuICAgIGlkOiBgZmFsbGJhY2stJHtpbmRleCArIDF9YCxcclxuICAgIHF1ZXJ5OiBzZWFyY2gucXVlcnksXHJcbiAgICBjb3VudDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjApICsgNSwgLy8gUmFuZ28gbcOtbmltbyA1LTI1XHJcbiAgICBjYXRlZ29yeTogc2VhcmNoLmNhdGVnb3J5LFxyXG4gICAgaHJlZjogYC9zZWFyY2g/cT0ke2VuY29kZVVSSUNvbXBvbmVudChzZWFyY2gucXVlcnkudG9Mb3dlckNhc2UoKSl9YCxcclxuICAgIHR5cGU6IFwidHJlbmRpbmdcIiBhcyBjb25zdFxyXG4gIH0pKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIC8vIENyZWFyIGxvZ2dlciBkZSBzZWd1cmlkYWQgY29uIGNvbnRleHRvXHJcbiAgY29uc3Qgc2VjdXJpdHlMb2dnZXIgPSBjcmVhdGVTZWN1cml0eUxvZ2dlcihyZXF1ZXN0KTtcclxuXHJcbiAgLy8gQXBsaWNhciByYXRlIGxpbWl0aW5nIHBhcmEgQVBJcyBkZSBiw7pzcXVlZGFcclxuICBjb25zdCByYXRlTGltaXRSZXN1bHQgPSBhd2FpdCB3aXRoUmF0ZUxpbWl0KFxyXG4gICAgcmVxdWVzdCxcclxuICAgIFJBVEVfTElNSVRfQ09ORklHUy5zZWFyY2gsXHJcbiAgICBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIExvZyBkZSBhY2Nlc28gYSBsYSBBUElcclxuICAgICAgc2VjdXJpdHlMb2dnZXIubG9nKHtcclxuICAgICAgICB0eXBlOiAnZGF0YV9hY2Nlc3MnLFxyXG4gICAgICAgIHNldmVyaXR5OiAnbG93JyxcclxuICAgICAgICBtZXNzYWdlOiAnVHJlbmRpbmcgc2VhcmNoIEFQSSBhY2Nlc3NlZCcsXHJcbiAgICAgICAgY29udGV4dDogc2VjdXJpdHlMb2dnZXIuY29udGV4dCxcclxuICAgICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgICAgZW5kcG9pbnQ6ICcvYXBpL3NlYXJjaC90cmVuZGluZycsXHJcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgdXNlckFnZW50OiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JylcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XHJcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzYnKTtcclxuICAgIGNvbnN0IGRheXMgPSBwYXJzZUludChzZWFyY2hQYXJhbXMuZ2V0KCdkYXlzJykgfHwgJzcnKTtcclxuICAgIGNvbnN0IGNhdGVnb3J5ID0gc2VhcmNoUGFyYW1zLmdldCgnY2F0ZWdvcnknKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygn8J+UpSBBUEkgL2FwaS9zZWFyY2gvdHJlbmRpbmc6IE9idGVuaWVuZG8gYsO6c3F1ZWRhcyB0cmVuZGluZycsIHtcclxuICAgICAgbGltaXQsXHJcbiAgICAgIGRheXMsXHJcbiAgICAgIGNhdGVnb3J5XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XHJcblxyXG4gICAgbGV0IHRyZW5kaW5nU2VhcmNoZXM6IFRyZW5kaW5nU2VhcmNoW10gPSBbXTtcclxuXHJcbiAgICAvLyBJbnRlbnRhciBvYnRlbmVyIGLDunNxdWVkYXMgdHJlbmRpbmcgcmVhbGVzIGRlbCBzaXN0ZW1hIGRlIGFuYWx5dGljc1xyXG4gICAgaWYgKHN1cGFiYXNlKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICBzdGFydERhdGUuc2V0RGF0ZShzdGFydERhdGUuZ2V0RGF0ZSgpIC0gZGF5cyk7XHJcblxyXG4gICAgICAgIC8vIFF1ZXJ5IHBhcmEgb2J0ZW5lciBiw7pzcXVlZGFzIG3DoXMgcG9wdWxhcmVzIGRlIGFuYWx5dGljc19ldmVudHNcclxuICAgICAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgICAgICAgLmZyb20oJ2FuYWx5dGljc19ldmVudHMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgnbGFiZWwsIG1ldGFkYXRhJylcclxuICAgICAgICAgIC5lcSgnY2F0ZWdvcnknLCAnc2VhcmNoJylcclxuICAgICAgICAgIC5lcSgnYWN0aW9uJywgJ3NlYXJjaF9xdWVyeScpXHJcbiAgICAgICAgICAuZ3RlKCdjcmVhdGVkX2F0Jywgc3RhcnREYXRlLnRvSVNPU3RyaW5nKCkpXHJcbiAgICAgICAgICAubm90KCdsYWJlbCcsICdpcycsIG51bGwpO1xyXG5cclxuICAgICAgICBpZiAoY2F0ZWdvcnkpIHtcclxuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ21ldGFkYXRhLT4+Y2F0ZWdvcnknLCBjYXRlZ29yeSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB7IGRhdGE6IGFuYWx5dGljc0RhdGEsIGVycm9yIH0gPSBhd2FpdCB3aXRoRGF0YWJhc2VUaW1lb3V0KFxyXG4gICAgICAgICAgYXN5bmMgKHNpZ25hbCkgPT4gYXdhaXQgcXVlcnksXHJcbiAgICAgICAgICBBUElfVElNRU9VVFMuZGF0YWJhc2VcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBpZiAoIWVycm9yICYmIGFuYWx5dGljc0RhdGEgJiYgYW5hbHl0aWNzRGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAvLyBQcm9jZXNhciBkYXRvcyBkZSBhbmFseXRpY3MgcGFyYSBvYnRlbmVyIHRyZW5kaW5nXHJcbiAgICAgICAgICBjb25zdCBzZWFyY2hDb3VudHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xyXG4gICAgICAgICAgY29uc3Qgc2VhcmNoQ2F0ZWdvcmllcyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XHJcblxyXG4gICAgICAgICAgYW5hbHl0aWNzRGF0YS5mb3JFYWNoKChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXZlbnQubGFiZWwpIHtcclxuICAgICAgICAgICAgICBjb25zdCBxdWVyeSA9IGV2ZW50LmxhYmVsLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xyXG4gICAgICAgICAgICAgIGlmIChxdWVyeS5sZW5ndGggPiAyKSB7IC8vIFNvbG8gcXVlcmllcyBkZSBtw6FzIGRlIDIgY2FyYWN0ZXJlc1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoQ291bnRzLnNldChxdWVyeSwgKHNlYXJjaENvdW50cy5nZXQocXVlcnkpIHx8IDApICsgMSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIEV4dHJhZXIgY2F0ZWdvcsOtYSBkZWwgbWV0YWRhdGEgc2kgZXhpc3RlXHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQubWV0YWRhdGEgJiYgZXZlbnQubWV0YWRhdGEuY2F0ZWdvcnkpIHtcclxuICAgICAgICAgICAgICAgICAgc2VhcmNoQ2F0ZWdvcmllcy5zZXQocXVlcnksIGV2ZW50Lm1ldGFkYXRhLmNhdGVnb3J5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIC8vIENvbnZlcnRpciBhIGFycmF5IHkgb3JkZW5hciBwb3IgcG9wdWxhcmlkYWRcclxuICAgICAgICAgIGNvbnN0IHNvcnRlZFNlYXJjaGVzID0gQXJyYXkuZnJvbShzZWFyY2hDb3VudHMuZW50cmllcygpKVxyXG4gICAgICAgICAgICAuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pXHJcbiAgICAgICAgICAgIC5zbGljZSgwLCBsaW1pdCk7XHJcblxyXG4gICAgICAgICAgdHJlbmRpbmdTZWFyY2hlcyA9IHNvcnRlZFNlYXJjaGVzLm1hcCgoW3F1ZXJ5LCBjb3VudF0sIGluZGV4KSA9PiAoe1xyXG4gICAgICAgICAgICBpZDogYHRyZW5kaW5nLXJlYWwtJHtpbmRleCArIDF9YCxcclxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcXVlcnkuc2xpY2UoMSksXHJcbiAgICAgICAgICAgIGNvdW50LFxyXG4gICAgICAgICAgICBjYXRlZ29yeTogc2VhcmNoQ2F0ZWdvcmllcy5nZXQocXVlcnkpLFxyXG4gICAgICAgICAgICBocmVmOiBgL3NlYXJjaD9xPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5KX1gLFxyXG4gICAgICAgICAgICB0eXBlOiAndHJlbmRpbmcnIGFzIGNvbnN0XHJcbiAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoYW5hbHl0aWNzRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBFcnJvciBvYnRlbmllbmRvIHRyZW5kaW5nIGRlIGFuYWx5dGljcywgdXNhbmRvIGZhbGxiYWNrOicsIGFuYWx5dGljc0Vycm9yKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFNpIG5vIGhheSBkYXRvcyByZWFsZXMgbyBoYXkgcG9jb3MsIGdlbmVyYXIgZGluw6FtaWNhbWVudGVcclxuICAgIGlmICh0cmVuZGluZ1NlYXJjaGVzLmxlbmd0aCA8IDMpIHtcclxuICAgICAgY29uc29sZS5sb2coJ/CflIQgR2VuZXJhbmRvIGLDunNxdWVkYXMgdHJlbmRpbmcgZGluw6FtaWNhcyBkZXNkZSBwcm9kdWN0b3MnKTtcclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgZHluYW1pY1NlYXJjaGVzID0gYXdhaXQgZ2VuZXJhdGVEeW5hbWljVHJlbmRpbmdTZWFyY2hlcyhzdXBhYmFzZSwgbGltaXQpO1xyXG5cclxuICAgICAgICAvLyBGaWx0cmFyIHBvciBjYXRlZ29yw61hIHNpIHNlIGVzcGVjaWZpY2FcclxuICAgICAgICBsZXQgZmlsdGVyZWRTZWFyY2hlcyA9IGR5bmFtaWNTZWFyY2hlcztcclxuICAgICAgICBpZiAoY2F0ZWdvcnkpIHtcclxuICAgICAgICAgIGZpbHRlcmVkU2VhcmNoZXMgPSBkeW5hbWljU2VhcmNoZXMuZmlsdGVyKFxyXG4gICAgICAgICAgICBzZWFyY2ggPT4gc2VhcmNoLmNhdGVnb3J5ID09PSBjYXRlZ29yeVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENvbWJpbmFyIGRhdG9zIHJlYWxlcyBjb24gZGluw6FtaWNvcyBzaSBlcyBuZWNlc2FyaW9cclxuICAgICAgICBjb25zdCBuZWVkZWQgPSBsaW1pdCAtIHRyZW5kaW5nU2VhcmNoZXMubGVuZ3RoO1xyXG4gICAgICAgIGNvbnN0IGFkZGl0aW9uYWxTZWFyY2hlcyA9IGZpbHRlcmVkU2VhcmNoZXMuc2xpY2UoMCwgbmVlZGVkKTtcclxuXHJcbiAgICAgICAgdHJlbmRpbmdTZWFyY2hlcyA9IFsuLi50cmVuZGluZ1NlYXJjaGVzLCAuLi5hZGRpdGlvbmFsU2VhcmNoZXNdO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdlbmVyYW5kbyB0cmVuZGluZyBkaW7DoW1pY2FzLCB1c2FuZG8gZmFsbGJhY2s6JywgZXJyb3IpO1xyXG4gICAgICAgIGNvbnN0IGZhbGxiYWNrU2VhcmNoZXMgPSBnZXRGYWxsYmFja1RyZW5kaW5nU2VhcmNoZXMobGltaXQgLSB0cmVuZGluZ1NlYXJjaGVzLmxlbmd0aCk7XHJcbiAgICAgICAgdHJlbmRpbmdTZWFyY2hlcyA9IFsuLi50cmVuZGluZ1NlYXJjaGVzLCAuLi5mYWxsYmFja1NlYXJjaGVzXTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIExpbWl0YXIgYWwgbsO6bWVybyBzb2xpY2l0YWRvXHJcbiAgICB0cmVuZGluZ1NlYXJjaGVzID0gdHJlbmRpbmdTZWFyY2hlcy5zbGljZSgwLCBsaW1pdCk7XHJcblxyXG4gICAgY29uc3QgcmVzcG9uc2U6IEFwaVJlc3BvbnNlPFRyZW5kaW5nU2VhcmNoZXNSZXNwb25zZT4gPSB7XHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICB0cmVuZGluZzogdHJlbmRpbmdTZWFyY2hlcyxcclxuICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0sXHJcbiAgICAgIHN1Y2Nlc3M6IHRydWVcclxuICAgIH07XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SlIFRyZW5kaW5nIHNlYXJjaGVzIHJlc3BvbnNlOicsIHtcclxuICAgICAgICAgIGNvdW50OiB0cmVuZGluZ1NlYXJjaGVzLmxlbmd0aCxcclxuICAgICAgICAgIGhhc1JlYWxEYXRhOiB0cmVuZGluZ1NlYXJjaGVzLnNvbWUocyA9PiBzLmlkLmluY2x1ZGVzKCdyZWFsJykpLFxyXG4gICAgICAgICAgY2F0ZWdvcmllczogWy4uLm5ldyBTZXQodHJlbmRpbmdTZWFyY2hlcy5tYXAocyA9PiBzLmNhdGVnb3J5KS5maWx0ZXIoQm9vbGVhbikpXVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBMb2cgZGUgb3BlcmFjacOzbiBleGl0b3NhXHJcbiAgICAgICAgc2VjdXJpdHlMb2dnZXIubG9nKHtcclxuICAgICAgICAgIHR5cGU6ICdkYXRhX2FjY2VzcycsXHJcbiAgICAgICAgICBzZXZlcml0eTogJ2xvdycsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnVHJlbmRpbmcgc2VhcmNoZXMgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseScsXHJcbiAgICAgICAgICBjb250ZXh0OiBzZWN1cml0eUxvZ2dlci5jb250ZXh0LFxyXG4gICAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgc2VhcmNoZXNDb3VudDogdHJlbmRpbmdTZWFyY2hlcy5sZW5ndGgsXHJcbiAgICAgICAgICAgIGxpbWl0OiBsaW1pdCxcclxuICAgICAgICAgICAgZGF5czogZGF5cyxcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXNwb25zZSk7XHJcblxyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBlbiAvYXBpL3NlYXJjaC90cmVuZGluZzonLCBlcnJvcik7XHJcblxyXG4gICAgICAgIC8vIExvZyBkZSBlcnJvciBkZSBzZWd1cmlkYWRcclxuICAgICAgICBzZWN1cml0eUxvZ2dlci5sb2dBcGlFcnJvcihcclxuICAgICAgICAgIHNlY3VyaXR5TG9nZ2VyLmNvbnRleHQsXHJcbiAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgZW5kcG9pbnQ6ICcvYXBpL3NlYXJjaC90cmVuZGluZydcclxuICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICAvLyBFbiBjYXNvIGRlIGVycm9yLCBkZXZvbHZlciBiw7pzcXVlZGFzIHBvciBkZWZlY3RvXHJcbiAgICAgICAgY29uc3QgZmFsbGJhY2tSZXNwb25zZTogQXBpUmVzcG9uc2U8VHJlbmRpbmdTZWFyY2hlc1Jlc3BvbnNlPiA9IHtcclxuICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgdHJlbmRpbmc6IGRlZmF1bHRUcmVuZGluZ1NlYXJjaGVzLnNsaWNlKDAsIHBhcnNlSW50KHJlcXVlc3QubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdsaW1pdCcpIHx8ICc2JykpLFxyXG4gICAgICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihmYWxsYmFja1Jlc3BvbnNlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICk7XHJcblxyXG4gIC8vIE1hbmVqYXIgcmF0ZSBsaW1pdCBleGNlZGlkb1xyXG4gIGlmIChyYXRlTGltaXRSZXN1bHQgaW5zdGFuY2VvZiBOZXh0UmVzcG9uc2UpIHtcclxuICAgIHNlY3VyaXR5TG9nZ2VyLmxvZ1JhdGVMaW1pdEV4Y2VlZGVkKFxyXG4gICAgICBzZWN1cml0eUxvZ2dlci5jb250ZXh0LFxyXG4gICAgICB7IGVuZHBvaW50OiAnL2FwaS9zZWFyY2gvdHJlbmRpbmcnLCBtZXRob2Q6ICdHRVQnIH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gcmF0ZUxpbWl0UmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJhdGVMaW1pdFJlc3VsdDtcclxufVxyXG5cclxuLy8gTcOpdG9kbyBQT1NUIHBhcmEgcmVnaXN0cmFyIHVuYSBiw7pzcXVlZGEgKHBhcmEgYW5hbHl0aWNzKVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBWYWxpZGFyIHF1ZSBlbCByZXF1ZXN0IHRlbmdhIGNvbnRlbmlkb1xyXG4gICAgY29uc3QgY29udGVudFR5cGUgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdjb250ZW50LXR5cGUnKTtcclxuICAgIGlmICghY29udGVudFR5cGUgfHwgIWNvbnRlbnRUeXBlLmluY2x1ZGVzKCdhcHBsaWNhdGlvbi9qc29uJykpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6ICdDb250ZW50LVR5cGUgZGViZSBzZXIgYXBwbGljYXRpb24vanNvbicgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBPYnRlbmVyIGVsIHRleHRvIGRlbCBib2R5IHByaW1lcm8gcGFyYSB2YWxpZGFyXHJcbiAgICBjb25zdCBib2R5VGV4dCA9IGF3YWl0IHJlcXVlc3QudGV4dCgpO1xyXG4gICAgaWYgKCFib2R5VGV4dCB8fCBib2R5VGV4dC50cmltKCkgPT09ICcnIHx8IGJvZHlUZXh0ID09PSAnXCJcIicgfHwgYm9keVRleHQgPT09IFwiJydcIikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ0JvZHkgZGUgbGEgcmVxdWVzdCBubyBwdWVkZSBlc3RhciB2YWPDrW8nIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUGFyc2VhciBKU09OIGRlIGZvcm1hIHNlZ3VyYVxyXG4gICAgbGV0IHJlcXVlc3REYXRhO1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmVxdWVzdERhdGEgPSBKU09OLnBhcnNlKGJvZHlUZXh0KTtcclxuICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyBKU09OIGluIFBPU1QgL2FwaS9zZWFyY2gvdHJlbmRpbmc6JywgcGFyc2VFcnJvcik7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAnSlNPTiBpbnbDoWxpZG8gZW4gZWwgYm9keSBkZSBsYSByZXF1ZXN0JyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgcXVlcnksIGNhdGVnb3J5LCB1c2VySWQsIHNlc3Npb25JZCB9ID0gcmVxdWVzdERhdGE7XHJcblxyXG4gICAgaWYgKCFxdWVyeSB8fCB0eXBlb2YgcXVlcnkgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAnUXVlcnkgZGUgYsO6c3F1ZWRhIHJlcXVlcmlkYScgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XHJcblxyXG4gICAgaWYgKHN1cGFiYXNlKSB7XHJcbiAgICAgIC8vIFJlZ2lzdHJhciBsYSBiw7pzcXVlZGEgZW4gYW5hbHl0aWNzIHVzYW5kbyBmdW5jacOzbiBvcHRpbWl6YWRhXHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYygnaW5zZXJ0X2FuYWx5dGljc19ldmVudF9vcHRpbWl6ZWQnLCB7XHJcbiAgICAgICAgcF9ldmVudF9uYW1lOiAnc2VhcmNoJyxcclxuICAgICAgICBwX2NhdGVnb3J5OiAnc2VhcmNoJyxcclxuICAgICAgICBwX2FjdGlvbjogJ3NlYXJjaCcsXHJcbiAgICAgICAgcF9sYWJlbDogcXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCkuc3Vic3RyaW5nKDAsIDUwKSxcclxuICAgICAgICBwX3VzZXJfaWQ6IHVzZXJJZCxcclxuICAgICAgICBwX3Nlc3Npb25faWQ6IHNlc3Npb25JZCB8fCAnYW5vbnltb3VzJyxcclxuICAgICAgICBwX3BhZ2U6ICcvc2VhcmNoJyxcclxuICAgICAgICBwX3VzZXJfYWdlbnQ6IG51bGxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWdpc3RyYW5kbyBiw7pzcXVlZGEgZW4gYW5hbHl0aWNzOicsIGVycm9yKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHN1Y2Nlc3M6IHRydWUgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgcmVnaXN0cmFuZG8gYsO6c3F1ZWRhOicsIGVycm9yKTtcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBlcnJvcjogJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iXSwibmFtZXMiOlsiR0VUIiwiUE9TVCIsInJ1bnRpbWUiLCJnZW5lcmF0ZUR5bmFtaWNUcmVuZGluZ1NlYXJjaGVzIiwic3VwYWJhc2UiLCJsaW1pdCIsImRhdGEiLCJwcm9kdWN0cyIsImVycm9yIiwicHJvZHVjdHNFcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsImNvbnNvbGUiLCJ3YXJuIiwiZ2V0RmFsbGJhY2tUcmVuZGluZ1NlYXJjaGVzIiwidHJlbmRpbmdTZWFyY2hlcyIsInVzZWRRdWVyaWVzIiwiU2V0IiwiYnJhbmRzIiwibWFwIiwicCIsImJyYW5kIiwiZmlsdGVyIiwiQm9vbGVhbiIsInNsaWNlIiwiZm9yRWFjaCIsImluZGV4IiwiaGFzIiwidG9Mb3dlckNhc2UiLCJwdXNoIiwiaWQiLCJxdWVyeSIsImNvdW50IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiY2F0ZWdvcnkiLCJocmVmIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwidHlwZSIsImFkZCIsImNhdGVnb3JpZXMiLCJuYW1lIiwicG9wdWxhclByb2R1Y3RzIiwicHJvZHVjdCIsInByb2R1Y3ROYW1lIiwic29ydCIsImEiLCJiIiwiZmFsbGJhY2tTZWFyY2hlcyIsInNlYXJjaCIsInJlcXVlc3QiLCJzZWN1cml0eUxvZ2dlciIsImNyZWF0ZVNlY3VyaXR5TG9nZ2VyIiwicmF0ZUxpbWl0UmVzdWx0Iiwid2l0aFJhdGVMaW1pdCIsIlJBVEVfTElNSVRfQ09ORklHUyIsImxvZyIsInNldmVyaXR5IiwibWVzc2FnZSIsImNvbnRleHQiLCJtZXRhZGF0YSIsImVuZHBvaW50IiwibWV0aG9kIiwidXNlckFnZW50IiwiaGVhZGVycyIsImdldCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInBhcnNlSW50IiwiZGF5cyIsImdldFN1cGFiYXNlQ2xpZW50Iiwic3RhcnREYXRlIiwiRGF0ZSIsInNldERhdGUiLCJnZXREYXRlIiwiZ3RlIiwidG9JU09TdHJpbmciLCJub3QiLCJhbmFseXRpY3NEYXRhIiwid2l0aERhdGFiYXNlVGltZW91dCIsInNpZ25hbCIsIkFQSV9USU1FT1VUUyIsImRhdGFiYXNlIiwibGVuZ3RoIiwic2VhcmNoQ291bnRzIiwiTWFwIiwic2VhcmNoQ2F0ZWdvcmllcyIsImV2ZW50IiwibGFiZWwiLCJ0cmltIiwic2V0Iiwic29ydGVkU2VhcmNoZXMiLCJBcnJheSIsImVudHJpZXMiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsImFuYWx5dGljc0Vycm9yIiwiZHluYW1pY1NlYXJjaGVzIiwiZmlsdGVyZWRTZWFyY2hlcyIsIm5lZWRlZCIsImFkZGl0aW9uYWxTZWFyY2hlcyIsInJlc3BvbnNlIiwidHJlbmRpbmciLCJsYXN0VXBkYXRlZCIsInN1Y2Nlc3MiLCJoYXNSZWFsRGF0YSIsInNvbWUiLCJzIiwiaW5jbHVkZXMiLCJzZWFyY2hlc0NvdW50IiwiTmV4dFJlc3BvbnNlIiwianNvbiIsImxvZ0FwaUVycm9yIiwiRXJyb3IiLCJmYWxsYmFja1Jlc3BvbnNlIiwiZGVmYXVsdFRyZW5kaW5nU2VhcmNoZXMiLCJuZXh0VXJsIiwibG9nUmF0ZUxpbWl0RXhjZWVkZWQiLCJjb250ZW50VHlwZSIsInN0YXR1cyIsImJvZHlUZXh0IiwidGV4dCIsInJlcXVlc3REYXRhIiwiSlNPTiIsInBhcnNlIiwicGFyc2VFcnJvciIsInVzZXJJZCIsInNlc3Npb25JZCIsInJwYyIsInBfZXZlbnRfbmFtZSIsInBfY2F0ZWdvcnkiLCJwX2FjdGlvbiIsInBfbGFiZWwiLCJzdWJzdHJpbmciLCJwX3VzZXJfaWQiLCJwX3Nlc3Npb25faWQiLCJwX3BhZ2UiLCJwX3VzZXJfYWdlbnQiXSwibWFwcGluZ3MiOiJBQUFBLHFDQUFxQzs7Ozs7Ozs7Ozs7O1FBMklmQTtlQUFBQTs7UUF3TUFDO2VBQUFBOztRQWxWVEM7ZUFBQUE7Ozt3QkFNNkI7MEJBQ1I7NkJBUzNCOzZCQUtBO2dDQUM4QjtBQXRCOUIsTUFBTUEsVUFBVTtBQXNDdkIseUVBQXlFO0FBQ3pFLGVBQWVDLGdDQUFnQ0MsUUFBYSxFQUFFQyxRQUFnQixDQUFDO0lBQzdFLElBQUk7UUFDRixxRkFBcUY7UUFDckYsTUFBTSxFQUFFQyxNQUFNQyxRQUFRLEVBQUVDLE9BQU9DLGFBQWEsRUFBRSxHQUFHLE1BQU1MLFNBQ3BETSxJQUFJLENBQUMsWUFDTEMsTUFBTSxDQUFD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