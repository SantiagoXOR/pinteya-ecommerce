{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\admin\\__tests__\\useProductList.standalone.test.ts"],"sourcesContent":["/**\r\n * Test independiente para useProductList sin dependencias de configuración global\r\n * Ejecutar con: npx jest src/hooks/admin/__tests__/useProductList.standalone.test.ts --no-cache --no-coverage\r\n */\r\n\r\n// Mock React hooks\r\nconst mockUseState = jest.fn();\r\nconst mockUseEffect = jest.fn();\r\n\r\njest.mock('react', () => ({\r\n  useState: mockUseState,\r\n  useEffect: mockUseEffect\r\n}));\r\n\r\n// Mock fetch\r\nglobal.fetch = jest.fn();\r\n\r\ndescribe('useProductList Hook - Standalone Tests', () => {\r\n  let mockSetProducts: jest.Mock;\r\n  let mockSetIsLoading: jest.Mock;\r\n  let mockSetError: jest.Mock;\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    \r\n    // Mock useState calls\r\n    mockSetProducts = jest.fn();\r\n    mockSetIsLoading = jest.fn();\r\n    mockSetError = jest.fn();\r\n    \r\n    mockUseState\r\n      .mockReturnValueOnce([[], mockSetProducts]) // products state\r\n      .mockReturnValueOnce([true, mockSetIsLoading]) // isLoading state\r\n      .mockReturnValueOnce([null, mockSetError]); // error state\r\n    \r\n    // Mock useEffect to immediately call the effect\r\n    mockUseEffect.mockImplementation((effect) => {\r\n      effect();\r\n    });\r\n  });\r\n\r\n  afterEach(() => {\r\n    jest.restoreAllMocks();\r\n  });\r\n\r\n  it('should initialize with correct default state', async () => {\r\n    // Mock successful API response\r\n    (global.fetch as jest.Mock).mockResolvedValueOnce({\r\n      ok: true,\r\n      json: async () => ({\r\n        success: true,\r\n        data: {\r\n          products: [],\r\n          total: 0\r\n        }\r\n      })\r\n    });\r\n\r\n    // Import and execute the hook\r\n    const { useProductList } = await import('../useProductList');\r\n    const result = useProductList();\r\n\r\n    // Verify initial state setup\r\n    expect(mockUseState).toHaveBeenCalledTimes(3);\r\n    expect(mockUseState).toHaveBeenNthCalledWith(1, []); // products\r\n    expect(mockUseState).toHaveBeenNthCalledWith(2, true); // isLoading\r\n    expect(mockUseState).toHaveBeenNthCalledWith(3, null); // error\r\n\r\n    // Verify return value structure\r\n    expect(result).toEqual({\r\n      products: [],\r\n      isLoading: true,\r\n      error: null\r\n    });\r\n  });\r\n\r\n  it('should call fetch with correct URL', async () => {\r\n    (global.fetch as jest.Mock).mockResolvedValueOnce({\r\n      ok: true,\r\n      json: async () => ({\r\n        success: true,\r\n        data: {\r\n          products: [],\r\n          total: 0\r\n        }\r\n      })\r\n    });\r\n\r\n    const { useProductList } = await import('../useProductList');\r\n    useProductList();\r\n\r\n    expect(global.fetch).toHaveBeenCalledWith('/api/admin/products-direct?limit=25');\r\n  });\r\n\r\n  it('should handle successful API response', async () => {\r\n    const mockProducts = [\r\n      {\r\n        id: 1,\r\n        name: 'Test Product',\r\n        description: 'Test Description',\r\n        price: 1000,\r\n        stock: 50,\r\n        category_id: 1,\r\n        images: { main: '/test.jpg', gallery: [], previews: [], thumbnails: [] },\r\n        created_at: '2025-01-01T00:00:00Z',\r\n        updated_at: '2025-01-01T00:00:00Z',\r\n        category_name: 'Test Category'\r\n      }\r\n    ];\r\n\r\n    (global.fetch as jest.Mock).mockResolvedValueOnce({\r\n      ok: true,\r\n      json: async () => ({\r\n        success: true,\r\n        data: {\r\n          products: mockProducts,\r\n          total: 1\r\n        }\r\n      })\r\n    });\r\n\r\n    const { useProductList } = await import('../useProductList');\r\n    useProductList();\r\n\r\n    // Wait for async operations\r\n    await new Promise(resolve => setTimeout(resolve, 0));\r\n\r\n    expect(mockSetIsLoading).toHaveBeenCalledWith(true);\r\n    expect(mockSetError).toHaveBeenCalledWith(null);\r\n    expect(mockSetProducts).toHaveBeenCalledWith(mockProducts);\r\n    expect(mockSetIsLoading).toHaveBeenCalledWith(false);\r\n  });\r\n\r\n  it('should handle API errors', async () => {\r\n    (global.fetch as jest.Mock).mockResolvedValueOnce({\r\n      ok: false,\r\n      status: 500,\r\n      statusText: 'Internal Server Error'\r\n    });\r\n\r\n    const { useProductList } = await import('../useProductList');\r\n    useProductList();\r\n\r\n    // Wait for async operations\r\n    await new Promise(resolve => setTimeout(resolve, 0));\r\n\r\n    expect(mockSetError).toHaveBeenCalledWith('Error 500: Internal Server Error');\r\n    expect(mockSetProducts).toHaveBeenCalledWith([]);\r\n    expect(mockSetIsLoading).toHaveBeenCalledWith(false);\r\n  });\r\n\r\n  it('should handle network errors', async () => {\r\n    (global.fetch as jest.Mock).mockRejectedValueOnce(new Error('Network error'));\r\n\r\n    const { useProductList } = await import('../useProductList');\r\n    useProductList();\r\n\r\n    // Wait for async operations\r\n    await new Promise(resolve => setTimeout(resolve, 0));\r\n\r\n    expect(mockSetError).toHaveBeenCalledWith('Network error');\r\n    expect(mockSetProducts).toHaveBeenCalledWith([]);\r\n    expect(mockSetIsLoading).toHaveBeenCalledWith(false);\r\n  });\r\n\r\n  it('should handle invalid response structure', async () => {\r\n    (global.fetch as jest.Mock).mockResolvedValueOnce({\r\n      ok: true,\r\n      json: async () => ({\r\n        success: false,\r\n        error: 'Invalid request'\r\n      })\r\n    });\r\n\r\n    const { useProductList } = await import('../useProductList');\r\n    useProductList();\r\n\r\n    // Wait for async operations\r\n    await new Promise(resolve => setTimeout(resolve, 0));\r\n\r\n    expect(mockSetError).toHaveBeenCalledWith('Estructura de respuesta inválida');\r\n    expect(mockSetProducts).toHaveBeenCalledWith([]);\r\n    expect(mockSetIsLoading).toHaveBeenCalledWith(false);\r\n  });\r\n\r\n  it('should export correct TypeScript types', async () => {\r\n    const module = await import('../useProductList');\r\n    \r\n    expect(typeof module.useProductList).toBe('function');\r\n    expect(module.Product).toBeDefined;\r\n    expect(module.ProductListResponse).toBeDefined;\r\n  });\r\n\r\n  it('should follow React Hooks best practices', async () => {\r\n    const { useProductList } = await import('../useProductList');\r\n    \r\n    // Hook should be a function\r\n    expect(typeof useProductList).toBe('function');\r\n    \r\n    // Hook name should start with 'use'\r\n    expect(useProductList.name).toBe('useProductList');\r\n    \r\n    // Hook follows React best practices\r\n    expect(useProductList.name).toMatch(/^use/);\r\n  });\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["jest","mock","useState","mockUseState","useEffect","mockUseEffect","fn","global","fetch","describe","mockSetProducts","mockSetIsLoading","mockSetError","beforeEach","clearAllMocks","mockReturnValueOnce","mockImplementation","effect","afterEach","restoreAllMocks","it","mockResolvedValueOnce","ok","json","success","data","products","total","useProductList","result","expect","toHaveBeenCalledTimes","toHaveBeenNthCalledWith","toEqual","isLoading","error","toHaveBeenCalledWith","mockProducts","id","name","description","price","stock","category_id","images","main","gallery","previews","thumbnails","created_at","updated_at","category_name","Promise","resolve","setTimeout","status","statusText","mockRejectedValueOnce","Error","module","toBe","Product","toBeDefined","ProductListResponse","toMatch"],"mappings":"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"}