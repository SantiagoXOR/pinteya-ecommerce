{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\useProducts.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - HOOK PARA PRODUCTOS\r\n// ===================================\r\n\r\nimport { useState, useEffect, useCallback, useMemo, useRef } from 'react';\r\nimport { Product } from '@/types/product';\r\nimport { ProductFilters, PaginatedResponse, ProductWithCategory } from '@/types/api';\r\nimport { getProducts } from '@/lib/api/products';\r\nimport { adaptApiProductsToLegacy, ExtendedProduct } from '@/lib/adapters/productAdapter';\r\n\r\ninterface UseProductsState {\r\n  products: ExtendedProduct[];\r\n  loading: boolean;\r\n  error: string | null;\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\ninterface UseProductsOptions {\r\n  initialFilters?: ProductFilters;\r\n  autoFetch?: boolean;\r\n}\r\n\r\nexport function useProducts(options: UseProductsOptions = {}) {\r\n  const { initialFilters = {}, autoFetch = true } = options;\r\n\r\n  // Referencias para evitar re-renders innecesarios\r\n  const abortControllerRef = useRef<AbortController | null>(null);\r\n  const lastRequestRef = useRef<string>('');\r\n\r\n  // DEBUG: Log básico para verificar que el hook se ejecuta (solo en desarrollo)\r\n  if (process.env.NODE_ENV === 'development') {\r\n  }\r\n\r\n  const [state, setState] = useState<UseProductsState>({\r\n    products: [],\r\n    loading: false,\r\n    error: null,\r\n    pagination: {\r\n      page: 1,\r\n      limit: 12,\r\n      total: 0,\r\n      totalPages: 0,\r\n    },\r\n  });\r\n\r\n  const [filters, setFilters] = useState<ProductFilters>(initialFilters);\r\n\r\n  /**\r\n   * Obtiene productos desde la API con optimizaciones de performance\r\n   */\r\n  const fetchProducts = useCallback(async (newFilters?: ProductFilters) => {\r\n    const filtersToUse = newFilters || filters;\r\n\r\n    try {\r\n      setState(prev => ({ ...prev, loading: true, error: null }));\r\n\r\n      const response = await getProducts(filtersToUse);\r\n\r\n      if (response.success) {\r\n        const adaptedProducts = adaptApiProductsToLegacy(response.data);\r\n\r\n        setState(prev => ({\r\n          ...prev,\r\n          products: adaptedProducts,\r\n          loading: false,\r\n          pagination: response.pagination,\r\n        }));\r\n      } else {\r\n        setState(prev => ({\r\n          ...prev,\r\n          loading: false,\r\n          error: response.error || 'Error obteniendo productos',\r\n        }));\r\n      }\r\n    } catch (error: unknown) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Error inesperado';\r\n      setState(prev => ({\r\n        ...prev,\r\n        loading: false,\r\n        error: errorMessage,\r\n      }));\r\n    }\r\n  }, [filters]);\r\n\r\n  /**\r\n   * Actualiza los filtros y obtiene productos\r\n   */\r\n  const updateFilters = useCallback((newFilters: Partial<ProductFilters>) => {\r\n    const updatedFilters = { ...filters, ...newFilters };\r\n    setFilters(updatedFilters);\r\n    fetchProducts(updatedFilters);\r\n  }, [filters, fetchProducts]);\r\n\r\n  /**\r\n   * Cambia la página\r\n   */\r\n  const changePage = useCallback((page: number) => {\r\n    updateFilters({ page });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Cambia el límite de productos por página\r\n   */\r\n  const changeLimit = useCallback((limit: number) => {\r\n    updateFilters({ limit, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Cambia el ordenamiento\r\n   */\r\n  const changeSorting = useCallback((sortBy: 'price' | 'name' | 'created_at', sortOrder: 'asc' | 'desc') => {\r\n    updateFilters({ sortBy, sortOrder, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Busca productos por término\r\n   */\r\n  const searchProducts = useCallback((searchTerm: string) => {\r\n    updateFilters({ search: searchTerm, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Filtra por categoría\r\n   */\r\n  const filterByCategory = useCallback((category: string) => {\r\n    updateFilters({ category, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Filtra por rango de precios\r\n   */\r\n  const filterByPriceRange = useCallback((priceMin?: number, priceMax?: number) => {\r\n    updateFilters({ priceMin, priceMax, page: 1 });\r\n  }, [updateFilters]);\r\n\r\n  /**\r\n   * Limpia todos los filtros\r\n   */\r\n  const clearFilters = useCallback(() => {\r\n    const clearedFilters: ProductFilters = {\r\n      page: 1,\r\n      limit: filters.limit || 12,\r\n      sortBy: 'created_at',\r\n      sortOrder: 'desc',\r\n    };\r\n    setFilters(clearedFilters);\r\n    fetchProducts(clearedFilters);\r\n  }, [filters.limit, fetchProducts]);\r\n\r\n  /**\r\n   * Refresca los productos\r\n   */\r\n  const refresh = useCallback(() => {\r\n    fetchProducts();\r\n  }, [fetchProducts]);\r\n\r\n  // Auto-fetch al montar el componente\r\n  useEffect(() => {\r\n    if (autoFetch) {\r\n      fetchProducts();\r\n    }\r\n  }, [autoFetch]); // Removido fetchProducts de las dependencias para evitar bucles\r\n\r\n  // Cleanup effect para cancelar requests pendientes\r\n  useEffect(() => {\r\n    return () => {\r\n      if (abortControllerRef.current) {\r\n        abortControllerRef.current.abort();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Memoized helpers para optimizar renders\r\n  const helpers = useMemo(() => ({\r\n    hasProducts: state.products.length > 0,\r\n    isEmpty: !state.loading && state.products.length === 0,\r\n    hasError: !!state.error,\r\n    hasNextPage: state.pagination.page < state.pagination.totalPages,\r\n    hasPrevPage: state.pagination.page > 1,\r\n  }), [state.products.length, state.loading, state.error, state.pagination.page, state.pagination.totalPages]);\r\n\r\n  return {\r\n    // Estado\r\n    products: state.products,\r\n    loading: state.loading,\r\n    error: state.error,\r\n    pagination: state.pagination,\r\n    filters,\r\n\r\n    // Acciones\r\n    fetchProducts,\r\n    updateFilters,\r\n    changePage,\r\n    changeLimit,\r\n    changeSorting,\r\n    searchProducts,\r\n    filterByCategory,\r\n    filterByPriceRange,\r\n    clearFilters,\r\n    refresh,\r\n\r\n    // Helpers memoizados\r\n    ...helpers,\r\n  };\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["useProducts","options","initialFilters","autoFetch","abortControllerRef","useRef","lastRequestRef","process","env","NODE_ENV","state","setState","useState","products","loading","error","pagination","page","limit","total","totalPages","filters","setFilters","fetchProducts","useCallback","newFilters","filtersToUse","prev","response","getProducts","success","adaptedProducts","adaptApiProductsToLegacy","data","errorMessage","Error","message","updateFilters","updatedFilters","changePage","changeLimit","changeSorting","sortBy","sortOrder","searchProducts","searchTerm","search","filterByCategory","category","filterByPriceRange","priceMin","priceMax","clearFilters","clearedFilters","refresh","useEffect","current","abort","helpers","useMemo","hasProducts","length","isEmpty","hasError","hasNextPage","hasPrevPage"],"mappings":"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"}