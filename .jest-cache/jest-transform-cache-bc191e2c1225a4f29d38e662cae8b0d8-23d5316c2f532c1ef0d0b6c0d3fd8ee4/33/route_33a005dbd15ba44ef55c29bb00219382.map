{"version":3,"names":["cov_5x8mfq68q","actualCoverage","s","GET","f","runtime","request","authResult","_adminauth","getAuthenticatedUser","userId","b","_server","NextResponse","json","success","error","migration","status","oldMethod","newMethod","note","clerkUserId","console","log","profile","getUserProfile","debug","profileExists","hasRole","user_roles","errorMessage","Error","message"],"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\debug\\get-user-profile\\route.ts"],"sourcesContent":["// Configuraci√≥n para Node.js Runtime\r\nexport const runtime = 'nodejs';\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { getUserProfile, getAuthenticatedUser } from '@/lib/auth/admin-auth';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // MIGRADO: Usar getAuthenticatedUser en lugar de headers\r\n    const authResult = await getAuthenticatedUser(request);\r\n\r\n    if (!authResult.userId) {\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: authResult.error || 'Usuario no autenticado',\r\n        migration: {\r\n          status: 'MIGRATED',\r\n          oldMethod: 'headers x-clerk-user-id',\r\n          newMethod: 'getAuthenticatedUser()',\r\n          note: 'Ya no usa headers directamente'\r\n        }\r\n      }, { status: 401 });\r\n    }\r\n\r\n    const clerkUserId = authResult.userId;\r\n\r\n    console.log('üîç Debug getUserProfile: Testing with user:', clerkUserId);\r\n\r\n    const profile = await getUserProfile(clerkUserId);\r\n\r\n    if (!profile) {\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: 'Profile not found',\r\n        debug: {\r\n          clerkUserId,\r\n          profileExists: false\r\n        }\r\n      }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      profile: profile,\r\n      debug: {\r\n        clerkUserId,\r\n        profileExists: true,\r\n        hasRole: !!profile.user_roles\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('üîç Debug getUserProfile: Error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      error: 'Unexpected error',\r\n      debug: {\r\n        errorMessage: error instanceof Error ? error.message : 'Unknown error'\r\n      }\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]}