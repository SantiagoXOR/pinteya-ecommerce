99ca49b7a4af57165d9c810defd650f8
// ===================================
// HOOK: useRecentSearches - Gestión de búsquedas recientes con localStorage
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get default () {
        return _default;
    },
    get useRecentSearches () {
        return useRecentSearches;
    },
    get useRecentSearchesSimple () {
        return useRecentSearchesSimple;
    }
});
const _react = require("react");
const _jsonutils = require("../lib/json-utils");
const DEFAULT_OPTIONS = {
    maxSearches: 5,
    storageKey: 'pinteya-recent-searches',
    enablePersistence: true,
    filterDuplicates: true,
    expirationDays: 30
};
function useRecentSearches(options = {}) {
    const config = {
        ...DEFAULT_OPTIONS,
        ...options
    };
    const [recentSearches, setRecentSearches] = (0, _react.useState)([]);
    // Función para validar y limpiar una búsqueda
    const sanitizeSearch = (0, _react.useCallback)((search)=>{
        return search.trim().toLowerCase();
    }, []);
    // Función para verificar si los datos han expirado
    const isExpired = (0, _react.useCallback)((timestamp)=>{
        if (config.expirationDays === 0) {
            return false;
        }
        const maxAge = config.expirationDays * 24 * 60 * 60 * 1000;
        return Date.now() - timestamp > maxAge;
    }, [
        config.expirationDays
    ]);
    // Cargar búsquedas desde localStorage
    const loadFromStorage = (0, _react.useCallback)(()=>{
        if (!config.enablePersistence) {
            return [];
        }
        // Usar utilidad segura para cargar desde localStorage
        const result = (0, _jsonutils.safeLocalStorageGet)(config.storageKey);
        if (!result.success) {
            return [];
        }
        const data = result.data;
        // Verificar si es formato nuevo (con metadata)
        if (data && typeof data === 'object' && 'searches' in data && Array.isArray(data.searches)) {
            const persistedData = data;
            // Verificar expiración
            if (persistedData.timestamp && isExpired(persistedData.timestamp)) {
                // Limpiar datos expirados usando utilidad segura
                (0, _jsonutils.safeLocalStorageSet)(config.storageKey, {
                    searches: [],
                    timestamp: Date.now(),
                    version: '1.0'
                });
                return [];
            }
            return persistedData.searches.slice(0, config.maxSearches);
        }
        // Formato antiguo (array simple)
        if (Array.isArray(data)) {
            return data.slice(0, config.maxSearches);
        }
        return [];
    }, [
        config.enablePersistence,
        config.storageKey,
        config.maxSearches,
        isExpired
    ]);
    // Guardar búsquedas en localStorage
    const saveToStorage = (0, _react.useCallback)((searches)=>{
        if (!config.enablePersistence || typeof window === 'undefined') {
            return;
        }
        try {
            if (searches.length === 0) {
                localStorage.removeItem(config.storageKey);
                return;
            }
            const dataToStore = {
                searches: searches.slice(0, config.maxSearches),
                timestamp: Date.now(),
                version: '1.0.0'
            };
            localStorage.setItem(config.storageKey, JSON.stringify(dataToStore));
        } catch (error) {
            console.warn('Error saving recent searches to localStorage:', error);
        }
    }, [
        config.enablePersistence,
        config.storageKey,
        config.maxSearches
    ]);
    // Cargar búsquedas al inicializar
    (0, _react.useEffect)(()=>{
        const loaded = loadFromStorage();
        setRecentSearches(loaded);
    }, [
        loadFromStorage
    ]);
    // Agregar una nueva búsqueda
    const addSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        if (!sanitized || sanitized.length < 2) {
            return;
        }
        setRecentSearches((prev)=>{
            let updated = [
                ...prev
            ];
            // Remover duplicados si está habilitado
            if (config.filterDuplicates) {
                updated = updated.filter((s)=>sanitizeSearch(s) !== sanitized);
            }
            // Agregar al principio
            updated.unshift(search.trim());
            // Limitar al máximo configurado
            updated = updated.slice(0, config.maxSearches);
            // Guardar en localStorage
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        config.filterDuplicates,
        config.maxSearches,
        saveToStorage
    ]);
    // Remover una búsqueda específica
    const removeSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        setRecentSearches((prev)=>{
            const updated = prev.filter((s)=>sanitizeSearch(s) !== sanitized);
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        saveToStorage
    ]);
    // Limpiar todas las búsquedas
    const clearSearches = (0, _react.useCallback)(()=>{
        setRecentSearches([]);
        saveToStorage([]);
    }, [
        saveToStorage
    ]);
    // Verificar si una búsqueda existe
    const hasSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        return recentSearches.some((s)=>sanitizeSearch(s) === sanitized);
    }, [
        recentSearches,
        sanitizeSearch
    ]);
    // Obtener las N búsquedas más recientes
    const getRecentSearches = (0, _react.useCallback)((limit)=>{
        const actualLimit = limit ?? config.maxSearches;
        return recentSearches.slice(0, actualLimit);
    }, [
        recentSearches,
        config.maxSearches
    ]);
    // Mover una búsqueda al principio (reordenar)
    const moveToTop = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        setRecentSearches((prev)=>{
            const filtered = prev.filter((s)=>sanitizeSearch(s) !== sanitized);
            const existing = prev.find((s)=>sanitizeSearch(s) === sanitized);
            if (!existing) {
                return prev;
            }
            const updated = [
                existing,
                ...filtered
            ];
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        saveToStorage
    ]);
    return {
        recentSearches,
        addSearch,
        removeSearch,
        clearSearches,
        hasSearch,
        getRecentSearches,
        moveToTop
    };
}
function useRecentSearchesSimple(limit = 5) {
    const { getRecentSearches } = useRecentSearches({
        maxSearches: limit
    });
    return getRecentSearches();
}
const _default = useRecentSearches;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZVJlY2VudFNlYXJjaGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIT09LOiB1c2VSZWNlbnRTZWFyY2hlcyAtIEdlc3Rpw7NuIGRlIGLDunNxdWVkYXMgcmVjaWVudGVzIGNvbiBsb2NhbFN0b3JhZ2Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBzYWZlTG9jYWxTdG9yYWdlR2V0LCBzYWZlTG9jYWxTdG9yYWdlU2V0LCBTVE9SQUdFX0tFWVMgfSBmcm9tICdAL2xpYi9qc29uLXV0aWxzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIFJlY2VudFNlYXJjaGVzT3B0aW9ucyB7XG4gIC8qKiBOw7ptZXJvIG3DoXhpbW8gZGUgYsO6c3F1ZWRhcyByZWNpZW50ZXMgYSBtYW50ZW5lciAqL1xuICBtYXhTZWFyY2hlcz86IG51bWJlclxuICAvKiogQ2xhdmUgZGUgbG9jYWxTdG9yYWdlIHBhcmEgcGVyc2lzdGlyIGxhcyBiw7pzcXVlZGFzICovXG4gIHN0b3JhZ2VLZXk/OiBzdHJpbmdcbiAgLyoqIEhhYmlsaXRhci9kZXNoYWJpbGl0YXIgcGVyc2lzdGVuY2lhIGVuIGxvY2FsU3RvcmFnZSAqL1xuICBlbmFibGVQZXJzaXN0ZW5jZT86IGJvb2xlYW5cbiAgLyoqIEZpbHRyYXIgYsO6c3F1ZWRhcyBkdXBsaWNhZGFzICovXG4gIGZpbHRlckR1cGxpY2F0ZXM/OiBib29sZWFuXG4gIC8qKiBUaWVtcG8gZGUgZXhwaXJhY2nDs24gZW4gZMOtYXMgKDAgPSBzaW4gZXhwaXJhY2nDs24pICovXG4gIGV4cGlyYXRpb25EYXlzPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjZW50U2VhcmNoZXNSZXR1cm4ge1xuICAvKiogQXJyYXkgZGUgYsO6c3F1ZWRhcyByZWNpZW50ZXMgKi9cbiAgcmVjZW50U2VhcmNoZXM6IHN0cmluZ1tdXG4gIC8qKiBBZ3JlZ2FyIHVuYSBudWV2YSBiw7pzcXVlZGEgKi9cbiAgYWRkU2VhcmNoOiAoc2VhcmNoOiBzdHJpbmcpID0+IHZvaWRcbiAgLyoqIFJlbW92ZXIgdW5hIGLDunNxdWVkYSBlc3BlY8OtZmljYSAqL1xuICByZW1vdmVTZWFyY2g6IChzZWFyY2g6IHN0cmluZykgPT4gdm9pZFxuICAvKiogTGltcGlhciB0b2RhcyBsYXMgYsO6c3F1ZWRhcyAqL1xuICBjbGVhclNlYXJjaGVzOiAoKSA9PiB2b2lkXG4gIC8qKiBWZXJpZmljYXIgc2kgdW5hIGLDunNxdWVkYSBleGlzdGUgKi9cbiAgaGFzU2VhcmNoOiAoc2VhcmNoOiBzdHJpbmcpID0+IGJvb2xlYW5cbiAgLyoqIE9idGVuZXIgbGFzIE4gYsO6c3F1ZWRhcyBtw6FzIHJlY2llbnRlcyAqL1xuICBnZXRSZWNlbnRTZWFyY2hlczogKGxpbWl0PzogbnVtYmVyKSA9PiBzdHJpbmdbXVxuICAvKiogUmVvcmRlbmFyIGLDunNxdWVkYXMgKG1vdmVyIGFsIHByaW5jaXBpbykgKi9cbiAgbW92ZVRvVG9wOiAoc2VhcmNoOiBzdHJpbmcpID0+IHZvaWRcbn1cblxuaW50ZXJmYWNlIFBlcnNpc3RlZFNlYXJjaERhdGEge1xuICBzZWFyY2hlczogc3RyaW5nW11cbiAgdGltZXN0YW1wOiBudW1iZXJcbiAgdmVyc2lvbjogc3RyaW5nXG59XG5cbmNvbnN0IERFRkFVTFRfT1BUSU9OUzogUmVxdWlyZWQ8UmVjZW50U2VhcmNoZXNPcHRpb25zPiA9IHtcbiAgbWF4U2VhcmNoZXM6IDUsXG4gIHN0b3JhZ2VLZXk6ICdwaW50ZXlhLXJlY2VudC1zZWFyY2hlcycsXG4gIGVuYWJsZVBlcnNpc3RlbmNlOiB0cnVlLFxuICBmaWx0ZXJEdXBsaWNhdGVzOiB0cnVlLFxuICBleHBpcmF0aW9uRGF5czogMzAsIC8vIDMwIGTDrWFzIGRlIGV4cGlyYWNpw7NuXG59XG5cbi8qKlxuICogSG9vayBwYXJhIGdlc3Rpb25hciBiw7pzcXVlZGFzIHJlY2llbnRlcyBjb24gcGVyc2lzdGVuY2lhIGVuIGxvY2FsU3RvcmFnZVxuICpcbiAqIENhcmFjdGVyw61zdGljYXM6XG4gKiAtIFBlcnNpc3RlbmNpYSBhdXRvbcOhdGljYSBlbiBsb2NhbFN0b3JhZ2VcbiAqIC0gTMOtbWl0ZSBjb25maWd1cmFibGUgZGUgYsO6c3F1ZWRhc1xuICogLSBGaWx0cmFkbyBkZSBkdXBsaWNhZG9zXG4gKiAtIEV4cGlyYWNpw7NuIGF1dG9tw6F0aWNhXG4gKiAtIE1hbmVqbyBkZSBlcnJvcmVzIHJvYnVzdG9cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVJlY2VudFNlYXJjaGVzKG9wdGlvbnM6IFJlY2VudFNlYXJjaGVzT3B0aW9ucyA9IHt9KTogUmVjZW50U2VhcmNoZXNSZXR1cm4ge1xuICBjb25zdCBjb25maWcgPSB7IC4uLkRFRkFVTFRfT1BUSU9OUywgLi4ub3B0aW9ucyB9XG4gIGNvbnN0IFtyZWNlbnRTZWFyY2hlcywgc2V0UmVjZW50U2VhcmNoZXNdID0gdXNlU3RhdGU8c3RyaW5nW10+KFtdKVxuXG4gIC8vIEZ1bmNpw7NuIHBhcmEgdmFsaWRhciB5IGxpbXBpYXIgdW5hIGLDunNxdWVkYVxuICBjb25zdCBzYW5pdGl6ZVNlYXJjaCA9IHVzZUNhbGxiYWNrKChzZWFyY2g6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgcmV0dXJuIHNlYXJjaC50cmltKCkudG9Mb3dlckNhc2UoKVxuICB9LCBbXSlcblxuICAvLyBGdW5jacOzbiBwYXJhIHZlcmlmaWNhciBzaSBsb3MgZGF0b3MgaGFuIGV4cGlyYWRvXG4gIGNvbnN0IGlzRXhwaXJlZCA9IHVzZUNhbGxiYWNrKFxuICAgICh0aW1lc3RhbXA6IG51bWJlcik6IGJvb2xlYW4gPT4ge1xuICAgICAgaWYgKGNvbmZpZy5leHBpcmF0aW9uRGF5cyA9PT0gMCkge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cbiAgICAgIGNvbnN0IG1heEFnZSA9IGNvbmZpZy5leHBpcmF0aW9uRGF5cyAqIDI0ICogNjAgKiA2MCAqIDEwMDBcbiAgICAgIHJldHVybiBEYXRlLm5vdygpIC0gdGltZXN0YW1wID4gbWF4QWdlXG4gICAgfSxcbiAgICBbY29uZmlnLmV4cGlyYXRpb25EYXlzXVxuICApXG5cbiAgLy8gQ2FyZ2FyIGLDunNxdWVkYXMgZGVzZGUgbG9jYWxTdG9yYWdlXG4gIGNvbnN0IGxvYWRGcm9tU3RvcmFnZSA9IHVzZUNhbGxiYWNrKCgpOiBzdHJpbmdbXSA9PiB7XG4gICAgaWYgKCFjb25maWcuZW5hYmxlUGVyc2lzdGVuY2UpIHtcbiAgICAgIHJldHVybiBbXVxuICAgIH1cblxuICAgIC8vIFVzYXIgdXRpbGlkYWQgc2VndXJhIHBhcmEgY2FyZ2FyIGRlc2RlIGxvY2FsU3RvcmFnZVxuICAgIGNvbnN0IHJlc3VsdCA9IHNhZmVMb2NhbFN0b3JhZ2VHZXQ8UGVyc2lzdGVkU2VhcmNoRGF0YSB8IHN0cmluZ1tdPihjb25maWcuc3RvcmFnZUtleSlcblxuICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHJldHVybiBbXVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSByZXN1bHQuZGF0YVxuXG4gICAgLy8gVmVyaWZpY2FyIHNpIGVzIGZvcm1hdG8gbnVldm8gKGNvbiBtZXRhZGF0YSlcbiAgICBpZiAoZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgJ3NlYXJjaGVzJyBpbiBkYXRhICYmIEFycmF5LmlzQXJyYXkoZGF0YS5zZWFyY2hlcykpIHtcbiAgICAgIGNvbnN0IHBlcnNpc3RlZERhdGEgPSBkYXRhIGFzIFBlcnNpc3RlZFNlYXJjaERhdGFcblxuICAgICAgLy8gVmVyaWZpY2FyIGV4cGlyYWNpw7NuXG4gICAgICBpZiAocGVyc2lzdGVkRGF0YS50aW1lc3RhbXAgJiYgaXNFeHBpcmVkKHBlcnNpc3RlZERhdGEudGltZXN0YW1wKSkge1xuICAgICAgICAvLyBMaW1waWFyIGRhdG9zIGV4cGlyYWRvcyB1c2FuZG8gdXRpbGlkYWQgc2VndXJhXG4gICAgICAgIHNhZmVMb2NhbFN0b3JhZ2VTZXQoY29uZmlnLnN0b3JhZ2VLZXksIHtcbiAgICAgICAgICBzZWFyY2hlczogW10sXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgIHZlcnNpb246ICcxLjAnLFxuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gW11cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHBlcnNpc3RlZERhdGEuc2VhcmNoZXMuc2xpY2UoMCwgY29uZmlnLm1heFNlYXJjaGVzKVxuICAgIH1cblxuICAgIC8vIEZvcm1hdG8gYW50aWd1byAoYXJyYXkgc2ltcGxlKVxuICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG4gICAgICByZXR1cm4gZGF0YS5zbGljZSgwLCBjb25maWcubWF4U2VhcmNoZXMpXG4gICAgfVxuXG4gICAgcmV0dXJuIFtdXG4gIH0sIFtjb25maWcuZW5hYmxlUGVyc2lzdGVuY2UsIGNvbmZpZy5zdG9yYWdlS2V5LCBjb25maWcubWF4U2VhcmNoZXMsIGlzRXhwaXJlZF0pXG5cbiAgLy8gR3VhcmRhciBiw7pzcXVlZGFzIGVuIGxvY2FsU3RvcmFnZVxuICBjb25zdCBzYXZlVG9TdG9yYWdlID0gdXNlQ2FsbGJhY2soXG4gICAgKHNlYXJjaGVzOiBzdHJpbmdbXSk6IHZvaWQgPT4ge1xuICAgICAgaWYgKCFjb25maWcuZW5hYmxlUGVyc2lzdGVuY2UgfHwgdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGlmIChzZWFyY2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShjb25maWcuc3RvcmFnZUtleSlcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRhdGFUb1N0b3JlOiBQZXJzaXN0ZWRTZWFyY2hEYXRhID0ge1xuICAgICAgICAgIHNlYXJjaGVzOiBzZWFyY2hlcy5zbGljZSgwLCBjb25maWcubWF4U2VhcmNoZXMpLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICB2ZXJzaW9uOiAnMS4wLjAnLFxuICAgICAgICB9XG5cbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oY29uZmlnLnN0b3JhZ2VLZXksIEpTT04uc3RyaW5naWZ5KGRhdGFUb1N0b3JlKSlcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignRXJyb3Igc2F2aW5nIHJlY2VudCBzZWFyY2hlcyB0byBsb2NhbFN0b3JhZ2U6JywgZXJyb3IpXG4gICAgICB9XG4gICAgfSxcbiAgICBbY29uZmlnLmVuYWJsZVBlcnNpc3RlbmNlLCBjb25maWcuc3RvcmFnZUtleSwgY29uZmlnLm1heFNlYXJjaGVzXVxuICApXG5cbiAgLy8gQ2FyZ2FyIGLDunNxdWVkYXMgYWwgaW5pY2lhbGl6YXJcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBsb2FkZWQgPSBsb2FkRnJvbVN0b3JhZ2UoKVxuICAgIHNldFJlY2VudFNlYXJjaGVzKGxvYWRlZClcbiAgfSwgW2xvYWRGcm9tU3RvcmFnZV0pXG5cbiAgLy8gQWdyZWdhciB1bmEgbnVldmEgYsO6c3F1ZWRhXG4gIGNvbnN0IGFkZFNlYXJjaCA9IHVzZUNhbGxiYWNrKFxuICAgIChzZWFyY2g6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgICAgY29uc3Qgc2FuaXRpemVkID0gc2FuaXRpemVTZWFyY2goc2VhcmNoKVxuICAgICAgaWYgKCFzYW5pdGl6ZWQgfHwgc2FuaXRpemVkLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIHNldFJlY2VudFNlYXJjaGVzKHByZXYgPT4ge1xuICAgICAgICBsZXQgdXBkYXRlZCA9IFsuLi5wcmV2XVxuXG4gICAgICAgIC8vIFJlbW92ZXIgZHVwbGljYWRvcyBzaSBlc3TDoSBoYWJpbGl0YWRvXG4gICAgICAgIGlmIChjb25maWcuZmlsdGVyRHVwbGljYXRlcykge1xuICAgICAgICAgIHVwZGF0ZWQgPSB1cGRhdGVkLmZpbHRlcihzID0+IHNhbml0aXplU2VhcmNoKHMpICE9PSBzYW5pdGl6ZWQpXG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZ3JlZ2FyIGFsIHByaW5jaXBpb1xuICAgICAgICB1cGRhdGVkLnVuc2hpZnQoc2VhcmNoLnRyaW0oKSlcblxuICAgICAgICAvLyBMaW1pdGFyIGFsIG3DoXhpbW8gY29uZmlndXJhZG9cbiAgICAgICAgdXBkYXRlZCA9IHVwZGF0ZWQuc2xpY2UoMCwgY29uZmlnLm1heFNlYXJjaGVzKVxuXG4gICAgICAgIC8vIEd1YXJkYXIgZW4gbG9jYWxTdG9yYWdlXG4gICAgICAgIHNhdmVUb1N0b3JhZ2UodXBkYXRlZClcblxuICAgICAgICByZXR1cm4gdXBkYXRlZFxuICAgICAgfSlcbiAgICB9LFxuICAgIFtzYW5pdGl6ZVNlYXJjaCwgY29uZmlnLmZpbHRlckR1cGxpY2F0ZXMsIGNvbmZpZy5tYXhTZWFyY2hlcywgc2F2ZVRvU3RvcmFnZV1cbiAgKVxuXG4gIC8vIFJlbW92ZXIgdW5hIGLDunNxdWVkYSBlc3BlY8OtZmljYVxuICBjb25zdCByZW1vdmVTZWFyY2ggPSB1c2VDYWxsYmFjayhcbiAgICAoc2VhcmNoOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplU2VhcmNoKHNlYXJjaClcblxuICAgICAgc2V0UmVjZW50U2VhcmNoZXMocHJldiA9PiB7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWQgPSBwcmV2LmZpbHRlcihzID0+IHNhbml0aXplU2VhcmNoKHMpICE9PSBzYW5pdGl6ZWQpXG4gICAgICAgIHNhdmVUb1N0b3JhZ2UodXBkYXRlZClcbiAgICAgICAgcmV0dXJuIHVwZGF0ZWRcbiAgICAgIH0pXG4gICAgfSxcbiAgICBbc2FuaXRpemVTZWFyY2gsIHNhdmVUb1N0b3JhZ2VdXG4gIClcblxuICAvLyBMaW1waWFyIHRvZGFzIGxhcyBiw7pzcXVlZGFzXG4gIGNvbnN0IGNsZWFyU2VhcmNoZXMgPSB1c2VDYWxsYmFjaygoKTogdm9pZCA9PiB7XG4gICAgc2V0UmVjZW50U2VhcmNoZXMoW10pXG4gICAgc2F2ZVRvU3RvcmFnZShbXSlcbiAgfSwgW3NhdmVUb1N0b3JhZ2VdKVxuXG4gIC8vIFZlcmlmaWNhciBzaSB1bmEgYsO6c3F1ZWRhIGV4aXN0ZVxuICBjb25zdCBoYXNTZWFyY2ggPSB1c2VDYWxsYmFjayhcbiAgICAoc2VhcmNoOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplU2VhcmNoKHNlYXJjaClcbiAgICAgIHJldHVybiByZWNlbnRTZWFyY2hlcy5zb21lKHMgPT4gc2FuaXRpemVTZWFyY2gocykgPT09IHNhbml0aXplZClcbiAgICB9LFxuICAgIFtyZWNlbnRTZWFyY2hlcywgc2FuaXRpemVTZWFyY2hdXG4gIClcblxuICAvLyBPYnRlbmVyIGxhcyBOIGLDunNxdWVkYXMgbcOhcyByZWNpZW50ZXNcbiAgY29uc3QgZ2V0UmVjZW50U2VhcmNoZXMgPSB1c2VDYWxsYmFjayhcbiAgICAobGltaXQ/OiBudW1iZXIpOiBzdHJpbmdbXSA9PiB7XG4gICAgICBjb25zdCBhY3R1YWxMaW1pdCA9IGxpbWl0ID8/IGNvbmZpZy5tYXhTZWFyY2hlc1xuICAgICAgcmV0dXJuIHJlY2VudFNlYXJjaGVzLnNsaWNlKDAsIGFjdHVhbExpbWl0KVxuICAgIH0sXG4gICAgW3JlY2VudFNlYXJjaGVzLCBjb25maWcubWF4U2VhcmNoZXNdXG4gIClcblxuICAvLyBNb3ZlciB1bmEgYsO6c3F1ZWRhIGFsIHByaW5jaXBpbyAocmVvcmRlbmFyKVxuICBjb25zdCBtb3ZlVG9Ub3AgPSB1c2VDYWxsYmFjayhcbiAgICAoc2VhcmNoOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IHNhbml0aXplZCA9IHNhbml0aXplU2VhcmNoKHNlYXJjaClcblxuICAgICAgc2V0UmVjZW50U2VhcmNoZXMocHJldiA9PiB7XG4gICAgICAgIGNvbnN0IGZpbHRlcmVkID0gcHJldi5maWx0ZXIocyA9PiBzYW5pdGl6ZVNlYXJjaChzKSAhPT0gc2FuaXRpemVkKVxuICAgICAgICBjb25zdCBleGlzdGluZyA9IHByZXYuZmluZChzID0+IHNhbml0aXplU2VhcmNoKHMpID09PSBzYW5pdGl6ZWQpXG5cbiAgICAgICAgaWYgKCFleGlzdGluZykge1xuICAgICAgICAgIHJldHVybiBwcmV2XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1cGRhdGVkID0gW2V4aXN0aW5nLCAuLi5maWx0ZXJlZF1cbiAgICAgICAgc2F2ZVRvU3RvcmFnZSh1cGRhdGVkKVxuICAgICAgICByZXR1cm4gdXBkYXRlZFxuICAgICAgfSlcbiAgICB9LFxuICAgIFtzYW5pdGl6ZVNlYXJjaCwgc2F2ZVRvU3RvcmFnZV1cbiAgKVxuXG4gIHJldHVybiB7XG4gICAgcmVjZW50U2VhcmNoZXMsXG4gICAgYWRkU2VhcmNoLFxuICAgIHJlbW92ZVNlYXJjaCxcbiAgICBjbGVhclNlYXJjaGVzLFxuICAgIGhhc1NlYXJjaCxcbiAgICBnZXRSZWNlbnRTZWFyY2hlcyxcbiAgICBtb3ZlVG9Ub3AsXG4gIH1cbn1cblxuLyoqXG4gKiBIb29rIHNpbXBsaWZpY2FkbyBwYXJhIHNvbG8gb2J0ZW5lciBiw7pzcXVlZGFzIHJlY2llbnRlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlUmVjZW50U2VhcmNoZXNTaW1wbGUobGltaXQ6IG51bWJlciA9IDUpOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHsgZ2V0UmVjZW50U2VhcmNoZXMgfSA9IHVzZVJlY2VudFNlYXJjaGVzKHsgbWF4U2VhcmNoZXM6IGxpbWl0IH0pXG4gIHJldHVybiBnZXRSZWNlbnRTZWFyY2hlcygpXG59XG5cbmV4cG9ydCBkZWZhdWx0IHVzZVJlY2VudFNlYXJjaGVzXG4iXSwibmFtZXMiOlsidXNlUmVjZW50U2VhcmNoZXMiLCJ1c2VSZWNlbnRTZWFyY2hlc1NpbXBsZSIsIkRFRkFVTFRfT1BUSU9OUyIsIm1heFNlYXJjaGVzIiwic3RvcmFnZUtleSIsImVuYWJsZVBlcnNpc3RlbmNlIiwiZmlsdGVyRHVwbGljYXRlcyIsImV4cGlyYXRpb25EYXlzIiwib3B0aW9ucyIsImNvbmZpZyIsInJlY2VudFNlYXJjaGVzIiwic2V0UmVjZW50U2VhcmNoZXMiLCJ1c2VTdGF0ZSIsInNhbml0aXplU2VhcmNoIiwidXNlQ2FsbGJhY2siLCJzZWFyY2giLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJpc0V4cGlyZWQiLCJ0aW1lc3RhbXAiLCJtYXhBZ2UiLCJEYXRlIiwibm93IiwibG9hZEZyb21TdG9yYWdlIiwicmVzdWx0Iiwic2FmZUxvY2FsU3RvcmFnZUdldCIsInN1Y2Nlc3MiLCJkYXRhIiwiQXJyYXkiLCJpc0FycmF5Iiwic2VhcmNoZXMiLCJwZXJzaXN0ZWREYXRhIiwic2FmZUxvY2FsU3RvcmFnZVNldCIsInZlcnNpb24iLCJzbGljZSIsInNhdmVUb1N0b3JhZ2UiLCJ3aW5kb3ciLCJsZW5ndGgiLCJsb2NhbFN0b3JhZ2UiLCJyZW1vdmVJdGVtIiwiZGF0YVRvU3RvcmUiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsImVycm9yIiwiY29uc29sZSIsIndhcm4iLCJ1c2VFZmZlY3QiLCJsb2FkZWQiLCJhZGRTZWFyY2giLCJzYW5pdGl6ZWQiLCJwcmV2IiwidXBkYXRlZCIsImZpbHRlciIsInMiLCJ1bnNoaWZ0IiwicmVtb3ZlU2VhcmNoIiwiY2xlYXJTZWFyY2hlcyIsImhhc1NlYXJjaCIsInNvbWUiLCJnZXRSZWNlbnRTZWFyY2hlcyIsImxpbWl0IiwiYWN0dWFsTGltaXQiLCJtb3ZlVG9Ub3AiLCJmaWx0ZXJlZCIsImV4aXN0aW5nIiwiZmluZCJdLCJtYXBwaW5ncyI6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