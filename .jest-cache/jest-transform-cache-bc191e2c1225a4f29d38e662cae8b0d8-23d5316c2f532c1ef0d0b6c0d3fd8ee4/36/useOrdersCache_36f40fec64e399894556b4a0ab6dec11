e4e51b774aba52aaf935a7fd03d7268d
// ===================================
// PINTEYA E-COMMERCE - ORDERS CACHE HOOK
// Hook especializado para manejo de cache de órdenes
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "useOrdersCache", {
    enumerable: true,
    get: function() {
        return useOrdersCache;
    }
});
const _react = require("react");
// Configuración de cache
const CACHE_CONFIG = {
    MAX_SIZE: 50,
    CLEANUP_INTERVAL: 10 * 60 * 1000,
    MIN_REQUEST_INTERVAL: 1000
};
// ===================================
// CACHE GLOBAL
// ===================================
// Cache compartido entre instancias del hook
const cache = new Map();
const pendingRequests = new Map();
const requestTimestamps = new Map();
// ===================================
// UTILIDADES DE CACHE
// ===================================
function getCacheKey(filters) {
    // Crear clave más estable ordenando las propiedades y normalizando valores
    const normalizedFilters = Object.keys(filters).sort().reduce((result, key)=>{
        const value = filters[key];
        // Normalizar valores para evitar claves duplicadas
        if (value !== undefined && value !== null && value !== '' && value !== 'all') {
            result[key] = value;
        }
        return result;
    }, {});
    return JSON.stringify(normalizedFilters);
}
function cleanupExpiredCache(cacheTimeout) {
    const now = Date.now();
    const expiredKeys = [];
    cache.forEach((entry, key)=>{
        if (now - entry.timestamp > cacheTimeout) {
            expiredKeys.push(key);
        }
    });
    expiredKeys.forEach((key)=>{
        cache.delete(key);
        requestTimestamps.delete(key);
    });
    // Limpiar cache si está muy grande
    if (cache.size > CACHE_CONFIG.MAX_SIZE) {
        const entries = Array.from(cache.entries());
        entries.sort((a, b)=>a[1].timestamp - b[1].timestamp);
        const toDelete = entries.slice(0, cache.size - CACHE_CONFIG.MAX_SIZE);
        toDelete.forEach(([key])=>{
            cache.delete(key);
            requestTimestamps.delete(key);
        });
    }
    if (process.env.NODE_ENV === 'development') {
        console.log('[useOrdersCache] Cache cleanup completed:', {
            expired: expiredKeys.length,
            currentSize: cache.size,
            maxSize: CACHE_CONFIG.MAX_SIZE
        });
    }
}
function useOrdersCache(options) {
    const lastCleanupRef = (0, _react.useRef)(Date.now());
    const getCachedData = (0, _react.useCallback)((filters)=>{
        if (!options.enableCache) {
            return null;
        }
        const key = getCacheKey(filters);
        const entry = cache.get(key);
        if (!entry) {
            return null;
        }
        const isExpired = Date.now() - entry.timestamp > options.cacheTimeout;
        if (isExpired) {
            cache.delete(key);
            requestTimestamps.delete(key);
            return null;
        }
        // Log de cache hit en desarrollo
        if (process.env.NODE_ENV === 'development') {
            console.log('[useOrdersCache] Cache hit:', {
                key: key.substring(0, 100) + '...',
                age: Date.now() - entry.timestamp,
                cacheSize: cache.size
            });
        }
        return entry.data;
    }, [
        options.enableCache,
        options.cacheTimeout
    ]);
    const setCachedData = (0, _react.useCallback)((filters, data)=>{
        if (!options.enableCache) {
            return;
        }
        const key = getCacheKey(filters);
        const requestId = Math.random().toString(36).substr(2, 9);
        cache.set(key, {
            data,
            timestamp: Date.now(),
            filters,
            requestId
        });
        requestTimestamps.set(key, Date.now());
        // Cleanup automático periódico
        const now = Date.now();
        if (now - lastCleanupRef.current > (options.cleanupInterval || CACHE_CONFIG.CLEANUP_INTERVAL)) {
            cleanupExpiredCache(options.cacheTimeout);
            lastCleanupRef.current = now;
        }
        if (process.env.NODE_ENV === 'development') {
            console.log('[useOrdersCache] Data cached:', {
                key: key.substring(0, 100) + '...',
                cacheSize: cache.size,
                requestId
            });
        }
    }, [
        options.enableCache,
        options.cacheTimeout,
        options.cleanupInterval
    ]);
    const clearCache = (0, _react.useCallback)(()=>{
        cache.clear();
        pendingRequests.clear();
        requestTimestamps.clear();
        if (process.env.NODE_ENV === 'development') {
            console.log('[useOrdersCache] Cache cleared');
        }
    }, []);
    const isRequestTooRecent = (0, _react.useCallback)((filters)=>{
        const key = getCacheKey(filters);
        const lastRequestTime = requestTimestamps.get(key);
        if (!lastRequestTime) {
            return false;
        }
        const timeSinceLastRequest = Date.now() - lastRequestTime;
        return timeSinceLastRequest < (options.minRequestInterval || CACHE_CONFIG.MIN_REQUEST_INTERVAL);
    }, [
        options.minRequestInterval
    ]);
    const setPendingRequest = (0, _react.useCallback)((filters, promise)=>{
        const key = getCacheKey(filters);
        pendingRequests.set(key, promise);
        // Limpiar cuando la promesa se resuelve
        promise.finally(()=>{
            pendingRequests.delete(key);
        });
    }, []);
    const getPendingRequest = (0, _react.useCallback)((filters)=>{
        const key = getCacheKey(filters);
        return pendingRequests.get(key) || null;
    }, []);
    const getCacheStats = (0, _react.useCallback)(()=>({
            size: cache.size,
            maxSize: options.maxSize || CACHE_CONFIG.MAX_SIZE,
            pendingRequests: pendingRequests.size
        }), [
        options.maxSize
    ]);
    return {
        getCachedData,
        setCachedData,
        clearCache,
        isRequestTooRecent,
        setPendingRequest,
        getPendingRequest,
        getCacheStats
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXGFkbWluXFx1c2VPcmRlcnNDYWNoZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQSU5URVlBIEUtQ09NTUVSQ0UgLSBPUkRFUlMgQ0FDSEUgSE9PS1xyXG4vLyBIb29rIGVzcGVjaWFsaXphZG8gcGFyYSBtYW5lam8gZGUgY2FjaGUgZGUgw7NyZGVuZXNcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IHVzZUNhbGxiYWNrLCB1c2VSZWYgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCB7IFN0cmljdE9yZGVyc0xpc3RSZXNwb25zZSB9IGZyb20gJ0AvdHlwZXMvYXBpLXN0cmljdCc7XHJcbmltcG9ydCB7IFN0cmljdE9yZGVyRmlsdGVycyB9IGZyb20gJy4vdXNlT3JkZXJzRW50ZXJwcmlzZVN0cmljdCc7XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBUSVBPUyBZIENPTkZJR1VSQUNJw5NOXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5pbnRlcmZhY2UgQ2FjaGVFbnRyeSB7XHJcbiAgZGF0YTogU3RyaWN0T3JkZXJzTGlzdFJlc3BvbnNlO1xyXG4gIHRpbWVzdGFtcDogbnVtYmVyO1xyXG4gIGZpbHRlcnM6IFN0cmljdE9yZGVyRmlsdGVycztcclxuICByZXF1ZXN0SWQ6IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIENhY2hlT3B0aW9ucyB7XHJcbiAgZW5hYmxlQ2FjaGU6IGJvb2xlYW47XHJcbiAgY2FjaGVUaW1lb3V0OiBudW1iZXI7XHJcbiAgbWF4U2l6ZT86IG51bWJlcjtcclxuICBjbGVhbnVwSW50ZXJ2YWw/OiBudW1iZXI7XHJcbiAgbWluUmVxdWVzdEludGVydmFsPzogbnVtYmVyO1xyXG59XHJcblxyXG4vLyBDb25maWd1cmFjacOzbiBkZSBjYWNoZVxyXG5jb25zdCBDQUNIRV9DT05GSUcgPSB7XHJcbiAgTUFYX1NJWkU6IDUwLFxyXG4gIENMRUFOVVBfSU5URVJWQUw6IDEwICogNjAgKiAxMDAwLCAvLyAxMCBtaW51dG9zXHJcbiAgTUlOX1JFUVVFU1RfSU5URVJWQUw6IDEwMDAsIC8vIDEgc2VndW5kbyBtw61uaW1vIGVudHJlIHBldGljaW9uZXMgaWTDqW50aWNhc1xyXG59IGFzIGNvbnN0O1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gQ0FDSEUgR0xPQkFMXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4vLyBDYWNoZSBjb21wYXJ0aWRvIGVudHJlIGluc3RhbmNpYXMgZGVsIGhvb2tcclxuY29uc3QgY2FjaGUgPSBuZXcgTWFwPHN0cmluZywgQ2FjaGVFbnRyeT4oKTtcclxuY29uc3QgcGVuZGluZ1JlcXVlc3RzID0gbmV3IE1hcDxzdHJpbmcsIFByb21pc2U8YW55Pj4oKTtcclxuY29uc3QgcmVxdWVzdFRpbWVzdGFtcHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gVVRJTElEQURFUyBERSBDQUNIRVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuZnVuY3Rpb24gZ2V0Q2FjaGVLZXkoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzKTogc3RyaW5nIHtcclxuICAvLyBDcmVhciBjbGF2ZSBtw6FzIGVzdGFibGUgb3JkZW5hbmRvIGxhcyBwcm9waWVkYWRlcyB5IG5vcm1hbGl6YW5kbyB2YWxvcmVzXHJcbiAgY29uc3Qgbm9ybWFsaXplZEZpbHRlcnMgPSBPYmplY3Qua2V5cyhmaWx0ZXJzKVxyXG4gICAgLnNvcnQoKVxyXG4gICAgLnJlZHVjZSgocmVzdWx0LCBrZXkpID0+IHtcclxuICAgICAgY29uc3QgdmFsdWUgPSBmaWx0ZXJzW2tleSBhcyBrZXlvZiBTdHJpY3RPcmRlckZpbHRlcnNdO1xyXG4gICAgICAvLyBOb3JtYWxpemFyIHZhbG9yZXMgcGFyYSBldml0YXIgY2xhdmVzIGR1cGxpY2FkYXNcclxuICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09ICcnICYmIHZhbHVlICE9PSAnYWxsJykge1xyXG4gICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH0sIHt9IGFzIGFueSk7XHJcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG5vcm1hbGl6ZWRGaWx0ZXJzKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2xlYW51cEV4cGlyZWRDYWNoZShjYWNoZVRpbWVvdXQ6IG51bWJlcik6IHZvaWQge1xyXG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgY29uc3QgZXhwaXJlZEtleXM6IHN0cmluZ1tdID0gW107XHJcbiAgXHJcbiAgY2FjaGUuZm9yRWFjaCgoZW50cnksIGtleSkgPT4ge1xyXG4gICAgaWYgKG5vdyAtIGVudHJ5LnRpbWVzdGFtcCA+IGNhY2hlVGltZW91dCkge1xyXG4gICAgICBleHBpcmVkS2V5cy5wdXNoKGtleSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgXHJcbiAgZXhwaXJlZEtleXMuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgY2FjaGUuZGVsZXRlKGtleSk7XHJcbiAgICByZXF1ZXN0VGltZXN0YW1wcy5kZWxldGUoa2V5KTtcclxuICB9KTtcclxuICBcclxuICAvLyBMaW1waWFyIGNhY2hlIHNpIGVzdMOhIG11eSBncmFuZGVcclxuICBpZiAoY2FjaGUuc2l6ZSA+IENBQ0hFX0NPTkZJRy5NQVhfU0laRSkge1xyXG4gICAgY29uc3QgZW50cmllcyA9IEFycmF5LmZyb20oY2FjaGUuZW50cmllcygpKTtcclxuICAgIGVudHJpZXMuc29ydCgoYSwgYikgPT4gYVsxXS50aW1lc3RhbXAgLSBiWzFdLnRpbWVzdGFtcCk7XHJcbiAgICBcclxuICAgIGNvbnN0IHRvRGVsZXRlID0gZW50cmllcy5zbGljZSgwLCBjYWNoZS5zaXplIC0gQ0FDSEVfQ09ORklHLk1BWF9TSVpFKTtcclxuICAgIHRvRGVsZXRlLmZvckVhY2goKFtrZXldKSA9PiB7XHJcbiAgICAgIGNhY2hlLmRlbGV0ZShrZXkpO1xyXG4gICAgICByZXF1ZXN0VGltZXN0YW1wcy5kZWxldGUoa2V5KTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBcclxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgIGNvbnNvbGUubG9nKCdbdXNlT3JkZXJzQ2FjaGVdIENhY2hlIGNsZWFudXAgY29tcGxldGVkOicsIHtcclxuICAgICAgZXhwaXJlZDogZXhwaXJlZEtleXMubGVuZ3RoLFxyXG4gICAgICBjdXJyZW50U2l6ZTogY2FjaGUuc2l6ZSxcclxuICAgICAgbWF4U2l6ZTogQ0FDSEVfQ09ORklHLk1BWF9TSVpFXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEhPT0sgREUgQ0FDSEVcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVXNlT3JkZXJzQ2FjaGVSZXR1cm4ge1xyXG4gIGdldENhY2hlZERhdGE6IChmaWx0ZXJzOiBTdHJpY3RPcmRlckZpbHRlcnMpID0+IFN0cmljdE9yZGVyc0xpc3RSZXNwb25zZSB8IG51bGw7XHJcbiAgc2V0Q2FjaGVkRGF0YTogKGZpbHRlcnM6IFN0cmljdE9yZGVyRmlsdGVycywgZGF0YTogU3RyaWN0T3JkZXJzTGlzdFJlc3BvbnNlKSA9PiB2b2lkO1xyXG4gIGNsZWFyQ2FjaGU6ICgpID0+IHZvaWQ7XHJcbiAgaXNSZXF1ZXN0VG9vUmVjZW50OiAoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzKSA9PiBib29sZWFuO1xyXG4gIHNldFBlbmRpbmdSZXF1ZXN0OiAoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzLCBwcm9taXNlOiBQcm9taXNlPGFueT4pID0+IHZvaWQ7XHJcbiAgZ2V0UGVuZGluZ1JlcXVlc3Q6IChmaWx0ZXJzOiBTdHJpY3RPcmRlckZpbHRlcnMpID0+IFByb21pc2U8YW55PiB8IG51bGw7XHJcbiAgZ2V0Q2FjaGVTdGF0czogKCkgPT4geyBzaXplOiBudW1iZXI7IG1heFNpemU6IG51bWJlcjsgcGVuZGluZ1JlcXVlc3RzOiBudW1iZXIgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVzZU9yZGVyc0NhY2hlKG9wdGlvbnM6IENhY2hlT3B0aW9ucyk6IFVzZU9yZGVyc0NhY2hlUmV0dXJuIHtcclxuICBjb25zdCBsYXN0Q2xlYW51cFJlZiA9IHVzZVJlZjxudW1iZXI+KERhdGUubm93KCkpO1xyXG4gIFxyXG4gIGNvbnN0IGdldENhY2hlZERhdGEgPSB1c2VDYWxsYmFjaygoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzKTogU3RyaWN0T3JkZXJzTGlzdFJlc3BvbnNlIHwgbnVsbCA9PiB7XHJcbiAgICBpZiAoIW9wdGlvbnMuZW5hYmxlQ2FjaGUpIHtyZXR1cm4gbnVsbDt9XHJcbiAgICBcclxuICAgIGNvbnN0IGtleSA9IGdldENhY2hlS2V5KGZpbHRlcnMpO1xyXG4gICAgY29uc3QgZW50cnkgPSBjYWNoZS5nZXQoa2V5KTtcclxuICAgIFxyXG4gICAgaWYgKCFlbnRyeSkge3JldHVybiBudWxsO31cclxuICAgIFxyXG4gICAgY29uc3QgaXNFeHBpcmVkID0gRGF0ZS5ub3coKSAtIGVudHJ5LnRpbWVzdGFtcCA+IG9wdGlvbnMuY2FjaGVUaW1lb3V0O1xyXG4gICAgaWYgKGlzRXhwaXJlZCkge1xyXG4gICAgICBjYWNoZS5kZWxldGUoa2V5KTtcclxuICAgICAgcmVxdWVzdFRpbWVzdGFtcHMuZGVsZXRlKGtleSk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBMb2cgZGUgY2FjaGUgaGl0IGVuIGRlc2Fycm9sbG9cclxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xyXG4gICAgICBjb25zb2xlLmxvZygnW3VzZU9yZGVyc0NhY2hlXSBDYWNoZSBoaXQ6JywgeyBcclxuICAgICAgICBrZXk6IGtleS5zdWJzdHJpbmcoMCwgMTAwKSArICcuLi4nLCBcclxuICAgICAgICBhZ2U6IERhdGUubm93KCkgLSBlbnRyeS50aW1lc3RhbXAsXHJcbiAgICAgICAgY2FjaGVTaXplOiBjYWNoZS5zaXplIFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGVudHJ5LmRhdGE7XHJcbiAgfSwgW29wdGlvbnMuZW5hYmxlQ2FjaGUsIG9wdGlvbnMuY2FjaGVUaW1lb3V0XSk7XHJcbiAgXHJcbiAgY29uc3Qgc2V0Q2FjaGVkRGF0YSA9IHVzZUNhbGxiYWNrKChmaWx0ZXJzOiBTdHJpY3RPcmRlckZpbHRlcnMsIGRhdGE6IFN0cmljdE9yZGVyc0xpc3RSZXNwb25zZSk6IHZvaWQgPT4ge1xyXG4gICAgaWYgKCFvcHRpb25zLmVuYWJsZUNhY2hlKSB7cmV0dXJuO31cclxuICAgIFxyXG4gICAgY29uc3Qga2V5ID0gZ2V0Q2FjaGVLZXkoZmlsdGVycyk7XHJcbiAgICBjb25zdCByZXF1ZXN0SWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XHJcbiAgICBcclxuICAgIGNhY2hlLnNldChrZXksIHtcclxuICAgICAgZGF0YSxcclxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxyXG4gICAgICBmaWx0ZXJzLFxyXG4gICAgICByZXF1ZXN0SWRcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICByZXF1ZXN0VGltZXN0YW1wcy5zZXQoa2V5LCBEYXRlLm5vdygpKTtcclxuICAgIFxyXG4gICAgLy8gQ2xlYW51cCBhdXRvbcOhdGljbyBwZXJpw7NkaWNvXHJcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xyXG4gICAgaWYgKG5vdyAtIGxhc3RDbGVhbnVwUmVmLmN1cnJlbnQgPiAob3B0aW9ucy5jbGVhbnVwSW50ZXJ2YWwgfHwgQ0FDSEVfQ09ORklHLkNMRUFOVVBfSU5URVJWQUwpKSB7XHJcbiAgICAgIGNsZWFudXBFeHBpcmVkQ2FjaGUob3B0aW9ucy5jYWNoZVRpbWVvdXQpO1xyXG4gICAgICBsYXN0Q2xlYW51cFJlZi5jdXJyZW50ID0gbm93O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1t1c2VPcmRlcnNDYWNoZV0gRGF0YSBjYWNoZWQ6Jywge1xyXG4gICAgICAgIGtleToga2V5LnN1YnN0cmluZygwLCAxMDApICsgJy4uLicsXHJcbiAgICAgICAgY2FjaGVTaXplOiBjYWNoZS5zaXplLFxyXG4gICAgICAgIHJlcXVlc3RJZFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9LCBbb3B0aW9ucy5lbmFibGVDYWNoZSwgb3B0aW9ucy5jYWNoZVRpbWVvdXQsIG9wdGlvbnMuY2xlYW51cEludGVydmFsXSk7XHJcbiAgXHJcbiAgY29uc3QgY2xlYXJDYWNoZSA9IHVzZUNhbGxiYWNrKCgpOiB2b2lkID0+IHtcclxuICAgIGNhY2hlLmNsZWFyKCk7XHJcbiAgICBwZW5kaW5nUmVxdWVzdHMuY2xlYXIoKTtcclxuICAgIHJlcXVlc3RUaW1lc3RhbXBzLmNsZWFyKCk7XHJcbiAgICBcclxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xyXG4gICAgICBjb25zb2xlLmxvZygnW3VzZU9yZGVyc0NhY2hlXSBDYWNoZSBjbGVhcmVkJyk7XHJcbiAgICB9XHJcbiAgfSwgW10pO1xyXG4gIFxyXG4gIGNvbnN0IGlzUmVxdWVzdFRvb1JlY2VudCA9IHVzZUNhbGxiYWNrKChmaWx0ZXJzOiBTdHJpY3RPcmRlckZpbHRlcnMpOiBib29sZWFuID0+IHtcclxuICAgIGNvbnN0IGtleSA9IGdldENhY2hlS2V5KGZpbHRlcnMpO1xyXG4gICAgY29uc3QgbGFzdFJlcXVlc3RUaW1lID0gcmVxdWVzdFRpbWVzdGFtcHMuZ2V0KGtleSk7XHJcbiAgICBcclxuICAgIGlmICghbGFzdFJlcXVlc3RUaW1lKSB7cmV0dXJuIGZhbHNlO31cclxuICAgIFxyXG4gICAgY29uc3QgdGltZVNpbmNlTGFzdFJlcXVlc3QgPSBEYXRlLm5vdygpIC0gbGFzdFJlcXVlc3RUaW1lO1xyXG4gICAgcmV0dXJuIHRpbWVTaW5jZUxhc3RSZXF1ZXN0IDwgKG9wdGlvbnMubWluUmVxdWVzdEludGVydmFsIHx8IENBQ0hFX0NPTkZJRy5NSU5fUkVRVUVTVF9JTlRFUlZBTCk7XHJcbiAgfSwgW29wdGlvbnMubWluUmVxdWVzdEludGVydmFsXSk7XHJcbiAgXHJcbiAgY29uc3Qgc2V0UGVuZGluZ1JlcXVlc3QgPSB1c2VDYWxsYmFjaygoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzLCBwcm9taXNlOiBQcm9taXNlPGFueT4pOiB2b2lkID0+IHtcclxuICAgIGNvbnN0IGtleSA9IGdldENhY2hlS2V5KGZpbHRlcnMpO1xyXG4gICAgcGVuZGluZ1JlcXVlc3RzLnNldChrZXksIHByb21pc2UpO1xyXG4gICAgXHJcbiAgICAvLyBMaW1waWFyIGN1YW5kbyBsYSBwcm9tZXNhIHNlIHJlc3VlbHZlXHJcbiAgICBwcm9taXNlLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBwZW5kaW5nUmVxdWVzdHMuZGVsZXRlKGtleSk7XHJcbiAgICB9KTtcclxuICB9LCBbXSk7XHJcbiAgXHJcbiAgY29uc3QgZ2V0UGVuZGluZ1JlcXVlc3QgPSB1c2VDYWxsYmFjaygoZmlsdGVyczogU3RyaWN0T3JkZXJGaWx0ZXJzKTogUHJvbWlzZTxhbnk+IHwgbnVsbCA9PiB7XHJcbiAgICBjb25zdCBrZXkgPSBnZXRDYWNoZUtleShmaWx0ZXJzKTtcclxuICAgIHJldHVybiBwZW5kaW5nUmVxdWVzdHMuZ2V0KGtleSkgfHwgbnVsbDtcclxuICB9LCBbXSk7XHJcbiAgXHJcbiAgY29uc3QgZ2V0Q2FjaGVTdGF0cyA9IHVzZUNhbGxiYWNrKCgpID0+ICh7XHJcbiAgICBzaXplOiBjYWNoZS5zaXplLFxyXG4gICAgbWF4U2l6ZTogb3B0aW9ucy5tYXhTaXplIHx8IENBQ0hFX0NPTkZJRy5NQVhfU0laRSxcclxuICAgIHBlbmRpbmdSZXF1ZXN0czogcGVuZGluZ1JlcXVlc3RzLnNpemVcclxuICB9KSwgW29wdGlvbnMubWF4U2l6ZV0pO1xyXG4gIFxyXG4gIHJldHVybiB7XHJcbiAgICBnZXRDYWNoZWREYXRhLFxyXG4gICAgc2V0Q2FjaGVkRGF0YSxcclxuICAgIGNsZWFyQ2FjaGUsXHJcbiAgICBpc1JlcXVlc3RUb29SZWNlbnQsXHJcbiAgICBzZXRQZW5kaW5nUmVxdWVzdCxcclxuICAgIGdldFBlbmRpbmdSZXF1ZXN0LFxyXG4gICAgZ2V0Q2FjaGVTdGF0c1xyXG4gIH07XHJcbn1cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbInVzZU9yZGVyc0NhY2hlIiwiQ0FDSEVfQ09ORklHIiwiTUFYX1NJWkUiLCJDTEVBTlVQX0lOVEVSVkFMIiwiTUlOX1JFUVVFU1RfSU5URVJWQUwiLCJjYWNoZSIsIk1hcCIsInBlbmRpbmdSZXF1ZXN0cyIsInJlcXVlc3RUaW1lc3RhbXBzIiwiZ2V0Q2FjaGVLZXkiLCJmaWx0ZXJzIiwibm9ybWFsaXplZEZpbHRlcnMiLCJPYmplY3QiLCJrZXlzIiwic29ydCIsInJlZHVjZSIsInJlc3VsdCIsImtleSIsInZhbHVlIiwidW5kZWZpbmVkIiwiSlNPTiIsInN0cmluZ2lmeSIsImNsZWFudXBFeHBpcmVkQ2FjaGUiLCJjYWNoZVRpbWVvdXQiLCJub3ciLCJEYXRlIiwiZXhwaXJlZEtleXMiLCJmb3JFYWNoIiwiZW50cnkiLCJ0aW1lc3RhbXAiLCJwdXNoIiwiZGVsZXRlIiwic2l6ZSIsImVudHJpZXMiLCJBcnJheSIsImZyb20iLCJhIiwiYiIsInRvRGVsZXRlIiwic2xpY2UiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJjb25zb2xlIiwibG9nIiwiZXhwaXJlZCIsImxlbmd0aCIsImN1cnJlbnRTaXplIiwibWF4U2l6ZSIsIm9wdGlvbnMiLCJsYXN0Q2xlYW51cFJlZiIsInVzZVJlZiIsImdldENhY2hlZERhdGEiLCJ1c2VDYWxsYmFjayIsImVuYWJsZUNhY2hlIiwiZ2V0IiwiaXNFeHBpcmVkIiwic3Vic3RyaW5nIiwiYWdlIiwiY2FjaGVTaXplIiwiZGF0YSIsInNldENhY2hlZERhdGEiLCJyZXF1ZXN0SWQiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJzZXQiLCJjdXJyZW50IiwiY2xlYW51cEludGVydmFsIiwiY2xlYXJDYWNoZSIsImNsZWFyIiwiaXNSZXF1ZXN0VG9vUmVjZW50IiwibGFzdFJlcXVlc3RUaW1lIiwidGltZVNpbmNlTGFzdFJlcXVlc3QiLCJtaW5SZXF1ZXN0SW50ZXJ2YWwiLCJzZXRQZW5kaW5nUmVxdWVzdCIsInByb21pc2UiLCJmaW5hbGx5IiwiZ2V0UGVuZGluZ1JlcXVlc3QiLCJnZXRDYWNoZVN0YXRzIl0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMseUNBQXlDO0FBQ3pDLHFEQUFxRDtBQUNyRCxzQ0FBc0M7Ozs7OytCQThHdEJBOzs7ZUFBQUE7Ozt1QkE1R29CO0FBdUJwQyx5QkFBeUI7QUFDekIsTUFBTUMsZUFBZTtJQUNuQkMsVUFBVTtJQUNWQyxrQkFBa0IsS0FBSyxLQUFLO0lBQzVCQyxzQkFBc0I7QUFDeEI7QUFFQSxzQ0FBc0M7QUFDdEMsZUFBZTtBQUNmLHNDQUFzQztB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