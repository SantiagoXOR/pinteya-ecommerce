37f49413630449805bddf9fb49120c25
// ===================================
// PINTEYA E-COMMERCE - ACTIVITY LOGGER UTILITY
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get getRequestInfo () {
        return getRequestInfo;
    },
    get logActivityFromClient () {
        return logActivityFromClient;
    },
    get logAuthActivity () {
        return logAuthActivity;
    },
    get logBulkActivity () {
        return logBulkActivity;
    },
    get logOrderActivity () {
        return logOrderActivity;
    },
    get logPreferenceActivity () {
        return logPreferenceActivity;
    },
    get logProfileActivity () {
        return logProfileActivity;
    },
    get logSecurityActivity () {
        return logSecurityActivity;
    },
    get logSessionActivity () {
        return logSessionActivity;
    },
    get logUserActivity () {
        return logUserActivity;
    }
});
const _supabase = require("../integrations/supabase");
async function logUserActivity(userId, activityData, options = {}) {
    try {
        const { skipIfError = true, includeTimestamp = true } = options;
        // Preparar datos de actividad
        const logData = {
            user_id: userId,
            action: activityData.action,
            category: activityData.category,
            description: activityData.description,
            metadata: activityData.metadata,
            ip_address: activityData.ip_address,
            user_agent: activityData.user_agent,
            ...includeTimestamp && {
                created_at: new Date().toISOString()
            }
        };
        // Insertar en base de datos
        const { error } = await _supabase.supabaseAdmin.from('user_activity').insert(logData);
        if (error) {
            console.error('Error al registrar actividad:', error);
            if (!skipIfError) {
                throw error;
            }
            return false;
        }
        return true;
    } catch (error) {
        console.error('Error en logUserActivity:', error);
        if (!options.skipIfError) {
            throw error;
        }
        return false;
    }
}
async function logAuthActivity(userId, action, metadata, request) {
    return logUserActivity(userId, {
        action,
        category: 'auth',
        description: `Usuario ${action}`,
        metadata: {
            timestamp: new Date().toISOString(),
            ...metadata
        },
        ip_address: request?.ip,
        user_agent: request?.userAgent
    });
}
async function logProfileActivity(userId, action, metadata, request) {
    return logUserActivity(userId, {
        action,
        category: 'profile',
        description: `Perfil: ${action.replace('_', ' ')}`,
        metadata,
        ip_address: request?.ip,
        user_agent: request?.userAgent
    });
}
async function logSecurityActivity(userId, action, metadata, request) {
    return logUserActivity(userId, {
        action,
        category: 'security',
        description: `Seguridad: ${action.replace('_', ' ')}`,
        metadata: {
            severity: action === 'suspicious_activity' ? 'high' : 'medium',
            ...metadata
        },
        ip_address: request?.ip,
        user_agent: request?.userAgent
    });
}
async function logSessionActivity(userId, action, metadata, request) {
    return logUserActivity(userId, {
        action,
        category: 'session',
        description: `Sesión: ${action.replace('_', ' ')}`,
        metadata: {
            device_info: metadata?.device_info,
            session_id: metadata?.session_id,
            ...metadata
        },
        ip_address: request?.ip,
        user_agent: request?.userAgent
    });
}
async function logOrderActivity(userId, action, orderId, metadata, request) {
    return logUserActivity(userId, {
        action,
        category: 'order',
        description: `Orden ${orderId}: ${action.replace('_', ' ')}`,
        metadata: {
            order_id: orderId,
            ...metadata
        },
        ip_address: request?.ip,
        user_agent: request?.userAgent
    });
}
async function logPreferenceActivity(userId, action, metadata, request) {
    return logUserActivity(userId, {
        action,
        category: 'preference',
        description: `Preferencias: ${action.replace('_', ' ')}`,
        metadata,
        ip_address: request?.ip,
        user_agent: request?.userAgent
    });
}
function getRequestInfo(request) {
    try {
        const ip = request.headers?.get?.('x-forwarded-for')?.split(',')[0]?.trim() || request.headers?.get?.('x-real-ip') || request.ip || 'unknown';
        const userAgent = request.headers?.get?.('user-agent') || 'unknown';
        return {
            ip,
            userAgent
        };
    } catch (error) {
        console.error('Error obteniendo información del request:', error);
        return {
            ip: 'unknown',
            userAgent: 'unknown'
        };
    }
}
async function logActivityFromClient(action, category, description, metadata) {
    try {
        const response = await fetch('/api/user/activity', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                action,
                category,
                description,
                metadata
            })
        });
        if (!response.ok) {
            console.error('Error al registrar actividad desde cliente:', response.statusText);
            return false;
        }
        const data = await response.json();
        return data.success || false;
    } catch (error) {
        console.error('Error en logActivityFromClient:', error);
        return false;
    }
}
async function logBulkActivity(activities, options = {}) {
    let success = 0;
    let failed = 0;
    for (const { userId, activityData } of activities){
        const result = await logUserActivity(userId, activityData, options);
        if (result) {
            success++;
        } else {
            failed++;
        }
    }
    return {
        success,
        failed
    };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhY3Rpdml0eVxcYWN0aXZpdHlMb2dnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBJTlRFWUEgRS1DT01NRVJDRSAtIEFDVElWSVRZIExPR0dFUiBVVElMSVRZXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyBzdXBhYmFzZUFkbWluIH0gZnJvbSAnQC9saWIvaW50ZWdyYXRpb25zL3N1cGFiYXNlJ1xuXG4vLyBUaXBvcyBwYXJhIGFjdGl2aWRhZFxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0eUxvZ0RhdGEge1xuICBhY3Rpb246IHN0cmluZ1xuICBjYXRlZ29yeTogJ2F1dGgnIHwgJ3Byb2ZpbGUnIHwgJ29yZGVyJyB8ICdzZWN1cml0eScgfCAnc2Vzc2lvbicgfCAncHJlZmVyZW5jZSdcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmdcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4gIGlwX2FkZHJlc3M/OiBzdHJpbmdcbiAgdXNlcl9hZ2VudD86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFjdGl2aXR5TG9nT3B0aW9ucyB7XG4gIHNraXBJZkVycm9yPzogYm9vbGVhblxuICBpbmNsdWRlVGltZXN0YW1wPzogYm9vbGVhblxufVxuXG4vKipcbiAqIEZ1bmNpw7NuIHV0aWxpdGFyaWEgY2VudHJhbGl6YWRhIHBhcmEgcmVnaXN0cmFyIGFjdGl2aWRhZCBkZSB1c3VhcmlvXG4gKiBQdWVkZSBzZXIgdXNhZGEgZGVzZGUgQVBJcyBkZWwgc2Vydmlkb3IgbyBkZXNkZSBlbCBjbGllbnRlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dVc2VyQWN0aXZpdHkoXG4gIHVzZXJJZDogc3RyaW5nLFxuICBhY3Rpdml0eURhdGE6IEFjdGl2aXR5TG9nRGF0YSxcbiAgb3B0aW9uczogQWN0aXZpdHlMb2dPcHRpb25zID0ge31cbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgc2tpcElmRXJyb3IgPSB0cnVlLCBpbmNsdWRlVGltZXN0YW1wID0gdHJ1ZSB9ID0gb3B0aW9uc1xuXG4gICAgLy8gUHJlcGFyYXIgZGF0b3MgZGUgYWN0aXZpZGFkXG4gICAgY29uc3QgbG9nRGF0YSA9IHtcbiAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgIGFjdGlvbjogYWN0aXZpdHlEYXRhLmFjdGlvbixcbiAgICAgIGNhdGVnb3J5OiBhY3Rpdml0eURhdGEuY2F0ZWdvcnksXG4gICAgICBkZXNjcmlwdGlvbjogYWN0aXZpdHlEYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgbWV0YWRhdGE6IGFjdGl2aXR5RGF0YS5tZXRhZGF0YSxcbiAgICAgIGlwX2FkZHJlc3M6IGFjdGl2aXR5RGF0YS5pcF9hZGRyZXNzLFxuICAgICAgdXNlcl9hZ2VudDogYWN0aXZpdHlEYXRhLnVzZXJfYWdlbnQsXG4gICAgICAuLi4oaW5jbHVkZVRpbWVzdGFtcCAmJiB7IGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9KSxcbiAgICB9XG5cbiAgICAvLyBJbnNlcnRhciBlbiBiYXNlIGRlIGRhdG9zXG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5mcm9tKCd1c2VyX2FjdGl2aXR5JykuaW5zZXJ0KGxvZ0RhdGEpXG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsIHJlZ2lzdHJhciBhY3RpdmlkYWQ6JywgZXJyb3IpXG4gICAgICBpZiAoIXNraXBJZkVycm9yKSB7XG4gICAgICAgIHRocm93IGVycm9yXG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIGxvZ1VzZXJBY3Rpdml0eTonLCBlcnJvcilcbiAgICBpZiAoIW9wdGlvbnMuc2tpcElmRXJyb3IpIHtcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICAgIHJldHVybiBmYWxzZVxuICB9XG59XG5cbi8qKlxuICogRnVuY2nDs24gZXNwZWPDrWZpY2EgcGFyYSBsb2dnaW5nIGRlIGF1dGVudGljYWNpw7NuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dBdXRoQWN0aXZpdHkoXG4gIHVzZXJJZDogc3RyaW5nLFxuICBhY3Rpb246ICdsb2dpbicgfCAnbG9nb3V0JyB8ICdyZWdpc3RlcicgfCAncGFzc3dvcmRfcmVzZXQnIHwgJ2VtYWlsX3ZlcmlmaWNhdGlvbicsXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PixcbiAgcmVxdWVzdD86IHsgaXA/OiBzdHJpbmc7IHVzZXJBZ2VudD86IHN0cmluZyB9XG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgcmV0dXJuIGxvZ1VzZXJBY3Rpdml0eSh1c2VySWQsIHtcbiAgICBhY3Rpb24sXG4gICAgY2F0ZWdvcnk6ICdhdXRoJyxcbiAgICBkZXNjcmlwdGlvbjogYFVzdWFyaW8gJHthY3Rpb259YCxcbiAgICBtZXRhZGF0YToge1xuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAuLi5tZXRhZGF0YSxcbiAgICB9LFxuICAgIGlwX2FkZHJlc3M6IHJlcXVlc3Q/LmlwLFxuICAgIHVzZXJfYWdlbnQ6IHJlcXVlc3Q/LnVzZXJBZ2VudCxcbiAgfSlcbn1cblxuLyoqXG4gKiBGdW5jacOzbiBlc3BlY8OtZmljYSBwYXJhIGxvZ2dpbmcgZGUgcGVyZmlsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dQcm9maWxlQWN0aXZpdHkoXG4gIHVzZXJJZDogc3RyaW5nLFxuICBhY3Rpb246XG4gICAgfCAndXBkYXRlX3Byb2ZpbGUnXG4gICAgfCAndXBsb2FkX2F2YXRhcidcbiAgICB8ICdkZWxldGVfYXZhdGFyJ1xuICAgIHwgJ2FkZF9hZGRyZXNzJ1xuICAgIHwgJ3VwZGF0ZV9hZGRyZXNzJ1xuICAgIHwgJ2RlbGV0ZV9hZGRyZXNzJyxcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICByZXF1ZXN0PzogeyBpcD86IHN0cmluZzsgdXNlckFnZW50Pzogc3RyaW5nIH1cbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICByZXR1cm4gbG9nVXNlckFjdGl2aXR5KHVzZXJJZCwge1xuICAgIGFjdGlvbixcbiAgICBjYXRlZ29yeTogJ3Byb2ZpbGUnLFxuICAgIGRlc2NyaXB0aW9uOiBgUGVyZmlsOiAke2FjdGlvbi5yZXBsYWNlKCdfJywgJyAnKX1gLFxuICAgIG1ldGFkYXRhLFxuICAgIGlwX2FkZHJlc3M6IHJlcXVlc3Q/LmlwLFxuICAgIHVzZXJfYWdlbnQ6IHJlcXVlc3Q/LnVzZXJBZ2VudCxcbiAgfSlcbn1cblxuLyoqXG4gKiBGdW5jacOzbiBlc3BlY8OtZmljYSBwYXJhIGxvZ2dpbmcgZGUgc2VndXJpZGFkXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dTZWN1cml0eUFjdGl2aXR5KFxuICB1c2VySWQ6IHN0cmluZyxcbiAgYWN0aW9uOlxuICAgIHwgJ2VuYWJsZV8yZmEnXG4gICAgfCAnZGlzYWJsZV8yZmEnXG4gICAgfCAndXBkYXRlX3NlY3VyaXR5X3NldHRpbmdzJ1xuICAgIHwgJ3N1c3BpY2lvdXNfYWN0aXZpdHknXG4gICAgfCAncGFzc3dvcmRfY2hhbmdlJyxcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICByZXF1ZXN0PzogeyBpcD86IHN0cmluZzsgdXNlckFnZW50Pzogc3RyaW5nIH1cbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICByZXR1cm4gbG9nVXNlckFjdGl2aXR5KHVzZXJJZCwge1xuICAgIGFjdGlvbixcbiAgICBjYXRlZ29yeTogJ3NlY3VyaXR5JyxcbiAgICBkZXNjcmlwdGlvbjogYFNlZ3VyaWRhZDogJHthY3Rpb24ucmVwbGFjZSgnXycsICcgJyl9YCxcbiAgICBtZXRhZGF0YToge1xuICAgICAgc2V2ZXJpdHk6IGFjdGlvbiA9PT0gJ3N1c3BpY2lvdXNfYWN0aXZpdHknID8gJ2hpZ2gnIDogJ21lZGl1bScsXG4gICAgICAuLi5tZXRhZGF0YSxcbiAgICB9LFxuICAgIGlwX2FkZHJlc3M6IHJlcXVlc3Q/LmlwLFxuICAgIHVzZXJfYWdlbnQ6IHJlcXVlc3Q/LnVzZXJBZ2VudCxcbiAgfSlcbn1cblxuLyoqXG4gKiBGdW5jacOzbiBlc3BlY8OtZmljYSBwYXJhIGxvZ2dpbmcgZGUgc2VzaW9uZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ1Nlc3Npb25BY3Rpdml0eShcbiAgdXNlcklkOiBzdHJpbmcsXG4gIGFjdGlvbjogJ3Nlc3Npb25fc3RhcnQnIHwgJ3Nlc3Npb25fZW5kJyB8ICdzZXNzaW9uX3RpbWVvdXQnIHwgJ3Jldm9rZV9zZXNzaW9uJyB8ICd0cnVzdF9kZXZpY2UnLFxuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gIHJlcXVlc3Q/OiB7IGlwPzogc3RyaW5nOyB1c2VyQWdlbnQ/OiBzdHJpbmcgfVxuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHJldHVybiBsb2dVc2VyQWN0aXZpdHkodXNlcklkLCB7XG4gICAgYWN0aW9uLFxuICAgIGNhdGVnb3J5OiAnc2Vzc2lvbicsXG4gICAgZGVzY3JpcHRpb246IGBTZXNpw7NuOiAke2FjdGlvbi5yZXBsYWNlKCdfJywgJyAnKX1gLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBkZXZpY2VfaW5mbzogbWV0YWRhdGE/LmRldmljZV9pbmZvLFxuICAgICAgc2Vzc2lvbl9pZDogbWV0YWRhdGE/LnNlc3Npb25faWQsXG4gICAgICAuLi5tZXRhZGF0YSxcbiAgICB9LFxuICAgIGlwX2FkZHJlc3M6IHJlcXVlc3Q/LmlwLFxuICAgIHVzZXJfYWdlbnQ6IHJlcXVlc3Q/LnVzZXJBZ2VudCxcbiAgfSlcbn1cblxuLyoqXG4gKiBGdW5jacOzbiBlc3BlY8OtZmljYSBwYXJhIGxvZ2dpbmcgZGUgw7NyZGVuZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ09yZGVyQWN0aXZpdHkoXG4gIHVzZXJJZDogc3RyaW5nLFxuICBhY3Rpb246XG4gICAgfCAnY3JlYXRlX29yZGVyJ1xuICAgIHwgJ3VwZGF0ZV9vcmRlcidcbiAgICB8ICdjYW5jZWxfb3JkZXInXG4gICAgfCAncGF5bWVudF9jb21wbGV0ZWQnXG4gICAgfCAnb3JkZXJfc2hpcHBlZCdcbiAgICB8ICdvcmRlcl9kZWxpdmVyZWQnLFxuICBvcmRlcklkOiBzdHJpbmcsXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PixcbiAgcmVxdWVzdD86IHsgaXA/OiBzdHJpbmc7IHVzZXJBZ2VudD86IHN0cmluZyB9XG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgcmV0dXJuIGxvZ1VzZXJBY3Rpdml0eSh1c2VySWQsIHtcbiAgICBhY3Rpb24sXG4gICAgY2F0ZWdvcnk6ICdvcmRlcicsXG4gICAgZGVzY3JpcHRpb246IGBPcmRlbiAke29yZGVySWR9OiAke2FjdGlvbi5yZXBsYWNlKCdfJywgJyAnKX1gLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBvcmRlcl9pZDogb3JkZXJJZCxcbiAgICAgIC4uLm1ldGFkYXRhLFxuICAgIH0sXG4gICAgaXBfYWRkcmVzczogcmVxdWVzdD8uaXAsXG4gICAgdXNlcl9hZ2VudDogcmVxdWVzdD8udXNlckFnZW50LFxuICB9KVxufVxuXG4vKipcbiAqIEZ1bmNpw7NuIGVzcGVjw61maWNhIHBhcmEgbG9nZ2luZyBkZSBwcmVmZXJlbmNpYXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ1ByZWZlcmVuY2VBY3Rpdml0eShcbiAgdXNlcklkOiBzdHJpbmcsXG4gIGFjdGlvbjogJ3VwZGF0ZV9ub3RpZmljYXRpb25zJyB8ICd1cGRhdGVfZGlzcGxheScgfCAndXBkYXRlX3ByaXZhY3knIHwgJ3VwZGF0ZV90aGVtZScsXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PixcbiAgcmVxdWVzdD86IHsgaXA/OiBzdHJpbmc7IHVzZXJBZ2VudD86IHN0cmluZyB9XG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgcmV0dXJuIGxvZ1VzZXJBY3Rpdml0eSh1c2VySWQsIHtcbiAgICBhY3Rpb24sXG4gICAgY2F0ZWdvcnk6ICdwcmVmZXJlbmNlJyxcbiAgICBkZXNjcmlwdGlvbjogYFByZWZlcmVuY2lhczogJHthY3Rpb24ucmVwbGFjZSgnXycsICcgJyl9YCxcbiAgICBtZXRhZGF0YSxcbiAgICBpcF9hZGRyZXNzOiByZXF1ZXN0Py5pcCxcbiAgICB1c2VyX2FnZW50OiByZXF1ZXN0Py51c2VyQWdlbnQsXG4gIH0pXG59XG5cbi8qKlxuICogRnVuY2nDs24gcGFyYSBvYnRlbmVyIGluZm9ybWFjacOzbiBkZWwgcmVxdWVzdCAocGFyYSB1c2FyIGVuIEFQSXMpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRSZXF1ZXN0SW5mbyhyZXF1ZXN0OiBSZXF1ZXN0IHwgYW55KTogeyBpcD86IHN0cmluZzsgdXNlckFnZW50Pzogc3RyaW5nIH0ge1xuICB0cnkge1xuICAgIGNvbnN0IGlwID1cbiAgICAgIHJlcXVlc3QuaGVhZGVycz8uZ2V0Py4oJ3gtZm9yd2FyZGVkLWZvcicpPy5zcGxpdCgnLCcpWzBdPy50cmltKCkgfHxcbiAgICAgIHJlcXVlc3QuaGVhZGVycz8uZ2V0Py4oJ3gtcmVhbC1pcCcpIHx8XG4gICAgICByZXF1ZXN0LmlwIHx8XG4gICAgICAndW5rbm93bidcblxuICAgIGNvbnN0IHVzZXJBZ2VudCA9IHJlcXVlc3QuaGVhZGVycz8uZ2V0Py4oJ3VzZXItYWdlbnQnKSB8fCAndW5rbm93bidcblxuICAgIHJldHVybiB7IGlwLCB1c2VyQWdlbnQgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG9idGVuaWVuZG8gaW5mb3JtYWNpw7NuIGRlbCByZXF1ZXN0OicsIGVycm9yKVxuICAgIHJldHVybiB7IGlwOiAndW5rbm93bicsIHVzZXJBZ2VudDogJ3Vua25vd24nIH1cbiAgfVxufVxuXG4vKipcbiAqIEZ1bmNpw7NuIHBhcmEgbG9nZ2luZyBkZXNkZSBlbCBjbGllbnRlICh1c2FuZG8gZmV0Y2ggYSBsYSBBUEkpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dBY3Rpdml0eUZyb21DbGllbnQoXG4gIGFjdGlvbjogc3RyaW5nLFxuICBjYXRlZ29yeTogQWN0aXZpdHlMb2dEYXRhWydjYXRlZ29yeSddLFxuICBkZXNjcmlwdGlvbj86IHN0cmluZyxcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL3VzZXIvYWN0aXZpdHknLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGFjdGlvbixcbiAgICAgICAgY2F0ZWdvcnksXG4gICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICBtZXRhZGF0YSxcbiAgICAgIH0pLFxuICAgIH0pXG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCByZWdpc3RyYXIgYWN0aXZpZGFkIGRlc2RlIGNsaWVudGU6JywgcmVzcG9uc2Uuc3RhdHVzVGV4dClcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICByZXR1cm4gZGF0YS5zdWNjZXNzIHx8IGZhbHNlXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gbG9nQWN0aXZpdHlGcm9tQ2xpZW50OicsIGVycm9yKVxuICAgIHJldHVybiBmYWxzZVxuICB9XG59XG5cbi8qKlxuICogRnVuY2nDs24gcGFyYSBsb2dnaW5nIG1hc2l2byAow7p0aWwgcGFyYSBtaWdyYWNpb25lcyBvIGltcG9ydGFjaW9uZXMpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dCdWxrQWN0aXZpdHkoXG4gIGFjdGl2aXRpZXM6IEFycmF5PHsgdXNlcklkOiBzdHJpbmc7IGFjdGl2aXR5RGF0YTogQWN0aXZpdHlMb2dEYXRhIH0+LFxuICBvcHRpb25zOiBBY3Rpdml0eUxvZ09wdGlvbnMgPSB7fVxuKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IG51bWJlcjsgZmFpbGVkOiBudW1iZXIgfT4ge1xuICBsZXQgc3VjY2VzcyA9IDBcbiAgbGV0IGZhaWxlZCA9IDBcblxuICBmb3IgKGNvbnN0IHsgdXNlcklkLCBhY3Rpdml0eURhdGEgfSBvZiBhY3Rpdml0aWVzKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbG9nVXNlckFjdGl2aXR5KHVzZXJJZCwgYWN0aXZpdHlEYXRhLCBvcHRpb25zKVxuICAgIGlmIChyZXN1bHQpIHtcbiAgICAgIHN1Y2Nlc3MrK1xuICAgIH0gZWxzZSB7XG4gICAgICBmYWlsZWQrK1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IHN1Y2Nlc3MsIGZhaWxlZCB9XG59XG4iXSwibmFtZXMiOlsiZ2V0UmVxdWVzdEluZm8iLCJsb2dBY3Rpdml0eUZyb21DbGllbnQiLCJsb2dBdXRoQWN0aXZpdHkiLCJsb2dCdWxrQWN0aXZpdHkiLCJsb2dPcmRlckFjdGl2aXR5IiwibG9nUHJlZmVyZW5jZUFjdGl2aXR5IiwibG9nUHJvZmlsZUFjdGl2aXR5IiwibG9nU2VjdXJpdHlBY3Rpdml0eSIsImxvZ1Nlc3Npb25BY3Rpdml0eSIsImxvZ1VzZXJBY3Rpdml0eSIsInVzZXJJZCIsImFjdGl2aXR5RGF0YSIsIm9wdGlvbnMiLCJza2lwSWZFcnJvciIsImluY2x1ZGVUaW1lc3RhbXAiLCJsb2dEYXRhIiwidXNlcl9pZCIsImFjdGlvbiIsImNhdGVnb3J5IiwiZGVzY3JpcHRpb24iLCJtZXRhZGF0YSIsImlwX2FkZHJlc3MiLCJ1c2VyX2FnZW50IiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImVycm9yIiwic3VwYWJhc2VBZG1pbiIsImZyb20iLCJpbnNlcnQiLCJjb25zb2xlIiwicmVxdWVzdCIsInRpbWVzdGFtcCIsImlwIiwidXNlckFnZW50IiwicmVwbGFjZSIsInNldmVyaXR5IiwiZGV2aWNlX2luZm8iLCJzZXNzaW9uX2lkIiwib3JkZXJJZCIsIm9yZGVyX2lkIiwiaGVhZGVycyIsImdldCIsInNwbGl0IiwidHJpbSIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm9rIiwic3RhdHVzVGV4dCIsImRhdGEiLCJqc29uIiwic3VjY2VzcyIsImFjdGl2aXRpZXMiLCJmYWlsZWQiLCJyZXN1bHQiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0QywrQ0FBK0M7QUFDL0Msc0NBQXNDOzs7Ozs7Ozs7Ozs7UUFvTnRCQTtlQUFBQTs7UUFvQk1DO2VBQUFBOztRQXJLQUM7ZUFBQUE7O1FBeU1BQztlQUFBQTs7UUF4R0FDO2VBQUFBOztRQTZCQUM7ZUFBQUE7O1FBeEdBQztlQUFBQTs7UUF5QkFDO2VBQUFBOztRQTJCQUM7ZUFBQUE7O1FBdEhBQztlQUFBQTs7OzBCQXJCUTtBQXFCdkIsZUFBZUEsZ0JBQ3BCQyxNQUFjLEVBQ2RDLFlBQTZCLEVBQzdCQyxVQUE4QixDQUFDLENBQUM7SUFFaEMsSUFBSTtRQUNGLE1BQU0sRUFBRUMsY0FBYyxJQUFJLEVBQUVDLG1CQUFtQixJQUFJLEVBQUUsR0FBR0Y7UUFFeEQsOEJBQThCO1FBQzlCLE1BQU1HLFVBQVU7WUFDZEMsU0FBU047WUFDVE8sUUFBUU4sYUFBYU0sTUFBTTtZQUMzQkMsVUFBVVAsYUFB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