{"version":3,"names":["cov_2f7wb2bs3l","actualCoverage","s","withAdminAuth","f","withPermissionCheck","permissions","b","handler","request","context","authResult","_adminauth","checkCRUDPermissions","allowed","_server","NextResponse","json","success","error","code","timestamp","Date","toISOString","path","url","status","console","resource","action"],"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\lib\\auth\\api-auth-middleware.ts"],"sourcesContent":["// üîß Enterprise API Auth Middleware\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { checkCRUDPermissions } from '@/lib/auth/admin-auth';\r\n\r\nexport function withAdminAuth(permissions: string[] = []) {\r\n  return function (handler: Function) {\r\n    return async function (request: NextRequest, context: any) {\r\n      try {\r\n        // Verificar autenticaci√≥n enterprise\r\n        const authResult = await checkCRUDPermissions('read', 'products');\r\n\r\n        if (!authResult.allowed) {\r\n          return NextResponse.json(\r\n            {\r\n              success: false,\r\n              error: authResult.error || 'Acceso denegado',\r\n              code: 'AUTH_ERROR',\r\n              timestamp: new Date().toISOString(),\r\n              path: request.url\r\n            },\r\n            { status: 401 }\r\n          );\r\n        }\r\n\r\n        return await handler(request, context);\r\n      } catch (error) {\r\n        console.error('Auth middleware error:', error);\r\n        return NextResponse.json(\r\n          {\r\n            success: false,\r\n            error: 'Error de autenticaci√≥n',\r\n            code: 'AUTH_ERROR',\r\n            timestamp: new Date().toISOString(),\r\n            path: request.url\r\n          },\r\n          { status: 500 }\r\n        );\r\n      }\r\n    };\r\n  };\r\n}\r\n\r\nexport function withPermissionCheck(resource: string, action: string) {\r\n  return function (handler: Function) {\r\n    return async function (request: NextRequest, context: any) {\r\n      try {\r\n        const authResult = await checkCRUDPermissions(action as 'create' | 'read' | 'update' | 'delete', resource);\r\n\r\n        if (!authResult.allowed) {\r\n          return NextResponse.json(\r\n            {\r\n              success: false,\r\n              error: authResult.error || 'Permisos insuficientes',\r\n              code: 'PERMISSION_DENIED',\r\n              timestamp: new Date().toISOString(),\r\n              path: request.url\r\n            },\r\n            { status: 403 }\r\n          );\r\n        }\r\n\r\n        return await handler(request, context);\r\n      } catch (error) {\r\n        console.error('Permission check error:', error);\r\n        return NextResponse.json(\r\n          {\r\n            success: false,\r\n            error: 'Error de verificaci√≥n de permisos',\r\n            code: 'PERMISSION_ERROR',\r\n            timestamp: new Date().toISOString(),\r\n            path: request.url\r\n          },\r\n          { status: 500 }\r\n        );\r\n      }\r\n    };\r\n  };\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]}