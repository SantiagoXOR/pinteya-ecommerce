8c95ae55b1efedf20ff80bd2a5659dfd
// ===================================
// HOOK: useSearch - Sistema de búsqueda centralizado
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get default () {
        return _default;
    },
    get useSearch () {
        return useSearch;
    }
});
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _navigation = require("next/navigation");
const _usedebounce = require("use-debounce");
const _products = require("../lib/api/products");
const _useSearchErrorHandler = require("./useSearchErrorHandler");
const _useSearchToast = require("./useSearchToast");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
// ===================================
// BÚSQUEDAS TRENDING POR DEFECTO
// ===================================
const defaultTrendingSearches = [
    {
        id: 'trending-1',
        type: 'trending',
        title: 'Pintura látex',
        href: '/search?q=pintura+latex'
    },
    {
        id: 'trending-2',
        type: 'trending',
        title: 'Sherwin Williams',
        href: '/search?q=sherwin+williams'
    },
    {
        id: 'trending-3',
        type: 'trending',
        title: 'Rodillos premium',
        href: '/search?q=rodillos+premium'
    },
    {
        id: 'trending-4',
        type: 'trending',
        title: 'Pinceles',
        href: '/search?q=pinceles'
    }
];
function useSearch(options = {}) {
    const { debounceMs = 150, maxSuggestions = 8, searchLimit = 12, saveRecentSearches = true, onSearch, onSuggestionSelect } = options;
    const router = (0, _navigation.useRouter)();
    const debounceRef = (0, _react.useRef)();
    const safetyTimeoutRef = (0, _react.useRef)() // Timeout de seguridad para evitar loading permanente
    ;
    const optionsRef = (0, _react.useRef)(options) // Ref para opciones estables
    ;
    const recentSearchesRef = (0, _react.useRef)([]) // Ref para búsquedas recientes
    ;
    // Hooks para manejo de errores y toast notifications
    const errorHandler = (0, _useSearchErrorHandler.useSearchErrorHandler)({
        onError: (error)=>{
            console.error('Error de búsqueda:', error);
        },
        onRetrySuccess: ()=>{
            toastHandler.showRetrySuccessToast();
        },
        onRetryFailed: (error, attempts)=>{
            toastHandler.showRetryFailedToast(attempts);
        }
    });
    const toastHandler = (0, _useSearchToast.useSearchToast)({
        defaultDuration: 4000,
        maxToasts: 2
    });
    // Actualizar ref cuando cambien las opciones
    optionsRef.current = options;
    // Estado principal
    const [state, setState] = (0, _react.useState)({
        query: '',
        results: [],
        suggestions: [],
        isLoading: false,
        error: null,
        hasSearched: false
    });
    const [recentSearches, setRecentSearches] = (0, _react.useState)([]);
    // Sincronizar referencia con estado para evitar dependencias en useCallback
    _react.default.useEffect(()=>{
        recentSearchesRef.current = recentSearches;
    }, [
        recentSearches
    ]);
    // ===================================
    // FUNCIONES AUXILIARES SIMPLIFICADAS
    // ===================================
    // ===================================
    // FUNCIONES PRINCIPALES CON USE-DEBOUNCE
    // ===================================
    /**
   * Función de búsqueda interna optimizada
   */ const performSearch = (0, _react.useCallback)(async (searchQuery)=>{
        // Limpiar timeout de seguridad anterior
        if (safetyTimeoutRef.current) {
            clearTimeout(safetyTimeoutRef.current);
        }
        // Si la query está vacía, mostrar sugerencias por defecto
        if (!searchQuery.trim()) {
            const defaultSuggestions = [
                ...defaultTrendingSearches.slice(0, 4),
                ...recentSearchesRef.current.slice(0, 3).map((search, index)=>({
                        id: `recent-${index}`,
                        type: 'recent',
                        title: search,
                        href: `/search?q=${encodeURIComponent(search)}`
                    }))
            ].slice(0, maxSuggestions);
            setState((prev)=>({
                    ...prev,
                    query: searchQuery,
                    suggestions: defaultSuggestions,
                    isLoading: false
                }));
            return;
        }
        // Timeout de seguridad para evitar loading permanente (5 segundos)
        safetyTimeoutRef.current = setTimeout(()=>{
            setState((prev)=>({
                    ...prev,
                    isLoading: false,
                    error: 'Tiempo de espera agotado. Intenta nuevamente.'
                }));
        }, 5000);
        // Ejecutar búsqueda directamente (el debounce se maneja en searchWithDebounce)
        try {
            const response = await (0, _products.searchProducts)(searchQuery, maxSuggestions);
            // Limpiar timeout de seguridad ya que la API respondió
            if (safetyTimeoutRef.current) {
                clearTimeout(safetyTimeoutRef.current);
            }
            if (response.success && response.data && Array.isArray(response.data)) {
                const productSuggestions = response.data.map((product)=>({
                        id: `product-${product.id}`,
                        type: 'product',
                        title: product.name,
                        subtitle: product.category?.name || 'Sin categoría',
                        image: product.images?.previews?.[0] || '/images/products/placeholder.jpg',
                        badge: product.stock > 0 ? 'En stock' : 'Sin stock',
                        href: `/shop-details/${product.id}`
                    }));
                setState((prev)=>({
                        ...prev,
                        query: searchQuery,
                        suggestions: productSuggestions,
                        isLoading: false,
                        error: null
                    }));
            } else {
                setState((prev)=>({
                        ...prev,
                        query: searchQuery,
                        suggestions: [],
                        isLoading: false,
                        error: response.error || 'No se encontraron resultados'
                    }));
            }
        } catch (error) {
            console.error('❌ useSearch: Error en búsqueda:', error);
            // Limpiar timeout de seguridad
            if (safetyTimeoutRef.current) {
                clearTimeout(safetyTimeoutRef.current);
            }
            setState((prev)=>({
                    ...prev,
                    query: searchQuery,
                    suggestions: [],
                    isLoading: false,
                    error: 'Error en la búsqueda. Intenta nuevamente.'
                }));
        }
    }, [
        maxSuggestions
    ]) // Solo maxSuggestions es necesario como dependencia
    ;
    /**
   * Función de búsqueda con debounce optimizado usando use-debounce
   */ const searchWithDebounce = (0, _usedebounce.useDebouncedCallback)((searchQuery)=>{
        console.log('🔍 useSearch: searchWithDebounce (use-debounce) llamado con:', searchQuery);
        // Actualizar estado de loading inmediatamente
        setState((prev)=>({
                ...prev,
                isLoading: !!searchQuery.trim(),
                error: null
            }));
        // Ejecutar búsqueda
        performSearch(searchQuery);
    }, debounceMs, {
        maxWait: 2000,
        leading: false,
        trailing: true
    });
    /**
   * Ejecuta una búsqueda completa y navega a resultados
   */ const executeSearch = (0, _react.useCallback)(async (searchQuery, category)=>{
        if (!searchQuery.trim()) {
            return;
        }
        try {
            setState((prev)=>({
                    ...prev,
                    isLoading: true,
                    error: null
                }));
            // Guardar en historial
            if (saveRecentSearches && searchQuery.trim()) {
                const updated = [
                    searchQuery.trim(),
                    ...recentSearchesRef.current.filter((s)=>s !== searchQuery.trim())
                ].slice(0, 5);
                setRecentSearches(updated);
                try {
                    localStorage.setItem('pinteya-recent-searches', JSON.stringify(updated));
                } catch (error) {
                    console.warn('Error guardando búsqueda reciente:', error);
                }
            }
            // Realizar búsqueda con manejo robusto de errores
            const response = await errorHandler.executeWithRetry(()=>(0, _products.searchProducts)(searchQuery.trim(), searchLimit), `búsqueda de "${searchQuery.trim()}"`);
            if (response.success && response.data) {
                const resultCount = response.data.length;
                setState((prev)=>({
                        ...prev,
                        results: response.data || [],
                        isLoading: false,
                        hasSearched: true,
                        error: null
                    }));
                // Limpiar errores previos
                errorHandler.clearError();
                // Mostrar toast de éxito si hay resultados
                if (resultCount > 0) {
                    toastHandler.showSuccessToast(searchQuery.trim(), resultCount);
                } else {
                    toastHandler.showNoResultsToast(searchQuery.trim());
                }
                // Callback personalizado
                optionsRef.current.onSearch?.(searchQuery.trim(), response.data || []);
                // Navegar a resultados
                const searchParams = new URLSearchParams();
                searchParams.set('q', searchQuery.trim());
                if (category) {
                    searchParams.set('category', category);
                }
                router.push(`/search?${searchParams.toString()}`);
            } else {
                const errorMessage = response.error || 'No se encontraron resultados';
                setState((prev)=>({
                        ...prev,
                        results: [],
                        isLoading: false,
                        hasSearched: true,
                        error: errorMessage
                    }));
                // Mostrar toast de advertencia para respuestas sin éxito
                toastHandler.showWarningToast('Búsqueda sin resultados', errorMessage);
            }
        } catch (error) {
            console.error('❌ Error ejecutando búsqueda:', error);
            // Manejar error con el error handler
            const searchError = errorHandler.handleError(error);
            setState((prev)=>({
                    ...prev,
                    results: [],
                    isLoading: false,
                    hasSearched: true,
                    error: searchError.message
                }));
            // Mostrar toast de error
            toastHandler.showErrorToast(searchError, errorHandler.retryCount, ()=>{
                executeSearch(searchQuery.trim(), category);
            });
        }
    }, [
        searchLimit,
        saveRecentSearches,
        router,
        errorHandler,
        toastHandler
    ]) // Remover recentSearches de dependencias para evitar bucle infinito
    ;
    /**
   * Maneja la selección de una sugerencia
   */ const selectSuggestion = (0, _react.useCallback)((suggestion)=>{
        // Guardar en historial si es producto o categoría
        if ((suggestion.type === 'product' || suggestion.type === 'category') && saveRecentSearches) {
            const updated = [
                suggestion.title,
                ...recentSearchesRef.current.filter((s)=>s !== suggestion.title)
            ].slice(0, 5);
            setRecentSearches(updated);
            try {
                localStorage.setItem('pinteya-recent-searches', JSON.stringify(updated));
            } catch (error) {
                console.warn('Error guardando búsqueda reciente:', error);
            }
        }
        // Actualizar estado
        setState((prev)=>({
                ...prev,
                query: suggestion.title
            }));
        // Callback personalizado
        optionsRef.current.onSuggestionSelect?.(suggestion);
        // Navegar
        router.push(suggestion.href);
    }, [
        saveRecentSearches,
        router
    ]) // Remover recentSearches de dependencias para evitar bucle infinito
    ;
    /**
   * Limpia el estado de búsqueda
   */ const clearSearch = (0, _react.useCallback)(()=>{
        // Limpiar todos los timeouts
        if (debounceRef.current) {
            clearTimeout(debounceRef.current);
        }
        if (safetyTimeoutRef.current) {
            clearTimeout(safetyTimeoutRef.current);
        }
        // Resetear estado completamente (sin sugerencias por defecto para tests)
        setState({
            query: '',
            results: [],
            suggestions: [],
            isLoading: false,
            error: null,
            hasSearched: false
        });
    }, []) // Remover dependencia circular
    ;
    /**
   * Inicializa el hook (cargar búsquedas recientes)
   */ const initialize = (0, _react.useCallback)(()=>{
        if (saveRecentSearches) {
            try {
                const stored = localStorage.getItem('pinteya-recent-searches');
                if (stored && stored.trim() !== '' && stored !== '""' && stored !== "''") {
                    // Validar que no esté corrupto
                    if (stored.includes('""') && stored.length < 5) {
                        console.warn('Detected corrupted recent searches data, cleaning up');
                        localStorage.removeItem('pinteya-recent-searches');
                        return;
                    }
                    const parsed = JSON.parse(stored);
                    // Verificar que sea un array válido
                    if (Array.isArray(parsed)) {
                        setRecentSearches(parsed);
                    } else {
                        console.warn('Invalid recent searches format, resetting');
                        localStorage.removeItem('pinteya-recent-searches');
                    }
                }
            } catch (error) {
                console.warn('Error cargando búsquedas recientes:', error);
                // Limpiar datos corruptos
                localStorage.removeItem('pinteya-recent-searches');
            }
        }
    }, [
        saveRecentSearches
    ]);
    // ===================================
    // CLEANUP
    // ===================================
    const cleanup = (0, _react.useCallback)(()=>{
        // Cancelar debounce de use-debounce
        searchWithDebounce.cancel();
        // Limpiar timeouts manuales restantes
        if (debounceRef.current) {
            clearTimeout(debounceRef.current);
        }
        if (safetyTimeoutRef.current) {
            clearTimeout(safetyTimeoutRef.current);
        }
    }, [
        searchWithDebounce
    ]);
    // ===================================
    // RETURN
    // ===================================
    return {
        // Estado
        ...state,
        recentSearches,
        // Estado de errores y toasts
        searchError: errorHandler.currentError,
        isRetrying: errorHandler.isRetrying,
        retryCount: errorHandler.retryCount,
        toasts: toastHandler.toasts,
        // Funciones principales
        searchWithDebounce,
        executeSearch,
        selectSuggestion,
        clearSearch,
        initialize,
        cleanup,
        // Funciones de manejo de errores
        clearError: errorHandler.clearError,
        retryManually: errorHandler.retryManually,
        // Funciones de toast
        removeToast: toastHandler.removeToast,
        clearToasts: toastHandler.clearToasts
    };
}
const _default = useSearch;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZVNlYXJjaC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSE9PSzogdXNlU2VhcmNoIC0gU2lzdGVtYSBkZSBiw7pzcXVlZGEgY2VudHJhbGl6YWRvXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUNhbGxiYWNrLCB1c2VSZWYgfSBmcm9tICdyZWFjdCdcbmltcG9ydCB7IHVzZVJvdXRlciB9IGZyb20gJ25leHQvbmF2aWdhdGlvbidcbmltcG9ydCB7IHVzZURlYm91bmNlZENhbGxiYWNrIH0gZnJvbSAndXNlLWRlYm91bmNlJ1xuaW1wb3J0IHsgc2VhcmNoUHJvZHVjdHMgfSBmcm9tICdAL2xpYi9hcGkvcHJvZHVjdHMnXG5pbXBvcnQgeyBQcm9kdWN0V2l0aENhdGVnb3J5IH0gZnJvbSAnQC90eXBlcy9hcGknXG5pbXBvcnQgeyB1c2VTZWFyY2hFcnJvckhhbmRsZXIgfSBmcm9tICcuL3VzZVNlYXJjaEVycm9ySGFuZGxlcidcbmltcG9ydCB7IHVzZVNlYXJjaFRvYXN0IH0gZnJvbSAnLi91c2VTZWFyY2hUb2FzdCdcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRJUE9TXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaFN0YXRlIHtcbiAgcXVlcnk6IHN0cmluZ1xuICByZXN1bHRzOiBQcm9kdWN0V2l0aENhdGVnb3J5W11cbiAgc3VnZ2VzdGlvbnM6IFNlYXJjaFN1Z2dlc3Rpb25bXVxuICBpc0xvYWRpbmc6IGJvb2xlYW5cbiAgZXJyb3I6IHN0cmluZyB8IG51bGxcbiAgaGFzU2VhcmNoZWQ6IGJvb2xlYW5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hTdWdnZXN0aW9uIHtcbiAgaWQ6IHN0cmluZ1xuICB0eXBlOiAncHJvZHVjdCcgfCAnY2F0ZWdvcnknIHwgJ3JlY2VudCcgfCAndHJlbmRpbmcnXG4gIHRpdGxlOiBzdHJpbmdcbiAgc3VidGl0bGU/OiBzdHJpbmdcbiAgaW1hZ2U/OiBzdHJpbmdcbiAgYmFkZ2U/OiBzdHJpbmdcbiAgaHJlZjogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlU2VhcmNoT3B0aW9ucyB7XG4gIC8qKiBUaWVtcG8gZGUgZGVib3VuY2UgZW4gbWlsaXNlZ3VuZG9zICovXG4gIGRlYm91bmNlTXM/OiBudW1iZXJcbiAgLyoqIE7Dum1lcm8gbcOheGltbyBkZSBzdWdlcmVuY2lhcyAqL1xuICBtYXhTdWdnZXN0aW9ucz86IG51bWJlclxuICAvKiogTMOtbWl0ZSBkZSByZXN1bHRhZG9zIGRlIGLDunNxdWVkYSAqL1xuICBzZWFyY2hMaW1pdD86IG51bWJlclxuICAvKiogR3VhcmRhciBiw7pzcXVlZGFzIHJlY2llbnRlcyAqL1xuICBzYXZlUmVjZW50U2VhcmNoZXM/OiBib29sZWFuXG4gIC8qKiBDYWxsYmFjayBjdWFuZG8gc2UgcmVhbGl6YSB1bmEgYsO6c3F1ZWRhICovXG4gIG9uU2VhcmNoPzogKHF1ZXJ5OiBzdHJpbmcsIHJlc3VsdHM6IFByb2R1Y3RXaXRoQ2F0ZWdvcnlbXSkgPT4gdm9pZFxuICAvKiogQ2FsbGJhY2sgY3VhbmRvIHNlIHNlbGVjY2lvbmEgdW5hIHN1Z2VyZW5jaWEgKi9cbiAgb25TdWdnZXN0aW9uU2VsZWN0PzogKHN1Z2dlc3Rpb246IFNlYXJjaFN1Z2dlc3Rpb24pID0+IHZvaWRcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIELDmlNRVUVEQVMgVFJFTkRJTkcgUE9SIERFRkVDVE9cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNvbnN0IGRlZmF1bHRUcmVuZGluZ1NlYXJjaGVzOiBTZWFyY2hTdWdnZXN0aW9uW10gPSBbXG4gIHtcbiAgICBpZDogJ3RyZW5kaW5nLTEnLFxuICAgIHR5cGU6ICd0cmVuZGluZycsXG4gICAgdGl0bGU6ICdQaW50dXJhIGzDoXRleCcsXG4gICAgaHJlZjogJy9zZWFyY2g/cT1waW50dXJhK2xhdGV4JyxcbiAgfSxcbiAge1xuICAgIGlkOiAndHJlbmRpbmctMicsXG4gICAgdHlwZTogJ3RyZW5kaW5nJyxcbiAgICB0aXRsZTogJ1NoZXJ3aW4gV2lsbGlhbXMnLFxuICAgIGhyZWY6ICcvc2VhcmNoP3E9c2hlcndpbit3aWxsaWFtcycsXG4gIH0sXG4gIHtcbiAgICBpZDogJ3RyZW5kaW5nLTMnLFxuICAgIHR5cGU6ICd0cmVuZGluZycsXG4gICAgdGl0bGU6ICdSb2RpbGxvcyBwcmVtaXVtJyxcbiAgICBocmVmOiAnL3NlYXJjaD9xPXJvZGlsbG9zK3ByZW1pdW0nLFxuICB9LFxuICB7XG4gICAgaWQ6ICd0cmVuZGluZy00JyxcbiAgICB0eXBlOiAndHJlbmRpbmcnLFxuICAgIHRpdGxlOiAnUGluY2VsZXMnLFxuICAgIGhyZWY6ICcvc2VhcmNoP3E9cGluY2VsZXMnLFxuICB9LFxuXVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSE9PSyBQUklOQ0lQQUxcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VTZWFyY2gob3B0aW9uczogVXNlU2VhcmNoT3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBkZWJvdW5jZU1zID0gMTUwLFxuICAgIG1heFN1Z2dlc3Rpb25zID0gOCxcbiAgICBzZWFyY2hMaW1pdCA9IDEyLFxuICAgIHNhdmVSZWNlbnRTZWFyY2hlcyA9IHRydWUsXG4gICAgb25TZWFyY2gsXG4gICAgb25TdWdnZXN0aW9uU2VsZWN0LFxuICB9ID0gb3B0aW9uc1xuXG4gIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpXG4gIGNvbnN0IGRlYm91bmNlUmVmID0gdXNlUmVmPE5vZGVKUy5UaW1lb3V0PigpXG4gIGNvbnN0IHNhZmV0eVRpbWVvdXRSZWYgPSB1c2VSZWY8Tm9kZUpTLlRpbWVvdXQ+KCkgLy8gVGltZW91dCBkZSBzZWd1cmlkYWQgcGFyYSBldml0YXIgbG9hZGluZyBwZXJtYW5lbnRlXG4gIGNvbnN0IG9wdGlvbnNSZWYgPSB1c2VSZWYob3B0aW9ucykgLy8gUmVmIHBhcmEgb3BjaW9uZXMgZXN0YWJsZXNcbiAgY29uc3QgcmVjZW50U2VhcmNoZXNSZWYgPSB1c2VSZWY8c3RyaW5nW10+KFtdKSAvLyBSZWYgcGFyYSBiw7pzcXVlZGFzIHJlY2llbnRlc1xuXG4gIC8vIEhvb2tzIHBhcmEgbWFuZWpvIGRlIGVycm9yZXMgeSB0b2FzdCBub3RpZmljYXRpb25zXG4gIGNvbnN0IGVycm9ySGFuZGxlciA9IHVzZVNlYXJjaEVycm9ySGFuZGxlcih7XG4gICAgb25FcnJvcjogZXJyb3IgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGUgYsO6c3F1ZWRhOicsIGVycm9yKVxuICAgIH0sXG4gICAgb25SZXRyeVN1Y2Nlc3M6ICgpID0+IHtcbiAgICAgIHRvYXN0SGFuZGxlci5zaG93UmV0cnlTdWNjZXNzVG9hc3QoKVxuICAgIH0sXG4gICAgb25SZXRyeUZhaWxlZDogKGVycm9yLCBhdHRlbXB0cykgPT4ge1xuICAgICAgdG9hc3RIYW5kbGVyLnNob3dSZXRyeUZhaWxlZFRvYXN0KGF0dGVtcHRzKVxuICAgIH0sXG4gIH0pXG5cbiAgY29uc3QgdG9hc3RIYW5kbGVyID0gdXNlU2VhcmNoVG9hc3Qoe1xuICAgIGRlZmF1bHREdXJhdGlvbjogNDAwMCxcbiAgICBtYXhUb2FzdHM6IDIsXG4gIH0pXG5cbiAgLy8gQWN0dWFsaXphciByZWYgY3VhbmRvIGNhbWJpZW4gbGFzIG9wY2lvbmVzXG4gIG9wdGlvbnNSZWYuY3VycmVudCA9IG9wdGlvbnNcblxuICAvLyBFc3RhZG8gcHJpbmNpcGFsXG4gIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gdXNlU3RhdGU8U2VhcmNoU3RhdGU+KHtcbiAgICBxdWVyeTogJycsXG4gICAgcmVzdWx0czogW10sXG4gICAgc3VnZ2VzdGlvbnM6IFtdLFxuICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgZXJyb3I6IG51bGwsXG4gICAgaGFzU2VhcmNoZWQ6IGZhbHNlLFxuICB9KVxuXG4gIGNvbnN0IFtyZWNlbnRTZWFyY2hlcywgc2V0UmVjZW50U2VhcmNoZXNdID0gdXNlU3RhdGU8c3RyaW5nW10+KFtdKVxuXG4gIC8vIFNpbmNyb25pemFyIHJlZmVyZW5jaWEgY29uIGVzdGFkbyBwYXJhIGV2aXRhciBkZXBlbmRlbmNpYXMgZW4gdXNlQ2FsbGJhY2tcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICByZWNlbnRTZWFyY2hlc1JlZi5jdXJyZW50ID0gcmVjZW50U2VhcmNoZXNcbiAgfSwgW3JlY2VudFNlYXJjaGVzXSlcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBGVU5DSU9ORVMgQVVYSUxJQVJFUyBTSU1QTElGSUNBREFTXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gRlVOQ0lPTkVTIFBSSU5DSVBBTEVTIENPTiBVU0UtREVCT1VOQ0VcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogRnVuY2nDs24gZGUgYsO6c3F1ZWRhIGludGVybmEgb3B0aW1pemFkYVxuICAgKi9cbiAgY29uc3QgcGVyZm9ybVNlYXJjaCA9IHVzZUNhbGxiYWNrKFxuICAgIGFzeW5jIChzZWFyY2hRdWVyeTogc3RyaW5nKSA9PiB7XG4gICAgICAvLyBMaW1waWFyIHRpbWVvdXQgZGUgc2VndXJpZGFkIGFudGVyaW9yXG4gICAgICBpZiAoc2FmZXR5VGltZW91dFJlZi5jdXJyZW50KSB7XG4gICAgICAgIGNsZWFyVGltZW91dChzYWZldHlUaW1lb3V0UmVmLmN1cnJlbnQpXG4gICAgICB9XG5cbiAgICAgIC8vIFNpIGxhIHF1ZXJ5IGVzdMOhIHZhY8OtYSwgbW9zdHJhciBzdWdlcmVuY2lhcyBwb3IgZGVmZWN0b1xuICAgICAgaWYgKCFzZWFyY2hRdWVyeS50cmltKCkpIHtcbiAgICAgICAgY29uc3QgZGVmYXVsdFN1Z2dlc3Rpb25zID0gW1xuICAgICAgICAgIC4uLmRlZmF1bHRUcmVuZGluZ1NlYXJjaGVzLnNsaWNlKDAsIDQpLFxuICAgICAgICAgIC4uLnJlY2VudFNlYXJjaGVzUmVmLmN1cnJlbnQuc2xpY2UoMCwgMykubWFwKChzZWFyY2gsIGluZGV4KSA9PiAoe1xuICAgICAgICAgICAgaWQ6IGByZWNlbnQtJHtpbmRleH1gLFxuICAgICAgICAgICAgdHlwZTogJ3JlY2VudCcgYXMgY29uc3QsXG4gICAgICAgICAgICB0aXRsZTogc2VhcmNoLFxuICAgICAgICAgICAgaHJlZjogYC9zZWFyY2g/cT0ke2VuY29kZVVSSUNvbXBvbmVudChzZWFyY2gpfWAsXG4gICAgICAgICAgfSkpLFxuICAgICAgICBdLnNsaWNlKDAsIG1heFN1Z2dlc3Rpb25zKVxuXG4gICAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgICAuLi5wcmV2LFxuICAgICAgICAgIHF1ZXJ5OiBzZWFyY2hRdWVyeSxcbiAgICAgICAgICBzdWdnZXN0aW9uczogZGVmYXVsdFN1Z2dlc3Rpb25zLFxuICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgIH0pKVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgLy8gVGltZW91dCBkZSBzZWd1cmlkYWQgcGFyYSBldml0YXIgbG9hZGluZyBwZXJtYW5lbnRlICg1IHNlZ3VuZG9zKVxuICAgICAgc2FmZXR5VGltZW91dFJlZi5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgICAuLi5wcmV2LFxuICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdUaWVtcG8gZGUgZXNwZXJhIGFnb3RhZG8uIEludGVudGEgbnVldmFtZW50ZS4nLFxuICAgICAgICB9KSlcbiAgICAgIH0sIDUwMDApXG5cbiAgICAgIC8vIEVqZWN1dGFyIGLDunNxdWVkYSBkaXJlY3RhbWVudGUgKGVsIGRlYm91bmNlIHNlIG1hbmVqYSBlbiBzZWFyY2hXaXRoRGVib3VuY2UpXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHNlYXJjaFByb2R1Y3RzKHNlYXJjaFF1ZXJ5LCBtYXhTdWdnZXN0aW9ucylcblxuICAgICAgICAvLyBMaW1waWFyIHRpbWVvdXQgZGUgc2VndXJpZGFkIHlhIHF1ZSBsYSBBUEkgcmVzcG9uZGnDs1xuICAgICAgICBpZiAoc2FmZXR5VGltZW91dFJlZi5jdXJyZW50KSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHNhZmV0eVRpbWVvdXRSZWYuY3VycmVudClcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzICYmIHJlc3BvbnNlLmRhdGEgJiYgQXJyYXkuaXNBcnJheShyZXNwb25zZS5kYXRhKSkge1xuICAgICAgICAgIGNvbnN0IHByb2R1Y3RTdWdnZXN0aW9ucyA9IHJlc3BvbnNlLmRhdGEubWFwKHByb2R1Y3QgPT4gKHtcbiAgICAgICAgICAgIGlkOiBgcHJvZHVjdC0ke3Byb2R1Y3QuaWR9YCxcbiAgICAgICAgICAgIHR5cGU6ICdwcm9kdWN0JyBhcyBjb25zdCxcbiAgICAgICAgICAgIHRpdGxlOiBwcm9kdWN0Lm5hbWUsXG4gICAgICAgICAgICBzdWJ0aXRsZTogcHJvZHVjdC5jYXRlZ29yeT8ubmFtZSB8fCAnU2luIGNhdGVnb3LDrWEnLFxuICAgICAgICAgICAgaW1hZ2U6IHByb2R1Y3QuaW1hZ2VzPy5wcmV2aWV3cz8uWzBdIHx8ICcvaW1hZ2VzL3Byb2R1Y3RzL3BsYWNlaG9sZGVyLmpwZycsXG4gICAgICAgICAgICBiYWRnZTogcHJvZHVjdC5zdG9jayA+IDAgPyAnRW4gc3RvY2snIDogJ1NpbiBzdG9jaycsXG4gICAgICAgICAgICBocmVmOiBgL3Nob3AtZGV0YWlscy8ke3Byb2R1Y3QuaWR9YCxcbiAgICAgICAgICB9KSlcblxuICAgICAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgICBxdWVyeTogc2VhcmNoUXVlcnksIC8vIEFjdHVhbGl6YXIgcXVlcnkgY3VhbmRvIGhheSByZXN1bHRhZG9zIGV4aXRvc29zXG4gICAgICAgICAgICBzdWdnZXN0aW9uczogcHJvZHVjdFN1Z2dlc3Rpb25zLFxuICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgIH0pKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgICBxdWVyeTogc2VhcmNoUXVlcnksIC8vIEFjdHVhbGl6YXIgcXVlcnkgaW5jbHVzbyBjdWFuZG8gbm8gaGF5IHJlc3VsdGFkb3NcbiAgICAgICAgICAgIHN1Z2dlc3Rpb25zOiBbXSxcbiAgICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogcmVzcG9uc2UuZXJyb3IgfHwgJ05vIHNlIGVuY29udHJhcm9uIHJlc3VsdGFkb3MnLFxuICAgICAgICAgIH0pKVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgdXNlU2VhcmNoOiBFcnJvciBlbiBiw7pzcXVlZGE6JywgZXJyb3IpXG5cbiAgICAgICAgLy8gTGltcGlhciB0aW1lb3V0IGRlIHNlZ3VyaWRhZFxuICAgICAgICBpZiAoc2FmZXR5VGltZW91dFJlZi5jdXJyZW50KSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHNhZmV0eVRpbWVvdXRSZWYuY3VycmVudClcbiAgICAgICAgfVxuXG4gICAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgICAuLi5wcmV2LFxuICAgICAgICAgIHF1ZXJ5OiBzZWFyY2hRdWVyeSwgLy8gQWN0dWFsaXphciBxdWVyeSBpbmNsdXNvIGVuIGNhc28gZGUgZXJyb3JcbiAgICAgICAgICBzdWdnZXN0aW9uczogW10sXG4gICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogJ0Vycm9yIGVuIGxhIGLDunNxdWVkYS4gSW50ZW50YSBudWV2YW1lbnRlLicsXG4gICAgICAgIH0pKVxuICAgICAgfVxuICAgIH0sXG4gICAgW21heFN1Z2dlc3Rpb25zXVxuICApIC8vIFNvbG8gbWF4U3VnZ2VzdGlvbnMgZXMgbmVjZXNhcmlvIGNvbW8gZGVwZW5kZW5jaWFcblxuICAvKipcbiAgICogRnVuY2nDs24gZGUgYsO6c3F1ZWRhIGNvbiBkZWJvdW5jZSBvcHRpbWl6YWRvIHVzYW5kbyB1c2UtZGVib3VuY2VcbiAgICovXG4gIGNvbnN0IHNlYXJjaFdpdGhEZWJvdW5jZSA9IHVzZURlYm91bmNlZENhbGxiYWNrKFxuICAgIChzZWFyY2hRdWVyeTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygn8J+UjSB1c2VTZWFyY2g6IHNlYXJjaFdpdGhEZWJvdW5jZSAodXNlLWRlYm91bmNlKSBsbGFtYWRvIGNvbjonLCBzZWFyY2hRdWVyeSlcblxuICAgICAgLy8gQWN0dWFsaXphciBlc3RhZG8gZGUgbG9hZGluZyBpbm1lZGlhdGFtZW50ZVxuICAgICAgc2V0U3RhdGUocHJldiA9PiAoe1xuICAgICAgICAuLi5wcmV2LFxuICAgICAgICBpc0xvYWRpbmc6ICEhc2VhcmNoUXVlcnkudHJpbSgpLFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0pKVxuXG4gICAgICAvLyBFamVjdXRhciBiw7pzcXVlZGFcbiAgICAgIHBlcmZvcm1TZWFyY2goc2VhcmNoUXVlcnkpXG4gICAgfSxcbiAgICBkZWJvdW5jZU1zLFxuICAgIHtcbiAgICAgIG1heFdhaXQ6IDIwMDAsXG4gICAgICBsZWFkaW5nOiBmYWxzZSxcbiAgICAgIHRyYWlsaW5nOiB0cnVlLFxuICAgIH1cbiAgKVxuXG4gIC8qKlxuICAgKiBFamVjdXRhIHVuYSBiw7pzcXVlZGEgY29tcGxldGEgeSBuYXZlZ2EgYSByZXN1bHRhZG9zXG4gICAqL1xuICBjb25zdCBleGVjdXRlU2VhcmNoID0gdXNlQ2FsbGJhY2soXG4gICAgYXN5bmMgKHNlYXJjaFF1ZXJ5OiBzdHJpbmcsIGNhdGVnb3J5Pzogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAoIXNlYXJjaFF1ZXJ5LnRyaW0oKSkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgc2V0U3RhdGUocHJldiA9PiAoeyAuLi5wcmV2LCBpc0xvYWRpbmc6IHRydWUsIGVycm9yOiBudWxsIH0pKVxuXG4gICAgICAgIC8vIEd1YXJkYXIgZW4gaGlzdG9yaWFsXG4gICAgICAgIGlmIChzYXZlUmVjZW50U2VhcmNoZXMgJiYgc2VhcmNoUXVlcnkudHJpbSgpKSB7XG4gICAgICAgICAgY29uc3QgdXBkYXRlZCA9IFtcbiAgICAgICAgICAgIHNlYXJjaFF1ZXJ5LnRyaW0oKSxcbiAgICAgICAgICAgIC4uLnJlY2VudFNlYXJjaGVzUmVmLmN1cnJlbnQuZmlsdGVyKHMgPT4gcyAhPT0gc2VhcmNoUXVlcnkudHJpbSgpKSxcbiAgICAgICAgICBdLnNsaWNlKDAsIDUpXG5cbiAgICAgICAgICBzZXRSZWNlbnRTZWFyY2hlcyh1cGRhdGVkKVxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncGludGV5YS1yZWNlbnQtc2VhcmNoZXMnLCBKU09OLnN0cmluZ2lmeSh1cGRhdGVkKSlcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdFcnJvciBndWFyZGFuZG8gYsO6c3F1ZWRhIHJlY2llbnRlOicsIGVycm9yKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlYWxpemFyIGLDunNxdWVkYSBjb24gbWFuZWpvIHJvYnVzdG8gZGUgZXJyb3Jlc1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGVycm9ySGFuZGxlci5leGVjdXRlV2l0aFJldHJ5KFxuICAgICAgICAgICgpID0+IHNlYXJjaFByb2R1Y3RzKHNlYXJjaFF1ZXJ5LnRyaW0oKSwgc2VhcmNoTGltaXQpLFxuICAgICAgICAgIGBiw7pzcXVlZGEgZGUgXCIke3NlYXJjaFF1ZXJ5LnRyaW0oKX1cImBcbiAgICAgICAgKVxuXG4gICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzICYmIHJlc3BvbnNlLmRhdGEpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHRDb3VudCA9IHJlc3BvbnNlLmRhdGEubGVuZ3RoXG5cbiAgICAgICAgICBzZXRTdGF0ZShwcmV2ID0+ICh7XG4gICAgICAgICAgICAuLi5wcmV2LFxuICAgICAgICAgICAgcmVzdWx0czogcmVzcG9uc2UuZGF0YSB8fCBbXSxcbiAgICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICBoYXNTZWFyY2hlZDogdHJ1ZSxcbiAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgIH0pKVxuXG4gICAgICAgICAgLy8gTGltcGlhciBlcnJvcmVzIHByZXZpb3NcbiAgICAgICAgICBlcnJvckhhbmRsZXIuY2xlYXJFcnJvcigpXG5cbiAgICAgICAgICAvLyBNb3N0cmFyIHRvYXN0IGRlIMOpeGl0byBzaSBoYXkgcmVzdWx0YWRvc1xuICAgICAgICAgIGlmIChyZXN1bHRDb3VudCA+IDApIHtcbiAgICAgICAgICAgIHRvYXN0SGFuZGxlci5zaG93U3VjY2Vzc1RvYXN0KHNlYXJjaFF1ZXJ5LnRyaW0oKSwgcmVzdWx0Q291bnQpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRvYXN0SGFuZGxlci5zaG93Tm9SZXN1bHRzVG9hc3Qoc2VhcmNoUXVlcnkudHJpbSgpKVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIENhbGxiYWNrIHBlcnNvbmFsaXphZG9cbiAgICAgICAgICBvcHRpb25zUmVmLmN1cnJlbnQub25TZWFyY2g/LihzZWFyY2hRdWVyeS50cmltKCksIHJlc3BvbnNlLmRhdGEgfHwgW10pXG5cbiAgICAgICAgICAvLyBOYXZlZ2FyIGEgcmVzdWx0YWRvc1xuICAgICAgICAgIGNvbnN0IHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKVxuICAgICAgICAgIHNlYXJjaFBhcmFtcy5zZXQoJ3EnLCBzZWFyY2hRdWVyeS50cmltKCkpXG4gICAgICAgICAgaWYgKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICBzZWFyY2hQYXJhbXMuc2V0KCdjYXRlZ29yeScsIGNhdGVnb3J5KVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJvdXRlci5wdXNoKGAvc2VhcmNoPyR7c2VhcmNoUGFyYW1zLnRvU3RyaW5nKCl9YClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSByZXNwb25zZS5lcnJvciB8fCAnTm8gc2UgZW5jb250cmFyb24gcmVzdWx0YWRvcydcblxuICAgICAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgICByZXN1bHRzOiBbXSxcbiAgICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICBoYXNTZWFyY2hlZDogdHJ1ZSxcbiAgICAgICAgICAgIGVycm9yOiBlcnJvck1lc3NhZ2UsXG4gICAgICAgICAgfSkpXG5cbiAgICAgICAgICAvLyBNb3N0cmFyIHRvYXN0IGRlIGFkdmVydGVuY2lhIHBhcmEgcmVzcHVlc3RhcyBzaW4gw6l4aXRvXG4gICAgICAgICAgdG9hc3RIYW5kbGVyLnNob3dXYXJuaW5nVG9hc3QoJ0LDunNxdWVkYSBzaW4gcmVzdWx0YWRvcycsIGVycm9yTWVzc2FnZSlcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGVqZWN1dGFuZG8gYsO6c3F1ZWRhOicsIGVycm9yKVxuXG4gICAgICAgIC8vIE1hbmVqYXIgZXJyb3IgY29uIGVsIGVycm9yIGhhbmRsZXJcbiAgICAgICAgY29uc3Qgc2VhcmNoRXJyb3IgPSBlcnJvckhhbmRsZXIuaGFuZGxlRXJyb3IoZXJyb3IpXG5cbiAgICAgICAgc2V0U3RhdGUocHJldiA9PiAoe1xuICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgcmVzdWx0czogW10sXG4gICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICBoYXNTZWFyY2hlZDogdHJ1ZSxcbiAgICAgICAgICBlcnJvcjogc2VhcmNoRXJyb3IubWVzc2FnZSxcbiAgICAgICAgfSkpXG5cbiAgICAgICAgLy8gTW9zdHJhciB0b2FzdCBkZSBlcnJvclxuICAgICAgICB0b2FzdEhhbmRsZXIuc2hvd0Vycm9yVG9hc3Qoc2VhcmNoRXJyb3IsIGVycm9ySGFuZGxlci5yZXRyeUNvdW50LCAoKSA9PiB7XG4gICAgICAgICAgZXhlY3V0ZVNlYXJjaChzZWFyY2hRdWVyeS50cmltKCksIGNhdGVnb3J5KVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0sXG4gICAgW3NlYXJjaExpbWl0LCBzYXZlUmVjZW50U2VhcmNoZXMsIHJvdXRlciwgZXJyb3JIYW5kbGVyLCB0b2FzdEhhbmRsZXJdXG4gICkgLy8gUmVtb3ZlciByZWNlbnRTZWFyY2hlcyBkZSBkZXBlbmRlbmNpYXMgcGFyYSBldml0YXIgYnVjbGUgaW5maW5pdG9cblxuICAvKipcbiAgICogTWFuZWphIGxhIHNlbGVjY2nDs24gZGUgdW5hIHN1Z2VyZW5jaWFcbiAgICovXG4gIGNvbnN0IHNlbGVjdFN1Z2dlc3Rpb24gPSB1c2VDYWxsYmFjayhcbiAgICAoc3VnZ2VzdGlvbjogU2VhcmNoU3VnZ2VzdGlvbikgPT4ge1xuICAgICAgLy8gR3VhcmRhciBlbiBoaXN0b3JpYWwgc2kgZXMgcHJvZHVjdG8gbyBjYXRlZ29yw61hXG4gICAgICBpZiAoKHN1Z2dlc3Rpb24udHlwZSA9PT0gJ3Byb2R1Y3QnIHx8IHN1Z2dlc3Rpb24udHlwZSA9PT0gJ2NhdGVnb3J5JykgJiYgc2F2ZVJlY2VudFNlYXJjaGVzKSB7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWQgPSBbXG4gICAgICAgICAgc3VnZ2VzdGlvbi50aXRsZSxcbiAgICAgICAgICAuLi5yZWNlbnRTZWFyY2hlc1JlZi5jdXJyZW50LmZpbHRlcihzID0+IHMgIT09IHN1Z2dlc3Rpb24udGl0bGUpLFxuICAgICAgICBdLnNsaWNlKDAsIDUpXG5cbiAgICAgICAgc2V0UmVjZW50U2VhcmNoZXModXBkYXRlZClcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncGludGV5YS1yZWNlbnQtc2VhcmNoZXMnLCBKU09OLnN0cmluZ2lmeSh1cGRhdGVkKSlcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0Vycm9yIGd1YXJkYW5kbyBiw7pzcXVlZGEgcmVjaWVudGU6JywgZXJyb3IpXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQWN0dWFsaXphciBlc3RhZG9cbiAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgcXVlcnk6IHN1Z2dlc3Rpb24udGl0bGUsXG4gICAgICB9KSlcblxuICAgICAgLy8gQ2FsbGJhY2sgcGVyc29uYWxpemFkb1xuICAgICAgb3B0aW9uc1JlZi5jdXJyZW50Lm9uU3VnZ2VzdGlvblNlbGVjdD8uKHN1Z2dlc3Rpb24pXG5cbiAgICAgIC8vIE5hdmVnYXJcbiAgICAgIHJvdXRlci5wdXNoKHN1Z2dlc3Rpb24uaHJlZilcbiAgICB9LFxuICAgIFtzYXZlUmVjZW50U2VhcmNoZXMsIHJvdXRlcl1cbiAgKSAvLyBSZW1vdmVyIHJlY2VudFNlYXJjaGVzIGRlIGRlcGVuZGVuY2lhcyBwYXJhIGV2aXRhciBidWNsZSBpbmZpbml0b1xuXG4gIC8qKlxuICAgKiBMaW1waWEgZWwgZXN0YWRvIGRlIGLDunNxdWVkYVxuICAgKi9cbiAgY29uc3QgY2xlYXJTZWFyY2ggPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgLy8gTGltcGlhciB0b2RvcyBsb3MgdGltZW91dHNcbiAgICBpZiAoZGVib3VuY2VSZWYuY3VycmVudCkge1xuICAgICAgY2xlYXJUaW1lb3V0KGRlYm91bmNlUmVmLmN1cnJlbnQpXG4gICAgfVxuICAgIGlmIChzYWZldHlUaW1lb3V0UmVmLmN1cnJlbnQpIHtcbiAgICAgIGNsZWFyVGltZW91dChzYWZldHlUaW1lb3V0UmVmLmN1cnJlbnQpXG4gICAgfVxuXG4gICAgLy8gUmVzZXRlYXIgZXN0YWRvIGNvbXBsZXRhbWVudGUgKHNpbiBzdWdlcmVuY2lhcyBwb3IgZGVmZWN0byBwYXJhIHRlc3RzKVxuICAgIHNldFN0YXRlKHtcbiAgICAgIHF1ZXJ5OiAnJyxcbiAgICAgIHJlc3VsdHM6IFtdLFxuICAgICAgc3VnZ2VzdGlvbnM6IFtdLFxuICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgIGVycm9yOiBudWxsLFxuICAgICAgaGFzU2VhcmNoZWQ6IGZhbHNlLFxuICAgIH0pXG4gIH0sIFtdKSAvLyBSZW1vdmVyIGRlcGVuZGVuY2lhIGNpcmN1bGFyXG5cbiAgLyoqXG4gICAqIEluaWNpYWxpemEgZWwgaG9vayAoY2FyZ2FyIGLDunNxdWVkYXMgcmVjaWVudGVzKVxuICAgKi9cbiAgY29uc3QgaW5pdGlhbGl6ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoc2F2ZVJlY2VudFNlYXJjaGVzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBzdG9yZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncGludGV5YS1yZWNlbnQtc2VhcmNoZXMnKVxuICAgICAgICBpZiAoc3RvcmVkICYmIHN0b3JlZC50cmltKCkgIT09ICcnICYmIHN0b3JlZCAhPT0gJ1wiXCInICYmIHN0b3JlZCAhPT0gXCInJ1wiKSB7XG4gICAgICAgICAgLy8gVmFsaWRhciBxdWUgbm8gZXN0w6kgY29ycnVwdG9cbiAgICAgICAgICBpZiAoc3RvcmVkLmluY2x1ZGVzKCdcIlwiJykgJiYgc3RvcmVkLmxlbmd0aCA8IDUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignRGV0ZWN0ZWQgY29ycnVwdGVkIHJlY2VudCBzZWFyY2hlcyBkYXRhLCBjbGVhbmluZyB1cCcpXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncGludGV5YS1yZWNlbnQtc2VhcmNoZXMnKVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShzdG9yZWQpXG4gICAgICAgICAgLy8gVmVyaWZpY2FyIHF1ZSBzZWEgdW4gYXJyYXkgdsOhbGlkb1xuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcnNlZCkpIHtcbiAgICAgICAgICAgIHNldFJlY2VudFNlYXJjaGVzKHBhcnNlZClcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdJbnZhbGlkIHJlY2VudCBzZWFyY2hlcyBmb3JtYXQsIHJlc2V0dGluZycpXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncGludGV5YS1yZWNlbnQtc2VhcmNoZXMnKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdFcnJvciBjYXJnYW5kbyBiw7pzcXVlZGFzIHJlY2llbnRlczonLCBlcnJvcilcbiAgICAgICAgLy8gTGltcGlhciBkYXRvcyBjb3JydXB0b3NcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3BpbnRleWEtcmVjZW50LXNlYXJjaGVzJylcbiAgICAgIH1cbiAgICB9XG4gIH0sIFtzYXZlUmVjZW50U2VhcmNoZXNdKVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIENMRUFOVVBcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBjb25zdCBjbGVhbnVwID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIC8vIENhbmNlbGFyIGRlYm91bmNlIGRlIHVzZS1kZWJvdW5jZVxuICAgIHNlYXJjaFdpdGhEZWJvdW5jZS5jYW5jZWwoKVxuXG4gICAgLy8gTGltcGlhciB0aW1lb3V0cyBtYW51YWxlcyByZXN0YW50ZXNcbiAgICBpZiAoZGVib3VuY2VSZWYuY3VycmVudCkge1xuICAgICAgY2xlYXJUaW1lb3V0KGRlYm91bmNlUmVmLmN1cnJlbnQpXG4gICAgfVxuICAgIGlmIChzYWZldHlUaW1lb3V0UmVmLmN1cnJlbnQpIHtcbiAgICAgIGNsZWFyVGltZW91dChzYWZldHlUaW1lb3V0UmVmLmN1cnJlbnQpXG4gICAgfVxuICB9LCBbc2VhcmNoV2l0aERlYm91bmNlXSlcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBSRVRVUk5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICByZXR1cm4ge1xuICAgIC8vIEVzdGFkb1xuICAgIC4uLnN0YXRlLFxuICAgIHJlY2VudFNlYXJjaGVzLFxuXG4gICAgLy8gRXN0YWRvIGRlIGVycm9yZXMgeSB0b2FzdHNcbiAgICBzZWFyY2hFcnJvcjogZXJyb3JIYW5kbGVyLmN1cnJlbnRFcnJvcixcbiAgICBpc1JldHJ5aW5nOiBlcnJvckhhbmRsZXIuaXNSZXRyeWluZyxcbiAgICByZXRyeUNvdW50OiBlcnJvckhhbmRsZXIucmV0cnlDb3VudCxcbiAgICB0b2FzdHM6IHRvYXN0SGFuZGxlci50b2FzdHMsXG5cbiAgICAvLyBGdW5jaW9uZXMgcHJpbmNpcGFsZXNcbiAgICBzZWFyY2hXaXRoRGVib3VuY2UsXG4gICAgZXhlY3V0ZVNlYXJjaCxcbiAgICBzZWxlY3RTdWdnZXN0aW9uLFxuICAgIGNsZWFyU2VhcmNoLFxuICAgIGluaXRpYWxpemUsXG4gICAgY2xlYW51cCxcblxuICAgIC8vIEZ1bmNpb25lcyBkZSBtYW5lam8gZGUgZXJyb3Jlc1xuICAgIGNsZWFyRXJyb3I6IGVycm9ySGFuZGxlci5jbGVhckVycm9yLFxuICAgIHJldHJ5TWFudWFsbHk6IGVycm9ySGFuZGxlci5yZXRyeU1hbnVhbGx5LFxuXG4gICAgLy8gRnVuY2lvbmVzIGRlIHRvYXN0XG4gICAgcmVtb3ZlVG9hc3Q6IHRvYXN0SGFuZGxlci5yZW1vdmVUb2FzdCxcbiAgICBjbGVhclRvYXN0czogdG9hc3RIYW5kbGVyLmNsZWFyVG9hc3RzLFxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHVzZVNlYXJjaFxuIl0sIm5hbWVzIjpbInVzZVNlYXJjaCIsImRlZmF1bHRUcmVuZGluZ1NlYXJjaGVzIiwiaWQiLCJ0eXBlIiwidGl0bGUiLCJocmVmIiwib3B0aW9ucyIsImRlYm91bmNlTXMiLCJtYXhTdWdnZXN0aW9ucyIsInNlYXJjaExpbWl0Iiwic2F2ZVJlY2VudFNlYXJjaGVzIiwib25TZWFyY2giLCJvblN1Z2dlc3Rpb25TZWxlY3QiLCJyb3V0ZXIiLCJ1c2VSb3V0ZXIiLCJkZWJvdW5jZVJlZiIsInVzZVJlZiIsInNhZmV0eVRpbWVvdXRSZWYiLCJvcHRpb25zUmVmIiwicmVjZW50U2VhcmNoZXNSZWYiLCJlcnJvckhhbmRsZXIiLCJ1c2VTZWFyY2hFcnJvckhhbmRsZXIiLCJvbkVycm9yIiwiZXJyb3IiLCJjb25zb2xlIiwib25SZXRyeVN1Y2Nlc3MiLCJ0b2FzdEhhbmRsZXIiLCJzaG93UmV0cnlTdWNjZXNzVG9hc3QiLCJvblJldHJ5RmFpbGVkIiwiYXR0ZW1wdHMiLCJzaG93UmV0cnlGYWlsZWRUb2FzdCIsInVzZVNlYXJjaFRvYXN0IiwiZGVmYXVsdER1cmF0aW9uIiwibWF4VG9hc3RzIiwiY3VycmVudCIsInN0YXRlIiwic2V0U3RhdGUiLCJ1c2VTdGF0ZSIsInF1ZXJ5IiwicmVzdWx0cyIsInN1Z2dlc3Rpb25zIiwiaXNMb2FkaW5nIiwiaGFzU2VhcmNoZWQiLCJyZWNlbnRTZWFyY2hlcyIsInNldFJlY2VudFNlYXJjaGVzIiwiUmVhY3QiLCJ1c2VFZmZlY3QiLCJwZXJmb3JtU2VhcmNoIiwidXNlQ2FsbGJhY2siLCJzZWFyY2hRdWVyeSIsImNsZWFyVGltZW91dCIsInRyaW0iLCJkZWZhdWx0U3VnZ2VzdGlvbnMiLCJzbGljZSIsIm1hcCIsInNlYXJjaCIsImluZGV4IiwiZW5jb2RlVVJJQ29tcG9uZW50IiwicHJldiIsInNldFRpbWVvdXQiLCJyZXNwb25zZSIsInNlYXJjaFByb2R1Y3RzIiwic3VjY2VzcyIsImRhdGEiLCJBcnJheSIsImlzQXJyYXkiLCJwcm9kdWN0U3VnZ2VzdGlvbnMiLCJwcm9kdWN0IiwibmFtZSIsInN1YnRpdGxlIiwiY2F0ZWdvcnkiLCJpbWFnZSIsImltYWdlcyIsInByZXZpZXdzIiwiYmFkZ2UiLCJzdG9jayIsInNlYXJjaFdpdGhEZWJvdW5jZSIsInVzZURlYm91bmNlZENhbGxiYWNrIiwibG9nIiwibWF4V2FpdCIsImxlYWRpbmciLCJ0cmFpbGluZyIsImV4ZWN1dGVTZWFyY2giLCJ1cGRhdGVkIiwiZmlsdGVyIiwicyIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5Iiwid2FybiIsImV4ZWN1dGVXaXRoUmV0cnkiLCJyZXN1bHRDb3VudCIsImxlbmd0aCIsImNsZWFyRXJyb3IiLCJzaG93U3VjY2Vzc1RvYXN0Iiwic2hvd05vUmVzdWx0c1RvYXN0Iiwic2VhcmNoUGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwic2V0IiwicHVzaCIsInRvU3RyaW5nIiwiZXJyb3JNZXNzYWdlIiwic2hvd1dhcm5pbmdUb2FzdCIsInNlYXJjaEVycm9yIiwiaGFuZGxlRXJyb3IiLCJtZXNzYWdlIiwic2hvd0Vycm9yVG9hc3QiLCJyZXRyeUNvdW50Iiwic2VsZWN0U3VnZ2VzdGlvbiIsInN1Z2dlc3Rpb24iLCJjbGVhclNlYXJjaCIsImluaXRpYWxpemUiLCJzdG9yZWQiLCJnZXRJdGVtIiwiaW5jbHVkZXMiLCJyZW1vdmVJdGVtIiwicGFyc2VkIiwicGFyc2UiLCJjbGVhbnVwIiwiY2FuY2VsIiwiY3VycmVudEVycm9yIiwiaXNSZXRyeWluZyIsInRvYXN0cyIsInJldHJ5TWFudWFsbHkiLCJyZW1vdmVUb2FzdCIsImNsZWFyVG9hc3RzIl0sIm1hcHBpbmdzIjoiQUFBQSxzQ0FBc0M7QUFDdEMscURBQXFEO0FBQ3JELHNDQUFzQzs7Ozs7Ozs7Ozs7O1FBNGZ0QztlQUFBOztRQXphZ0JBO2VBQUFBOzs7K0RBakZxQzs0QkFDM0I7NkJBQ1c7MEJBQ047dUNBRU87Z0NBQ1A7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdDL0Isc0NBQXNDO0FBQ3RDLGlDQUFpQztBQUNqQyxzQ0FBc0M7QUFFdEMsTUFBTUMsMEJBQThDO0lBQ2xEO1FBQ0VDLElBQUk7UUFDSkMsTUFBTTtRQUNOQyxPQUFPO1FBQ1BDLE1BQU07SUFDUjtJQUNBO1FBQ0VILElBQUk7UUFDSkMsTUFBTTtRQUNOQyxPQUFPO1FBQ1BDLE1BQU07SUFDUjtJQUNBO1FBQ0VILElBQUk7UUFDSkMsTUFBTTtRQUNOQyxPQUFPO1FBQ1BDLE1BQU07SUFDUjtJQUNBO1FBQ0VILElBQUk7UUFDSkMsTUFBTTtRQUNOQyxPQUFPO1FBQ1BDLE1BQU07SUFDUjtDQUNEO0FBTU0sU0FBU0wsVUFBVU0sVUFBNEIsQ0FBQyxDQUFDO0lBQ3RELE1BQU0sRUFDSkMsYUFBYSxHQUFHLEVBQ2hCQyxpQkFBaUIsQ0FBQyxFQUNsQkMsY0FBYyxFQUFFLEVBQ2hCQyxxQkFBcUIsSUFBSSxFQUN6QkMsUUFBUSxFQUNSQyxrQkFBa0IsRUFD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