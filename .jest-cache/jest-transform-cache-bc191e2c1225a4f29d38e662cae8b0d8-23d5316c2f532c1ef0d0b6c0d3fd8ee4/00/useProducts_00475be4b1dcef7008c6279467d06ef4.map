{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\useProducts.ts"],"sourcesContent":["// ===================================\n// PINTEYA E-COMMERCE - HOOK PARA PRODUCTOS\n// ===================================\n\nimport { useState, useEffect, useCallback, useMemo, useRef } from 'react'\nimport { Product } from '@/types/product'\nimport { ProductFilters, PaginatedResponse, ProductWithCategory } from '@/types/api'\nimport { getProducts } from '@/lib/api/products'\nimport { adaptApiProductsToLegacy, ExtendedProduct } from '@/lib/adapters/productAdapter'\n\ninterface UseProductsState {\n  products: ExtendedProduct[]\n  loading: boolean\n  error: string | null\n  pagination: {\n    page: number\n    limit: number\n    total: number\n    totalPages: number\n  }\n}\n\ninterface UseProductsOptions {\n  initialFilters?: ProductFilters\n  autoFetch?: boolean\n}\n\nexport function useProducts(options: UseProductsOptions = {}) {\n  const { initialFilters = {}, autoFetch = true } = options\n\n  // Referencias para evitar re-renders innecesarios\n  const abortControllerRef = useRef<AbortController | null>(null)\n  const lastRequestRef = useRef<string>('')\n\n  // DEBUG: Log básico para verificar que el hook se ejecuta (solo en desarrollo)\n  if (process.env.NODE_ENV === 'development') {\n  }\n\n  const [state, setState] = useState<UseProductsState>({\n    products: [],\n    loading: false,\n    error: null,\n    pagination: {\n      page: 1,\n      limit: 12,\n      total: 0,\n      totalPages: 0,\n    },\n  })\n\n  const [filters, setFilters] = useState<ProductFilters>(initialFilters)\n\n  /**\n   * Obtiene productos desde la API con optimizaciones de performance\n   */\n  const fetchProducts = useCallback(\n    async (newFilters?: ProductFilters) => {\n      const filtersToUse = newFilters || filters\n\n      try {\n        setState(prev => ({ ...prev, loading: true, error: null }))\n\n        const response = await getProducts(filtersToUse)\n\n        if (response.success) {\n          const adaptedProducts = adaptApiProductsToLegacy(response.data)\n\n          setState(prev => ({\n            ...prev,\n            products: adaptedProducts,\n            loading: false,\n            pagination: response.pagination,\n          }))\n        } else {\n          setState(prev => ({\n            ...prev,\n            loading: false,\n            error: response.error || 'Error obteniendo productos',\n          }))\n        }\n      } catch (error: unknown) {\n        const errorMessage = error instanceof Error ? error.message : 'Error inesperado'\n        setState(prev => ({\n          ...prev,\n          loading: false,\n          error: errorMessage,\n        }))\n      }\n    },\n    [filters]\n  )\n\n  /**\n   * Actualiza los filtros y obtiene productos\n   */\n  const updateFilters = useCallback(\n    (newFilters: Partial<ProductFilters>) => {\n      const updatedFilters = { ...filters, ...newFilters }\n      setFilters(updatedFilters)\n      fetchProducts(updatedFilters)\n    },\n    [filters, fetchProducts]\n  )\n\n  /**\n   * Cambia la página\n   */\n  const changePage = useCallback(\n    (page: number) => {\n      updateFilters({ page })\n    },\n    [updateFilters]\n  )\n\n  /**\n   * Cambia el límite de productos por página\n   */\n  const changeLimit = useCallback(\n    (limit: number) => {\n      updateFilters({ limit, page: 1 })\n    },\n    [updateFilters]\n  )\n\n  /**\n   * Cambia el ordenamiento\n   */\n  const changeSorting = useCallback(\n    (sortBy: 'price' | 'name' | 'created_at', sortOrder: 'asc' | 'desc') => {\n      updateFilters({ sortBy, sortOrder, page: 1 })\n    },\n    [updateFilters]\n  )\n\n  /**\n   * Busca productos por término\n   */\n  const searchProducts = useCallback(\n    (searchTerm: string) => {\n      updateFilters({ search: searchTerm, page: 1 })\n    },\n    [updateFilters]\n  )\n\n  /**\n   * Filtra por categoría\n   */\n  const filterByCategory = useCallback(\n    (category: string) => {\n      updateFilters({ category, page: 1 })\n    },\n    [updateFilters]\n  )\n\n  /**\n   * Filtra por rango de precios\n   */\n  const filterByPriceRange = useCallback(\n    (priceMin?: number, priceMax?: number) => {\n      updateFilters({ priceMin, priceMax, page: 1 })\n    },\n    [updateFilters]\n  )\n\n  /**\n   * Limpia todos los filtros\n   */\n  const clearFilters = useCallback(() => {\n    const clearedFilters: ProductFilters = {\n      page: 1,\n      limit: filters.limit || 12,\n      sortBy: 'created_at',\n      sortOrder: 'desc',\n    }\n    setFilters(clearedFilters)\n    fetchProducts(clearedFilters)\n  }, [filters.limit, fetchProducts])\n\n  /**\n   * Refresca los productos\n   */\n  const refresh = useCallback(() => {\n    fetchProducts()\n  }, [fetchProducts])\n\n  // Auto-fetch al montar el componente\n  useEffect(() => {\n    if (autoFetch) {\n      fetchProducts()\n    }\n  }, [autoFetch]) // Removido fetchProducts de las dependencias para evitar bucles\n\n  // Cleanup effect para cancelar requests pendientes\n  useEffect(() => {\n    return () => {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort()\n      }\n    }\n  }, [])\n\n  // Memoized helpers para optimizar renders\n  const helpers = useMemo(\n    () => ({\n      hasProducts: state.products.length > 0,\n      isEmpty: !state.loading && state.products.length === 0,\n      hasError: !!state.error,\n      hasNextPage: state.pagination.page < state.pagination.totalPages,\n      hasPrevPage: state.pagination.page > 1,\n    }),\n    [\n      state.products.length,\n      state.loading,\n      state.error,\n      state.pagination.page,\n      state.pagination.totalPages,\n    ]\n  )\n\n  return {\n    // Estado\n    products: state.products,\n    loading: state.loading,\n    error: state.error,\n    pagination: state.pagination,\n    filters,\n\n    // Acciones\n    fetchProducts,\n    updateFilters,\n    changePage,\n    changeLimit,\n    changeSorting,\n    searchProducts,\n    filterByCategory,\n    filterByPriceRange,\n    clearFilters,\n    refresh,\n\n    // Helpers memoizados\n    ...helpers,\n  }\n}\n"],"names":["useProducts","options","initialFilters","autoFetch","abortControllerRef","useRef","lastRequestRef","process","env","NODE_ENV","state","setState","useState","products","loading","error","pagination","page","limit","total","totalPages","filters","setFilters","fetchProducts","useCallback","newFilters","filtersToUse","prev","response","getProducts","success","adaptedProducts","adaptApiProductsToLegacy","data","errorMessage","Error","message","updateFilters","updatedFilters","changePage","changeLimit","changeSorting","sortBy","sortOrder","searchProducts","searchTerm","search","filterByCategory","category","filterByPriceRange","priceMin","priceMax","clearFilters","clearedFilters","refresh","useEffect","current","abort","helpers","useMemo","hasProducts","length","isEmpty","hasError","hasNextPage","hasPrevPage"],"mappings":"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"}