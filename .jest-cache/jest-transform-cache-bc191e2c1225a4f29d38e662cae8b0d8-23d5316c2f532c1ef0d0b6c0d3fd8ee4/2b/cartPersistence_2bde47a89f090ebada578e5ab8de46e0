c3f3f2e3aa313381bc69bb2ade6e3c01
// ===================================
// PINTEYA E-COMMERCE - CART PERSISTENCE MIDDLEWARE
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get cartPersistenceMiddleware () {
        return cartPersistenceMiddleware;
    },
    get clearCartFromStorage () {
        return clearCartFromStorage;
    },
    get loadCartFromStorage () {
        return loadCartFromStorage;
    },
    get loadUserCart () {
        return loadUserCart;
    },
    get migrateTemporaryCart () {
        return migrateTemporaryCart;
    },
    get saveUserCart () {
        return saveUserCart;
    },
    get useCartPersistence () {
        return useCartPersistence;
    }
});
// Clave para localStorage
const CART_STORAGE_KEY = 'pinteya-cart';
const loadCartFromStorage = ()=>{
    // Solo ejecutar en el cliente
    if (typeof window === 'undefined') {
        return [];
    }
    try {
        const stored = localStorage.getItem(CART_STORAGE_KEY);
        if (!stored || stored.trim() === '' || stored === '""' || stored === "''") {
            return [];
        }
        // Validar que el string no esté corrupto
        if (stored.includes('""') && stored.length < 5) {
            console.warn('Detected corrupted cart localStorage data, cleaning up');
            localStorage.removeItem(CART_STORAGE_KEY);
            return [];
        }
        const parsed = JSON.parse(stored);
        // Verificar estructura válida
        if (!parsed || typeof parsed !== 'object') {
            console.warn('Invalid cart data structure, cleaning up');
            localStorage.removeItem(CART_STORAGE_KEY);
            return [];
        }
        // Verificar que no sea muy antiguo (7 días)
        const maxAge = 7 * 24 * 60 * 60 * 1000; // 7 días en ms
        const isExpired = parsed.timestamp && Date.now() - parsed.timestamp > maxAge;
        if (isExpired) {
            localStorage.removeItem(CART_STORAGE_KEY);
            return [];
        }
        return parsed.items || [];
    } catch (error) {
        console.warn('Error loading cart from localStorage:', error);
        // Limpiar localStorage corrupto
        localStorage.removeItem(CART_STORAGE_KEY);
        return [];
    }
};
// Función para guardar el carrito en localStorage
const saveCartToStorage = (cartItems)=>{
    // Solo ejecutar en el cliente
    if (typeof window === 'undefined') {
        return;
    }
    try {
        // Si el carrito está vacío, limpiar localStorage
        if (cartItems.length === 0) {
            localStorage.removeItem(CART_STORAGE_KEY);
            return;
        }
        const dataToStore = {
            items: cartItems,
            timestamp: Date.now(),
            version: '1.0.0'
        };
        localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(dataToStore));
    } catch (error) {
        console.warn('Error saving cart to localStorage:', error);
    }
};
const clearCartFromStorage = ()=>{
    if (typeof window === 'undefined') {
        return;
    }
    try {
        localStorage.removeItem(CART_STORAGE_KEY);
    } catch (error) {
        console.warn('Error clearing cart from localStorage:', error);
    }
};
// Variable para manejar debounce
let saveTimeout = null;
const cartPersistenceMiddleware = (store)=>(next)=>(action)=>{
            // Ejecutar la acción primero
            const result = next(action);
            // Solo persistir acciones relacionadas con el carrito
            if (action.type?.startsWith('cart/')) {
                const state = store.getState();
                const cartItems = state.cartReducer.items;
                // Limpiar timeout anterior si existe
                if (saveTimeout) {
                    clearTimeout(saveTimeout);
                }
                // Guardar en localStorage con debounce más largo para evitar escrituras excesivas
                saveTimeout = setTimeout(()=>{
                    // Solo guardar si hay items o si se está vaciando el carrito
                    if (cartItems.length > 0 || action.type === 'cart/removeAllItemsFromCart') {
                        saveCartToStorage(cartItems);
                    }
                    saveTimeout = null;
                }, 500); // Aumentado de 100ms a 500ms
            }
            return result;
        };
const useCartPersistence = ()=>{
    const loadCart = ()=>loadCartFromStorage();
    const clearCart = ()=>clearCartFromStorage();
    return {
        loadCart,
        clearCart
    };
};
const migrateTemporaryCart = async (temporaryCartItems, userId)=>{
    try {
        // Aquí se podría implementar la lógica para guardar el carrito
        // en la base de datos asociado al usuario
        // Por ahora, simplemente limpiamos el localStorage
        // ya que el carrito se mantendrá en Redux
        // En una implementación completa, aquí haríamos:
        // 1. Enviar los items al backend para asociarlos al usuario
        // 2. Limpiar el localStorage
        // 3. Cargar el carrito del usuario desde el backend
        return true;
    } catch (error) {
        console.error('Error migrating temporary cart:', error);
        return false;
    }
};
const loadUserCart = async (userId)=>{
    try {
        // Aquí se implementaría la lógica para cargar el carrito
        // del usuario desde la base de datos
        // En una implementación completa, aquí haríamos:
        // 1. Hacer una petición al backend para obtener el carrito del usuario
        // 2. Retornar los items del carrito
        // Por ahora, retornamos un array vacío
        return [];
    } catch (error) {
        console.error('Error loading user cart:', error);
        return [];
    }
};
const saveUserCart = async (userId, cartItems)=>{
    try {
        // Aquí se implementaría la lógica para guardar el carrito
        // del usuario en la base de datos
        // En una implementación completa, aquí haríamos:
        // 1. Enviar los items al backend para guardarlos asociados al usuario
        // 2. Manejar la respuesta del backend
        return true;
    } catch (error) {
        console.error('Error saving user cart:', error);
        return false;
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xccmVkdXhcXG1pZGRsZXdhcmVcXGNhcnRQZXJzaXN0ZW5jZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQSU5URVlBIEUtQ09NTUVSQ0UgLSBDQVJUIFBFUlNJU1RFTkNFIE1JRERMRVdBUkVcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IE1pZGRsZXdhcmUsIEFueUFjdGlvbiB9IGZyb20gJ0ByZWR1eGpzL3Rvb2xraXQnO1xyXG5pbXBvcnQgeyBSb290U3RhdGUgfSBmcm9tICcuLi9zdG9yZSc7XHJcblxyXG4vLyBDbGF2ZSBwYXJhIGxvY2FsU3RvcmFnZVxyXG5jb25zdCBDQVJUX1NUT1JBR0VfS0VZID0gJ3BpbnRleWEtY2FydCc7XHJcblxyXG4vLyBEZWZpbmljacOzbiBkZSBDYXJ0SXRlbSAoaW1wb3J0YWRhIGRlc2RlIGNhcnQtc2xpY2UpXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ2FydEl0ZW0ge1xyXG4gIGlkOiBudW1iZXI7XHJcbiAgdGl0bGU6IHN0cmluZztcclxuICBwcmljZTogbnVtYmVyO1xyXG4gIGRpc2NvdW50ZWRQcmljZTogbnVtYmVyO1xyXG4gIHF1YW50aXR5OiBudW1iZXI7XHJcbiAgaW1ncz86IHtcclxuICAgIHRodW1ibmFpbHM6IHN0cmluZ1tdO1xyXG4gICAgcHJldmlld3M6IHN0cmluZ1tdO1xyXG4gIH07XHJcbn1cclxuXHJcbi8vIFRpcG9zIHBhcmEgZWwgZXN0YWRvIHBlcnNpc3RpZG9cclxuaW50ZXJmYWNlIFBlcnNpc3RlZENhcnRTdGF0ZSB7XHJcbiAgaXRlbXM6IENhcnRJdGVtW107XHJcbiAgdGltZXN0YW1wOiBudW1iZXI7XHJcbiAgdmVyc2lvbjogc3RyaW5nO1xyXG59XHJcblxyXG4vLyBGdW5jacOzbiBwYXJhIGNhcmdhciBlbCBjYXJyaXRvIGRlc2RlIGxvY2FsU3RvcmFnZVxyXG5leHBvcnQgY29uc3QgbG9hZENhcnRGcm9tU3RvcmFnZSA9ICgpOiBDYXJ0SXRlbVtdID0+IHtcclxuICAvLyBTb2xvIGVqZWN1dGFyIGVuIGVsIGNsaWVudGVcclxuICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdG9yZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShDQVJUX1NUT1JBR0VfS0VZKTtcclxuICAgIGlmICghc3RvcmVkIHx8IHN0b3JlZC50cmltKCkgPT09ICcnIHx8IHN0b3JlZCA9PT0gJ1wiXCInIHx8IHN0b3JlZCA9PT0gXCInJ1wiKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWYWxpZGFyIHF1ZSBlbCBzdHJpbmcgbm8gZXN0w6kgY29ycnVwdG9cclxuICAgIGlmIChzdG9yZWQuaW5jbHVkZXMoJ1wiXCInKSAmJiBzdG9yZWQubGVuZ3RoIDwgNSkge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ0RldGVjdGVkIGNvcnJ1cHRlZCBjYXJ0IGxvY2FsU3RvcmFnZSBkYXRhLCBjbGVhbmluZyB1cCcpO1xyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShDQVJUX1NUT1JBR0VfS0VZKTtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHBhcnNlZDogUGVyc2lzdGVkQ2FydFN0YXRlID0gSlNPTi5wYXJzZShzdG9yZWQpO1xyXG5cclxuICAgIC8vIFZlcmlmaWNhciBlc3RydWN0dXJhIHbDoWxpZGFcclxuICAgIGlmICghcGFyc2VkIHx8IHR5cGVvZiBwYXJzZWQgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignSW52YWxpZCBjYXJ0IGRhdGEgc3RydWN0dXJlLCBjbGVhbmluZyB1cCcpO1xyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShDQVJUX1NUT1JBR0VfS0VZKTtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZlcmlmaWNhciBxdWUgbm8gc2VhIG11eSBhbnRpZ3VvICg3IGTDrWFzKVxyXG4gICAgY29uc3QgbWF4QWdlID0gNyAqIDI0ICogNjAgKiA2MCAqIDEwMDA7IC8vIDcgZMOtYXMgZW4gbXNcclxuICAgIGNvbnN0IGlzRXhwaXJlZCA9IHBhcnNlZC50aW1lc3RhbXAgJiYgKERhdGUubm93KCkgLSBwYXJzZWQudGltZXN0YW1wID4gbWF4QWdlKTtcclxuXHJcbiAgICBpZiAoaXNFeHBpcmVkKSB7XHJcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKENBUlRfU1RPUkFHRV9LRVkpO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBhcnNlZC5pdGVtcyB8fCBbXTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS53YXJuKCdFcnJvciBsb2FkaW5nIGNhcnQgZnJvbSBsb2NhbFN0b3JhZ2U6JywgZXJyb3IpO1xyXG4gICAgLy8gTGltcGlhciBsb2NhbFN0b3JhZ2UgY29ycnVwdG9cclxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKENBUlRfU1RPUkFHRV9LRVkpO1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIEZ1bmNpw7NuIHBhcmEgZ3VhcmRhciBlbCBjYXJyaXRvIGVuIGxvY2FsU3RvcmFnZVxyXG5jb25zdCBzYXZlQ2FydFRvU3RvcmFnZSA9IChjYXJ0SXRlbXM6IENhcnRJdGVtW10pOiB2b2lkID0+IHtcclxuICAvLyBTb2xvIGVqZWN1dGFyIGVuIGVsIGNsaWVudGVcclxuICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBTaSBlbCBjYXJyaXRvIGVzdMOhIHZhY8OtbywgbGltcGlhciBsb2NhbFN0b3JhZ2VcclxuICAgIGlmIChjYXJ0SXRlbXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKENBUlRfU1RPUkFHRV9LRVkpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZGF0YVRvU3RvcmU6IFBlcnNpc3RlZENhcnRTdGF0ZSA9IHtcclxuICAgICAgaXRlbXM6IGNhcnRJdGVtcyxcclxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxyXG4gICAgICB2ZXJzaW9uOiAnMS4wLjAnXHJcbiAgICB9O1xyXG5cclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKENBUlRfU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KGRhdGFUb1N0b3JlKSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUud2FybignRXJyb3Igc2F2aW5nIGNhcnQgdG8gbG9jYWxTdG9yYWdlOicsIGVycm9yKTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBGdW5jacOzbiBwYXJhIGxpbXBpYXIgZWwgY2Fycml0byBkZWwgbG9jYWxTdG9yYWdlXHJcbmV4cG9ydCBjb25zdCBjbGVhckNhcnRGcm9tU3RvcmFnZSA9ICgpOiB2b2lkID0+IHtcclxuICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShDQVJUX1NUT1JBR0VfS0VZKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS53YXJuKCdFcnJvciBjbGVhcmluZyBjYXJ0IGZyb20gbG9jYWxTdG9yYWdlOicsIGVycm9yKTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBWYXJpYWJsZSBwYXJhIG1hbmVqYXIgZGVib3VuY2VcclxubGV0IHNhdmVUaW1lb3V0OiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xyXG5cclxuLy8gTWlkZGxld2FyZSBwYXJhIHBlcnNpc3RpciBlbCBjYXJyaXRvIGF1dG9tw6F0aWNhbWVudGVcclxuZXhwb3J0IGNvbnN0IGNhcnRQZXJzaXN0ZW5jZU1pZGRsZXdhcmU6IE1pZGRsZXdhcmUgPVxyXG4gIChzdG9yZSkgPT4gKG5leHQpID0+IChhY3Rpb246IEFueUFjdGlvbikgPT4ge1xyXG4gICAgLy8gRWplY3V0YXIgbGEgYWNjacOzbiBwcmltZXJvXHJcbiAgICBjb25zdCByZXN1bHQgPSBuZXh0KGFjdGlvbik7XHJcblxyXG4gICAgLy8gU29sbyBwZXJzaXN0aXIgYWNjaW9uZXMgcmVsYWNpb25hZGFzIGNvbiBlbCBjYXJyaXRvXHJcbiAgICBpZiAoYWN0aW9uLnR5cGU/LnN0YXJ0c1dpdGgoJ2NhcnQvJykpIHtcclxuICAgICAgY29uc3Qgc3RhdGUgPSBzdG9yZS5nZXRTdGF0ZSgpIGFzIFJvb3RTdGF0ZTtcclxuICAgICAgY29uc3QgY2FydEl0ZW1zID0gc3RhdGUuY2FydFJlZHVjZXIuaXRlbXM7XHJcblxyXG4gICAgICAvLyBMaW1waWFyIHRpbWVvdXQgYW50ZXJpb3Igc2kgZXhpc3RlXHJcbiAgICAgIGlmIChzYXZlVGltZW91dCkge1xyXG4gICAgICAgIGNsZWFyVGltZW91dChzYXZlVGltZW91dCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEd1YXJkYXIgZW4gbG9jYWxTdG9yYWdlIGNvbiBkZWJvdW5jZSBtw6FzIGxhcmdvIHBhcmEgZXZpdGFyIGVzY3JpdHVyYXMgZXhjZXNpdmFzXHJcbiAgICAgIHNhdmVUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgLy8gU29sbyBndWFyZGFyIHNpIGhheSBpdGVtcyBvIHNpIHNlIGVzdMOhIHZhY2lhbmRvIGVsIGNhcnJpdG9cclxuICAgICAgICBpZiAoY2FydEl0ZW1zLmxlbmd0aCA+IDAgfHwgYWN0aW9uLnR5cGUgPT09ICdjYXJ0L3JlbW92ZUFsbEl0ZW1zRnJvbUNhcnQnKSB7XHJcbiAgICAgICAgICBzYXZlQ2FydFRvU3RvcmFnZShjYXJ0SXRlbXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzYXZlVGltZW91dCA9IG51bGw7XHJcbiAgICAgIH0sIDUwMCk7IC8vIEF1bWVudGFkbyBkZSAxMDBtcyBhIDUwMG1zXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9O1xyXG5cclxuLy8gSG9vayBwZXJzb25hbGl6YWRvIHBhcmEgbWFuZWphciBsYSBwZXJzaXN0ZW5jaWEgZGVsIGNhcnJpdG9cclxuZXhwb3J0IGNvbnN0IHVzZUNhcnRQZXJzaXN0ZW5jZSA9ICgpID0+IHtcclxuICBjb25zdCBsb2FkQ2FydCA9ICgpID0+IGxvYWRDYXJ0RnJvbVN0b3JhZ2UoKTtcclxuICBjb25zdCBjbGVhckNhcnQgPSAoKSA9PiBjbGVhckNhcnRGcm9tU3RvcmFnZSgpO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgbG9hZENhcnQsXHJcbiAgICBjbGVhckNhcnRcclxuICB9O1xyXG59O1xyXG5cclxuLy8gRnVuY2nDs24gcGFyYSBtaWdyYXIgY2Fycml0byB0ZW1wb3JhbCBhIHVzdWFyaW8gYXV0ZW50aWNhZG9cclxuZXhwb3J0IGNvbnN0IG1pZ3JhdGVUZW1wb3JhcnlDYXJ0ID0gYXN5bmMgKFxyXG4gIHRlbXBvcmFyeUNhcnRJdGVtczogQ2FydEl0ZW1bXSxcclxuICB1c2VySWQ6IHN0cmluZ1xyXG4pOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gQXF1w60gc2UgcG9kcsOtYSBpbXBsZW1lbnRhciBsYSBsw7NnaWNhIHBhcmEgZ3VhcmRhciBlbCBjYXJyaXRvXHJcbiAgICAvLyBlbiBsYSBiYXNlIGRlIGRhdG9zIGFzb2NpYWRvIGFsIHVzdWFyaW9cclxuICAgIC8vIFBvciBhaG9yYSwgc2ltcGxlbWVudGUgbGltcGlhbW9zIGVsIGxvY2FsU3RvcmFnZVxyXG4gICAgLy8geWEgcXVlIGVsIGNhcnJpdG8gc2UgbWFudGVuZHLDoSBlbiBSZWR1eFxyXG4gICAgXHJcbiAgICBcclxuICAgIC8vIEVuIHVuYSBpbXBsZW1lbnRhY2nDs24gY29tcGxldGEsIGFxdcOtIGhhcsOtYW1vczpcclxuICAgIC8vIDEuIEVudmlhciBsb3MgaXRlbXMgYWwgYmFja2VuZCBwYXJhIGFzb2NpYXJsb3MgYWwgdXN1YXJpb1xyXG4gICAgLy8gMi4gTGltcGlhciBlbCBsb2NhbFN0b3JhZ2VcclxuICAgIC8vIDMuIENhcmdhciBlbCBjYXJyaXRvIGRlbCB1c3VhcmlvIGRlc2RlIGVsIGJhY2tlbmRcclxuICAgIFxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG1pZ3JhdGluZyB0ZW1wb3JhcnkgY2FydDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRnVuY2nDs24gcGFyYSBjYXJnYXIgY2Fycml0byBkZSB1c3VhcmlvIGF1dGVudGljYWRvXHJcbmV4cG9ydCBjb25zdCBsb2FkVXNlckNhcnQgPSBhc3luYyAodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPENhcnRJdGVtW10+ID0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gQXF1w60gc2UgaW1wbGVtZW50YXLDrWEgbGEgbMOzZ2ljYSBwYXJhIGNhcmdhciBlbCBjYXJyaXRvXHJcbiAgICAvLyBkZWwgdXN1YXJpbyBkZXNkZSBsYSBiYXNlIGRlIGRhdG9zXHJcbiAgICBcclxuICAgIFxyXG4gICAgLy8gRW4gdW5hIGltcGxlbWVudGFjacOzbiBjb21wbGV0YSwgYXF1w60gaGFyw61hbW9zOlxyXG4gICAgLy8gMS4gSGFjZXIgdW5hIHBldGljacOzbiBhbCBiYWNrZW5kIHBhcmEgb2J0ZW5lciBlbCBjYXJyaXRvIGRlbCB1c3VhcmlvXHJcbiAgICAvLyAyLiBSZXRvcm5hciBsb3MgaXRlbXMgZGVsIGNhcnJpdG9cclxuICAgIFxyXG4gICAgLy8gUG9yIGFob3JhLCByZXRvcm5hbW9zIHVuIGFycmF5IHZhY8Otb1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIHVzZXIgY2FydDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRnVuY2nDs24gcGFyYSBndWFyZGFyIGNhcnJpdG8gZGUgdXN1YXJpbyBhdXRlbnRpY2Fkb1xyXG5leHBvcnQgY29uc3Qgc2F2ZVVzZXJDYXJ0ID0gYXN5bmMgKFxyXG4gIHVzZXJJZDogc3RyaW5nLCBcclxuICBjYXJ0SXRlbXM6IENhcnRJdGVtW11cclxuKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIEFxdcOtIHNlIGltcGxlbWVudGFyw61hIGxhIGzDs2dpY2EgcGFyYSBndWFyZGFyIGVsIGNhcnJpdG9cclxuICAgIC8vIGRlbCB1c3VhcmlvIGVuIGxhIGJhc2UgZGUgZGF0b3NcclxuICAgIFxyXG4gICAgXHJcbiAgICAvLyBFbiB1bmEgaW1wbGVtZW50YWNpw7NuIGNvbXBsZXRhLCBhcXXDrSBoYXLDrWFtb3M6XHJcbiAgICAvLyAxLiBFbnZpYXIgbG9zIGl0ZW1zIGFsIGJhY2tlbmQgcGFyYSBndWFyZGFybG9zIGFzb2NpYWRvcyBhbCB1c3VhcmlvXHJcbiAgICAvLyAyLiBNYW5lamFyIGxhIHJlc3B1ZXN0YSBkZWwgYmFja2VuZFxyXG4gICAgXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3Igc2F2aW5nIHVzZXIgY2FydDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59O1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iXSwibmFtZXMiOlsiY2FydFBlcnNpc3RlbmNlTWlkZGxld2FyZSIsImNsZWFyQ2FydEZyb21TdG9yYWdlIiwibG9hZENhcnRGcm9tU3RvcmFnZSIsImxvYWRVc2VyQ2FydCIsIm1pZ3JhdGVUZW1wb3JhcnlDYXJ0Iiwic2F2ZVVzZXJDYXJ0IiwidXNlQ2FydFBlcnNpc3RlbmNlIiwiQ0FSVF9TVE9SQUdFX0tFWSIsIndpbmRvdyIsInN0b3JlZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJ0cmltIiwiaW5jbHVkZXMiLCJsZW5ndGgiLCJjb25zb2xlIiwid2FybiIsInJlbW92ZUl0ZW0iLCJwYXJzZWQiLCJKU09OIiwicGFyc2UiLCJtYXhBZ2UiLCJpc0V4cGlyZWQiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwiaXRlbXMiLCJlcnJvciIsInNhdmVDYXJ0VG9TdG9yYWdlIiwiY2FydEl0ZW1zIiwiZGF0YVRvU3RvcmUiLCJ2ZXJzaW9uIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsInNhdmVUaW1lb3V0Iiwic3RvcmUiLCJuZXh0IiwiYWN0aW9uIiwicmVzdWx0IiwidHlwZSIsInN0YXJ0c1dpdGgiLCJzdGF0ZSIsImdldFN0YXRlIiwiY2FydFJlZHVjZXIiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwibG9hZENhcnQiLCJjbGVhckNhcnQiLCJ0ZW1wb3JhcnlDYXJ0SXRlbXMiLCJ1c2VySWQiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0QyxtREFBbUQ7QUFDbkQsc0NBQXNDOzs7Ozs7Ozs7Ozs7UUFzSHpCQTtlQUFBQTs7UUFoQkFDO2VBQUFBOztRQXpFQUM7ZUFBQUE7O1FBeUpBQztlQUFBQTs7UUF4QkFDO2VBQUFBOztRQTJDQUM7ZUFBQUE7O1FBdERBQztlQUFBQTs7O0FBOUliLDBCQUEwQjtBQUMxQixNQUFNQyxtQkFBbUI7QUF1QmxCLE1BQU1MLHNCQUFzQjtJQUNqQyw4QkFBOEI7SUFDOUIsSUFBSSxPQUFPTSxXQUFXLGFBQWE7UUFDakMsT0FBTyxFQUFFO0lBQ1g7SUFFQSxJQUFJO1FBQ0YsTUFBTUMsU0FBU0MsYUFBYUMsT0FBTyxDQUFDSjtRQUNwQyxJQUFJLENBQUNFLFVBQVVBLE9BQU9HLElBQUksT0FBTyxNQUFNSCxXQUFXLFFBQVFBLFdBQVcsTUFBTTtZQUN6RSxPQUFPLEVBQUU7UUFDWDtRQUVBLHlDQUF5QztRQUN6QyxJQUFJQSxPQUFPSSxRQUFRLENBQUMsU0FBU0osT0FBT0ssTUFBTSxHQUFHLEdBQUc7WUFDOUNDLFFBQVFDLElBQUksQ0FBQztZQUNiTixhQUFhTyxVQUFVLENBQUNWO1lBQ3hCLE9BQU8sRUFBRTtRQUNYO1FBRUEsTUFBTVcsU0FBNkJDLEtBQUtDLEtBQUssQ0FBQ1g7UUFFOUMsOEJBQThCO1FBQzlCLElBQUksQ0FBQ1MsVUFBVSxPQUFPQSxXQUFXLFVBQVU7WUFDekNILFFBQVFDLElBQUksQ0FBQztZQUNiTixhQUFhTyxVQUFVLENBQUNWO1lBQ3hCLE9BQU8sRUFBRTtRQUNYO1FBRUEsNENBQTRDO1FBQzVDLE1BQU1jLFNBQVMsSUFBSSxLQUFLLEtBQUssS0FBSyxNQUFNLGVBQWU7UUFDdkQsTUFBTUMsWUFBWUosT0FBT0ssU0FBUyxJQUFLQyxLQUFLQyxHQUFHLEtBQUtQLE9BQU9LLFNBQVMsR0FBR0Y7UUFFdkUsSUFBSUMsV0FBVztZQUNiWixhQUFhTyxVQUFVLENBQUNWO1lBQ3hCLE9BQU8sRUFBRTtRQUNYO1FBRUEsT0FBT1csT0FBT1EsS0FBSyxJQUFJLEVBQUU7SUFDM0IsRUFBRSxPQUFPQyxPQUFPO1FBQ2RaLFFBQVFDLElBQUksQ0FBQyx5Q0FBeUNXO1FBQ3RELGdDQUFnQztRQUNoQ2pCLGFBQWFPLFVBQVUsQ0FBQ1Y7UUFDeEIsT0FBTyxFQUFFO0lBQ1g7QUFDRjtBQUVBLGtEQUFrRDtBQUNsRCxNQUFNcUIsb0JBQW9CLENBQUNDO0lBQ3pCLDhCQUE4QjtJQUM5QixJQUFJLE9BQU9yQixXQUFXLGFBQWE7UUFDakM7SUFDRjtJQUVBLElBQUk7UUFDRixpREFBaUQ7UUFDakQsSUFBSXFCLFVBQVVmLE1BQU0sS0FBSyxHQUFHO1lBQzFCSixhQUFhTyxVQUFVLENBQUNWO1lBQ3hCO1FBQ0Y7UUFFQSxNQUFNdUIsY0FBa0M7WUFDdENKLE9BQU9HO1lBQ1BOLFdBQVdDLEtBQUtDLEdBQUc7WUFDbkJNLFNBQVM7UUFDWDtRQUVBckIsYUFBYXNCLE9BQU8sQ0FBQ3pCLGtCQUFrQlksS0FBS2MsU0FBUyxDQUFDSDtJQUN4RCxFQUFFLE9BQU9ILE9BQU87UUFDZFosUUFBUUMsSUFBSSxDQUFDLHNDQUFzQ1c7SUFDckQ7QUFDRjtBQUdPLE1BQU0xQix1QkFBdUI7SUFDbEMsSUFBSSxPQUFPTyxXQUFXLGFBQWE7UUFDakM7SUFDRjtJQUVBLElBQUk7UUFDRkUsYUFBYU8sVUFBVSxDQUFDVjtJQUMxQixFQUFFLE9BQU9vQixPQUFPO1FBQ2RaLFFBQVFDLElBQUksQ0FBQywwQ0FBMENXO0lBQ3pEO0FBQ0Y7QUFFQSxpQ0FBaUM7QUFDakMsSUFBSU8sY0FBcUM7QUFHbEMsTUFBTWxDLDRCQUNYLENBQUNtQyxRQUFVLENBQUNDLE9BQVMsQ0FBQ0M7WUFDcEIsNkJBQTZCO1lBQzdCLE1BQU1DLFNBQVNGLEtBQUtDO1lBRXBCLHNEQUFzRDtZQUN0RCxJQUFJQSxPQUFPRSxJQUFJLEVBQUVDLFdBQVcsVUFBVTtnQkFDcEMsTUFBTUMsUUFBUU4sTUFBTU8sUUFBUTtnQkFDNUIsTUFBTWIsWUFBWVksTUFBTUUsV0FBVyxDQUFDakIsS0FBSztnQkFFekMscUNBQXFDO2dCQUNyQyxJQUFJUSxhQUFhO29CQUNmVSxhQUFhVjtnQkFDZjtnQkFFQSxrRkFBa0Y7Z0JBQ2xGQSxjQUFjVyxXQUFXO29CQUN2Qiw2REFBNkQ7b0JBQzdELElBQUloQixVQUFVZixNQUFNLEdBQUcsS0FBS3VCLE9BQU9FLElBQUksS0FBSywrQkFBK0I7d0JBQ3pFWCxrQkFBa0JDO29CQUNwQjtvQkFDQUssY0FBYztnQkFDaEIsR0FBRyxNQUFNLDZCQUE2QjtZQUN4QztZQUVBLE9BQU9JO1FBQ1Q7QUFHSyxNQUFNaEMscUJBQXFCO0lBQ2hDLE1BQU13QyxXQUFXLElBQU01QztJQUN2QixNQUFNNkMsWUFBWSxJQUFNOUM7SUFFeEIsT0FBTztRQUNMNkM7UUFDQUM7SUFDRjtBQUNGO0FBR08sTUFBTTNDLHVCQUF1QixPQUNsQzRDLG9CQUNBQztJQUVBLElBQUk7UUFDRiwrREFBK0Q7UUFDL0QsMENBQTBDO1FBQzFDLG1EQUFtRDtRQUNuRCwwQ0FBMEM7UUFHMUMsaURBQWlEO1FBQ2pELDREQUE0RDtRQUM1RCw2QkFBNkI7UUFDN0Isb0RBQW9EO1FBRXBELE9BQU87SUFDVCxFQUFFLE9BQU90QixPQUFPO1FBQ2RaLFFBQVFZLEtBQUssQ0FBQyxtQ0FBbUNBO1FBQ2pELE9BQU87SUFDVDtBQUNGO0FBR08sTUFBTXhCLGVBQWUsT0FBTzhDO0lBQ2pDLElBQUk7UUFDRix5REFBeUQ7UUFDekQscUNBQXFDO1FBR3JDLGlEQUFpRDtRQUNqRCx1RUFBdUU7UUFDdkUsb0NBQW9DO1FBRXBDLHVDQUF1QztRQUN2QyxPQUFPLEVBQUU7SUFDWCxFQUFFLE9BQU90QixPQUFPO1FBQ2RaLFFBQVFZLEtBQUssQ0FBQyw0QkFBNEJBO1FBQzFDLE9BQU8sRUFBRTtJQUNYO0FBQ0Y7QUFHTyxNQUFNdEIsZUFBZSxPQUMxQjRDLFFBQ0FwQjtJQUVBLElBQUk7UUFDRiwwREFBMEQ7UUFDMUQsa0NBQWtDO1FBR2xDLGlEQUFpRDtRQUNqRCxzRUFBc0U7UUFDdEUsc0NBQXNDO1FBRXRDLE9BQU87SUFDVCxFQUFFLE9BQU9GLE9BQU87UUFDZFosUUFBUVksS0FBSyxDQUFDLDJCQUEyQkE7UUFDekMsT0FBTztJQUNUO0FBQ0YifQ==