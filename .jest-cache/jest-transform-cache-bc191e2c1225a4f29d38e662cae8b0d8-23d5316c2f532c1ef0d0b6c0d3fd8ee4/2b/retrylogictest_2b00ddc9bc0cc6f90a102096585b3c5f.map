{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\lib\\retry-logic.test.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - RETRY LOGIC TESTS\r\n// ===================================\r\n\r\nimport {\r\n  retryWithBackoff,\r\n  retryMercadoPagoOperation,\r\n  retryWebhookOperation,\r\n  RETRY_CONFIGS,\r\n  RetryConfig\r\n} from '@/lib/retry-logic';\r\n\r\n// Mock logger\r\njest.mock('@/lib/enterprise/logger', () => ({\r\n  logger: {\r\n    info: jest.fn(),\r\n    debug: jest.fn(),\r\n    warn: jest.fn(),\r\n    error: jest.fn(),\r\n  },\r\n  LogLevel: {\r\n    INFO: 'info',\r\n    DEBUG: 'debug',\r\n    WARN: 'warn',\r\n    ERROR: 'error',\r\n  },\r\n  LogCategory: {\r\n    SYSTEM: 'system',\r\n    PAYMENT: 'payment',\r\n  },\r\n}));\r\n\r\ndescribe('Retry Logic', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('retryWithBackoff', () => {\r\n    const basicConfig: RetryConfig = {\r\n      maxRetries: 2,\r\n      baseDelayMs: 100,\r\n      maxDelayMs: 1000,\r\n      backoffMultiplier: 2,\r\n      jitterMs: 50,\r\n      retryableErrors: ['ECONNRESET', '500'],\r\n      nonRetryableErrors: ['400', '401']\r\n    };\r\n\r\n    it('should succeed on first attempt', async () => {\r\n      const mockOperation = jest.fn().mockResolvedValue('success');\r\n\r\n      const promise = retryWithBackoff(mockOperation, basicConfig, 'test-operation');\r\n      const result = await promise;\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toBe('success');\r\n      expect(result.attempts).toBe(1);\r\n      expect(mockOperation).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('should retry on retryable errors', async () => {\r\n      // Usar configuración con delays muy pequeños para tests rápidos\r\n      const fastConfig: RetryConfig = {\r\n        ...basicConfig,\r\n        baseDelayMs: 1,\r\n        maxDelayMs: 5,\r\n        jitterMs: 0\r\n      };\r\n\r\n      const mockOperation = jest.fn()\r\n        .mockRejectedValueOnce(new Error('ECONNRESET'))\r\n        .mockResolvedValue('success');\r\n\r\n      const result = await retryWithBackoff(mockOperation, fastConfig, 'test-operation');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toBe('success');\r\n      expect(result.attempts).toBe(2);\r\n      expect(mockOperation).toHaveBeenCalledTimes(2);\r\n    });\r\n\r\n    it('should not retry on non-retryable errors', async () => {\r\n      const mockOperation = jest.fn().mockRejectedValue(new Error('400 Bad Request'));\r\n\r\n      const result = await retryWithBackoff(mockOperation, basicConfig, 'test-operation');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.attempts).toBe(1);\r\n      expect(result.error?.message).toContain('400');\r\n      expect(mockOperation).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('should fail after max retries', async () => {\r\n      const fastConfig: RetryConfig = {\r\n        ...basicConfig,\r\n        baseDelayMs: 1,\r\n        maxDelayMs: 5,\r\n        jitterMs: 0\r\n      };\r\n\r\n      const mockOperation = jest.fn().mockRejectedValue(new Error('ECONNRESET'));\r\n\r\n      const result = await retryWithBackoff(mockOperation, fastConfig, 'test-operation');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.attempts).toBe(3); // Intento inicial + 2 retries\r\n      expect(result.error?.message).toContain('ECONNRESET');\r\n      expect(mockOperation).toHaveBeenCalledTimes(3);\r\n    });\r\n\r\n    it('should calculate exponential backoff delays', async () => {\r\n      const delays: number[] = [];\r\n      const originalSetTimeout = global.setTimeout;\r\n\r\n      // Mock setTimeout para capturar delays\r\n      global.setTimeout = jest.fn((callback, delay) => {\r\n        delays.push(delay);\r\n        return originalSetTimeout(callback, 0); // Ejecutar inmediatamente\r\n      }) as any;\r\n\r\n      const fastConfig: RetryConfig = {\r\n        ...basicConfig,\r\n        baseDelayMs: 10,\r\n        maxDelayMs: 100,\r\n        jitterMs: 5\r\n      };\r\n\r\n      const mockOperation = jest.fn()\r\n        .mockRejectedValueOnce(new Error('500'))\r\n        .mockRejectedValueOnce(new Error('500'))\r\n        .mockResolvedValue('success');\r\n\r\n      await retryWithBackoff(mockOperation, fastConfig, 'test-operation');\r\n\r\n      // Verificar que los delays aumentan exponencialmente\r\n      expect(delays.length).toBe(2);\r\n      expect(delays[0]).toBeGreaterThanOrEqual(10); // baseDelay + jitter\r\n      expect(delays[1]).toBeGreaterThanOrEqual(20); // baseDelay * 2 + jitter\r\n\r\n      global.setTimeout = originalSetTimeout;\r\n    });\r\n\r\n    it('should respect max delay limit', async () => {\r\n      const configWithLowMaxDelay: RetryConfig = {\r\n        ...basicConfig,\r\n        baseDelayMs: 10,\r\n        maxDelayMs: 15, // Límite bajo\r\n        backoffMultiplier: 10, // Multiplicador alto\r\n        jitterMs: 5\r\n      };\r\n\r\n      const delays: number[] = [];\r\n      const originalSetTimeout = global.setTimeout;\r\n\r\n      global.setTimeout = jest.fn((callback, delay) => {\r\n        delays.push(delay);\r\n        return originalSetTimeout(callback, 0);\r\n      }) as any;\r\n\r\n      const mockOperation = jest.fn()\r\n        .mockRejectedValueOnce(new Error('500'))\r\n        .mockResolvedValue('success');\r\n\r\n      await retryWithBackoff(mockOperation, configWithLowMaxDelay, 'test-operation');\r\n\r\n      // El delay no debe exceder maxDelayMs + jitter\r\n      expect(delays[0]).toBeLessThanOrEqual(15 + 5);\r\n\r\n      global.setTimeout = originalSetTimeout;\r\n    });\r\n  });\r\n\r\n  describe('Retry Configurations', () => {\r\n    it('should have MercadoPago critical config', () => {\r\n      const config = RETRY_CONFIGS.MERCADOPAGO_CRITICAL;\r\n      \r\n      expect(config.maxRetries).toBe(3);\r\n      expect(config.baseDelayMs).toBe(1000);\r\n      expect(config.retryableErrors).toContain('500');\r\n      expect(config.retryableErrors).toContain('ECONNRESET');\r\n      expect(config.nonRetryableErrors).toContain('400');\r\n      expect(config.nonRetryableErrors).toContain('401');\r\n    });\r\n\r\n    it('should have MercadoPago query config', () => {\r\n      const config = RETRY_CONFIGS.MERCADOPAGO_QUERY;\r\n      \r\n      expect(config.maxRetries).toBe(2);\r\n      expect(config.baseDelayMs).toBe(500);\r\n      expect(config.retryableErrors).toContain('500');\r\n      expect(config.nonRetryableErrors).toContain('400');\r\n    });\r\n\r\n    it('should have webhook processing config', () => {\r\n      const config = RETRY_CONFIGS.WEBHOOK_PROCESSING;\r\n      \r\n      expect(config.maxRetries).toBe(1);\r\n      expect(config.baseDelayMs).toBe(2000);\r\n      expect(config.retryableErrors).toContain('500');\r\n      expect(config.nonRetryableErrors).toContain('DUPLICATE_WEBHOOK');\r\n    });\r\n  });\r\n\r\n  describe('retryMercadoPagoOperation', () => {\r\n    it('should use critical config for critical operations', async () => {\r\n      const mockOperation = jest.fn().mockResolvedValue('success');\r\n\r\n      const result = await retryMercadoPagoOperation(mockOperation, 'test', true);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toBe('success');\r\n      expect(mockOperation).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('should use query config for non-critical operations', async () => {\r\n      const mockOperation = jest.fn().mockResolvedValue('success');\r\n\r\n      const result = await retryMercadoPagoOperation(mockOperation, 'test', false);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toBe('success');\r\n      expect(mockOperation).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('should retry critical operations more times', async () => {\r\n      // Mock la configuración para hacer el test más rápido\r\n      const originalConfig = require('@/lib/retry-logic').RETRY_CONFIGS.MERCADOPAGO_CRITICAL;\r\n      require('@/lib/retry-logic').RETRY_CONFIGS.MERCADOPAGO_CRITICAL = {\r\n        ...originalConfig,\r\n        baseDelayMs: 1,\r\n        maxDelayMs: 5,\r\n        jitterMs: 0\r\n      };\r\n\r\n      const mockOperation = jest.fn().mockRejectedValue(new Error('500'));\r\n\r\n      const result = await retryMercadoPagoOperation(mockOperation, 'test', true);\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.attempts).toBe(4); // 1 inicial + 3 retries para críticas\r\n      expect(mockOperation).toHaveBeenCalledTimes(4);\r\n\r\n      // Restaurar configuración original\r\n      require('@/lib/retry-logic').RETRY_CONFIGS.MERCADOPAGO_CRITICAL = originalConfig;\r\n    });\r\n  });\r\n\r\n  describe('retryWebhookOperation', () => {\r\n    it('should use webhook config', async () => {\r\n      const mockOperation = jest.fn().mockResolvedValue('success');\r\n\r\n      const result = await retryWebhookOperation(mockOperation, 'test');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.data).toBe('success');\r\n      expect(mockOperation).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('should retry webhook operations limited times', async () => {\r\n      // Mock la configuración para hacer el test más rápido\r\n      const originalConfig = require('@/lib/retry-logic').RETRY_CONFIGS.WEBHOOK_PROCESSING;\r\n      require('@/lib/retry-logic').RETRY_CONFIGS.WEBHOOK_PROCESSING = {\r\n        ...originalConfig,\r\n        baseDelayMs: 1,\r\n        maxDelayMs: 5,\r\n        jitterMs: 0\r\n      };\r\n\r\n      const mockOperation = jest.fn().mockRejectedValue(new Error('500'));\r\n\r\n      const result = await retryWebhookOperation(mockOperation, 'test');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.attempts).toBe(2); // 1 inicial + 1 retry para webhooks\r\n      expect(mockOperation).toHaveBeenCalledTimes(2);\r\n\r\n      // Restaurar configuración original\r\n      require('@/lib/retry-logic').RETRY_CONFIGS.WEBHOOK_PROCESSING = originalConfig;\r\n    });\r\n  });\r\n\r\n  describe('Error Classification', () => {\r\n    const basicConfig: RetryConfig = {\r\n      maxRetries: 2,\r\n      baseDelayMs: 100,\r\n      maxDelayMs: 1000,\r\n      backoffMultiplier: 2,\r\n      jitterMs: 50,\r\n      retryableErrors: ['ECONNRESET', '500'],\r\n      nonRetryableErrors: ['400', '401']\r\n    };\r\n\r\n    it('should identify network errors as retryable', async () => {\r\n      const fastConfig: RetryConfig = {\r\n        ...basicConfig,\r\n        baseDelayMs: 1,\r\n        maxDelayMs: 5,\r\n        jitterMs: 0,\r\n        retryableErrors: ['ECONNRESET', 'ENOTFOUND', 'ETIMEDOUT'],\r\n        nonRetryableErrors: ['400', '401']\r\n      };\r\n\r\n      const networkErrors = ['ECONNRESET', 'ENOTFOUND', 'ETIMEDOUT'];\r\n\r\n      for (const errorCode of networkErrors) {\r\n        const mockOperation = jest.fn()\r\n          .mockRejectedValueOnce(new Error(errorCode))\r\n          .mockResolvedValue('success');\r\n\r\n        const result = await retryWithBackoff(mockOperation, fastConfig, 'test');\r\n\r\n        expect(result.success).toBe(true);\r\n        expect(result.attempts).toBe(2);\r\n\r\n        jest.clearAllMocks();\r\n      }\r\n    });\r\n\r\n    it('should identify HTTP 4xx errors as non-retryable', async () => {\r\n      const clientErrors = ['400', '401', '403', '404'];\r\n      \r\n      for (const errorCode of clientErrors) {\r\n        const mockOperation = jest.fn().mockRejectedValue(new Error(`${errorCode} Error`));\r\n\r\n        const result = await retryWithBackoff(mockOperation, RETRY_CONFIGS.MERCADOPAGO_CRITICAL, 'test');\r\n\r\n        expect(result.success).toBe(false);\r\n        expect(result.attempts).toBe(1); // No retry\r\n        \r\n        jest.clearAllMocks();\r\n      }\r\n    });\r\n\r\n    it('should identify HTTP 5xx errors as retryable', async () => {\r\n      const fastConfig: RetryConfig = {\r\n        maxRetries: 2,\r\n        baseDelayMs: 1,\r\n        maxDelayMs: 5,\r\n        backoffMultiplier: 2,\r\n        jitterMs: 0,\r\n        retryableErrors: ['500', '502', '503', '504'],\r\n        nonRetryableErrors: ['400', '401']\r\n      };\r\n\r\n      const serverErrors = ['500', '502', '503', '504'];\r\n\r\n      for (const errorCode of serverErrors) {\r\n        const mockOperation = jest.fn()\r\n          .mockRejectedValueOnce(new Error(`${errorCode} Error`))\r\n          .mockResolvedValue('success');\r\n\r\n        const result = await retryWithBackoff(mockOperation, fastConfig, 'test');\r\n\r\n        expect(result.success).toBe(true);\r\n        expect(result.attempts).toBe(2);\r\n\r\n        jest.clearAllMocks();\r\n      }\r\n    });\r\n  });\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["jest","mock","logger","info","fn","debug","warn","error","LogLevel","INFO","DEBUG","WARN","ERROR","LogCategory","SYSTEM","PAYMENT","describe","beforeEach","clearAllMocks","basicConfig","maxRetries","baseDelayMs","maxDelayMs","backoffMultiplier","jitterMs","retryableErrors","nonRetryableErrors","it","mockOperation","mockResolvedValue","promise","retryWithBackoff","result","expect","success","toBe","data","attempts","toHaveBeenCalledTimes","fastConfig","mockRejectedValueOnce","Error","mockRejectedValue","message","toContain","delays","originalSetTimeout","global","setTimeout","callback","delay","push","length","toBeGreaterThanOrEqual","configWithLowMaxDelay","toBeLessThanOrEqual","config","RETRY_CONFIGS","MERCADOPAGO_CRITICAL","MERCADOPAGO_QUERY","WEBHOOK_PROCESSING","retryMercadoPagoOperation","originalConfig","require","retryWebhookOperation","networkErrors","errorCode","clientErrors","serverErrors"],"mappings":"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"}