{"version":3,"names":["cov_2a4mqo9dj1","actualCoverage","s","GET","f","POST","ImageUploadSchema","_zod","z","object","file","any","alt_text","string","optional","is_primary","boolean","default","ImageUpdateSchema","display_order","number","int","min","ProductParamsSchema","id","uuid","ImageParamsSchema","imageId","getStorageClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceKey","SUPABASE_SERVICE_ROLE_KEY","_supabasejs","createClient","validateImageFile","allowedTypes","maxSize","includes","type","b","_errorhandler","ValidationError","size","generateImageFilename","originalName","productId","timestamp","Date","now","extension","split","pop","cleanName","replace","uploadImageToStorage","filename","supabase","data","error","storage","from","upload","cacheControl","upsert","ApiError","urlData","getPublicUrl","path","url","publicUrl","deleteImageFromStorage","remove","console","warn","postHandler","request","params","user","paramsValidation","safeParse","success","errors","product","productError","select","eq","single","NotFoundError","formData","get","altText","isPrimary","name","uploadResult","imageRecord","dbError","insert","product_id","storage_path","file_size","file_type","original_filename","created_at","toISOString","update","neq","_apilogger","logAdminAction","_server","NextResponse","json","message","status","getHandler","images","order","ascending","_middlewarecomposer","composeMiddlewares","withErrorHandler","withApiLogging","_apiauthmiddleware","withAdminAuth"],"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\admin\\products\\[id]\\images\\route.ts"],"sourcesContent":["// üñºÔ∏è Enterprise Product Images API\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { z } from 'zod';\r\nimport { composeMiddlewares } from '@/lib/api/middleware-composer';\r\nimport { withErrorHandler, ApiError, ValidationError, NotFoundError } from '@/lib/api/error-handler';\r\nimport { withApiLogging, logAdminAction } from '@/lib/api/api-logger';\r\nimport { withAdminAuth } from '@/lib/auth/api-auth-middleware';\r\nimport { withValidation } from '@/lib/validation/admin-schemas';\r\nimport { createClient } from '@supabase/supabase-js';\r\n\r\n// Validation schemas\r\nconst ImageUploadSchema = z.object({\r\n  file: z.any(), // File object\r\n  alt_text: z.string().optional(),\r\n  is_primary: z.boolean().default(false)\r\n});\r\n\r\nconst ImageUpdateSchema = z.object({\r\n  alt_text: z.string().optional(),\r\n  is_primary: z.boolean().optional(),\r\n  display_order: z.number().int().min(0).optional()\r\n});\r\n\r\nconst ProductParamsSchema = z.object({\r\n  id: z.string().uuid('ID de producto inv√°lido')\r\n});\r\n\r\nconst ImageParamsSchema = z.object({\r\n  id: z.string().uuid('ID de producto inv√°lido'),\r\n  imageId: z.string().uuid('ID de imagen inv√°lido')\r\n});\r\n\r\n// Helper function to get Supabase Storage client\r\nfunction getStorageClient() {\r\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\r\n  const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\r\n  \r\n  return createClient(supabaseUrl, supabaseServiceKey);\r\n}\r\n\r\n// Helper function to validate file\r\nfunction validateImageFile(file: File) {\r\n  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\r\n  const maxSize = 5 * 1024 * 1024; // 5MB\r\n\r\n  if (!allowedTypes.includes(file.type)) {\r\n    throw new ValidationError('Tipo de archivo no permitido. Use JPG, PNG o WebP');\r\n  }\r\n\r\n  if (file.size > maxSize) {\r\n    throw new ValidationError('El archivo es demasiado grande. M√°ximo 5MB');\r\n  }\r\n}\r\n\r\n// Helper function to generate unique filename\r\nfunction generateImageFilename(originalName: string, productId: string): string {\r\n  const timestamp = Date.now();\r\n  const extension = originalName.split('.').pop();\r\n  const cleanName = originalName.replace(/[^a-zA-Z0-9.-]/g, '_');\r\n  return `products/${productId}/${timestamp}_${cleanName}`;\r\n}\r\n\r\n// Helper function to upload image to Supabase Storage\r\nasync function uploadImageToStorage(file: File, filename: string) {\r\n  const supabase = getStorageClient();\r\n  \r\n  const { data, error } = await supabase.storage\r\n    .from('product-images')\r\n    .upload(filename, file, {\r\n      cacheControl: '3600',\r\n      upsert: false\r\n    });\r\n\r\n  if (error) {\r\n    throw new ApiError('Error al subir imagen', 500, 'STORAGE_ERROR', error);\r\n  }\r\n\r\n  // Get public URL\r\n  const { data: urlData } = supabase.storage\r\n    .from('product-images')\r\n    .getPublicUrl(filename);\r\n\r\n  return {\r\n    path: data.path,\r\n    url: urlData.publicUrl\r\n  };\r\n}\r\n\r\n// Helper function to delete image from storage\r\nasync function deleteImageFromStorage(path: string) {\r\n  const supabase = getStorageClient();\r\n  \r\n  const { error } = await supabase.storage\r\n    .from('product-images')\r\n    .remove([path]);\r\n\r\n  if (error) {\r\n    console.warn('Error deleting image from storage:', error);\r\n    // Don't throw error, just log warning\r\n  }\r\n}\r\n\r\n/**\r\n * POST /api/admin/products/[id]/images\r\n * Upload new image for product\r\n */\r\nconst postHandler = async (request: NextRequest, { params }: { params: { id: string } }) => {\r\n  const { supabase, user } = request as any;\r\n  const productId = params.id;\r\n\r\n  // Validate params\r\n  const paramsValidation = ProductParamsSchema.safeParse({ id: productId });\r\n  if (!paramsValidation.success) {\r\n    throw new ValidationError('ID de producto inv√°lido', paramsValidation.error.errors);\r\n  }\r\n\r\n  // Check if product exists\r\n  const { data: product, error: productError } = await supabase\r\n    .from('products')\r\n    .select('id, name')\r\n    .eq('id', productId)\r\n    .single();\r\n\r\n  if (productError || !product) {\r\n    throw new NotFoundError('Producto');\r\n  }\r\n\r\n  // Parse form data\r\n  const formData = await request.formData();\r\n  const file = formData.get('file') as File;\r\n  const altText = formData.get('alt_text') as string;\r\n  const isPrimary = formData.get('is_primary') === 'true';\r\n\r\n  if (!file) {\r\n    throw new ValidationError('No se proporcion√≥ archivo');\r\n  }\r\n\r\n  // Validate file\r\n  validateImageFile(file);\r\n\r\n  // Generate filename and upload\r\n  const filename = generateImageFilename(file.name, productId);\r\n  const uploadResult = await uploadImageToStorage(file, filename);\r\n\r\n  // Save image record to database\r\n  const { data: imageRecord, error: dbError } = await supabase\r\n    .from('product_images')\r\n    .insert({\r\n      product_id: productId,\r\n      url: uploadResult.url,\r\n      storage_path: uploadResult.path,\r\n      alt_text: altText || null,\r\n      is_primary: isPrimary,\r\n      file_size: file.size,\r\n      file_type: file.type,\r\n      original_filename: file.name,\r\n      created_at: new Date().toISOString()\r\n    })\r\n    .select()\r\n    .single();\r\n\r\n  if (dbError) {\r\n    // Clean up uploaded file if database insert fails\r\n    await deleteImageFromStorage(uploadResult.path);\r\n    throw new ApiError('Error al guardar imagen en base de datos', 500, 'DATABASE_ERROR', dbError);\r\n  }\r\n\r\n  // If this is set as primary, update other images\r\n  if (isPrimary) {\r\n    await supabase\r\n      .from('product_images')\r\n      .update({ is_primary: false })\r\n      .eq('product_id', productId)\r\n      .neq('id', imageRecord.id);\r\n  }\r\n\r\n  // Log action\r\n  await logAdminAction(user.id, 'CREATE', 'product_image', imageRecord.id, null, imageRecord);\r\n\r\n  return NextResponse.json({\r\n    data: imageRecord,\r\n    success: true,\r\n    message: 'Imagen subida exitosamente'\r\n  }, { status: 201 });\r\n};\r\n\r\n/**\r\n * GET /api/admin/products/[id]/images\r\n * Get all images for product\r\n */\r\nconst getHandler = async (request: NextRequest, { params }: { params: { id: string } }) => {\r\n  const { supabase } = request as any;\r\n  const productId = params.id;\r\n\r\n  // Validate params\r\n  const paramsValidation = ProductParamsSchema.safeParse({ id: productId });\r\n  if (!paramsValidation.success) {\r\n    throw new ValidationError('ID de producto inv√°lido', paramsValidation.error.errors);\r\n  }\r\n\r\n  // Get images\r\n  const { data: images, error } = await supabase\r\n    .from('product_images')\r\n    .select('*')\r\n    .eq('product_id', productId)\r\n    .order('display_order', { ascending: true })\r\n    .order('created_at', { ascending: true });\r\n\r\n  if (error) {\r\n    throw new ApiError('Error al obtener im√°genes', 500, 'DATABASE_ERROR', error);\r\n  }\r\n\r\n  return NextResponse.json({\r\n    data: images,\r\n    success: true,\r\n    message: 'Im√°genes obtenidas exitosamente'\r\n  });\r\n};\r\n\r\n// Apply enterprise middlewares and export handlers\r\nexport const GET = composeMiddlewares(\r\n  withErrorHandler,\r\n  withApiLogging,\r\n  withAdminAuth(['products_read'])\r\n)(getHandler);\r\n\r\nexport const POST = composeMiddlewares(\r\n  withErrorHandler,\r\n  withApiLogging,\r\n  withAdminAuth(['products_update'])\r\n)(postHandler);\r\n"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}