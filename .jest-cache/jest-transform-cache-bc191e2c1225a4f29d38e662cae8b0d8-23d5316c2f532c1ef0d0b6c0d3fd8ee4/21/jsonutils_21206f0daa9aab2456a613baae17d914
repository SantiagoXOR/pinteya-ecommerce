5d687eefc013809587ba9a6249dd1cda
/**
 * Utilidades para manejo seguro de JSON
 * Previene errores de parsing con datos corruptos o malformados
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get STORAGE_KEYS () {
        return STORAGE_KEYS;
    },
    get cleanCorruptedLocalStorage () {
        return cleanCorruptedLocalStorage;
    },
    get initializeJsonSafety () {
        return initializeJsonSafety;
    },
    get safeApiResponseJson () {
        return safeApiResponseJson;
    },
    get safeJsonParse () {
        return safeJsonParse;
    },
    get safeJsonStringify () {
        return safeJsonStringify;
    },
    get safeLocalStorageGet () {
        return safeLocalStorageGet;
    },
    get safeLocalStorageSet () {
        return safeLocalStorageSet;
    }
});
function safeJsonParse(jsonString) {
    // Validaciones b√°sicas
    if (!jsonString) {
        return {
            success: false,
            data: null,
            error: 'JSON string is null or undefined'
        };
    }
    // Limpiar string
    const trimmed = jsonString.trim();
    // Detectar casos problem√°ticos
    if (trimmed === '' || trimmed === '""' || trimmed === "''" || trimmed === 'null' || trimmed === 'undefined') {
        return {
            success: false,
            data: null,
            error: 'JSON string is empty or invalid'
        };
    }
    // Detectar comillas dobles corruptas
    if (trimmed.includes('""') && trimmed.length < 5) {
        return {
            success: false,
            data: null,
            error: 'Detected corrupted JSON with empty quotes'
        };
    }
    // Intentar parsear
    try {
        const parsed = JSON.parse(trimmed);
        return {
            success: true,
            data: parsed,
            error: undefined
        };
    } catch (error) {
        return {
            success: false,
            data: null,
            error: error instanceof Error ? error.message : 'Unknown JSON parse error'
        };
    }
}
function safeJsonStringify(data, space) {
    try {
        const result = JSON.stringify(data, null, space);
        return {
            success: true,
            data: result,
            error: undefined
        };
    } catch (error) {
        // Intentar con replacer para objetos circulares
        try {
            const seen = new WeakSet();
            const result = JSON.stringify(data, (key, value)=>{
                if (typeof value === 'object' && value !== null) {
                    if (seen.has(value)) {
                        return '[Circular Reference]';
                    }
                    seen.add(value);
                }
                return value;
            }, space);
            return {
                success: true,
                data: result,
                error: undefined
            };
        } catch (fallbackError) {
            return {
                success: false,
                data: null,
                error: fallbackError instanceof Error ? fallbackError.message : 'Unknown JSON stringify error'
            };
        }
    }
}
function safeLocalStorageGet(key) {
    if (typeof window === 'undefined') {
        return {
            success: false,
            data: null,
            error: 'localStorage not available (SSR)'
        };
    }
    try {
        const stored = localStorage.getItem(key);
        if (!stored) {
            return {
                success: false,
                data: null,
                error: 'No data found in localStorage'
            };
        }
        return safeJsonParse(stored);
    } catch (error) {
        return {
            success: false,
            data: null,
            error: error instanceof Error ? error.message : 'localStorage access error'
        };
    }
}
function safeLocalStorageSet(key, data) {
    if (typeof window === 'undefined') {
        return {
            success: false,
            data: false,
            error: 'localStorage not available (SSR)'
        };
    }
    try {
        const stringifyResult = safeJsonStringify(data);
        if (!stringifyResult.success) {
            return {
                success: false,
                data: false,
                error: `Failed to stringify data: ${stringifyResult.error}`
            };
        }
        localStorage.setItem(key, stringifyResult.data);
        return {
            success: true,
            data: true,
            error: undefined
        };
    } catch (error) {
        return {
            success: false,
            data: false,
            error: error instanceof Error ? error.message : 'localStorage write error'
        };
    }
}
function cleanCorruptedLocalStorage(keys) {
    if (typeof window === 'undefined') {
        return 0;
    }
    let cleanedCount = 0;
    keys.forEach((key)=>{
        try {
            const stored = localStorage.getItem(key);
            if (stored) {
                const parseResult = safeJsonParse(stored);
                if (!parseResult.success) {
                    console.warn(`Cleaning corrupted localStorage key: ${key}`, parseResult.error);
                    localStorage.removeItem(key);
                    cleanedCount++;
                }
            }
        } catch (error) {
            console.warn(`Error checking localStorage key ${key}:`, error);
            localStorage.removeItem(key);
            cleanedCount++;
        }
    });
    return cleanedCount;
}
async function safeApiResponseJson(response) {
    const DEBUG_MODE = process.env.NODE_ENV === 'development';
    try {
        if (DEBUG_MODE) {}
        // Verificar que la respuesta sea v√°lida
        if (!response.ok) {
            // Try to get error details from response body
            let errorDetails = '';
            try {
                const errorText = await response.text();
                if (DEBUG_MODE) {}
                errorDetails = errorText ? ` - ${errorText}` : '';
            } catch (textError) {
                if (DEBUG_MODE) {
                    console.warn('Could not read error response body:', textError);
                }
            }
            return {
                success: false,
                data: null,
                error: `HTTP ${response.status}: ${response.statusText}${errorDetails}`
            };
        }
        // Obtener el texto primero
        const text = await response.text();
        if (DEBUG_MODE) {
            console.log('üìÑ Response text preview:', text.substring(0, 200) + (text.length > 200 ? '...' : ''));
        }
        // Parsear de forma segura
        const parseResult = safeJsonParse(text);
        if (DEBUG_MODE) {}
        return parseResult;
    } catch (error) {
        console.error('‚ùå safeApiResponseJson error:', error);
        return {
            success: false,
            data: null,
            error: error instanceof Error ? error.message : 'API response error'
        };
    }
}
const STORAGE_KEYS = {
    CART: 'pinteya-cart',
    RECENT_SEARCHES: 'pinteya-recent-searches',
    USER_PREFERENCES: 'pinteya-user-preferences',
    ANALYTICS: 'pinteya-analytics'
};
function initializeJsonSafety() {
    if (typeof window === 'undefined') {
        return;
    }
    const keysToCheck = Object.values(STORAGE_KEYS);
    const cleanedCount = cleanCorruptedLocalStorage(keysToCheck);
    if (cleanedCount > 0) {}
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxqc29uLXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBVdGlsaWRhZGVzIHBhcmEgbWFuZWpvIHNlZ3VybyBkZSBKU09OXHJcbiAqIFByZXZpZW5lIGVycm9yZXMgZGUgcGFyc2luZyBjb24gZGF0b3MgY29ycnVwdG9zIG8gbWFsZm9ybWFkb3NcclxuICovXHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNhZmVKc29uUmVzdWx0PFQ+IHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGRhdGE6IFQgfCBudWxsO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG59XHJcblxyXG4vKipcclxuICogUGFyc2VhIEpTT04gZGUgZm9ybWEgc2VndXJhLCBtYW5lamFuZG8gY2Fzb3MgZWRnZSB5IGRhdG9zIGNvcnJ1cHRvc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHNhZmVKc29uUGFyc2U8VCA9IGFueT4oanNvblN0cmluZzogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCk6IFNhZmVKc29uUmVzdWx0PFQ+IHtcclxuICAvLyBWYWxpZGFjaW9uZXMgYsOhc2ljYXNcclxuICBpZiAoIWpzb25TdHJpbmcpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBkYXRhOiBudWxsLFxyXG4gICAgICBlcnJvcjogJ0pTT04gc3RyaW5nIGlzIG51bGwgb3IgdW5kZWZpbmVkJ1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIExpbXBpYXIgc3RyaW5nXHJcbiAgY29uc3QgdHJpbW1lZCA9IGpzb25TdHJpbmcudHJpbSgpO1xyXG4gIFxyXG4gIC8vIERldGVjdGFyIGNhc29zIHByb2JsZW3DoXRpY29zXHJcbiAgaWYgKHRyaW1tZWQgPT09ICcnIHx8IHRyaW1tZWQgPT09ICdcIlwiJyB8fCB0cmltbWVkID09PSBcIicnXCIgfHwgdHJpbW1lZCA9PT0gJ251bGwnIHx8IHRyaW1tZWQgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgZXJyb3I6ICdKU09OIHN0cmluZyBpcyBlbXB0eSBvciBpbnZhbGlkJ1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIERldGVjdGFyIGNvbWlsbGFzIGRvYmxlcyBjb3JydXB0YXNcclxuICBpZiAodHJpbW1lZC5pbmNsdWRlcygnXCJcIicpICYmIHRyaW1tZWQubGVuZ3RoIDwgNSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgIGVycm9yOiAnRGV0ZWN0ZWQgY29ycnVwdGVkIEpTT04gd2l0aCBlbXB0eSBxdW90ZXMnXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gSW50ZW50YXIgcGFyc2VhclxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHRyaW1tZWQpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YTogcGFyc2VkLFxyXG4gICAgICBlcnJvcjogdW5kZWZpbmVkXHJcbiAgICB9O1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gSlNPTiBwYXJzZSBlcnJvcidcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogU3RyaW5naWZ5IEpTT04gZGUgZm9ybWEgc2VndXJhLCBtYW5lamFuZG8gb2JqZXRvcyBjaXJjdWxhcmVzXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gc2FmZUpzb25TdHJpbmdpZnkoZGF0YTogYW55LCBzcGFjZT86IG51bWJlcik6IFNhZmVKc29uUmVzdWx0PHN0cmluZz4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCBzcGFjZSk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiByZXN1bHQsXHJcbiAgICAgIGVycm9yOiB1bmRlZmluZWRcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIC8vIEludGVudGFyIGNvbiByZXBsYWNlciBwYXJhIG9iamV0b3MgY2lyY3VsYXJlc1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc2VlbiA9IG5ldyBXZWFrU2V0KCk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IEpTT04uc3RyaW5naWZ5KGRhdGEsIChrZXksIHZhbHVlKSA9PiB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwpIHtcclxuICAgICAgICAgIGlmIChzZWVuLmhhcyh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdbQ2lyY3VsYXIgUmVmZXJlbmNlXSc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzZWVuLmFkZCh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgfSwgc3BhY2UpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcclxuICAgICAgICBlcnJvcjogdW5kZWZpbmVkXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChmYWxsYmFja0Vycm9yKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICBlcnJvcjogZmFsbGJhY2tFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZmFsbGJhY2tFcnJvci5tZXNzYWdlIDogJ1Vua25vd24gSlNPTiBzdHJpbmdpZnkgZXJyb3InXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ2FyZ2EgZGF0b3MgZGUgbG9jYWxTdG9yYWdlIGRlIGZvcm1hIHNlZ3VyYVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHNhZmVMb2NhbFN0b3JhZ2VHZXQ8VCA9IGFueT4oa2V5OiBzdHJpbmcpOiBTYWZlSnNvblJlc3VsdDxUPiB7XHJcbiAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgZXJyb3I6ICdsb2NhbFN0b3JhZ2Ugbm90IGF2YWlsYWJsZSAoU1NSKSdcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3RvcmVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgIGlmICghc3RvcmVkKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZGF0YTogbnVsbCxcclxuICAgICAgICBlcnJvcjogJ05vIGRhdGEgZm91bmQgaW4gbG9jYWxTdG9yYWdlJ1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzYWZlSnNvblBhcnNlPFQ+KHN0b3JlZCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBkYXRhOiBudWxsLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnbG9jYWxTdG9yYWdlIGFjY2VzcyBlcnJvcidcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogR3VhcmRhIGRhdG9zIGVuIGxvY2FsU3RvcmFnZSBkZSBmb3JtYSBzZWd1cmFcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzYWZlTG9jYWxTdG9yYWdlU2V0KGtleTogc3RyaW5nLCBkYXRhOiBhbnkpOiBTYWZlSnNvblJlc3VsdDxib29sZWFuPiB7XHJcbiAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZGF0YTogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnbG9jYWxTdG9yYWdlIG5vdCBhdmFpbGFibGUgKFNTUiknXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHN0cmluZ2lmeVJlc3VsdCA9IHNhZmVKc29uU3RyaW5naWZ5KGRhdGEpO1xyXG4gICAgaWYgKCFzdHJpbmdpZnlSZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGRhdGE6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBgRmFpbGVkIHRvIHN0cmluZ2lmeSBkYXRhOiAke3N0cmluZ2lmeVJlc3VsdC5lcnJvcn1gXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBzdHJpbmdpZnlSZXN1bHQuZGF0YSEpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YTogdHJ1ZSxcclxuICAgICAgZXJyb3I6IHVuZGVmaW5lZFxyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGRhdGE6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnbG9jYWxTdG9yYWdlIHdyaXRlIGVycm9yJ1xyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBMaW1waWEgbG9jYWxTdG9yYWdlIGRlIGRhdG9zIGNvcnJ1cHRvc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuQ29ycnVwdGVkTG9jYWxTdG9yYWdlKGtleXM6IHN0cmluZ1tdKTogbnVtYmVyIHtcclxuICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxuXHJcbiAgbGV0IGNsZWFuZWRDb3VudCA9IDA7XHJcblxyXG4gIGtleXMuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc3RvcmVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgaWYgKHN0b3JlZCkge1xyXG4gICAgICAgIGNvbnN0IHBhcnNlUmVzdWx0ID0gc2FmZUpzb25QYXJzZShzdG9yZWQpO1xyXG4gICAgICAgIGlmICghcGFyc2VSZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgY29uc29sZS53YXJuKGBDbGVhbmluZyBjb3JydXB0ZWQgbG9jYWxTdG9yYWdlIGtleTogJHtrZXl9YCwgcGFyc2VSZXN1bHQuZXJyb3IpO1xyXG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICAgIGNsZWFuZWRDb3VudCsrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBFcnJvciBjaGVja2luZyBsb2NhbFN0b3JhZ2Uga2V5ICR7a2V5fTpgLCBlcnJvcik7XHJcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgIGNsZWFuZWRDb3VudCsrO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gY2xlYW5lZENvdW50O1xyXG59XHJcblxyXG4vKipcclxuICogVmFsaWRhIHF1ZSB1bmEgcmVzcHVlc3RhIGRlIEFQSSB0ZW5nYSBKU09OIHbDoWxpZG9cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYWZlQXBpUmVzcG9uc2VKc29uPFQgPSBhbnk+KHJlc3BvbnNlOiBSZXNwb25zZSk6IFByb21pc2U8U2FmZUpzb25SZXN1bHQ8VD4+IHtcclxuICBjb25zdCBERUJVR19NT0RFID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCc7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBpZiAoREVCVUdfTU9ERSkge1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZlcmlmaWNhciBxdWUgbGEgcmVzcHVlc3RhIHNlYSB2w6FsaWRhXHJcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICAgIC8vIFRyeSB0byBnZXQgZXJyb3IgZGV0YWlscyBmcm9tIHJlc3BvbnNlIGJvZHlcclxuICAgICAgbGV0IGVycm9yRGV0YWlscyA9ICcnO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcclxuICAgICAgICBpZiAoREVCVUdfTU9ERSkge1xyXG4gICAgICAgIH1cclxuICAgICAgICBlcnJvckRldGFpbHMgPSBlcnJvclRleHQgPyBgIC0gJHtlcnJvclRleHR9YCA6ICcnO1xyXG4gICAgICB9IGNhdGNoICh0ZXh0RXJyb3IpIHtcclxuICAgICAgICBpZiAoREVCVUdfTU9ERSkge1xyXG4gICAgICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgcmVhZCBlcnJvciByZXNwb25zZSBib2R5OicsIHRleHRFcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGRhdGE6IG51bGwsXHJcbiAgICAgICAgZXJyb3I6IGBIVFRQICR7cmVzcG9uc2Uuc3RhdHVzfTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fSR7ZXJyb3JEZXRhaWxzfWBcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBPYnRlbmVyIGVsIHRleHRvIHByaW1lcm9cclxuICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XHJcbiAgICBpZiAoREVCVUdfTU9ERSkge1xyXG4gICAgICBjb25zb2xlLmxvZygn8J+ThCBSZXNwb25zZSB0ZXh0IHByZXZpZXc6JywgdGV4dC5zdWJzdHJpbmcoMCwgMjAwKSArICh0ZXh0Lmxlbmd0aCA+IDIwMCA/ICcuLi4nIDogJycpKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQYXJzZWFyIGRlIGZvcm1hIHNlZ3VyYVxyXG4gICAgY29uc3QgcGFyc2VSZXN1bHQgPSBzYWZlSnNvblBhcnNlPFQ+KHRleHQpO1xyXG4gICAgaWYgKERFQlVHX01PREUpIHtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcGFyc2VSZXN1bHQ7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBzYWZlQXBpUmVzcG9uc2VKc29uIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBkYXRhOiBudWxsLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnQVBJIHJlc3BvbnNlIGVycm9yJ1xyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb25zdGFudGVzIHBhcmEga2V5cyBkZSBsb2NhbFN0b3JhZ2UgY29tdW5lc1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IFNUT1JBR0VfS0VZUyA9IHtcclxuICBDQVJUOiAncGludGV5YS1jYXJ0JyxcclxuICBSRUNFTlRfU0VBUkNIRVM6ICdwaW50ZXlhLXJlY2VudC1zZWFyY2hlcycsXHJcbiAgVVNFUl9QUkVGRVJFTkNFUzogJ3BpbnRleWEtdXNlci1wcmVmZXJlbmNlcycsXHJcbiAgQU5BTFlUSUNTOiAncGludGV5YS1hbmFseXRpY3MnLFxyXG59IGFzIGNvbnN0O1xyXG5cclxuLyoqXHJcbiAqIEZ1bmNpw7NuIGRlIGluaWNpYWxpemFjacOzbiBwYXJhIGxpbXBpYXIgbG9jYWxTdG9yYWdlIGNvcnJ1cHRvIGFsIGNhcmdhciBsYSBhcHBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplSnNvblNhZmV0eSgpOiB2b2lkIHtcclxuICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtyZXR1cm47fVxyXG5cclxuICBjb25zdCBrZXlzVG9DaGVjayA9IE9iamVjdC52YWx1ZXMoU1RPUkFHRV9LRVlTKTtcclxuICBjb25zdCBjbGVhbmVkQ291bnQgPSBjbGVhbkNvcnJ1cHRlZExvY2FsU3RvcmFnZShrZXlzVG9DaGVjayk7XHJcbiAgXHJcbiAgaWYgKGNsZWFuZWRDb3VudCA+IDApIHtcclxuICB9XHJcbn1cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbIlNUT1JBR0VfS0VZUyIsImNsZWFuQ29ycnVwdGVkTG9jYWxTdG9yYWdlIiwiaW5pdGlhbGl6ZUpzb25TYWZldHkiLCJzYWZlQXBpUmVzcG9uc2VKc29uIiwic2FmZUpzb25QYXJzZSIsInNhZmVKc29uU3RyaW5naWZ5Iiwic2FmZUxvY2FsU3RvcmFnZUdldCIsInNhZmVMb2NhbFN0b3JhZ2VTZXQiLCJqc29uU3RyaW5nIiwic3VjY2VzcyIsImRhdGEiLCJlcnJvciIsInRyaW1tZWQiLCJ0cmltIiwiaW5jbHVkZXMiLCJsZW5ndGgiLCJwYXJzZWQiLCJKU09OIiwicGFyc2UiLCJ1bmRlZmluZWQiLCJFcnJvciIsIm1lc3NhZ2UiLCJzcGFjZSIsInJlc3VsdCIsInN0cmluZ2lmeSIsInNlZW4iLCJXZWFrU2V0Iiwia2V5IiwidmFsdWUiLCJoYXMiLCJhZGQiLCJmYWxsYmFja0Vycm9yIiwid2luZG93Iiwic3RvcmVkIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInN0cmluZ2lmeVJlc3VsdCIsInNldEl0ZW0iLCJrZXlzIiwiY2xlYW5lZENvdW50IiwiZm9yRWFjaCIsInBhcnNlUmVzdWx0IiwiY29uc29sZSIsIndhcm4iLCJyZW1vdmVJdGVtIiwicmVzcG9uc2UiLCJERUJVR19NT0RFIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwib2siLCJlcnJvckRldGFpbHMiLCJlcnJvclRleHQiLCJ0ZXh0IiwidGV4dEVycm9yIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsImxvZyIsInN1YnN0cmluZyIsIkNBUlQiLCJSRUNFTlRfU0VBUkNIRVMiLCJVU0VSX1BSRUZFUkVOQ0VTIiwiQU5BTFlUSUNTIiwia2V5c1RvQ2hlY2siLCJPYmplY3QiLCJ2YWx1ZXMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Q0FHQzs7Ozs7Ozs7Ozs7UUFnUVlBO2VBQUFBOztRQXJGR0M7ZUFBQUE7O1FBK0ZBQztlQUFBQTs7UUFoRU1DO2VBQUFBOztRQS9MTkM7ZUFBQUE7O1FBbURBQztlQUFBQTs7UUF3Q0FDO2VBQUFBOztRQWdDQUM7ZUFBQUE7OztBQTNIVCxTQUFTSCxjQUF1QkksVUFBcUM7SUFDMUUsdUJBQXVCO0lBQ3ZCLElBQUksQ0FBQ0EsWUFBWTtRQUNmLE9BQU87WUFDTEMsU0FBUztZQUNUQyxNQUFNO1lBQ05DLE9BQU87UUFDVDtJQUNGO0lBRUEsaUJBQWlCO0lBQ2pCLE1BQU1DLFVBQVVKLFdBQVdLLElBQUk7SUFFL0IsK0JBQStCO0lBQy9CLElBQUlELFlBQVksTUFBTUEsWUFBWSxRQUFRQSxZQUFZLFFBQVFBLFlBQVksVUFBVUEsWUFBWSxhQUFhO1FBQzNHLE9BQU87WUFDTEgsU0FBUztZQUNUQyxNQUFNO1lBQ05DLE9BQU87UUFDVDtJQUNGO0lBRUEscUNBQXFDO0lBQ3JDLElBQUlDLFFBQVFFLFFBQVEsQ0FBQyxTQUFTRixRQUFRRyxNQUFNLEdBQUcsR0FBRztRQUNoRCxPQUFPO1lBQ0xOLFNBQVM7WUFDVEMsTUFBTTtZQUNOQyxPQUFPO1FBQ1Q7SUFDRjtJQUVBLG1CQUFtQjtJQUNuQixJQUFJO1FBQ0YsTUFBTUssU0FBU0MsS0FBS0MsS0FBSyxDQUFDTjtRQUMxQixPQUFPO1lBQ0xILFNBQVM7WUFDVEMsTUFBTU07WUFDTkwsT0FBT1E7UUFDVDtJQUNGLEVBQUUsT0FBT1IsT0FBTztRQUNkLE9BQU87WUFDTEYsU0FBUztZQUNUQyxNQUFNO1lBQ05DLE9BQU9BLGlCQUFpQlMsUUFBUVQsTUFBTVUsT0FBTyxHQUFHO1FBQ2xEO0lBQ0Y7QUFDRjtBQUtPLFNBQVNoQixrQkFBa0JLLElBQVMsRUFBRVksS0FBYztJQUN6RCxJQUFJO1FBQ0YsTUFBTUMsU0FBU04sS0FBS08sU0FBUyxDQUFDZCxNQUFNLE1BQU1ZO1FBQzFDLE9BQU87WUFDTGIsU0FBUztZQUNUQyxNQUFNYTtZQUNOWixPQUFPUTtRQUNUO0lBQ0YsRUFBRSxPQUFPUixPQUFPO1FBQ2QsZ0RBQWdEO1FBQ2hELElBQUk7WUFDRixNQUFNYyxPQUFPLElBQUlDO1lBQ2pCLE1BQU1ILFNBQVNOLEtBQUtPLFNBQVMsQ0FBQ2QsTUFBTSxDQUFDaUIsS0FBS0M7Z0JBQ3hDLElBQUksT0FBT0EsVUFBVSxZQUFZQSxVQUFVLE1BQU07b0JBQy9DLElBQUlILEtBQUtJLEdBQUcsQ0FBQ0QsUUFBUTt3QkFDbkIsT0FBTztvQkFDVDtvQkFDQUgsS0FBS0ssR0FBRyxDQUFDRjtnQkFDWDtnQkFDQSxPQUFPQTtZQUNULEdBQUdOO1lBRUgsT0FBTztnQkFDTGIsU0FBUztnQkFDVEMsTUFBTWE7Z0JBQ05aLE9BQU9RO1lBQ1Q7UUFDRixFQUFFLE9BQU9ZLGVBQWU7WUFDdEIsT0FBTztnQkFDTHRCLFNBQVM7Z0JBQ1RDLE1BQU07Z0JBQ05DLE9BQU9vQix5QkFBeUJYLFFBQVFXLGNBQWNWLE9BQU8sR0FBRztZQUNsRTtRQUNGO0lBQ0Y7QUFDRjtBQUtPLFNBQVNmLG9CQUE2QnFCLEdBQVc7SUFDdEQsSUFBSSxPQUFPSyxXQUFXLGFBQWE7UUFDakMsT0FBTztZQUNMdkIsU0FBUztZQUNUQyxNQUFNO1lBQ05DLE9BQU87UUFDVDtJQUNGO0lBRUEsSUFBSTtRQUNGLE1BQU1zQixTQUFTQyxhQUFhQyxPQUFPLENBQUNSO1FBQ3BDLElBQUksQ0FBQ00sUUFBUTtZQUNYLE9BQU87Z0JBQ0x4QixTQUFTO2dCQUNUQyxNQUFNO2dCQUNOQyxPQUFPO1lBQ1Q7UUFDRjtRQUVBLE9BQU9QLGNBQWlCNkI7SUFDMUIsRUFBRSxPQUFPdEIsT0FBTztRQUNkLE9BQU87WUFDTEYsU0FBUztZQUNUQyxNQUFNO1lBQ05DLE9BQU9BLGlCQUFpQlMsUUFBUVQsTUFBTVUsT0FBTyxHQUFHO1FBQ2xEO0lBQ0Y7QUFDRjtBQUtPLFNBQVNkLG9CQUFvQm9CLEdBQVcsRUFBRWpCLElBQVM7SUFDeEQsSUFBSSxPQUFPc0IsV0FBVyxhQUFhO1FBQ2pDLE9BQU87WUFDTHZCLFNBQVM7WUFDVEMsTUFBTTtZQUNOQyxPQUFPO1FBQ1Q7SUFDRjtJQUVBLElBQUk7UUFDRixNQUFNeUIsa0JBQWtCL0Isa0JBQWtCSztRQUMxQyxJQUFJLENBQUMwQixnQkFBZ0IzQixPQUFPLEVBQUU7WUFDNUIsT0FBTztnQkFDTEEsU0FBUztnQkFDVEMsTUFBTTtnQkFDTkMsT0FBTyxDQUFDLDBCQUEwQixFQUFFeUIsZ0JBQWdCekIsS0FBSyxFQUFFO1lBQzdEO1FBQ0Y7UUFFQXVCLGFBQWFHLE9BQU8sQ0FBQ1YsS0FBS1MsZ0JBQWdCMUIsSUFBSTtRQUM5QyxPQUFPO1lBQ0xELFNBQVM7WUFDVEMsTUFBTTtZQUNOQyxPQUFPUTtRQUNUO0lBQ0YsRUFBRSxPQUFPUixPQUFPO1FBQ2QsT0FBTztZQUNMRixTQUFTO1lBQ1RDLE1BQU07WUFDTkMsT0FBT0EsaUJBQWlCUyxRQUFRVCxNQUFNVSxPQUFPLEdBQUc7UUFDbEQ7SUFDRjtBQUNGO0FBS08sU0FBU3BCLDJCQUEyQnFDLElBQWM7SUFDdkQsSUFBSSxPQUFPTixXQUFXLGFBQWE7UUFDakMsT0FBTztJQUNUO0lBRUEsSUFBSU8sZUFBZTtJQUVuQkQsS0FBS0UsT0FBTyxDQUFDYixDQUFBQTtRQUNYLElBQUk7WUFDRixNQUFNTSxTQUFTQyxhQUFhQyxPQUFPLENBQUNSO1lBQ3BDLElBQUlNLFFBQVE7Z0JBQ1YsTUFBTVEsY0FBY3JDLGNBQWM2QjtnQkFDbEMsSUFBSSxDQUFDUSxZQUFZaEMsT0FBTyxFQUFFO29CQUN4QmlDLFFBQVFDLElBQUksQ0FBQyxDQUFDLHFDQUFxQyxFQUFFaEIsS0FBSyxFQUFFYyxZQUFZOUIsS0FBSztvQkFDN0V1QixhQUFhVSxVQUFVLENBQUNqQjtvQkFDeEJZO2dCQUNGO1lBQ0Y7UUFDRixFQUFFLE9BQU81QixPQUFPO1lBQ2QrQixRQUFRQyxJQUFJLENBQUMsQ0FBQyxnQ0FBZ0MsRUFBRWhCLElBQUksQ0FBQyxDQUFDLEVBQUVoQjtZQUN4RHVCLGFBQWFVLFVBQVUsQ0FBQ2pCO1lBQ3hCWTtRQUNGO0lBQ0Y7SUFFQSxPQUFPQTtBQUNUO0FBS08sZUFBZXBDLG9CQUE2QjBDLFFBQWtCO0lBQ25FLE1BQU1DLGFBQWFDLFFBQVFDLEdBQUcsQ0FBQ0MsUUFBUSxLQUFLO0lBRTVDLElBQUk7UUFDRixJQUFJSCxZQUFZLENBQ2hCO1FBRUEsd0NBQXdDO1FBQ3hDLElBQUksQ0FBQ0QsU0FBU0ssRUFBRSxFQUFFO1lBQ2hCLDhDQUE4QztZQUM5QyxJQUFJQyxlQUFlO1lBQ25CLElBQUk7Z0JBQ0YsTUFBTUMsWUFBWSxNQUFNUCxTQUFTUSxJQUFJO2dCQUNyQyxJQUFJUCxZQUFZLENBQ2hCO2dCQUNBSyxlQUFlQyxZQUFZLENBQUMsR0FBRyxFQUFFQSxXQUFXLEdBQUc7WUFDakQsRUFBRSxPQUFPRSxXQUFXO2dCQUNsQixJQUFJUixZQUFZO29CQUNkSixRQUFRQyxJQUFJLENBQUMsdUNBQXVDVztnQkFDdEQ7WUFDRjtZQUVBLE9BQU87Z0JBQ0w3QyxTQUFTO2dCQUNUQyxNQUFNO2dCQUNOQyxPQUFPLENBQUMsS0FBSyxFQUFFa0MsU0FBU1UsTUFBTSxDQUFDLEVBQUUsRUFBRVYsU0FBU1csVUFBVSxHQUFHTCxjQUFjO1lBQ3pFO1FBQ0Y7UUFFQSwyQkFBMkI7UUFDM0IsTUFBTUUsT0FBTyxNQUFNUixTQUFTUSxJQUFJO1FBQ2hDLElBQUlQLFlBQVk7WUFDZEosUUFBUWUsR0FBRyxDQUFDLDZCQUE2QkosS0FBS0ssU0FBUyxDQUFDLEdBQUcsT0FBUUwsQ0FBQUEsS0FBS3RDLE1BQU0sR0FBRyxNQUFNLFFBQVEsRUFBQztRQUNsRztRQUVBLDBCQUEwQjtRQUMxQixNQUFNMEIsY0FBY3JDLGNBQWlCaUQ7UUFDckMsSUFBSVAsWUFBWSxDQUNoQjtRQUVBLE9BQU9MO0lBQ1QsRUFBRSxPQUFPOUIsT0FBTztRQUNkK0IsUUFBUS9CLEtBQUssQ0FBQyxnQ0FBZ0NBO1FBQzlDLE9BQU87WUFDTEYsU0FBUztZQUNUQyxNQUFNO1lBQ05DLE9BQU9BLGlCQUFpQlMsUUFBUVQsTUFBTVUsT0FBTyxHQUFHO1FBQ2xEO0lBQ0Y7QUFDRjtBQUtPLE1BQU1yQixlQUFlO0lBQzFCMkQsTUFBTTtJQUNOQyxpQkFBaUI7SUFDakJDLGtCQUFrQjtJQUNsQkMsV0FBVztBQUNiO0FBS08sU0FBUzVEO0lBQ2QsSUFBSSxPQUFPOEIsV0FBVyxhQUFhO1FBQUM7SUFBTztJQUUzQyxNQUFNK0IsY0FBY0MsT0FBT0MsTUFBTSxDQUFDakU7SUFDbEMsTUFBTXVDLGVBQWV0QywyQkFBMkI4RDtJQUVoRCxJQUFJeEIsZUFBZSxHQUFHLENBQ3RCO0FBQ0YifQ==