{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\hooks\\useProductList.test.ts"],"sourcesContent":["/**\n * @jest-environment jsdom\n */\n\nimport { renderHook, waitFor } from '@testing-library/react'\nimport { useProductList } from '@/hooks/admin/useProductList'\n\n// Mock fetch globally\nglobal.fetch = jest.fn()\n\ndescribe('useProductList Hook', () => {\n  beforeEach(() => {\n    jest.clearAllMocks()\n    console.log = jest.fn()\n    console.error = jest.fn()\n  })\n\n  afterEach(() => {\n    jest.restoreAllMocks()\n  })\n\n  it('should initialize with correct default state', () => {\n    // Mock successful API response\n    ;(global.fetch as jest.Mock).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({\n        success: true,\n        data: {\n          products: [],\n          total: 0,\n          pagination: {\n            page: 1,\n            limit: 25,\n            offset: 0,\n            totalPages: 0,\n            hasMore: false,\n            hasPrevious: false,\n          },\n        },\n        meta: {\n          timestamp: '2025-08-23T00:00:00Z',\n          method: 'GET',\n          user: 'test-user',\n          role: 'admin',\n        },\n      }),\n    })\n\n    const { result } = renderHook(() => useProductList())\n\n    // Initial state should have loading true\n    expect(result.current.isLoading).toBe(true)\n    expect(result.current.products).toEqual([])\n    expect(result.current.error).toBe(null)\n  })\n\n  it('should fetch products successfully', async () => {\n    const mockProducts = [\n      {\n        id: 1,\n        name: 'Test Product 1',\n        description: 'Test Description 1',\n        price: 1000,\n        stock: 50,\n        category_id: 1,\n        images: {\n          main: '/test1.jpg',\n          gallery: [],\n          previews: [],\n          thumbnails: [],\n        },\n        created_at: '2025-01-01T00:00:00Z',\n        updated_at: '2025-01-01T00:00:00Z',\n        category_name: 'Test Category',\n      },\n      {\n        id: 2,\n        name: 'Test Product 2',\n        description: 'Test Description 2',\n        price: 2000,\n        stock: 30,\n        category_id: 2,\n        images: {\n          main: '/test2.jpg',\n          gallery: [],\n          previews: [],\n          thumbnails: [],\n        },\n        created_at: '2025-01-01T00:00:00Z',\n        updated_at: '2025-01-01T00:00:00Z',\n        category_name: 'Test Category 2',\n      },\n    ]\n\n    ;(global.fetch as jest.Mock).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({\n        success: true,\n        data: {\n          products: mockProducts,\n          total: 2,\n          pagination: {\n            page: 1,\n            limit: 25,\n            offset: 0,\n            totalPages: 1,\n            hasMore: false,\n            hasPrevious: false,\n          },\n        },\n        meta: {\n          timestamp: '2025-08-23T00:00:00Z',\n          method: 'GET',\n          user: 'test-user',\n          role: 'admin',\n        },\n      }),\n    })\n\n    const { result } = renderHook(() => useProductList())\n\n    await waitFor(() => {\n      expect(result.current.isLoading).toBe(false)\n    })\n\n    expect(result.current.products).toEqual(mockProducts)\n    expect(result.current.error).toBe(null)\n    expect(global.fetch).toHaveBeenCalledWith('/api/admin/products-direct?limit=25')\n  })\n\n  it('should handle network errors', async () => {\n    ;(global.fetch as jest.Mock).mockRejectedValueOnce(new Error('Network error'))\n\n    const { result } = renderHook(() => useProductList())\n\n    await waitFor(() => {\n      expect(result.current.isLoading).toBe(false)\n    })\n\n    expect(result.current.products).toEqual([])\n    expect(result.current.error).toBe('Network error')\n  })\n\n  it('should handle API errors', async () => {\n    ;(global.fetch as jest.Mock).mockResolvedValueOnce({\n      ok: false,\n      status: 500,\n      statusText: 'Internal Server Error',\n    })\n\n    const { result } = renderHook(() => useProductList())\n\n    await waitFor(() => {\n      expect(result.current.isLoading).toBe(false)\n    })\n\n    expect(result.current.products).toEqual([])\n    expect(result.current.error).toBe('Error 500: Internal Server Error')\n  })\n\n  it('should handle invalid response structure', async () => {\n    ;(global.fetch as jest.Mock).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({\n        success: false,\n        error: 'Invalid request',\n      }),\n    })\n\n    const { result } = renderHook(() => useProductList())\n\n    await waitFor(() => {\n      expect(result.current.isLoading).toBe(false)\n    })\n\n    expect(result.current.products).toEqual([])\n    expect(result.current.error).toBe('Estructura de respuesta inválida')\n  })\n\n  it('should handle missing products array in response', async () => {\n    ;(global.fetch as jest.Mock).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({\n        success: true,\n        data: {\n          total: 0,\n          pagination: {\n            page: 1,\n            limit: 25,\n            offset: 0,\n            totalPages: 0,\n            hasMore: false,\n            hasPrevious: false,\n          },\n        },\n      }),\n    })\n\n    const { result } = renderHook(() => useProductList())\n\n    await waitFor(() => {\n      expect(result.current.isLoading).toBe(false)\n    })\n\n    expect(result.current.products).toEqual([])\n    expect(result.current.error).toBe('Estructura de respuesta inválida')\n  })\n\n  it('should call fetch with correct URL and parameters', async () => {\n    ;(global.fetch as jest.Mock).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({\n        success: true,\n        data: {\n          products: [],\n          total: 0,\n          pagination: {\n            page: 1,\n            limit: 25,\n            offset: 0,\n            totalPages: 0,\n            hasMore: false,\n            hasPrevious: false,\n          },\n        },\n      }),\n    })\n\n    renderHook(() => useProductList())\n\n    await waitFor(() => {\n      expect(global.fetch).toHaveBeenCalledTimes(1)\n    })\n\n    expect(global.fetch).toHaveBeenCalledWith('/api/admin/products-direct?limit=25')\n  })\n\n  it('should export correct TypeScript types', () => {\n    // This test ensures the types are properly exported\n    const { result } = renderHook(() => useProductList())\n\n    // TypeScript compilation will fail if types are incorrect\n    expect(typeof result.current.products).toBe('object')\n    expect(typeof result.current.isLoading).toBe('boolean')\n    expect(result.current.error === null || typeof result.current.error === 'string').toBe(true)\n  })\n})\n"],"names":["global","fetch","jest","fn","describe","beforeEach","clearAllMocks","console","log","error","afterEach","restoreAllMocks","it","mockResolvedValueOnce","ok","json","success","data","products","total","pagination","page","limit","offset","totalPages","hasMore","hasPrevious","meta","timestamp","method","user","role","result","renderHook","useProductList","expect","current","isLoading","toBe","toEqual","mockProducts","id","name","description","price","stock","category_id","images","main","gallery","previews","thumbnails","created_at","updated_at","category_name","waitFor","toHaveBeenCalledWith","mockRejectedValueOnce","Error","status","statusText","toHaveBeenCalledTimes"],"mappings":"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"}