{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\lib\\websockets\\logistics-websocket.ts"],"sourcesContent":["// =====================================================\r\n// WEBSOCKET: LOGISTICS REAL-TIME SYSTEM\r\n// DescripciÃ³n: Sistema WebSocket para tracking tiempo real\r\n// Basado en: WebSocket API + React Context + Event Emitter\r\n// =====================================================\r\n\r\nimport { EventEmitter } from 'events';\r\n\r\n// =====================================================\r\n// INTERFACES\r\n// =====================================================\r\n\r\nexport interface WebSocketMessage {\r\n  type: 'tracking_update' | 'shipment_status' | 'alert' | 'geofence_event' | 'route_update';\r\n  data: any;\r\n  timestamp: string;\r\n  shipment_id?: number;\r\n  user_id?: string;\r\n}\r\n\r\nexport interface TrackingUpdate {\r\n  shipment_id: number;\r\n  location: {\r\n    latitude: number;\r\n    longitude: number;\r\n    address?: string;\r\n  };\r\n  status: string;\r\n  timestamp: string;\r\n  courier_id?: number;\r\n  estimated_arrival?: string;\r\n}\r\n\r\nexport interface GeofenceEvent {\r\n  shipment_id: number;\r\n  zone_id: string;\r\n  zone_name: string;\r\n  event_type: 'enter' | 'exit';\r\n  location: {\r\n    latitude: number;\r\n    longitude: number;\r\n  };\r\n  timestamp: string;\r\n}\r\n\r\nexport interface LogisticsAlert {\r\n  id: string;\r\n  type: 'delay' | 'exception' | 'delivery_attempt' | 'route_deviation';\r\n  severity: 'low' | 'medium' | 'high' | 'critical';\r\n  shipment_id: number;\r\n  message: string;\r\n  timestamp: string;\r\n  auto_resolve: boolean;\r\n}\r\n\r\n// =====================================================\r\n// WEBSOCKET CLIENT CLASS\r\n// =====================================================\r\n\r\nexport class LogisticsWebSocketClient extends EventEmitter {\r\n  private ws: WebSocket | null = null;\r\n  private url: string;\r\n  private reconnectAttempts = 0;\r\n  private maxReconnectAttempts = 5;\r\n  private reconnectDelay = 1000;\r\n  private heartbeatInterval: NodeJS.Timeout | null = null;\r\n  private isConnected = false;\r\n  private subscriptions = new Set<string>();\r\n  \r\n  constructor(url: string) {\r\n    super();\r\n    this.url = url;\r\n  }\r\n  \r\n  // =====================================================\r\n  // CONEXIÃ“N Y RECONEXIÃ“N\r\n  // =====================================================\r\n  \r\n  connect(): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        this.ws = new WebSocket(this.url);\r\n        \r\n        this.ws.onopen = () => {\r\n          console.log('ðŸ”— WebSocket conectado');\r\n          this.isConnected = true;\r\n          this.reconnectAttempts = 0;\r\n          this.startHeartbeat();\r\n          this.resubscribe();\r\n          this.emit('connected');\r\n          resolve();\r\n        };\r\n        \r\n        this.ws.onmessage = (event) => {\r\n          try {\r\n            const message: WebSocketMessage = JSON.parse(event.data);\r\n            this.handleMessage(message);\r\n          } catch (error) {\r\n            console.error('âŒ Error parsing WebSocket message:', error);\r\n          }\r\n        };\r\n        \r\n        this.ws.onclose = (event) => {\r\n          console.log('ðŸ”Œ WebSocket desconectado:', event.code, event.reason);\r\n          this.isConnected = false;\r\n          this.stopHeartbeat();\r\n          this.emit('disconnected', event);\r\n          \r\n          if (!event.wasClean && this.reconnectAttempts < this.maxReconnectAttempts) {\r\n            this.scheduleReconnect();\r\n          }\r\n        };\r\n        \r\n        this.ws.onerror = (error) => {\r\n          console.error('âŒ WebSocket error:', error);\r\n          this.emit('error', error);\r\n          reject(error);\r\n        };\r\n        \r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n  \r\n  private scheduleReconnect(): void {\r\n    const delay = this.reconnectDelay * Math.pow(2, this.reconnectAttempts);\r\n    console.log(`ðŸ”„ Reconectando en ${delay}ms (intento ${this.reconnectAttempts + 1}/${this.maxReconnectAttempts})`);\r\n    \r\n    setTimeout(() => {\r\n      this.reconnectAttempts++;\r\n      this.connect().catch(() => {\r\n        if (this.reconnectAttempts >= this.maxReconnectAttempts) {\r\n          console.error('âŒ MÃ¡ximo de intentos de reconexiÃ³n alcanzado');\r\n          this.emit('max_reconnect_attempts');\r\n        }\r\n      });\r\n    }, delay);\r\n  }\r\n  \r\n  disconnect(): void {\r\n    if (this.ws) {\r\n      this.ws.close(1000, 'Client disconnect');\r\n      this.ws = null;\r\n    }\r\n    this.stopHeartbeat();\r\n    this.isConnected = false;\r\n  }\r\n  \r\n  // =====================================================\r\n  // HEARTBEAT\r\n  // =====================================================\r\n  \r\n  private startHeartbeat(): void {\r\n    this.heartbeatInterval = setInterval(() => {\r\n      if (this.isConnected && this.ws?.readyState === WebSocket.OPEN) {\r\n        this.send({\r\n          type: 'ping',\r\n          data: {},\r\n          timestamp: new Date().toISOString()\r\n        });\r\n      }\r\n    }, 30000); // 30 segundos\r\n  }\r\n  \r\n  private stopHeartbeat(): void {\r\n    if (this.heartbeatInterval) {\r\n      clearInterval(this.heartbeatInterval);\r\n      this.heartbeatInterval = null;\r\n    }\r\n  }\r\n  \r\n  // =====================================================\r\n  // ENVÃO DE MENSAJES\r\n  // =====================================================\r\n  \r\n  private send(message: WebSocketMessage): void {\r\n    if (this.ws?.readyState === WebSocket.OPEN) {\r\n      this.ws.send(JSON.stringify(message));\r\n    } else {\r\n      console.warn('âš ï¸ WebSocket no estÃ¡ conectado, mensaje no enviado:', message);\r\n    }\r\n  }\r\n  \r\n  // =====================================================\r\n  // SUSCRIPCIONES\r\n  // =====================================================\r\n  \r\n  subscribeToShipment(shipmentId: number): void {\r\n    const subscription = `shipment:${shipmentId}`;\r\n    this.subscriptions.add(subscription);\r\n    \r\n    this.send({\r\n      type: 'subscribe',\r\n      data: { subscription },\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  }\r\n  \r\n  unsubscribeFromShipment(shipmentId: number): void {\r\n    const subscription = `shipment:${shipmentId}`;\r\n    this.subscriptions.delete(subscription);\r\n    \r\n    this.send({\r\n      type: 'unsubscribe',\r\n      data: { subscription },\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  }\r\n  \r\n  subscribeToGeofence(zoneId: string): void {\r\n    const subscription = `geofence:${zoneId}`;\r\n    this.subscriptions.add(subscription);\r\n    \r\n    this.send({\r\n      type: 'subscribe',\r\n      data: { subscription },\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  }\r\n  \r\n  subscribeToAlerts(): void {\r\n    const subscription = 'alerts:all';\r\n    this.subscriptions.add(subscription);\r\n    \r\n    this.send({\r\n      type: 'subscribe',\r\n      data: { subscription },\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  }\r\n  \r\n  private resubscribe(): void {\r\n    this.subscriptions.forEach(subscription => {\r\n      this.send({\r\n        type: 'subscribe',\r\n        data: { subscription },\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    });\r\n  }\r\n  \r\n  // =====================================================\r\n  // MANEJO DE MENSAJES\r\n  // =====================================================\r\n  \r\n  private handleMessage(message: WebSocketMessage): void {\r\n    console.log('ðŸ“¨ WebSocket message received:', message.type);\r\n    \r\n    switch (message.type) {\r\n      case 'tracking_update':\r\n        this.handleTrackingUpdate(message.data as TrackingUpdate);\r\n        break;\r\n        \r\n      case 'shipment_status':\r\n        this.handleShipmentStatus(message.data);\r\n        break;\r\n        \r\n      case 'alert':\r\n        this.handleAlert(message.data as LogisticsAlert);\r\n        break;\r\n        \r\n      case 'geofence_event':\r\n        this.handleGeofenceEvent(message.data as GeofenceEvent);\r\n        break;\r\n        \r\n      case 'route_update':\r\n        this.handleRouteUpdate(message.data);\r\n        break;\r\n        \r\n      default:\r\n        console.log('ðŸ¤· Unknown message type:', message.type);\r\n    }\r\n    \r\n    // Emitir evento genÃ©rico\r\n    this.emit('message', message);\r\n  }\r\n  \r\n  private handleTrackingUpdate(update: TrackingUpdate): void {\r\n    console.log('ðŸ“ Tracking update:', update);\r\n    this.emit('tracking_update', update);\r\n  }\r\n  \r\n  private handleShipmentStatus(data: any): void {\r\n    console.log('ðŸ“¦ Shipment status update:', data);\r\n    this.emit('shipment_status', data);\r\n  }\r\n  \r\n  private handleAlert(alert: LogisticsAlert): void {\r\n    console.log('ðŸš¨ Alert received:', alert);\r\n    this.emit('alert', alert);\r\n    \r\n    // Mostrar notificaciÃ³n del navegador si estÃ¡ permitido (DESHABILITADO EN DESARROLLO)\r\n    if ('Notification' in window && Notification.permission === 'granted' && process.env.NODE_ENV === 'production') {\r\n      new Notification(`Alerta de LogÃ­stica - ${alert.type}`, {\r\n        body: alert.message,\r\n        icon: '/favicon.ico',\r\n        tag: alert.id\r\n      });\r\n    }\r\n  }\r\n  \r\n  private handleGeofenceEvent(event: GeofenceEvent): void {\r\n    console.log('ðŸ—ºï¸ Geofence event:', event);\r\n    this.emit('geofence_event', event);\r\n  }\r\n  \r\n  private handleRouteUpdate(data: any): void {\r\n    console.log('ðŸ›£ï¸ Route update:', data);\r\n    this.emit('route_update', data);\r\n  }\r\n  \r\n  // =====================================================\r\n  // UTILIDADES\r\n  // =====================================================\r\n  \r\n  getConnectionState(): 'connecting' | 'connected' | 'disconnected' | 'error' {\r\n    if (!this.ws) {return 'disconnected';}\r\n    \r\n    switch (this.ws.readyState) {\r\n      case WebSocket.CONNECTING:\r\n        return 'connecting';\r\n      case WebSocket.OPEN:\r\n        return 'connected';\r\n      case WebSocket.CLOSING:\r\n      case WebSocket.CLOSED:\r\n        return 'disconnected';\r\n      default:\r\n        return 'error';\r\n    }\r\n  }\r\n  \r\n  isReady(): boolean {\r\n    return this.isConnected && this.ws?.readyState === WebSocket.OPEN;\r\n  }\r\n  \r\n  getSubscriptions(): string[] {\r\n    return Array.from(this.subscriptions);\r\n  }\r\n}\r\n\r\n// =====================================================\r\n// INSTANCIA SINGLETON\r\n// =====================================================\r\n\r\nlet logisticsWS: LogisticsWebSocketClient | null = null;\r\n\r\nexport function getLogisticsWebSocket(): LogisticsWebSocketClient {\r\n  if (!logisticsWS) {\r\n    // En desarrollo usar WebSocket local, en producciÃ³n usar WSS\r\n    const wsUrl = process.env.NODE_ENV === 'development' \r\n      ? 'ws://localhost:3001/logistics'\r\n      : 'wss://api.pinteya.com/logistics';\r\n    \r\n    logisticsWS = new LogisticsWebSocketClient(wsUrl);\r\n  }\r\n  \r\n  return logisticsWS;\r\n}\r\n\r\n// =====================================================\r\n// SIMULADOR PARA DESARROLLO\r\n// =====================================================\r\n\r\nexport class LogisticsWebSocketSimulator extends EventEmitter {\r\n  private intervals: NodeJS.Timeout[] = [];\r\n  private isRunning = false;\r\n  \r\n  start(): void {\r\n    if (this.isRunning) {return;}\r\n    \r\n    this.isRunning = true;\r\n    console.log('ðŸŽ­ Iniciando simulador WebSocket');\r\n    \r\n    // Simular actualizaciones de tracking cada 10 segundos\r\n    const trackingInterval = setInterval(() => {\r\n      this.simulateTrackingUpdate();\r\n    }, 10000);\r\n    \r\n    // Simular alertas cada 30 segundos\r\n    const alertInterval = setInterval(() => {\r\n      this.simulateAlert();\r\n    }, 30000);\r\n    \r\n    // Simular eventos de geofence cada 45 segundos\r\n    const geofenceInterval = setInterval(() => {\r\n      this.simulateGeofenceEvent();\r\n    }, 45000);\r\n    \r\n    this.intervals.push(trackingInterval, alertInterval, geofenceInterval);\r\n  }\r\n  \r\n  stop(): void {\r\n    this.intervals.forEach(interval => clearInterval(interval));\r\n    this.intervals = [];\r\n    this.isRunning = false;\r\n    console.log('ðŸ›‘ Simulador WebSocket detenido');\r\n  }\r\n  \r\n  private simulateTrackingUpdate(): void {\r\n    const update: TrackingUpdate = {\r\n      shipment_id: Math.floor(Math.random() * 100) + 1,\r\n      location: {\r\n        latitude: -34.6037 + (Math.random() - 0.5) * 0.1,\r\n        longitude: -58.3816 + (Math.random() - 0.5) * 0.1,\r\n        address: 'Av. Corrientes 1234, CABA'\r\n      },\r\n      status: ['in_transit', 'out_for_delivery'][Math.floor(Math.random() * 2)],\r\n      timestamp: new Date().toISOString(),\r\n      courier_id: Math.floor(Math.random() * 4) + 1,\r\n      estimated_arrival: new Date(Date.now() + 3600000).toISOString()\r\n    };\r\n    \r\n    this.emit('tracking_update', update);\r\n  }\r\n  \r\n  private simulateAlert(): void {\r\n    const alerts = [\r\n      { type: 'delay', message: 'Retraso en la entrega debido al trÃ¡fico' },\r\n      { type: 'exception', message: 'DirecciÃ³n incorrecta, contactar cliente' },\r\n      { type: 'delivery_attempt', message: 'Primer intento de entrega fallido' }\r\n    ];\r\n    \r\n    const randomAlert = alerts[Math.floor(Math.random() * alerts.length)];\r\n    \r\n    const alert: LogisticsAlert = {\r\n      id: `alert_${Date.now()}`,\r\n      type: randomAlert.type as any,\r\n      severity: ['low', 'medium', 'high'][Math.floor(Math.random() * 3)] as any,\r\n      shipment_id: Math.floor(Math.random() * 100) + 1,\r\n      message: randomAlert.message,\r\n      timestamp: new Date().toISOString(),\r\n      auto_resolve: Math.random() > 0.5\r\n    };\r\n    \r\n    this.emit('alert', alert);\r\n  }\r\n  \r\n  private simulateGeofenceEvent(): void {\r\n    const event: GeofenceEvent = {\r\n      shipment_id: Math.floor(Math.random() * 100) + 1,\r\n      zone_id: ['caba', 'gba_norte'][Math.floor(Math.random() * 2)],\r\n      zone_name: ['CABA - Zona Prioritaria', 'GBA Norte - Zona de Entrega'][Math.floor(Math.random() * 2)],\r\n      event_type: ['enter', 'exit'][Math.floor(Math.random() * 2)] as any,\r\n      location: {\r\n        latitude: -34.6037 + (Math.random() - 0.5) * 0.1,\r\n        longitude: -58.3816 + (Math.random() - 0.5) * 0.1\r\n      },\r\n      timestamp: new Date().toISOString()\r\n    };\r\n    \r\n    this.emit('geofence_event', event);\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["LogisticsWebSocketClient","LogisticsWebSocketSimulator","getLogisticsWebSocket","EventEmitter","url","ws","reconnectAttempts","maxReconnectAttempts","reconnectDelay","heartbeatInterval","isConnected","subscriptions","Set","connect","Promise","resolve","reject","WebSocket","onopen","console","log","startHeartbeat","resubscribe","emit","onmessage","event","message","JSON","parse","data","handleMessage","error","onclose","code","reason","stopHeartbeat","wasClean","scheduleReconnect","onerror","delay","Math","pow","setTimeout","catch","disconnect","close","setInterval","readyState","OPEN","send","type","timestamp","Date","toISOString","clearInterval","stringify","warn","subscribeToShipment","shipmentId","subscription","add","unsubscribeFromShipment","delete","subscribeToGeofence","zoneId","subscribeToAlerts","forEach","handleTrackingUpdate","handleShipmentStatus","handleAlert","handleGeofenceEvent","handleRouteUpdate","update","alert","window","Notification","permission","process","env","NODE_ENV","body","icon","tag","id","getConnectionState","CONNECTING","CLOSING","CLOSED","isReady","getSubscriptions","Array","from","logisticsWS","wsUrl","start","isRunning","trackingInterval","simulateTrackingUpdate","alertInterval","simulateAlert","geofenceInterval","simulateGeofenceEvent","intervals","push","stop","interval","shipment_id","floor","random","location","latitude","longitude","address","status","courier_id","estimated_arrival","now","alerts","randomAlert","length","severity","auto_resolve","zone_id","zone_name","event_type"],"mappings":"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"}