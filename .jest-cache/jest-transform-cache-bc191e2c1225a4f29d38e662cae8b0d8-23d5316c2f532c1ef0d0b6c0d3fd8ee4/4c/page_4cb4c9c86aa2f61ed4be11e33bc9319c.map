{"version":3,"names":["RefreshSessionPage","cov_tnqphydxo","f","getToken","s","_nextjs","useAuth","user","useUser","isRefreshing","setIsRefreshing","_react","useState","result","setResult","refreshSession","console","log","token","template","reload","metadata","publicMetadata","response","fetch","apiResult","json","ok","b","success","message","details","apiAccess","productsCount","data","total","error","Error","forceReload","window","location","_jsxruntime","jsx","className","jsxs","_card","Card","CardHeader","CardTitle","_lucidereact","RefreshCw","CardDescription","CardContent","id","primaryEmailAddress","emailAddress","role","JSON","stringify","_button","Button","onClick","disabled","Fragment","Loader2","variant","_alert","Alert","CheckCircle","AlertCircle","AlertDescription"],"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\_disabled\\refresh-session\\page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useAuth, useUser } from '@clerk/nextjs';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { CheckCircle, AlertCircle, Loader2, RefreshCw } from 'lucide-react';\r\n\r\nexport default function RefreshSessionPage() {\r\n  const { getToken } = useAuth();\r\n  const { user } = useUser();\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [result, setResult] = useState<{\r\n    success: boolean;\r\n    message: string;\r\n    details?: any;\r\n  } | null>(null);\r\n\r\n  const refreshSession = async () => {\r\n    setIsRefreshing(true);\r\n    setResult(null);\r\n\r\n    try {\r\n      console.log('üîÑ Refrescando sesi√≥n de Clerk...');\r\n\r\n      // Forzar refresh del token\r\n      const token = await getToken({ template: 'default' });\r\n      console.log('‚úÖ Token refrescado:', !!token);\r\n\r\n      // Recargar datos del usuario\r\n      await user?.reload();\r\n      console.log('‚úÖ Usuario recargado');\r\n\r\n      // Verificar metadata actualizada\r\n      const metadata = user?.publicMetadata;\r\n      console.log('üìã Metadata actual:', metadata);\r\n\r\n      // Probar acceso a API admin\r\n      const response = await fetch('/api/admin/products-simple?limit=5');\r\n      const apiResult = await response.json();\r\n\r\n      if (response.ok) {\r\n        setResult({\r\n          success: true,\r\n          message: '¬°Sesi√≥n refrescada exitosamente! El rol admin ya est√° funcionando.',\r\n          details: {\r\n            metadata,\r\n            apiAccess: true,\r\n            productsCount: apiResult.data?.total || 0\r\n          }\r\n        });\r\n      } else {\r\n        setResult({\r\n          success: false,\r\n          message: 'Sesi√≥n refrescada pero a√∫n hay problemas de acceso.',\r\n          details: {\r\n            metadata,\r\n            apiAccess: false,\r\n            error: apiResult.error\r\n          }\r\n        });\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('‚ùå Error refrescando sesi√≥n:', error);\r\n      setResult({\r\n        success: false,\r\n        message: 'Error al refrescar la sesi√≥n',\r\n        details: {\r\n          error: error instanceof Error ? error.message : 'Error desconocido'\r\n        }\r\n      });\r\n    } finally {\r\n      setIsRefreshing(false);\r\n    }\r\n  };\r\n\r\n  const forceReload = () => {\r\n    window.location.reload();\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mx-auto py-8 px-4\">\r\n      <div className=\"max-w-2xl mx-auto space-y-6\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\r\n            Refrescar Sesi√≥n Admin\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            Actualiza tu sesi√≥n para aplicar los cambios de rol admin\r\n          </p>\r\n        </div>\r\n\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <RefreshCw className=\"h-5 w-5\" />\r\n              Estado de la Sesi√≥n\r\n            </CardTitle>\r\n            <CardDescription>\r\n              Informaci√≥n actual de tu sesi√≥n y metadata\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n              <div>\r\n                <strong>Usuario ID:</strong>\r\n                <p className=\"font-mono text-xs\">{user?.id}</p>\r\n              </div>\r\n              <div>\r\n                <strong>Email:</strong>\r\n                <p>{user?.primaryEmailAddress?.emailAddress}</p>\r\n              </div>\r\n              <div>\r\n                <strong>Rol Actual:</strong>\r\n                <p className=\"font-mono\">\r\n                  {user?.publicMetadata?.role as string || 'undefined'}\r\n                </p>\r\n              </div>\r\n              <div>\r\n                <strong>Metadata:</strong>\r\n                <pre className=\"text-xs bg-gray-100 p-2 rounded\">\r\n                  {JSON.stringify(user?.publicMetadata, null, 2)}\r\n                </pre>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex gap-3\">\r\n              <Button\r\n                onClick={refreshSession}\r\n                disabled={isRefreshing}\r\n                className=\"flex-1\"\r\n              >\r\n                {isRefreshing ? (\r\n                  <>\r\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                    Refrescando...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <RefreshCw className=\"mr-2 h-4 w-4\" />\r\n                    Refrescar Sesi√≥n\r\n                  </>\r\n                )}\r\n              </Button>\r\n\r\n              <Button\r\n                onClick={forceReload}\r\n                variant=\"outline\"\r\n                disabled={isRefreshing}\r\n              >\r\n                Recargar P√°gina\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {result && (\r\n          <Alert className={result.success ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}>\r\n            <div className=\"flex items-start gap-2\">\r\n              {result.success ? (\r\n                <CheckCircle className=\"h-5 w-5 text-green-600 mt-0.5\" />\r\n              ) : (\r\n                <AlertCircle className=\"h-5 w-5 text-red-600 mt-0.5\" />\r\n              )}\r\n              <div className=\"flex-1\">\r\n                <AlertDescription className=\"text-sm\">\r\n                  <strong>{result.message}</strong>\r\n                  {result.details && (\r\n                    <details className=\"mt-2\">\r\n                      <summary className=\"cursor-pointer text-xs font-medium\">\r\n                        Ver detalles\r\n                      </summary>\r\n                      <pre className=\"mt-2 text-xs bg-white p-2 rounded border overflow-auto\">\r\n                        {JSON.stringify(result.details, null, 2)}\r\n                      </pre>\r\n                    </details>\r\n                  )}\r\n                </AlertDescription>\r\n              </div>\r\n            </div>\r\n          </Alert>\r\n        )}\r\n\r\n        <div className=\"text-center\">\r\n          <p className=\"text-sm text-gray-500 mb-4\">\r\n            Si el problema persiste despu√©s del refresh, intenta:\r\n          </p>\r\n          <div className=\"space-y-2 text-sm\">\r\n            <p>1. Cerrar sesi√≥n y volver a iniciar sesi√≥n</p>\r\n            <p>2. Limpiar cookies del navegador</p>\r\n            <p>3. Usar una ventana de inc√≥gnito</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+BASA;;;;;;WAAwBA,kBAAA;;;;;;;;iCAPC;;;iCACQ;;;iCACV;;;iCACmD;;;iCAClC;;;iCACqB;AAE9C,SAASA,mBAAA;EAAA;EAAAC,aAAA,GAAAC,CAAA;EACtB,MAAM;IAAEC;EAAQ,CAAE;EAAA;EAAA,CAAAF,aAAA,GAAAG,CAAA,QAAG,IAAAC,OAAA,CAAAC,OAAO;EAC5B,MAAM;IAAEC;EAAI,CAAE;EAAA;EAAA,CAAAN,aAAA,GAAAG,CAAA,QAAG,IAAAC,OAAA,CAAAG,OAAO;EACxB,MAAM,CAACC,YAAA,EAAcC,eAAA,CAAgB;EAAA;EAAA,CAAAT,aAAA,GAAAG,CAAA,QAAG,IAAAO,MAAA,CAAAC,QAAQ,EAAC;EACjD,MAAM,CAACC,MAAA,EAAQC,SAAA,CAAU;EAAA;EAAA,CAAAb,aAAA,GAAAG,CAAA,QAAG,IAAAO,MAAA,CAAAC,QAAQ,EAI1B;EAAA;EAAAX,aAAA,GAAAG,CAAA;EAEV,MAAMW,cAAA,GAAiB,MAAAA,CAAA;IAAA;IAAAd,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAG,CAAA;IACrBM,eAAA,CAAgB;IAAA;IAAAT,aAAA,GAAAG,CAAA;IAChBU,SAAA,CAAU;IAAA;IAAAb,aAAA,GAAAG,CAAA;IAEV,IAAI;MAAA;MAAAH,aAAA,GAAAG,CAAA;MACFY,OAAA,CAAQC,GAAG,CAAC;MAEZ;MACA,MAAMC,KAAA;MAAA;MAAA,CAAAjB,aAAA,GAAAG,CAAA,QAAQ,MAAMD,QAAA,CAAS;QAAEgB,QAAA,EAAU;MAAU;MAAA;MAAAlB,aAAA,GAAAG,CAAA;MACnDY,OAAA,CAAQC,GAAG,CAAC,uBAAuB,CAAC,CAACC,KAAA;MAErC;MAAA;MAAAjB,aAAA,GAAAG,CAAA;MACA,MAAMG,IAAA,EAAMa,MAAA;MAAA;MAAAnB,aAAA,GAAAG,CAAA;MACZY,OAAA,CAAQC,GAAG,CAAC;MAEZ;MACA,MAAMI,QAAA;MAAA;MAAA,CAAApB,aAAA,GAAAG,CAAA,QAAWG,IAAA,EAAMe,cAAA;MAAA;MAAArB,aAAA,GAAAG,CAAA;MACvBY,OAAA,CAAQC,GAAG,CAAC,uBAAuBI,QAAA;MAEnC;MACA,MAAME,QAAA;MAAA;MAAA,CAAAtB,aAAA,GAAAG,CAAA,QAAW,MAAMoB,KAAA,CAAM;MAC7B,MAAMC,SAAA;MAAA;MAAA,CAAAxB,aAAA,GAAAG,CAAA,QAAY,MAAMmB,QAAA,CAASG,IAAI;MAAA;MAAAzB,aAAA,GAAAG,CAAA;MAErC,IAAImB,QAAA,CAASI,EAAE,EAAE;QAAA;QAAA1B,aAAA,GAAA2B,CAAA;QAAA3B,aAAA,GAAAG,CAAA;QACfU,SAAA,CAAU;UACRe,OAAA,EAAS;UACTC,OAAA,EAAS;UACTC,OAAA,EAAS;YACPV,QAAA;YACAW,SAAA,EAAW;YACXC,aAAA;YAAe;YAAA,CAAAhC,aAAA,GAAA2B,CAAA,UAAAH,SAAA,CAAUS,IAAI,EAAEC,KAAA;YAAA;YAAA,CAAAlC,aAAA,GAAA2B,CAAA,UAAS;UAC1C;QACF;MACF,OAAO;QAAA;QAAA3B,aAAA,GAAA2B,CAAA;QAAA3B,aAAA,GAAAG,CAAA;QACLU,SAAA,CAAU;UACRe,OAAA,EAAS;UACTC,OAAA,EAAS;UACTC,OAAA,EAAS;YACPV,QAAA;YACAW,SAAA,EAAW;YACXI,KAAA,EAAOX,SAAA,CAAUW;UACnB;QACF;MACF;IAEF,EAAE,OAAOA,KAAA,EAAO;MAAA;MAAAnC,aAAA,GAAAG,CAAA;MACdY,OAAA,CAAQoB,KAAK,CAAC,+BAA+BA,KAAA;MAAA;MAAAnC,aAAA,GAAAG,CAAA;MAC7CU,SAAA,CAAU;QACRe,OAAA,EAAS;QACTC,OAAA,EAAS;QACTC,OAAA,EAAS;UACPK,KAAA,EAAOA,KAAA,YAAiBC,KAAA;UAAA;UAAA,CAAApC,aAAA,GAAA2B,CAAA,UAAQQ,KAAA,CAAMN,OAAO;UAAA;UAAA,CAAA7B,aAAA,GAAA2B,CAAA,UAAG;QAClD;MACF;IACF,UAAU;MAAA;MAAA3B,aAAA,GAAAG,CAAA;MACRM,eAAA,CAAgB;IAClB;EACF;EAAA;EAAAT,aAAA,GAAAG,CAAA;EAEA,MAAMkC,WAAA,GAAcA,CAAA;IAAA;IAAArC,aAAA,GAAAC,CAAA;IAAAD,aAAA,GAAAG,CAAA;IAClBmC,MAAA,CAAOC,QAAQ,CAACpB,MAAM;EACxB;EAAA;EAAAnB,aAAA,GAAAG,CAAA;EAEA,oBACE,IAAAqC,WAAA,CAAAC,GAAA,EAAC;IAAIC,SAAA,EAAU;cACb,iBAAAF,WAAA,CAAAG,IAAA,EAAC;MAAID,SAAA,EAAU;8BACb,IAAAF,WAAA,CAAAG,IAAA,EAAC;QAAID,SAAA,EAAU;gCACb,IAAAF,WAAA,CAAAC,GAAA,EAAC;UAAGC,SAAA,EAAU;oBAAwC;yBAGtD,IAAAF,WAAA,CAAAC,GAAA,EAAC;UAAEC,SAAA,EAAU;oBAAgB;;uBAK/B,IAAAF,WAAA,CAAAG,IAAA,EAACC,KAAA,CAAAC,IAAI;gCACH,IAAAL,WAAA,CAAAG,IAAA,EAACC,KAAA,CAAAE,UAAU;kCACT,IAAAN,WAAA,CAAAG,IAAA,EAACC,KAAA,CAAAG,SAAS;YAACL,SAAA,EAAU;oCACnB,IAAAF,WAAA,CAAAC,GAAA,EAACO,YAAA,CAAAC,SAAS;cAACP,SAAA,EAAU;gBAAY;2BAGnC,IAAAF,WAAA,CAAAC,GAAA,EAACG,KAAA,CAAAM,eAAe;sBAAC;;yBAInB,IAAAV,WAAA,CAAAG,IAAA,EAACC,KAAA,CAAAO,WAAW;UAACT,SAAA,EAAU;kCACrB,IAAAF,WAAA,CAAAG,IAAA,EAAC;YAAID,SAAA,EAAU;oCACb,IAAAF,WAAA,CAAAG,IAAA,EAAC;sCACC,IAAAH,WAAA,CAAAC,GAAA,EAAC;0BAAO;+BACR,IAAAD,WAAA,CAAAC,GAAA,EAAC;gBAAEC,SAAA,EAAU;0BAAqBpC,IAAA,EAAM8C;;6BAE1C,IAAAZ,WAAA,CAAAG,IAAA,EAAC;sCACC,IAAAH,WAAA,CAAAC,GAAA,EAAC;0BAAO;+BACR,IAAAD,WAAA,CAAAC,GAAA,EAAC;0BAAGnC,IAAA,EAAM+C,mBAAA,EAAqBC;;6BAEjC,IAAAd,WAAA,CAAAG,IAAA,EAAC;sCACC,IAAAH,WAAA,CAAAC,GAAA,EAAC;0BAAO;+BACR,IAAAD,WAAA,CAAAC,GAAA,EAAC;gBAAEC,SAAA,EAAU;;gBACV;gBAAA,CAAA1C,aAAA,GAAA2B,CAAA,UAAArB,IAAA,EAAMe,cAAA,EAAgBkC,IAAA;gBAAA;gBAAA,CAAAvD,aAAA,GAAA2B,CAAA,UAAkB;;6BAG7C,IAAAa,WAAA,CAAAG,IAAA,EAAC;sCACC,IAAAH,WAAA,CAAAC,GAAA,EAAC;0BAAO;+BACR,IAAAD,WAAA,CAAAC,GAAA,EAAC;gBAAIC,SAAA,EAAU;0BACZc,IAAA,CAAKC,SAAS,CAACnD,IAAA,EAAMe,cAAA,EAAgB,MAAM;;;2BAKlD,IAAAmB,WAAA,CAAAG,IAAA,EAAC;YAAID,SAAA,EAAU;oCACb,IAAAF,WAAA,CAAAC,GAAA,EAACiB,OAAA,CAAAC,MAAM;cACLC,OAAA,EAAS9C,cAAA;cACT+C,QAAA,EAAUrD,YAAA;cACVkC,SAAA,EAAU;wBAETlC,YAAA;cAAA;cAAA,cAAAR,aAAA,GAAA2B,CAAA,UACC,IAAAa,WAAA,CAAAG,IAAA,EAAAH,WAAA,CAAAsB,QAAA;wCACE,IAAAtB,WAAA,CAAAC,GAAA,EAACO,YAAA,CAAAe,OAAO;kBAACrB,SAAA,EAAU;oBAA8B;;;uDAInD,IAAAF,WAAA,CAAAG,IAAA,EAAAH,WAAA,CAAAsB,QAAA;wCACE,IAAAtB,WAAA,CAAAC,GAAA,EAACO,YAAA,CAAAC,SAAS;kBAACP,SAAA,EAAU;oBAAiB;;6BAM5C,IAAAF,WAAA,CAAAC,GAAA,EAACiB,OAAA,CAAAC,MAAM;cACLC,OAAA,EAASvB,WAAA;cACT2B,OAAA,EAAQ;cACRH,QAAA,EAAUrD,YAAA;wBACX;;;;;MAON;MAAA,CAAAR,aAAA,GAAA2B,CAAA,UAAAf,MAAA;MAAA;MAAA,CAAAZ,aAAA,GAAA2B,CAAA,uBACC,IAAAa,WAAA,CAAAC,GAAA,EAACwB,MAAA,CAAAC,KAAK;QAACxB,SAAA,EAAW9B,MAAA,CAAOgB,OAAO;QAAA;QAAA,CAAA5B,aAAA,GAAA2B,CAAA,UAAG;QAAA;QAAA,CAAA3B,aAAA,GAAA2B,CAAA,UAAiC;kBAClE,iBAAAa,WAAA,CAAAG,IAAA,EAAC;UAAID,SAAA,EAAU;qBACZ9B,MAAA,CAAOgB,OAAO;UAAA;UAAA,cAAA5B,aAAA,GAAA2B,CAAA,UACb,IAAAa,WAAA,CAAAC,GAAA,EAACO,YAAA,CAAAmB,WAAW;YAACzB,SAAA,EAAU;;;mDAEvB,IAAAF,WAAA,CAAAC,GAAA,EAACO,YAAA,CAAAoB,WAAW;YAAC1B,SAAA,EAAU;4BAEzB,IAAAF,WAAA,CAAAC,GAAA,EAAC;YAAIC,SAAA,EAAU;sBACb,iBAAAF,WAAA,CAAAG,IAAA,EAACsB,MAAA,CAAAI,gBAAgB;cAAC3B,SAAA,EAAU;sCAC1B,IAAAF,WAAA,CAAAC,GAAA,EAAC;0BAAQ7B,MAAA,CAAOiB;;cACf;cAAA,CAAA7B,aAAA,GAAA2B,CAAA,UAAAf,MAAA,CAAOkB,OAAO;cAAA;cAAA,CAAA9B,aAAA,GAAA2B,CAAA,uBACb,IAAAa,WAAA,CAAAG,IAAA,EAAC;gBAAQD,SAAA,EAAU;wCACjB,IAAAF,WAAA,CAAAC,GAAA,EAAC;kBAAQC,SAAA,EAAU;4BAAqC;iCAGxD,IAAAF,WAAA,CAAAC,GAAA,EAAC;kBAAIC,SAAA,EAAU;4BACZc,IAAA,CAAKC,SAAS,CAAC7C,MAAA,CAAOkB,OAAO,EAAE,MAAM;;;;;;wBAUtD,IAAAU,WAAA,CAAAG,IAAA,EAAC;QAAID,SAAA,EAAU;gCACb,IAAAF,WAAA,CAAAC,GAAA,EAAC;UAAEC,SAAA,EAAU;oBAA6B;yBAG1C,IAAAF,WAAA,CAAAG,IAAA,EAAC;UAAID,SAAA,EAAU;kCACb,IAAAF,WAAA,CAAAC,GAAA,EAAC;sBAAE;2BACH,IAAAD,WAAA,CAAAC,GAAA,EAAC;sBAAE;2BACH,IAAAD,WAAA,CAAAC,GAAA,EAAC;sBAAE;;;;;;AAMf","ignoreList":[]}