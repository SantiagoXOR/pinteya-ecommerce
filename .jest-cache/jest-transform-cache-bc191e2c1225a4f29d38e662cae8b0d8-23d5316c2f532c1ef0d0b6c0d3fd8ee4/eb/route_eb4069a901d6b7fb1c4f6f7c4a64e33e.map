{"version":3,"names":["cov_twpg5sg6b","actualCoverage","s","GET","f","POST","runtime","execAsync","_util","promisify","_child_process","exec","request","console","log","scriptPath","_path","default","join","process","cwd","logsPath","_fs","existsSync","b","_server","NextResponse","json","success","error","status","stdout","stderr","timeout","warn","logs","logsContent","readFileSync","JSON","parse","parseError","message","output","timestamp","Date","toISOString","Error","details","name","stack","env","NODE_ENV","undefined","scriptExists","logsExist","lastRun","statSync","mtime"],"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\admin\\run-purchase-simulation\\route.ts"],"sourcesContent":["// Configuraci√≥n para Node.js Runtime\r\nexport const runtime = 'nodejs';\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { exec } from 'child_process';\r\nimport { promisify } from 'util';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst execAsync = promisify(exec);\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    console.log('üöÄ Iniciando simulaci√≥n de flujo de compra...');\r\n    \r\n    // Ruta al script de simulaci√≥n\r\n    const scriptPath = path.join(process.cwd(), 'complete-purchase-flow-simulation.js');\r\n    const logsPath = path.join(process.cwd(), 'purchase-flow-logs.json');\r\n    \r\n    // Verificar que el script existe\r\n    if (!fs.existsSync(scriptPath)) {\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: 'Script de simulaci√≥n no encontrado'\r\n      }, { status: 404 });\r\n    }\r\n    \r\n    // Ejecutar el script de simulaci√≥n\r\n    console.log('üìù Ejecutando script:', scriptPath);\r\n    \r\n    const { stdout, stderr } = await execAsync(`node \"${scriptPath}\"`, {\r\n      cwd: process.cwd(),\r\n      timeout: 30000 // 30 segundos timeout\r\n    });\r\n    \r\n    console.log('‚úÖ Script ejecutado exitosamente');\r\n    console.log('üì§ Stdout:', stdout);\r\n    \r\n    if (stderr) {\r\n      console.warn('‚ö†Ô∏è Stderr:', stderr);\r\n    }\r\n    \r\n    // Leer los logs generados\r\n    let logs = null;\r\n    if (fs.existsSync(logsPath)) {\r\n      try {\r\n        const logsContent = fs.readFileSync(logsPath, 'utf8');\r\n        logs = JSON.parse(logsContent);\r\n        console.log('üìä Logs cargados exitosamente');\r\n      } catch (parseError) {\r\n        console.error('‚ùå Error parseando logs:', parseError);\r\n      }\r\n    }\r\n    \r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Simulaci√≥n completada exitosamente',\r\n      logs,\r\n      output: stdout,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n    \r\n  } catch (error) {\r\n    console.error('‚ùå Error en simulaci√≥n:', error);\r\n    \r\n    // Si es un error de timeout o ejecuci√≥n\r\n    if (error instanceof Error) {\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: error.message,\r\n        details: {\r\n          name: error.name,\r\n          stack: process.env.NODE_ENV === 'development' ? error.stack : undefined\r\n        }\r\n      }, { status: 500 });\r\n    }\r\n    \r\n    return NextResponse.json({\r\n      success: false,\r\n      error: 'Error desconocido en la simulaci√≥n'\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\n// M√©todo GET para verificar el estado del endpoint\r\nexport async function GET() {\r\n  const scriptPath = path.join(process.cwd(), 'complete-purchase-flow-simulation.js');\r\n  const logsPath = path.join(process.cwd(), 'purchase-flow-logs.json');\r\n  \r\n  return NextResponse.json({\r\n    status: 'ready',\r\n    scriptExists: fs.existsSync(scriptPath),\r\n    logsExist: fs.existsSync(logsPath),\r\n    lastRun: fs.existsSync(logsPath) ? fs.statSync(logsPath).mtime : null,\r\n    timestamp: new Date().toISOString()\r\n  });\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]}