3335273410b1535044402643eedbdd63
// ===================================
// HOOK: useRecentSearches - Gestión de búsquedas recientes con localStorage
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get default () {
        return _default;
    },
    get useRecentSearches () {
        return useRecentSearches;
    },
    get useRecentSearchesSimple () {
        return useRecentSearchesSimple;
    }
});
const _react = require("react");
const _jsonutils = require("../lib/json-utils");
const DEFAULT_OPTIONS = {
    maxSearches: 5,
    storageKey: 'pinteya-recent-searches',
    enablePersistence: true,
    filterDuplicates: true,
    expirationDays: 30
};
function useRecentSearches(options = {}) {
    const config = {
        ...DEFAULT_OPTIONS,
        ...options
    };
    const [recentSearches, setRecentSearches] = (0, _react.useState)([]);
    // Función para validar y limpiar una búsqueda
    const sanitizeSearch = (0, _react.useCallback)((search)=>{
        return search.trim().toLowerCase();
    }, []);
    // Función para verificar si los datos han expirado
    const isExpired = (0, _react.useCallback)((timestamp)=>{
        if (config.expirationDays === 0) {
            return false;
        }
        const maxAge = config.expirationDays * 24 * 60 * 60 * 1000;
        return Date.now() - timestamp > maxAge;
    }, [
        config.expirationDays
    ]);
    // Cargar búsquedas desde localStorage
    const loadFromStorage = (0, _react.useCallback)(()=>{
        if (!config.enablePersistence) {
            return [];
        }
        // Usar utilidad segura para cargar desde localStorage
        const result = (0, _jsonutils.safeLocalStorageGet)(config.storageKey);
        if (!result.success) {
            return [];
        }
        const data = result.data;
        // Verificar si es formato nuevo (con metadata)
        if (data && typeof data === 'object' && 'searches' in data && Array.isArray(data.searches)) {
            const persistedData = data;
            // Verificar expiración
            if (persistedData.timestamp && isExpired(persistedData.timestamp)) {
                // Limpiar datos expirados usando utilidad segura
                (0, _jsonutils.safeLocalStorageSet)(config.storageKey, {
                    searches: [],
                    timestamp: Date.now(),
                    version: '1.0'
                });
                return [];
            }
            return persistedData.searches.slice(0, config.maxSearches);
        }
        // Formato antiguo (array simple)
        if (Array.isArray(data)) {
            return data.slice(0, config.maxSearches);
        }
        return [];
    }, [
        config.enablePersistence,
        config.storageKey,
        config.maxSearches,
        isExpired
    ]);
    // Guardar búsquedas en localStorage
    const saveToStorage = (0, _react.useCallback)((searches)=>{
        if (!config.enablePersistence || typeof window === 'undefined') {
            return;
        }
        try {
            if (searches.length === 0) {
                localStorage.removeItem(config.storageKey);
                return;
            }
            const dataToStore = {
                searches: searches.slice(0, config.maxSearches),
                timestamp: Date.now(),
                version: '1.0.0'
            };
            localStorage.setItem(config.storageKey, JSON.stringify(dataToStore));
        } catch (error) {
            console.warn('Error saving recent searches to localStorage:', error);
        }
    }, [
        config.enablePersistence,
        config.storageKey,
        config.maxSearches
    ]);
    // Cargar búsquedas al inicializar
    (0, _react.useEffect)(()=>{
        const loaded = loadFromStorage();
        setRecentSearches(loaded);
    }, [
        loadFromStorage
    ]);
    // Agregar una nueva búsqueda
    const addSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        if (!sanitized || sanitized.length < 2) {
            return;
        }
        setRecentSearches((prev)=>{
            let updated = [
                ...prev
            ];
            // Remover duplicados si está habilitado
            if (config.filterDuplicates) {
                updated = updated.filter((s)=>sanitizeSearch(s) !== sanitized);
            }
            // Agregar al principio
            updated.unshift(search.trim());
            // Limitar al máximo configurado
            updated = updated.slice(0, config.maxSearches);
            // Guardar en localStorage
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        config.filterDuplicates,
        config.maxSearches,
        saveToStorage
    ]);
    // Remover una búsqueda específica
    const removeSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        setRecentSearches((prev)=>{
            const updated = prev.filter((s)=>sanitizeSearch(s) !== sanitized);
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        saveToStorage
    ]);
    // Limpiar todas las búsquedas
    const clearSearches = (0, _react.useCallback)(()=>{
        setRecentSearches([]);
        saveToStorage([]);
    }, [
        saveToStorage
    ]);
    // Verificar si una búsqueda existe
    const hasSearch = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        return recentSearches.some((s)=>sanitizeSearch(s) === sanitized);
    }, [
        recentSearches,
        sanitizeSearch
    ]);
    // Obtener las N búsquedas más recientes
    const getRecentSearches = (0, _react.useCallback)((limit)=>{
        const actualLimit = limit ?? config.maxSearches;
        return recentSearches.slice(0, actualLimit);
    }, [
        recentSearches,
        config.maxSearches
    ]);
    // Mover una búsqueda al principio (reordenar)
    const moveToTop = (0, _react.useCallback)((search)=>{
        const sanitized = sanitizeSearch(search);
        setRecentSearches((prev)=>{
            const filtered = prev.filter((s)=>sanitizeSearch(s) !== sanitized);
            const existing = prev.find((s)=>sanitizeSearch(s) === sanitized);
            if (!existing) {
                return prev;
            }
            const updated = [
                existing,
                ...filtered
            ];
            saveToStorage(updated);
            return updated;
        });
    }, [
        sanitizeSearch,
        saveToStorage
    ]);
    return {
        recentSearches,
        addSearch,
        removeSearch,
        clearSearches,
        hasSearch,
        getRecentSearches,
        moveToTop
    };
}
function useRecentSearchesSimple(limit = 5) {
    const { getRecentSearches } = useRecentSearches({
        maxSearches: limit
    });
    return getRecentSearches();
}
const _default = useRecentSearches;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZVJlY2VudFNlYXJjaGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEhPT0s6IHVzZVJlY2VudFNlYXJjaGVzIC0gR2VzdGnDs24gZGUgYsO6c3F1ZWRhcyByZWNpZW50ZXMgY29uIGxvY2FsU3RvcmFnZVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCB7IHNhZmVMb2NhbFN0b3JhZ2VHZXQsIHNhZmVMb2NhbFN0b3JhZ2VTZXQsIFNUT1JBR0VfS0VZUyB9IGZyb20gJ0AvbGliL2pzb24tdXRpbHMnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBSZWNlbnRTZWFyY2hlc09wdGlvbnMge1xyXG4gIC8qKiBOw7ptZXJvIG3DoXhpbW8gZGUgYsO6c3F1ZWRhcyByZWNpZW50ZXMgYSBtYW50ZW5lciAqL1xyXG4gIG1heFNlYXJjaGVzPzogbnVtYmVyO1xyXG4gIC8qKiBDbGF2ZSBkZSBsb2NhbFN0b3JhZ2UgcGFyYSBwZXJzaXN0aXIgbGFzIGLDunNxdWVkYXMgKi9cclxuICBzdG9yYWdlS2V5Pzogc3RyaW5nO1xyXG4gIC8qKiBIYWJpbGl0YXIvZGVzaGFiaWxpdGFyIHBlcnNpc3RlbmNpYSBlbiBsb2NhbFN0b3JhZ2UgKi9cclxuICBlbmFibGVQZXJzaXN0ZW5jZT86IGJvb2xlYW47XHJcbiAgLyoqIEZpbHRyYXIgYsO6c3F1ZWRhcyBkdXBsaWNhZGFzICovXHJcbiAgZmlsdGVyRHVwbGljYXRlcz86IGJvb2xlYW47XHJcbiAgLyoqIFRpZW1wbyBkZSBleHBpcmFjacOzbiBlbiBkw61hcyAoMCA9IHNpbiBleHBpcmFjacOzbikgKi9cclxuICBleHBpcmF0aW9uRGF5cz86IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBSZWNlbnRTZWFyY2hlc1JldHVybiB7XHJcbiAgLyoqIEFycmF5IGRlIGLDunNxdWVkYXMgcmVjaWVudGVzICovXHJcbiAgcmVjZW50U2VhcmNoZXM6IHN0cmluZ1tdO1xyXG4gIC8qKiBBZ3JlZ2FyIHVuYSBudWV2YSBiw7pzcXVlZGEgKi9cclxuICBhZGRTZWFyY2g6IChzZWFyY2g6IHN0cmluZykgPT4gdm9pZDtcclxuICAvKiogUmVtb3ZlciB1bmEgYsO6c3F1ZWRhIGVzcGVjw61maWNhICovXHJcbiAgcmVtb3ZlU2VhcmNoOiAoc2VhcmNoOiBzdHJpbmcpID0+IHZvaWQ7XHJcbiAgLyoqIExpbXBpYXIgdG9kYXMgbGFzIGLDunNxdWVkYXMgKi9cclxuICBjbGVhclNlYXJjaGVzOiAoKSA9PiB2b2lkO1xyXG4gIC8qKiBWZXJpZmljYXIgc2kgdW5hIGLDunNxdWVkYSBleGlzdGUgKi9cclxuICBoYXNTZWFyY2g6IChzZWFyY2g6IHN0cmluZykgPT4gYm9vbGVhbjtcclxuICAvKiogT2J0ZW5lciBsYXMgTiBiw7pzcXVlZGFzIG3DoXMgcmVjaWVudGVzICovXHJcbiAgZ2V0UmVjZW50U2VhcmNoZXM6IChsaW1pdD86IG51bWJlcikgPT4gc3RyaW5nW107XHJcbiAgLyoqIFJlb3JkZW5hciBiw7pzcXVlZGFzIChtb3ZlciBhbCBwcmluY2lwaW8pICovXHJcbiAgbW92ZVRvVG9wOiAoc2VhcmNoOiBzdHJpbmcpID0+IHZvaWQ7XHJcbn1cclxuXHJcbmludGVyZmFjZSBQZXJzaXN0ZWRTZWFyY2hEYXRhIHtcclxuICBzZWFyY2hlczogc3RyaW5nW107XHJcbiAgdGltZXN0YW1wOiBudW1iZXI7XHJcbiAgdmVyc2lvbjogc3RyaW5nO1xyXG59XHJcblxyXG5jb25zdCBERUZBVUxUX09QVElPTlM6IFJlcXVpcmVkPFJlY2VudFNlYXJjaGVzT3B0aW9ucz4gPSB7XHJcbiAgbWF4U2VhcmNoZXM6IDUsXHJcbiAgc3RvcmFnZUtleTogJ3BpbnRleWEtcmVjZW50LXNlYXJjaGVzJyxcclxuICBlbmFibGVQZXJzaXN0ZW5jZTogdHJ1ZSxcclxuICBmaWx0ZXJEdXBsaWNhdGVzOiB0cnVlLFxyXG4gIGV4cGlyYXRpb25EYXlzOiAzMCwgLy8gMzAgZMOtYXMgZGUgZXhwaXJhY2nDs25cclxufTtcclxuXHJcbi8qKlxyXG4gKiBIb29rIHBhcmEgZ2VzdGlvbmFyIGLDunNxdWVkYXMgcmVjaWVudGVzIGNvbiBwZXJzaXN0ZW5jaWEgZW4gbG9jYWxTdG9yYWdlXHJcbiAqIFxyXG4gKiBDYXJhY3RlcsOtc3RpY2FzOlxyXG4gKiAtIFBlcnNpc3RlbmNpYSBhdXRvbcOhdGljYSBlbiBsb2NhbFN0b3JhZ2VcclxuICogLSBMw61taXRlIGNvbmZpZ3VyYWJsZSBkZSBiw7pzcXVlZGFzXHJcbiAqIC0gRmlsdHJhZG8gZGUgZHVwbGljYWRvc1xyXG4gKiAtIEV4cGlyYWNpw7NuIGF1dG9tw6F0aWNhXHJcbiAqIC0gTWFuZWpvIGRlIGVycm9yZXMgcm9idXN0b1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHVzZVJlY2VudFNlYXJjaGVzKG9wdGlvbnM6IFJlY2VudFNlYXJjaGVzT3B0aW9ucyA9IHt9KTogUmVjZW50U2VhcmNoZXNSZXR1cm4ge1xyXG4gIGNvbnN0IGNvbmZpZyA9IHsgLi4uREVGQVVMVF9PUFRJT05TLCAuLi5vcHRpb25zIH07XHJcbiAgY29uc3QgW3JlY2VudFNlYXJjaGVzLCBzZXRSZWNlbnRTZWFyY2hlc10gPSB1c2VTdGF0ZTxzdHJpbmdbXT4oW10pO1xyXG5cclxuICAvLyBGdW5jacOzbiBwYXJhIHZhbGlkYXIgeSBsaW1waWFyIHVuYSBiw7pzcXVlZGFcclxuICBjb25zdCBzYW5pdGl6ZVNlYXJjaCA9IHVzZUNhbGxiYWNrKChzZWFyY2g6IHN0cmluZyk6IHN0cmluZyA9PiB7XHJcbiAgICByZXR1cm4gc2VhcmNoLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xyXG4gIH0sIFtdKTtcclxuXHJcbiAgLy8gRnVuY2nDs24gcGFyYSB2ZXJpZmljYXIgc2kgbG9zIGRhdG9zIGhhbiBleHBpcmFkb1xyXG4gIGNvbnN0IGlzRXhwaXJlZCA9IHVzZUNhbGxiYWNrKCh0aW1lc3RhbXA6IG51bWJlcik6IGJvb2xlYW4gPT4ge1xyXG4gICAgaWYgKGNvbmZpZy5leHBpcmF0aW9uRGF5cyA9PT0gMCkge3JldHVybiBmYWxzZTt9XHJcbiAgICBjb25zdCBtYXhBZ2UgPSBjb25maWcuZXhwaXJhdGlvbkRheXMgKiAyNCAqIDYwICogNjAgKiAxMDAwO1xyXG4gICAgcmV0dXJuIERhdGUubm93KCkgLSB0aW1lc3RhbXAgPiBtYXhBZ2U7XHJcbiAgfSwgW2NvbmZpZy5leHBpcmF0aW9uRGF5c10pO1xyXG5cclxuICAvLyBDYXJnYXIgYsO6c3F1ZWRhcyBkZXNkZSBsb2NhbFN0b3JhZ2VcclxuICBjb25zdCBsb2FkRnJvbVN0b3JhZ2UgPSB1c2VDYWxsYmFjaygoKTogc3RyaW5nW10gPT4ge1xyXG4gICAgaWYgKCFjb25maWcuZW5hYmxlUGVyc2lzdGVuY2UpIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVzYXIgdXRpbGlkYWQgc2VndXJhIHBhcmEgY2FyZ2FyIGRlc2RlIGxvY2FsU3RvcmFnZVxyXG4gICAgY29uc3QgcmVzdWx0ID0gc2FmZUxvY2FsU3RvcmFnZUdldDxQZXJzaXN0ZWRTZWFyY2hEYXRhIHwgc3RyaW5nW10+KGNvbmZpZy5zdG9yYWdlS2V5KTtcclxuXHJcbiAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBkYXRhID0gcmVzdWx0LmRhdGE7XHJcblxyXG4gICAgLy8gVmVyaWZpY2FyIHNpIGVzIGZvcm1hdG8gbnVldm8gKGNvbiBtZXRhZGF0YSlcclxuICAgIGlmIChkYXRhICYmIHR5cGVvZiBkYXRhID09PSAnb2JqZWN0JyAmJiAnc2VhcmNoZXMnIGluIGRhdGEgJiYgQXJyYXkuaXNBcnJheShkYXRhLnNlYXJjaGVzKSkge1xyXG4gICAgICBjb25zdCBwZXJzaXN0ZWREYXRhID0gZGF0YSBhcyBQZXJzaXN0ZWRTZWFyY2hEYXRhO1xyXG5cclxuICAgICAgLy8gVmVyaWZpY2FyIGV4cGlyYWNpw7NuXHJcbiAgICAgIGlmIChwZXJzaXN0ZWREYXRhLnRpbWVzdGFtcCAmJiBpc0V4cGlyZWQocGVyc2lzdGVkRGF0YS50aW1lc3RhbXApKSB7XHJcbiAgICAgICAgLy8gTGltcGlhciBkYXRvcyBleHBpcmFkb3MgdXNhbmRvIHV0aWxpZGFkIHNlZ3VyYVxyXG4gICAgICAgIHNhZmVMb2NhbFN0b3JhZ2VTZXQoY29uZmlnLnN0b3JhZ2VLZXksIHtcclxuICAgICAgICAgIHNlYXJjaGVzOiBbXSxcclxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcclxuICAgICAgICAgIHZlcnNpb246ICcxLjAnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gcGVyc2lzdGVkRGF0YS5zZWFyY2hlcy5zbGljZSgwLCBjb25maWcubWF4U2VhcmNoZXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZvcm1hdG8gYW50aWd1byAoYXJyYXkgc2ltcGxlKVxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuICAgICAgcmV0dXJuIGRhdGEuc2xpY2UoMCwgY29uZmlnLm1heFNlYXJjaGVzKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gW107XHJcbiAgfSwgW2NvbmZpZy5lbmFibGVQZXJzaXN0ZW5jZSwgY29uZmlnLnN0b3JhZ2VLZXksIGNvbmZpZy5tYXhTZWFyY2hlcywgaXNFeHBpcmVkXSk7XHJcblxyXG4gIC8vIEd1YXJkYXIgYsO6c3F1ZWRhcyBlbiBsb2NhbFN0b3JhZ2VcclxuICBjb25zdCBzYXZlVG9TdG9yYWdlID0gdXNlQ2FsbGJhY2soKHNlYXJjaGVzOiBzdHJpbmdbXSk6IHZvaWQgPT4ge1xyXG4gICAgaWYgKCFjb25maWcuZW5hYmxlUGVyc2lzdGVuY2UgfHwgdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChzZWFyY2hlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShjb25maWcuc3RvcmFnZUtleSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBkYXRhVG9TdG9yZTogUGVyc2lzdGVkU2VhcmNoRGF0YSA9IHtcclxuICAgICAgICBzZWFyY2hlczogc2VhcmNoZXMuc2xpY2UoMCwgY29uZmlnLm1heFNlYXJjaGVzKSxcclxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXHJcbiAgICAgICAgdmVyc2lvbjogJzEuMC4wJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oY29uZmlnLnN0b3JhZ2VLZXksIEpTT04uc3RyaW5naWZ5KGRhdGFUb1N0b3JlKSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ0Vycm9yIHNhdmluZyByZWNlbnQgc2VhcmNoZXMgdG8gbG9jYWxTdG9yYWdlOicsIGVycm9yKTtcclxuICAgIH1cclxuICB9LCBbY29uZmlnLmVuYWJsZVBlcnNpc3RlbmNlLCBjb25maWcuc3RvcmFnZUtleSwgY29uZmlnLm1heFNlYXJjaGVzXSk7XHJcblxyXG4gIC8vIENhcmdhciBiw7pzcXVlZGFzIGFsIGluaWNpYWxpemFyXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGNvbnN0IGxvYWRlZCA9IGxvYWRGcm9tU3RvcmFnZSgpO1xyXG4gICAgc2V0UmVjZW50U2VhcmNoZXMobG9hZGVkKTtcclxuICB9LCBbbG9hZEZyb21TdG9yYWdlXSk7XHJcblxyXG4gIC8vIEFncmVnYXIgdW5hIG51ZXZhIGLDunNxdWVkYVxyXG4gIGNvbnN0IGFkZFNlYXJjaCA9IHVzZUNhbGxiYWNrKChzZWFyY2g6IHN0cmluZyk6IHZvaWQgPT4ge1xyXG4gICAgY29uc3Qgc2FuaXRpemVkID0gc2FuaXRpemVTZWFyY2goc2VhcmNoKTtcclxuICAgIGlmICghc2FuaXRpemVkIHx8IHNhbml0aXplZC5sZW5ndGggPCAyKSB7cmV0dXJuO31cclxuXHJcbiAgICBzZXRSZWNlbnRTZWFyY2hlcyhwcmV2ID0+IHtcclxuICAgICAgbGV0IHVwZGF0ZWQgPSBbLi4ucHJldl07XHJcblxyXG4gICAgICAvLyBSZW1vdmVyIGR1cGxpY2Fkb3Mgc2kgZXN0w6EgaGFiaWxpdGFkb1xyXG4gICAgICBpZiAoY29uZmlnLmZpbHRlckR1cGxpY2F0ZXMpIHtcclxuICAgICAgICB1cGRhdGVkID0gdXBkYXRlZC5maWx0ZXIocyA9PiBzYW5pdGl6ZVNlYXJjaChzKSAhPT0gc2FuaXRpemVkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQWdyZWdhciBhbCBwcmluY2lwaW9cclxuICAgICAgdXBkYXRlZC51bnNoaWZ0KHNlYXJjaC50cmltKCkpO1xyXG5cclxuICAgICAgLy8gTGltaXRhciBhbCBtw6F4aW1vIGNvbmZpZ3VyYWRvXHJcbiAgICAgIHVwZGF0ZWQgPSB1cGRhdGVkLnNsaWNlKDAsIGNvbmZpZy5tYXhTZWFyY2hlcyk7XHJcblxyXG4gICAgICAvLyBHdWFyZGFyIGVuIGxvY2FsU3RvcmFnZVxyXG4gICAgICBzYXZlVG9TdG9yYWdlKHVwZGF0ZWQpO1xyXG5cclxuICAgICAgcmV0dXJuIHVwZGF0ZWQ7XHJcbiAgICB9KTtcclxuICB9LCBbc2FuaXRpemVTZWFyY2gsIGNvbmZpZy5maWx0ZXJEdXBsaWNhdGVzLCBjb25maWcubWF4U2VhcmNoZXMsIHNhdmVUb1N0b3JhZ2VdKTtcclxuXHJcbiAgLy8gUmVtb3ZlciB1bmEgYsO6c3F1ZWRhIGVzcGVjw61maWNhXHJcbiAgY29uc3QgcmVtb3ZlU2VhcmNoID0gdXNlQ2FsbGJhY2soKHNlYXJjaDogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVNlYXJjaChzZWFyY2gpO1xyXG4gICAgXHJcbiAgICBzZXRSZWNlbnRTZWFyY2hlcyhwcmV2ID0+IHtcclxuICAgICAgY29uc3QgdXBkYXRlZCA9IHByZXYuZmlsdGVyKHMgPT4gc2FuaXRpemVTZWFyY2gocykgIT09IHNhbml0aXplZCk7XHJcbiAgICAgIHNhdmVUb1N0b3JhZ2UodXBkYXRlZCk7XHJcbiAgICAgIHJldHVybiB1cGRhdGVkO1xyXG4gICAgfSk7XHJcbiAgfSwgW3Nhbml0aXplU2VhcmNoLCBzYXZlVG9TdG9yYWdlXSk7XHJcblxyXG4gIC8vIExpbXBpYXIgdG9kYXMgbGFzIGLDunNxdWVkYXNcclxuICBjb25zdCBjbGVhclNlYXJjaGVzID0gdXNlQ2FsbGJhY2soKCk6IHZvaWQgPT4ge1xyXG4gICAgc2V0UmVjZW50U2VhcmNoZXMoW10pO1xyXG4gICAgc2F2ZVRvU3RvcmFnZShbXSk7XHJcbiAgfSwgW3NhdmVUb1N0b3JhZ2VdKTtcclxuXHJcbiAgLy8gVmVyaWZpY2FyIHNpIHVuYSBiw7pzcXVlZGEgZXhpc3RlXHJcbiAgY29uc3QgaGFzU2VhcmNoID0gdXNlQ2FsbGJhY2soKHNlYXJjaDogc3RyaW5nKTogYm9vbGVhbiA9PiB7XHJcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVNlYXJjaChzZWFyY2gpO1xyXG4gICAgcmV0dXJuIHJlY2VudFNlYXJjaGVzLnNvbWUocyA9PiBzYW5pdGl6ZVNlYXJjaChzKSA9PT0gc2FuaXRpemVkKTtcclxuICB9LCBbcmVjZW50U2VhcmNoZXMsIHNhbml0aXplU2VhcmNoXSk7XHJcblxyXG4gIC8vIE9idGVuZXIgbGFzIE4gYsO6c3F1ZWRhcyBtw6FzIHJlY2llbnRlc1xyXG4gIGNvbnN0IGdldFJlY2VudFNlYXJjaGVzID0gdXNlQ2FsbGJhY2soKGxpbWl0PzogbnVtYmVyKTogc3RyaW5nW10gPT4ge1xyXG4gICAgY29uc3QgYWN0dWFsTGltaXQgPSBsaW1pdCA/PyBjb25maWcubWF4U2VhcmNoZXM7XHJcbiAgICByZXR1cm4gcmVjZW50U2VhcmNoZXMuc2xpY2UoMCwgYWN0dWFsTGltaXQpO1xyXG4gIH0sIFtyZWNlbnRTZWFyY2hlcywgY29uZmlnLm1heFNlYXJjaGVzXSk7XHJcblxyXG4gIC8vIE1vdmVyIHVuYSBiw7pzcXVlZGEgYWwgcHJpbmNpcGlvIChyZW9yZGVuYXIpXHJcbiAgY29uc3QgbW92ZVRvVG9wID0gdXNlQ2FsbGJhY2soKHNlYXJjaDogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZVNlYXJjaChzZWFyY2gpO1xyXG4gICAgXHJcbiAgICBzZXRSZWNlbnRTZWFyY2hlcyhwcmV2ID0+IHtcclxuICAgICAgY29uc3QgZmlsdGVyZWQgPSBwcmV2LmZpbHRlcihzID0+IHNhbml0aXplU2VhcmNoKHMpICE9PSBzYW5pdGl6ZWQpO1xyXG4gICAgICBjb25zdCBleGlzdGluZyA9IHByZXYuZmluZChzID0+IHNhbml0aXplU2VhcmNoKHMpID09PSBzYW5pdGl6ZWQpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFleGlzdGluZykge3JldHVybiBwcmV2O31cclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHVwZGF0ZWQgPSBbZXhpc3RpbmcsIC4uLmZpbHRlcmVkXTtcclxuICAgICAgc2F2ZVRvU3RvcmFnZSh1cGRhdGVkKTtcclxuICAgICAgcmV0dXJuIHVwZGF0ZWQ7XHJcbiAgICB9KTtcclxuICB9LCBbc2FuaXRpemVTZWFyY2gsIHNhdmVUb1N0b3JhZ2VdKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHJlY2VudFNlYXJjaGVzLFxyXG4gICAgYWRkU2VhcmNoLFxyXG4gICAgcmVtb3ZlU2VhcmNoLFxyXG4gICAgY2xlYXJTZWFyY2hlcyxcclxuICAgIGhhc1NlYXJjaCxcclxuICAgIGdldFJlY2VudFNlYXJjaGVzLFxyXG4gICAgbW92ZVRvVG9wLFxyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBIb29rIHNpbXBsaWZpY2FkbyBwYXJhIHNvbG8gb2J0ZW5lciBiw7pzcXVlZGFzIHJlY2llbnRlc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHVzZVJlY2VudFNlYXJjaGVzU2ltcGxlKGxpbWl0OiBudW1iZXIgPSA1KTogc3RyaW5nW10ge1xyXG4gIGNvbnN0IHsgZ2V0UmVjZW50U2VhcmNoZXMgfSA9IHVzZVJlY2VudFNlYXJjaGVzKHsgbWF4U2VhcmNoZXM6IGxpbWl0IH0pO1xyXG4gIHJldHVybiBnZXRSZWNlbnRTZWFyY2hlcygpO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB1c2VSZWNlbnRTZWFyY2hlcztcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbInVzZVJlY2VudFNlYXJjaGVzIiwidXNlUmVjZW50U2VhcmNoZXNTaW1wbGUiLCJERUZBVUxUX09QVElPTlMiLCJtYXhTZWFyY2hlcyIsInN0b3JhZ2VLZXkiLCJlbmFibGVQZXJzaXN0ZW5jZSIsImZpbHRlckR1cGxpY2F0ZXMiLCJleHBpcmF0aW9uRGF5cyIsIm9wdGlvbnMiLCJjb25maWciLCJyZWNlbnRTZWFyY2hlcyIsInNldFJlY2VudFNlYXJjaGVzIiwidXNlU3RhdGUiLCJzYW5pdGl6ZVNlYXJjaCIsInVzZUNhbGxiYWNrIiwic2VhcmNoIiwidHJpbSIsInRvTG93ZXJDYXNlIiwiaXNFeHBpcmVkIiwidGltZXN0YW1wIiwibWF4QWdlIiwiRGF0ZSIsIm5vdyIsImxvYWRGcm9tU3RvcmFnZSIsInJlc3VsdCIsInNhZmVMb2NhbFN0b3JhZ2VHZXQiLCJzdWNjZXNzIiwiZGF0YSIsIkFycmF5IiwiaXNBcnJheSIsInNlYXJjaGVzIiwicGVyc2lzdGVkRGF0YSIsInNhZmVMb2NhbFN0b3JhZ2VTZXQiLCJ2ZXJzaW9uIiwic2xpY2UiLCJzYXZlVG9TdG9yYWdlIiwid2luZG93IiwibGVuZ3RoIiwibG9jYWxTdG9yYWdlIiwicmVtb3ZlSXRlbSIsImRhdGFUb1N0b3JlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnJvciIsImNvbnNvbGUiLCJ3YXJuIiwidXNlRWZmZWN0IiwibG9hZGVkIiwiYWRkU2VhcmNoIiwic2FuaXRpemVkIiwicHJldiIsInVwZGF0ZWQiLCJmaWx0ZXIiLCJzIiwidW5zaGlmdCIsInJlbW92ZVNlYXJjaCIsImNsZWFyU2VhcmNoZXMiLCJoYXNTZWFyY2giLCJzb21lIiwiZ2V0UmVjZW50U2VhcmNoZXMiLCJsaW1pdCIsImFjdHVhbExpbWl0IiwibW92ZVRvVG9wIiwiZmlsdGVyZWQiLCJleGlzdGluZyIsImZpbmQiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0Qyw0RUFBNEU7QUFDNUUsc0NBQXNDOzs7Ozs7Ozs7Ozs7UUE0T3RDO2VBQUE7O1FBakxnQkE7ZUFBQUE7O1FBNEtBQztlQUFBQTs7O3VCQXJPaUM7MkJBQ3NCO0FBc0N2RSxNQUFNQyxrQkFBbUQ7SUFDdkRDLGFBQWE7SUFDYkMsWUFBWTtJQUNaQyxtQkFBbUI7SUFDbkJDLGtCQUFrQjtJQUNsQkMsZ0JBQWdCO0FBQ2xCO0FBWU8sU0FBU1Asa0JBQWtCUSxVQUFpQyxDQUFDLENBQUM7SUFDbkUsTUFBTUMsU0FBUztRQUFFLEdBQUdQLGVBQWU7UUFBRSxHQUFHTSxPQUFPO0lBQUM7SUFDaEQsTUFBTSxDQUFDRSxnQkFBZ0JDLGtCQUFrQixHQUFHQyxJQUFBQSxlQUFRLEVBQVcsRUFBRTtJQUVqRSw4Q0FBOEM7SUFDOUMsTUFBTUMsaUJBQWlCQyxJQUFBQSxrQkFBVyxFQUFDLENBQUNDO1FBQ2xDLE9BQU9BLE9BQU9DLElBQUksR0FBR0MsV0FBVztJQUNsQyxHQUFHLEVBQUU7SUFFTCxtREFBbUQ7SUFDbkQsTUFBTUMsWUFBWUosSUFBQUEsa0JBQVcsRUFBQyxDQUFDSztRQUM3QixJQUFJVixPQUFPRixjQUFjLEtBQUssR0FBRztZQUFDLE9BQU87UUFBTTtRQUMvQyxNQUFNYSxTQUFTWCxPQUFPRixjQUFjLEdBQUcsS0FBSyxLQUFLLEtBQUs7UUFDdEQsT0FBT2MsS0FBS0MsR0FBRyxLQUFLSCxZQUFZQztJQUNsQyxHQUFHO1FBQUNYLE9BQU9GLGNBQWM7S0FBQztJQUUxQixzQ0FBc0M7SUFDdEMsTUFBTWdCLGtCQUFrQlQsSUFBQUEsa0JBQVcsRUFBQztRQUNsQyxJQUFJLENBQUNMLE9BQU9KLGlCQUFpQixFQUFFO1lBQzdCLE9BQU8sRUFBRTtRQUNYO1FBRUEsc0RBQXNEO1FBQ3RELE1BQU1tQixTQUFTQyxJQUFBQSw4QkFBbUIsRUFBaUNoQixPQUFPTCxVQUFVO1FBRXBGLElBQUksQ0FBQ29CLE9BQU9FLE9BQU8sRUFBRTtZQUNuQixPQUFPLEVBQUU7UUFDWDtRQUVBLE1BQU1DLE9BQU9ILE9BQU9HLElBQUk7UUFFeEIsK0NBQStDO1FBQy9DLElBQUlBLFFBQVEsT0FBT0EsU0FBUyxZQUFZLGNBQWNBLFFBQVFDLE1BQU1DLE9BQU8sQ0FBQ0YsS0FBS0csUUFBUSxHQUFHO1lBQzFGLE1BQU1DLGdCQUFnQko7WUFFdEIsdUJBQXVCO1lBQ3ZCLElBQUlJLGNBQWNaLFNBQVMsSUFBSUQsVUFBVWEsY0FBY1osU0FBUyxHQUFHO2dCQUNqRSxpREFBaUQ7Z0JBQ2pEYSxJQUFBQSw4QkFBbUIsRUFBQ3ZCLE9BQU9MLFVBQVUsRUFBRTtvQkFDckMwQixVQUFVLEVBQUU7b0JBQ1pYLFdBQVdFLEtBQUtDLEdBQUc7b0JBQ25CVyxTQUFTO2dCQUNYO2dCQUNBLE9BQU8sRUFBRTtZQUNYO1lBRUEsT0FBT0YsY0FBY0QsUUFBUSxDQUFDSSxLQUFLLENBQUMsR0FBR3pCLE9BQU9OLFdBQVc7UUFDM0Q7UUFFQSxpQ0FBaUM7UUFDakMsSUFBSXlCLE1BQU1DLE9BQU8sQ0FBQ0YsT0FBTztZQUN2QixPQUFPQSxLQUFLTyxLQUFLLENBQUMsR0FBR3pCLE9BQU9OLFdBQVc7UUFDekM7UUFFQSxPQUFPLEVBQUU7SUFDWCxHQUFHO1FBQUNNLE9BQU9KLGlCQUFpQjtRQUFFSSxPQUFPTCxVQUFVO1FBQUVLLE9BQU9OLFdBQVc7UUFBRWU7S0FBVTtJQUUvRSxvQ0FBb0M7SUFDcEMsTUFBTWlCLGdCQUFnQnJCLElBQUFBLGtCQUFXLEVBQUMsQ0FBQ2dCO1FBQ2pDLElBQUksQ0FBQ3JCLE9BQU9KLGlCQUFpQixJQUFJLE9BQU8rQixXQUFXLGFBQWE7WUFDOUQ7UUFDRjtRQUVBLElBQUk7WUFDRixJQUFJTixTQUFTTyxNQUFNLEtBQUssR0FBRztnQkFDekJDLGFBQWFDLFVBQVUsQ0FBQzlCLE9BQU9MLFVBQVU7Z0JBQ3pDO1lBQ0Y7WUFFQSxNQUFNb0MsY0FBbUM7Z0JBQ3ZDVixVQUFVQSxTQUFTSSxLQUFLLENBQUMsR0FBR3pCLE9BQU9OLFdBQVc7Z0JBQzlDZ0IsV0FBV0UsS0FBS0MsR0FBRztnQkFDbkJXLFNBQVM7WUFDWDtZQUVBSyxhQUFhRyxPQUFPLENBQUNoQyxPQUFPTCxVQUFVLEVBQUVzQyxLQUFLQyxTQUFTLENBQUNIO1FBQ3pELEVBQUUsT0FBT0ksT0FBTztZQUNkQyxRQUFRQyxJQUFJLENBQUMsaURBQWlERjtRQUNoRTtJQUNGLEdBQUc7UUFBQ25DLE9BQU9KLGlCQUFpQjtRQUFFSSxPQUFPTCxVQUFVO1FBQUVLLE9BQU9OLFdBQVc7S0FBQztJQUVwRSxrQ0FBa0M7SUFDbEM0QyxJQUFBQSxnQkFBUyxFQUFDO1FBQ1IsTUFBTUMsU0FBU3pCO1FBQ2ZaLGtCQUFrQnFDO0lBQ3BCLEdBQUc7UUFBQ3pCO0tBQWdCO0lBRXBCLDZCQUE2QjtJQUM3QixNQUFNMEIsWUFBWW5DLElBQUFBLGtCQUFXLEVBQUMsQ0FBQ0M7UUFDN0IsTUFBTW1DLFlBQVlyQyxlQUFlRTtRQUNqQyxJQUFJLENBQUNtQyxhQUFhQSxVQUFVYixNQUFNLEdBQUcsR0FBRztZQUFDO1FBQU87UUFFaEQxQixrQkFBa0J3QyxDQUFBQTtZQUNoQixJQUFJQyxVQUFVO21CQUFJRDthQUFLO1lBRXZCLHdDQUF3QztZQUN4QyxJQUFJMUMsT0FBT0gsZ0JBQWdCLEVBQUU7Z0JBQzNCOEMsVUFBVUEsUUFBUUMsTUFBTSxDQUFDQyxDQUFBQSxJQUFLekMsZUFBZXlDLE9BQU9KO1lBQ3REO1lBRUEsdUJBQXVCO1lBQ3ZCRSxRQUFRRyxPQUFPLENBQUN4QyxPQUFPQyxJQUFJO1lBRTNCLGdDQUFnQztZQUNoQ29DLFVBQVVBLFFBQVFsQixLQUFLLENBQUMsR0FBR3pCLE9BQU9OLFdBQVc7WUFFN0MsMEJBQTBCO1lBQzFCZ0MsY0FBY2lCO1lBRWQsT0FBT0E7UUFDVDtJQUNGLEdBQUc7UUFBQ3ZDO1FBQWdCSixPQUFPSCxnQkFBZ0I7UUFBRUcsT0FBT04sV0FBVztRQUFFZ0M7S0FBYztJQUUvRSxrQ0FBa0M7SUFDbEMsTUFBTXFCLGVBQWUxQyxJQUFBQSxrQkFBVyxFQUFDLENBQUNDO1FBQ2hDLE1BQU1tQyxZQUFZckMsZUFBZUU7UUFFakNKLGtCQUFrQndDLENBQUFBO1lBQ2hCLE1BQU1DLFVBQVVELEtBQUtFLE1BQU0sQ0FBQ0MsQ0FBQUEsSUFBS3pDLGVBQWV5QyxPQUFPSjtZQUN2RGYsY0FBY2lCO1lBQ2QsT0FBT0E7UUFDVDtJQUNGLEdBQUc7UUFBQ3ZDO1FBQWdCc0I7S0FBYztJQUVsQyw4QkFBOEI7SUFDOUIsTUFBTXNCLGdCQUFnQjNDLElBQUFBLGtCQUFXLEVBQUM7UUFDaENILGtCQUFrQixFQUFFO1FBQ3BCd0IsY0FBYyxFQUFFO0lBQ2xCLEdBQUc7UUFBQ0E7S0FBYztJQUVsQixtQ0FBbUM7SUFDbkMsTUFBTXVCLFlBQVk1QyxJQUFBQSxrQkFBVyxFQUFDLENBQUNDO1FBQzdCLE1BQU1tQyxZQUFZckMsZUFBZUU7UUFDakMsT0FBT0wsZUFBZWlELElBQUksQ0FBQ0wsQ0FBQUEsSUFBS3pDLGVBQWV5QyxPQUFPSjtJQUN4RCxHQUFHO1FBQUN4QztRQUFnQkc7S0FBZTtJQUVuQyx3Q0FBd0M7SUFDeEMsTUFBTStDLG9CQUFvQjlDLElBQUFBLGtCQUFXLEVBQUMsQ0FBQytDO1FBQ3JDLE1BQU1DLGNBQWNELFNBQVNwRCxPQUFPTixXQUFXO1FBQy9DLE9BQU9PLGVBQWV3QixLQUFLLENBQUMsR0FBRzRCO0lBQ2pDLEdBQUc7UUFBQ3BEO1FBQWdCRCxPQUFPTixXQUFXO0tBQUM7SUFFdkMsOENBQThDO0lBQzlDLE1BQU00RCxZQUFZakQsSUFBQUEsa0JBQVcsRUFBQyxDQUFDQztRQUM3QixNQUFNbUMsWUFBWXJDLGVBQWVFO1FBRWpDSixrQkFBa0J3QyxDQUFBQTtZQUNoQixNQUFNYSxXQUFXYixLQUFLRSxNQUFNLENBQUNDLENBQUFBLElBQUt6QyxlQUFleUMsT0FBT0o7WUFDeEQsTUFBTWUsV0FBV2QsS0FBS2UsSUFBSSxDQUFDWixDQUFBQSxJQUFLekMsZUFBZXlDLE9BQU9KO1lBRXRELElBQUksQ0FBQ2UsVUFBVTtnQkFBQyxPQUFPZDtZQUFLO1lBRTVCLE1BQU1DLFVBQVU7Z0JBQUNhO21CQUFhRDthQUFTO1lBQ3ZDN0IsY0FBY2lCO1lBQ2QsT0FBT0E7UUFDVDtJQUNGLEdBQUc7UUFBQ3ZDO1FBQWdCc0I7S0FBYztJQUVsQyxPQUFPO1FBQ0x6QjtRQUNBdUM7UUFDQU87UUFDQUM7UUFDQUM7UUFDQUU7UUFDQUc7SUFDRjtBQUNGO0FBS08sU0FBUzlELHdCQUF3QjRELFFBQWdCLENBQUM7SUFDdkQsTUFBTSxFQUFFRCxpQkFBaUIsRUFBRSxHQUFHNUQsa0JBQWtCO1FBQUVHLGFBQWEwRDtJQUFNO0lBQ3JFLE9BQU9EO0FBQ1Q7TUFFQSxXQUFlNUQifQ==