{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\useCartWithBackend.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - HOOK DE CARRITO CON BACKEND\r\n// ===================================\r\n// Hook optimizado que conecta el carrito frontend con las APIs del backend\r\n\r\n'use client';\r\n\r\nimport { useCallback, useEffect, useState } from 'react';\r\nimport { useSession } from 'next-auth/react';\r\nimport { toast } from 'sonner';\r\n\r\n// Tipos para el carrito\r\ninterface CartProduct {\r\n  id: number;\r\n  name: string;\r\n  price: number;\r\n  discounted_price?: number;\r\n  images?: any;\r\n  stock: number;\r\n  brand?: string;\r\n  category?: {\r\n    id: number;\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface CartItem {\r\n  id: string;\r\n  user_id: string;\r\n  product_id: number;\r\n  quantity: number;\r\n  created_at: string;\r\n  updated_at: string;\r\n  products: CartProduct;\r\n}\r\n\r\ninterface CartState {\r\n  items: CartItem[];\r\n  totalItems: number;\r\n  totalAmount: number;\r\n  itemCount: number;\r\n  loading: boolean;\r\n  error: string | null;\r\n}\r\n\r\ninterface UseCartWithBackendReturn extends CartState {\r\n  addItem: (productId: number, quantity?: number) => Promise<boolean>;\r\n  removeItem: (productId: number, quantity?: number) => Promise<boolean>;\r\n  updateQuantity: (productId: number, quantity: number) => Promise<boolean>;\r\n  clearCart: () => Promise<boolean>;\r\n  loadCart: () => Promise<void>;\r\n  getItemQuantity: (productId: number) => number;\r\n  isInCart: (productId: number) => boolean;\r\n  refreshCart: () => Promise<void>;\r\n}\r\n\r\n/**\r\n * Hook para manejar el carrito con integración completa al backend\r\n */\r\nexport const useCartWithBackend = (): UseCartWithBackendReturn => {\r\n  const { data: session, status } = useSession();\r\n  const [cartState, setCartState] = useState<CartState>({\r\n    items: [],\r\n    totalItems: 0,\r\n    totalAmount: 0,\r\n    itemCount: 0,\r\n    loading: false,\r\n    error: null\r\n  });\r\n\r\n  // Función para hacer requests a la API\r\n  const apiRequest = useCallback(async (url: string, options: RequestInit = {}) => {\r\n    try {\r\n      const response = await fetch(url, {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          ...options.headers\r\n        },\r\n        ...options\r\n      });\r\n\r\n      // Verificar si la respuesta tiene contenido antes de parsear JSON\r\n      const text = await response.text();\r\n      let data = null;\r\n      \r\n      if (text.trim()) {\r\n        try {\r\n          data = JSON.parse(text);\r\n        } catch (parseError) {\r\n          console.error(`JSON Parse Error (${url}):`, parseError);\r\n          console.error('Raw response:', text);\r\n          throw new Error(`Invalid JSON response: ${parseError.message}`);\r\n        }\r\n      }\r\n      \r\n      if (!response.ok) {\r\n        // Si es 401 (Unauthorized), es un caso esperado, no un error\r\n        if (response.status === 401) {\r\n          return data; // Devolver la respuesta tal como está\r\n        }\r\n        throw new Error(data?.error || `HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      return data;\r\n    } catch (error: any) {\r\n      console.error(`API Error (${url}):`, error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  // Cargar carrito desde el backend\r\n  const loadCart = useCallback(async () => {\r\n    if (status === 'loading') {return;}\r\n    \r\n    if (!session?.user) {\r\n      // Usuario no autenticado - carrito vacío\r\n      setCartState(prev => ({\r\n        ...prev,\r\n        items: [],\r\n        totalItems: 0,\r\n        totalAmount: 0,\r\n        itemCount: 0,\r\n        loading: false,\r\n        error: null\r\n      }));\r\n      return;\r\n    }\r\n\r\n    setCartState(prev => ({ ...prev, loading: true, error: null }));\r\n\r\n    try {\r\n      const data = await apiRequest('/api/cart');\r\n      \r\n      // Si la respuesta indica que no hay autenticación, manejar como carrito vacío\r\n      if (!data.success && data.error === 'Usuario no autenticado') {\r\n        setCartState(prev => ({\r\n          ...prev,\r\n          items: [],\r\n          totalItems: 0,\r\n          totalAmount: 0,\r\n          itemCount: 0,\r\n          loading: false,\r\n          error: null\r\n        }));\r\n        return;\r\n      }\r\n      \r\n      setCartState(prev => ({\r\n        ...prev,\r\n        items: data.items || [],\r\n        totalItems: data.totalItems || 0,\r\n        totalAmount: data.totalAmount || 0,\r\n        itemCount: data.itemCount || 0,\r\n        loading: false,\r\n        error: null\r\n      }));\r\n\r\n      console.log('✅ Carrito cargado:', data.itemCount, 'productos únicos');\r\n    } catch (error: any) {\r\n      console.error('❌ Error cargando carrito:', error);\r\n      setCartState(prev => ({\r\n        ...prev,\r\n        loading: false,\r\n        error: error.message || 'Error cargando carrito'\r\n      }));\r\n    }\r\n  }, [session, status, apiRequest]);\r\n\r\n  // Agregar item al carrito\r\n  const addItem = useCallback(async (productId: number, quantity: number = 1): Promise<boolean> => {\r\n    if (!session?.user) {\r\n      toast.error('Debes iniciar sesión para agregar productos al carrito');\r\n      return false;\r\n    }\r\n\r\n    setCartState(prev => ({ ...prev, loading: true, error: null }));\r\n\r\n    try {\r\n      const data = await apiRequest('/api/cart/add', {\r\n        method: 'POST',\r\n        body: JSON.stringify({ productId, quantity })\r\n      });\r\n\r\n      if (data.success) {\r\n        // Recargar carrito para obtener estado actualizado\r\n        await loadCart();\r\n        \r\n        toast.success(data.message || 'Producto agregado al carrito');\r\n        console.log('✅ Producto agregado:', data.item?.productName);\r\n        return true;\r\n      } else {\r\n        throw new Error(data.error || 'Error agregando producto');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('❌ Error agregando al carrito:', error);\r\n      setCartState(prev => ({ ...prev, loading: false, error: error.message }));\r\n      \r\n      if (error.message.includes('Stock insuficiente')) {\r\n        toast.error(error.message);\r\n      } else if (error.message.includes('autenticado')) {\r\n        toast.error('Debes iniciar sesión para agregar productos');\r\n      } else {\r\n        toast.error('Error agregando producto al carrito');\r\n      }\r\n      \r\n      return false;\r\n    }\r\n  }, [session, apiRequest, loadCart]);\r\n\r\n  // Remover item del carrito\r\n  const removeItem = useCallback(async (productId: number, quantity?: number): Promise<boolean> => {\r\n    if (!session?.user) {\r\n      toast.error('Debes iniciar sesión');\r\n      return false;\r\n    }\r\n\r\n    setCartState(prev => ({ ...prev, loading: true, error: null }));\r\n\r\n    try {\r\n      const data = await apiRequest('/api/cart/remove', {\r\n        method: 'DELETE',\r\n        body: JSON.stringify({ productId, quantity })\r\n      });\r\n\r\n      if (data.success) {\r\n        await loadCart();\r\n        toast.success(data.message || 'Producto removido del carrito');\r\n        console.log('✅ Producto removido:', data.item?.productName);\r\n        return true;\r\n      } else {\r\n        throw new Error(data.error || 'Error removiendo producto');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('❌ Error removiendo del carrito:', error);\r\n      setCartState(prev => ({ ...prev, loading: false, error: error.message }));\r\n      toast.error('Error removiendo producto del carrito');\r\n      return false;\r\n    }\r\n  }, [session, apiRequest, loadCart]);\r\n\r\n  // Actualizar cantidad de un item\r\n  const updateQuantity = useCallback(async (productId: number, quantity: number): Promise<boolean> => {\r\n    if (!session?.user) {\r\n      toast.error('Debes iniciar sesión');\r\n      return false;\r\n    }\r\n\r\n    setCartState(prev => ({ ...prev, loading: true, error: null }));\r\n\r\n    try {\r\n      const data = await apiRequest('/api/cart/update', {\r\n        method: 'PUT',\r\n        body: JSON.stringify({ productId, quantity })\r\n      });\r\n\r\n      if (data.success) {\r\n        await loadCart();\r\n        toast.success(data.message || 'Cantidad actualizada');\r\n        console.log('✅ Cantidad actualizada:', data.item?.productName);\r\n        return true;\r\n      } else {\r\n        throw new Error(data.error || 'Error actualizando cantidad');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('❌ Error actualizando cantidad:', error);\r\n      setCartState(prev => ({ ...prev, loading: false, error: error.message }));\r\n      toast.error('Error actualizando cantidad');\r\n      return false;\r\n    }\r\n  }, [session, apiRequest, loadCart]);\r\n\r\n  // Limpiar carrito completo\r\n  const clearCart = useCallback(async (): Promise<boolean> => {\r\n    if (!session?.user) {\r\n      toast.error('Debes iniciar sesión');\r\n      return false;\r\n    }\r\n\r\n    setCartState(prev => ({ ...prev, loading: true, error: null }));\r\n\r\n    try {\r\n      const data = await apiRequest('/api/cart', {\r\n        method: 'DELETE'\r\n      });\r\n\r\n      if (data.success) {\r\n        await loadCart();\r\n        toast.success('Carrito limpiado');\r\n        console.log('✅ Carrito limpiado');\r\n        return true;\r\n      } else {\r\n        throw new Error(data.error || 'Error limpiando carrito');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('❌ Error limpiando carrito:', error);\r\n      setCartState(prev => ({ ...prev, loading: false, error: error.message }));\r\n      toast.error('Error limpiando carrito');\r\n      return false;\r\n    }\r\n  }, [session, apiRequest, loadCart]);\r\n\r\n  // Obtener cantidad de un producto específico en el carrito\r\n  const getItemQuantity = useCallback((productId: number): number => {\r\n    const item = cartState.items.find(item => item.product_id === productId);\r\n    return item?.quantity || 0;\r\n  }, [cartState.items]);\r\n\r\n  // Verificar si un producto está en el carrito\r\n  const isInCart = useCallback((productId: number): boolean => {\r\n    return cartState.items.some(item => item.product_id === productId);\r\n  }, [cartState.items]);\r\n\r\n  // Refrescar carrito (alias para loadCart)\r\n  const refreshCart = useCallback(async () => {\r\n    await loadCart();\r\n  }, [loadCart]);\r\n\r\n  // Cargar carrito al montar el componente o cuando cambie la sesión\r\n  useEffect(() => {\r\n    loadCart();\r\n  }, [loadCart]);\r\n\r\n  return {\r\n    ...cartState,\r\n    addItem,\r\n    removeItem,\r\n    updateQuantity,\r\n    clearCart,\r\n    loadCart,\r\n    getItemQuantity,\r\n    isInCart,\r\n    refreshCart\r\n  };\r\n};\r\n\r\nexport default useCartWithBackend;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["useCartWithBackend","data","session","status","useSession","cartState","setCartState","useState","items","totalItems","totalAmount","itemCount","loading","error","apiRequest","useCallback","url","options","response","fetch","headers","text","trim","JSON","parse","parseError","console","Error","message","ok","statusText","loadCart","user","prev","success","log","addItem","productId","quantity","toast","method","body","stringify","item","productName","includes","removeItem","updateQuantity","clearCart","getItemQuantity","find","product_id","isInCart","some","refreshCart","useEffect"],"mappings":"AAAA,sCAAsC;AACtC,mDAAmD;AACnD,sCAAsC;AACtC,2EAA2E;AAE3E;;;;;;;;;;;;QA0UA;eAAA;;QApRaA;eAAAA;;;uBApDoC;wBACtB;wBACL;AAkDf,MAAMA,qBAAqB;IAChC,MAAM,EAAEC,MAAMC,OAAO,EAAEC,MAAM,EAAE,GAAGC,IAAAA,kBAAU;IAC5C,MAAM,CAACC,WAAWC,aAAa,GAAGC,IAAAA,eAAQ,EAAY;QACpDC,OAAO,EAAE;QACTC,YAAY;QACZC,aAAa;QACbC,WAAW;QACXC,SAAS;QACTC,OAAO;IACT;IAEA,uCAAuC;IACvC,MAAMC,aAAaC,IAAAA,kBAAW,EAAC,OAAOC,KAAaC,UAAuB,CAAC,CAAC;QAC1E,IAAI;YACF,MAAMC,WAAW,MAAMC,MAAMH,KAAK;gBAChCI,SAAS;oBACP,gBAAgB;oBAChB,GAAGH,QAAQG,OAAO;gBACpB;gBACA,GAAGH,OAAO;YACZ;YAEA,kEAAkE;YAClE,MAAMI,OAAO,MAAMH,SAASG,IAAI;YAChC,IAAIpB,OAAO;YAEX,IAAIoB,KAAKC,IAAI,IAAI;gBACf,IAAI;oBACFrB,OAAOsB,KAAKC,KAAK,CAACH;gBACpB,EAAE,OAAOI,YAAY;oBACnBC,QAAQb,KAAK,CAAC,CAAC,kBAAkB,EAAEG,IAAI,EAAE,CAAC,EAAES;oBAC5CC,QAAQb,KAAK,CAAC,iBAAiBQ;oBAC/B,MAAM,IAAIM,MAAM,CAAC,uBAAuB,EAAEF,WAAWG,OAAO,EAAE;gBAChE;YACF;YAEA,IAAI,CAACV,SAASW,EAAE,EAAE;gBAChB,6DAA6D;gBAC7D,IAAIX,SAASf,MAAM,KAAK,KAAK;oBAC3B,OAAOF,MAAM,sCAAsC;gBACrD;gBACA,MAAM,IAAI0B,MAAM1B,MAAMY,SAAS,CAAC,KAAK,EAAEK,SAASf,MAAM,CAAC,EAAE,EAAEe,SAASY,UAAU,EAAE;YAClF;YAEA,OAAO7B;QACT,EAAE,OAAOY,OAAY;YACnBa,QAAQb,KAAK,CAAC,CAAC,WAAW,EAAEG,IAAI,EAAE,CAAC,EAAEH;YACrC,MAAMA;QACR;IACF,GAAG,EAAE;IAEL,kCAAkC;IAClC,MAAMkB,WAAWhB,IAAAA,kBAAW,EAAC;QAC3B,IAAIZ,WAAW,WAAW;YAAC;QAAO;QAElC,IAAI,CAACD,SAAS8B,MAAM;YAClB,yCAAyC;YACzC1B,aAAa2B,CAAAA,OAAS,CAAA;oBACpB,GAAGA,IAAI;oBACPzB,OAAO,EAAE;oBACTC,YAAY;oBACZC,aAAa;oBACbC,WAAW;oBACXC,SAAS;oBACTC,OAAO;gBACT,CAAA;YACA;QACF;QAEAP,aAAa2B,CAAAA,OAAS,CAAA;gBAAE,GAAGA,IAAI;gBAAErB,SAAS;gBAAMC,OAAO;YAAK,CAAA;QAE5D,IAAI;YACF,MAAMZ,OAAO,MAAMa,WAAW;YAE9B,8EAA8E;YAC9E,IAAI,CAACb,KAAKiC,OAAO,IAAIjC,KAAKY,KAAK,KAAK,0BAA0B;gBAC5DP,aAAa2B,CAAAA,OAAS,CAAA;wBACpB,GAAGA,IAAI;wBACPzB,OAAO,EAAE;wBACTC,YAAY;wBACZC,aAAa;wBACbC,WAAW;wBACXC,SAAS;wBACTC,OAAO;oBACT,CAAA;gBACA;YACF;YAEAP,aAAa2B,CAAAA,OAAS,CAAA;oBACpB,GAAGA,IAAI;oBACPzB,OAAOP,KAAKO,KAAK,IAAI,EAAE;oBACvBC,YAAYR,KAAKQ,UAAU,IAAI;oBAC/BC,aAAaT,KAAKS,WAAW,IAAI;oBACjCC,WAAWV,KAAKU,SAAS,IAAI;oBAC7BC,SAAS;oBACTC,OAAO;gBACT,CAAA;YAEAa,QAAQS,GAAG,CAAC,sBAAsBlC,KAAKU,SAAS,EAAE;QACpD,EAAE,OAAOE,OAAY;YACnBa,QAAQb,KAAK,CAAC,6BAA6BA;YAC3CP,aAAa2B,CAAAA,OAAS,CAAA;oBACpB,GAAGA,IAAI;oBACPrB,SAAS;oBACTC,OAAOA,MAAMe,OAAO,IAAI;gBAC1B,CAAA;QACF;IACF,GAAG;QAAC1B;QAASC;QAAQW;KAAW;IAEhC,0BAA0B;IAC1B,MAAMsB,UAAUrB,IAAAA,kBAAW,EAAC,OAAOsB,WAAmBC,WAAmB,CAAC;QACxE,IAAI,CAACpC,SAAS8B,MAAM;YAClBO,aAAK,CAAC1B,KAAK,CAAC;YACZ,OAAO;QACT;QAEAP,aAAa2B,CAAAA,OAAS,CAAA;gBAAE,GAAGA,IAAI;gBAAErB,SAAS;gBAAMC,OAAO;YAAK,CAAA;QAE5D,IAAI;YACF,MAAMZ,OAAO,MAAMa,WAAW,iBAAiB;gBAC7C0B,QAAQ;gBACRC,MAAMlB,KAAKmB,SAAS,CAAC;oBAAEL;oBAAWC;gBAAS;YAC7C;YAEA,IAAIrC,KAAKiC,OAAO,EAAE;gBAChB,mDAAmD;gBACnD,MAAMH;gBAENQ,aAAK,CAACL,OAAO,CAACjC,KAAK2B,OAAO,IAAI;gBAC9BF,QAAQS,GAAG,CAAC,wBAAwBlC,KAAK0C,IAAI,EAAEC;gBAC/C,OAAO;YACT,OAAO;gBACL,MAAM,IAAIjB,MAAM1B,KAAKY,KAAK,IAAI;YAChC;QACF,EAAE,OAAOA,OAAY;YACnBa,QAAQb,KAAK,CAAC,iCAAiCA;YAC/CP,aAAa2B,CAAAA,OAAS,CAAA;oBAAE,GAAGA,IAAI;oBAAErB,SAAS;oBAAOC,OAAOA,MAAMe,OAAO;gBAAC,CAAA;YAEtE,IAAIf,MAAMe,OAAO,CAACiB,QAAQ,CAAC,uBAAuB;gBAChDN,aAAK,CAAC1B,KAAK,CAACA,MAAMe,OAAO;YAC3B,OAAO,IAAIf,MAAMe,OAAO,CAACiB,QAAQ,CAAC,gBAAgB;gBAChDN,aAAK,CAAC1B,KAAK,CAAC;YACd,OAAO;gBACL0B,aAAK,CAAC1B,KAAK,CAAC;YACd;YAEA,OAAO;QACT;IACF,GAAG;QAACX;QAASY;QAAYiB;KAAS;IAElC,2BAA2B;IAC3B,MAAMe,aAAa/B,IAAAA,kBAAW,EAAC,OAAOsB,WAAmBC;QACvD,IAAI,CAACpC,SAAS8B,MAAM;YAClBO,aAAK,CAAC1B,KAAK,CAAC;YACZ,OAAO;QACT;QAEAP,aAAa2B,CAAAA,OAAS,CAAA;gBAAE,GAAGA,IAAI;gBAAErB,SAAS;gBAAMC,OAAO;YAAK,CAAA;QAE5D,IAAI;YACF,MAAMZ,OAAO,MAAMa,WAAW,oBAAoB;gBAChD0B,QAAQ;gBACRC,MAAMlB,KAAKmB,SAAS,CAAC;oBAAEL;oBAAWC;gBAAS;YAC7C;YAEA,IAAIrC,KAAKiC,OAAO,EAAE;gBAChB,MAAMH;gBACNQ,aAAK,CAACL,OAAO,CAACjC,KAAK2B,OAAO,IAAI;gBAC9BF,QAAQS,GAAG,CAAC,wBAAwBlC,KAAK0C,IAAI,EAAEC;gBAC/C,OAAO;YACT,OAAO;gBACL,MAAM,IAAIjB,MAAM1B,KAAKY,KAAK,IAAI;YAChC;QACF,EAAE,OAAOA,OAAY;YACnBa,QAAQb,KAAK,CAAC,mCAAmCA;YACjDP,aAAa2B,CAAAA,OAAS,CAAA;oBAAE,GAAGA,IAAI;oBAAErB,SAAS;oBAAOC,OAAOA,MAAMe,OAAO;gBAAC,CAAA;YACtEW,aAAK,CAAC1B,KAAK,CAAC;YACZ,OAAO;QACT;IACF,GAAG;QAACX;QAASY;QAAYiB;KAAS;IAElC,iCAAiC;IACjC,MAAMgB,iBAAiBhC,IAAAA,kBAAW,EAAC,OAAOsB,WAAmBC;QAC3D,IAAI,CAACpC,SAAS8B,MAAM;YAClBO,aAAK,CAAC1B,KAAK,CAAC;YACZ,OAAO;QACT;QAEAP,aAAa2B,CAAAA,OAAS,CAAA;gBAAE,GAAGA,IAAI;gBAAErB,SAAS;gBAAMC,OAAO;YAAK,CAAA;QAE5D,IAAI;YACF,MAAMZ,OAAO,MAAMa,WAAW,oBAAoB;gBAChD0B,QAAQ;gBACRC,MAAMlB,KAAKmB,SAAS,CAAC;oBAAEL;oBAAWC;gBAAS;YAC7C;YAEA,IAAIrC,KAAKiC,OAAO,EAAE;gBAChB,MAAMH;gBACNQ,aAAK,CAACL,OAAO,CAACjC,KAAK2B,OAAO,IAAI;gBAC9BF,QAAQS,GAAG,CAAC,2BAA2BlC,KAAK0C,IAAI,EAAEC;gBAClD,OAAO;YACT,OAAO;gBACL,MAAM,IAAIjB,MAAM1B,KAAKY,KAAK,IAAI;YAChC;QACF,EAAE,OAAOA,OAAY;YACnBa,QAAQb,KAAK,CAAC,kCAAkCA;YAChDP,aAAa2B,CAAAA,OAAS,CAAA;oBAAE,GAAGA,IAAI;oBAAErB,SAAS;oBAAOC,OAAOA,MAAMe,OAAO;gBAAC,CAAA;YACtEW,aAAK,CAAC1B,KAAK,CAAC;YACZ,OAAO;QACT;IACF,GAAG;QAACX;QAASY;QAAYiB;KAAS;IAElC,2BAA2B;IAC3B,MAAMiB,YAAYjC,IAAAA,kBAAW,EAAC;QAC5B,IAAI,CAACb,SAAS8B,MAAM;YAClBO,aAAK,CAAC1B,KAAK,CAAC;YACZ,OAAO;QACT;QAEAP,aAAa2B,CAAAA,OAAS,CAAA;gBAAE,GAAGA,IAAI;gBAAErB,SAAS;gBAAMC,OAAO;YAAK,CAAA;QAE5D,IAAI;YACF,MAAMZ,OAAO,MAAMa,WAAW,aAAa;gBACzC0B,QAAQ;YACV;YAEA,IAAIvC,KAAKiC,OAAO,EAAE;gBAChB,MAAMH;gBACNQ,aAAK,CAACL,OAAO,CAAC;gBACdR,QAAQS,GAAG,CAAC;gBACZ,OAAO;YACT,OAAO;gBACL,MAAM,IAAIR,MAAM1B,KAAKY,KAAK,IAAI;YAChC;QACF,EAAE,OAAOA,OAAY;YACnBa,QAAQb,KAAK,CAAC,8BAA8BA;YAC5CP,aAAa2B,CAAAA,OAAS,CAAA;oBAAE,GAAGA,IAAI;oBAAErB,SAAS;oBAAOC,OAAOA,MAAMe,OAAO;gBAAC,CAAA;YACtEW,aAAK,CAAC1B,KAAK,CAAC;YACZ,OAAO;QACT;IACF,GAAG;QAACX;QAASY;QAAYiB;KAAS;IAElC,2DAA2D;IAC3D,MAAMkB,kBAAkBlC,IAAAA,kBAAW,EAAC,CAACsB;QACnC,MAAMM,OAAOtC,UAAUG,KAAK,CAAC0C,IAAI,CAACP,CAAAA,OAAQA,KAAKQ,UAAU,KAAKd;QAC9D,OAAOM,MAAML,YAAY;IAC3B,GAAG;QAACjC,UAAUG,KAAK;KAAC;IAEpB,8CAA8C;IAC9C,MAAM4C,WAAWrC,IAAAA,kBAAW,EAAC,CAACsB;QAC5B,OAAOhC,UAAUG,KAAK,CAAC6C,IAAI,CAACV,CAAAA,OAAQA,KAAKQ,UAAU,KAAKd;IAC1D,GAAG;QAAChC,UAAUG,KAAK;KAAC;IAEpB,0CAA0C;IAC1C,MAAM8C,cAAcvC,IAAAA,kBAAW,EAAC;QAC9B,MAAMgB;IACR,GAAG;QAACA;KAAS;IAEb,mEAAmE;IACnEwB,IAAAA,gBAAS,EAAC;QACRxB;IACF,GAAG;QAACA;KAAS;IAEb,OAAO;QACL,GAAG1B,SAAS;QACZ+B;QACAU;QACAC;QACAC;QACAjB;QACAkB;QACAG;QACAE;IACF;AACF;MAEA,WAAetD"}