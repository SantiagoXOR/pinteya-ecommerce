{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\components\\ui\\quick-add-suggestions.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Plus, Star, Loader2 } from \"@/lib/optimized-imports\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { getProducts } from \"@/lib/api/products\";\r\nimport { ProductWithCategory } from \"@/types/api\";\r\nimport { getValidImageUrl } from \"@/lib/adapters/product-adapter\";\r\nimport Image from \"next/image\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { AppDispatch } from \"@/redux/store\";\r\nimport { addItemToCart } from \"@/redux/features/cart-slice\";\r\n\r\ninterface QuickAddSuggestionsProps {\r\n  onAddToCart?: (productId: string) => void;\r\n  onClose?: () => void;\r\n  className?: string;\r\n}\r\n\r\nconst QuickAddSuggestions: React.FC<QuickAddSuggestionsProps> = ({\r\n  onAddToCart,\r\n  onClose,\r\n  className\r\n}) => {\r\n  const [products, setProducts] = useState<ProductWithCategory[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const dispatch = useDispatch<AppDispatch>();\r\n\r\n  useEffect(() => {\r\n    const abortController = new AbortController();\r\n\r\n    const fetchPopularProducts = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        // Obtener productos con descuento (populares) limitados a 3\r\n        const response = await getProducts({\r\n          limit: 3,\r\n          sortBy: 'created_at',\r\n          sortOrder: 'desc'\r\n        }, abortController.signal);\r\n\r\n        // Verificar si el componente aún está montado\r\n        if (abortController.signal.aborted) {\r\n          return;\r\n        }\r\n\r\n        if (response.success && response.data) {\r\n          setProducts(response.data);\r\n        } else {\r\n          setError('No se pudieron cargar los productos');\r\n        }\r\n      } catch (err) {\r\n        // Solo mostrar error si no fue cancelado y no es AbortError\r\n        if (!abortController.signal.aborted && err instanceof Error && err.name !== 'AbortError') {\r\n          console.error('Error fetching popular products:', err);\r\n          setError('Error al cargar productos populares');\r\n        }\r\n        // No loggear AbortError ya que es comportamiento esperado durante cleanup\r\n      } finally {\r\n        // Solo actualizar loading si no fue cancelado\r\n        if (!abortController.signal.aborted) {\r\n          setLoading(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    fetchPopularProducts();\r\n\r\n    // Cleanup: cancelar la request si el componente se desmonta\r\n    return () => {\r\n      abortController.abort();\r\n    };\r\n  }, []);\r\n\r\n  const handleAddToCart = (productId: string) => {\r\n    // Buscar el producto en la lista\r\n    const product = products.find(p => p.id.toString() === productId);\r\n\r\n    if (product) {\r\n      // Convertir el producto al formato esperado por el carrito\r\n      const cartItem = {\r\n        id: product.id,\r\n        title: product.name,\r\n        brand: product.brand || '',\r\n        price: product.price,\r\n        discountedPrice: product.discounted_price || product.price,\r\n        imgs: {\r\n          thumbnails: product.images ? [product.images[0]] : [],\r\n          previews: product.images || []\r\n        },\r\n        reviews: 0, // No tenemos reviews en la API actual\r\n        quantity: 1\r\n      };\r\n\r\n      dispatch(addItemToCart(cartItem));\r\n    }\r\n\r\n    // Llamar callback personalizado si existe\r\n    if (onAddToCart) {\r\n      onAddToCart(productId);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={cn(\"bg-white rounded-xl border border-gray-200 p-4\", className)}>\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <div>\r\n          <h4 className=\"font-bold text-gray-900 text-sm\">Productos Populares</h4>\r\n          <p className=\"text-xs text-gray-600\">Agrega rápidamente a tu carrito</p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Lista de productos */}\r\n      <div className=\"space-y-3\">\r\n        {loading ? (\r\n          <div className=\"flex items-center justify-center py-8\">\r\n            <Loader2 className=\"w-6 h-6 animate-spin text-gray-400\" />\r\n            <span className=\"ml-2 text-sm text-gray-500\">Cargando productos...</span>\r\n          </div>\r\n        ) : error ? (\r\n          <div className=\"text-center py-4\">\r\n            <p className=\"text-sm text-red-500\">{error instanceof Error ? error.message : error?.toString() || 'Error desconocido'}</p>\r\n          </div>\r\n        ) : products.length === 0 ? (\r\n          <div className=\"text-center py-4\">\r\n            <p className=\"text-sm text-gray-500\">No hay productos disponibles</p>\r\n          </div>\r\n        ) : (\r\n          products.map((product) => {\r\n            const currentPrice = product.discounted_price || product.price;\r\n            const originalPrice = product.discounted_price ? product.price : null;\r\n            const hasDiscount = originalPrice && currentPrice < originalPrice;\r\n\r\n            return (\r\n              <div\r\n                key={product.id}\r\n                className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200\"\r\n              >\r\n                {/* Imagen del producto */}\r\n                <div className=\"w-16 h-16 bg-gray-200 rounded-xl overflow-hidden flex-shrink-0 shadow-sm border border-gray-300\">\r\n                  <Image\r\n                    src={getValidImageUrl(product.images?.[0])}\r\n                    alt={product.name}\r\n                    width={64}\r\n                    height={64}\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Info del producto */}\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <h5 className=\"font-semibold text-xs text-gray-900 line-clamp-1\">\r\n                    {product.name}\r\n                  </h5>\r\n                  <p className=\"text-2xs text-gray-500 mb-1\">{product.brand || 'Sin marca'}</p>\r\n\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className=\"font-bold text-sm\" style={{ color: '#ea5a17' }}>\r\n                      ${currentPrice.toLocaleString()}\r\n                    </span>\r\n                    {hasDiscount && (\r\n                      <span className=\"text-2xs text-gray-400 line-through\">\r\n                        ${originalPrice!.toLocaleString()}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Categoría */}\r\n                  <div className=\"flex items-center gap-1 mt-1\">\r\n                    <span className=\"text-2xs text-gray-600\">{product.category?.name || 'General'}</span>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Botón agregar */}\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={() => handleAddToCart(product.id.toString())}\r\n                  className=\"h-10 w-10 p-0 bg-yellow-400 hover:bg-yellow-500 text-black rounded-xl shadow-md hover:shadow-lg transition-all duration-200\"\r\n                >\r\n                  <Plus className=\"w-5 h-5\" />\r\n                </Button>\r\n              </div>\r\n            );\r\n          })\r\n        )}\r\n      </div>\r\n\r\n      {/* Footer con enlace a ver más */}\r\n      <div className=\"mt-4 pt-3 border-t border-gray-200\">\r\n        <Button\r\n          variant=\"ghost\"\r\n          size=\"sm\"\r\n          onClick={onClose}\r\n          className=\"w-full text-xs text-gray-600 hover:text-gray-900\"\r\n        >\r\n          Ver todos los productos →\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuickAddSuggestions;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["QuickAddSuggestions","onAddToCart","onClose","className","products","setProducts","useState","loading","setLoading","error","setError","dispatch","useDispatch","useEffect","abortController","AbortController","fetchPopularProducts","response","getProducts","limit","sortBy","sortOrder","signal","aborted","success","data","err","Error","name","console","abort","handleAddToCart","productId","product","find","p","id","toString","cartItem","title","brand","price","discountedPrice","discounted_price","imgs","thumbnails","images","previews","reviews","quantity","addItemToCart","div","cn","h4","Loader2","span","message","length","map","currentPrice","originalPrice","hasDiscount","Image","src","getValidImageUrl","alt","width","height","h5","style","color","toLocaleString","category","Button","size","onClick","Plus","variant"],"mappings":"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"}