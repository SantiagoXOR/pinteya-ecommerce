{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\hooks\\useSearchNavigation.test.tsx"],"sourcesContent":["// ===================================\n// TESTS: useSearchNavigation Hook - Navegación optimizada para búsquedas\n// ===================================\n\nimport { renderHook, act } from '@testing-library/react'\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport { useSearchNavigation } from '@/hooks/useSearchNavigation'\n\n// ===================================\n// MOCKS\n// ===================================\n\n// Mock Next.js router\njest.mock('next/navigation', () => ({\n  useRouter: jest.fn(),\n  useSearchParams: jest.fn(),\n}))\n\n// Mock window.scrollTo\nObject.defineProperty(window, 'scrollTo', {\n  value: jest.fn(),\n  writable: true,\n})\n\n// ===================================\n// SETUP\n// ===================================\n\nconst mockPush = jest.fn()\nconst mockReplace = jest.fn()\nconst mockPrefetch = jest.fn()\nconst mockUseRouter = useRouter as jest.MockedFunction<typeof useRouter>\nconst mockUseSearchParams = useSearchParams as jest.MockedFunction<typeof useSearchParams>\n\nconst mockSearchParams = {\n  get: jest.fn(),\n  forEach: jest.fn(),\n  toString: jest.fn(() => ''),\n}\n\nbeforeEach(() => {\n  jest.clearAllMocks()\n\n  mockUseRouter.mockReturnValue({\n    push: mockPush,\n    replace: mockReplace,\n    prefetch: mockPrefetch,\n  } as any)\n\n  mockUseSearchParams.mockReturnValue(mockSearchParams as any)\n\n  // Reset window.scrollTo mock\n  ;(window.scrollTo as jest.Mock).mockClear()\n})\n\n// ===================================\n// TESTS\n// ===================================\n\ndescribe('useSearchNavigation Hook', () => {\n  it('should navigate to search with query', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.navigateToSearch('pintura roja')\n    })\n\n    expect(mockPush).toHaveBeenCalledWith('/search?q=pintura+roja')\n  })\n\n  it('should navigate to search with query and category', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.navigateToSearch('pintura', 'pinturas')\n    })\n\n    expect(mockPush).toHaveBeenCalledWith('/search?q=pintura&category=pinturas')\n  })\n\n  it('should navigate to search with additional parameters', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.navigateToSearch('pintura', undefined, {\n        sort: 'price',\n        brand: 'sherwin',\n      })\n    })\n\n    expect(mockPush).toHaveBeenCalledWith('/search?q=pintura&sort=price&brand=sherwin')\n  })\n\n  it('should use replace instead of push when configured', () => {\n    const { result } = renderHook(() => useSearchNavigation({ replace: true }))\n\n    act(() => {\n      result.current.navigateToSearch('test query')\n    })\n\n    expect(mockReplace).toHaveBeenCalledWith('/search?q=test+query')\n    expect(mockPush).not.toHaveBeenCalled()\n  })\n\n  it('should preserve existing parameters when configured', () => {\n    mockSearchParams.get.mockImplementation(key => {\n      if (key === 'sort') {\n        return 'price'\n      }\n      if (key === 'brand') {\n        return 'sherwin'\n      }\n      return null\n    })\n\n    mockSearchParams.forEach.mockImplementation(callback => {\n      callback('price', 'sort')\n      callback('sherwin', 'brand')\n    })\n\n    const { result } = renderHook(() =>\n      useSearchNavigation({\n        preserveParams: true,\n      })\n    )\n\n    act(() => {\n      result.current.navigateToSearch('nueva busqueda')\n    })\n\n    expect(mockPush).toHaveBeenCalledWith('/search?q=nueva+busqueda&sort=price&brand=sherwin')\n  })\n\n  it('should scroll to top when configured', () => {\n    jest.useFakeTimers()\n\n    const { result } = renderHook(() =>\n      useSearchNavigation({\n        scrollToTop: true,\n      })\n    )\n\n    act(() => {\n      result.current.navigateToSearch('test')\n    })\n\n    // Fast-forward timers\n    act(() => {\n      jest.advanceTimersByTime(100)\n    })\n\n    expect(window.scrollTo).toHaveBeenCalledWith({\n      top: 0,\n      behavior: 'smooth',\n    })\n\n    jest.useRealTimers()\n  })\n\n  it('should call navigation callbacks', () => {\n    const onBeforeNavigate = jest.fn()\n    const onAfterNavigate = jest.fn()\n\n    const { result } = renderHook(() =>\n      useSearchNavigation({\n        onBeforeNavigate,\n        onAfterNavigate,\n      })\n    )\n\n    act(() => {\n      result.current.navigateToSearch('test')\n    })\n\n    expect(onBeforeNavigate).toHaveBeenCalledWith('/search?q=test')\n    expect(onAfterNavigate).toHaveBeenCalledWith('/search?q=test')\n  })\n\n  it('should navigate to product', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.navigateToProduct('123')\n    })\n\n    expect(mockPush).toHaveBeenCalledWith('/products/123')\n  })\n\n  it('should navigate to product with slug', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.navigateToProduct('123', 'pintura-sherwin-williams')\n    })\n\n    expect(mockPush).toHaveBeenCalledWith('/products/pintura-sherwin-williams')\n  })\n\n  it('should navigate to category', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.navigateToCategory('pinturas')\n    })\n\n    expect(mockPush).toHaveBeenCalledWith('/shop?category=pinturas')\n  })\n\n  it('should navigate to category with slug', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.navigateToCategory('pinturas', 'pinturas-interiores')\n    })\n\n    expect(mockPush).toHaveBeenCalledWith('/shop/pinturas-interiores')\n  })\n\n  it('should prefetch search page', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.prefetchSearch('pintura')\n    })\n\n    expect(mockPrefetch).toHaveBeenCalledWith('/search?q=pintura')\n  })\n\n  it('should prefetch product page', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.prefetchProduct('123')\n    })\n\n    expect(mockPrefetch).toHaveBeenCalledWith('/products/123')\n  })\n\n  it('should get current search query', () => {\n    mockSearchParams.get.mockImplementation(key => {\n      if (key === 'q') {\n        return 'current search'\n      }\n      return null\n    })\n\n    const { result } = renderHook(() => useSearchNavigation())\n\n    const query = result.current.getCurrentSearchQuery()\n    expect(query).toBe('current search')\n  })\n\n  it('should get current category', () => {\n    mockSearchParams.get.mockImplementation(key => {\n      if (key === 'category') {\n        return 'pinturas'\n      }\n      return null\n    })\n\n    const { result } = renderHook(() => useSearchNavigation())\n\n    const category = result.current.getCurrentCategory()\n    expect(category).toBe('pinturas')\n  })\n\n  it('should build search URL correctly', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    const url = result.current.buildSearchUrl('test query', 'pinturas', {\n      sort: 'price',\n      brand: 'sherwin',\n    })\n\n    expect(url).toBe('/search?q=test+query&category=pinturas&sort=price&brand=sherwin')\n  })\n\n  it('should not include category \"all\" in URL', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    const url = result.current.buildSearchUrl('test', 'all')\n    expect(url).toBe('/search?q=test')\n  })\n\n  it('should handle empty query gracefully', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.navigateToSearch('')\n    })\n\n    // Should not navigate with empty query\n    expect(mockPush).not.toHaveBeenCalled()\n  })\n\n  it('should handle whitespace-only query', () => {\n    const { result } = renderHook(() => useSearchNavigation())\n\n    act(() => {\n      result.current.navigateToSearch('   ')\n    })\n\n    // Should not navigate with whitespace-only query\n    expect(mockPush).not.toHaveBeenCalled()\n  })\n})\n"],"names":["jest","mock","useRouter","fn","useSearchParams","Object","defineProperty","window","value","writable","mockPush","mockReplace","mockPrefetch","mockUseRouter","mockUseSearchParams","mockSearchParams","get","forEach","toString","beforeEach","clearAllMocks","mockReturnValue","push","replace","prefetch","scrollTo","mockClear","describe","it","result","renderHook","useSearchNavigation","act","current","navigateToSearch","expect","toHaveBeenCalledWith","undefined","sort","brand","not","toHaveBeenCalled","mockImplementation","key","callback","preserveParams","useFakeTimers","scrollToTop","advanceTimersByTime","top","behavior","useRealTimers","onBeforeNavigate","onAfterNavigate","navigateToProduct","navigateToCategory","prefetchSearch","prefetchProduct","query","getCurrentSearchQuery","toBe","category","getCurrentCategory","url","buildSearchUrl"],"mappings":"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"}