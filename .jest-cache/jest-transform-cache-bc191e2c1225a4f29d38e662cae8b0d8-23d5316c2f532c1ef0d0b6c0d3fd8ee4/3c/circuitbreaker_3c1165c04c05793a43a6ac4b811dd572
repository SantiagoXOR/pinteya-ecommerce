a9169971a95e78953b50db9fa7b9228e
// ===================================
// PINTEYA E-COMMERCE - CIRCUIT BREAKER PATTERN ENTERPRISE
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get CIRCUIT_BREAKER_CONFIGS () {
        return CIRCUIT_BREAKER_CONFIGS;
    },
    get CircuitBreaker () {
        return CircuitBreaker;
    },
    get CircuitBreakerState () {
        return CircuitBreakerState;
    },
    get executeMercadoPagoCritical () {
        return executeMercadoPagoCritical;
    },
    get executeMercadoPagoStandard () {
        return executeMercadoPagoStandard;
    },
    get executeWebhookProcessing () {
        return executeWebhookProcessing;
    },
    get mercadoPagoCriticalBreaker () {
        return mercadoPagoCriticalBreaker;
    },
    get mercadoPagoStandardBreaker () {
        return mercadoPagoStandardBreaker;
    },
    get webhookProcessingBreaker () {
        return webhookProcessingBreaker;
    }
});
const _logger = require("../../enterprise/logger");
const _metrics = require("../../enterprise/metrics");
var CircuitBreakerState = /*#__PURE__*/ function(CircuitBreakerState) {
    CircuitBreakerState["CLOSED"] = "CLOSED";
    CircuitBreakerState["OPEN"] = "OPEN";
    CircuitBreakerState["HALF_OPEN"] = "HALF_OPEN";
    return CircuitBreakerState;
}({});
const CIRCUIT_BREAKER_CONFIGS = {
    MERCADOPAGO_CRITICAL: {
        failureThreshold: 5,
        recoveryTimeout: 60000,
        monitoringWindow: 120000,
        halfOpenMaxCalls: 3,
        successThreshold: 2
    },
    MERCADOPAGO_STANDARD: {
        failureThreshold: 3,
        recoveryTimeout: 30000,
        monitoringWindow: 60000,
        halfOpenMaxCalls: 2,
        successThreshold: 1
    },
    WEBHOOK_PROCESSING: {
        failureThreshold: 10,
        recoveryTimeout: 15000,
        monitoringWindow: 30000,
        halfOpenMaxCalls: 5,
        successThreshold: 3
    }
};
class CircuitBreaker {
    constructor(name, config){
        this.name = name;
        this.config = config;
        this.state = "CLOSED";
        this.failures = 0;
        this.successes = 0;
        this.lastFailureTime = 0;
        this.lastSuccessTime = 0;
        this.halfOpenCalls = 0;
        this.stateChanges = 0;
        this.metrics = {
            totalCalls: 0,
            successfulCalls: 0,
            failedCalls: 0,
            rejectedCalls: 0,
            lastFailureTime: 0,
            lastSuccessTime: 0,
            stateChanges: 0
        };
        _logger.logger.debug(_logger.LogLevel.DEBUG, `Circuit Breaker initialized: ${name}`, {
            config: this.config
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Ejecuta una operación protegida por el circuit breaker
   */ async execute(operation) {
        const startTime = Date.now();
        this.metrics.totalCalls++;
        // Verificar si debemos rechazar la llamada
        if (this.shouldReject()) {
            this.metrics.rejectedCalls++;
            await this.recordMetrics('rejected');
            return {
                success: false,
                error: new Error(`Circuit breaker is ${this.state} - operation rejected`),
                state: this.state,
                executionTime: Date.now() - startTime,
                wasRejected: true
            };
        }
        try {
            // Ejecutar la operación
            const result = await operation();
            // Registrar éxito
            await this.onSuccess();
            const executionTime = Date.now() - startTime;
            await this.recordMetrics('success', executionTime);
            return {
                success: true,
                data: result,
                state: this.state,
                executionTime,
                wasRejected: false
            };
        } catch (error) {
            // Registrar fallo
            await this.onFailure(error);
            const executionTime = Date.now() - startTime;
            await this.recordMetrics('failure', executionTime);
            return {
                success: false,
                error: error,
                state: this.state,
                executionTime,
                wasRejected: false
            };
        }
    }
    /**
   * Determina si debemos rechazar la operación
   */ shouldReject() {
        const now = Date.now();
        switch(this.state){
            case "CLOSED":
                return false;
            case "OPEN":
                // Verificar si es tiempo de intentar recuperación
                if (now - this.lastFailureTime >= this.config.recoveryTimeout) {
                    this.transitionToHalfOpen();
                    return false;
                }
                return true;
            case "HALF_OPEN":
                // Limitar llamadas en estado HALF_OPEN
                return this.halfOpenCalls >= this.config.halfOpenMaxCalls;
            default:
                return false;
        }
    }
    /**
   * Maneja un éxito en la operación
   */ async onSuccess() {
        this.lastSuccessTime = Date.now();
        this.metrics.successfulCalls++;
        switch(this.state){
            case "HALF_OPEN":
                this.successes++;
                this.halfOpenCalls++;
                if (this.successes >= this.config.successThreshold) {
                    this.transitionToClosed();
                }
                break;
            case "CLOSED":
                // Reset failure counter en ventana de monitoreo
                if (this.isInMonitoringWindow()) {
                    this.failures = 0;
                }
                break;
        }
    }
    /**
   * Maneja un fallo en la operación
   */ async onFailure(error) {
        this.lastFailureTime = Date.now();
        this.metrics.failedCalls++;
        this.failures++;
        _logger.logger.warn(_logger.LogLevel.WARN, `Circuit Breaker failure: ${this.name}`, {
            error: error.message,
            failures: this.failures,
            state: this.state
        }, _logger.LogCategory.SYSTEM);
        switch(this.state){
            case "CLOSED":
                if (this.failures >= this.config.failureThreshold) {
                    this.transitionToOpen();
                }
                break;
            case "HALF_OPEN":
                this.transitionToOpen();
                break;
        }
    }
    /**
   * Transición a estado OPEN
   */ transitionToOpen() {
        this.state = "OPEN";
        this.stateChanges++;
        this.metrics.stateChanges++;
        this.halfOpenCalls = 0;
        this.successes = 0;
        _logger.logger.warn(_logger.LogLevel.WARN, `Circuit Breaker OPENED: ${this.name}`, {
            failures: this.failures,
            threshold: this.config.failureThreshold
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Transición a estado HALF_OPEN
   */ transitionToHalfOpen() {
        this.state = "HALF_OPEN";
        this.stateChanges++;
        this.metrics.stateChanges++;
        this.halfOpenCalls = 0;
        this.successes = 0;
        _logger.logger.info(_logger.LogLevel.INFO, `Circuit Breaker HALF-OPEN: ${this.name}`, {
            recoveryTimeout: this.config.recoveryTimeout
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Transición a estado CLOSED
   */ transitionToClosed() {
        this.state = "CLOSED";
        this.stateChanges++;
        this.metrics.stateChanges++;
        this.failures = 0;
        this.successes = 0;
        this.halfOpenCalls = 0;
        _logger.logger.info(_logger.LogLevel.INFO, `Circuit Breaker CLOSED: ${this.name}`, {
            successThreshold: this.config.successThreshold
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Verifica si estamos en la ventana de monitoreo
   */ isInMonitoringWindow() {
        const now = Date.now();
        return now - this.lastFailureTime <= this.config.monitoringWindow;
    }
    /**
   * Registra métricas del circuit breaker
   */ async recordMetrics(operation, executionTime) {
        try {
            await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.${operation}`, 1, {
                state: this.state,
                operation
            });
            if (executionTime) {
                await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.execution_time`, executionTime, {
                    state: this.state
                });
            }
            // Métricas de estado
            await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.state_changes`, this.stateChanges);
            await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.failure_rate`, this.metrics.totalCalls > 0 ? this.metrics.failedCalls / this.metrics.totalCalls : 0);
        } catch (error) {
            _logger.logger.error(_logger.LogLevel.ERROR, `Failed to record circuit breaker metrics: ${this.name}`, {
                error: error instanceof Error ? error.message : 'Unknown error'
            }, _logger.LogCategory.SYSTEM);
        }
    }
    /**
   * Obtiene el estado actual del circuit breaker
   */ getState() {
        return this.state;
    }
    /**
   * Obtiene las métricas del circuit breaker
   */ getMetrics() {
        return {
            ...this.metrics,
            state: this.state,
            config: this.config
        };
    }
    /**
   * Fuerza el reset del circuit breaker (solo para testing/admin)
   */ reset() {
        this.state = "CLOSED";
        this.failures = 0;
        this.successes = 0;
        this.halfOpenCalls = 0;
        this.lastFailureTime = 0;
        this.lastSuccessTime = 0;
        _logger.logger.info(_logger.LogLevel.INFO, `Circuit Breaker manually reset: ${this.name}`, {}, _logger.LogCategory.SYSTEM);
    }
}
const mercadoPagoCriticalBreaker = new CircuitBreaker('mercadopago_critical', CIRCUIT_BREAKER_CONFIGS.MERCADOPAGO_CRITICAL);
const mercadoPagoStandardBreaker = new CircuitBreaker('mercadopago_standard', CIRCUIT_BREAKER_CONFIGS.MERCADOPAGO_STANDARD);
const webhookProcessingBreaker = new CircuitBreaker('webhook_processing', CIRCUIT_BREAKER_CONFIGS.WEBHOOK_PROCESSING);
async function executeMercadoPagoCritical(operation) {
    return mercadoPagoCriticalBreaker.execute(operation);
}
async function executeMercadoPagoStandard(operation) {
    return mercadoPagoStandardBreaker.execute(operation);
}
async function executeWebhookProcessing(operation) {
    return webhookProcessingBreaker.execute(operation);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxpbnRlZ3JhdGlvbnNcXG1lcmNhZG9wYWdvXFxjaXJjdWl0LWJyZWFrZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBJTlRFWUEgRS1DT01NRVJDRSAtIENJUkNVSVQgQlJFQUtFUiBQQVRURVJOIEVOVEVSUFJJU0Vcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCB7IGxvZ2dlciwgTG9nTGV2ZWwsIExvZ0NhdGVnb3J5IH0gZnJvbSAnQC9saWIvZW50ZXJwcmlzZS9sb2dnZXInXG5pbXBvcnQgeyBtZXRyaWNzQ29sbGVjdG9yIH0gZnJvbSAnQC9saWIvZW50ZXJwcmlzZS9tZXRyaWNzJ1xuXG4vLyBFc3RhZG9zIGRlbCBDaXJjdWl0IEJyZWFrZXJcbmV4cG9ydCBlbnVtIENpcmN1aXRCcmVha2VyU3RhdGUge1xuICBDTE9TRUQgPSAnQ0xPU0VEJywgLy8gRnVuY2lvbmFtaWVudG8gbm9ybWFsXG4gIE9QRU4gPSAnT1BFTicsIC8vIENpcmN1aXRvIGFiaWVydG8sIHJlY2hhemEgcmVxdWVzdHNcbiAgSEFMRl9PUEVOID0gJ0hBTEZfT1BFTicsIC8vIFByb2JhbmRvIHNpIGVsIHNlcnZpY2lvIHNlIHJlY3VwZXLDs1xufVxuXG4vLyBDb25maWd1cmFjacOzbiBkZWwgQ2lyY3VpdCBCcmVha2VyXG5leHBvcnQgaW50ZXJmYWNlIENpcmN1aXRCcmVha2VyQ29uZmlnIHtcbiAgZmFpbHVyZVRocmVzaG9sZDogbnVtYmVyIC8vIE7Dum1lcm8gZGUgZmFsbG9zIHBhcmEgYWJyaXIgZWwgY2lyY3VpdG9cbiAgcmVjb3ZlcnlUaW1lb3V0OiBudW1iZXIgLy8gVGllbXBvIGFudGVzIGRlIGludGVudGFyIHJlY3VwZXJhY2nDs24gKG1zKVxuICBtb25pdG9yaW5nV2luZG93OiBudW1iZXIgLy8gVmVudGFuYSBkZSBtb25pdG9yZW8gcGFyYSBjb250YXIgZmFsbG9zIChtcylcbiAgaGFsZk9wZW5NYXhDYWxsczogbnVtYmVyIC8vIE3DoXhpbW8gZGUgbGxhbWFkYXMgZW4gZXN0YWRvIEhBTEZfT1BFTlxuICBzdWNjZXNzVGhyZXNob2xkOiBudW1iZXIgLy8gw4l4aXRvcyBuZWNlc2FyaW9zIHBhcmEgY2VycmFyIGVsIGNpcmN1aXRvXG59XG5cbi8vIENvbmZpZ3VyYWNpb25lcyBwcmVkZWZpbmlkYXNcbmV4cG9ydCBjb25zdCBDSVJDVUlUX0JSRUFLRVJfQ09ORklHUyA9IHtcbiAgTUVSQ0FET1BBR09fQ1JJVElDQUw6IHtcbiAgICBmYWlsdXJlVGhyZXNob2xkOiA1LFxuICAgIHJlY292ZXJ5VGltZW91dDogNjAwMDAsIC8vIDEgbWludXRvXG4gICAgbW9uaXRvcmluZ1dpbmRvdzogMTIwMDAwLCAvLyAyIG1pbnV0b3NcbiAgICBoYWxmT3Blbk1heENhbGxzOiAzLFxuICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6IDIsXG4gIH0sXG4gIE1FUkNBRE9QQUdPX1NUQU5EQVJEOiB7XG4gICAgZmFpbHVyZVRocmVzaG9sZDogMyxcbiAgICByZWNvdmVyeVRpbWVvdXQ6IDMwMDAwLCAvLyAzMCBzZWd1bmRvc1xuICAgIG1vbml0b3JpbmdXaW5kb3c6IDYwMDAwLCAvLyAxIG1pbnV0b1xuICAgIGhhbGZPcGVuTWF4Q2FsbHM6IDIsXG4gICAgc3VjY2Vzc1RocmVzaG9sZDogMSxcbiAgfSxcbiAgV0VCSE9PS19QUk9DRVNTSU5HOiB7XG4gICAgZmFpbHVyZVRocmVzaG9sZDogMTAsXG4gICAgcmVjb3ZlcnlUaW1lb3V0OiAxNTAwMCwgLy8gMTUgc2VndW5kb3NcbiAgICBtb25pdG9yaW5nV2luZG93OiAzMDAwMCwgLy8gMzAgc2VndW5kb3NcbiAgICBoYWxmT3Blbk1heENhbGxzOiA1LFxuICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6IDMsXG4gIH0sXG59IGFzIGNvbnN0XG5cbi8vIE3DqXRyaWNhcyBkZWwgQ2lyY3VpdCBCcmVha2VyXG5pbnRlcmZhY2UgQ2lyY3VpdEJyZWFrZXJNZXRyaWNzIHtcbiAgdG90YWxDYWxsczogbnVtYmVyXG4gIHN1Y2Nlc3NmdWxDYWxsczogbnVtYmVyXG4gIGZhaWxlZENhbGxzOiBudW1iZXJcbiAgcmVqZWN0ZWRDYWxsczogbnVtYmVyXG4gIGxhc3RGYWlsdXJlVGltZTogbnVtYmVyXG4gIGxhc3RTdWNjZXNzVGltZTogbnVtYmVyXG4gIHN0YXRlQ2hhbmdlczogbnVtYmVyXG59XG5cbi8vIFJlc3VsdGFkbyBkZSBlamVjdWNpw7NuXG5leHBvcnQgaW50ZXJmYWNlIENpcmN1aXRCcmVha2VyUmVzdWx0PFQ+IHtcbiAgc3VjY2VzczogYm9vbGVhblxuICBkYXRhPzogVFxuICBlcnJvcj86IEVycm9yXG4gIHN0YXRlOiBDaXJjdWl0QnJlYWtlclN0YXRlXG4gIGV4ZWN1dGlvblRpbWU6IG51bWJlclxuICB3YXNSZWplY3RlZDogYm9vbGVhblxufVxuXG4vKipcbiAqIENpcmN1aXQgQnJlYWtlciBFbnRlcnByaXNlIHBhcmEgTWVyY2Fkb1BhZ29cbiAqIEltcGxlbWVudGEgZWwgcGF0csOzbiBDaXJjdWl0IEJyZWFrZXIgY29uIGVzdGFkb3MgeSByZWN1cGVyYWNpw7NuIGF1dG9tw6F0aWNhXG4gKi9cbmV4cG9ydCBjbGFzcyBDaXJjdWl0QnJlYWtlciB7XG4gIHByaXZhdGUgc3RhdGU6IENpcmN1aXRCcmVha2VyU3RhdGUgPSBDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRFxuICBwcml2YXRlIGZhaWx1cmVzOiBudW1iZXIgPSAwXG4gIHByaXZhdGUgc3VjY2Vzc2VzOiBudW1iZXIgPSAwXG4gIHByaXZhdGUgbGFzdEZhaWx1cmVUaW1lOiBudW1iZXIgPSAwXG4gIHByaXZhdGUgbGFzdFN1Y2Nlc3NUaW1lOiBudW1iZXIgPSAwXG4gIHByaXZhdGUgaGFsZk9wZW5DYWxsczogbnVtYmVyID0gMFxuICBwcml2YXRlIHN0YXRlQ2hhbmdlczogbnVtYmVyID0gMFxuICBwcml2YXRlIG1ldHJpY3M6IENpcmN1aXRCcmVha2VyTWV0cmljc1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbmFtZTogc3RyaW5nLFxuICAgIHByaXZhdGUgY29uZmlnOiBDaXJjdWl0QnJlYWtlckNvbmZpZ1xuICApIHtcbiAgICB0aGlzLm1ldHJpY3MgPSB7XG4gICAgICB0b3RhbENhbGxzOiAwLFxuICAgICAgc3VjY2Vzc2Z1bENhbGxzOiAwLFxuICAgICAgZmFpbGVkQ2FsbHM6IDAsXG4gICAgICByZWplY3RlZENhbGxzOiAwLFxuICAgICAgbGFzdEZhaWx1cmVUaW1lOiAwLFxuICAgICAgbGFzdFN1Y2Nlc3NUaW1lOiAwLFxuICAgICAgc3RhdGVDaGFuZ2VzOiAwLFxuICAgIH1cblxuICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgIExvZ0xldmVsLkRFQlVHLFxuICAgICAgYENpcmN1aXQgQnJlYWtlciBpbml0aWFsaXplZDogJHtuYW1lfWAsXG4gICAgICB7XG4gICAgICAgIGNvbmZpZzogdGhpcy5jb25maWcsXG4gICAgICB9LFxuICAgICAgTG9nQ2F0ZWdvcnkuU1lTVEVNXG4gICAgKVxuICB9XG5cbiAgLyoqXG4gICAqIEVqZWN1dGEgdW5hIG9wZXJhY2nDs24gcHJvdGVnaWRhIHBvciBlbCBjaXJjdWl0IGJyZWFrZXJcbiAgICovXG4gIGFzeW5jIGV4ZWN1dGU8VD4ob3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxDaXJjdWl0QnJlYWtlclJlc3VsdDxUPj4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KClcbiAgICB0aGlzLm1ldHJpY3MudG90YWxDYWxscysrXG5cbiAgICAvLyBWZXJpZmljYXIgc2kgZGViZW1vcyByZWNoYXphciBsYSBsbGFtYWRhXG4gICAgaWYgKHRoaXMuc2hvdWxkUmVqZWN0KCkpIHtcbiAgICAgIHRoaXMubWV0cmljcy5yZWplY3RlZENhbGxzKytcblxuICAgICAgYXdhaXQgdGhpcy5yZWNvcmRNZXRyaWNzKCdyZWplY3RlZCcpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogbmV3IEVycm9yKGBDaXJjdWl0IGJyZWFrZXIgaXMgJHt0aGlzLnN0YXRlfSAtIG9wZXJhdGlvbiByZWplY3RlZGApLFxuICAgICAgICBzdGF0ZTogdGhpcy5zdGF0ZSxcbiAgICAgICAgZXhlY3V0aW9uVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgICAgd2FzUmVqZWN0ZWQ6IHRydWUsXG4gICAgICB9XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEVqZWN1dGFyIGxhIG9wZXJhY2nDs25cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9wZXJhdGlvbigpXG5cbiAgICAgIC8vIFJlZ2lzdHJhciDDqXhpdG9cbiAgICAgIGF3YWl0IHRoaXMub25TdWNjZXNzKClcblxuICAgICAgY29uc3QgZXhlY3V0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIGF3YWl0IHRoaXMucmVjb3JkTWV0cmljcygnc3VjY2VzcycsIGV4ZWN1dGlvblRpbWUpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgIHdhc1JlamVjdGVkOiBmYWxzZSxcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gUmVnaXN0cmFyIGZhbGxvXG4gICAgICBhd2FpdCB0aGlzLm9uRmFpbHVyZShlcnJvciBhcyBFcnJvcilcblxuICAgICAgY29uc3QgZXhlY3V0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWVcbiAgICAgIGF3YWl0IHRoaXMucmVjb3JkTWV0cmljcygnZmFpbHVyZScsIGV4ZWN1dGlvblRpbWUpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IgYXMgRXJyb3IsXG4gICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgICBleGVjdXRpb25UaW1lLFxuICAgICAgICB3YXNSZWplY3RlZDogZmFsc2UsXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluYSBzaSBkZWJlbW9zIHJlY2hhemFyIGxhIG9wZXJhY2nDs25cbiAgICovXG4gIHByaXZhdGUgc2hvdWxkUmVqZWN0KCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcblxuICAgIHN3aXRjaCAodGhpcy5zdGF0ZSkge1xuICAgICAgY2FzZSBDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRDpcbiAgICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICAgIGNhc2UgQ2lyY3VpdEJyZWFrZXJTdGF0ZS5PUEVOOlxuICAgICAgICAvLyBWZXJpZmljYXIgc2kgZXMgdGllbXBvIGRlIGludGVudGFyIHJlY3VwZXJhY2nDs25cbiAgICAgICAgaWYgKG5vdyAtIHRoaXMubGFzdEZhaWx1cmVUaW1lID49IHRoaXMuY29uZmlnLnJlY292ZXJ5VGltZW91dCkge1xuICAgICAgICAgIHRoaXMudHJhbnNpdGlvblRvSGFsZk9wZW4oKVxuICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlXG5cbiAgICAgIGNhc2UgQ2lyY3VpdEJyZWFrZXJTdGF0ZS5IQUxGX09QRU46XG4gICAgICAgIC8vIExpbWl0YXIgbGxhbWFkYXMgZW4gZXN0YWRvIEhBTEZfT1BFTlxuICAgICAgICByZXR1cm4gdGhpcy5oYWxmT3BlbkNhbGxzID49IHRoaXMuY29uZmlnLmhhbGZPcGVuTWF4Q2FsbHNcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1hbmVqYSB1biDDqXhpdG8gZW4gbGEgb3BlcmFjacOzblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBvblN1Y2Nlc3MoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5sYXN0U3VjY2Vzc1RpbWUgPSBEYXRlLm5vdygpXG4gICAgdGhpcy5tZXRyaWNzLnN1Y2Nlc3NmdWxDYWxscysrXG5cbiAgICBzd2l0Y2ggKHRoaXMuc3RhdGUpIHtcbiAgICAgIGNhc2UgQ2lyY3VpdEJyZWFrZXJTdGF0ZS5IQUxGX09QRU46XG4gICAgICAgIHRoaXMuc3VjY2Vzc2VzKytcbiAgICAgICAgdGhpcy5oYWxmT3BlbkNhbGxzKytcblxuICAgICAgICBpZiAodGhpcy5zdWNjZXNzZXMgPj0gdGhpcy5jb25maWcuc3VjY2Vzc1RocmVzaG9sZCkge1xuICAgICAgICAgIHRoaXMudHJhbnNpdGlvblRvQ2xvc2VkKClcbiAgICAgICAgfVxuICAgICAgICBicmVha1xuXG4gICAgICBjYXNlIENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEOlxuICAgICAgICAvLyBSZXNldCBmYWlsdXJlIGNvdW50ZXIgZW4gdmVudGFuYSBkZSBtb25pdG9yZW9cbiAgICAgICAgaWYgKHRoaXMuaXNJbk1vbml0b3JpbmdXaW5kb3coKSkge1xuICAgICAgICAgIHRoaXMuZmFpbHVyZXMgPSAwXG4gICAgICAgIH1cbiAgICAgICAgYnJlYWtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFuZWphIHVuIGZhbGxvIGVuIGxhIG9wZXJhY2nDs25cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgb25GYWlsdXJlKGVycm9yOiBFcnJvcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMubGFzdEZhaWx1cmVUaW1lID0gRGF0ZS5ub3coKVxuICAgIHRoaXMubWV0cmljcy5mYWlsZWRDYWxscysrXG4gICAgdGhpcy5mYWlsdXJlcysrXG5cbiAgICBsb2dnZXIud2FybihcbiAgICAgIExvZ0xldmVsLldBUk4sXG4gICAgICBgQ2lyY3VpdCBCcmVha2VyIGZhaWx1cmU6ICR7dGhpcy5uYW1lfWAsXG4gICAgICB7XG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICBmYWlsdXJlczogdGhpcy5mYWlsdXJlcyxcbiAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICB9LFxuICAgICAgTG9nQ2F0ZWdvcnkuU1lTVEVNXG4gICAgKVxuXG4gICAgc3dpdGNoICh0aGlzLnN0YXRlKSB7XG4gICAgICBjYXNlIENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEOlxuICAgICAgICBpZiAodGhpcy5mYWlsdXJlcyA+PSB0aGlzLmNvbmZpZy5mYWlsdXJlVGhyZXNob2xkKSB7XG4gICAgICAgICAgdGhpcy50cmFuc2l0aW9uVG9PcGVuKClcbiAgICAgICAgfVxuICAgICAgICBicmVha1xuXG4gICAgICBjYXNlIENpcmN1aXRCcmVha2VyU3RhdGUuSEFMRl9PUEVOOlxuICAgICAgICB0aGlzLnRyYW5zaXRpb25Ub09wZW4oKVxuICAgICAgICBicmVha1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFuc2ljacOzbiBhIGVzdGFkbyBPUEVOXG4gICAqL1xuICBwcml2YXRlIHRyYW5zaXRpb25Ub09wZW4oKTogdm9pZCB7XG4gICAgdGhpcy5zdGF0ZSA9IENpcmN1aXRCcmVha2VyU3RhdGUuT1BFTlxuICAgIHRoaXMuc3RhdGVDaGFuZ2VzKytcbiAgICB0aGlzLm1ldHJpY3Muc3RhdGVDaGFuZ2VzKytcbiAgICB0aGlzLmhhbGZPcGVuQ2FsbHMgPSAwXG4gICAgdGhpcy5zdWNjZXNzZXMgPSAwXG5cbiAgICBsb2dnZXIud2FybihcbiAgICAgIExvZ0xldmVsLldBUk4sXG4gICAgICBgQ2lyY3VpdCBCcmVha2VyIE9QRU5FRDogJHt0aGlzLm5hbWV9YCxcbiAgICAgIHtcbiAgICAgICAgZmFpbHVyZXM6IHRoaXMuZmFpbHVyZXMsXG4gICAgICAgIHRocmVzaG9sZDogdGhpcy5jb25maWcuZmFpbHVyZVRocmVzaG9sZCxcbiAgICAgIH0sXG4gICAgICBMb2dDYXRlZ29yeS5TWVNURU1cbiAgICApXG4gIH1cblxuICAvKipcbiAgICogVHJhbnNpY2nDs24gYSBlc3RhZG8gSEFMRl9PUEVOXG4gICAqL1xuICBwcml2YXRlIHRyYW5zaXRpb25Ub0hhbGZPcGVuKCk6IHZvaWQge1xuICAgIHRoaXMuc3RhdGUgPSBDaXJjdWl0QnJlYWtlclN0YXRlLkhBTEZfT1BFTlxuICAgIHRoaXMuc3RhdGVDaGFuZ2VzKytcbiAgICB0aGlzLm1ldHJpY3Muc3RhdGVDaGFuZ2VzKytcbiAgICB0aGlzLmhhbGZPcGVuQ2FsbHMgPSAwXG4gICAgdGhpcy5zdWNjZXNzZXMgPSAwXG5cbiAgICBsb2dnZXIuaW5mbyhcbiAgICAgIExvZ0xldmVsLklORk8sXG4gICAgICBgQ2lyY3VpdCBCcmVha2VyIEhBTEYtT1BFTjogJHt0aGlzLm5hbWV9YCxcbiAgICAgIHtcbiAgICAgICAgcmVjb3ZlcnlUaW1lb3V0OiB0aGlzLmNvbmZpZy5yZWNvdmVyeVRpbWVvdXQsXG4gICAgICB9LFxuICAgICAgTG9nQ2F0ZWdvcnkuU1lTVEVNXG4gICAgKVxuICB9XG5cbiAgLyoqXG4gICAqIFRyYW5zaWNpw7NuIGEgZXN0YWRvIENMT1NFRFxuICAgKi9cbiAgcHJpdmF0ZSB0cmFuc2l0aW9uVG9DbG9zZWQoKTogdm9pZCB7XG4gICAgdGhpcy5zdGF0ZSA9IENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEXG4gICAgdGhpcy5zdGF0ZUNoYW5nZXMrK1xuICAgIHRoaXMubWV0cmljcy5zdGF0ZUNoYW5nZXMrK1xuICAgIHRoaXMuZmFpbHVyZXMgPSAwXG4gICAgdGhpcy5zdWNjZXNzZXMgPSAwXG4gICAgdGhpcy5oYWxmT3BlbkNhbGxzID0gMFxuXG4gICAgbG9nZ2VyLmluZm8oXG4gICAgICBMb2dMZXZlbC5JTkZPLFxuICAgICAgYENpcmN1aXQgQnJlYWtlciBDTE9TRUQ6ICR7dGhpcy5uYW1lfWAsXG4gICAgICB7XG4gICAgICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6IHRoaXMuY29uZmlnLnN1Y2Nlc3NUaHJlc2hvbGQsXG4gICAgICB9LFxuICAgICAgTG9nQ2F0ZWdvcnkuU1lTVEVNXG4gICAgKVxuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNpIGVzdGFtb3MgZW4gbGEgdmVudGFuYSBkZSBtb25pdG9yZW9cbiAgICovXG4gIHByaXZhdGUgaXNJbk1vbml0b3JpbmdXaW5kb3coKTogYm9vbGVhbiB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxuICAgIHJldHVybiBub3cgLSB0aGlzLmxhc3RGYWlsdXJlVGltZSA8PSB0aGlzLmNvbmZpZy5tb25pdG9yaW5nV2luZG93XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0cmEgbcOpdHJpY2FzIGRlbCBjaXJjdWl0IGJyZWFrZXJcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcmVjb3JkTWV0cmljcyhcbiAgICBvcGVyYXRpb246ICdzdWNjZXNzJyB8ICdmYWlsdXJlJyB8ICdyZWplY3RlZCcsXG4gICAgZXhlY3V0aW9uVGltZT86IG51bWJlclxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgbWV0cmljc0NvbGxlY3Rvci5yZWNvcmRNZXRyaWMoYGNpcmN1aXRfYnJlYWtlci4ke3RoaXMubmFtZX0uJHtvcGVyYXRpb259YCwgMSwge1xuICAgICAgICBzdGF0ZTogdGhpcy5zdGF0ZSxcbiAgICAgICAgb3BlcmF0aW9uLFxuICAgICAgfSlcblxuICAgICAgaWYgKGV4ZWN1dGlvblRpbWUpIHtcbiAgICAgICAgYXdhaXQgbWV0cmljc0NvbGxlY3Rvci5yZWNvcmRNZXRyaWMoXG4gICAgICAgICAgYGNpcmN1aXRfYnJlYWtlci4ke3RoaXMubmFtZX0uZXhlY3V0aW9uX3RpbWVgLFxuICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgeyBzdGF0ZTogdGhpcy5zdGF0ZSB9XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgLy8gTcOpdHJpY2FzIGRlIGVzdGFkb1xuICAgICAgYXdhaXQgbWV0cmljc0NvbGxlY3Rvci5yZWNvcmRNZXRyaWMoXG4gICAgICAgIGBjaXJjdWl0X2JyZWFrZXIuJHt0aGlzLm5hbWV9LnN0YXRlX2NoYW5nZXNgLFxuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlc1xuICAgICAgKVxuICAgICAgYXdhaXQgbWV0cmljc0NvbGxlY3Rvci5yZWNvcmRNZXRyaWMoXG4gICAgICAgIGBjaXJjdWl0X2JyZWFrZXIuJHt0aGlzLm5hbWV9LmZhaWx1cmVfcmF0ZWAsXG4gICAgICAgIHRoaXMubWV0cmljcy50b3RhbENhbGxzID4gMCA/IHRoaXMubWV0cmljcy5mYWlsZWRDYWxscyAvIHRoaXMubWV0cmljcy50b3RhbENhbGxzIDogMFxuICAgICAgKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgIExvZ0xldmVsLkVSUk9SLFxuICAgICAgICBgRmFpbGVkIHRvIHJlY29yZCBjaXJjdWl0IGJyZWFrZXIgbWV0cmljczogJHt0aGlzLm5hbWV9YCxcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgfSxcbiAgICAgICAgTG9nQ2F0ZWdvcnkuU1lTVEVNXG4gICAgICApXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE9idGllbmUgZWwgZXN0YWRvIGFjdHVhbCBkZWwgY2lyY3VpdCBicmVha2VyXG4gICAqL1xuICBnZXRTdGF0ZSgpOiBDaXJjdWl0QnJlYWtlclN0YXRlIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZVxuICB9XG5cbiAgLyoqXG4gICAqIE9idGllbmUgbGFzIG3DqXRyaWNhcyBkZWwgY2lyY3VpdCBicmVha2VyXG4gICAqL1xuICBnZXRNZXRyaWNzKCk6IENpcmN1aXRCcmVha2VyTWV0cmljcyAmIHtcbiAgICBzdGF0ZTogQ2lyY3VpdEJyZWFrZXJTdGF0ZVxuICAgIGNvbmZpZzogQ2lyY3VpdEJyZWFrZXJDb25maWdcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRoaXMubWV0cmljcyxcbiAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZyxcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRnVlcnphIGVsIHJlc2V0IGRlbCBjaXJjdWl0IGJyZWFrZXIgKHNvbG8gcGFyYSB0ZXN0aW5nL2FkbWluKVxuICAgKi9cbiAgcmVzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5zdGF0ZSA9IENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEXG4gICAgdGhpcy5mYWlsdXJlcyA9IDBcbiAgICB0aGlzLnN1Y2Nlc3NlcyA9IDBcbiAgICB0aGlzLmhhbGZPcGVuQ2FsbHMgPSAwXG4gICAgdGhpcy5sYXN0RmFpbHVyZVRpbWUgPSAwXG4gICAgdGhpcy5sYXN0U3VjY2Vzc1RpbWUgPSAwXG5cbiAgICBsb2dnZXIuaW5mbyhcbiAgICAgIExvZ0xldmVsLklORk8sXG4gICAgICBgQ2lyY3VpdCBCcmVha2VyIG1hbnVhbGx5IHJlc2V0OiAke3RoaXMubmFtZX1gLFxuICAgICAge30sXG4gICAgICBMb2dDYXRlZ29yeS5TWVNURU1cbiAgICApXG4gIH1cbn1cblxuLy8gSW5zdGFuY2lhcyBnbG9iYWxlcyBkZSBjaXJjdWl0IGJyZWFrZXJzXG5leHBvcnQgY29uc3QgbWVyY2Fkb1BhZ29Dcml0aWNhbEJyZWFrZXIgPSBuZXcgQ2lyY3VpdEJyZWFrZXIoXG4gICdtZXJjYWRvcGFnb19jcml0aWNhbCcsXG4gIENJUkNVSVRfQlJFQUtFUl9DT05GSUdTLk1FUkNBRE9QQUdPX0NSSVRJQ0FMXG4pXG5cbmV4cG9ydCBjb25zdCBtZXJjYWRvUGFnb1N0YW5kYXJkQnJlYWtlciA9IG5ldyBDaXJjdWl0QnJlYWtlcihcbiAgJ21lcmNhZG9wYWdvX3N0YW5kYXJkJyxcbiAgQ0lSQ1VJVF9CUkVBS0VSX0NPTkZJR1MuTUVSQ0FET1BBR09fU1RBTkRBUkRcbilcblxuZXhwb3J0IGNvbnN0IHdlYmhvb2tQcm9jZXNzaW5nQnJlYWtlciA9IG5ldyBDaXJjdWl0QnJlYWtlcihcbiAgJ3dlYmhvb2tfcHJvY2Vzc2luZycsXG4gIENJUkNVSVRfQlJFQUtFUl9DT05GSUdTLldFQkhPT0tfUFJPQ0VTU0lOR1xuKVxuXG4vKipcbiAqIFdyYXBwZXIgcGFyYSBvcGVyYWNpb25lcyBjcsOtdGljYXMgZGUgTWVyY2Fkb1BhZ29cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVNZXJjYWRvUGFnb0NyaXRpY2FsPFQ+KFxuICBvcGVyYXRpb246ICgpID0+IFByb21pc2U8VD5cbik6IFByb21pc2U8Q2lyY3VpdEJyZWFrZXJSZXN1bHQ8VD4+IHtcbiAgcmV0dXJuIG1lcmNhZG9QYWdvQ3JpdGljYWxCcmVha2VyLmV4ZWN1dGUob3BlcmF0aW9uKVxufVxuXG4vKipcbiAqIFdyYXBwZXIgcGFyYSBvcGVyYWNpb25lcyBlc3TDoW5kYXIgZGUgTWVyY2Fkb1BhZ29cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVNZXJjYWRvUGFnb1N0YW5kYXJkPFQ+KFxuICBvcGVyYXRpb246ICgpID0+IFByb21pc2U8VD5cbik6IFByb21pc2U8Q2lyY3VpdEJyZWFrZXJSZXN1bHQ8VD4+IHtcbiAgcmV0dXJuIG1lcmNhZG9QYWdvU3RhbmRhcmRCcmVha2VyLmV4ZWN1dGUob3BlcmF0aW9uKVxufVxuXG4vKipcbiAqIFdyYXBwZXIgcGFyYSBwcm9jZXNhbWllbnRvIGRlIHdlYmhvb2tzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlV2ViaG9va1Byb2Nlc3Npbmc8VD4oXG4gIG9wZXJhdGlvbjogKCkgPT4gUHJvbWlzZTxUPlxuKTogUHJvbWlzZTxDaXJjdWl0QnJlYWtlclJlc3VsdDxUPj4ge1xuICByZXR1cm4gd2ViaG9va1Byb2Nlc3NpbmdCcmVha2VyLmV4ZWN1dGUob3BlcmF0aW9uKVxufVxuIl0sIm5hbWVzIjpbIkNJUkNVSVRfQlJFQUtFUl9DT05GSUdTIiwiQ2lyY3VpdEJyZWFrZXIiLCJDaXJjdWl0QnJlYWtlclN0YXRlIiwiZXhlY3V0ZU1lcmNhZG9QYWdvQ3JpdGljYWwiLCJleGVjdXRlTWVyY2Fkb1BhZ29TdGFuZGFyZCIsImV4ZWN1dGVXZWJob29rUHJvY2Vzc2luZyIsIm1lcmNhZG9QYWdvQ3JpdGljYWxCcmVha2VyIiwibWVyY2Fkb1BhZ29TdGFuZGFyZEJyZWFrZXIiLCJ3ZWJob29rUHJvY2Vzc2luZ0JyZWFrZXIiLCJNRVJDQURPUEFHT19DUklUSUNBTCIsImZhaWx1cmVUaHJlc2hvbGQiLCJyZWNvdmVyeVRpbWVvdXQiLCJtb25pdG9yaW5nV2luZG93IiwiaGFsZk9wZW5NYXhDYWxscyIsInN1Y2Nlc3NUaHJlc2hvbGQiLCJNRVJDQURPUEFHT19TVEFOREFSRCIsIldFQkhPT0tfUFJPQ0VTU0lORyIsIm5hbWUiLCJjb25maWciLCJzdGF0ZSIsImZhaWx1cmVzIiwic3VjY2Vzc2VzIiwibGFzdEZhaWx1cmVUaW1lIiwibGFzdFN1Y2Nlc3NUaW1lIiwiaGFsZk9wZW5DYWxscyIsInN0YXRlQ2hhbmdlcyIsIm1ldHJpY3MiLCJ0b3RhbENhbGxzIiwic3VjY2Vzc2Z1bENhbGxzIiwiZmFpbGVkQ2FsbHMiLCJyZWplY3RlZENhbGxzIiwibG9nZ2VyIiwiZGVidWciLCJMb2dMZXZlbCIsIkRFQlVHIiwiTG9nQ2F0ZWdvcnkiLCJTWVNURU0iLCJleGVjdXRlIiwib3BlcmF0aW9uIiwic3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsInNob3VsZFJlamVjdCIsInJlY29yZE1ldHJpY3MiLCJzdWNjZXNzIiwiZXJyb3IiLCJFcnJvciIsImV4ZWN1dGlvblRpbWUiLCJ3YXNSZWplY3RlZCIsInJlc3VsdCIsIm9uU3VjY2VzcyIsImRhdGEiLCJvbkZhaWx1cmUiLCJ0cmFuc2l0aW9uVG9IYWxmT3BlbiIsInRyYW5zaXRpb25Ub0Nsb3NlZCIsImlzSW5Nb25pdG9yaW5nV2luZG93Iiwid2FybiIsIldBUk4iLCJtZXNzYWdlIiwidHJhbnNpdGlvblRvT3BlbiIsInRocmVzaG9sZCIsImluZm8iLCJJTkZPIiwibWV0cmljc0NvbGxlY3RvciIsInJlY29yZE1ldHJpYyIsIkVSUk9SIiwiZ2V0U3RhdGUiLCJnZXRNZXRyaWNzIiwicmVzZXQiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0QywwREFBMEQ7QUFDMUQsc0NBQXNDOzs7Ozs7Ozs7Ozs7UUFzQnpCQTtlQUFBQTs7UUFpREFDO2VBQUFBOztRQWpFREM7ZUFBQUE7O1FBNFpVQztlQUFBQTs7UUFTQUM7ZUFBQUE7O1FBU0FDO2VBQUFBOztRQXBDVEM7ZUFBQUE7O1FBS0FDO2VBQUFBOztRQUtBQztlQUFBQTs7O3dCQXhaaUM7eUJBQ2I7QUFHMUIsSUFBQSxBQUFLTiw2Q0FBQUE7Ozs7V0FBQUE7O0FBZ0JMLE1BQU1GLDBCQUEwQjtJQUNyQ1Msc0JBQXNCO1FBQ3BCQyxrQkFBa0I7UUFDbEJDLGlCQUFpQjtRQUNqQkMsa0JBQWtCO1FBQ2xCQyxrQkFBa0I7UUFDbEJDLGtCQUFrQjtJQUNwQjtJQUNBQyxzQkFBc0I7UUFDcEJMLGtCQUFrQjtRQUNsQkMsaUJBQWlCO1FBQ2pCQyxrQkFBa0I7UUFDbEJDLGtCQUFrQjtRQUNsQkMsa0JBQWtCO0lBQ3BCO0lBQ0FFLG9CQUFvQjtRQUNsQk4sa0JBQWtCO1FBQ2xCQyxpQkFBaUI7UUFDakJDLGtCQUFrQjtRQUNsQkMsa0JBQWtCO1FBQ2xCQyxrQkFBa0I7SUFDcEI7QUFDRjtBQTJCTyxNQUFNYjtJQVVYLFlBQ0UsQUFBUWdCLElBQVksRUFDcEIsQUFBUUMsTUFBNEIsQ0FDcEM7YUFGUUQsT0FBQUE7YUFDQUMsU0FBQUE7YUFYRkM7YUFDQUMsV0FBbUI7YUFDbkJDLFlBQW9CO2FBQ3BCQyxrQkFBMEI7YUFDMUJDLGtCQUEwQjthQUMxQkMsZ0JBQXdCO2FBQ3hCQyxlQUF1QjtRQU83QixJQUFJLENBQUNDLE9BQU8sR0FBRztZQUNiQyxZQUFZO1lBQ1pDLGlCQUFpQjtZQUNqQkMsYUFBYTtZQUNiQyxlQUFlO1lBQ2ZSLGlCQUFpQjtZQUNqQkMsaUJBQWlCO1lBQ2pCRSxjQUFjO1FBQ2hCO1FBRUFNLGNBQU0sQ0FBQ0MsS0FBSyxDQUNWQyxnQkFBUSxDQUFDQyxLQUFLLEVBQ2QsQ0FBQyw2QkFBNkIsRUFBRWpCLE1BQU0sRUFDdEM7WUFDRUMsUUFBUSxJQUFJLENBQUNBLE1BQU07UUFDckIsR0FDQWlCLG1CQUFXLENBQUNDLE1BQU07SUFFdEI7SUFFQTs7R0FFQyxHQUNELE1BQU1DLFFBQVdDLFNBQTJCLEVBQW9DO1FBQzlFLE1BQU1DLFlBQVlDLEtBQUtDLEdBQUc7UUFDMUIsSUFBSSxDQUFDZixPQUFPLENBQUNDLFVBQVU7UUFFdkIsMkNBQTJDO1FBQzNDLElBQUksSUFBSSxDQUFDZSxZQUFZLElBQUk7WUFDdkIsSUFBSSxDQUFDaEIsT0FBTyxDQUFDSSxhQUFhO1lBRTFCLE1BQU0sSUFBSSxDQUFDYSxhQUFhLENBQUM7WUFFekIsT0FBTztnQkFDTEMsU0FBUztnQkFDVEMsT0FBTyxJQUFJQyxNQUFNLENBQUMsbUJBQW1CLEVBQUUsSUFBSSxDQUFDM0IsS0FBSyxDQUFDLHFCQUFxQixDQUFDO2dCQUN4RUEsT0FBTyxJQUFJLENBQUNBLEtBQUs7Z0JBQ2pCNEIsZUFBZVAsS0FBS0MsR0FBRyxLQUFLRjtnQkFDNUJTLGFBQWE7WUFDZjtRQUNGO1FBRUEsSUFBSTtZQUNGLHdCQUF3QjtZQUN4QixNQUFNQyxTQUFTLE1BQU1YO1lBRXJCLGtCQUFrQjtZQUNsQixNQUFNLElBQUksQ0FBQ1ksU0FBUztZQUVwQixNQUFNSCxnQkFBZ0JQLEtBQUtDLEdBQUcsS0FBS0Y7WUFDbkMsTUFBTSxJQUFJLENBQUNJLGFBQWEsQ0FBQyxXQUFXSTtZQUVwQyxPQUFPO2dCQUNMSCxTQUFTO2dCQUNUTyxNQUFNRjtnQkFDTjlCLE9BQU8sSUFBSSxDQUFDQSxLQUFLO2dCQUNqQjRCO2dCQUNBQyxhQUFhO1lBQ2Y7UUFDRixFQUFFLE9BQU9ILE9BQU87WUFDZCxrQkFBa0I7WUFDbEIsTUFBTSxJQUFJLENBQUNPLFNBQVMsQ0FBQ1A7WUFFckIsTUFBTUUsZ0JBQWdCUCxLQUFLQyxHQUFHLEtBQUtGO1lBQ25DLE1BQU0sSUFBSSxDQUFDSSxhQUFhLENBQUMsV0FBV0k7WUFFcEMsT0FBTztnQkFDTEgsU0FBUztnQkFDVEMsT0FBT0E7Z0JBQ1AxQixPQUFPLElBQUksQ0FBQ0EsS0FBSztnQkFDakI0QjtnQkFDQUMsYUFBYTtZQUNmO1FBQ0Y7SUFDRjtJQUVBOztHQUVDLEdBQ0QsQUFBUU4sZUFBd0I7UUFDOUIsTUFBTUQsTUFBTUQsS0FBS0MsR0FBRztRQUVwQixPQUFRLElBQUksQ0FBQ3RCLEtBQUs7WUFDaEI7Z0JBQ0UsT0FBTztZQUVUO2dCQUNFLGtEQUFrRDtnQkFDbEQsSUFBSXNCLE1BQU0sSUFBSSxDQUFDbkIsZUFBZSxJQUFJLElBQUksQ0FBQ0osTUFBTSxDQUFDUCxlQUFlLEVBQUU7b0JBQzdELElBQUksQ0FBQzBDLG9CQUFvQjtvQkFDekIsT0FBTztnQkFDVDtnQkFDQSxPQUFPO1lBRVQ7Z0JBQ0UsdUNBQXVDO2dCQUN2QyxPQUFPLElBQUksQ0FBQzdCLGFBQWEsSUFBSSxJQUFJLENBQUNOLE1BQU0sQ0FBQ0wsZ0JBQWdCO1lBRTNEO2dCQUNFLE9BQU87UUFDWDtJQUNGO0lBRUE7O0dBRUMsR0FDRCxNQUFjcUMsWUFBMkI7UUFDdkMsSUFBSSxDQUFDM0IsZUFBZSxHQUFHaUIsS0FBS0MsR0FBRztRQUMvQixJQUFJLENBQUNmLE9BQU8sQ0FBQ0UsZUFBZTtRQUU1QixPQUFRLElBQUksQ0FBQ1QsS0FBSztZQUNoQjtnQkFDRSxJQUFJLENBQUNFLFNBQVM7Z0JBQ2QsSUFBSSxDQUFDRyxhQUFhO2dCQUVsQixJQUFJLElBQUksQ0FBQ0gsU0FBUyxJQUFJLElBQUksQ0FBQ0gsTUFBTSxDQUFDSixnQkFBZ0IsRUFBRTtvQkFDbEQsSUFBSSxDQUFDd0Msa0JBQWtCO2dCQUN6QjtnQkFDQTtZQUVGO2dCQUNFLGdEQUFnRDtnQkFDaEQsSUFBSSxJQUFJLENBQUNDLG9CQUFvQixJQUFJO29CQUMvQixJQUFJLENBQUNuQyxRQUFRLEdBQUc7Z0JBQ2xCO2dCQUNBO1FBQ0o7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBY2dDLFVBQVVQLEtBQVksRUFBaUI7UUFDbkQsSUFBSSxDQUFDdkIsZUFBZSxHQUFHa0IsS0FBS0MsR0FBRztRQUMvQixJQUFJLENBQUNmLE9BQU8sQ0FBQ0csV0FBVztRQUN4QixJQUFJLENBQUNULFFBQVE7UUFFYlcsY0FBTSxDQUFDeUIsSUFBSSxDQUNUdkIsZ0JBQVEsQ0FBQ3dCLElBQUksRUFDYixDQUFDLHlCQUF5QixFQUFFLElBQUksQ0FBQ3hDLElBQUksRUFBRSxFQUN2QztZQUNFNEIsT0FBT0EsTUFBTWEsT0FBTztZQUNwQnRDLFVBQVUsSUFBSSxDQUFDQSxRQUFRO1lBQ3ZCRCxPQUFPLElBQUksQ0FBQ0EsS0FBSztRQUNuQixHQUNBZ0IsbUJBQVcsQ0FBQ0MsTUFBTTtRQUdwQixPQUFRLElBQUksQ0FBQ2pCLEtBQUs7WUFDaEI7Z0JBQ0UsSUFBSSxJQUFJLENBQUNDLFFBQVEsSUFBSSxJQUFJLENBQUNGLE1BQU0sQ0FBQ1IsZ0JBQWdCLEVBQUU7b0JBQ2pELElBQUksQ0FBQ2lELGdCQUFnQjtnQkFDdkI7Z0JBQ0E7WUFFRjtnQkFDRSxJQUFJLENBQUNBLGdCQUFnQjtnQkFDckI7UUFDSjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxBQUFRQSxtQkFBeUI7UUFDL0IsSUFBSSxDQUFDeEMsS0FBSztRQUNWLElBQUksQ0FBQ00sWUFBWTtRQUNqQixJQUFJLENBQUNDLE9BQU8sQ0FBQ0QsWUFBWTtRQUN6QixJQUFJLENBQUNELGFBQWEsR0FBRztRQUNyQixJQUFJLENBQUNILFNBQVMsR0FBRztRQUVqQlUsY0FBTSxDQUFDeUIsSUFBSSxDQUNUdkIsZ0JBQVEsQ0FBQ3dCLElBQUksRUFDYixDQUFDLHdCQUF3QixFQUFFLElBQUksQ0FBQ3hDLElBQUksRUFBRSxFQUN0QztZQUNFRyxVQUFVLElBQUksQ0FBQ0EsUUFBUTtZQUN2QndDLFdBQVcsSUFBSSxDQUFDMUMsTUFBTSxDQUFDUixnQkFBZ0I7UUFDekMsR0FDQXlCLG1CQUFXLENBQUNDLE1BQU07SUFFdEI7SUFFQTs7R0FFQyxHQUNELEFBQVFpQix1QkFBNkI7UUFDbkMsSUFBSSxDQUFDbEMsS0FBSztRQUNWLElBQUksQ0FBQ00sWUFBWTtRQUNqQixJQUFJLENBQUNDLE9BQU8sQ0FBQ0QsWUFBWTtRQUN6QixJQUFJLENBQUNELGFBQWEsR0FBRztRQUNyQixJQUFJLENBQUNILFNBQVMsR0FBRztRQUVqQlUsY0FBTSxDQUFDOEIsSUFBSSxDQUNUNUIsZ0JBQVEsQ0FBQzZCLElBQUksRUFDYixDQUFDLDJCQUEyQixFQUFFLElBQUksQ0FBQzdDLElBQUksRUFBRSxFQUN6QztZQUNFTixpQkFBaUIsSUFBSSxDQUFDTyxNQUFNLENBQUNQLGVBQWU7UUFDOUMsR0FDQXdCLG1CQUFXLENBQUNDLE1BQU07SUFFdEI7SUFFQTs7R0FFQyxHQUNELEFBQVFrQixxQkFBMkI7UUFDakMsSUFBSSxDQUFDbkMsS0FBSztRQUNWLElBQUksQ0FBQ00sWUFBWTtRQUNqQixJQUFJLENBQUNDLE9BQU8sQ0FBQ0QsWUFBWTtRQUN6QixJQUFJLENBQUNMLFFBQVEsR0FBRztRQUNoQixJQUFJLENBQUNDLFNBQVMsR0FBRztRQUNqQixJQUFJLENBQUNHLGFBQWEsR0FBRztRQUVyQk8sY0FBTSxDQUFDOEIsSUFBSSxDQUNUNUIsZ0JBQVEsQ0FBQzZCLElBQUksRUFDYixDQUFDLHdCQUF3QixFQUFFLElBQUksQ0FBQzdDLElBQUksRUFBRSxFQUN0QztZQUNFSCxrQkFBa0IsSUFBSSxDQUFDSSxNQUFNLENBQUNKLGdCQUFnQjtRQUNoRCxHQUNBcUIsbUJBQVcsQ0FBQ0MsTUFBTTtJQUV0QjtJQUVBOztHQUVDLEdBQ0QsQUFBUW1CLHVCQUFnQztRQUN0QyxNQUFNZCxNQUFNRCxLQUFLQyxHQUFHO1FBQ3BCLE9BQU9BLE1BQU0sSUFBSSxDQUFDbkIsZUFBZSxJQUFJLElBQUksQ0FBQ0osTUFBTSxDQUFDTixnQkFBZ0I7SUFDbkU7SUFFQTs7R0FFQyxHQUNELE1BQWMrQixjQUNaTCxTQUE2QyxFQUM3Q1MsYUFBc0IsRUFDUDtRQUNmLElBQUk7WUFDRixNQUFNZ0IseUJBQWdCLENBQUNDLFlBQVksQ0FBQyxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQy9DLElBQUksQ0FBQyxDQUFDLEVBQUVxQixXQUFXLEVBQUUsR0FBRztnQkFDbEZuQixPQUFPLElBQUksQ0FBQ0EsS0FBSztnQkFDakJtQjtZQUNGO1lBRUEsSUFBSVMsZUFBZTtnQkFDakIsTUFBTWdCLHlCQUFnQixDQUFDQyxZQUFZLENBQ2pDLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDL0MsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUM3QzhCLGVBQ0E7b0JBQUU1QixPQUFPLElBQUksQ0FBQ0EsS0FBSztnQkFBQztZQUV4QjtZQUVBLHFCQUFxQjtZQUNyQixNQUFNNEMseUJBQWdCLENBQUNDLFlBQVksQ0FDakMsQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMvQyxJQUFJLENBQUMsY0FBYyxDQUFDLEVBQzVDLElBQUksQ0FBQ1EsWUFBWTtZQUVuQixNQUFNc0MseUJBQWdCLENBQUNDLFlBQVksQ0FDakMsQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMvQyxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQzNDLElBQUksQ0FBQ1MsT0FBTyxDQUFDQyxVQUFVLEdBQUcsSUFBSSxJQUFJLENBQUNELE9BQU8sQ0FBQ0csV0FBVyxHQUFHLElBQUksQ0FBQ0gsT0FBTyxDQUFDQyxVQUFVLEdBQUc7UUFFdkYsRUFBRSxPQUFPa0IsT0FBTztZQUNkZCxjQUFNLENBQUNjLEtBQUssQ0FDVlosZ0JBQVEsQ0FBQ2dDLEtBQUssRUFDZCxDQUFDLDBDQUEwQyxFQUFFLElBQUksQ0FBQ2hELElBQUksRUFBRSxFQUN4RDtnQkFDRTRCLE9BQU9BLGlCQUFpQkMsUUFBUUQsTUFBTWEsT0FBTyxHQUFHO1lBQ2xELEdBQ0F2QixtQkFBVyxDQUFDQyxNQUFNO1FBRXRCO0lBQ0Y7SUFFQTs7R0FFQyxHQUNEOEIsV0FBZ0M7UUFDOUIsT0FBTyxJQUFJLENBQUMvQyxLQUFLO0lBQ25CO0lBRUE7O0dBRUMsR0FDRGdELGFBR0U7UUFDQSxPQUFPO1lBQ0wsR0FBRyxJQUFJLENBQUN6QyxPQUFPO1lBQ2ZQLE9BQU8sSUFBSSxDQUFDQSxLQUFLO1lBQ2pCRCxRQUFRLElBQUksQ0FBQ0EsTUFBTTtRQUNyQjtJQUNGO0lBRUE7O0dBRUMsR0FDRGtELFFBQWM7UUFDWixJQUFJLENBQUNqRCxLQUFLO1FBQ1YsSUFBSSxDQUFDQyxRQUFRLEdBQUc7UUFDaEIsSUFBSSxDQUFDQyxTQUFTLEdBQUc7UUFDakIsSUFBSSxDQUFDRyxhQUFhLEdBQUc7UUFDckIsSUFBSSxDQUFDRixlQUFlLEdBQUc7UUFDdkIsSUFBSSxDQUFDQyxlQUFlLEdBQUc7UUFFdkJRLGNBQU0sQ0FBQzhCLElBQUksQ0FDVDVCLGdCQUFRLENBQUM2QixJQUFJLEVBQ2IsQ0FBQyxnQ0FBZ0MsRUFBRSxJQUFJLENBQUM3QyxJQUFJLEVBQUUsRUFDOUMsQ0FBQyxHQUNEa0IsbUJBQVcsQ0FBQ0MsTUFBTTtJQUV0QjtBQUNGO0FBR08sTUFBTTlCLDZCQUE2QixJQUFJTCxlQUM1Qyx3QkFDQUQsd0JBQXdCUyxvQkFBb0I7QUFHdkMsTUFBTUYsNkJBQTZCLElBQUlOLGVBQzVDLHdCQUNBRCx3QkFBd0JlLG9CQUFvQjtBQUd2QyxNQUFNUCwyQkFBMkIsSUFBSVAsZUFDMUMsc0JBQ0FELHdCQUF3QmdCLGtCQUFrQjtBQU1yQyxlQUFlYiwyQkFDcEJtQyxTQUEyQjtJQUUzQixPQUFPaEMsMkJBQTJCK0IsT0FBTyxDQUFDQztBQUM1QztBQUtPLGVBQWVsQywyQkFDcEJrQyxTQUEyQjtJQUUzQixPQUFPL0IsMkJBQTJCOEIsT0FBTyxDQUFDQztBQUM1QztBQUtPLGVBQWVqQyx5QkFDcEJpQyxTQUEyQjtJQUUzQixPQUFPOUIseUJBQXlCNkIsT0FBTyxDQUFDQztBQUMxQyJ9