{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\lib\\seo\\seo-analytics-manager.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - SEO ANALYTICS MANAGER - ENHANCED\r\n// Sistema avanzado de análisis y monitoreo SEO en tiempo real\r\n// Incluye tracking de rankings, métricas de performance y reportes automatizados\r\n// ===================================\r\n\r\nimport { logger, LogCategory, LogLevel } from '@/lib/enterprise/logger';\r\nimport { getRedisClient } from '@/lib/integrations/redis';\r\nimport { realTimePerformanceMonitor } from '@/lib/monitoring/real-time-performance-monitor';\r\nimport { advancedAlertingEngine, AlertType, AlertSeverity } from '@/lib/monitoring/advanced-alerting-engine';\r\n\r\n// ===================================\r\n// INTERFACES Y TIPOS MEJORADOS\r\n// ===================================\r\n\r\n// Tipos para métricas SEO mejoradas\r\nexport interface SEOMetrics {\r\n  pageViews: number;\r\n  uniqueVisitors: number;\r\n  bounceRate: number;\r\n  avgSessionDuration: number;\r\n  organicTraffic: number;\r\n  searchImpressions: number;\r\n  searchClicks: number;\r\n  avgPosition: number;\r\n  ctr: number; // Click Through Rate\r\n  coreWebVitals: CoreWebVitals;\r\n  indexationStatus: IndexationStatus;\r\n  technicalSEO: TechnicalSEOMetrics;\r\n  timestamp: Date;\r\n\r\n  // Nuevas métricas avanzadas\r\n  conversionRate: number;\r\n  revenueFromOrganic: number;\r\n  topLandingPages: PageMetrics[];\r\n  topExitPages: PageMetrics[];\r\n  deviceBreakdown: DeviceMetrics;\r\n  geographicData: GeographicMetrics[];\r\n}\r\n\r\n// Nuevas interfaces para métricas avanzadas\r\nexport interface PageMetrics {\r\n  url: string;\r\n  pageViews: number;\r\n  uniquePageViews: number;\r\n  avgTimeOnPage: number;\r\n  bounceRate: number;\r\n  exitRate: number;\r\n  conversions: number;\r\n  revenue: number;\r\n}\r\n\r\nexport interface DeviceMetrics {\r\n  desktop: {\r\n    sessions: number;\r\n    bounceRate: number;\r\n    conversionRate: number;\r\n    avgSessionDuration: number;\r\n  };\r\n  mobile: {\r\n    sessions: number;\r\n    bounceRate: number;\r\n    conversionRate: number;\r\n    avgSessionDuration: number;\r\n  };\r\n  tablet: {\r\n    sessions: number;\r\n    bounceRate: number;\r\n    conversionRate: number;\r\n    avgSessionDuration: number;\r\n  };\r\n}\r\n\r\nexport interface GeographicMetrics {\r\n  country: string;\r\n  region: string;\r\n  city: string;\r\n  sessions: number;\r\n  users: number;\r\n  bounceRate: number;\r\n  conversionRate: number;\r\n  revenue: number;\r\n}\r\n\r\nexport interface CoreWebVitals {\r\n  lcp: number; // Largest Contentful Paint\r\n  fid: number; // First Input Delay\r\n  cls: number; // Cumulative Layout Shift\r\n  fcp: number; // First Contentful Paint\r\n  ttfb: number; // Time to First Byte\r\n  inp: number; // Interaction to Next Paint\r\n  score: 'good' | 'needs-improvement' | 'poor';\r\n\r\n  // Métricas adicionales\r\n  speedIndex: number;\r\n  totalBlockingTime: number;\r\n  largestContentfulPaintElement: string;\r\n  cumulativeLayoutShiftSources: string[];\r\n}\r\n\r\nexport interface IndexationStatus {\r\n  totalPages: number;\r\n  indexedPages: number;\r\n  notIndexedPages: number;\r\n  indexationRate: number;\r\n  crawlErrors: number;\r\n  sitemapStatus: 'submitted' | 'processed' | 'error';\r\n  lastCrawlDate: Date;\r\n}\r\n\r\nexport interface TechnicalSEOMetrics {\r\n  mobileUsability: number;\r\n  pagespeedScore: number;\r\n  httpsUsage: number;\r\n  structuredDataErrors: number;\r\n  metaTagsOptimization: number;\r\n  internalLinkingScore: number;\r\n  imageOptimization: number;\r\n  canonicalIssues: number;\r\n}\r\n\r\nexport interface KeywordMetrics {\r\n  keyword: string;\r\n  position: number;\r\n  previousPosition: number;\r\n  searchVolume: number;\r\n  difficulty: number;\r\n  clicks: number;\r\n  impressions: number;\r\n  ctr: number;\r\n  url: string;\r\n  trend: 'up' | 'down' | 'stable';\r\n\r\n  // Métricas avanzadas de keywords\r\n  searchEngine: 'google' | 'bing' | 'yahoo' | 'duckduckgo';\r\n  device: 'desktop' | 'mobile' | 'tablet';\r\n  location: string;\r\n  intent: 'informational' | 'navigational' | 'transactional' | 'commercial';\r\n  competitorRankings: CompetitorKeywordData[];\r\n  relatedKeywords: string[];\r\n  seasonalTrends: SeasonalData[];\r\n  conversionRate: number;\r\n  revenue: number;\r\n  costPerClick: number;\r\n  lastUpdated: Date;\r\n}\r\n\r\nexport interface CompetitorKeywordData {\r\n  domain: string;\r\n  position: number;\r\n  url: string;\r\n  title: string;\r\n  description: string;\r\n}\r\n\r\nexport interface SeasonalData {\r\n  month: number;\r\n  searchVolume: number;\r\n  competition: number;\r\n  cpc: number;\r\n}\r\n\r\nexport interface CompetitorAnalysis {\r\n  competitor: string;\r\n  domain: string;\r\n  organicKeywords: number;\r\n  organicTraffic: number;\r\n  backlinks: number;\r\n  domainAuthority: number;\r\n  commonKeywords: string[];\r\n  keywordGaps: string[];\r\n\r\n  // Análisis avanzado de competidores\r\n  pageAuthority: number;\r\n  trustFlow: number;\r\n  citationFlow: number;\r\n  referringDomains: number;\r\n  organicCost: number;\r\n  paidKeywords: number;\r\n  paidTraffic: number;\r\n  paidCost: number;\r\n  topPages: CompetitorPage[];\r\n  contentGaps: ContentGap[];\r\n  backlinksGaps: BacklinkGap[];\r\n  socialMetrics: SocialMetrics;\r\n  technicalSEOScore: number;\r\n  lastAnalyzed: Date;\r\n}\r\n\r\nexport interface CompetitorPage {\r\n  url: string;\r\n  title: string;\r\n  traffic: number;\r\n  keywords: number;\r\n  backlinks: number;\r\n  socialShares: number;\r\n}\r\n\r\nexport interface ContentGap {\r\n  topic: string;\r\n  keywords: string[];\r\n  searchVolume: number;\r\n  difficulty: number;\r\n  opportunity: 'high' | 'medium' | 'low';\r\n}\r\n\r\nexport interface BacklinkGap {\r\n  domain: string;\r\n  domainAuthority: number;\r\n  linkType: 'dofollow' | 'nofollow';\r\n  anchorText: string;\r\n  opportunity: 'high' | 'medium' | 'low';\r\n}\r\n\r\nexport interface SocialMetrics {\r\n  facebook: {\r\n    likes: number;\r\n    shares: number;\r\n    comments: number;\r\n  };\r\n  twitter: {\r\n    followers: number;\r\n    tweets: number;\r\n    retweets: number;\r\n  };\r\n  linkedin: {\r\n    followers: number;\r\n    posts: number;\r\n    engagement: number;\r\n  };\r\n  instagram: {\r\n    followers: number;\r\n    posts: number;\r\n    engagement: number;\r\n  };\r\n}\r\n\r\nexport interface SEOAlert {\r\n  id: string;\r\n  type: 'critical' | 'warning' | 'info';\r\n  category: 'technical' | 'content' | 'performance' | 'indexation' | 'security' | 'mobile' | 'schema';\r\n  title: string;\r\n  description: string;\r\n  url?: string;\r\n  severity: number;\r\n  timestamp: Date;\r\n  resolved: boolean;\r\n  recommendations: string[];\r\n\r\n  // Campos avanzados para alertas\r\n  impact: 'high' | 'medium' | 'low';\r\n  effort: 'low' | 'medium' | 'high';\r\n  priority: number;\r\n  affectedPages: string[];\r\n  estimatedTrafficImpact: number;\r\n  estimatedRevenueImpact: number;\r\n  relatedAlerts: string[];\r\n  autoResolvable: boolean;\r\n  resolutionSteps: ResolutionStep[];\r\n  lastOccurrence: Date;\r\n  frequency: number;\r\n  tags: string[];\r\n}\r\n\r\nexport interface ResolutionStep {\r\n  step: number;\r\n  description: string;\r\n  action: string;\r\n  estimatedTime: number; // minutos\r\n  difficulty: 'easy' | 'medium' | 'hard';\r\n  requiredSkills: string[];\r\n}\r\n\r\nexport interface SEOReport {\r\n  id: string;\r\n  period: 'daily' | 'weekly' | 'monthly' | 'quarterly' | 'yearly' | 'custom';\r\n  startDate: Date;\r\n  endDate: Date;\r\n  metrics: SEOMetrics;\r\n  keywords: KeywordMetrics[];\r\n  alerts: SEOAlert[];\r\n  recommendations: SEORecommendation[];\r\n  competitorAnalysis?: CompetitorAnalysis[];\r\n\r\n  // Secciones avanzadas del reporte\r\n  executiveSummary: ExecutiveSummary;\r\n  performanceAnalysis: PerformanceAnalysis;\r\n  keywordAnalysis: KeywordAnalysis;\r\n  technicalAnalysis: TechnicalAnalysis;\r\n  contentAnalysis: ContentAnalysis;\r\n  competitiveAnalysis: CompetitiveAnalysis;\r\n  actionPlan: ActionPlan;\r\n\r\n  // Metadatos del reporte\r\n  generatedBy: string;\r\n  generatedAt: Date;\r\n  version: string;\r\n  exportFormats: ('pdf' | 'excel' | 'csv' | 'json')[];\r\n  scheduledDelivery: ScheduledDelivery[];\r\n}\r\n\r\nexport interface SEORecommendation {\r\n  id: string;\r\n  category: 'technical' | 'content' | 'performance' | 'mobile' | 'schema' | 'keywords';\r\n  title: string;\r\n  description: string;\r\n  priority: 'high' | 'medium' | 'low';\r\n  impact: 'high' | 'medium' | 'low';\r\n  effort: 'low' | 'medium' | 'high';\r\n  estimatedTimeToImplement: number; // días\r\n  estimatedTrafficIncrease: number; // porcentaje\r\n  estimatedRevenueIncrease: number; // monto\r\n  implementationSteps: string[];\r\n  requiredResources: string[];\r\n  kpis: string[];\r\n  relatedRecommendations: string[];\r\n  status: 'pending' | 'in-progress' | 'completed' | 'dismissed';\r\n  assignedTo?: string;\r\n  dueDate?: Date;\r\n  completedDate?: Date;\r\n  notes: string[];\r\n}\r\n\r\nexport interface ExecutiveSummary {\r\n  overallScore: number;\r\n  scoreChange: number;\r\n  keyAchievements: string[];\r\n  majorConcerns: string[];\r\n  quickWins: string[];\r\n  budgetRecommendations: BudgetRecommendation[];\r\n}\r\n\r\nexport interface BudgetRecommendation {\r\n  category: string;\r\n  description: string;\r\n  estimatedCost: number;\r\n  expectedROI: number;\r\n  timeframe: string;\r\n}\r\n\r\n// Interfaces adicionales para análisis avanzado\r\nexport interface PerformanceAnalysis {\r\n  coreWebVitalsScore: number;\r\n  coreWebVitalsChange: number;\r\n  pageSpeedScore: number;\r\n  pageSpeedChange: number;\r\n  mobileScore: number;\r\n  mobileChange: number;\r\n  slowestPages: PagePerformance[];\r\n  performanceRecommendations: string[];\r\n}\r\n\r\nexport interface PagePerformance {\r\n  url: string;\r\n  lcp: number;\r\n  fid: number;\r\n  cls: number;\r\n  speedIndex: number;\r\n  totalBlockingTime: number;\r\n  issues: string[];\r\n}\r\n\r\nexport interface KeywordAnalysis {\r\n  totalKeywords: number;\r\n  keywordsChange: number;\r\n  averagePosition: number;\r\n  positionChange: number;\r\n  topGainers: KeywordMetrics[];\r\n  topLosers: KeywordMetrics[];\r\n  newKeywords: KeywordMetrics[];\r\n  lostKeywords: KeywordMetrics[];\r\n  opportunityKeywords: KeywordMetrics[];\r\n}\r\n\r\nexport interface TechnicalAnalysis {\r\n  crawlabilityScore: number;\r\n  indexabilityScore: number;\r\n  structuredDataScore: number;\r\n  mobileUsabilityScore: number;\r\n  securityScore: number;\r\n  technicalIssues: TechnicalIssue[];\r\n  improvements: string[];\r\n}\r\n\r\nexport interface TechnicalIssue {\r\n  type: string;\r\n  severity: 'high' | 'medium' | 'low';\r\n  count: number;\r\n  affectedPages: string[];\r\n  description: string;\r\n  fix: string;\r\n}\r\n\r\nexport interface ContentAnalysis {\r\n  totalPages: number;\r\n  indexedPages: number;\r\n  duplicateContent: number;\r\n  thinContent: number;\r\n  missingMetaTags: number;\r\n  contentQualityScore: number;\r\n  topPerformingContent: ContentMetrics[];\r\n  contentGaps: string[];\r\n}\r\n\r\nexport interface ContentMetrics {\r\n  url: string;\r\n  title: string;\r\n  wordCount: number;\r\n  readabilityScore: number;\r\n  organicTraffic: number;\r\n  socialShares: number;\r\n  backlinks: number;\r\n  conversionRate: number;\r\n}\r\n\r\nexport interface CompetitiveAnalysis {\r\n  marketShare: number;\r\n  visibilityScore: number;\r\n  competitorComparison: CompetitorComparison[];\r\n  opportunityAnalysis: OpportunityAnalysis[];\r\n}\r\n\r\nexport interface CompetitorComparison {\r\n  competitor: string;\r\n  ourPosition: number;\r\n  theirPosition: number;\r\n  gap: number;\r\n  opportunity: 'high' | 'medium' | 'low';\r\n}\r\n\r\nexport interface OpportunityAnalysis {\r\n  type: 'keyword' | 'content' | 'backlink' | 'technical';\r\n  description: string;\r\n  potential: number;\r\n  difficulty: number;\r\n  priority: 'high' | 'medium' | 'low';\r\n}\r\n\r\nexport interface ActionPlan {\r\n  quickWins: ActionItem[];\r\n  shortTerm: ActionItem[];\r\n  longTerm: ActionItem[];\r\n  ongoing: ActionItem[];\r\n}\r\n\r\nexport interface ActionItem {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  category: string;\r\n  priority: 'high' | 'medium' | 'low';\r\n  effort: 'low' | 'medium' | 'high';\r\n  impact: 'high' | 'medium' | 'low';\r\n  estimatedTime: number;\r\n  assignee?: string;\r\n  dueDate?: Date;\r\n  dependencies: string[];\r\n  kpis: string[];\r\n}\r\n\r\nexport interface ScheduledDelivery {\r\n  email: string;\r\n  frequency: 'daily' | 'weekly' | 'monthly';\r\n  format: 'pdf' | 'excel' | 'summary';\r\n  enabled: boolean;\r\n}\r\n\r\n// Configuración avanzada del sistema\r\nexport interface SEOAnalyticsConfig {\r\n  enableRealTimeTracking: boolean;\r\n  enableKeywordTracking: boolean;\r\n  enableCompetitorAnalysis: boolean;\r\n  enableAutomatedReports: boolean;\r\n  enableAlerts: boolean;\r\n\r\n  // Intervalos de actualización\r\n  metricsUpdateInterval: number; // minutos\r\n  keywordUpdateInterval: number; // horas\r\n  competitorUpdateInterval: number; // días\r\n  alertCheckInterval: number; // minutos\r\n\r\n  // Configuración de reportes\r\n  reportSchedule: {\r\n    daily: { enabled: boolean; time: string; recipients: string[] };\r\n    weekly: { enabled: boolean; day: number; time: string; recipients: string[] };\r\n    monthly: { enabled: boolean; day: number; time: string; recipients: string[] };\r\n  };\r\n\r\n  // Thresholds para alertas\r\n  alertThresholds: {\r\n    seoScoreDrop: number;\r\n    rankingDrop: number;\r\n    trafficDrop: number;\r\n    performanceDrop: number;\r\n    criticalIssuesIncrease: number;\r\n    conversionRateDrop: number;\r\n  };\r\n\r\n  // Integraciones externas\r\n  integrations: {\r\n    googleSearchConsole: { enabled: boolean; credentials?: any };\r\n    googleAnalytics: { enabled: boolean; credentials?: any };\r\n    semrush: { enabled: boolean; apiKey?: string };\r\n    ahrefs: { enabled: boolean; apiKey?: string };\r\n    screaminFrog: { enabled: boolean; apiKey?: string };\r\n  };\r\n\r\n  // Configuración de cache y almacenamiento\r\n  cache: {\r\n    enabled: boolean;\r\n    ttl: number;\r\n    maxSize: number;\r\n  };\r\n\r\n  dataRetention: {\r\n    metricsRetentionDays: number;\r\n    alertsRetentionDays: number;\r\n    reportsRetentionDays: number;\r\n  };\r\n}\r\n\r\n// Configuración por defecto\r\nconst DEFAULT_SEO_CONFIG: SEOAnalyticsConfig = {\r\n  enableRealTimeTracking: true,\r\n  enableKeywordTracking: true,\r\n  enableCompetitorAnalysis: true,\r\n  enableAutomatedReports: true,\r\n  enableAlerts: true,\r\n\r\n  metricsUpdateInterval: 15,\r\n  keywordUpdateInterval: 24,\r\n  competitorUpdateInterval: 7,\r\n  alertCheckInterval: 5,\r\n\r\n  reportSchedule: {\r\n    daily: { enabled: true, time: '09:00', recipients: [] },\r\n    weekly: { enabled: true, day: 1, time: '09:00', recipients: [] },\r\n    monthly: { enabled: true, day: 1, time: '09:00', recipients: [] }\r\n  },\r\n\r\n  alertThresholds: {\r\n    seoScoreDrop: 10,\r\n    rankingDrop: 5,\r\n    trafficDrop: 20,\r\n    performanceDrop: 15,\r\n    criticalIssuesIncrease: 3,\r\n    conversionRateDrop: 25\r\n  },\r\n\r\n  integrations: {\r\n    googleSearchConsole: { enabled: false },\r\n    googleAnalytics: { enabled: false },\r\n    semrush: { enabled: false },\r\n    ahrefs: { enabled: false },\r\n    screaminFrog: { enabled: false }\r\n  },\r\n\r\n  cache: {\r\n    enabled: true,\r\n    ttl: 3600,\r\n    maxSize: 1000\r\n  },\r\n\r\n  dataRetention: {\r\n    metricsRetentionDays: 90,\r\n    alertsRetentionDays: 30,\r\n    reportsRetentionDays: 365\r\n  }\r\n};\r\n\r\n// ===================================\r\n// ENHANCED SEO ANALYTICS MANAGER CLASS\r\n// ===================================\r\n\r\nexport class EnhancedSEOAnalyticsManager {\r\n  private static instance: EnhancedSEOAnalyticsManager;\r\n  private config: SEOAnalyticsConfig;\r\n  private metrics: SEOMetrics[] = [];\r\n  private keywords: KeywordMetrics[] = [];\r\n  private alerts: SEOAlert[] = [];\r\n  private reports: SEOReport[] = [];\r\n  private competitors: CompetitorAnalysis[] = [];\r\n  private listeners: ((data: any) => void)[] = [];\r\n  private cache: Map<string, { data: any; timestamp: number }> = new Map();\r\n  private redis: any;\r\n\r\n  // Intervalos de tracking\r\n  private metricsInterval: NodeJS.Timeout | null = null;\r\n  private keywordInterval: NodeJS.Timeout | null = null;\r\n  private competitorInterval: NodeJS.Timeout | null = null;\r\n  private alertInterval: NodeJS.Timeout | null = null;\r\n\r\n  private constructor(config?: Partial<SEOAnalyticsConfig>) {\r\n    this.config = { ...DEFAULT_SEO_CONFIG, ...config };\r\n    this.initializeRedis();\r\n    this.startTracking();\r\n\r\n    logger.info(LogLevel.INFO, 'Enhanced SEO Analytics Manager initialized', {\r\n      realTimeTracking: this.config.enableRealTimeTracking,\r\n      keywordTracking: this.config.enableKeywordTracking,\r\n      competitorAnalysis: this.config.enableCompetitorAnalysis,\r\n      automatedReports: this.config.enableAutomatedReports\r\n    }, LogCategory.SEO);\r\n  }\r\n\r\n  public static getInstance(config?: Partial<SEOAnalyticsConfig>): EnhancedSEOAnalyticsManager {\r\n    if (!EnhancedSEOAnalyticsManager.instance) {\r\n      EnhancedSEOAnalyticsManager.instance = new EnhancedSEOAnalyticsManager(config);\r\n    }\r\n    return EnhancedSEOAnalyticsManager.instance;\r\n  }\r\n\r\n  private async initializeRedis(): Promise<void> {\r\n    try {\r\n      this.redis = await getRedisClient();\r\n      logger.info(LogLevel.INFO, 'Redis initialized for SEO analytics', {}, LogCategory.SEO);\r\n    } catch (error) {\r\n      logger.warn(LogLevel.WARN, 'Redis not available for SEO analytics', {}, LogCategory.SEO);\r\n    }\r\n  }\r\n\r\n  // ===================================\r\n  // TRACKING Y RECOPILACIÓN DE MÉTRICAS\r\n  // ===================================\r\n\r\n  private startTracking(): void {\r\n    if (this.config.enableRealTimeTracking) {\r\n      this.metricsInterval = setInterval(() => {\r\n        this.collectAndProcessMetrics();\r\n      }, this.config.metricsUpdateInterval * 60 * 1000);\r\n    }\r\n\r\n    if (this.config.enableKeywordTracking) {\r\n      this.keywordInterval = setInterval(() => {\r\n        this.updateKeywordRankings();\r\n      }, this.config.keywordUpdateInterval * 60 * 60 * 1000);\r\n    }\r\n\r\n    if (this.config.enableCompetitorAnalysis) {\r\n      this.competitorInterval = setInterval(() => {\r\n        this.updateCompetitorAnalysis();\r\n      }, this.config.competitorUpdateInterval * 24 * 60 * 60 * 1000);\r\n    }\r\n\r\n    if (this.config.enableAlerts) {\r\n      this.alertInterval = setInterval(() => {\r\n        this.checkAlerts();\r\n      }, this.config.alertCheckInterval * 60 * 1000);\r\n    }\r\n\r\n    logger.info(LogLevel.INFO, 'SEO tracking started', {\r\n      metricsInterval: this.config.metricsUpdateInterval,\r\n      keywordInterval: this.config.keywordUpdateInterval,\r\n      competitorInterval: this.config.competitorUpdateInterval,\r\n      alertInterval: this.config.alertCheckInterval\r\n    }, LogCategory.SEO);\r\n  }\r\n\r\n  private async collectAndProcessMetrics(): Promise<void> {\r\n    try {\r\n      const coreWebVitals = await this.collectCoreWebVitals();\r\n      const indexationStatus = await this.analyzeIndexationStatus();\r\n      const technicalSEO = await this.evaluateTechnicalSEO();\r\n\r\n      // Obtener métricas del performance monitor\r\n      const performanceMetrics = realTimePerformanceMonitor.getCurrentMetrics();\r\n\r\n      // Procesar métricas de tráfico (simulado - en producción vendría de GA)\r\n      const trafficMetrics = await this.collectTrafficMetrics();\r\n\r\n      const metrics: SEOMetrics = {\r\n        ...trafficMetrics,\r\n        coreWebVitals,\r\n        indexationStatus,\r\n        technicalSEO,\r\n        timestamp: new Date()\r\n      };\r\n\r\n      this.metrics.push(metrics);\r\n      await this.cacheMetrics('latest_metrics', metrics);\r\n\r\n      // Verificar thresholds y generar alertas\r\n      await this.checkMetricsThresholds(metrics);\r\n\r\n      this.notifyListeners({ type: 'metrics_updated', data: metrics });\r\n\r\n      logger.info(LogLevel.INFO, 'SEO metrics collected and processed', {\r\n        coreWebVitalsScore: coreWebVitals.score,\r\n        indexationRate: indexationStatus.indexationRate,\r\n        organicTraffic: trafficMetrics.organicTraffic\r\n      }, LogCategory.SEO);\r\n\r\n    } catch (error) {\r\n      logger.error(LogLevel.ERROR, 'Failed to collect SEO metrics', error as Error, LogCategory.SEO);\r\n    }\r\n  }\r\n\r\n  // Recopilar métricas de Core Web Vitals mejoradas\r\n  async collectCoreWebVitals(): Promise<CoreWebVitals> {\r\n    return new Promise((resolve) => {\r\n      // Obtener métricas reales del performance monitor si están disponibles\r\n      const performanceMetrics = realTimePerformanceMonitor.getCurrentMetrics();\r\n\r\n      let metrics: CoreWebVitals;\r\n\r\n      if (performanceMetrics.webVitals.length > 0) {\r\n        const latest = performanceMetrics.webVitals[performanceMetrics.webVitals.length - 1];\r\n        metrics = {\r\n          lcp: latest.lcp,\r\n          fid: latest.fid,\r\n          cls: latest.cls,\r\n          fcp: latest.fcp,\r\n          ttfb: latest.ttfb,\r\n          inp: latest.inp || Math.random() * 500 + 100,\r\n          score: 'good', // Se calculará\r\n          speedIndex: latest.lcp * 0.8, // Estimación\r\n          totalBlockingTime: latest.fid * 2, // Estimación\r\n          largestContentfulPaintElement: 'main-content', // Simulado\r\n          cumulativeLayoutShiftSources: ['header', 'sidebar'] // Simulado\r\n        };\r\n      } else {\r\n        // Fallback a métricas simuladas\r\n        metrics = {\r\n          lcp: Math.random() * 4000 + 1000,\r\n          fid: Math.random() * 300 + 50,\r\n          cls: Math.random() * 0.25,\r\n          fcp: Math.random() * 3000 + 500,\r\n          ttfb: Math.random() * 800 + 200,\r\n          inp: Math.random() * 500 + 100,\r\n          score: 'good',\r\n          speedIndex: Math.random() * 5000 + 2000,\r\n          totalBlockingTime: Math.random() * 600 + 100,\r\n          largestContentfulPaintElement: 'main-content',\r\n          cumulativeLayoutShiftSources: []\r\n        };\r\n      }\r\n\r\n      // Calcular score basado en thresholds de Google\r\n      const lcpScore = metrics.lcp <= 2500 ? 'good' : metrics.lcp <= 4000 ? 'needs-improvement' : 'poor';\r\n      const fidScore = metrics.fid <= 100 ? 'good' : metrics.fid <= 300 ? 'needs-improvement' : 'poor';\r\n      const clsScore = metrics.cls <= 0.1 ? 'good' : metrics.cls <= 0.25 ? 'needs-improvement' : 'poor';\r\n\r\n      const scores = [lcpScore, fidScore, clsScore];\r\n      if (scores.every(s => s === 'good')) {metrics.score = 'good';}\r\n      else if (scores.some(s => s === 'poor')) {metrics.score = 'poor';}\r\n      else {metrics.score = 'needs-improvement';}\r\n\r\n      resolve(metrics);\r\n    });\r\n  }\r\n\r\n  // Recopilar métricas de tráfico\r\n  private async collectTrafficMetrics(): Promise<Partial<SEOMetrics>> {\r\n    // En producción, esto se integraría con Google Analytics API\r\n    const baseTraffic = Math.floor(Math.random() * 5000) + 2000;\r\n\r\n    return {\r\n      pageViews: baseTraffic * 2,\r\n      uniqueVisitors: baseTraffic,\r\n      bounceRate: Math.random() * 40 + 30,\r\n      avgSessionDuration: Math.random() * 300 + 120,\r\n      organicTraffic: Math.floor(baseTraffic * 0.6),\r\n      searchImpressions: Math.floor(baseTraffic * 10),\r\n      searchClicks: Math.floor(baseTraffic * 0.8),\r\n      avgPosition: Math.random() * 20 + 5,\r\n      ctr: Math.random() * 8 + 2,\r\n      conversionRate: Math.random() * 5 + 1,\r\n      revenueFromOrganic: Math.floor(Math.random() * 50000) + 10000,\r\n      topLandingPages: this.getTopLandingPages(),\r\n      topExitPages: this.getTopExitPages(),\r\n      deviceBreakdown: this.getDeviceBreakdown(),\r\n      geographicData: this.getGeographicData()\r\n    };\r\n  }\r\n\r\n  private getTopLandingPages(): PageMetrics[] {\r\n    const pages = [\r\n      '/products/pintura-interior',\r\n      '/products/pintura-exterior',\r\n      '/categories/herramientas',\r\n      '/categories/pinturas',\r\n      '/products/sherwin-williams'\r\n    ];\r\n\r\n    return pages.map(url => ({\r\n      url,\r\n      pageViews: Math.floor(Math.random() * 1000) + 100,\r\n      uniquePageViews: Math.floor(Math.random() * 800) + 80,\r\n      avgTimeOnPage: Math.random() * 300 + 60,\r\n      bounceRate: Math.random() * 60 + 20,\r\n      exitRate: Math.random() * 50 + 10,\r\n      conversions: Math.floor(Math.random() * 20) + 1,\r\n      revenue: Math.floor(Math.random() * 5000) + 500\r\n    }));\r\n  }\r\n\r\n  private getTopExitPages(): PageMetrics[] {\r\n    const pages = [\r\n      '/checkout',\r\n      '/cart',\r\n      '/contact',\r\n      '/about',\r\n      '/shipping-info'\r\n    ];\r\n\r\n    return pages.map(url => ({\r\n      url,\r\n      pageViews: Math.floor(Math.random() * 500) + 50,\r\n      uniquePageViews: Math.floor(Math.random() * 400) + 40,\r\n      avgTimeOnPage: Math.random() * 200 + 30,\r\n      bounceRate: Math.random() * 80 + 40,\r\n      exitRate: Math.random() * 90 + 50,\r\n      conversions: Math.floor(Math.random() * 5),\r\n      revenue: Math.floor(Math.random() * 1000)\r\n    }));\r\n  }\r\n\r\n  private getDeviceBreakdown(): DeviceMetrics {\r\n    return {\r\n      desktop: {\r\n        sessions: Math.floor(Math.random() * 2000) + 500,\r\n        bounceRate: Math.random() * 40 + 25,\r\n        conversionRate: Math.random() * 4 + 2,\r\n        avgSessionDuration: Math.random() * 400 + 200\r\n      },\r\n      mobile: {\r\n        sessions: Math.floor(Math.random() * 3000) + 1000,\r\n        bounceRate: Math.random() * 50 + 35,\r\n        conversionRate: Math.random() * 3 + 1,\r\n        avgSessionDuration: Math.random() * 300 + 150\r\n      },\r\n      tablet: {\r\n        sessions: Math.floor(Math.random() * 500) + 100,\r\n        bounceRate: Math.random() * 45 + 30,\r\n        conversionRate: Math.random() * 3.5 + 1.5,\r\n        avgSessionDuration: Math.random() * 350 + 180\r\n      }\r\n    };\r\n  }\r\n\r\n  private getGeographicData(): GeographicMetrics[] {\r\n    const locations = [\r\n      { country: 'Argentina', region: 'Buenos Aires', city: 'CABA' },\r\n      { country: 'Argentina', region: 'Buenos Aires', city: 'La Plata' },\r\n      { country: 'Argentina', region: 'Córdoba', city: 'Córdoba' },\r\n      { country: 'Argentina', region: 'Santa Fe', city: 'Rosario' },\r\n      { country: 'Argentina', region: 'Mendoza', city: 'Mendoza' }\r\n    ];\r\n\r\n    return locations.map(location => ({\r\n      ...location,\r\n      sessions: Math.floor(Math.random() * 1000) + 100,\r\n      users: Math.floor(Math.random() * 800) + 80,\r\n      bounceRate: Math.random() * 50 + 25,\r\n      conversionRate: Math.random() * 4 + 1,\r\n      revenue: Math.floor(Math.random() * 10000) + 1000\r\n    }));\r\n  }\r\n\r\n  // Analizar estado de indexación mejorado\r\n  async analyzeIndexationStatus(): Promise<IndexationStatus> {\r\n    // En producción, esto se integraría con Google Search Console API\r\n    const totalPages = 150 + Math.floor(Math.random() * 50);\r\n    const indexedPages = Math.floor(totalPages * (0.9 + Math.random() * 0.1));\r\n\r\n    return {\r\n      totalPages,\r\n      indexedPages,\r\n      notIndexedPages: totalPages - indexedPages,\r\n      indexationRate: Number(((indexedPages / totalPages) * 100).toFixed(1)),\r\n      crawlErrors: Math.floor(Math.random() * 5),\r\n      sitemapStatus: Math.random() > 0.1 ? 'processed' : 'error',\r\n      lastCrawlDate: new Date(Date.now() - Math.random() * 24 * 60 * 60 * 1000)\r\n    };\r\n  }\r\n\r\n  // Evaluar SEO técnico\r\n  async evaluateTechnicalSEO(): Promise<TechnicalSEOMetrics> {\r\n    return {\r\n      mobileUsability: 95,\r\n      pagespeedScore: 88,\r\n      httpsUsage: 100,\r\n      structuredDataErrors: 2,\r\n      metaTagsOptimization: 92,\r\n      internalLinkingScore: 85,\r\n      imageOptimization: 78,\r\n      canonicalIssues: 1\r\n    };\r\n  }\r\n\r\n  // Recopilar métricas completas\r\n  async collectMetrics(): Promise<SEOMetrics> {\r\n    const coreWebVitals = await this.collectCoreWebVitals();\r\n    const indexationStatus = await this.analyzeIndexationStatus();\r\n    const technicalSEO = await this.evaluateTechnicalSEO();\r\n\r\n    const metrics: SEOMetrics = {\r\n      pageViews: Math.floor(Math.random() * 10000) + 5000,\r\n      uniqueVisitors: Math.floor(Math.random() * 5000) + 2000,\r\n      bounceRate: Math.random() * 40 + 30, // 30-70%\r\n      avgSessionDuration: Math.random() * 300 + 120, // 2-7 minutos\r\n      organicTraffic: Math.floor(Math.random() * 3000) + 1000,\r\n      searchImpressions: Math.floor(Math.random() * 50000) + 20000,\r\n      searchClicks: Math.floor(Math.random() * 2000) + 800,\r\n      avgPosition: Math.random() * 20 + 5, // Posición 5-25\r\n      ctr: Math.random() * 8 + 2, // 2-10%\r\n      coreWebVitals,\r\n      indexationStatus,\r\n      technicalSEO,\r\n      timestamp: new Date()\r\n    };\r\n\r\n    this.metrics.push(metrics);\r\n    this.notifyListeners({ type: 'metrics', data: metrics });\r\n\r\n    return metrics;\r\n  }\r\n\r\n  // ===================================\r\n  // ANÁLISIS DE KEYWORDS AVANZADO\r\n  // ===================================\r\n\r\n  private async updateKeywordRankings(): Promise<void> {\r\n    try {\r\n      const keywords = await this.analyzeKeywords();\r\n      this.keywords = keywords;\r\n\r\n      await this.cacheMetrics('latest_keywords', keywords);\r\n\r\n      // Verificar cambios significativos en rankings\r\n      await this.checkKeywordAlerts(keywords);\r\n\r\n      this.notifyListeners({ type: 'keywords_updated', data: keywords });\r\n\r\n      logger.info(LogLevel.INFO, 'Keyword rankings updated', {\r\n        totalKeywords: keywords.length,\r\n        averagePosition: keywords.reduce((sum, k) => sum + k.position, 0) / keywords.length\r\n      }, LogCategory.SEO);\r\n\r\n    } catch (error) {\r\n      logger.error(LogLevel.ERROR, 'Failed to update keyword rankings', error as Error, LogCategory.SEO);\r\n    }\r\n  }\r\n\r\n  // Analizar keywords con métricas avanzadas\r\n  async analyzeKeywords(): Promise<KeywordMetrics[]> {\r\n    const sampleKeywords = [\r\n      { keyword: 'pinturería online', intent: 'commercial' as const, volume: 2400 },\r\n      { keyword: 'pinturas sherwin williams', intent: 'commercial' as const, volume: 1800 },\r\n      { keyword: 'ferretería online', intent: 'commercial' as const, volume: 3200 },\r\n      { keyword: 'herramientas pintura', intent: 'commercial' as const, volume: 1500 },\r\n      { keyword: 'corralón online', intent: 'commercial' as const, volume: 2800 },\r\n      { keyword: 'pinturas argentina', intent: 'informational' as const, volume: 4200 },\r\n      { keyword: 'petrilac pinturas', intent: 'navigational' as const, volume: 800 },\r\n      { keyword: 'sinteplast', intent: 'navigational' as const, volume: 1200 },\r\n      { keyword: 'plavicon', intent: 'navigational' as const, volume: 600 },\r\n      { keyword: 'akapol', intent: 'navigational' as const, volume: 400 },\r\n      { keyword: 'pintura interior precio', intent: 'transactional' as const, volume: 1600 },\r\n      { keyword: 'pintura exterior mejor', intent: 'informational' as const, volume: 900 },\r\n      { keyword: 'como pintar paredes', intent: 'informational' as const, volume: 5500 },\r\n      { keyword: 'rodillos pintura profesional', intent: 'commercial' as const, volume: 700 },\r\n      { keyword: 'pintura antioxido', intent: 'commercial' as const, volume: 1100 }\r\n    ];\r\n\r\n    const keywords: KeywordMetrics[] = await Promise.all(\r\n      sampleKeywords.map(async ({ keyword, intent, volume }) => {\r\n        const position = Math.floor(Math.random() * 50) + 1;\r\n        const previousPosition = position + Math.floor(Math.random() * 10) - 5;\r\n        const clicks = Math.floor(Math.random() * 200) + 10;\r\n        const impressions = Math.floor(Math.random() * 2000) + 100;\r\n\r\n        return {\r\n          keyword,\r\n          position,\r\n          previousPosition,\r\n          searchVolume: volume,\r\n          difficulty: Math.floor(Math.random() * 100),\r\n          clicks,\r\n          impressions,\r\n          ctr: (clicks / impressions) * 100,\r\n          url: `/shop?search=${encodeURIComponent(keyword)}`,\r\n          trend: position < previousPosition ? 'up' : position > previousPosition ? 'down' : 'stable',\r\n          searchEngine: 'google',\r\n          device: Math.random() > 0.6 ? 'mobile' : 'desktop',\r\n          location: 'Argentina',\r\n          intent,\r\n          competitorRankings: this.getCompetitorRankings(keyword),\r\n          relatedKeywords: this.getRelatedKeywords(keyword),\r\n          seasonalTrends: this.getSeasonalTrends(keyword),\r\n          conversionRate: Math.random() * 5 + 1,\r\n          revenue: Math.floor(Math.random() * 10000) + 1000,\r\n          costPerClick: Math.random() * 5 + 0.5,\r\n          lastUpdated: new Date()\r\n        };\r\n      })\r\n    );\r\n\r\n    // Guardar keywords en el manager\r\n    this.keywords = keywords;\r\n\r\n    return keywords;\r\n  }\r\n\r\n  private getCompetitorRankings(keyword: string): CompetitorKeywordData[] {\r\n    const competitors = ['easy.com.ar', 'sodimac.com.ar', 'mercadolibre.com.ar'];\r\n\r\n    return competitors.map(domain => ({\r\n      domain,\r\n      position: Math.floor(Math.random() * 20) + 1,\r\n      url: `https://${domain}/search?q=${encodeURIComponent(keyword)}`,\r\n      title: `${keyword} - ${domain}`,\r\n      description: `Encuentra ${keyword} en ${domain} con los mejores precios y calidad.`\r\n    }));\r\n  }\r\n\r\n  private getRelatedKeywords(keyword: string): string[] {\r\n    const relatedMap: Record<string, string[]> = {\r\n      'pinturería online': ['pintura online', 'comprar pintura', 'tienda pintura'],\r\n      'pinturas sherwin williams': ['sherwin williams argentina', 'pintura sherwin', 'sw pinturas'],\r\n      'ferretería online': ['ferretería virtual', 'herramientas online', 'comprar herramientas'],\r\n      'herramientas pintura': ['rodillos pintura', 'pinceles', 'brochas pintura'],\r\n      'corralón online': ['materiales construcción', 'corralón virtual', 'construcción online']\r\n    };\r\n\r\n    return relatedMap[keyword] || [\r\n      `${keyword} precio`,\r\n      `${keyword} argentina`,\r\n      `mejor ${keyword}`\r\n    ];\r\n  }\r\n\r\n  private getSeasonalTrends(keyword: string): SeasonalData[] {\r\n    return Array.from({ length: 12 }, (_, month) => ({\r\n      month: month + 1,\r\n      searchVolume: Math.floor(Math.random() * 2000) + 500,\r\n      competition: Math.random(),\r\n      cpc: Math.random() * 3 + 0.5\r\n    }));\r\n  }\r\n\r\n  // ===================================\r\n  // ANÁLISIS DE COMPETIDORES\r\n  // ===================================\r\n\r\n  private async updateCompetitorAnalysis(): Promise<void> {\r\n    try {\r\n      const competitors = await this.analyzeCompetitors();\r\n      this.competitors = competitors;\r\n\r\n      await this.cacheMetrics('latest_competitors', competitors);\r\n\r\n      this.notifyListeners({ type: 'competitors_updated', data: competitors });\r\n\r\n      logger.info(LogLevel.INFO, 'Competitor analysis updated', {\r\n        competitorsAnalyzed: competitors.length\r\n      }, LogCategory.SEO);\r\n\r\n    } catch (error) {\r\n      logger.error(LogLevel.ERROR, 'Failed to update competitor analysis', error as Error, LogCategory.SEO);\r\n    }\r\n  }\r\n\r\n  private async analyzeCompetitors(): Promise<CompetitorAnalysis[]> {\r\n    const competitorDomains = [\r\n      'easy.com.ar',\r\n      'sodimac.com.ar',\r\n      'mercadolibre.com.ar',\r\n      'pinturerias-rex.com.ar',\r\n      'sherwin-williams.com.ar'\r\n    ];\r\n\r\n    return Promise.all(competitorDomains.map(async (domain) => {\r\n      const organicKeywords = Math.floor(Math.random() * 10000) + 5000;\r\n      const organicTraffic = Math.floor(Math.random() * 500000) + 100000;\r\n\r\n      return {\r\n        competitor: domain.split('.')[0],\r\n        domain,\r\n        organicKeywords,\r\n        organicTraffic,\r\n        backlinks: Math.floor(Math.random() * 100000) + 10000,\r\n        domainAuthority: Math.floor(Math.random() * 40) + 40,\r\n        commonKeywords: this.getCommonKeywords(domain),\r\n        keywordGaps: this.getKeywordGaps(domain),\r\n        pageAuthority: Math.floor(Math.random() * 30) + 30,\r\n        trustFlow: Math.floor(Math.random() * 40) + 20,\r\n        citationFlow: Math.floor(Math.random() * 50) + 25,\r\n        referringDomains: Math.floor(Math.random() * 5000) + 1000,\r\n        organicCost: Math.floor(Math.random() * 100000) + 20000,\r\n        paidKeywords: Math.floor(Math.random() * 2000) + 500,\r\n        paidTraffic: Math.floor(Math.random() * 50000) + 10000,\r\n        paidCost: Math.floor(Math.random() * 50000) + 10000,\r\n        topPages: this.getCompetitorTopPages(domain),\r\n        contentGaps: this.getContentGaps(domain),\r\n        backlinksGaps: this.getBacklinkGaps(domain),\r\n        socialMetrics: this.getSocialMetrics(domain),\r\n        technicalSEOScore: Math.floor(Math.random() * 30) + 70,\r\n        lastAnalyzed: new Date()\r\n      };\r\n    }));\r\n  }\r\n\r\n  private getCommonKeywords(domain: string): string[] {\r\n    return [\r\n      'pintura interior',\r\n      'pintura exterior',\r\n      'herramientas pintura',\r\n      'rodillos',\r\n      'pinceles'\r\n    ];\r\n  }\r\n\r\n  private getKeywordGaps(domain: string): string[] {\r\n    return [\r\n      'pintura ecológica',\r\n      'pintura antimanchas',\r\n      'pintura magnética',\r\n      'pintura pizarra',\r\n      'pintura texturada'\r\n    ];\r\n  }\r\n\r\n  private getCompetitorTopPages(domain: string): CompetitorPage[] {\r\n    const pages = [\r\n      '/productos/pinturas',\r\n      '/herramientas',\r\n      '/ofertas',\r\n      '/marcas',\r\n      '/consejos'\r\n    ];\r\n\r\n    return pages.map(url => ({\r\n      url: `https://${domain}${url}`,\r\n      title: `${url.split('/').pop()} - ${domain}`,\r\n      traffic: Math.floor(Math.random() * 10000) + 1000,\r\n      keywords: Math.floor(Math.random() * 100) + 20,\r\n      backlinks: Math.floor(Math.random() * 500) + 50,\r\n      socialShares: Math.floor(Math.random() * 1000) + 100\r\n    }));\r\n  }\r\n\r\n  private getContentGaps(domain: string): ContentGap[] {\r\n    return [\r\n      {\r\n        topic: 'Guías de pintura',\r\n        keywords: ['como pintar', 'técnicas pintura', 'consejos pintura'],\r\n        searchVolume: 5000,\r\n        difficulty: 45,\r\n        opportunity: 'high'\r\n      },\r\n      {\r\n        topic: 'Comparativas de productos',\r\n        keywords: ['mejor pintura', 'comparar pinturas', 'pintura vs pintura'],\r\n        searchVolume: 3000,\r\n        difficulty: 60,\r\n        opportunity: 'medium'\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getBacklinkGaps(domain: string): BacklinkGap[] {\r\n    return [\r\n      {\r\n        domain: 'arquitectura.com',\r\n        domainAuthority: 65,\r\n        linkType: 'dofollow',\r\n        anchorText: 'mejores pinturas',\r\n        opportunity: 'high'\r\n      },\r\n      {\r\n        domain: 'decoracion.com.ar',\r\n        domainAuthority: 55,\r\n        linkType: 'dofollow',\r\n        anchorText: 'pintura interior',\r\n        opportunity: 'medium'\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getSocialMetrics(domain: string): SocialMetrics {\r\n    return {\r\n      facebook: {\r\n        likes: Math.floor(Math.random() * 50000) + 10000,\r\n        shares: Math.floor(Math.random() * 5000) + 1000,\r\n        comments: Math.floor(Math.random() * 2000) + 500\r\n      },\r\n      twitter: {\r\n        followers: Math.floor(Math.random() * 20000) + 5000,\r\n        tweets: Math.floor(Math.random() * 1000) + 200,\r\n        retweets: Math.floor(Math.random() * 500) + 100\r\n      },\r\n      linkedin: {\r\n        followers: Math.floor(Math.random() * 10000) + 2000,\r\n        posts: Math.floor(Math.random() * 200) + 50,\r\n        engagement: Math.floor(Math.random() * 1000) + 200\r\n      },\r\n      instagram: {\r\n        followers: Math.floor(Math.random() * 30000) + 8000,\r\n        posts: Math.floor(Math.random() * 500) + 100,\r\n        engagement: Math.floor(Math.random() * 2000) + 500\r\n      }\r\n    };\r\n  }\r\n\r\n  // ===================================\r\n  // SISTEMA DE ALERTAS AVANZADO\r\n  // ===================================\r\n\r\n  private async checkAlerts(): Promise<void> {\r\n    try {\r\n      const alerts = await this.detectSEOIssues();\r\n\r\n      // Enviar alertas críticas al sistema de alertas\r\n      const criticalAlerts = alerts.filter(alert => alert.type === 'critical');\r\n      for (const alert of criticalAlerts) {\r\n        await advancedAlertingEngine.createAlert(\r\n          AlertType.PERFORMANCE,\r\n          AlertSeverity.CRITICAL,\r\n          alert.title,\r\n          alert.description,\r\n          {\r\n            category: alert.category,\r\n            url: alert.url,\r\n            severity: alert.severity,\r\n            recommendations: alert.recommendations\r\n          }\r\n        );\r\n      }\r\n\r\n      this.notifyListeners({ type: 'alerts_updated', data: alerts });\r\n\r\n    } catch (error) {\r\n      logger.error(LogLevel.ERROR, 'Failed to check SEO alerts', error as Error, LogCategory.SEO);\r\n    }\r\n  }\r\n\r\n  private async checkMetricsThresholds(metrics: SEOMetrics): Promise<void> {\r\n    const alerts: SEOAlert[] = [];\r\n\r\n    // Verificar Core Web Vitals\r\n    if (metrics.coreWebVitals.score === 'poor') {\r\n      alerts.push(await this.createAlert(\r\n        'critical',\r\n        'performance',\r\n        'Core Web Vitals críticos',\r\n        `Las métricas de Core Web Vitals están en estado crítico. LCP: ${metrics.coreWebVitals.lcp}ms, FID: ${metrics.coreWebVitals.fid}ms, CLS: ${metrics.coreWebVitals.cls}`,\r\n        ['Optimizar imágenes y recursos', 'Reducir JavaScript que bloquea', 'Mejorar estabilidad del layout'],\r\n        'high',\r\n        9\r\n      ));\r\n    }\r\n\r\n    // Verificar tasa de indexación\r\n    if (metrics.indexationStatus.indexationRate < 90) {\r\n      alerts.push(await this.createAlert(\r\n        'warning',\r\n        'indexation',\r\n        'Baja tasa de indexación',\r\n        `Solo el ${metrics.indexationStatus.indexationRate}% de las páginas están indexadas`,\r\n        ['Revisar robots.txt', 'Verificar sitemap', 'Analizar errores de crawl'],\r\n        'medium',\r\n        7\r\n      ));\r\n    }\r\n\r\n    // Verificar tráfico orgánico\r\n    const previousMetrics = this.getLastMetrics();\r\n    if (previousMetrics && metrics.organicTraffic < previousMetrics.organicTraffic * 0.8) {\r\n      const drop = ((previousMetrics.organicTraffic - metrics.organicTraffic) / previousMetrics.organicTraffic * 100).toFixed(1);\r\n      alerts.push(await this.createAlert(\r\n        'warning',\r\n        'content',\r\n        'Caída en tráfico orgánico',\r\n        `El tráfico orgánico ha caído un ${drop}% respecto al período anterior`,\r\n        ['Analizar cambios en rankings', 'Revisar contenido actualizado', 'Verificar penalizaciones'],\r\n        'high',\r\n        8\r\n      ));\r\n    }\r\n\r\n    if (alerts.length > 0) {\r\n      this.alerts.push(...alerts);\r\n    }\r\n  }\r\n\r\n  private async checkKeywordAlerts(keywords: KeywordMetrics[]): Promise<void> {\r\n    const alerts: SEOAlert[] = [];\r\n\r\n    // Verificar caídas significativas en rankings\r\n    const significantDrops = keywords.filter(k =>\r\n      k.previousPosition && k.position > k.previousPosition + this.config.alertThresholds.rankingDrop\r\n    );\r\n\r\n    if (significantDrops.length > 0) {\r\n      alerts.push(await this.createAlert(\r\n        'warning',\r\n        'content',\r\n        'Caídas significativas en rankings',\r\n        `${significantDrops.length} keywords han caído más de ${this.config.alertThresholds.rankingDrop} posiciones`,\r\n        ['Analizar cambios en contenido', 'Revisar competencia', 'Optimizar páginas afectadas'],\r\n        'medium',\r\n        6\r\n      ));\r\n    }\r\n\r\n    // Verificar keywords que salieron del top 10\r\n    const lostTopPositions = keywords.filter(k =>\r\n      k.previousPosition && k.previousPosition <= 10 && k.position > 10\r\n    );\r\n\r\n    if (lostTopPositions.length > 0) {\r\n      alerts.push(await this.createAlert(\r\n        'critical',\r\n        'content',\r\n        'Keywords perdieron posiciones top 10',\r\n        `${lostTopPositions.length} keywords importantes salieron del top 10`,\r\n        ['Priorizar optimización de contenido', 'Analizar intención de búsqueda', 'Mejorar autoridad de página'],\r\n        'high',\r\n        9\r\n      ));\r\n    }\r\n\r\n    if (alerts.length > 0) {\r\n      this.alerts.push(...alerts);\r\n    }\r\n  }\r\n\r\n  // Detectar problemas SEO avanzados\r\n  async detectSEOIssues(): Promise<SEOAlert[]> {\r\n    const alerts: SEOAlert[] = [];\r\n\r\n    // Análisis técnico\r\n    const technicalIssues = await this.detectTechnicalIssues();\r\n    alerts.push(...technicalIssues);\r\n\r\n    // Análisis de contenido\r\n    const contentIssues = await this.detectContentIssues();\r\n    alerts.push(...contentIssues);\r\n\r\n    // Análisis de performance\r\n    const performanceIssues = await this.detectPerformanceIssues();\r\n    alerts.push(...performanceIssues);\r\n\r\n    // Análisis de mobile\r\n    const mobileIssues = await this.detectMobileIssues();\r\n    alerts.push(...mobileIssues);\r\n\r\n    // Agregar alertas al array del manager\r\n    this.alerts.push(...alerts);\r\n\r\n    return alerts;\r\n  }\r\n\r\n  // Métodos de detección de issues específicos\r\n  private async detectTechnicalIssues(): Promise<SEOAlert[]> {\r\n    const issues: SEOAlert[] = [];\r\n\r\n    // Simular detección de problemas técnicos\r\n    const technicalProblems = [\r\n      {\r\n        type: 'warning' as const,\r\n        category: 'technical' as const,\r\n        title: 'Páginas con tiempo de carga lento',\r\n        description: '3 páginas tienen un LCP superior a 4 segundos',\r\n        affectedPages: ['/products/pintura-premium', '/categories/herramientas', '/checkout'],\r\n        impact: 'high' as const,\r\n        effort: 'medium' as const,\r\n        priority: 8,\r\n        estimatedTrafficImpact: 15,\r\n        estimatedRevenueImpact: 5000\r\n      },\r\n      {\r\n        type: 'info' as const,\r\n        category: 'schema' as const,\r\n        title: 'Schema markup faltante',\r\n        description: 'Algunas páginas de productos no tienen structured data',\r\n        affectedPages: ['/products/pintura-exterior', '/products/rodillos'],\r\n        impact: 'medium' as const,\r\n        effort: 'low' as const,\r\n        priority: 5,\r\n        estimatedTrafficImpact: 8,\r\n        estimatedRevenueImpact: 2000\r\n      }\r\n    ];\r\n\r\n    for (const problem of technicalProblems) {\r\n      issues.push(await this.createAdvancedAlert(problem));\r\n    }\r\n\r\n    return issues;\r\n  }\r\n\r\n  private async detectContentIssues(): Promise<SEOAlert[]> {\r\n    const issues: SEOAlert[] = [];\r\n\r\n    const contentProblems = [\r\n      {\r\n        type: 'warning' as const,\r\n        category: 'content' as const,\r\n        title: 'Meta descriptions faltantes',\r\n        description: '5 páginas importantes no tienen meta description',\r\n        affectedPages: ['/about', '/shipping', '/returns', '/contact', '/blog'],\r\n        impact: 'medium' as const,\r\n        effort: 'low' as const,\r\n        priority: 6,\r\n        estimatedTrafficImpact: 10,\r\n        estimatedRevenueImpact: 1500\r\n      },\r\n      {\r\n        type: 'info' as const,\r\n        category: 'content' as const,\r\n        title: 'Oportunidades de contenido',\r\n        description: 'Se detectaron 8 keywords con potencial de mejora',\r\n        affectedPages: [],\r\n        impact: 'high' as const,\r\n        effort: 'high' as const,\r\n        priority: 7,\r\n        estimatedTrafficImpact: 25,\r\n        estimatedRevenueImpact: 8000\r\n      }\r\n    ];\r\n\r\n    for (const problem of contentProblems) {\r\n      issues.push(await this.createAdvancedAlert(problem));\r\n    }\r\n\r\n    return issues;\r\n  }\r\n\r\n  private async detectPerformanceIssues(): Promise<SEOAlert[]> {\r\n    const issues: SEOAlert[] = [];\r\n\r\n    const performanceProblems = [\r\n      {\r\n        type: 'critical' as const,\r\n        category: 'performance' as const,\r\n        title: 'Imágenes sin optimizar',\r\n        description: 'Múltiples imágenes grandes están afectando el LCP',\r\n        affectedPages: ['/products/pintura-interior', '/home'],\r\n        impact: 'high' as const,\r\n        effort: 'medium' as const,\r\n        priority: 9,\r\n        estimatedTrafficImpact: 20,\r\n        estimatedRevenueImpact: 6000\r\n      }\r\n    ];\r\n\r\n    for (const problem of performanceProblems) {\r\n      issues.push(await this.createAdvancedAlert(problem));\r\n    }\r\n\r\n    return issues;\r\n  }\r\n\r\n  private async detectMobileIssues(): Promise<SEOAlert[]> {\r\n    const issues: SEOAlert[] = [];\r\n\r\n    const mobileProblems = [\r\n      {\r\n        type: 'warning' as const,\r\n        category: 'mobile' as const,\r\n        title: 'Problemas de usabilidad móvil',\r\n        description: 'Algunos elementos son demasiado pequeños para tocar en móvil',\r\n        affectedPages: ['/cart', '/checkout'],\r\n        impact: 'medium' as const,\r\n        effort: 'medium' as const,\r\n        priority: 6,\r\n        estimatedTrafficImpact: 12,\r\n        estimatedRevenueImpact: 3000\r\n      }\r\n    ];\r\n\r\n    for (const problem of mobileProblems) {\r\n      issues.push(await this.createAdvancedAlert(problem));\r\n    }\r\n\r\n    return issues;\r\n  }\r\n\r\n  private async createAlert(\r\n    type: 'critical' | 'warning' | 'info',\r\n    category: SEOAlert['category'],\r\n    title: string,\r\n    description: string,\r\n    recommendations: string[],\r\n    impact: 'high' | 'medium' | 'low',\r\n    priority: number\r\n  ): Promise<SEOAlert> {\r\n    return {\r\n      id: `alert-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      type,\r\n      category,\r\n      title,\r\n      description,\r\n      severity: priority,\r\n      timestamp: new Date(),\r\n      resolved: false,\r\n      recommendations,\r\n      impact,\r\n      effort: 'medium',\r\n      priority,\r\n      affectedPages: [],\r\n      estimatedTrafficImpact: 0,\r\n      estimatedRevenueImpact: 0,\r\n      relatedAlerts: [],\r\n      autoResolvable: false,\r\n      resolutionSteps: [],\r\n      lastOccurrence: new Date(),\r\n      frequency: 1,\r\n      tags: [category, impact]\r\n    };\r\n  }\r\n\r\n  private async createAdvancedAlert(problem: any): Promise<SEOAlert> {\r\n    return {\r\n      id: `alert-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      type: problem.type,\r\n      category: problem.category,\r\n      title: problem.title,\r\n      description: problem.description,\r\n      severity: problem.priority,\r\n      timestamp: new Date(),\r\n      resolved: false,\r\n      recommendations: this.getRecommendationsForCategory(problem.category),\r\n      impact: problem.impact,\r\n      effort: problem.effort,\r\n      priority: problem.priority,\r\n      affectedPages: problem.affectedPages,\r\n      estimatedTrafficImpact: problem.estimatedTrafficImpact,\r\n      estimatedRevenueImpact: problem.estimatedRevenueImpact,\r\n      relatedAlerts: [],\r\n      autoResolvable: problem.category === 'schema' || problem.category === 'content',\r\n      resolutionSteps: this.getResolutionSteps(problem.category),\r\n      lastOccurrence: new Date(),\r\n      frequency: 1,\r\n      tags: [problem.category, problem.impact, problem.type]\r\n    };\r\n  }\r\n\r\n  private getRecommendationsForCategory(category: string): string[] {\r\n    const recommendations: Record<string, string[]> = {\r\n      technical: [\r\n        'Optimizar imágenes y recursos',\r\n        'Implementar lazy loading',\r\n        'Revisar recursos que bloquean el renderizado',\r\n        'Configurar compresión GZIP'\r\n      ],\r\n      content: [\r\n        'Crear contenido específico para keywords objetivo',\r\n        'Optimizar meta descriptions',\r\n        'Mejorar estructura de headings',\r\n        'Agregar contenido relevante y único'\r\n      ],\r\n      performance: [\r\n        'Optimizar Core Web Vitals',\r\n        'Reducir tiempo de carga',\r\n        'Implementar CDN',\r\n        'Optimizar JavaScript y CSS'\r\n      ],\r\n      mobile: [\r\n        'Mejorar experiencia móvil',\r\n        'Ajustar tamaños de elementos táctiles',\r\n        'Optimizar viewport',\r\n        'Implementar diseño responsive'\r\n      ],\r\n      schema: [\r\n        'Implementar structured data',\r\n        'Validar markup existente',\r\n        'Agregar schema de productos',\r\n        'Configurar breadcrumbs schema'\r\n      ]\r\n    };\r\n\r\n    return recommendations[category] || ['Revisar y optimizar según mejores prácticas SEO'];\r\n  }\r\n\r\n  private getResolutionSteps(category: string): ResolutionStep[] {\r\n    const steps: Record<string, ResolutionStep[]> = {\r\n      technical: [\r\n        {\r\n          step: 1,\r\n          description: 'Analizar páginas afectadas',\r\n          action: 'Usar herramientas de análisis de performance',\r\n          estimatedTime: 30,\r\n          difficulty: 'easy',\r\n          requiredSkills: ['SEO básico']\r\n        },\r\n        {\r\n          step: 2,\r\n          description: 'Optimizar recursos',\r\n          action: 'Comprimir imágenes y minificar CSS/JS',\r\n          estimatedTime: 120,\r\n          difficulty: 'medium',\r\n          requiredSkills: ['Desarrollo web', 'Optimización']\r\n        }\r\n      ],\r\n      content: [\r\n        {\r\n          step: 1,\r\n          description: 'Auditar contenido existente',\r\n          action: 'Revisar meta tags y contenido de páginas',\r\n          estimatedTime: 60,\r\n          difficulty: 'easy',\r\n          requiredSkills: ['SEO', 'Redacción']\r\n        },\r\n        {\r\n          step: 2,\r\n          description: 'Crear contenido optimizado',\r\n          action: 'Escribir meta descriptions y mejorar contenido',\r\n          estimatedTime: 180,\r\n          difficulty: 'medium',\r\n          requiredSkills: ['SEO', 'Redacción', 'Marketing']\r\n        }\r\n      ]\r\n    };\r\n\r\n    return steps[category] || [];\r\n  }\r\n\r\n  // ===================================\r\n  // GENERACIÓN DE REPORTES AVANZADOS\r\n  // ===================================\r\n\r\n  // Generar reporte SEO completo\r\n  async generateSEOReport(\r\n    period: 'daily' | 'weekly' | 'monthly' | 'quarterly' | 'yearly' | 'custom',\r\n    customDateRange?: { start: Date; end: Date }\r\n  ): Promise<SEOReport> {\r\n    const endDate = new Date();\r\n    const startDate = new Date();\r\n\r\n    if (customDateRange) {\r\n      startDate.setTime(customDateRange.start.getTime());\r\n      endDate.setTime(customDateRange.end.getTime());\r\n    } else {\r\n      switch (period) {\r\n        case 'daily':\r\n          startDate.setDate(endDate.getDate() - 1);\r\n          break;\r\n        case 'weekly':\r\n          startDate.setDate(endDate.getDate() - 7);\r\n          break;\r\n        case 'monthly':\r\n          startDate.setMonth(endDate.getMonth() - 1);\r\n          break;\r\n        case 'quarterly':\r\n          startDate.setMonth(endDate.getMonth() - 3);\r\n          break;\r\n        case 'yearly':\r\n          startDate.setFullYear(endDate.getFullYear() - 1);\r\n          break;\r\n      }\r\n    }\r\n\r\n    const metrics = await this.collectAndProcessMetrics();\r\n    const keywords = await this.analyzeKeywords();\r\n    const alerts = await this.detectSEOIssues();\r\n    const competitors = this.competitors;\r\n\r\n    const report: SEOReport = {\r\n      id: `report-${Date.now()}`,\r\n      period,\r\n      startDate,\r\n      endDate,\r\n      metrics: this.getLastMetrics() || metrics,\r\n      keywords,\r\n      alerts,\r\n      recommendations: await this.generateRecommendations(),\r\n      competitorAnalysis: competitors,\r\n      executiveSummary: await this.generateExecutiveSummary(),\r\n      performanceAnalysis: await this.generatePerformanceAnalysis(),\r\n      keywordAnalysis: await this.generateKeywordAnalysis(keywords),\r\n      technicalAnalysis: await this.generateTechnicalAnalysis(),\r\n      contentAnalysis: await this.generateContentAnalysis(),\r\n      competitiveAnalysis: await this.generateCompetitiveAnalysis(competitors),\r\n      actionPlan: await this.generateActionPlan(),\r\n      generatedBy: 'Enhanced SEO Analytics Manager',\r\n      generatedAt: new Date(),\r\n      version: '2.0.0',\r\n      exportFormats: ['pdf', 'excel', 'csv', 'json'],\r\n      scheduledDelivery: []\r\n    };\r\n\r\n    this.reports.push(report);\r\n    await this.cacheMetrics(`report_${report.id}`, report);\r\n\r\n    logger.info(LogLevel.INFO, 'SEO report generated', {\r\n      reportId: report.id,\r\n      period,\r\n      overallScore: report.executiveSummary.overallScore,\r\n      alertsCount: alerts.length,\r\n      keywordsCount: keywords.length\r\n    }, LogCategory.SEO);\r\n\r\n    return report;\r\n  }\r\n\r\n  // Métodos de generación de análisis específicos\r\n  private async generateExecutiveSummary(): Promise<ExecutiveSummary> {\r\n    const currentMetrics = this.getLastMetrics();\r\n    const overallScore = currentMetrics ? this.calculateOverallSEOScore(currentMetrics) : 85;\r\n\r\n    return {\r\n      overallScore,\r\n      scoreChange: Math.floor(Math.random() * 10) - 5, // -5 a +5\r\n      keyAchievements: [\r\n        'CTR aumentó 12% en la última semana',\r\n        'Posición promedio mejoró 2.3 posiciones',\r\n        'Tráfico orgánico creció 8%',\r\n        'Core Web Vitals mejorados en 15%'\r\n      ],\r\n      majorConcerns: [\r\n        'Algunas páginas tienen LCP alto',\r\n        'Falta schema markup en productos',\r\n        'Meta descriptions incompletas'\r\n      ],\r\n      quickWins: [\r\n        'Agregar meta descriptions faltantes',\r\n        'Implementar schema de productos',\r\n        'Optimizar imágenes principales',\r\n        'Mejorar títulos de páginas'\r\n      ],\r\n      budgetRecommendations: [\r\n        {\r\n          category: 'Contenido',\r\n          description: 'Creación de contenido optimizado para keywords objetivo',\r\n          estimatedCost: 15000,\r\n          expectedROI: 3.5,\r\n          timeframe: '3 meses'\r\n        },\r\n        {\r\n          category: 'Técnico',\r\n          description: 'Optimización de performance y Core Web Vitals',\r\n          estimatedCost: 25000,\r\n          expectedROI: 2.8,\r\n          timeframe: '2 meses'\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  private async generatePerformanceAnalysis(): Promise<PerformanceAnalysis> {\r\n    const currentMetrics = this.getLastMetrics();\r\n    const cwv = currentMetrics?.coreWebVitals;\r\n\r\n    return {\r\n      coreWebVitalsScore: cwv?.score === 'good' ? 90 : cwv?.score === 'needs-improvement' ? 70 : 40,\r\n      coreWebVitalsChange: Math.floor(Math.random() * 20) - 10,\r\n      pageSpeedScore: Math.floor(Math.random() * 30) + 70,\r\n      pageSpeedChange: Math.floor(Math.random() * 10) - 5,\r\n      mobileScore: Math.floor(Math.random() * 20) + 80,\r\n      mobileChange: Math.floor(Math.random() * 8) - 4,\r\n      slowestPages: [\r\n        {\r\n          url: '/products/pintura-premium',\r\n          lcp: 4200,\r\n          fid: 150,\r\n          cls: 0.15,\r\n          speedIndex: 3800,\r\n          totalBlockingTime: 300,\r\n          issues: ['Imágenes grandes sin optimizar', 'JavaScript bloqueante']\r\n        },\r\n        {\r\n          url: '/checkout',\r\n          lcp: 3800,\r\n          fid: 120,\r\n          cls: 0.12,\r\n          speedIndex: 3500,\r\n          totalBlockingTime: 250,\r\n          issues: ['Formularios complejos', 'Validaciones síncronas']\r\n        }\r\n      ],\r\n      performanceRecommendations: [\r\n        'Implementar lazy loading para imágenes',\r\n        'Optimizar JavaScript crítico',\r\n        'Usar CDN para recursos estáticos',\r\n        'Implementar service workers'\r\n      ]\r\n    };\r\n  }\r\n\r\n  private async generateKeywordAnalysis(keywords: KeywordMetrics[]): Promise<KeywordAnalysis> {\r\n    const totalKeywords = keywords.length;\r\n    const averagePosition = keywords.reduce((sum, k) => sum + k.position, 0) / totalKeywords;\r\n\r\n    return {\r\n      totalKeywords,\r\n      keywordsChange: Math.floor(Math.random() * 20) - 10,\r\n      averagePosition: Number(averagePosition.toFixed(1)),\r\n      positionChange: Math.random() * 4 - 2,\r\n      topGainers: keywords\r\n        .filter(k => k.trend === 'up')\r\n        .sort((a, b) => (a.previousPosition || 50) - a.position - ((b.previousPosition || 50) - b.position))\r\n        .slice(0, 5),\r\n      topLosers: keywords\r\n        .filter(k => k.trend === 'down')\r\n        .sort((a, b) => (b.position - (b.previousPosition || 1)) - (a.position - (a.previousPosition || 1)))\r\n        .slice(0, 5),\r\n      newKeywords: keywords.filter(k => !k.previousPosition).slice(0, 3),\r\n      lostKeywords: [], // Simulated\r\n      opportunityKeywords: keywords\r\n        .filter(k => k.position > 10 && k.position <= 20)\r\n        .sort((a, b) => b.searchVolume - a.searchVolume)\r\n        .slice(0, 10)\r\n    };\r\n  }\r\n\r\n  private async generateTechnicalAnalysis(): Promise<TechnicalAnalysis> {\r\n    return {\r\n      crawlabilityScore: Math.floor(Math.random() * 20) + 80,\r\n      indexabilityScore: Math.floor(Math.random() * 15) + 85,\r\n      structuredDataScore: Math.floor(Math.random() * 25) + 75,\r\n      mobileUsabilityScore: Math.floor(Math.random() * 20) + 80,\r\n      securityScore: Math.floor(Math.random() * 10) + 90,\r\n      technicalIssues: [\r\n        {\r\n          type: 'Missing meta descriptions',\r\n          severity: 'medium',\r\n          count: 5,\r\n          affectedPages: ['/about', '/contact', '/shipping'],\r\n          description: 'Páginas importantes sin meta description',\r\n          fix: 'Agregar meta descriptions únicas y descriptivas'\r\n        },\r\n        {\r\n          type: 'Large images',\r\n          severity: 'high',\r\n          count: 12,\r\n          affectedPages: ['/products/pintura-interior', '/home'],\r\n          description: 'Imágenes grandes que afectan el LCP',\r\n          fix: 'Optimizar y comprimir imágenes'\r\n        }\r\n      ],\r\n      improvements: [\r\n        'Implementar schema markup en todas las páginas de productos',\r\n        'Optimizar robots.txt para mejor crawling',\r\n        'Agregar breadcrumbs estructurados',\r\n        'Mejorar estructura de URLs'\r\n      ]\r\n    };\r\n  }\r\n\r\n  private async generateContentAnalysis(): Promise<ContentAnalysis> {\r\n    return {\r\n      totalPages: 150,\r\n      indexedPages: 142,\r\n      duplicateContent: 3,\r\n      thinContent: 8,\r\n      missingMetaTags: 12,\r\n      contentQualityScore: Math.floor(Math.random() * 20) + 75,\r\n      topPerformingContent: [\r\n        {\r\n          url: '/blog/como-elegir-pintura-interior',\r\n          title: 'Cómo elegir la pintura interior perfecta',\r\n          wordCount: 1500,\r\n          readabilityScore: 85,\r\n          organicTraffic: 2500,\r\n          socialShares: 150,\r\n          backlinks: 25,\r\n          conversionRate: 3.2\r\n        },\r\n        {\r\n          url: '/guia/herramientas-pintura',\r\n          title: 'Guía completa de herramientas de pintura',\r\n          wordCount: 2200,\r\n          readabilityScore: 78,\r\n          organicTraffic: 1800,\r\n          socialShares: 89,\r\n          backlinks: 18,\r\n          conversionRate: 2.8\r\n        }\r\n      ],\r\n      contentGaps: [\r\n        'Guías de aplicación de pintura',\r\n        'Comparativas de marcas',\r\n        'Tendencias en decoración',\r\n        'Mantenimiento de herramientas'\r\n      ]\r\n    };\r\n  }\r\n\r\n  private async generateCompetitiveAnalysis(competitors: CompetitorAnalysis[]): Promise<CompetitiveAnalysis> {\r\n    return {\r\n      marketShare: Math.floor(Math.random() * 15) + 10, // 10-25%\r\n      visibilityScore: Math.floor(Math.random() * 30) + 60, // 60-90\r\n      competitorComparison: competitors.slice(0, 3).map(comp => ({\r\n        competitor: comp.competitor,\r\n        ourPosition: Math.floor(Math.random() * 10) + 5,\r\n        theirPosition: Math.floor(Math.random() * 8) + 3,\r\n        gap: Math.floor(Math.random() * 5) + 1,\r\n        opportunity: Math.random() > 0.6 ? 'high' : Math.random() > 0.3 ? 'medium' : 'low'\r\n      })),\r\n      opportunityAnalysis: [\r\n        {\r\n          type: 'keyword',\r\n          description: 'Keywords de cola larga con baja competencia',\r\n          potential: 85,\r\n          difficulty: 35,\r\n          priority: 'high'\r\n        },\r\n        {\r\n          type: 'content',\r\n          description: 'Gaps de contenido en guías técnicas',\r\n          potential: 70,\r\n          difficulty: 50,\r\n          priority: 'medium'\r\n        },\r\n        {\r\n          type: 'backlink',\r\n          description: 'Oportunidades de enlaces en sitios de arquitectura',\r\n          potential: 60,\r\n          difficulty: 70,\r\n          priority: 'medium'\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  private async generateActionPlan(): Promise<ActionPlan> {\r\n    return {\r\n      quickWins: [\r\n        {\r\n          id: 'qw-1',\r\n          title: 'Agregar meta descriptions faltantes',\r\n          description: 'Completar meta descriptions en 5 páginas importantes',\r\n          category: 'Content',\r\n          priority: 'high',\r\n          effort: 'low',\r\n          impact: 'medium',\r\n          estimatedTime: 2,\r\n          dependencies: [],\r\n          kpis: ['CTR', 'Impresiones']\r\n        },\r\n        {\r\n          id: 'qw-2',\r\n          title: 'Implementar schema de productos',\r\n          description: 'Agregar structured data a páginas de productos',\r\n          category: 'Technical',\r\n          priority: 'high',\r\n          effort: 'low',\r\n          impact: 'high',\r\n          estimatedTime: 3,\r\n          dependencies: [],\r\n          kpis: ['Rich snippets', 'CTR']\r\n        }\r\n      ],\r\n      shortTerm: [\r\n        {\r\n          id: 'st-1',\r\n          title: 'Optimizar Core Web Vitals',\r\n          description: 'Mejorar LCP, FID y CLS en páginas principales',\r\n          category: 'Performance',\r\n          priority: 'high',\r\n          effort: 'medium',\r\n          impact: 'high',\r\n          estimatedTime: 14,\r\n          dependencies: ['qw-2'],\r\n          kpis: ['LCP', 'FID', 'CLS', 'Page Speed Score']\r\n        }\r\n      ],\r\n      longTerm: [\r\n        {\r\n          id: 'lt-1',\r\n          title: 'Estrategia de contenido SEO',\r\n          description: 'Crear plan de contenido para keywords objetivo',\r\n          category: 'Content',\r\n          priority: 'medium',\r\n          effort: 'high',\r\n          impact: 'high',\r\n          estimatedTime: 90,\r\n          dependencies: ['st-1'],\r\n          kpis: ['Organic Traffic', 'Keyword Rankings', 'Conversions']\r\n        }\r\n      ],\r\n      ongoing: [\r\n        {\r\n          id: 'og-1',\r\n          title: 'Monitoreo y optimización continua',\r\n          description: 'Seguimiento mensual de métricas y ajustes',\r\n          category: 'Monitoring',\r\n          priority: 'medium',\r\n          effort: 'low',\r\n          impact: 'medium',\r\n          estimatedTime: 30, // mensual\r\n          dependencies: [],\r\n          kpis: ['Overall SEO Score', 'Organic Growth']\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  private async generateRecommendations(): Promise<SEORecommendation[]> {\r\n    return [\r\n      {\r\n        id: 'rec-1',\r\n        category: 'performance',\r\n        title: 'Optimizar Core Web Vitals',\r\n        description: 'Mejorar LCP, FID y CLS para mejor experiencia de usuario y rankings',\r\n        priority: 'high',\r\n        impact: 'high',\r\n        effort: 'medium',\r\n        estimatedTimeToImplement: 14,\r\n        estimatedTrafficIncrease: 15,\r\n        estimatedRevenueIncrease: 25000,\r\n        implementationSteps: [\r\n          'Auditar páginas con peor performance',\r\n          'Optimizar imágenes y recursos',\r\n          'Implementar lazy loading',\r\n          'Optimizar JavaScript crítico'\r\n        ],\r\n        requiredResources: ['Desarrollador frontend', 'Herramientas de optimización'],\r\n        kpis: ['LCP', 'FID', 'CLS', 'Page Speed Score'],\r\n        relatedRecommendations: ['rec-2'],\r\n        status: 'pending',\r\n        notes: []\r\n      },\r\n      {\r\n        id: 'rec-2',\r\n        category: 'technical',\r\n        title: 'Implementar schema markup completo',\r\n        description: 'Agregar structured data a todas las páginas de productos y categorías',\r\n        priority: 'high',\r\n        impact: 'medium',\r\n        effort: 'low',\r\n        estimatedTimeToImplement: 7,\r\n        estimatedTrafficIncrease: 8,\r\n        estimatedRevenueIncrease: 12000,\r\n        implementationSteps: [\r\n          'Definir schemas necesarios',\r\n          'Implementar en templates',\r\n          'Validar con herramientas de Google',\r\n          'Monitorear rich snippets'\r\n        ],\r\n        requiredResources: ['Desarrollador', 'Herramientas de validación'],\r\n        kpis: ['Rich snippets', 'CTR', 'Impresiones'],\r\n        relatedRecommendations: ['rec-1'],\r\n        status: 'pending',\r\n        notes: []\r\n      }\r\n    ];\r\n  }\r\n\r\n  // ===================================\r\n  // MÉTODOS DE UTILIDAD Y CACHE\r\n  // ===================================\r\n\r\n  private async cacheMetrics(key: string, data: any): Promise<void> {\r\n    try {\r\n      const cacheKey = `seo_analytics:${key}`;\r\n      const cacheData = { data, timestamp: Date.now() };\r\n\r\n      // Cache en Redis si está disponible\r\n      if (this.redis) {\r\n        await this.redis.setex(cacheKey, this.config.cache.ttl, JSON.stringify(cacheData));\r\n      }\r\n\r\n      // Cache en memoria\r\n      this.cache.set(cacheKey, cacheData);\r\n\r\n      // Limpiar cache si excede el tamaño máximo\r\n      if (this.cache.size > this.config.cache.maxSize) {\r\n        const oldestKey = this.cache.keys().next().value;\r\n        this.cache.delete(oldestKey);\r\n      }\r\n\r\n    } catch (error) {\r\n      logger.warn(LogLevel.WARN, 'Failed to cache SEO metrics', { key }, LogCategory.SEO);\r\n    }\r\n  }\r\n\r\n  private async getCachedMetrics(key: string): Promise<any> {\r\n    try {\r\n      const cacheKey = `seo_analytics:${key}`;\r\n\r\n      // Intentar Redis primero\r\n      if (this.redis) {\r\n        const cached = await this.redis.get(cacheKey);\r\n        if (cached) {\r\n          const parsed = JSON.parse(cached);\r\n          if (Date.now() - parsed.timestamp < this.config.cache.ttl * 1000) {\r\n            return parsed.data;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Fallback a cache en memoria\r\n      const memoryCached = this.cache.get(cacheKey);\r\n      if (memoryCached) {\r\n        if (Date.now() - memoryCached.timestamp < this.config.cache.ttl * 1000) {\r\n          return memoryCached.data;\r\n        } else {\r\n          this.cache.delete(cacheKey);\r\n        }\r\n      }\r\n\r\n      return null;\r\n    } catch (error) {\r\n      logger.warn(LogLevel.WARN, 'Failed to get cached SEO metrics', { key }, LogCategory.SEO);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Obtener métricas históricas\r\n  getHistoricalMetrics(days: number = 30): SEOMetrics[] {\r\n    const cutoffDate = new Date();\r\n    cutoffDate.setDate(cutoffDate.getDate() - days);\r\n\r\n    return this.metrics.filter(metric => metric.timestamp >= cutoffDate);\r\n  }\r\n\r\n  // Obtener últimas métricas\r\n  getLastMetrics(): SEOMetrics | null {\r\n    return this.metrics.length > 0 ? this.metrics[this.metrics.length - 1] : null;\r\n  }\r\n\r\n  // Calcular score SEO general mejorado\r\n  private calculateOverallSEOScore(metrics: SEOMetrics): number {\r\n    let score = 0;\r\n    let factors = 0;\r\n\r\n    // Core Web Vitals (30%)\r\n    if (metrics.coreWebVitals.score === 'good') {score += 30;}\r\n    else if (metrics.coreWebVitals.score === 'needs-improvement') {score += 20;}\r\n    else {score += 10;}\r\n    factors += 30;\r\n\r\n    // Indexación (20%)\r\n    score += (metrics.indexationStatus.indexationRate / 100) * 20;\r\n    factors += 20;\r\n\r\n    // CTR (15%)\r\n    const normalizedCTR = Math.min(metrics.ctr / 10, 1); // Normalizar a 0-1\r\n    score += normalizedCTR * 15;\r\n    factors += 15;\r\n\r\n    // Posición promedio (15%)\r\n    const positionScore = Math.max(0, (50 - metrics.avgPosition) / 50);\r\n    score += positionScore * 15;\r\n    factors += 15;\r\n\r\n    // Tráfico orgánico (10%)\r\n    const trafficScore = Math.min(metrics.organicTraffic / 10000, 1); // Normalizar\r\n    score += trafficScore * 10;\r\n    factors += 10;\r\n\r\n    // Alertas críticas (10%)\r\n    const criticalAlerts = this.alerts.filter(a => a.type === 'critical' && !a.resolved).length;\r\n    const alertPenalty = Math.min(criticalAlerts * 2, 10);\r\n    score += Math.max(0, 10 - alertPenalty);\r\n    factors += 10;\r\n\r\n    return Math.round(score);\r\n  }\r\n\r\n  // Obtener keywords por tendencia\r\n  getKeywordsByTrend(trend: 'up' | 'down' | 'stable'): KeywordMetrics[] {\r\n    return this.keywords.filter(keyword => keyword.trend === trend);\r\n  }\r\n\r\n  // Obtener alertas por tipo\r\n  getAlertsByType(type: 'critical' | 'warning' | 'info'): SEOAlert[] {\r\n    return this.alerts.filter(alert => alert.type === type && !alert.resolved);\r\n  }\r\n\r\n  // Obtener alertas no resueltas\r\n  getUnresolvedAlerts(): SEOAlert[] {\r\n    return this.alerts.filter(alert => !alert.resolved);\r\n  }\r\n\r\n  // Resolver alerta mejorado\r\n  async resolveAlert(alertId: string, notes?: string): Promise<boolean> {\r\n    const alert = this.alerts.find(a => a.id === alertId);\r\n    if (alert) {\r\n      alert.resolved = true;\r\n      if (notes) {\r\n        if (!alert.notes) {\r\n          alert.notes = [];\r\n        }\r\n        alert.notes.push(notes);\r\n      }\r\n\r\n      await this.cacheMetrics('alerts', this.alerts);\r\n      this.notifyListeners({ type: 'alert_resolved', data: alert });\r\n\r\n      logger.info(LogLevel.INFO, 'SEO alert resolved', {\r\n        alertId,\r\n        title: alert.title,\r\n        category: alert.category\r\n      }, LogCategory.SEO);\r\n\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // Obtener estadísticas de keywords\r\n  getKeywordStats(): {\r\n    total: number;\r\n    topPositions: number;\r\n    improvements: number;\r\n    declines: number;\r\n    averagePosition: number;\r\n  } {\r\n    const total = this.keywords.length;\r\n    const topPositions = this.keywords.filter(k => k.position <= 10).length;\r\n    const improvements = this.keywords.filter(k => k.trend === 'up').length;\r\n    const declines = this.keywords.filter(k => k.trend === 'down').length;\r\n    const averagePosition = total > 0\r\n      ? this.keywords.reduce((sum, k) => sum + k.position, 0) / total\r\n      : 0;\r\n\r\n    return {\r\n      total,\r\n      topPositions,\r\n      improvements,\r\n      declines,\r\n      averagePosition: Number(averagePosition.toFixed(1))\r\n    };\r\n  }\r\n\r\n  // Obtener métricas de performance\r\n  getPerformanceMetrics(): {\r\n    coreWebVitalsScore: string;\r\n    averageLCP: number;\r\n    averageFID: number;\r\n    averageCLS: number;\r\n    performanceIssues: number;\r\n  } {\r\n    const lastMetrics = this.getLastMetrics();\r\n    if (!lastMetrics) {\r\n      return {\r\n        coreWebVitalsScore: 'unknown',\r\n        averageLCP: 0,\r\n        averageFID: 0,\r\n        averageCLS: 0,\r\n        performanceIssues: 0\r\n      };\r\n    }\r\n\r\n    const performanceIssues = this.alerts.filter(\r\n      a => a.category === 'performance' && !a.resolved\r\n    ).length;\r\n\r\n    return {\r\n      coreWebVitalsScore: lastMetrics.coreWebVitals.score,\r\n      averageLCP: lastMetrics.coreWebVitals.lcp,\r\n      averageFID: lastMetrics.coreWebVitals.fid,\r\n      averageCLS: lastMetrics.coreWebVitals.cls,\r\n      performanceIssues\r\n    };\r\n  }\r\n\r\n  // Obtener resumen de competidores\r\n  getCompetitorSummary(): {\r\n    totalCompetitors: number;\r\n    averageDomainAuthority: number;\r\n    keywordOpportunities: number;\r\n    contentGaps: number;\r\n  } {\r\n    const totalCompetitors = this.competitors.length;\r\n    const averageDomainAuthority = totalCompetitors > 0\r\n      ? this.competitors.reduce((sum, c) => sum + c.domainAuthority, 0) / totalCompetitors\r\n      : 0;\r\n\r\n    const keywordOpportunities = this.competitors.reduce((sum, c) => sum + c.keywordGaps.length, 0);\r\n    const contentGaps = this.competitors.reduce((sum, c) => sum + c.contentGaps.length, 0);\r\n\r\n    return {\r\n      totalCompetitors,\r\n      averageDomainAuthority: Number(averageDomainAuthority.toFixed(1)),\r\n      keywordOpportunities,\r\n      contentGaps\r\n    };\r\n  }\r\n\r\n  // Exportar datos para dashboard\r\n  exportDashboardData(): {\r\n    overview: any;\r\n    keywords: KeywordMetrics[];\r\n    alerts: SEOAlert[];\r\n    performance: any;\r\n    competitors: any;\r\n    reports: SEOReport[];\r\n  } {\r\n    const lastMetrics = this.getLastMetrics();\r\n\r\n    return {\r\n      overview: {\r\n        overallScore: lastMetrics ? this.calculateOverallSEOScore(lastMetrics) : 0,\r\n        organicTraffic: lastMetrics?.organicTraffic || 0,\r\n        averagePosition: this.getKeywordStats().averagePosition,\r\n        indexationRate: lastMetrics?.indexationStatus.indexationRate || 0,\r\n        coreWebVitalsScore: lastMetrics?.coreWebVitals.score || 'unknown',\r\n        unresolvedAlerts: this.getUnresolvedAlerts().length,\r\n        lastUpdated: lastMetrics?.timestamp || new Date()\r\n      },\r\n      keywords: this.keywords.slice(0, 20), // Top 20 keywords\r\n      alerts: this.getUnresolvedAlerts().slice(0, 10), // Top 10 alerts\r\n      performance: this.getPerformanceMetrics(),\r\n      competitors: this.getCompetitorSummary(),\r\n      reports: this.reports.slice(-5) // Últimos 5 reportes\r\n    };\r\n  }\r\n\r\n  // Limpiar datos antiguos\r\n  async cleanupOldData(): Promise<void> {\r\n    const now = new Date();\r\n\r\n    // Limpiar métricas antiguas\r\n    const metricsRetentionDate = new Date(now.getTime() - this.config.dataRetention.metricsRetentionDays * 24 * 60 * 60 * 1000);\r\n    this.metrics = this.metrics.filter(m => m.timestamp >= metricsRetentionDate);\r\n\r\n    // Limpiar alertas antiguas\r\n    const alertsRetentionDate = new Date(now.getTime() - this.config.dataRetention.alertsRetentionDays * 24 * 60 * 60 * 1000);\r\n    this.alerts = this.alerts.filter(a => a.timestamp >= alertsRetentionDate);\r\n\r\n    // Limpiar reportes antiguos\r\n    const reportsRetentionDate = new Date(now.getTime() - this.config.dataRetention.reportsRetentionDays * 24 * 60 * 60 * 1000);\r\n    this.reports = this.reports.filter(r => r.generatedAt >= reportsRetentionDate);\r\n\r\n    logger.info(LogLevel.INFO, 'SEO analytics data cleanup completed', {\r\n      metricsCount: this.metrics.length,\r\n      alertsCount: this.alerts.length,\r\n      reportsCount: this.reports.length\r\n    }, LogCategory.SEO);\r\n  }\r\n\r\n  // Suscribirse a actualizaciones\r\n  subscribe(callback: (data: any) => void): void {\r\n    this.listeners.push(callback);\r\n  }\r\n\r\n  // Desuscribirse de actualizaciones\r\n  unsubscribe(callback: (data: any) => void): void {\r\n    const index = this.listeners.indexOf(callback);\r\n    if (index > -1) {\r\n      this.listeners.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  // Notificar a todos los listeners\r\n  private notifyListeners(data: any): void {\r\n    this.listeners.forEach(callback => {\r\n      try {\r\n        callback(data);\r\n      } catch (error) {\r\n        logger.error(LogLevel.ERROR, 'Error in SEO analytics listener', error as Error, LogCategory.SEO);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Destructor para limpiar intervalos\r\n  destroy(): void {\r\n    if (this.metricsInterval) {\r\n      clearInterval(this.metricsInterval);\r\n      this.metricsInterval = null;\r\n    }\r\n    if (this.keywordInterval) {\r\n      clearInterval(this.keywordInterval);\r\n      this.keywordInterval = null;\r\n    }\r\n    if (this.competitorInterval) {\r\n      clearInterval(this.competitorInterval);\r\n      this.competitorInterval = null;\r\n    }\r\n    if (this.alertInterval) {\r\n      clearInterval(this.alertInterval);\r\n      this.alertInterval = null;\r\n    }\r\n\r\n    this.listeners = [];\r\n    this.cache.clear();\r\n\r\n    logger.info(LogLevel.INFO, 'Enhanced SEO Analytics Manager destroyed', {}, LogCategory.SEO);\r\n  }\r\n}\r\n\r\n// ===================================\r\n// INSTANCIAS Y EXPORTACIONES\r\n// ===================================\r\n\r\n// Instancia singleton mejorada\r\nexport const enhancedSEOAnalyticsManager = EnhancedSEOAnalyticsManager.getInstance();\r\n\r\n// Mantener compatibilidad con la instancia anterior\r\nexport const seoAnalyticsManager = enhancedSEOAnalyticsManager;\r\n\r\n// Exportar configuración por defecto\r\nexport { DEFAULT_SEO_CONFIG };\r\n\r\n// Exportar tipos principales\r\nexport type {\r\n  SEOAnalyticsConfig,\r\n  SEOMetrics,\r\n  KeywordMetrics,\r\n  CompetitorAnalysis,\r\n  SEOAlert,\r\n  SEOReport,\r\n  SEORecommendation,\r\n  CoreWebVitals,\r\n  IndexationStatus,\r\n  TechnicalSEOMetrics,\r\n  PageMetrics,\r\n  DeviceMetrics,\r\n  GeographicMetrics,\r\n  CompetitorKeywordData,\r\n  SeasonalData,\r\n  CompetitorPage,\r\n  ContentGap,\r\n  BacklinkGap,\r\n  SocialMetrics,\r\n  ResolutionStep,\r\n  ExecutiveSummary,\r\n  PerformanceAnalysis,\r\n  KeywordAnalysis,\r\n  TechnicalAnalysis,\r\n  ContentAnalysis,\r\n  CompetitiveAnalysis,\r\n  ActionPlan,\r\n  ActionItem,\r\n  ScheduledDelivery,\r\n  BudgetRecommendation,\r\n  PagePerformance,\r\n  TechnicalIssue,\r\n  ContentMetrics,\r\n  CompetitorComparison,\r\n  OpportunityAnalysis\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["DEFAULT_SEO_CONFIG","EnhancedSEOAnalyticsManager","enhancedSEOAnalyticsManager","seoAnalyticsManager","enableRealTimeTracking","enableKeywordTracking","enableCompetitorAnalysis","enableAutomatedReports","enableAlerts","metricsUpdateInterval","keywordUpdateInterval","competitorUpdateInterval","alertCheckInterval","reportSchedule","daily","enabled","time","recipients","weekly","day","monthly","alertThresholds","seoScoreDrop","rankingDrop","trafficDrop","performanceDrop","criticalIssuesIncrease","conversionRateDrop","integrations","googleSearchConsole","googleAnalytics","semrush","ahrefs","screaminFrog","cache","ttl","maxSize","dataRetention","metricsRetentionDays","alertsRetentionDays","reportsRetentionDays","config","metrics","keywords","alerts","reports","competitors","listeners","Map","metricsInterval","keywordInterval","competitorInterval","alertInterval","initializeRedis","startTracking","logger","info","LogLevel","INFO","realTimeTracking","keywordTracking","competitorAnalysis","automatedReports","LogCategory","SEO","getInstance","instance","redis","getRedisClient","error","warn","WARN","setInterval","collectAndProcessMetrics","updateKeywordRankings","updateCompetitorAnalysis","checkAlerts","coreWebVitals","collectCoreWebVitals","indexationStatus","analyzeIndexationStatus","technicalSEO","evaluateTechnicalSEO","performanceMetrics","realTimePerformanceMonitor","getCurrentMetrics","trafficMetrics","collectTrafficMetrics","timestamp","Date","push","cacheMetrics","checkMetricsThresholds","notifyListeners","type","data","coreWebVitalsScore","score","indexationRate","organicTraffic","ERROR","Promise","resolve","webVitals","length","latest","lcp","fid","cls","fcp","ttfb","inp","Math","random","speedIndex","totalBlockingTime","largestContentfulPaintElement","cumulativeLayoutShiftSources","lcpScore","fidScore","clsScore","scores","every","s","some","baseTraffic","floor","pageViews","uniqueVisitors","bounceRate","avgSessionDuration","searchImpressions","searchClicks","avgPosition","ctr","conversionRate","revenueFromOrganic","topLandingPages","getTopLandingPages","topExitPages","getTopExitPages","deviceBreakdown","getDeviceBreakdown","geographicData","getGeographicData","pages","map","url","uniquePageViews","avgTimeOnPage","exitRate","conversions","revenue","desktop","sessions","mobile","tablet","locations","country","region","city","location","users","totalPages","indexedPages","notIndexedPages","Number","toFixed","crawlErrors","sitemapStatus","lastCrawlDate","now","mobileUsability","pagespeedScore","httpsUsage","structuredDataErrors","metaTagsOptimization","internalLinkingScore","imageOptimization","canonicalIssues","collectMetrics","analyzeKeywords","checkKeywordAlerts","totalKeywords","averagePosition","reduce","sum","k","position","sampleKeywords","keyword","intent","volume","all","previousPosition","clicks","impressions","searchVolume","difficulty","encodeURIComponent","trend","searchEngine","device","competitorRankings","getCompetitorRankings","relatedKeywords","getRelatedKeywords","seasonalTrends","getSeasonalTrends","costPerClick","lastUpdated","domain","title","description","relatedMap","Array","from","_","month","competition","cpc","analyzeCompetitors","competitorsAnalyzed","competitorDomains","organicKeywords","competitor","split","backlinks","domainAuthority","commonKeywords","getCommonKeywords","keywordGaps","getKeywordGaps","pageAuthority","trustFlow","citationFlow","referringDomains","organicCost","paidKeywords","paidTraffic","paidCost","topPages","getCompetitorTopPages","contentGaps","getContentGaps","backlinksGaps","getBacklinkGaps","socialMetrics","getSocialMetrics","technicalSEOScore","lastAnalyzed","pop","traffic","socialShares","topic","opportunity","linkType","anchorText","facebook","likes","shares","comments","twitter","followers","tweets","retweets","linkedin","posts","engagement","instagram","detectSEOIssues","criticalAlerts","filter","alert","advancedAlertingEngine","createAlert","AlertType","PERFORMANCE","AlertSeverity","CRITICAL","category","severity","recommendations","previousMetrics","getLastMetrics","drop","significantDrops","lostTopPositions","technicalIssues","detectTechnicalIssues","contentIssues","detectContentIssues","performanceIssues","detectPerformanceIssues","mobileIssues","detectMobileIssues","issues","technicalProblems","affectedPages","impact","effort","priority","estimatedTrafficImpact","estimatedRevenueImpact","problem","createAdvancedAlert","contentProblems","performanceProblems","mobileProblems","id","toString","substr","resolved","relatedAlerts","autoResolvable","resolutionSteps","lastOccurrence","frequency","tags","getRecommendationsForCategory","getResolutionSteps","technical","content","performance","schema","steps","step","action","estimatedTime","requiredSkills","generateSEOReport","period","customDateRange","endDate","startDate","setTime","start","getTime","end","setDate","getDate","setMonth","getMonth","setFullYear","getFullYear","report","generateRecommendations","executiveSummary","generateExecutiveSummary","performanceAnalysis","generatePerformanceAnalysis","keywordAnalysis","generateKeywordAnalysis","technicalAnalysis","generateTechnicalAnalysis","contentAnalysis","generateContentAnalysis","competitiveAnalysis","generateCompetitiveAnalysis","actionPlan","generateActionPlan","generatedBy","generatedAt","version","exportFormats","scheduledDelivery","reportId","overallScore","alertsCount","keywordsCount","currentMetrics","calculateOverallSEOScore","scoreChange","keyAchievements","majorConcerns","quickWins","budgetRecommendations","estimatedCost","expectedROI","timeframe","cwv","coreWebVitalsChange","pageSpeedScore","pageSpeedChange","mobileScore","mobileChange","slowestPages","performanceRecommendations","keywordsChange","positionChange","topGainers","sort","a","b","slice","topLosers","newKeywords","lostKeywords","opportunityKeywords","crawlabilityScore","indexabilityScore","structuredDataScore","mobileUsabilityScore","securityScore","count","fix","improvements","duplicateContent","thinContent","missingMetaTags","contentQualityScore","topPerformingContent","wordCount","readabilityScore","marketShare","visibilityScore","competitorComparison","comp","ourPosition","theirPosition","gap","opportunityAnalysis","potential","dependencies","kpis","shortTerm","longTerm","ongoing","estimatedTimeToImplement","estimatedTrafficIncrease","estimatedRevenueIncrease","implementationSteps","requiredResources","relatedRecommendations","status","notes","key","cacheKey","cacheData","setex","JSON","stringify","set","size","oldestKey","keys","next","value","delete","getCachedMetrics","cached","get","parsed","parse","memoryCached","getHistoricalMetrics","days","cutoffDate","metric","factors","normalizedCTR","min","positionScore","max","trafficScore","alertPenalty","round","getKeywordsByTrend","getAlertsByType","getUnresolvedAlerts","resolveAlert","alertId","find","getKeywordStats","total","topPositions","declines","getPerformanceMetrics","lastMetrics","averageLCP","averageFID","averageCLS","getCompetitorSummary","totalCompetitors","averageDomainAuthority","c","keywordOpportunities","exportDashboardData","overview","unresolvedAlerts","cleanupOldData","metricsRetentionDate","m","alertsRetentionDate","reportsRetentionDate","r","metricsCount","reportsCount","subscribe","callback","unsubscribe","index","indexOf","splice","forEach","destroy","clearInterval","clear"],"mappings":"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"}