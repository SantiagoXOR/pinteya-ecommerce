{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\auth.ts"],"sourcesContent":["import NextAuth from 'next-auth'\nimport Google from 'next-auth/providers/google'\nimport { SupabaseAdapter } from './lib/integrations/supabase/supabase-adapter'\n\n// Validación de variables de entorno requeridas\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\nif (!supabaseUrl) {\n  throw new Error('NEXT_PUBLIC_SUPABASE_URL is required but not defined')\n}\n\nif (!supabaseServiceRoleKey) {\n  throw new Error('SUPABASE_SERVICE_ROLE_KEY is required but not defined')\n}\n\nconst nextAuth = NextAuth({\n  adapter: SupabaseAdapter({\n    url: supabaseUrl,\n    secret: supabaseServiceRoleKey,\n  }),\n  providers: [\n    Google({\n      clientId: process.env.AUTH_GOOGLE_ID!,\n      clientSecret: process.env.AUTH_GOOGLE_SECRET!,\n      authorization: {\n        params: {\n          prompt: 'select_account',\n        },\n      },\n    }),\n  ],\n  pages: {\n    signIn: '/auth/signin',\n    error: '/auth/error',\n  },\n  callbacks: {\n    async jwt({ token, user, account }) {\n      if (account && user) {\n        token.accessToken = account.access_token\n        token.refreshToken = account.refresh_token\n        token.userId = user.id\n      }\n      return token\n    },\n    async session({ session, token }) {\n      if (token) {\n        session.accessToken = token.accessToken as string\n        session.refreshToken = token.refreshToken as string\n        session.user.id = token.userId as string\n      }\n      return session\n    },\n    async signIn({ user, account, profile }) {\n      // Permitir el sign-in para todos los usuarios de Google\n      if (account?.provider === 'google') {\n        return true\n      }\n      return false\n    },\n  },\n  events: {\n    async signIn({ user, account, profile }) {\n      console.log('Usuario autenticado:', user.email)\n    },\n    async signOut({ session, token }) {\n      console.log('Usuario desconectado')\n    },\n  },\n  session: {\n    strategy: 'jwt' as const,\n    maxAge: 30 * 24 * 60 * 60, // 30 días\n  },\n  jwt: {\n    maxAge: 30 * 24 * 60 * 60, // 30 días\n  },\n})\n\nexport const { auth, handlers, signIn, signOut } = nextAuth\n\n// Tipos TypeScript para extender la sesión\ndeclare module 'next-auth' {\n  interface Session {\n    supabaseAccessToken?: string\n    user: {\n      id: string\n      name?: string | null\n      email?: string | null\n      image?: string | null\n    }\n  }\n}\n\ndeclare module 'next-auth/jwt' {\n  interface JWT {\n    sub: string\n  }\n}\n"],"names":["auth","handlers","signIn","signOut","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","supabaseServiceRoleKey","SUPABASE_SERVICE_ROLE_KEY","Error","nextAuth","NextAuth","adapter","SupabaseAdapter","url","secret","providers","Google","clientId","AUTH_GOOGLE_ID","clientSecret","AUTH_GOOGLE_SECRET","authorization","params","prompt","pages","error","callbacks","jwt","token","user","account","accessToken","access_token","refreshToken","refresh_token","userId","id","session","profile","provider","events","console","log","email","strategy","maxAge"],"mappings":";;;;;;;;;;;QA8EeA;eAAAA;;QAAMC;eAAAA;;QAAUC;eAAAA;;QAAQC;eAAAA;;;iEA9ElB;+DACF;iCACa;;;;;;AAEhC,gDAAgD;AAChD,MAAMC,cAAcC,QAAQC,GAAG,CAACC,wBAAwB;AACxD,MAAMC,yBAAyBH,QAAQC,GAAG,CAACG,yBAAyB;AAEpE,IAAI,CAACL,aAAa;IAChB,MAAM,IAAIM,MAAM;AAClB;AAEA,IAAI,CAACF,wBAAwB;IAC3B,MAAM,IAAIE,MAAM;AAClB;AAEA,MAAMC,WAAWC,IAAAA,iBAAQ,EAAC;IACxBC,SAASC,IAAAA,gCAAe,EAAC;QACvBC,KAAKX;QACLY,QAAQR;IACV;IACAS,WAAW;QACTC,IAAAA,eAAM,EAAC;YACLC,UAAUd,QAAQC,GAAG,CAACc,cAAc;YACpCC,cAAchB,QAAQC,GAAG,CAACgB,kBAAkB;YAC5CC,eAAe;gBACbC,QAAQ;oBACNC,QAAQ;gBACV;YACF;QACF;KACD;IACDC,OAAO;QACLxB,QAAQ;QACRyB,OAAO;IACT;IACAC,WAAW;QACT,MAAMC,KAAI,EAAEC,KAAK,EAAEC,IAAI,EAAEC,OAAO,EAAE;YAChC,IAAIA,WAAWD,MAAM;gBACnBD,MAAMG,WAAW,GAAGD,QAAQE,YAAY;gBACxCJ,MAAMK,YAAY,GAAGH,QAAQI,aAAa;gBAC1CN,MAAMO,MAAM,GAAGN,KAAKO,EAAE;YACxB;YACA,OAAOR;QACT;QACA,MAAMS,SAAQ,EAAEA,OAAO,EAAET,KAAK,EAAE;YAC9B,IAAIA,OAAO;gBACTS,QAAQN,WAAW,GAAGH,MAAMG,WAAW;gBACvCM,QAAQJ,YAAY,GAAGL,MAAMK,YAAY;gBACzCI,QAAQR,IAAI,CAACO,EAAE,GAAGR,MAAMO,MAAM;YAChC;YACA,OAAOE;QACT;QACA,MAAMrC,QAAO,EAAE6B,IAAI,EAAEC,OAAO,EAAEQ,OAAO,EAAE;YACrC,wDAAwD;YACxD,IAAIR,SAASS,aAAa,UAAU;gBAClC,OAAO;YACT;YACA,OAAO;QACT;IACF;IACAC,QAAQ;QACN,MAAMxC,QAAO,EAAE6B,IAAI,EAAEC,OAAO,EAAEQ,OAAO,EAAE;YACrCG,QAAQC,GAAG,CAAC,wBAAwBb,KAAKc,KAAK;QAChD;QACA,MAAM1C,SAAQ,EAAEoC,OAAO,EAAET,KAAK,EAAE;YAC9Ba,QAAQC,GAAG,CAAC;QACd;IACF;IACAL,SAAS;QACPO,UAAU;QACVC,QAAQ,KAAK,KAAK,KAAK;IACzB;IACAlB,KAAK;QACHkB,QAAQ,KAAK,KAAK,KAAK;IACzB;AACF;AAEO,MAAM,EAAE/C,IAAI,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,OAAO,EAAE,GAAGQ"}