{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\integration\\checkout-flow.test.tsx"],"sourcesContent":["// ===================================\r\n// TESTS DE INTEGRACIÓN - FLUJO DE CHECKOUT\r\n// Tests completos del proceso de compra\r\n// ===================================\r\n\r\nimport { render, screen, fireEvent, waitFor, within } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport { CheckoutPage } from '@/app/checkout/page';\r\nimport { CartProvider } from '@/contexts/CartContext';\r\nimport { AuthProvider } from '@/contexts/AuthContext';\r\nimport { supabase } from '@/lib/integrations/supabase';\r\nimport { toast } from 'sonner';\r\nimport { useRouter } from 'next/navigation';\r\nimport React from 'react';\r\n\r\n// Mocks\r\njest.mock('@/lib/supabase', () => ({\r\n  supabase: {\r\n    auth: {\r\n      getUser: jest.fn(),\r\n      signInWithPassword: jest.fn()\r\n    },\r\n    from: jest.fn(() => ({\r\n      select: jest.fn(() => ({\r\n        eq: jest.fn(() => ({\r\n          single: jest.fn(),\r\n          order: jest.fn(() => ({\r\n            limit: jest.fn()\r\n          }))\r\n        })),\r\n        insert: jest.fn(),\r\n        update: jest.fn(() => ({\r\n          eq: jest.fn()\r\n        }))\r\n      }))\r\n    }))\r\n  }\r\n}));\r\n\r\njest.mock('sonner', () => ({\r\n  toast: {\r\n    success: jest.fn(),\r\n    error: jest.fn(),\r\n    loading: jest.fn()\r\n  }\r\n}));\r\n\r\njest.mock('next/navigation', () => ({\r\n  useRouter: jest.fn()\r\n}));\r\n\r\n// Mock MercadoPago\r\njest.mock('@/lib/mercadopago', () => ({\r\n  createPreference: jest.fn(),\r\n  processPayment: jest.fn()\r\n}));\r\n\r\nconst mockRouter = {\r\n  push: jest.fn(),\r\n  replace: jest.fn(),\r\n  refresh: jest.fn()\r\n};\r\n\r\n// Mock localStorage\r\nconst localStorageMock = (() => {\r\n  let store: { [key: string]: string } = {};\r\n  return {\r\n    getItem: (key: string) => store[key] || null,\r\n    setItem: (key: string, value: string) => { store[key] = value; },\r\n    removeItem: (key: string) => { delete store[key]; },\r\n    clear: () => { store = {}; }\r\n  };\r\n})();\r\n\r\nObject.defineProperty(window, 'localStorage', { value: localStorageMock });\r\n\r\n// Datos de prueba\r\nconst mockUser = {\r\n  id: 'user-123',\r\n  email: 'test@example.com',\r\n  user_metadata: { full_name: 'Test User' }\r\n};\r\n\r\nconst mockCartItems = [\r\n  {\r\n    id: 1,\r\n    name: 'Producto Test 1',\r\n    price: 100,\r\n    quantity: 2,\r\n    image: 'https://example.com/image1.jpg',\r\n    stock: 10\r\n  },\r\n  {\r\n    id: 2,\r\n    name: 'Producto Test 2',\r\n    price: 50,\r\n    quantity: 1,\r\n    image: 'https://example.com/image2.jpg',\r\n    stock: 5\r\n  }\r\n];\r\n\r\nconst mockShippingAddress = {\r\n  street: 'Av. Corrientes 1234',\r\n  city: 'Buenos Aires',\r\n  state: 'CABA',\r\n  postal_code: '1043',\r\n  country: 'Argentina'\r\n};\r\n\r\n// Wrapper de providers\r\nconst createWrapper = (initialCartItems = mockCartItems) => {\r\n  const queryClient = new QueryClient({\r\n    defaultOptions: {\r\n      queries: { retry: false },\r\n      mutations: { retry: false }\r\n    }\r\n  });\r\n\r\n  // Configurar localStorage con items del carrito\r\n  localStorageMock.setItem('cart-items', JSON.stringify(initialCartItems));\r\n\r\n  return ({ children }: { children: React.ReactNode }) => (\r\n    <QueryClientProvider client={queryClient}>\r\n      <AuthProvider>\r\n        <CartProvider>\r\n          {children}\r\n        </CartProvider>\r\n      </AuthProvider>\r\n    </QueryClientProvider>\r\n  );\r\n};\r\n\r\ndescribe('Flujo de Checkout - Integración', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    localStorageMock.clear();\r\n    (useRouter as jest.Mock).mockReturnValue(mockRouter);\r\n  });\r\n\r\n  describe('Inicialización del Checkout', () => {\r\n    it('debe mostrar los productos del carrito correctamente', async () => {\r\n      (supabase.auth.getUser as jest.Mock).mockResolvedValue({\r\n        data: { user: mockUser },\r\n        error: null\r\n      });\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n\r\n      // Verificar que se muestran los productos\r\n      expect(screen.getByText('Producto Test 1')).toBeInTheDocument();\r\n      expect(screen.getByText('Producto Test 2')).toBeInTheDocument();\r\n      \r\n      // Verificar cantidades\r\n      expect(screen.getByText('Cantidad: 2')).toBeInTheDocument();\r\n      expect(screen.getByText('Cantidad: 1')).toBeInTheDocument();\r\n      \r\n      // Verificar total\r\n      expect(screen.getByText('Total: $250')).toBeInTheDocument();\r\n    });\r\n\r\n    it('debe redirigir si el carrito está vacío', async () => {\r\n      render(<CheckoutPage />, { wrapper: createWrapper([]) });\r\n\r\n      await waitFor(() => {\r\n        expect(mockRouter.push).toHaveBeenCalledWith('/cart');\r\n      });\r\n\r\n      expect(toast.error).toHaveBeenCalledWith(\r\n        'Tu carrito está vacío. Agrega productos antes de continuar.'\r\n      );\r\n    });\r\n\r\n    it('debe mostrar formulario de login si no está autenticado', async () => {\r\n      (supabase.auth.getUser as jest.Mock).mockResolvedValue({\r\n        data: { user: null },\r\n        error: null\r\n      });\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n\r\n      expect(screen.getByText('Iniciar Sesión')).toBeInTheDocument();\r\n      expect(screen.getByLabelText('Email')).toBeInTheDocument();\r\n      expect(screen.getByLabelText('Contraseña')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  describe('Autenticación en Checkout', () => {\r\n    it('debe permitir login durante el checkout', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      (supabase.auth.getUser as jest.Mock).mockResolvedValue({\r\n        data: { user: null },\r\n        error: null\r\n      });\r\n\r\n      (supabase.auth.signInWithPassword as jest.Mock).mockResolvedValue({\r\n        data: { user: mockUser },\r\n        error: null\r\n      });\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n\r\n      // Llenar formulario de login\r\n      await user.type(screen.getByLabelText('Email'), 'test@example.com');\r\n      await user.type(screen.getByLabelText('Contraseña'), 'password123');\r\n      \r\n      // Hacer click en login\r\n      await user.click(screen.getByRole('button', { name: /iniciar sesión/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(supabase.auth.signInWithPassword).toHaveBeenCalledWith({\r\n          email: 'test@example.com',\r\n          password: 'password123'\r\n        });\r\n      });\r\n\r\n      // Debe mostrar el formulario de checkout después del login\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Información de Envío')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('debe manejar errores de login', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      (supabase.auth.getUser as jest.Mock).mockResolvedValue({\r\n        data: { user: null },\r\n        error: null\r\n      });\r\n\r\n      (supabase.auth.signInWithPassword as jest.Mock).mockResolvedValue({\r\n        data: null,\r\n        error: { message: 'Invalid credentials' }\r\n      });\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n\r\n      await user.type(screen.getByLabelText('Email'), 'test@example.com');\r\n      await user.type(screen.getByLabelText('Contraseña'), 'wrongpassword');\r\n      await user.click(screen.getByRole('button', { name: /iniciar sesión/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(toast.error).toHaveBeenCalledWith('Credenciales inválidas');\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Formulario de Información de Envío', () => {\r\n    beforeEach(() => {\r\n      (supabase.auth.getUser as jest.Mock).mockResolvedValue({\r\n        data: { user: mockUser },\r\n        error: null\r\n      });\r\n    });\r\n\r\n    it('debe validar campos requeridos', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n\r\n      // Intentar continuar sin llenar campos\r\n      const continueButton = screen.getByRole('button', { name: /continuar/i });\r\n      await user.click(continueButton);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('La dirección es requerida')).toBeInTheDocument();\r\n        expect(screen.getByText('La ciudad es requerida')).toBeInTheDocument();\r\n        expect(screen.getByText('El código postal es requerido')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('debe llenar y validar el formulario correctamente', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n\r\n      // Llenar formulario de envío\r\n      await user.type(screen.getByLabelText('Dirección'), mockShippingAddress.street);\r\n      await user.type(screen.getByLabelText('Ciudad'), mockShippingAddress.city);\r\n      await user.type(screen.getByLabelText('Provincia/Estado'), mockShippingAddress.state);\r\n      await user.type(screen.getByLabelText('Código Postal'), mockShippingAddress.postal_code);\r\n      \r\n      // Seleccionar país\r\n      const countrySelect = screen.getByLabelText('País');\r\n      await user.selectOptions(countrySelect, mockShippingAddress.country);\r\n\r\n      // Continuar al siguiente paso\r\n      await user.click(screen.getByRole('button', { name: /continuar/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Método de Pago')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('debe validar formato de código postal', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n\r\n      await user.type(screen.getByLabelText('Código Postal'), 'invalid');\r\n      await user.click(screen.getByRole('button', { name: /continuar/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Formato de código postal inválido')).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Selección de Método de Pago', () => {\r\n    beforeEach(async () => {\r\n      (supabase.auth.getUser as jest.Mock).mockResolvedValue({\r\n        data: { user: mockUser },\r\n        error: null\r\n      });\r\n    });\r\n\r\n    const fillShippingForm = async (user: any) => {\r\n      await user.type(screen.getByLabelText('Dirección'), mockShippingAddress.street);\r\n      await user.type(screen.getByLabelText('Ciudad'), mockShippingAddress.city);\r\n      await user.type(screen.getByLabelText('Provincia/Estado'), mockShippingAddress.state);\r\n      await user.type(screen.getByLabelText('Código Postal'), mockShippingAddress.postal_code);\r\n      await user.selectOptions(screen.getByLabelText('País'), mockShippingAddress.country);\r\n      await user.click(screen.getByRole('button', { name: /continuar/i }));\r\n    };\r\n\r\n    it('debe mostrar opciones de pago disponibles', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n      \r\n      await fillShippingForm(user);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('MercadoPago')).toBeInTheDocument();\r\n        expect(screen.getByText('Transferencia Bancaria')).toBeInTheDocument();\r\n        expect(screen.getByText('Efectivo')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('debe seleccionar método de pago', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n      \r\n      await fillShippingForm(user);\r\n\r\n      // Seleccionar MercadoPago\r\n      const mercadopagoOption = screen.getByLabelText('MercadoPago');\r\n      await user.click(mercadopagoOption);\r\n\r\n      expect(mercadopagoOption).toBeChecked();\r\n      \r\n      // Debe mostrar información adicional de MercadoPago\r\n      expect(screen.getByText('Paga con tarjeta de crédito, débito o efectivo')).toBeInTheDocument();\r\n    });\r\n\r\n    it('debe validar selección de método de pago', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n      \r\n      await fillShippingForm(user);\r\n\r\n      // Intentar continuar sin seleccionar método de pago\r\n      await user.click(screen.getByRole('button', { name: /finalizar compra/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Selecciona un método de pago')).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Finalización de Compra', () => {\r\n    beforeEach(() => {\r\n      (supabase.auth.getUser as jest.Mock).mockResolvedValue({\r\n        data: { user: mockUser },\r\n        error: null\r\n      });\r\n    });\r\n\r\n    const completeCheckoutForm = async (user: any) => {\r\n      // Llenar información de envío\r\n      await user.type(screen.getByLabelText('Dirección'), mockShippingAddress.street);\r\n      await user.type(screen.getByLabelText('Ciudad'), mockShippingAddress.city);\r\n      await user.type(screen.getByLabelText('Provincia/Estado'), mockShippingAddress.state);\r\n      await user.type(screen.getByLabelText('Código Postal'), mockShippingAddress.postal_code);\r\n      await user.selectOptions(screen.getByLabelText('País'), mockShippingAddress.country);\r\n      await user.click(screen.getByRole('button', { name: /continuar/i }));\r\n\r\n      // Seleccionar método de pago\r\n      await waitFor(() => {\r\n        expect(screen.getByLabelText('MercadoPago')).toBeInTheDocument();\r\n      });\r\n      await user.click(screen.getByLabelText('MercadoPago'));\r\n    };\r\n\r\n    it('debe crear la orden exitosamente', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      // Mock de creación de orden\r\n      (supabase.from as jest.Mock).mockReturnValue({\r\n        insert: jest.fn().mockResolvedValue({\r\n          data: [{ id: 'order-123' }],\r\n          error: null\r\n        })\r\n      });\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n      \r\n      await completeCheckoutForm(user);\r\n\r\n      // Finalizar compra\r\n      await user.click(screen.getByRole('button', { name: /finalizar compra/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(supabase.from).toHaveBeenCalledWith('orders');\r\n        expect(toast.success).toHaveBeenCalledWith('¡Compra realizada exitosamente!');\r\n        expect(mockRouter.push).toHaveBeenCalledWith('/orders/order-123');\r\n      });\r\n    });\r\n\r\n    it('debe manejar errores al crear la orden', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      (supabase.from as jest.Mock).mockReturnValue({\r\n        insert: jest.fn().mockResolvedValue({\r\n          data: null,\r\n          error: { message: 'Database error' }\r\n        })\r\n      });\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n      \r\n      await completeCheckoutForm(user);\r\n      await user.click(screen.getByRole('button', { name: /finalizar compra/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(toast.error).toHaveBeenCalledWith(\r\n          'Error al procesar la compra. Intenta nuevamente.'\r\n        );\r\n      });\r\n    });\r\n\r\n    it('debe validar stock antes de crear la orden', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      // Mock de productos con stock insuficiente\r\n      const itemsWithLowStock = [\r\n        { ...mockCartItems[0], quantity: 15, stock: 10 } // Más cantidad que stock\r\n      ];\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper(itemsWithLowStock) });\r\n      \r\n      await completeCheckoutForm(user);\r\n      await user.click(screen.getByRole('button', { name: /finalizar compra/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(toast.error).toHaveBeenCalledWith(\r\n          'Algunos productos no tienen stock suficiente'\r\n        );\r\n      });\r\n    });\r\n\r\n    it('debe limpiar el carrito después de compra exitosa', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      (supabase.from as jest.Mock).mockReturnValue({\r\n        insert: jest.fn().mockResolvedValue({\r\n          data: [{ id: 'order-123' }],\r\n          error: null\r\n        })\r\n      });\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n      \r\n      await completeCheckoutForm(user);\r\n      await user.click(screen.getByRole('button', { name: /finalizar compra/i }));\r\n\r\n      await waitFor(() => {\r\n        // Verificar que el localStorage se limpió\r\n        const cartItems = JSON.parse(localStorageMock.getItem('cart-items') || '[]');\r\n        expect(cartItems).toEqual([]);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Integración con MercadoPago', () => {\r\n    beforeEach(() => {\r\n      (supabase.auth.getUser as jest.Mock).mockResolvedValue({\r\n        data: { user: mockUser },\r\n        error: null\r\n      });\r\n    });\r\n\r\n    it('debe crear preferencia de MercadoPago', async () => {\r\n      const user = userEvent.setup();\r\n      const { createPreference } = require('@/lib/mercadopago');\r\n      \r\n      createPreference.mockResolvedValue({\r\n        id: 'preference-123',\r\n        init_point: 'https://mercadopago.com/checkout/preference-123'\r\n      });\r\n\r\n      (supabase.from as jest.Mock).mockReturnValue({\r\n        insert: jest.fn().mockResolvedValue({\r\n          data: [{ id: 'order-123' }],\r\n          error: null\r\n        })\r\n      });\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n      \r\n      // Completar formulario\r\n      await user.type(screen.getByLabelText('Dirección'), mockShippingAddress.street);\r\n      await user.type(screen.getByLabelText('Ciudad'), mockShippingAddress.city);\r\n      await user.type(screen.getByLabelText('Provincia/Estado'), mockShippingAddress.state);\r\n      await user.type(screen.getByLabelText('Código Postal'), mockShippingAddress.postal_code);\r\n      await user.selectOptions(screen.getByLabelText('País'), mockShippingAddress.country);\r\n      await user.click(screen.getByRole('button', { name: /continuar/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByLabelText('MercadoPago')).toBeInTheDocument();\r\n      });\r\n      await user.click(screen.getByLabelText('MercadoPago'));\r\n      await user.click(screen.getByRole('button', { name: /finalizar compra/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(createPreference).toHaveBeenCalledWith({\r\n          items: expect.arrayContaining([\r\n            expect.objectContaining({\r\n              title: 'Producto Test 1',\r\n              unit_price: 100,\r\n              quantity: 2\r\n            })\r\n          ]),\r\n          payer: {\r\n            email: mockUser.email\r\n          },\r\n          external_reference: 'order-123'\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Casos Edge y Errores', () => {\r\n    it('debe manejar pérdida de conexión', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      (supabase.from as jest.Mock).mockReturnValue({\r\n        insert: jest.fn().mockRejectedValue(new Error('Network error'))\r\n      });\r\n\r\n      (supabase.auth.getUser as jest.Mock).mockResolvedValue({\r\n        data: { user: mockUser },\r\n        error: null\r\n      });\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n      \r\n      // Completar formulario rápidamente\r\n      await user.type(screen.getByLabelText('Dirección'), mockShippingAddress.street);\r\n      await user.type(screen.getByLabelText('Ciudad'), mockShippingAddress.city);\r\n      await user.type(screen.getByLabelText('Provincia/Estado'), mockShippingAddress.state);\r\n      await user.type(screen.getByLabelText('Código Postal'), mockShippingAddress.postal_code);\r\n      await user.selectOptions(screen.getByLabelText('País'), mockShippingAddress.country);\r\n      await user.click(screen.getByRole('button', { name: /continuar/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByLabelText('MercadoPago')).toBeInTheDocument();\r\n      });\r\n      await user.click(screen.getByLabelText('MercadoPago'));\r\n      await user.click(screen.getByRole('button', { name: /finalizar compra/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(toast.error).toHaveBeenCalledWith(\r\n          'Error de conexión. Verifica tu internet e intenta nuevamente.'\r\n        );\r\n      });\r\n    });\r\n\r\n    it('debe prevenir doble envío de formulario', async () => {\r\n      const user = userEvent.setup();\r\n      \r\n      let resolveInsert: (value: any) => void;\r\n      const insertPromise = new Promise(resolve => {\r\n        resolveInsert = resolve;\r\n      });\r\n\r\n      (supabase.from as jest.Mock).mockReturnValue({\r\n        insert: jest.fn().mockReturnValue(insertPromise)\r\n      });\r\n\r\n      (supabase.auth.getUser as jest.Mock).mockResolvedValue({\r\n        data: { user: mockUser },\r\n        error: null\r\n      });\r\n\r\n      render(<CheckoutPage />, { wrapper: createWrapper() });\r\n      \r\n      // Completar formulario\r\n      await user.type(screen.getByLabelText('Dirección'), mockShippingAddress.street);\r\n      await user.type(screen.getByLabelText('Ciudad'), mockShippingAddress.city);\r\n      await user.type(screen.getByLabelText('Provincia/Estado'), mockShippingAddress.state);\r\n      await user.type(screen.getByLabelText('Código Postal'), mockShippingAddress.postal_code);\r\n      await user.selectOptions(screen.getByLabelText('País'), mockShippingAddress.country);\r\n      await user.click(screen.getByRole('button', { name: /continuar/i }));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByLabelText('MercadoPago')).toBeInTheDocument();\r\n      });\r\n      await user.click(screen.getByLabelText('MercadoPago'));\r\n      \r\n      const submitButton = screen.getByRole('button', { name: /finalizar compra/i });\r\n      \r\n      // Hacer doble click rápido\r\n      await user.click(submitButton);\r\n      await user.click(submitButton);\r\n\r\n      // El botón debe estar deshabilitado después del primer click\r\n      expect(submitButton).toBeDisabled();\r\n      \r\n      // Resolver la promesa\r\n      resolveInsert!({\r\n        data: [{ id: 'order-123' }],\r\n        error: null\r\n      });\r\n\r\n      // Solo debe haberse llamado una vez\r\n      await waitFor(() => {\r\n        expect(supabase.from().insert).toHaveBeenCalledTimes(1);\r\n      });\r\n    });\r\n  });\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["jest","mock","supabase","auth","getUser","fn","signInWithPassword","from","select","eq","single","order","limit","insert","update","toast","success","error","loading","useRouter","createPreference","processPayment","mockRouter","push","replace","refresh","localStorageMock","store","getItem","key","setItem","value","removeItem","clear","Object","defineProperty","window","mockUser","id","email","user_metadata","full_name","mockCartItems","name","price","quantity","image","stock","mockShippingAddress","street","city","state","postal_code","country","createWrapper","initialCartItems","queryClient","QueryClient","defaultOptions","queries","retry","mutations","JSON","stringify","children","QueryClientProvider","client","AuthProvider","CartProvider","describe","beforeEach","clearAllMocks","mockReturnValue","it","mockResolvedValue","data","user","render","CheckoutPage","wrapper","expect","screen","getByText","toBeInTheDocument","waitFor","toHaveBeenCalledWith","getByLabelText","userEvent","setup","type","click","getByRole","password","message","continueButton","countrySelect","selectOptions","fillShippingForm","mercadopagoOption","toBeChecked","completeCheckoutForm","itemsWithLowStock","cartItems","parse","toEqual","require","init_point","items","arrayContaining","objectContaining","title","unit_price","payer","external_reference","mockRejectedValue","Error","resolveInsert","insertPromise","Promise","resolve","submitButton","toBeDisabled","toHaveBeenCalledTimes"],"mappings":"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"}