031a188cab235d8ac23e89c707d2dc43
// 🖼️ Enterprise Individual Product Image API
"use strict";

/* istanbul ignore next */
function cov_1wk6l9glgj() {
  var path = "C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\admin\\products\\[id]\\images\\[imageId]\\route.ts";
  var hash = "30a23b06514f8c398e499468df2d0b8c052fcf11";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\admin\\products\\[id]\\images\\[imageId]\\route.ts",
    statementMap: {
      "0": {
        start: {
          line: 3,
          column: 0
        },
        end: {
          line: 5,
          column: 3
        }
      },
      "1": {
        start: {
          line: 7,
          column: 4
        },
        end: {
          line: 10,
          column: 7
        }
      },
      "2": {
        start: {
          line: 7,
          column: 24
        },
        end: {
          line: 10,
          column: 7
        }
      },
      "3": {
        start: {
          line: 12,
          column: 0
        },
        end: {
          line: 22,
          column: 3
        }
      },
      "4": {
        start: {
          line: 14,
          column: 8
        },
        end: {
          line: 14,
          column: 22
        }
      },
      "5": {
        start: {
          line: 17,
          column: 8
        },
        end: {
          line: 17,
          column: 19
        }
      },
      "6": {
        start: {
          line: 20,
          column: 8
        },
        end: {
          line: 20,
          column: 19
        }
      },
      "7": {
        start: {
          line: 23,
          column: 16
        },
        end: {
          line: 23,
          column: 38
        }
      },
      "8": {
        start: {
          line: 24,
          column: 13
        },
        end: {
          line: 24,
          column: 27
        }
      },
      "9": {
        start: {
          line: 25,
          column: 28
        },
        end: {
          line: 25,
          column: 87
        }
      },
      "10": {
        start: {
          line: 26,
          column: 22
        },
        end: {
          line: 26,
          column: 75
        }
      },
      "11": {
        start: {
          line: 27,
          column: 19
        },
        end: {
          line: 27,
          column: 69
        }
      },
      "12": {
        start: {
          line: 28,
          column: 27
        },
        end: {
          line: 28,
          column: 87
        }
      },
      "13": {
        start: {
          line: 29,
          column: 22
        },
        end: {
          line: 29,
          column: 82
        }
      },
      "14": {
        start: {
          line: 30,
          column: 20
        },
        end: {
          line: 30,
          column: 52
        }
      },
      "15": {
        start: {
          line: 32,
          column: 26
        },
        end: {
          line: 36,
          column: 2
        }
      },
      "16": {
        start: {
          line: 37,
          column: 26
        },
        end: {
          line: 40,
          column: 2
        }
      },
      "17": {
        start: {
          line: 43,
          column: 24
        },
        end: {
          line: 43,
          column: 60
        }
      },
      "18": {
        start: {
          line: 44,
          column: 31
        },
        end: {
          line: 44,
          column: 68
        }
      },
      "19": {
        start: {
          line: 45,
          column: 4
        },
        end: {
          line: 45,
          column: 74
        }
      },
      "20": {
        start: {
          line: 49,
          column: 21
        },
        end: {
          line: 49,
          column: 39
        }
      },
      "21": {
        start: {
          line: 50,
          column: 22
        },
        end: {
          line: 52,
          column: 6
        }
      },
      "22": {
        start: {
          line: 53,
          column: 4
        },
        end: {
          line: 56,
          column: 5
        }
      },
      "23": {
        start: {
          line: 54,
          column: 8
        },
        end: {
          line: 54,
          column: 66
        }
      },
      "24": {
        start: {
          line: 60,
          column: 35
        },
        end: {
          line: 60,
          column: 139
        }
      },
      "25": {
        start: {
          line: 61,
          column: 4
        },
        end: {
          line: 63,
          column: 5
        }
      },
      "26": {
        start: {
          line: 62,
          column: 8
        },
        end: {
          line: 62,
          column: 56
        }
      },
      "27": {
        start: {
          line: 64,
          column: 4
        },
        end: {
          line: 64,
          column: 17
        }
      },
      "28": {
        start: {
          line: 69,
          column: 23
        },
        end: {
          line: 86,
          column: 1
        }
      },
      "29": {
        start: {
          line: 70,
          column: 25
        },
        end: {
          line: 70,
          column: 32
        }
      },
      "30": {
        start: {
          line: 71,
          column: 39
        },
        end: {
          line: 71,
          column: 45
        }
      },
      "31": {
        start: {
          line: 73,
          column: 29
        },
        end: {
          line: 76,
          column: 6
        }
      },
      "32": {
        start: {
          line: 77,
          column: 4
        },
        end: {
          line: 79,
          column: 5
        }
      },
      "33": {
        start: {
          line: 78,
          column: 8
        },
        end: {
          line: 78,
          column: 103
        }
      },
      "34": {
        start: {
          line: 80,
          column: 18
        },
        end: {
          line: 80,
          column: 66
        }
      },
      "35": {
        start: {
          line: 81,
          column: 4
        },
        end: {
          line: 85,
          column: 7
        }
      },
      "36": {
        start: {
          line: 90,
          column: 23
        },
        end: {
          line: 124,
          column: 1
        }
      },
      "37": {
        start: {
          line: 91,
          column: 46
        },
        end: {
          line: 91,
          column: 53
        }
      },
      "38": {
        start: {
          line: 92,
          column: 39
        },
        end: {
          line: 92,
          column: 45
        }
      },
      "39": {
        start: {
          line: 94,
          column: 29
        },
        end: {
          line: 97,
          column: 6
        }
      },
      "40": {
        start: {
          line: 98,
          column: 4
        },
        end: {
          line: 100,
          column: 5
        }
      },
      "41": {
        start: {
          line: 99,
          column: 8
        },
        end: {
          line: 99,
          column: 103
        }
      },
      "42": {
        start: {
          line: 102,
          column: 26
        },
        end: {
          line: 102,
          column: 74
        }
      },
      "43": {
        start: {
          line: 104,
          column: 4
        },
        end: {
          line: 108,
          column: 5
        }
      },
      "44": {
        start: {
          line: 105,
          column: 8
        },
        end: {
          line: 107,
          column: 58
        }
      },
      "45": {
        start: {
          line: 110,
          column: 42
        },
        end: {
          line: 113,
          column: 70
        }
      },
      "46": {
        start: {
          line: 114,
          column: 4
        },
        end: {
          line: 116,
          column: 5
        }
      },
      "47": {
        start: {
          line: 115,
          column: 8
        },
        end: {
          line: 115,
          column: 101
        }
      },
      "48": {
        start: {
          line: 118,
          column: 4
        },
        end: {
          line: 118,
          column: 115
        }
      },
      "49": {
        start: {
          line: 119,
          column: 4
        },
        end: {
          line: 123,
          column: 7
        }
      },
      "50": {
        start: {
          line: 128,
          column: 26
        },
        end: {
          line: 167,
          column: 1
        }
      },
      "51": {
        start: {
          line: 129,
          column: 31
        },
        end: {
          line: 129,
          column: 38
        }
      },
      "52": {
        start: {
          line: 130,
          column: 39
        },
        end: {
          line: 130,
          column: 45
        }
      },
      "53": {
        start: {
          line: 132,
          column: 29
        },
        end: {
          line: 135,
          column: 6
        }
      },
      "54": {
        start: {
          line: 136,
          column: 4
        },
        end: {
          line: 138,
          column: 5
        }
      },
      "55": {
        start: {
          line: 137,
          column: 8
        },
        end: {
          line: 137,
          column: 103
        }
      },
      "56": {
        start: {
          line: 140,
          column: 26
        },
        end: {
          line: 140,
          column: 74
        }
      },
      "57": {
        start: {
          line: 142,
          column: 31
        },
        end: {
          line: 142,
          column: 123
        }
      },
      "58": {
        start: {
          line: 143,
          column: 4
        },
        end: {
          line: 145,
          column: 5
        }
      },
      "59": {
        start: {
          line: 144,
          column: 8
        },
        end: {
          line: 144,
          column: 118
        }
      },
      "60": {
        start: {
          line: 147,
          column: 4
        },
        end: {
          line: 151,
          column: 5
        }
      },
      "61": {
        start: {
          line: 148,
          column: 8
        },
        end: {
          line: 150,
          column: 11
        }
      },
      "62": {
        start: {
          line: 149,
          column: 12
        },
        end: {
          line: 149,
          column: 73
        }
      },
      "63": {
        start: {
          line: 153,
          column: 4
        },
        end: {
          line: 160,
          column: 5
        }
      },
      "64": {
        start: {
          line: 154,
          column: 38
        },
        end: {
          line: 154,
          column: 125
        }
      },
      "65": {
        start: {
          line: 155,
          column: 8
        },
        end: {
          line: 159,
          column: 9
        }
      },
      "66": {
        start: {
          line: 156,
          column: 12
        },
        end: {
          line: 158,
          column: 43
        }
      },
      "67": {
        start: {
          line: 162,
          column: 4
        },
        end: {
          line: 162,
          column: 107
        }
      },
      "68": {
        start: {
          line: 163,
          column: 4
        },
        end: {
          line: 166,
          column: 7
        }
      },
      "69": {
        start: {
          line: 168,
          column: 12
        },
        end: {
          line: 170,
          column: 15
        }
      },
      "70": {
        start: {
          line: 171,
          column: 12
        },
        end: {
          line: 173,
          column: 69
        }
      },
      "71": {
        start: {
          line: 174,
          column: 15
        },
        end: {
          line: 176,
          column: 18
        }
      }
    },
    fnMap: {
      "0": {
        name: "_export",
        decl: {
          start: {
            line: 6,
            column: 9
          },
          end: {
            line: 6,
            column: 16
          }
        },
        loc: {
          start: {
            line: 6,
            column: 30
          },
          end: {
            line: 11,
            column: 1
          }
        },
        line: 6
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 13,
            column: 4
          },
          end: {
            line: 13,
            column: 5
          }
        },
        loc: {
          start: {
            line: 13,
            column: 18
          },
          end: {
            line: 15,
            column: 5
          }
        },
        line: 13
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 16,
            column: 4
          },
          end: {
            line: 16,
            column: 5
          }
        },
        loc: {
          start: {
            line: 16,
            column: 15
          },
          end: {
            line: 18,
            column: 5
          }
        },
        line: 16
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 19,
            column: 4
          },
          end: {
            line: 19,
            column: 5
          }
        },
        loc: {
          start: {
            line: 19,
            column: 15
          },
          end: {
            line: 21,
            column: 5
          }
        },
        line: 19
      },
      "4": {
        name: "getStorageClient",
        decl: {
          start: {
            line: 42,
            column: 9
          },
          end: {
            line: 42,
            column: 25
          }
        },
        loc: {
          start: {
            line: 42,
            column: 28
          },
          end: {
            line: 46,
            column: 1
          }
        },
        line: 42
      },
      "5": {
        name: "deleteImageFromStorage",
        decl: {
          start: {
            line: 48,
            column: 15
          },
          end: {
            line: 48,
            column: 37
          }
        },
        loc: {
          start: {
            line: 48,
            column: 44
          },
          end: {
            line: 57,
            column: 1
          }
        },
        line: 48
      },
      "6": {
        name: "getImageById",
        decl: {
          start: {
            line: 59,
            column: 15
          },
          end: {
            line: 59,
            column: 27
          }
        },
        loc: {
          start: {
            line: 59,
            column: 58
          },
          end: {
            line: 65,
            column: 1
          }
        },
        line: 59
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 69,
            column: 23
          },
          end: {
            line: 69,
            column: 24
          }
        },
        loc: {
          start: {
            line: 69,
            column: 52
          },
          end: {
            line: 86,
            column: 1
          }
        },
        line: 69
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 90,
            column: 23
          },
          end: {
            line: 90,
            column: 24
          }
        },
        loc: {
          start: {
            line: 90,
            column: 52
          },
          end: {
            line: 124,
            column: 1
          }
        },
        line: 90
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 128,
            column: 26
          },
          end: {
            line: 128,
            column: 27
          }
        },
        loc: {
          start: {
            line: 128,
            column: 55
          },
          end: {
            line: 167,
            column: 1
          }
        },
        line: 128
      },
      "10": {
        name: "(anonymous_10)",
        decl: {
          start: {
            line: 148,
            column: 65
          },
          end: {
            line: 148,
            column: 66
          }
        },
        loc: {
          start: {
            line: 148,
            column: 74
          },
          end: {
            line: 150,
            column: 9
          }
        },
        line: 148
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 53,
            column: 4
          },
          end: {
            line: 56,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 53,
            column: 4
          },
          end: {
            line: 56,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 53
      },
      "1": {
        loc: {
          start: {
            line: 61,
            column: 4
          },
          end: {
            line: 63,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 61,
            column: 4
          },
          end: {
            line: 63,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 61
      },
      "2": {
        loc: {
          start: {
            line: 61,
            column: 8
          },
          end: {
            line: 61,
            column: 23
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 61,
            column: 8
          },
          end: {
            line: 61,
            column: 13
          }
        }, {
          start: {
            line: 61,
            column: 17
          },
          end: {
            line: 61,
            column: 23
          }
        }],
        line: 61
      },
      "3": {
        loc: {
          start: {
            line: 77,
            column: 4
          },
          end: {
            line: 79,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 77,
            column: 4
          },
          end: {
            line: 79,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 77
      },
      "4": {
        loc: {
          start: {
            line: 98,
            column: 4
          },
          end: {
            line: 100,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 98,
            column: 4
          },
          end: {
            line: 100,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 98
      },
      "5": {
        loc: {
          start: {
            line: 104,
            column: 4
          },
          end: {
            line: 108,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 104,
            column: 4
          },
          end: {
            line: 108,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 104
      },
      "6": {
        loc: {
          start: {
            line: 114,
            column: 4
          },
          end: {
            line: 116,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 114,
            column: 4
          },
          end: {
            line: 116,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 114
      },
      "7": {
        loc: {
          start: {
            line: 136,
            column: 4
          },
          end: {
            line: 138,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 136,
            column: 4
          },
          end: {
            line: 138,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 136
      },
      "8": {
        loc: {
          start: {
            line: 143,
            column: 4
          },
          end: {
            line: 145,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 143,
            column: 4
          },
          end: {
            line: 145,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 143
      },
      "9": {
        loc: {
          start: {
            line: 147,
            column: 4
          },
          end: {
            line: 151,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 147,
            column: 4
          },
          end: {
            line: 151,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 147
      },
      "10": {
        loc: {
          start: {
            line: 153,
            column: 4
          },
          end: {
            line: 160,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 153,
            column: 4
          },
          end: {
            line: 160,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 153
      },
      "11": {
        loc: {
          start: {
            line: 155,
            column: 8
          },
          end: {
            line: 159,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 155,
            column: 8
          },
          end: {
            line: 159,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 155
      },
      "12": {
        loc: {
          start: {
            line: 155,
            column: 12
          },
          end: {
            line: 155,
            column: 49
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 155,
            column: 12
          },
          end: {
            line: 155,
            column: 23
          }
        }, {
          start: {
            line: 155,
            column: 27
          },
          end: {
            line: 155,
            column: 49
          }
        }],
        line: 155
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0,
      "65": 0,
      "66": 0,
      "67": 0,
      "68": 0,
      "69": 0,
      "70": 0,
      "71": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\admin\\products\\[id]\\images\\[imageId]\\route.ts"],
      sourcesContent: ["// \uD83D\uDDBC\uFE0F Enterprise Individual Product Image API\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { z } from 'zod';\r\nimport { composeMiddlewares } from '@/lib/api/middleware-composer';\r\nimport { withErrorHandler, ApiError, ValidationError, NotFoundError } from '@/lib/api/error-handler';\r\nimport { withApiLogging, logAdminAction } from '@/lib/api/api-logger';\r\nimport { withAdminAuth } from '@/lib/auth/api-auth-middleware';\r\nimport { withValidation } from '@/lib/validation/admin-schemas';\r\nimport { createClient } from '@supabase/supabase-js';\r\nimport { Database } from '@/types/database';\r\n\r\n// Validation schemas\r\nconst ImageUpdateSchema = z.object({\r\n  alt_text: z.string().optional(),\r\n  is_primary: z.boolean().optional(),\r\n  display_order: z.number().int().min(0).optional()\r\n});\r\n\r\nconst ImageParamsSchema = z.object({\r\n  id: z.string().uuid('ID de producto inv\xE1lido'),\r\n  imageId: z.string().uuid('ID de imagen inv\xE1lido')\r\n});\r\n\r\n// Helper function to get Supabase Storage client\r\nfunction getStorageClient() {\r\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\r\n  const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\r\n  \r\n  return createClient(supabaseUrl, supabaseServiceKey);\r\n}\r\n\r\n// Helper function to delete image from storage\r\nasync function deleteImageFromStorage(path: string) {\r\n  const supabase = getStorageClient();\r\n  \r\n  const { error } = await supabase.storage\r\n    .from('product-images')\r\n    .remove([path]);\r\n\r\n  if (error) {\r\n    console.warn('Error deleting image from storage:', error);\r\n    // Don't throw error, just log warning\r\n  }\r\n}\r\n\r\n// Helper function to get image by ID\r\nasync function getImageById(supabase: ReturnType<typeof createClient<Database>>, productId: string, imageId: string) {\r\n  const { data: image, error } = await supabase\r\n    .from('product_images')\r\n    .select('*')\r\n    .eq('id', imageId)\r\n    .eq('product_id', productId)\r\n    .single();\r\n\r\n  if (error || !image) {\r\n    throw new NotFoundError('Imagen');\r\n  }\r\n\r\n  return image;\r\n}\r\n\r\n/**\r\n * GET /api/admin/products/[id]/images/[imageId]\r\n * Get specific image\r\n */\r\nconst getHandler = async (request: NextRequest, { params }: { params: { id: string, imageId: string } }) => {\r\n  const { supabase } = request as any;\r\n  const { id: productId, imageId } = params;\r\n\r\n  // Validate params\r\n  const paramsValidation = ImageParamsSchema.safeParse({ id: productId, imageId });\r\n  if (!paramsValidation.success) {\r\n    throw new ValidationError('Par\xE1metros inv\xE1lidos', paramsValidation.error.errors);\r\n  }\r\n\r\n  const image = await getImageById(supabase, productId, imageId);\r\n\r\n  return NextResponse.json({\r\n    data: image,\r\n    success: true,\r\n    message: 'Imagen obtenida exitosamente'\r\n  });\r\n};\r\n\r\n/**\r\n * PUT /api/admin/products/[id]/images/[imageId]\r\n * Update image metadata\r\n */\r\nconst putHandler = async (request: NextRequest, { params }: { params: { id: string, imageId: string } }) => {\r\n  const { supabase, user, validatedData } = request as any;\r\n  const { id: productId, imageId } = params;\r\n\r\n  // Validate params\r\n  const paramsValidation = ImageParamsSchema.safeParse({ id: productId, imageId });\r\n  if (!paramsValidation.success) {\r\n    throw new ValidationError('Par\xE1metros inv\xE1lidos', paramsValidation.error.errors);\r\n  }\r\n\r\n  // Check if image exists\r\n  const existingImage = await getImageById(supabase, productId, imageId);\r\n\r\n  // If setting as primary, update other images first\r\n  if (validatedData.is_primary === true) {\r\n    await supabase\r\n      .from('product_images')\r\n      .update({ is_primary: false })\r\n      .eq('product_id', productId)\r\n      .neq('id', imageId);\r\n  }\r\n\r\n  // Update image\r\n  const { data: updatedImage, error } = await supabase\r\n    .from('product_images')\r\n    .update({\r\n      ...validatedData,\r\n      updated_at: new Date().toISOString()\r\n    })\r\n    .eq('id', imageId)\r\n    .eq('product_id', productId)\r\n    .select()\r\n    .single();\r\n\r\n  if (error) {\r\n    throw new ApiError('Error al actualizar imagen', 500, 'DATABASE_ERROR', error);\r\n  }\r\n\r\n  // Log action\r\n  await logAdminAction(user.id, 'UPDATE', 'product_image', imageId, existingImage, updatedImage);\r\n\r\n  return NextResponse.json({\r\n    data: updatedImage,\r\n    success: true,\r\n    message: 'Imagen actualizada exitosamente'\r\n  });\r\n};\r\n\r\n/**\r\n * DELETE /api/admin/products/[id]/images/[imageId]\r\n * Delete image\r\n */\r\nconst deleteHandler = async (request: NextRequest, { params }: { params: { id: string, imageId: string } }) => {\r\n  const { supabase, user } = request as any;\r\n  const { id: productId, imageId } = params;\r\n\r\n  // Validate params\r\n  const paramsValidation = ImageParamsSchema.safeParse({ id: productId, imageId });\r\n  if (!paramsValidation.success) {\r\n    throw new ValidationError('Par\xE1metros inv\xE1lidos', paramsValidation.error.errors);\r\n  }\r\n\r\n  // Check if image exists\r\n  const existingImage = await getImageById(supabase, productId, imageId);\r\n\r\n  // Delete from database first\r\n  const { error: dbError } = await supabase\r\n    .from('product_images')\r\n    .delete()\r\n    .eq('id', imageId)\r\n    .eq('product_id', productId);\r\n\r\n  if (dbError) {\r\n    throw new ApiError('Error al eliminar imagen de base de datos', 500, 'DATABASE_ERROR', dbError);\r\n  }\r\n\r\n  // Delete from storage (non-blocking)\r\n  if (existingImage.storage_path) {\r\n    deleteImageFromStorage(existingImage.storage_path).catch(error => {\r\n      console.error('Failed to delete image from storage:', error);\r\n    });\r\n  }\r\n\r\n  // If this was the primary image, set another image as primary\r\n  if (existingImage.is_primary) {\r\n    const { data: otherImages } = await supabase\r\n      .from('product_images')\r\n      .select('id')\r\n      .eq('product_id', productId)\r\n      .limit(1);\r\n\r\n    if (otherImages && otherImages.length > 0) {\r\n      await supabase\r\n        .from('product_images')\r\n        .update({ is_primary: true })\r\n        .eq('id', otherImages[0].id);\r\n    }\r\n  }\r\n\r\n  // Log action\r\n  await logAdminAction(user.id, 'DELETE', 'product_image', imageId, existingImage, null);\r\n\r\n  return NextResponse.json({\r\n    success: true,\r\n    message: 'Imagen eliminada exitosamente'\r\n  });\r\n};\r\n\r\n// Apply enterprise middlewares and export handlers\r\nexport const GET = composeMiddlewares(\r\n  withErrorHandler,\r\n  withApiLogging,\r\n  withAdminAuth(['products_read'])\r\n)(getHandler);\r\n\r\nexport const PUT = composeMiddlewares(\r\n  withErrorHandler,\r\n  withApiLogging,\r\n  withAdminAuth(['products_update']),\r\n  withValidation(ImageUpdateSchema)\r\n)(putHandler);\r\n\r\nexport const DELETE = composeMiddlewares(\r\n  withErrorHandler,\r\n  withApiLogging,\r\n  withAdminAuth(['products_delete'])\r\n)(deleteHandler);\r\n"],
      names: ["DELETE", "GET", "PUT", "ImageUpdateSchema", "z", "object", "alt_text", "string", "optional", "is_primary", "boolean", "display_order", "number", "int", "min", "ImageParamsSchema", "id", "uuid", "imageId", "getStorageClient", "supabaseUrl", "process", "env", "NEXT_PUBLIC_SUPABASE_URL", "supabaseServiceKey", "SUPABASE_SERVICE_ROLE_KEY", "createClient", "deleteImageFromStorage", "path", "supabase", "error", "storage", "from", "remove", "console", "warn", "getImageById", "productId", "data", "image", "select", "eq", "single", "NotFoundError", "getHandler", "request", "params", "paramsValidation", "safeParse", "success", "ValidationError", "errors", "NextResponse", "json", "message", "putHandler", "user", "validatedData", "existingImage", "update", "neq", "updatedImage", "updated_at", "Date", "toISOString", "ApiError", "logAdminAction", "deleteHandler", "dbError", "delete", "storage_path", "catch", "otherImages", "limit", "length", "composeMiddlewares", "withErrorHandler", "withApiLogging", "withAdminAuth", "withValidation"],
      mappings: "AAAA,8CAA8C;;;;;;;;;;;;QAmNjCA;eAAAA;;QAbAC;eAAAA;;QAMAC;eAAAA;;;wBA1M6B;qBACxB;oCACiB;8BACwC;2BAC5B;mCACjB;8BACC;4BACF;AAG7B,qBAAqB;AACrB,MAAMC,oBAAoBC,MAAC,CAACC,MAAM,CAAC;IACjCC,UAAUF,MAAC,CAACG,MAAM,GAAGC,QAAQ;IAC7BC,YAAYL,MAAC,CAACM,OAAO,GAAGF,QAAQ;IAChCG,eAAeP,MAAC,CAACQ,MAAM,GAAGC,GAAG,GAAGC,GAAG,CAAC,GAAGN,QAAQ;AACjD;AAEA,MAAMO,oBAAoBX,MAAC,CAACC,MAAM,CAAC;IACjCW,IAAIZ,MAAC,CAACG,MAAM,GAAGU,IAAI,CAAC;IACpBC,SAASd,MAAC,CAACG,MAAM,GAAGU,IAAI,CAAC;AAC3B;AAEA,iDAAiD;AACjD,SAASE;IACP,MAAMC,cAAcC,QAAQC,GAAG,CAACC,wBAAwB;IACxD,MAAMC,qBAAqBH,QAAQC,GAAG,CAACG,yBAAyB;IAEhE,OAAOC,IAAAA,wBAAY,EAACN,aAAaI;AACnC;AAEA,+CAA+C;AAC/C,eAAeG,uBAAuBC,IAAY;IAChD,MAAMC,WAAWV;IAEjB,MAAM,EAAEW,KAAK,EAAE,GAAG,MAAMD,SAASE,OAAO,CACrCC,IAAI,CAAC,kBACLC,MAAM,CAAC;QAACL;KAAK;IAEhB,IAAIE,OAAO;QACTI,QAAQC,IAAI,CAAC,sCAAsCL;IACnD,sCAAsC;IACxC;AACF;AAEA,qCAAqC;AACrC,eAAeM,aAAaP,QAAmD,EAAEQ,SAAiB,EAAEnB,OAAe;IACjH,MAAM,EAAEoB,MAAMC,KAAK,EAAET,KAAK,EAAE,GAAG,MAAMD,SAClCG,IAAI,CAAC,kBACLQ,MAAM,CAAC,KACPC,EAAE,CAAC,MAAMvB,SACTuB,EAAE,CAAC,cAAcJ,WACjBK,MAAM;IAET,IAAIZ,SAAS,CAACS,OAAO;QACnB,MAAM,IAAII,2BAAa,CAAC;IAC1B;IAEA,OAAOJ;AACT;AAEA;;;CAGC,GACD,MAAMK,aAAa,OAAOC,SAAsB,EAAEC,MAAM,EAA+C;IACrG,MAAM,EAAEjB,QAAQ,EAAE,GAAGgB;IACrB,MAAM,EAAE7B,IAAIqB,SAAS,EAAEnB,OAAO,EAAE,GAAG4B;IAEnC,kBAAkB;IAClB,MAAMC,mBAAmBhC,kBAAkBiC,SAAS,CAAC;QAAEhC,IAAIqB;QAAWnB;IAAQ;IAC9E,IAAI,CAAC6B,iBAAiBE,OAAO,EAAE;QAC7B,MAAM,IAAIC,6BAAe,CAAC,wBAAwBH,iBAAiBjB,KAAK,CAACqB,MAAM;IACjF;IAEA,MAAMZ,QAAQ,MAAMH,aAAaP,UAAUQ,WAAWnB;IAEtD,OAAOkC,oBAAY,CAACC,IAAI,CAAC;QACvBf,MAAMC;QACNU,SAAS;QACTK,SAAS;IACX;AACF;AAEA;;;CAGC,GACD,MAAMC,aAAa,OAAOV,SAAsB,EAAEC,MAAM,EAA+C;IACrG,MAAM,EAAEjB,QAAQ,EAAE2B,IAAI,EAAEC,aAAa,EAAE,GAAGZ;IAC1C,MAAM,EAAE7B,IAAIqB,SAAS,EAAEnB,OAAO,EAAE,GAAG4B;IAEnC,kBAAkB;IAClB,MAAMC,mBAAmBhC,kBAAkBiC,SAAS,CAAC;QAAEhC,IAAIqB;QAAWnB;IAAQ;IAC9E,IAAI,CAAC6B,iBAAiBE,OAAO,EAAE;QAC7B,MAAM,IAAIC,6BAAe,CAAC,wBAAwBH,iBAAiBjB,KAAK,CAACqB,MAAM;IACjF;IAEA,wBAAwB;IACxB,MAAMO,gBAAgB,MAAMtB,aAAaP,UAAUQ,WAAWnB;IAE9D,mDAAmD;IACnD,IAAIuC,cAAchD,UAAU,KAAK,MAAM;QACrC,MAAMoB,SACHG,IAAI,CAAC,kBACL2B,MAAM,CAAC;YAAElD,YAAY;QAAM,GAC3BgC,EAAE,CAAC,cAAcJ,WACjBuB,GAAG,CAAC,MAAM1C;IACf;IAEA,eAAe;IACf,MAAM,EAAEoB,MAAMuB,YAAY,EAAE/B,KAAK,EAAE,GAAG,MAAMD,SACzCG,IAAI,CAAC,kBACL2B,MAAM,CAAC;QACN,GAAGF,aAAa;QAChBK,YAAY,IAAIC,OAAOC,WAAW;IACpC,GACCvB,EAAE,CAAC,MAAMvB,SACTuB,EAAE,CAAC,cAAcJ,WACjBG,MAAM,GACNE,MAAM;IAET,IAAIZ,OAAO;QACT,MAAM,IAAImC,sBAAQ,CAAC,8BAA8B,KAAK,kBAAkBnC;IAC1E;IAEA,aAAa;IACb,MAAMoC,IAAAA,yBAAc,EAACV,KAAKxC,EAAE,EAAE,UAAU,iBAAiBE,SAASwC,eAAeG;IAEjF,OAAOT,oBAAY,CAACC,IAAI,CAAC;QACvBf,MAAMuB;QACNZ,SAAS;QACTK,SAAS;IACX;AACF;AAEA;;;CAGC,GACD,MAAMa,gBAAgB,OAAOtB,SAAsB,EAAEC,MAAM,EAA+C;IACxG,MAAM,EAAEjB,QAAQ,EAAE2B,IAAI,EAAE,GAAGX;IAC3B,MAAM,EAAE7B,IAAIqB,SAAS,EAAEnB,OAAO,EAAE,GAAG4B;IAEnC,kBAAkB;IAClB,MAAMC,mBAAmBhC,kBAAkBiC,SAAS,CAAC;QAAEhC,IAAIqB;QAAWnB;IAAQ;IAC9E,IAAI,CAAC6B,iBAAiBE,OAAO,EAAE;QAC7B,MAAM,IAAIC,6BAAe,CAAC,wBAAwBH,iBAAiBjB,KAAK,CAACqB,MAAM;IACjF;IAEA,wBAAwB;IACxB,MAAMO,gBAAgB,MAAMtB,aAAaP,UAAUQ,WAAWnB;IAE9D,6BAA6B;IAC7B,MAAM,EAAEY,OAAOsC,OAAO,EAAE,GAAG,MAAMvC,SAC9BG,IAAI,CAAC,kBACLqC,MAAM,GACN5B,EAAE,CAAC,MAAMvB,SACTuB,EAAE,CAAC,cAAcJ;IAEpB,IAAI+B,SAAS;QACX,MAAM,IAAIH,sBAAQ,CAAC,6CAA6C,KAAK,kBAAkBG;IACzF;IAEA,qCAAqC;IACrC,IAAIV,cAAcY,YAAY,EAAE;QAC9B3C,uBAAuB+B,cAAcY,YAAY,EAAEC,KAAK,CAACzC,CAAAA;YACvDI,QAAQJ,KAAK,CAAC,wCAAwCA;QACxD;IACF;IAEA,8DAA8D;IAC9D,IAAI4B,cAAcjD,UAAU,EAAE;QAC5B,MAAM,EAAE6B,MAAMkC,WAAW,EAAE,GAAG,MAAM3C,SACjCG,IAAI,CAAC,kBACLQ,MAAM,CAAC,MACPC,EAAE,CAAC,cAAcJ,WACjBoC,KAAK,CAAC;QAET,IAAID,eAAeA,YAAYE,MAAM,GAAG,GAAG;YACzC,MAAM7C,SACHG,IAAI,CAAC,kBACL2B,MAAM,CAAC;gBAAElD,YAAY;YAAK,GAC1BgC,EAAE,CAAC,MAAM+B,WAAW,CAAC,EAAE,CAACxD,EAAE;QAC/B;IACF;IAEA,aAAa;IACb,MAAMkD,IAAAA,yBAAc,EAACV,KAAKxC,EAAE,EAAE,UAAU,iBAAiBE,SAASwC,eAAe;IAEjF,OAAON,oBAAY,CAACC,IAAI,CAAC;QACvBJ,SAAS;QACTK,SAAS;IACX;AACF;AAGO,MAAMrD,MAAM0E,IAAAA,sCAAkB,EACnCC,8BAAgB,EAChBC,yBAAc,EACdC,IAAAA,gCAAa,EAAC;IAAC;CAAgB,GAC/BlC;AAEK,MAAM1C,MAAMyE,IAAAA,sCAAkB,EACnCC,8BAAgB,EAChBC,yBAAc,EACdC,IAAAA,gCAAa,EAAC;IAAC;CAAkB,GACjCC,IAAAA,4BAAc,EAAC5E,oBACfoD;AAEK,MAAMvD,SAAS2E,IAAAA,sCAAkB,EACtCC,8BAAgB,EAChBC,yBAAc,EACdC,IAAAA,gCAAa,EAAC;IAAC;CAAkB,GACjCX"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "30a23b06514f8c398e499468df2d0b8c052fcf11"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1wk6l9glgj = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_1wk6l9glgj();
cov_1wk6l9glgj().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function _export(target, all) {
  /* istanbul ignore next */
  cov_1wk6l9glgj().f[0]++;
  cov_1wk6l9glgj().s[1]++;
  for (var name in all) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().s[2]++;
    Object.defineProperty(target, name, {
      enumerable: true,
      get: Object.getOwnPropertyDescriptor(all, name).get
    });
  }
}
/* istanbul ignore next */
cov_1wk6l9glgj().s[3]++;
_export(exports, {
  get DELETE() {
    /* istanbul ignore next */
    cov_1wk6l9glgj().f[1]++;
    cov_1wk6l9glgj().s[4]++;
    return DELETE;
  },
  get GET() {
    /* istanbul ignore next */
    cov_1wk6l9glgj().f[2]++;
    cov_1wk6l9glgj().s[5]++;
    return GET;
  },
  get PUT() {
    /* istanbul ignore next */
    cov_1wk6l9glgj().f[3]++;
    cov_1wk6l9glgj().s[6]++;
    return PUT;
  }
});
const _server =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[7]++, require("next/server"));
const _zod =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[8]++, require("zod"));
const _middlewarecomposer =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[9]++, require("../../../../../../../lib/api/middleware-composer"));
const _errorhandler =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[10]++, require("../../../../../../../lib/api/error-handler"));
const _apilogger =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[11]++, require("../../../../../../../lib/api/api-logger"));
const _apiauthmiddleware =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[12]++, require("../../../../../../../lib/auth/api-auth-middleware"));
const _adminschemas =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[13]++, require("../../../../../../../lib/validation/admin-schemas"));
const _supabasejs =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[14]++, require("@supabase/supabase-js"));
// Validation schemas
const ImageUpdateSchema =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[15]++, _zod.z.object({
  alt_text: _zod.z.string().optional(),
  is_primary: _zod.z.boolean().optional(),
  display_order: _zod.z.number().int().min(0).optional()
}));
const ImageParamsSchema =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[16]++, _zod.z.object({
  id: _zod.z.string().uuid('ID de producto inválido'),
  imageId: _zod.z.string().uuid('ID de imagen inválido')
}));
// Helper function to get Supabase Storage client
function getStorageClient() {
  /* istanbul ignore next */
  cov_1wk6l9glgj().f[4]++;
  const supabaseUrl =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[17]++, process.env.NEXT_PUBLIC_SUPABASE_URL);
  const supabaseServiceKey =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[18]++, process.env.SUPABASE_SERVICE_ROLE_KEY);
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[19]++;
  return (0, _supabasejs.createClient)(supabaseUrl, supabaseServiceKey);
}
// Helper function to delete image from storage
async function deleteImageFromStorage(path) {
  /* istanbul ignore next */
  cov_1wk6l9glgj().f[5]++;
  const supabase =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[20]++, getStorageClient());
  const {
    error
  } =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[21]++, await supabase.storage.from('product-images').remove([path]));
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[22]++;
  if (error) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().b[0][0]++;
    cov_1wk6l9glgj().s[23]++;
    console.warn('Error deleting image from storage:', error);
    // Don't throw error, just log warning
  } else
  /* istanbul ignore next */
  {
    cov_1wk6l9glgj().b[0][1]++;
  }
}
// Helper function to get image by ID
async function getImageById(supabase, productId, imageId) {
  /* istanbul ignore next */
  cov_1wk6l9glgj().f[6]++;
  const {
    data: image,
    error
  } =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[24]++, await supabase.from('product_images').select('*').eq('id', imageId).eq('product_id', productId).single());
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[25]++;
  if (
  /* istanbul ignore next */
  (cov_1wk6l9glgj().b[2][0]++, error) ||
  /* istanbul ignore next */
  (cov_1wk6l9glgj().b[2][1]++, !image)) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().b[1][0]++;
    cov_1wk6l9glgj().s[26]++;
    throw new _errorhandler.NotFoundError('Imagen');
  } else
  /* istanbul ignore next */
  {
    cov_1wk6l9glgj().b[1][1]++;
  }
  cov_1wk6l9glgj().s[27]++;
  return image;
}
/**
 * GET /api/admin/products/[id]/images/[imageId]
 * Get specific image
 */
/* istanbul ignore next */
cov_1wk6l9glgj().s[28]++;
const getHandler = async (request, {
  params
}) => {
  /* istanbul ignore next */
  cov_1wk6l9glgj().f[7]++;
  const {
    supabase
  } =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[29]++, request);
  const {
    id: productId,
    imageId
  } =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[30]++, params);
  // Validate params
  const paramsValidation =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[31]++, ImageParamsSchema.safeParse({
    id: productId,
    imageId
  }));
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[32]++;
  if (!paramsValidation.success) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().b[3][0]++;
    cov_1wk6l9glgj().s[33]++;
    throw new _errorhandler.ValidationError('Parámetros inválidos', paramsValidation.error.errors);
  } else
  /* istanbul ignore next */
  {
    cov_1wk6l9glgj().b[3][1]++;
  }
  const image =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[34]++, await getImageById(supabase, productId, imageId));
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[35]++;
  return _server.NextResponse.json({
    data: image,
    success: true,
    message: 'Imagen obtenida exitosamente'
  });
};
/**
 * PUT /api/admin/products/[id]/images/[imageId]
 * Update image metadata
 */
/* istanbul ignore next */
cov_1wk6l9glgj().s[36]++;
const putHandler = async (request, {
  params
}) => {
  /* istanbul ignore next */
  cov_1wk6l9glgj().f[8]++;
  const {
    supabase,
    user,
    validatedData
  } =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[37]++, request);
  const {
    id: productId,
    imageId
  } =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[38]++, params);
  // Validate params
  const paramsValidation =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[39]++, ImageParamsSchema.safeParse({
    id: productId,
    imageId
  }));
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[40]++;
  if (!paramsValidation.success) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().b[4][0]++;
    cov_1wk6l9glgj().s[41]++;
    throw new _errorhandler.ValidationError('Parámetros inválidos', paramsValidation.error.errors);
  } else
  /* istanbul ignore next */
  {
    cov_1wk6l9glgj().b[4][1]++;
  }
  // Check if image exists
  const existingImage =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[42]++, await getImageById(supabase, productId, imageId));
  // If setting as primary, update other images first
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[43]++;
  if (validatedData.is_primary === true) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().b[5][0]++;
    cov_1wk6l9glgj().s[44]++;
    await supabase.from('product_images').update({
      is_primary: false
    }).eq('product_id', productId).neq('id', imageId);
  } else
  /* istanbul ignore next */
  {
    cov_1wk6l9glgj().b[5][1]++;
  }
  // Update image
  const {
    data: updatedImage,
    error
  } =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[45]++, await supabase.from('product_images').update({
    ...validatedData,
    updated_at: new Date().toISOString()
  }).eq('id', imageId).eq('product_id', productId).select().single());
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[46]++;
  if (error) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().b[6][0]++;
    cov_1wk6l9glgj().s[47]++;
    throw new _errorhandler.ApiError('Error al actualizar imagen', 500, 'DATABASE_ERROR', error);
  } else
  /* istanbul ignore next */
  {
    cov_1wk6l9glgj().b[6][1]++;
  }
  // Log action
  cov_1wk6l9glgj().s[48]++;
  await (0, _apilogger.logAdminAction)(user.id, 'UPDATE', 'product_image', imageId, existingImage, updatedImage);
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[49]++;
  return _server.NextResponse.json({
    data: updatedImage,
    success: true,
    message: 'Imagen actualizada exitosamente'
  });
};
/**
 * DELETE /api/admin/products/[id]/images/[imageId]
 * Delete image
 */
/* istanbul ignore next */
cov_1wk6l9glgj().s[50]++;
const deleteHandler = async (request, {
  params
}) => {
  /* istanbul ignore next */
  cov_1wk6l9glgj().f[9]++;
  const {
    supabase,
    user
  } =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[51]++, request);
  const {
    id: productId,
    imageId
  } =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[52]++, params);
  // Validate params
  const paramsValidation =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[53]++, ImageParamsSchema.safeParse({
    id: productId,
    imageId
  }));
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[54]++;
  if (!paramsValidation.success) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().b[7][0]++;
    cov_1wk6l9glgj().s[55]++;
    throw new _errorhandler.ValidationError('Parámetros inválidos', paramsValidation.error.errors);
  } else
  /* istanbul ignore next */
  {
    cov_1wk6l9glgj().b[7][1]++;
  }
  // Check if image exists
  const existingImage =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[56]++, await getImageById(supabase, productId, imageId));
  // Delete from database first
  const {
    error: dbError
  } =
  /* istanbul ignore next */
  (cov_1wk6l9glgj().s[57]++, await supabase.from('product_images').delete().eq('id', imageId).eq('product_id', productId));
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[58]++;
  if (dbError) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().b[8][0]++;
    cov_1wk6l9glgj().s[59]++;
    throw new _errorhandler.ApiError('Error al eliminar imagen de base de datos', 500, 'DATABASE_ERROR', dbError);
  } else
  /* istanbul ignore next */
  {
    cov_1wk6l9glgj().b[8][1]++;
  }
  // Delete from storage (non-blocking)
  cov_1wk6l9glgj().s[60]++;
  if (existingImage.storage_path) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().b[9][0]++;
    cov_1wk6l9glgj().s[61]++;
    deleteImageFromStorage(existingImage.storage_path).catch(error => {
      /* istanbul ignore next */
      cov_1wk6l9glgj().f[10]++;
      cov_1wk6l9glgj().s[62]++;
      console.error('Failed to delete image from storage:', error);
    });
  } else
  /* istanbul ignore next */
  {
    cov_1wk6l9glgj().b[9][1]++;
  }
  // If this was the primary image, set another image as primary
  cov_1wk6l9glgj().s[63]++;
  if (existingImage.is_primary) {
    /* istanbul ignore next */
    cov_1wk6l9glgj().b[10][0]++;
    const {
      data: otherImages
    } =
    /* istanbul ignore next */
    (cov_1wk6l9glgj().s[64]++, await supabase.from('product_images').select('id').eq('product_id', productId).limit(1));
    /* istanbul ignore next */
    cov_1wk6l9glgj().s[65]++;
    if (
    /* istanbul ignore next */
    (cov_1wk6l9glgj().b[12][0]++, otherImages) &&
    /* istanbul ignore next */
    (cov_1wk6l9glgj().b[12][1]++, otherImages.length > 0)) {
      /* istanbul ignore next */
      cov_1wk6l9glgj().b[11][0]++;
      cov_1wk6l9glgj().s[66]++;
      await supabase.from('product_images').update({
        is_primary: true
      }).eq('id', otherImages[0].id);
    } else
    /* istanbul ignore next */
    {
      cov_1wk6l9glgj().b[11][1]++;
    }
  } else
  /* istanbul ignore next */
  {
    cov_1wk6l9glgj().b[10][1]++;
  }
  // Log action
  cov_1wk6l9glgj().s[67]++;
  await (0, _apilogger.logAdminAction)(user.id, 'DELETE', 'product_image', imageId, existingImage, null);
  /* istanbul ignore next */
  cov_1wk6l9glgj().s[68]++;
  return _server.NextResponse.json({
    success: true,
    message: 'Imagen eliminada exitosamente'
  });
};
const GET =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[69]++, (0, _middlewarecomposer.composeMiddlewares)(_errorhandler.withErrorHandler, _apilogger.withApiLogging, (0, _apiauthmiddleware.withAdminAuth)(['products_read']))(getHandler));
const PUT =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[70]++, (0, _middlewarecomposer.composeMiddlewares)(_errorhandler.withErrorHandler, _apilogger.withApiLogging, (0, _apiauthmiddleware.withAdminAuth)(['products_update']), (0, _adminschemas.withValidation)(ImageUpdateSchema))(putHandler));
const DELETE =
/* istanbul ignore next */
(cov_1wk6l9glgj().s[71]++, (0, _middlewarecomposer.composeMiddlewares)(_errorhandler.withErrorHandler, _apilogger.withApiLogging, (0, _apiauthmiddleware.withAdminAuth)(['products_delete']))(deleteHandler));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMXdrNmw5Z2xnaiIsImFjdHVhbENvdmVyYWdlIiwicyIsIkRFTEVURSIsImYiLCJHRVQiLCJQVVQiLCJJbWFnZVVwZGF0ZVNjaGVtYSIsIl96b2QiLCJ6Iiwib2JqZWN0IiwiYWx0X3RleHQiLCJzdHJpbmciLCJvcHRpb25hbCIsImlzX3ByaW1hcnkiLCJib29sZWFuIiwiZGlzcGxheV9vcmRlciIsIm51bWJlciIsImludCIsIm1pbiIsIkltYWdlUGFyYW1zU2NoZW1hIiwiaWQiLCJ1dWlkIiwiaW1hZ2VJZCIsImdldFN0b3JhZ2VDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZVNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiX3N1cGFiYXNlanMiLCJjcmVhdGVDbGllbnQiLCJkZWxldGVJbWFnZUZyb21TdG9yYWdlIiwicGF0aCIsInN1cGFiYXNlIiwiZXJyb3IiLCJzdG9yYWdlIiwiZnJvbSIsInJlbW92ZSIsImIiLCJjb25zb2xlIiwid2FybiIsImdldEltYWdlQnlJZCIsInByb2R1Y3RJZCIsImRhdGEiLCJpbWFnZSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiX2Vycm9yaGFuZGxlciIsIk5vdEZvdW5kRXJyb3IiLCJnZXRIYW5kbGVyIiwicmVxdWVzdCIsInBhcmFtcyIsInBhcmFtc1ZhbGlkYXRpb24iLCJzYWZlUGFyc2UiLCJzdWNjZXNzIiwiVmFsaWRhdGlvbkVycm9yIiwiZXJyb3JzIiwiX3NlcnZlciIsIk5leHRSZXNwb25zZSIsImpzb24iLCJtZXNzYWdlIiwicHV0SGFuZGxlciIsInVzZXIiLCJ2YWxpZGF0ZWREYXRhIiwiZXhpc3RpbmdJbWFnZSIsInVwZGF0ZSIsIm5lcSIsInVwZGF0ZWRJbWFnZSIsInVwZGF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJBcGlFcnJvciIsIl9hcGlsb2dnZXIiLCJsb2dBZG1pbkFjdGlvbiIsImRlbGV0ZUhhbmRsZXIiLCJkYkVycm9yIiwiZGVsZXRlIiwic3RvcmFnZV9wYXRoIiwiY2F0Y2giLCJvdGhlckltYWdlcyIsImxpbWl0IiwibGVuZ3RoIiwiX21pZGRsZXdhcmVjb21wb3NlciIsImNvbXBvc2VNaWRkbGV3YXJlcyIsIndpdGhFcnJvckhhbmRsZXIiLCJ3aXRoQXBpTG9nZ2luZyIsIl9hcGlhdXRobWlkZGxld2FyZSIsIndpdGhBZG1pbkF1dGgiLCJfYWRtaW5zY2hlbWFzIiwid2l0aFZhbGlkYXRpb24iXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXG1hcnRpXFxEZXNrdG9wXFxERVNBUlJPTExPU1dcXEJPSUxFUlBMQVRURSBFLUNPTU1FUkNFXFxzcmNcXGFwcFxcYXBpXFxhZG1pblxccHJvZHVjdHNcXFtpZF1cXGltYWdlc1xcW2ltYWdlSWRdXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyDwn5a877iPIEVudGVycHJpc2UgSW5kaXZpZHVhbCBQcm9kdWN0IEltYWdlIEFQSVxyXG5cclxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcclxuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XHJcbmltcG9ydCB7IGNvbXBvc2VNaWRkbGV3YXJlcyB9IGZyb20gJ0AvbGliL2FwaS9taWRkbGV3YXJlLWNvbXBvc2VyJztcclxuaW1wb3J0IHsgd2l0aEVycm9ySGFuZGxlciwgQXBpRXJyb3IsIFZhbGlkYXRpb25FcnJvciwgTm90Rm91bmRFcnJvciB9IGZyb20gJ0AvbGliL2FwaS9lcnJvci1oYW5kbGVyJztcclxuaW1wb3J0IHsgd2l0aEFwaUxvZ2dpbmcsIGxvZ0FkbWluQWN0aW9uIH0gZnJvbSAnQC9saWIvYXBpL2FwaS1sb2dnZXInO1xyXG5pbXBvcnQgeyB3aXRoQWRtaW5BdXRoIH0gZnJvbSAnQC9saWIvYXV0aC9hcGktYXV0aC1taWRkbGV3YXJlJztcclxuaW1wb3J0IHsgd2l0aFZhbGlkYXRpb24gfSBmcm9tICdAL2xpYi92YWxpZGF0aW9uL2FkbWluLXNjaGVtYXMnO1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5pbXBvcnQgeyBEYXRhYmFzZSB9IGZyb20gJ0AvdHlwZXMvZGF0YWJhc2UnO1xyXG5cclxuLy8gVmFsaWRhdGlvbiBzY2hlbWFzXHJcbmNvbnN0IEltYWdlVXBkYXRlU2NoZW1hID0gei5vYmplY3Qoe1xyXG4gIGFsdF90ZXh0OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXHJcbiAgaXNfcHJpbWFyeTogei5ib29sZWFuKCkub3B0aW9uYWwoKSxcclxuICBkaXNwbGF5X29yZGVyOiB6Lm51bWJlcigpLmludCgpLm1pbigwKS5vcHRpb25hbCgpXHJcbn0pO1xyXG5cclxuY29uc3QgSW1hZ2VQYXJhbXNTY2hlbWEgPSB6Lm9iamVjdCh7XHJcbiAgaWQ6IHouc3RyaW5nKCkudXVpZCgnSUQgZGUgcHJvZHVjdG8gaW52w6FsaWRvJyksXHJcbiAgaW1hZ2VJZDogei5zdHJpbmcoKS51dWlkKCdJRCBkZSBpbWFnZW4gaW52w6FsaWRvJylcclxufSk7XHJcblxyXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IFN1cGFiYXNlIFN0b3JhZ2UgY2xpZW50XHJcbmZ1bmN0aW9uIGdldFN0b3JhZ2VDbGllbnQoKSB7XHJcbiAgY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhO1xyXG4gIGNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkhO1xyXG4gIFxyXG4gIHJldHVybiBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZUtleSk7XHJcbn1cclxuXHJcbi8vIEhlbHBlciBmdW5jdGlvbiB0byBkZWxldGUgaW1hZ2UgZnJvbSBzdG9yYWdlXHJcbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUltYWdlRnJvbVN0b3JhZ2UocGF0aDogc3RyaW5nKSB7XHJcbiAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdG9yYWdlQ2xpZW50KCk7XHJcbiAgXHJcbiAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Uuc3RvcmFnZVxyXG4gICAgLmZyb20oJ3Byb2R1Y3QtaW1hZ2VzJylcclxuICAgIC5yZW1vdmUoW3BhdGhdKTtcclxuXHJcbiAgaWYgKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLndhcm4oJ0Vycm9yIGRlbGV0aW5nIGltYWdlIGZyb20gc3RvcmFnZTonLCBlcnJvcik7XHJcbiAgICAvLyBEb24ndCB0aHJvdyBlcnJvciwganVzdCBsb2cgd2FybmluZ1xyXG4gIH1cclxufVxyXG5cclxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBpbWFnZSBieSBJRFxyXG5hc3luYyBmdW5jdGlvbiBnZXRJbWFnZUJ5SWQoc3VwYWJhc2U6IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZUNsaWVudDxEYXRhYmFzZT4+LCBwcm9kdWN0SWQ6IHN0cmluZywgaW1hZ2VJZDogc3RyaW5nKSB7XHJcbiAgY29uc3QgeyBkYXRhOiBpbWFnZSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbSgncHJvZHVjdF9pbWFnZXMnKVxyXG4gICAgLnNlbGVjdCgnKicpXHJcbiAgICAuZXEoJ2lkJywgaW1hZ2VJZClcclxuICAgIC5lcSgncHJvZHVjdF9pZCcsIHByb2R1Y3RJZClcclxuICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgaWYgKGVycm9yIHx8ICFpbWFnZSkge1xyXG4gICAgdGhyb3cgbmV3IE5vdEZvdW5kRXJyb3IoJ0ltYWdlbicpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGltYWdlO1xyXG59XHJcblxyXG4vKipcclxuICogR0VUIC9hcGkvYWRtaW4vcHJvZHVjdHMvW2lkXS9pbWFnZXMvW2ltYWdlSWRdXHJcbiAqIEdldCBzcGVjaWZpYyBpbWFnZVxyXG4gKi9cclxuY29uc3QgZ2V0SGFuZGxlciA9IGFzeW5jIChyZXF1ZXN0OiBOZXh0UmVxdWVzdCwgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgaWQ6IHN0cmluZywgaW1hZ2VJZDogc3RyaW5nIH0gfSkgPT4ge1xyXG4gIGNvbnN0IHsgc3VwYWJhc2UgfSA9IHJlcXVlc3QgYXMgYW55O1xyXG4gIGNvbnN0IHsgaWQ6IHByb2R1Y3RJZCwgaW1hZ2VJZCB9ID0gcGFyYW1zO1xyXG5cclxuICAvLyBWYWxpZGF0ZSBwYXJhbXNcclxuICBjb25zdCBwYXJhbXNWYWxpZGF0aW9uID0gSW1hZ2VQYXJhbXNTY2hlbWEuc2FmZVBhcnNlKHsgaWQ6IHByb2R1Y3RJZCwgaW1hZ2VJZCB9KTtcclxuICBpZiAoIXBhcmFtc1ZhbGlkYXRpb24uc3VjY2Vzcykge1xyXG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignUGFyw6FtZXRyb3MgaW52w6FsaWRvcycsIHBhcmFtc1ZhbGlkYXRpb24uZXJyb3IuZXJyb3JzKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGltYWdlID0gYXdhaXQgZ2V0SW1hZ2VCeUlkKHN1cGFiYXNlLCBwcm9kdWN0SWQsIGltYWdlSWQpO1xyXG5cclxuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgZGF0YTogaW1hZ2UsXHJcbiAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgbWVzc2FnZTogJ0ltYWdlbiBvYnRlbmlkYSBleGl0b3NhbWVudGUnXHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogUFVUIC9hcGkvYWRtaW4vcHJvZHVjdHMvW2lkXS9pbWFnZXMvW2ltYWdlSWRdXHJcbiAqIFVwZGF0ZSBpbWFnZSBtZXRhZGF0YVxyXG4gKi9cclxuY29uc3QgcHV0SGFuZGxlciA9IGFzeW5jIChyZXF1ZXN0OiBOZXh0UmVxdWVzdCwgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgaWQ6IHN0cmluZywgaW1hZ2VJZDogc3RyaW5nIH0gfSkgPT4ge1xyXG4gIGNvbnN0IHsgc3VwYWJhc2UsIHVzZXIsIHZhbGlkYXRlZERhdGEgfSA9IHJlcXVlc3QgYXMgYW55O1xyXG4gIGNvbnN0IHsgaWQ6IHByb2R1Y3RJZCwgaW1hZ2VJZCB9ID0gcGFyYW1zO1xyXG5cclxuICAvLyBWYWxpZGF0ZSBwYXJhbXNcclxuICBjb25zdCBwYXJhbXNWYWxpZGF0aW9uID0gSW1hZ2VQYXJhbXNTY2hlbWEuc2FmZVBhcnNlKHsgaWQ6IHByb2R1Y3RJZCwgaW1hZ2VJZCB9KTtcclxuICBpZiAoIXBhcmFtc1ZhbGlkYXRpb24uc3VjY2Vzcykge1xyXG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignUGFyw6FtZXRyb3MgaW52w6FsaWRvcycsIHBhcmFtc1ZhbGlkYXRpb24uZXJyb3IuZXJyb3JzKTtcclxuICB9XHJcblxyXG4gIC8vIENoZWNrIGlmIGltYWdlIGV4aXN0c1xyXG4gIGNvbnN0IGV4aXN0aW5nSW1hZ2UgPSBhd2FpdCBnZXRJbWFnZUJ5SWQoc3VwYWJhc2UsIHByb2R1Y3RJZCwgaW1hZ2VJZCk7XHJcblxyXG4gIC8vIElmIHNldHRpbmcgYXMgcHJpbWFyeSwgdXBkYXRlIG90aGVyIGltYWdlcyBmaXJzdFxyXG4gIGlmICh2YWxpZGF0ZWREYXRhLmlzX3ByaW1hcnkgPT09IHRydWUpIHtcclxuICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKCdwcm9kdWN0X2ltYWdlcycpXHJcbiAgICAgIC51cGRhdGUoeyBpc19wcmltYXJ5OiBmYWxzZSB9KVxyXG4gICAgICAuZXEoJ3Byb2R1Y3RfaWQnLCBwcm9kdWN0SWQpXHJcbiAgICAgIC5uZXEoJ2lkJywgaW1hZ2VJZCk7XHJcbiAgfVxyXG5cclxuICAvLyBVcGRhdGUgaW1hZ2VcclxuICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRJbWFnZSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbSgncHJvZHVjdF9pbWFnZXMnKVxyXG4gICAgLnVwZGF0ZSh7XHJcbiAgICAgIC4uLnZhbGlkYXRlZERhdGEsXHJcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfSlcclxuICAgIC5lcSgnaWQnLCBpbWFnZUlkKVxyXG4gICAgLmVxKCdwcm9kdWN0X2lkJywgcHJvZHVjdElkKVxyXG4gICAgLnNlbGVjdCgpXHJcbiAgICAuc2luZ2xlKCk7XHJcblxyXG4gIGlmIChlcnJvcikge1xyXG4gICAgdGhyb3cgbmV3IEFwaUVycm9yKCdFcnJvciBhbCBhY3R1YWxpemFyIGltYWdlbicsIDUwMCwgJ0RBVEFCQVNFX0VSUk9SJywgZXJyb3IpO1xyXG4gIH1cclxuXHJcbiAgLy8gTG9nIGFjdGlvblxyXG4gIGF3YWl0IGxvZ0FkbWluQWN0aW9uKHVzZXIuaWQsICdVUERBVEUnLCAncHJvZHVjdF9pbWFnZScsIGltYWdlSWQsIGV4aXN0aW5nSW1hZ2UsIHVwZGF0ZWRJbWFnZSk7XHJcblxyXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICBkYXRhOiB1cGRhdGVkSW1hZ2UsXHJcbiAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgbWVzc2FnZTogJ0ltYWdlbiBhY3R1YWxpemFkYSBleGl0b3NhbWVudGUnXHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogREVMRVRFIC9hcGkvYWRtaW4vcHJvZHVjdHMvW2lkXS9pbWFnZXMvW2ltYWdlSWRdXHJcbiAqIERlbGV0ZSBpbWFnZVxyXG4gKi9cclxuY29uc3QgZGVsZXRlSGFuZGxlciA9IGFzeW5jIChyZXF1ZXN0OiBOZXh0UmVxdWVzdCwgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgaWQ6IHN0cmluZywgaW1hZ2VJZDogc3RyaW5nIH0gfSkgPT4ge1xyXG4gIGNvbnN0IHsgc3VwYWJhc2UsIHVzZXIgfSA9IHJlcXVlc3QgYXMgYW55O1xyXG4gIGNvbnN0IHsgaWQ6IHByb2R1Y3RJZCwgaW1hZ2VJZCB9ID0gcGFyYW1zO1xyXG5cclxuICAvLyBWYWxpZGF0ZSBwYXJhbXNcclxuICBjb25zdCBwYXJhbXNWYWxpZGF0aW9uID0gSW1hZ2VQYXJhbXNTY2hlbWEuc2FmZVBhcnNlKHsgaWQ6IHByb2R1Y3RJZCwgaW1hZ2VJZCB9KTtcclxuICBpZiAoIXBhcmFtc1ZhbGlkYXRpb24uc3VjY2Vzcykge1xyXG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcignUGFyw6FtZXRyb3MgaW52w6FsaWRvcycsIHBhcmFtc1ZhbGlkYXRpb24uZXJyb3IuZXJyb3JzKTtcclxuICB9XHJcblxyXG4gIC8vIENoZWNrIGlmIGltYWdlIGV4aXN0c1xyXG4gIGNvbnN0IGV4aXN0aW5nSW1hZ2UgPSBhd2FpdCBnZXRJbWFnZUJ5SWQoc3VwYWJhc2UsIHByb2R1Y3RJZCwgaW1hZ2VJZCk7XHJcblxyXG4gIC8vIERlbGV0ZSBmcm9tIGRhdGFiYXNlIGZpcnN0XHJcbiAgY29uc3QgeyBlcnJvcjogZGJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKCdwcm9kdWN0X2ltYWdlcycpXHJcbiAgICAuZGVsZXRlKClcclxuICAgIC5lcSgnaWQnLCBpbWFnZUlkKVxyXG4gICAgLmVxKCdwcm9kdWN0X2lkJywgcHJvZHVjdElkKTtcclxuXHJcbiAgaWYgKGRiRXJyb3IpIHtcclxuICAgIHRocm93IG5ldyBBcGlFcnJvcignRXJyb3IgYWwgZWxpbWluYXIgaW1hZ2VuIGRlIGJhc2UgZGUgZGF0b3MnLCA1MDAsICdEQVRBQkFTRV9FUlJPUicsIGRiRXJyb3IpO1xyXG4gIH1cclxuXHJcbiAgLy8gRGVsZXRlIGZyb20gc3RvcmFnZSAobm9uLWJsb2NraW5nKVxyXG4gIGlmIChleGlzdGluZ0ltYWdlLnN0b3JhZ2VfcGF0aCkge1xyXG4gICAgZGVsZXRlSW1hZ2VGcm9tU3RvcmFnZShleGlzdGluZ0ltYWdlLnN0b3JhZ2VfcGF0aCkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZGVsZXRlIGltYWdlIGZyb20gc3RvcmFnZTonLCBlcnJvcik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIElmIHRoaXMgd2FzIHRoZSBwcmltYXJ5IGltYWdlLCBzZXQgYW5vdGhlciBpbWFnZSBhcyBwcmltYXJ5XHJcbiAgaWYgKGV4aXN0aW5nSW1hZ2UuaXNfcHJpbWFyeSkge1xyXG4gICAgY29uc3QgeyBkYXRhOiBvdGhlckltYWdlcyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oJ3Byb2R1Y3RfaW1hZ2VzJylcclxuICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAuZXEoJ3Byb2R1Y3RfaWQnLCBwcm9kdWN0SWQpXHJcbiAgICAgIC5saW1pdCgxKTtcclxuXHJcbiAgICBpZiAob3RoZXJJbWFnZXMgJiYgb3RoZXJJbWFnZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdwcm9kdWN0X2ltYWdlcycpXHJcbiAgICAgICAgLnVwZGF0ZSh7IGlzX3ByaW1hcnk6IHRydWUgfSlcclxuICAgICAgICAuZXEoJ2lkJywgb3RoZXJJbWFnZXNbMF0uaWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gTG9nIGFjdGlvblxyXG4gIGF3YWl0IGxvZ0FkbWluQWN0aW9uKHVzZXIuaWQsICdERUxFVEUnLCAncHJvZHVjdF9pbWFnZScsIGltYWdlSWQsIGV4aXN0aW5nSW1hZ2UsIG51bGwpO1xyXG5cclxuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgc3VjY2VzczogdHJ1ZSxcclxuICAgIG1lc3NhZ2U6ICdJbWFnZW4gZWxpbWluYWRhIGV4aXRvc2FtZW50ZSdcclxuICB9KTtcclxufTtcclxuXHJcbi8vIEFwcGx5IGVudGVycHJpc2UgbWlkZGxld2FyZXMgYW5kIGV4cG9ydCBoYW5kbGVyc1xyXG5leHBvcnQgY29uc3QgR0VUID0gY29tcG9zZU1pZGRsZXdhcmVzKFxyXG4gIHdpdGhFcnJvckhhbmRsZXIsXHJcbiAgd2l0aEFwaUxvZ2dpbmcsXHJcbiAgd2l0aEFkbWluQXV0aChbJ3Byb2R1Y3RzX3JlYWQnXSlcclxuKShnZXRIYW5kbGVyKTtcclxuXHJcbmV4cG9ydCBjb25zdCBQVVQgPSBjb21wb3NlTWlkZGxld2FyZXMoXHJcbiAgd2l0aEVycm9ySGFuZGxlcixcclxuICB3aXRoQXBpTG9nZ2luZyxcclxuICB3aXRoQWRtaW5BdXRoKFsncHJvZHVjdHNfdXBkYXRlJ10pLFxyXG4gIHdpdGhWYWxpZGF0aW9uKEltYWdlVXBkYXRlU2NoZW1hKVxyXG4pKHB1dEhhbmRsZXIpO1xyXG5cclxuZXhwb3J0IGNvbnN0IERFTEVURSA9IGNvbXBvc2VNaWRkbGV3YXJlcyhcclxuICB3aXRoRXJyb3JIYW5kbGVyLFxyXG4gIHdpdGhBcGlMb2dnaW5nLFxyXG4gIHdpdGhBZG1pbkF1dGgoWydwcm9kdWN0c19kZWxldGUnXSlcclxuKShkZWxldGVIYW5kbGVyKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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