{"version":3,"names":["CORS_CONFIG","cov_nqnq58eqw","f","s","generateCorsHeaders","getAllowedOrigins","getCorsOriginHeader","isOriginAllowed","PRODUCTION_ORIGINS","DEVELOPMENT_ORIGINS","STAGING_ORIGINS","env","process","NODE_ENV","customOrigins","b","ALLOWED_ORIGINS","split","map","origin","trim","allowedOrigins","includes","requestOrigin","public","methods","headers","credentials","admin","webhook","configType","config","join","toString"],"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\lib\\security\\cors-config.ts"],"sourcesContent":["/**\r\n * Configuración centralizada de CORS para la aplicación\r\n * Maneja orígenes permitidos según el entorno\r\n */\r\n\r\n// ===================================\r\n// CONFIGURACIÓN DE ORÍGENES PERMITIDOS\r\n// ===================================\r\n\r\nconst PRODUCTION_ORIGINS = [\r\n  'https://yourdomain.com',\r\n  'https://www.yourdomain.com',\r\n  'https://admin.yourdomain.com'\r\n];\r\n\r\nconst DEVELOPMENT_ORIGINS = [\r\n  'http://localhost:3000',\r\n  'http://localhost:3001',\r\n  'http://127.0.0.1:3000',\r\n  'https://localhost:3000'\r\n];\r\n\r\nconst STAGING_ORIGINS = [\r\n  'https://staging.yourdomain.com',\r\n  'https://preview.yourdomain.com'\r\n];\r\n\r\n// ===================================\r\n// UTILIDADES CORS\r\n// ===================================\r\n\r\n/**\r\n * Obtiene los orígenes permitidos según el entorno\r\n */\r\nexport function getAllowedOrigins(): string[] {\r\n  const env = process.env.NODE_ENV;\r\n  const customOrigins = process.env.ALLOWED_ORIGINS?.split(',').map(origin => origin.trim()) || [];\r\n  \r\n  switch (env) {\r\n    case 'production':\r\n      return [...PRODUCTION_ORIGINS, ...customOrigins];\r\n    case 'staging':\r\n      return [...STAGING_ORIGINS, ...customOrigins];\r\n    case 'development':\r\n    case 'test':\r\n    default:\r\n      return [...DEVELOPMENT_ORIGINS, ...customOrigins];\r\n  }\r\n}\r\n\r\n/**\r\n * Verifica si un origen está permitido\r\n */\r\nexport function isOriginAllowed(origin: string | undefined): boolean {\r\n  if (!origin) return false;\r\n  \r\n  const allowedOrigins = getAllowedOrigins();\r\n  return allowedOrigins.includes(origin);\r\n}\r\n\r\n/**\r\n * Obtiene el header Access-Control-Allow-Origin apropiado\r\n */\r\nexport function getCorsOriginHeader(requestOrigin?: string): string {\r\n  // En desarrollo, permitir todos los orígenes para facilitar el desarrollo\r\n  if (process.env.NODE_ENV === 'development') {\r\n    return '*';\r\n  }\r\n  \r\n  // En producción, verificar origen específico\r\n  if (requestOrigin && isOriginAllowed(requestOrigin)) {\r\n    return requestOrigin;\r\n  }\r\n  \r\n  // Por defecto, usar el primer origen permitido\r\n  const allowedOrigins = getAllowedOrigins();\r\n  return allowedOrigins[0] || 'null';\r\n}\r\n\r\n/**\r\n * Configuración CORS completa para diferentes endpoints\r\n */\r\nexport const CORS_CONFIG = {\r\n  // Para APIs públicas (más restrictivo)\r\n  public: {\r\n    methods: ['GET', 'POST', 'OPTIONS'],\r\n    headers: ['Content-Type', 'Authorization'],\r\n    credentials: false\r\n  },\r\n  \r\n  // Para APIs de administración (muy restrictivo)\r\n  admin: {\r\n    methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\r\n    headers: ['Content-Type', 'Authorization', 'X-Admin-Token'],\r\n    credentials: true\r\n  },\r\n  \r\n  // Para webhooks (específico)\r\n  webhook: {\r\n    methods: ['POST', 'OPTIONS'],\r\n    headers: ['Content-Type', 'X-Signature', 'User-Agent'],\r\n    credentials: false\r\n  }\r\n} as const;\r\n\r\n/**\r\n * Genera headers CORS completos para una respuesta\r\n */\r\nexport function generateCorsHeaders(\r\n  requestOrigin?: string,\r\n  configType: keyof typeof CORS_CONFIG = 'public'\r\n): Record<string, string> {\r\n  const config = CORS_CONFIG[configType];\r\n  \r\n  return {\r\n    'Access-Control-Allow-Origin': getCorsOriginHeader(requestOrigin),\r\n    'Access-Control-Allow-Methods': config.methods.join(', '),\r\n    'Access-Control-Allow-Headers': config.headers.join(', '),\r\n    'Access-Control-Allow-Credentials': config.credentials.toString(),\r\n    'Access-Control-Max-Age': '86400', // 24 horas\r\n    'Vary': 'Origin'\r\n  };\r\n}"],"mappings":"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","ignoreList":[]}