{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\admin\\useOrdersState.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - ORDERS STATE HOOK\r\n// Hook especializado para manejo de estado de Ã³rdenes\r\n// ===================================\r\n\r\nimport { useState, useCallback, useRef } from 'react';\r\nimport { StrictOrderEnterprise, StrictPagination } from '@/types/api-strict';\r\nimport { StrictOrderFilters } from './useOrdersEnterpriseStrict';\r\n\r\n// ===================================\r\n// TIPOS DE ESTADO\r\n// ===================================\r\n\r\nexport interface StrictOrdersState {\r\n  readonly orders: StrictOrderEnterprise[];\r\n  readonly pagination: StrictPagination | null;\r\n  readonly analytics: {\r\n    readonly total_orders: number;\r\n    readonly total_revenue: number;\r\n    readonly pending_orders: number;\r\n    readonly completed_orders: number;\r\n  } | null;\r\n  readonly filters: StrictOrderFilters;\r\n  readonly isLoading: boolean;\r\n  readonly error: string | null;\r\n  readonly lastUpdated: Date | null;\r\n}\r\n\r\nexport interface StrictOrdersActions {\r\n  readonly updateFilters: (newFilters: Partial<StrictOrderFilters>) => void;\r\n  readonly setLoading: (loading: boolean) => void;\r\n  readonly setError: (error: string | null) => void;\r\n  readonly setOrders: (orders: StrictOrderEnterprise[]) => void;\r\n  readonly setPagination: (pagination: StrictPagination | null) => void;\r\n  readonly setAnalytics: (analytics: StrictOrdersState['analytics']) => void;\r\n  readonly resetState: () => void;\r\n  readonly updateOrder: (orderId: string, updates: Partial<StrictOrderEnterprise>) => void;\r\n}\r\n\r\n// ===================================\r\n// ESTADO POR DEFECTO\r\n// ===================================\r\n\r\nconst DEFAULT_FILTERS: StrictOrderFilters = {\r\n  page: 1,\r\n  limit: 20,\r\n  sort_by: 'created_at',\r\n  sort_order: 'desc',\r\n  status: 'all',\r\n  payment_status: 'all',\r\n  fulfillment_status: 'all'\r\n};\r\n\r\nconst DEFAULT_STATE: Omit<StrictOrdersState, 'filters'> = {\r\n  orders: [],\r\n  pagination: null,\r\n  analytics: null,\r\n  isLoading: false,\r\n  error: null,\r\n  lastUpdated: null\r\n};\r\n\r\n// ===================================\r\n// HOOK DE ESTADO\r\n// ===================================\r\n\r\nexport interface UseOrdersStateReturn extends StrictOrdersState, StrictOrdersActions {\r\n  readonly getLastFilters: () => StrictOrderFilters;\r\n  readonly hasFiltersChanged: (newFilters: StrictOrderFilters) => boolean;\r\n}\r\n\r\nexport function useOrdersState(\r\n  initialFilters: Partial<StrictOrderFilters> = {}\r\n): UseOrdersStateReturn {\r\n  \r\n  // Estado principal\r\n  const [state, setState] = useState<StrictOrdersState>({\r\n    ...DEFAULT_STATE,\r\n    filters: { ...DEFAULT_FILTERS, ...initialFilters }\r\n  });\r\n  \r\n  // Referencias para comparaciones\r\n  const lastFiltersRef = useRef<StrictOrderFilters>(state.filters);\r\n  \r\n  // ===================================\r\n  // ACCIONES DE ESTADO\r\n  // ===================================\r\n  \r\n  const updateFilters = useCallback((newFilters: Partial<StrictOrderFilters>): void => {\r\n    setState(prev => {\r\n      const updatedFilters = { ...prev.filters, ...newFilters };\r\n      lastFiltersRef.current = updatedFilters;\r\n      \r\n      return {\r\n        ...prev,\r\n        filters: updatedFilters,\r\n        // Reset pagination cuando cambian filtros (excepto page)\r\n        ...(Object.keys(newFilters).some(key => key !== 'page') && {\r\n          pagination: prev.pagination ? { ...prev.pagination, page: 1 } : null\r\n        })\r\n      };\r\n    });\r\n  }, []);\r\n  \r\n  const setLoading = useCallback((loading: boolean): void => {\r\n    setState(prev => ({\r\n      ...prev,\r\n      isLoading: loading,\r\n      // Limpiar error cuando empieza nueva carga\r\n      ...(loading && { error: null })\r\n    }));\r\n  }, []);\r\n  \r\n  const setError = useCallback((error: string | null): void => {\r\n    setState(prev => ({\r\n      ...prev,\r\n      error,\r\n      isLoading: false\r\n    }));\r\n  }, []);\r\n  \r\n  const setOrders = useCallback((orders: StrictOrderEnterprise[]): void => {\r\n    setState(prev => ({\r\n      ...prev,\r\n      orders,\r\n      lastUpdated: new Date(),\r\n      isLoading: false,\r\n      error: null\r\n    }));\r\n  }, []);\r\n  \r\n  const setPagination = useCallback((pagination: StrictPagination | null): void => {\r\n    setState(prev => ({\r\n      ...prev,\r\n      pagination\r\n    }));\r\n  }, []);\r\n  \r\n  const setAnalytics = useCallback((analytics: StrictOrdersState['analytics']): void => {\r\n    setState(prev => ({\r\n      ...prev,\r\n      analytics\r\n    }));\r\n  }, []);\r\n  \r\n  const resetState = useCallback((): void => {\r\n    setState({\r\n      ...DEFAULT_STATE,\r\n      filters: { ...DEFAULT_FILTERS }\r\n    });\r\n    lastFiltersRef.current = { ...DEFAULT_FILTERS };\r\n  }, []);\r\n  \r\n  const updateOrder = useCallback((orderId: string, updates: Partial<StrictOrderEnterprise>): void => {\r\n    setState(prev => ({\r\n      ...prev,\r\n      orders: prev.orders.map(order => \r\n        order.id === orderId \r\n          ? { ...order, ...updates }\r\n          : order\r\n      ),\r\n      lastUpdated: new Date()\r\n    }));\r\n  }, []);\r\n  \r\n  // ===================================\r\n  // UTILIDADES\r\n  // ===================================\r\n  \r\n  const getLastFilters = useCallback((): StrictOrderFilters => {\r\n    return lastFiltersRef.current;\r\n  }, []);\r\n  \r\n  const hasFiltersChanged = useCallback((newFilters: StrictOrderFilters): boolean => {\r\n    const currentFiltersString = JSON.stringify(state.filters);\r\n    const newFiltersString = JSON.stringify(newFilters);\r\n    return currentFiltersString !== newFiltersString;\r\n  }, [state.filters]);\r\n  \r\n  // ===================================\r\n  // RETORNO DEL HOOK\r\n  // ===================================\r\n  \r\n  return {\r\n    // Estado\r\n    orders: state.orders,\r\n    pagination: state.pagination,\r\n    analytics: state.analytics,\r\n    filters: state.filters,\r\n    isLoading: state.isLoading,\r\n    error: state.error,\r\n    lastUpdated: state.lastUpdated,\r\n    \r\n    // Acciones\r\n    updateFilters,\r\n    setLoading,\r\n    setError,\r\n    setOrders,\r\n    setPagination,\r\n    setAnalytics,\r\n    resetState,\r\n    updateOrder,\r\n    \r\n    // Utilidades\r\n    getLastFilters,\r\n    hasFiltersChanged\r\n  };\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["useOrdersState","DEFAULT_FILTERS","page","limit","sort_by","sort_order","status","payment_status","fulfillment_status","DEFAULT_STATE","orders","pagination","analytics","isLoading","error","lastUpdated","initialFilters","state","setState","useState","filters","lastFiltersRef","useRef","updateFilters","useCallback","newFilters","prev","updatedFilters","current","Object","keys","some","key","setLoading","loading","setError","setOrders","Date","setPagination","setAnalytics","resetState","updateOrder","orderId","updates","map","order","id","getLastFilters","hasFiltersChanged","currentFiltersString","JSON","stringify","newFiltersString"],"mappings":"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"}