{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\lib\\orders-enterprise.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - ORDERS ENTERPRISE UTILITIES\r\n// ===================================\r\n\r\nimport { \r\n  OrderStatus, \r\n  PaymentStatus,\r\n  ORDER_STATE_TRANSITIONS,\r\n  ORDER_STATUS_DESCRIPTIONS,\r\n  StateTransitionValidation,\r\n  OrderEnterprise,\r\n  OrderStatusHistory,\r\n  OrderNote\r\n} from '@/types/orders-enterprise';\r\n\r\n// ===================================\r\n// VALIDACIONES DE ESTADO\r\n// ===================================\r\n\r\n/**\r\n * Valida si una transición de estado es permitida\r\n */\r\nexport function validateStateTransition(\r\n  currentStatus: OrderStatus, \r\n  newStatus: OrderStatus\r\n): StateTransitionValidation {\r\n  if (currentStatus === newStatus) {\r\n    return { \r\n      valid: false, \r\n      message: 'El estado ya es el mismo',\r\n      allowedTransitions: ORDER_STATE_TRANSITIONS[currentStatus] || []\r\n    };\r\n  }\r\n  \r\n  const allowedTransitions = ORDER_STATE_TRANSITIONS[currentStatus];\r\n  if (!allowedTransitions || !allowedTransitions.includes(newStatus)) {\r\n    return { \r\n      valid: false, \r\n      message: `Transición no permitida: ${ORDER_STATUS_DESCRIPTIONS[currentStatus]} → ${ORDER_STATUS_DESCRIPTIONS[newStatus]}`,\r\n      allowedTransitions: allowedTransitions || []\r\n    };\r\n  }\r\n  \r\n  return { \r\n    valid: true,\r\n    allowedTransitions: allowedTransitions || []\r\n  };\r\n}\r\n\r\n/**\r\n * Obtiene las transiciones disponibles para un estado\r\n */\r\nexport function getAvailableTransitions(currentStatus: OrderStatus): {\r\n  status: OrderStatus;\r\n  description: string;\r\n  requiresReason: boolean;\r\n}[] {\r\n  const transitions = ORDER_STATE_TRANSITIONS[currentStatus] || [];\r\n  \r\n  return transitions.map(status => ({\r\n    status,\r\n    description: ORDER_STATUS_DESCRIPTIONS[status],\r\n    requiresReason: ['cancelled', 'refunded', 'returned'].includes(status)\r\n  }));\r\n}\r\n\r\n/**\r\n * Verifica si un estado requiere información adicional\r\n */\r\nexport function statusRequiresAdditionalInfo(status: OrderStatus): {\r\n  requiresTracking: boolean;\r\n  requiresCarrier: boolean;\r\n  requiresReason: boolean;\r\n  requiresEstimatedDelivery: boolean;\r\n} {\r\n  return {\r\n    requiresTracking: ['shipped'].includes(status),\r\n    requiresCarrier: ['shipped'].includes(status),\r\n    requiresReason: ['cancelled', 'refunded', 'returned'].includes(status),\r\n    requiresEstimatedDelivery: ['shipped'].includes(status)\r\n  };\r\n}\r\n\r\n// ===================================\r\n// FORMATEO Y DISPLAY\r\n// ===================================\r\n\r\n/**\r\n * Formatea el estado de una orden para mostrar al usuario\r\n */\r\nexport function formatOrderStatus(status: OrderStatus): {\r\n  label: string;\r\n  color: string;\r\n  description: string;\r\n  icon: string;\r\n} {\r\n  const statusMap: Record<OrderStatus, { label: string; color: string; description: string; icon: string }> = {\r\n    pending: {\r\n      label: 'Pendiente',\r\n      color: 'yellow',\r\n      description: 'Esperando confirmación',\r\n      icon: 'clock'\r\n    },\r\n    confirmed: {\r\n      label: 'Confirmada',\r\n      color: 'blue',\r\n      description: 'Confirmada, preparando pedido',\r\n      icon: 'check-circle'\r\n    },\r\n    processing: {\r\n      label: 'Procesando',\r\n      color: 'orange',\r\n      description: 'En proceso de preparación',\r\n      icon: 'cog'\r\n    },\r\n    shipped: {\r\n      label: 'Enviada',\r\n      color: 'purple',\r\n      description: 'Producto en camino',\r\n      icon: 'truck'\r\n    },\r\n    delivered: {\r\n      label: 'Entregada',\r\n      color: 'green',\r\n      description: 'Producto entregado exitosamente',\r\n      icon: 'check'\r\n    },\r\n    cancelled: {\r\n      label: 'Cancelada',\r\n      color: 'red',\r\n      description: 'Orden cancelada',\r\n      icon: 'x-circle'\r\n    },\r\n    refunded: {\r\n      label: 'Reembolsada',\r\n      color: 'gray',\r\n      description: 'Dinero reembolsado',\r\n      icon: 'arrow-left'\r\n    },\r\n    returned: {\r\n      label: 'Devuelta',\r\n      color: 'amber',\r\n      description: 'Producto devuelto',\r\n      icon: 'arrow-up'\r\n    }\r\n  };\r\n\r\n  return statusMap[status] || statusMap.pending;\r\n}\r\n\r\n/**\r\n * Formatea el estado de pago\r\n */\r\nexport function formatPaymentStatus(status: PaymentStatus): {\r\n  label: string;\r\n  color: string;\r\n  description: string;\r\n} {\r\n  const statusMap: Record<PaymentStatus, { label: string; color: string; description: string }> = {\r\n    pending: {\r\n      label: 'Pendiente',\r\n      color: 'yellow',\r\n      description: 'Esperando pago'\r\n    },\r\n    paid: {\r\n      label: 'Pagado',\r\n      color: 'green',\r\n      description: 'Pago confirmado'\r\n    },\r\n    failed: {\r\n      label: 'Falló',\r\n      color: 'red',\r\n      description: 'Error en el pago'\r\n    },\r\n    refunded: {\r\n      label: 'Reembolsado',\r\n      color: 'gray',\r\n      description: 'Dinero devuelto'\r\n    }\r\n  };\r\n\r\n  return statusMap[status] || statusMap.pending;\r\n}\r\n\r\n// ===================================\r\n// CÁLCULOS Y MÉTRICAS\r\n// ===================================\r\n\r\n/**\r\n * Calcula el tiempo promedio entre estados\r\n */\r\nexport function calculateAverageStateTime(\r\n  statusHistory: OrderStatusHistory[]\r\n): Record<string, number> {\r\n  const stateTimes: Record<string, number[]> = {};\r\n  \r\n  for (let i = 0; i < statusHistory.length - 1; i++) {\r\n    const current = statusHistory[i];\r\n    const next = statusHistory[i + 1];\r\n    \r\n    const timeInState = new Date(next.created_at).getTime() - new Date(current.created_at).getTime();\r\n    const stateKey = `${current.new_status}_to_${next.new_status}`;\r\n    \r\n    if (!stateTimes[stateKey]) {\r\n      stateTimes[stateKey] = [];\r\n    }\r\n    stateTimes[stateKey].push(timeInState);\r\n  }\r\n  \r\n  const averages: Record<string, number> = {};\r\n  for (const [key, times] of Object.entries(stateTimes)) {\r\n    averages[key] = times.reduce((sum, time) => sum + time, 0) / times.length;\r\n  }\r\n  \r\n  return averages;\r\n}\r\n\r\n/**\r\n * Calcula métricas de una orden\r\n */\r\nexport function calculateOrderMetrics(order: OrderEnterprise): {\r\n  totalItems: number;\r\n  averageItemPrice: number;\r\n  processingTime?: number;\r\n  deliveryTime?: number;\r\n} {\r\n  const totalItems = order.order_items?.reduce((sum, item) => sum + item.quantity, 0) || 0;\r\n  const averageItemPrice = totalItems > 0 ? order.total / totalItems : 0;\r\n  \r\n  let processingTime: number | undefined;\r\n  let deliveryTime: number | undefined;\r\n  \r\n  if (order.status_history && order.status_history.length > 0) {\r\n    const confirmedTime = order.status_history.find(h => h.new_status === 'confirmed')?.created_at;\r\n    const shippedTime = order.status_history.find(h => h.new_status === 'shipped')?.created_at;\r\n    const deliveredTime = order.status_history.find(h => h.new_status === 'delivered')?.created_at;\r\n    \r\n    if (confirmedTime && shippedTime) {\r\n      processingTime = new Date(shippedTime).getTime() - new Date(confirmedTime).getTime();\r\n    }\r\n    \r\n    if (shippedTime && deliveredTime) {\r\n      deliveryTime = new Date(deliveredTime).getTime() - new Date(shippedTime).getTime();\r\n    }\r\n  }\r\n  \r\n  return {\r\n    totalItems,\r\n    averageItemPrice,\r\n    processingTime,\r\n    deliveryTime\r\n  };\r\n}\r\n\r\n// ===================================\r\n// FILTROS Y BÚSQUEDA\r\n// ===================================\r\n\r\n/**\r\n * Filtra órdenes por criterios múltiples\r\n */\r\nexport function filterOrders(\r\n  orders: OrderEnterprise[],\r\n  filters: {\r\n    status?: OrderStatus;\r\n    paymentStatus?: PaymentStatus;\r\n    dateFrom?: string;\r\n    dateTo?: string;\r\n    search?: string;\r\n    minAmount?: number;\r\n    maxAmount?: number;\r\n  }\r\n): OrderEnterprise[] {\r\n  return orders.filter(order => {\r\n    // Filtro por estado\r\n    if (filters.status && order.status !== filters.status) {\r\n      return false;\r\n    }\r\n    \r\n    // Filtro por estado de pago\r\n    if (filters.paymentStatus && order.payment_status !== filters.paymentStatus) {\r\n      return false;\r\n    }\r\n    \r\n    // Filtro por fecha desde\r\n    if (filters.dateFrom && new Date(order.created_at) < new Date(filters.dateFrom)) {\r\n      return false;\r\n    }\r\n    \r\n    // Filtro por fecha hasta\r\n    if (filters.dateTo && new Date(order.created_at) > new Date(filters.dateTo)) {\r\n      return false;\r\n    }\r\n    \r\n    // Filtro por monto mínimo\r\n    if (filters.minAmount && order.total < filters.minAmount) {\r\n      return false;\r\n    }\r\n    \r\n    // Filtro por monto máximo\r\n    if (filters.maxAmount && order.total > filters.maxAmount) {\r\n      return false;\r\n    }\r\n    \r\n    // Filtro por búsqueda de texto\r\n    if (filters.search) {\r\n      const searchLower = filters.search.toLowerCase();\r\n      const searchableText = [\r\n        order.order_number,\r\n        order.user_profiles?.name,\r\n        order.user_profiles?.email,\r\n        order.notes,\r\n        order.admin_notes\r\n      ].filter(Boolean).join(' ').toLowerCase();\r\n      \r\n      if (!searchableText.includes(searchLower)) {\r\n        return false;\r\n      }\r\n    }\r\n    \r\n    return true;\r\n  });\r\n}\r\n\r\n/**\r\n * Ordena órdenes por criterio específico\r\n */\r\nexport function sortOrders(\r\n  orders: OrderEnterprise[],\r\n  sortBy: 'created_at' | 'total' | 'order_number' | 'status',\r\n  sortOrder: 'asc' | 'desc' = 'desc'\r\n): OrderEnterprise[] {\r\n  return [...orders].sort((a, b) => {\r\n    let comparison = 0;\r\n    \r\n    switch (sortBy) {\r\n      case 'created_at':\r\n        comparison = new Date(a.created_at).getTime() - new Date(b.created_at).getTime();\r\n        break;\r\n      case 'total':\r\n      comparison = a.total - b.total;\r\n        break;\r\n      case 'order_number':\r\n        comparison = a.order_number.localeCompare(b.order_number);\r\n        break;\r\n      case 'status':\r\n        comparison = a.status.localeCompare(b.status);\r\n        break;\r\n    }\r\n    \r\n    return sortOrder === 'asc' ? comparison : -comparison;\r\n  });\r\n}\r\n\r\n// ===================================\r\n// UTILIDADES DE NOTIFICACIÓN\r\n// ===================================\r\n\r\n/**\r\n * Genera mensaje de notificación para cambio de estado\r\n */\r\nexport function generateStatusChangeMessage(\r\n  orderNumber: string,\r\n  previousStatus: OrderStatus,\r\n  newStatus: OrderStatus,\r\n  trackingNumber?: string\r\n): string {\r\n  const statusInfo = formatOrderStatus(newStatus);\r\n  \r\n  let message = `Tu orden ${orderNumber} ha cambiado a: ${statusInfo.label}`;\r\n  \r\n  if (newStatus === 'shipped' && trackingNumber) {\r\n    message += `. Número de seguimiento: ${trackingNumber}`;\r\n  }\r\n  \r\n  return message;\r\n}\r\n\r\n/**\r\n * Determina si se debe enviar notificación al cliente\r\n */\r\nexport function shouldNotifyCustomer(\r\n  previousStatus: OrderStatus,\r\n  newStatus: OrderStatus\r\n): boolean {\r\n  // Notificar en cambios importantes para el cliente\r\n  const notifiableTransitions = [\r\n    'confirmed',\r\n    'shipped',\r\n    'delivered',\r\n    'cancelled'\r\n  ];\r\n  \r\n  return notifiableTransitions.includes(newStatus);\r\n}\r\n\r\n// ===================================\r\n// VALIDACIONES DE DATOS\r\n// ===================================\r\n\r\n/**\r\n * Valida datos de orden antes de crear/actualizar\r\n */\r\nexport function validateOrderData(orderData: Partial<OrderEnterprise>): {\r\n  valid: boolean;\r\n  errors: string[];\r\n} {\r\n  const errors: string[] = [];\r\n  \r\n  if (orderData.total !== undefined && orderData.total <= 0) {\r\n    errors.push('El monto total debe ser mayor a 0');\r\n  }\r\n  \r\n  if (orderData.order_number && !/^ORD-\\d+-[A-Z0-9]+$/.test(orderData.order_number)) {\r\n    errors.push('Formato de número de orden inválido');\r\n  }\r\n  \r\n  if (orderData.tracking_number && orderData.tracking_number.length < 3) {\r\n    errors.push('Número de seguimiento muy corto');\r\n  }\r\n  \r\n  return {\r\n    valid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n// ===================================\r\n// EXPORTACIÓN DE DATOS\r\n// ===================================\r\n\r\n/**\r\n * Convierte órdenes a formato CSV\r\n */\r\nexport function ordersToCSV(orders: OrderEnterprise[]): string {\r\n  const headers = [\r\n    'Número de Orden',\r\n    'Cliente',\r\n    'Email',\r\n    'Estado',\r\n    'Estado de Pago',\r\n    'Total',\r\n    'Fecha de Creación',\r\n    'Última Actualización'\r\n  ];\r\n  \r\n  const rows = orders.map(order => [\r\n    order.order_number,\r\n    order.user_profiles?.name || '',\r\n    order.user_profiles?.email || '',\r\n    formatOrderStatus(order.status).label,\r\n    formatPaymentStatus(order.payment_status).label,\r\n    order.total.toString(),\r\n    new Date(order.created_at).toLocaleDateString(),\r\n    new Date(order.updated_at).toLocaleDateString()\r\n  ]);\r\n  \r\n  return [headers, ...rows]\r\n    .map(row => row.map(cell => `\"${cell}\"`).join(','))\r\n    .join('\\n');\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["calculateAverageStateTime","calculateOrderMetrics","filterOrders","formatOrderStatus","formatPaymentStatus","generateStatusChangeMessage","getAvailableTransitions","ordersToCSV","shouldNotifyCustomer","sortOrders","statusRequiresAdditionalInfo","validateOrderData","validateStateTransition","currentStatus","newStatus","valid","message","allowedTransitions","ORDER_STATE_TRANSITIONS","includes","ORDER_STATUS_DESCRIPTIONS","transitions","map","status","description","requiresReason","requiresTracking","requiresCarrier","requiresEstimatedDelivery","statusMap","pending","label","color","icon","confirmed","processing","shipped","delivered","cancelled","refunded","returned","paid","failed","statusHistory","stateTimes","i","length","current","next","timeInState","Date","created_at","getTime","stateKey","new_status","push","averages","key","times","Object","entries","reduce","sum","time","order","totalItems","order_items","item","quantity","averageItemPrice","total","processingTime","deliveryTime","status_history","confirmedTime","find","h","shippedTime","deliveredTime","orders","filters","filter","paymentStatus","payment_status","dateFrom","dateTo","minAmount","maxAmount","search","searchLower","toLowerCase","searchableText","order_number","user_profiles","name","email","notes","admin_notes","Boolean","join","sortBy","sortOrder","sort","a","b","comparison","localeCompare","orderNumber","previousStatus","trackingNumber","statusInfo","notifiableTransitions","orderData","errors","undefined","test","tracking_number","headers","rows","toString","toLocaleDateString","updated_at","row","cell"],"mappings":"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"}