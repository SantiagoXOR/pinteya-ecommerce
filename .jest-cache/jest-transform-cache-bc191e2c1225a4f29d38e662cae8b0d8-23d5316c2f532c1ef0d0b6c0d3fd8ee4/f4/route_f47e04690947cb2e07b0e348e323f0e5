10313d0dca5d121530aed2e763a468fc
// Configuración para Node.js Runtime
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get OPTIONS () {
        return OPTIONS;
    },
    get POST () {
        return POST;
    },
    get runtime () {
        return runtime;
    }
});
const _server = require("next/server");
const _zod = require("zod");
const _ratelimiter = require("../../../../lib/rate-limiting/rate-limiter");
const _securitylogger = require("../../../../lib/logging/security-logger");
const runtime = 'nodejs';
// Schema de validación para checkout
const checkoutValidationSchema = _zod.z.object({
    customerInfo: _zod.z.object({
        firstName: _zod.z.string().min(1, 'Nombre es requerido'),
        lastName: _zod.z.string().min(1, 'Apellido es requerido'),
        email: _zod.z.string().email('Email inválido'),
        phone: _zod.z.string().min(8, 'Teléfono debe tener al menos 8 dígitos')
    }),
    shippingAddress: _zod.z.object({
        streetAddress: _zod.z.string().min(5, 'Dirección debe tener al menos 5 caracteres'),
        apartment: _zod.z.string().optional(),
        city: _zod.z.string().min(2, 'Ciudad es requerida'),
        state: _zod.z.string().min(2, 'Provincia es requerida'),
        zipCode: _zod.z.string().min(4, 'Código postal inválido'),
        country: _zod.z.string().default('Argentina'),
        observations: _zod.z.string().optional()
    }),
    items: _zod.z.array(_zod.z.object({
        id: _zod.z.string(),
        name: _zod.z.string(),
        price: _zod.z.number().positive('Precio debe ser positivo'),
        quantity: _zod.z.number().int().positive('Cantidad debe ser positiva'),
        stock: _zod.z.number().int().nonnegative().optional()
    })).min(1, 'Debe haber al menos un producto'),
    paymentMethod: _zod.z.enum([
        'mercadopago',
        'bank',
        'cash'
    ]),
    shippingMethod: _zod.z.enum([
        'free',
        'express',
        'pickup'
    ]),
    totals: _zod.z.object({
        subtotal: _zod.z.number().nonnegative(),
        shipping: _zod.z.number().nonnegative(),
        discount: _zod.z.number().nonnegative().default(0),
        total: _zod.z.number().positive('Total debe ser mayor a 0')
    })
});
async function POST(request) {
    // Crear logger de seguridad con contexto
    const securityLogger = (0, _securitylogger.createSecurityLogger)(request);
    // Aplicar rate limiting para APIs de checkout
    const rateLimitResult = await (0, _ratelimiter.withRateLimit)(request, _ratelimiter.RATE_LIMIT_CONFIGS.checkout, async ()=>{
        // Log de acceso a la API
        securityLogger.log({
            type: 'api_access',
            endpoint: '/api/checkout/validate',
            method: 'POST',
            userAgent: request.headers.get('user-agent'),
            timestamp: new Date().toISOString()
        });
        try {
            const body = await request.json();
            // Validar estructura básica
            const validatedData = checkoutValidationSchema.parse(body);
            const validationResults = {
                isValid: true,
                errors: [],
                warnings: [],
                suggestions: []
            };
            // Validaciones adicionales de negocio
            // 1. Validar stock de productos (simulado)
            for (const item of validatedData.items){
                const simulatedStock = Math.floor(Math.random() * 100) + 10; // Stock simulado
                if (item.quantity > simulatedStock) {
                    validationResults.errors.push(`Producto "${item.name}": Stock insuficiente (disponible: ${simulatedStock}, solicitado: ${item.quantity})`);
                    validationResults.isValid = false;
                }
            }
            // 2. Validar totales
            const calculatedSubtotal = validatedData.items.reduce((sum, item)=>sum + item.price * item.quantity, 0);
            if (Math.abs(calculatedSubtotal - validatedData.totals.subtotal) > 0.01) {
                validationResults.errors.push(`Subtotal incorrecto. Calculado: $${calculatedSubtotal}, Recibido: $${validatedData.totals.subtotal}`);
                validationResults.isValid = false;
            }
            // 3. Validar costo de envío
            const expectedShipping = calculateShippingCost(validatedData.shippingMethod, validatedData.totals.subtotal, validatedData.shippingAddress.state);
            if (Math.abs(expectedShipping - validatedData.totals.shipping) > 0.01) {
                validationResults.errors.push(`Costo de envío incorrecto. Esperado: $${expectedShipping}, Recibido: $${validatedData.totals.shipping}`);
                validationResults.isValid = false;
            }
            // 4. Validar total final
            const expectedTotal = calculatedSubtotal + expectedShipping - validatedData.totals.discount;
            if (Math.abs(expectedTotal - validatedData.totals.total) > 0.01) {
                validationResults.errors.push(`Total incorrecto. Esperado: $${expectedTotal}, Recibido: $${validatedData.totals.total}`);
                validationResults.isValid = false;
            }
            // 5. Validaciones de dirección
            if (validatedData.shippingAddress.state === 'CABA' && !validatedData.shippingAddress.zipCode.startsWith('C')) {
                validationResults.warnings.push('El código postal no parece corresponder a CABA');
            }
            // 6. Sugerencias basadas en observaciones
            if (validatedData.shippingAddress.observations) {
                const obs = validatedData.shippingAddress.observations.toLowerCase();
                if (obs.includes('barrio') || obs.includes('zona')) {
                    validationResults.suggestions.push('Excelente! Las observaciones sobre el barrio ayudarán al delivery');
                }
                if (obs.includes('horario') || obs.includes('hora')) {
                    validationResults.suggestions.push('Perfecto! Los horarios especificados facilitarán la entrega');
                }
            } else {
                validationResults.suggestions.push('Considera agregar observaciones sobre el barrio o horarios preferidos para mejorar la entrega');
            }
            // 7. Validar método de pago
            if (validatedData.paymentMethod === 'bank' && validatedData.totals.total < 10000) {
                validationResults.warnings.push('Para montos menores a $10.000, recomendamos MercadoPago para mayor comodidad');
            }
            // Log de validación
            console.log('✅ Validación de checkout:', {
                customer: `${validatedData.customerInfo.firstName} ${validatedData.customerInfo.lastName}`,
                items: validatedData.items.length,
                total: validatedData.totals.total,
                isValid: validationResults.isValid,
                errors: validationResults.errors.length,
                warnings: validationResults.warnings.length,
                observations: validatedData.shippingAddress.observations ? 'Sí' : 'No'
            });
            const response = {
                success: true,
                data: {
                    validation: validationResults,
                    estimatedDelivery: calculateEstimatedDelivery(validatedData.shippingMethod),
                    recommendedActions: generateRecommendations(validatedData, validationResults)
                },
                message: validationResults.isValid ? 'Checkout válido' : 'Checkout con errores'
            };
            // Log de validación exitosa
            securityLogger.log({
                type: 'checkout_validation',
                isValid: validationResults.isValid,
                errorsCount: validationResults.errors.length,
                warningsCount: validationResults.warnings.length,
                total: validatedData.totals.total,
                paymentMethod: validatedData.paymentMethod
            });
            return _server.NextResponse.json(response, {
                status: validationResults.isValid ? 200 : 400
            });
        } catch (error) {
            console.error('❌ Error validando checkout:', error);
            // Log de error de seguridad
            securityLogger.logApiError(error instanceof Error ? error.message : 'Unknown error', '/api/checkout/validate');
            if (error instanceof _zod.z.ZodError) {
                return _server.NextResponse.json({
                    success: false,
                    error: 'Datos de entrada inválidos',
                    details: error.errors.map((err)=>({
                            field: err.path.join('.'),
                            message: err.message
                        }))
                }, {
                    status: 400
                });
            }
            return _server.NextResponse.json({
                success: false,
                error: 'Error interno del servidor'
            }, {
                status: 500
            });
        }
    });
    // Manejar rate limit excedido
    if (rateLimitResult instanceof _server.NextResponse) {
        securityLogger.logRateLimitExceeded(securityLogger.context, {
            endpoint: '/api/checkout/validate',
            method: 'POST'
        });
        return rateLimitResult;
    }
    return rateLimitResult;
}
// Función auxiliar para calcular costo de envío
function calculateShippingCost(method, subtotal, state) {
    if (method === 'pickup') {
        return 0;
    }
    if (method === 'free' && subtotal >= 25000) {
        return 0;
    }
    const baseCost = method === 'express' ? 5000 : 2500;
    // Costo adicional por provincia
    const stateSurcharge = state === 'CABA' ? 0 : 500;
    return baseCost + stateSurcharge;
}
// Función auxiliar para calcular fecha estimada de entrega
function calculateEstimatedDelivery(shippingMethod) {
    const now = new Date();
    let daysToAdd = 7;
    switch(shippingMethod){
        case 'express':
            daysToAdd = 2;
            break;
        case 'free':
            daysToAdd = 7;
            break;
        case 'pickup':
            daysToAdd = 1;
            break;
    }
    const estimatedDate = new Date(now.getTime() + daysToAdd * 24 * 60 * 60 * 1000);
    return estimatedDate.toISOString().split('T')[0]; // Solo fecha
}
// Función auxiliar para generar recomendaciones
function generateRecommendations(data, validation) {
    const recommendations = [];
    if (!validation.isValid) {
        recommendations.push('Corrige los errores antes de continuar');
    }
    if (data.totals.total > 50000) {
        recommendations.push('Considera dividir la compra en múltiples órdenes para mayor seguridad');
    }
    if (data.paymentMethod === 'cash' && data.totals.total > 30000) {
        recommendations.push('Para montos altos, recomendamos pago digital por seguridad');
    }
    if (!data.shippingAddress.observations) {
        recommendations.push('Agrega observaciones para facilitar la entrega');
    }
    return recommendations;
}
async function OPTIONS() {
    return new _server.NextResponse(null, {
        status: 200,
        headers: {
            'Access-Control-Allow-Origin': '*',
            'Access-Control-Allow-Methods': 'POST, OPTIONS',
            'Access-Control-Allow-Headers': 'Content-Type, Authorization'
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXGNoZWNrb3V0XFx2YWxpZGF0ZVxccm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29uZmlndXJhY2nDs24gcGFyYSBOb2RlLmpzIFJ1bnRpbWVcclxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSAnbm9kZWpzJztcclxuXHJcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gTUVKT1JBUyBERSBTRUdVUklEQUQgLSBBTFRBIFBSSU9SSURBRFxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5pbXBvcnQge1xyXG4gIHdpdGhSYXRlTGltaXQsXHJcbiAgUkFURV9MSU1JVF9DT05GSUdTXHJcbn0gZnJvbSAnQC9saWIvcmF0ZS1saW1pdGluZy9yYXRlLWxpbWl0ZXInO1xyXG5pbXBvcnQge1xyXG4gIEFQSV9USU1FT1VUUyxcclxuICB3aXRoRGF0YWJhc2VUaW1lb3V0LFxyXG4gIGdldEVuZHBvaW50VGltZW91dHNcclxufSBmcm9tICdAL2xpYi9jb25maWcvYXBpLXRpbWVvdXRzJztcclxuaW1wb3J0IHsgY3JlYXRlU2VjdXJpdHlMb2dnZXIgfSBmcm9tICdAL2xpYi9sb2dnaW5nL3NlY3VyaXR5LWxvZ2dlcic7XHJcblxyXG4vLyBTY2hlbWEgZGUgdmFsaWRhY2nDs24gcGFyYSBjaGVja291dFxyXG5jb25zdCBjaGVja291dFZhbGlkYXRpb25TY2hlbWEgPSB6Lm9iamVjdCh7XHJcbiAgY3VzdG9tZXJJbmZvOiB6Lm9iamVjdCh7XHJcbiAgICBmaXJzdE5hbWU6IHouc3RyaW5nKCkubWluKDEsICdOb21icmUgZXMgcmVxdWVyaWRvJyksXHJcbiAgICBsYXN0TmFtZTogei5zdHJpbmcoKS5taW4oMSwgJ0FwZWxsaWRvIGVzIHJlcXVlcmlkbycpLFxyXG4gICAgZW1haWw6IHouc3RyaW5nKCkuZW1haWwoJ0VtYWlsIGludsOhbGlkbycpLFxyXG4gICAgcGhvbmU6IHouc3RyaW5nKCkubWluKDgsICdUZWzDqWZvbm8gZGViZSB0ZW5lciBhbCBtZW5vcyA4IGTDrWdpdG9zJyksXHJcbiAgfSksXHJcbiAgc2hpcHBpbmdBZGRyZXNzOiB6Lm9iamVjdCh7XHJcbiAgICBzdHJlZXRBZGRyZXNzOiB6LnN0cmluZygpLm1pbig1LCAnRGlyZWNjacOzbiBkZWJlIHRlbmVyIGFsIG1lbm9zIDUgY2FyYWN0ZXJlcycpLFxyXG4gICAgYXBhcnRtZW50OiB6LnN0cmluZygpLm9wdGlvbmFsKCksXHJcbiAgICBjaXR5OiB6LnN0cmluZygpLm1pbigyLCAnQ2l1ZGFkIGVzIHJlcXVlcmlkYScpLFxyXG4gICAgc3RhdGU6IHouc3RyaW5nKCkubWluKDIsICdQcm92aW5jaWEgZXMgcmVxdWVyaWRhJyksXHJcbiAgICB6aXBDb2RlOiB6LnN0cmluZygpLm1pbig0LCAnQ8OzZGlnbyBwb3N0YWwgaW52w6FsaWRvJyksXHJcbiAgICBjb3VudHJ5OiB6LnN0cmluZygpLmRlZmF1bHQoJ0FyZ2VudGluYScpLFxyXG4gICAgb2JzZXJ2YXRpb25zOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXHJcbiAgfSksXHJcbiAgaXRlbXM6IHouYXJyYXkoei5vYmplY3Qoe1xyXG4gICAgaWQ6IHouc3RyaW5nKCksXHJcbiAgICBuYW1lOiB6LnN0cmluZygpLFxyXG4gICAgcHJpY2U6IHoubnVtYmVyKCkucG9zaXRpdmUoJ1ByZWNpbyBkZWJlIHNlciBwb3NpdGl2bycpLFxyXG4gICAgcXVhbnRpdHk6IHoubnVtYmVyKCkuaW50KCkucG9zaXRpdmUoJ0NhbnRpZGFkIGRlYmUgc2VyIHBvc2l0aXZhJyksXHJcbiAgICBzdG9jazogei5udW1iZXIoKS5pbnQoKS5ub25uZWdhdGl2ZSgpLm9wdGlvbmFsKCksXHJcbiAgfSkpLm1pbigxLCAnRGViZSBoYWJlciBhbCBtZW5vcyB1biBwcm9kdWN0bycpLFxyXG4gIHBheW1lbnRNZXRob2Q6IHouZW51bShbJ21lcmNhZG9wYWdvJywgJ2JhbmsnLCAnY2FzaCddKSxcclxuICBzaGlwcGluZ01ldGhvZDogei5lbnVtKFsnZnJlZScsICdleHByZXNzJywgJ3BpY2t1cCddKSxcclxuICB0b3RhbHM6IHoub2JqZWN0KHtcclxuICAgIHN1YnRvdGFsOiB6Lm51bWJlcigpLm5vbm5lZ2F0aXZlKCksXHJcbiAgICBzaGlwcGluZzogei5udW1iZXIoKS5ub25uZWdhdGl2ZSgpLFxyXG4gICAgZGlzY291bnQ6IHoubnVtYmVyKCkubm9ubmVnYXRpdmUoKS5kZWZhdWx0KDApLFxyXG4gICAgdG90YWw6IHoubnVtYmVyKCkucG9zaXRpdmUoJ1RvdGFsIGRlYmUgc2VyIG1heW9yIGEgMCcpLFxyXG4gIH0pLFxyXG59KTtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgLy8gQ3JlYXIgbG9nZ2VyIGRlIHNlZ3VyaWRhZCBjb24gY29udGV4dG9cclxuICBjb25zdCBzZWN1cml0eUxvZ2dlciA9IGNyZWF0ZVNlY3VyaXR5TG9nZ2VyKHJlcXVlc3QpO1xyXG5cclxuICAvLyBBcGxpY2FyIHJhdGUgbGltaXRpbmcgcGFyYSBBUElzIGRlIGNoZWNrb3V0XHJcbiAgY29uc3QgcmF0ZUxpbWl0UmVzdWx0ID0gYXdhaXQgd2l0aFJhdGVMaW1pdChcclxuICAgIHJlcXVlc3QsXHJcbiAgICBSQVRFX0xJTUlUX0NPTkZJR1MuY2hlY2tvdXQsXHJcbiAgICBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIExvZyBkZSBhY2Nlc28gYSBsYSBBUElcclxuICAgICAgc2VjdXJpdHlMb2dnZXIubG9nKHtcclxuICAgICAgICB0eXBlOiAnYXBpX2FjY2VzcycsXHJcbiAgICAgICAgZW5kcG9pbnQ6ICcvYXBpL2NoZWNrb3V0L3ZhbGlkYXRlJyxcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICB1c2VyQWdlbnQ6IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKSxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG4gICAgXHJcbiAgICAvLyBWYWxpZGFyIGVzdHJ1Y3R1cmEgYsOhc2ljYVxyXG4gICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGNoZWNrb3V0VmFsaWRhdGlvblNjaGVtYS5wYXJzZShib2R5KTtcclxuICAgIFxyXG4gICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdHMgPSB7XHJcbiAgICAgIGlzVmFsaWQ6IHRydWUsXHJcbiAgICAgIGVycm9yczogW10gYXMgc3RyaW5nW10sXHJcbiAgICAgIHdhcm5pbmdzOiBbXSBhcyBzdHJpbmdbXSxcclxuICAgICAgc3VnZ2VzdGlvbnM6IFtdIGFzIHN0cmluZ1tdLFxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gVmFsaWRhY2lvbmVzIGFkaWNpb25hbGVzIGRlIG5lZ29jaW9cclxuICAgIFxyXG4gICAgLy8gMS4gVmFsaWRhciBzdG9jayBkZSBwcm9kdWN0b3MgKHNpbXVsYWRvKVxyXG4gICAgZm9yIChjb25zdCBpdGVtIG9mIHZhbGlkYXRlZERhdGEuaXRlbXMpIHtcclxuICAgICAgY29uc3Qgc2ltdWxhdGVkU3RvY2sgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApICsgMTA7IC8vIFN0b2NrIHNpbXVsYWRvXHJcbiAgICAgIGlmIChpdGVtLnF1YW50aXR5ID4gc2ltdWxhdGVkU3RvY2spIHtcclxuICAgICAgICB2YWxpZGF0aW9uUmVzdWx0cy5lcnJvcnMucHVzaChcclxuICAgICAgICAgIGBQcm9kdWN0byBcIiR7aXRlbS5uYW1lfVwiOiBTdG9jayBpbnN1ZmljaWVudGUgKGRpc3BvbmlibGU6ICR7c2ltdWxhdGVkU3RvY2t9LCBzb2xpY2l0YWRvOiAke2l0ZW0ucXVhbnRpdHl9KWBcclxuICAgICAgICApO1xyXG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHRzLmlzVmFsaWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyAyLiBWYWxpZGFyIHRvdGFsZXNcclxuICAgIGNvbnN0IGNhbGN1bGF0ZWRTdWJ0b3RhbCA9IHZhbGlkYXRlZERhdGEuaXRlbXMucmVkdWNlKFxyXG4gICAgICAoc3VtLCBpdGVtKSA9PiBzdW0gKyAoaXRlbS5wcmljZSAqIGl0ZW0ucXVhbnRpdHkpLCAwXHJcbiAgICApO1xyXG4gICAgXHJcbiAgICBpZiAoTWF0aC5hYnMoY2FsY3VsYXRlZFN1YnRvdGFsIC0gdmFsaWRhdGVkRGF0YS50b3RhbHMuc3VidG90YWwpID4gMC4wMSkge1xyXG4gICAgICB2YWxpZGF0aW9uUmVzdWx0cy5lcnJvcnMucHVzaChcclxuICAgICAgICBgU3VidG90YWwgaW5jb3JyZWN0by4gQ2FsY3VsYWRvOiAkJHtjYWxjdWxhdGVkU3VidG90YWx9LCBSZWNpYmlkbzogJCR7dmFsaWRhdGVkRGF0YS50b3RhbHMuc3VidG90YWx9YFxyXG4gICAgICApO1xyXG4gICAgICB2YWxpZGF0aW9uUmVzdWx0cy5pc1ZhbGlkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIDMuIFZhbGlkYXIgY29zdG8gZGUgZW52w61vXHJcbiAgICBjb25zdCBleHBlY3RlZFNoaXBwaW5nID0gY2FsY3VsYXRlU2hpcHBpbmdDb3N0KFxyXG4gICAgICB2YWxpZGF0ZWREYXRhLnNoaXBwaW5nTWV0aG9kLFxyXG4gICAgICB2YWxpZGF0ZWREYXRhLnRvdGFscy5zdWJ0b3RhbCxcclxuICAgICAgdmFsaWRhdGVkRGF0YS5zaGlwcGluZ0FkZHJlc3Muc3RhdGVcclxuICAgICk7XHJcbiAgICBcclxuICAgIGlmIChNYXRoLmFicyhleHBlY3RlZFNoaXBwaW5nIC0gdmFsaWRhdGVkRGF0YS50b3RhbHMuc2hpcHBpbmcpID4gMC4wMSkge1xyXG4gICAgICB2YWxpZGF0aW9uUmVzdWx0cy5lcnJvcnMucHVzaChcclxuICAgICAgICBgQ29zdG8gZGUgZW52w61vIGluY29ycmVjdG8uIEVzcGVyYWRvOiAkJHtleHBlY3RlZFNoaXBwaW5nfSwgUmVjaWJpZG86ICQke3ZhbGlkYXRlZERhdGEudG90YWxzLnNoaXBwaW5nfWBcclxuICAgICAgKTtcclxuICAgICAgdmFsaWRhdGlvblJlc3VsdHMuaXNWYWxpZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyA0LiBWYWxpZGFyIHRvdGFsIGZpbmFsXHJcbiAgICBjb25zdCBleHBlY3RlZFRvdGFsID0gY2FsY3VsYXRlZFN1YnRvdGFsICsgZXhwZWN0ZWRTaGlwcGluZyAtIHZhbGlkYXRlZERhdGEudG90YWxzLmRpc2NvdW50O1xyXG4gICAgaWYgKE1hdGguYWJzKGV4cGVjdGVkVG90YWwgLSB2YWxpZGF0ZWREYXRhLnRvdGFscy50b3RhbCkgPiAwLjAxKSB7XHJcbiAgICAgIHZhbGlkYXRpb25SZXN1bHRzLmVycm9ycy5wdXNoKFxyXG4gICAgICAgIGBUb3RhbCBpbmNvcnJlY3RvLiBFc3BlcmFkbzogJCR7ZXhwZWN0ZWRUb3RhbH0sIFJlY2liaWRvOiAkJHt2YWxpZGF0ZWREYXRhLnRvdGFscy50b3RhbH1gXHJcbiAgICAgICk7XHJcbiAgICAgIHZhbGlkYXRpb25SZXN1bHRzLmlzVmFsaWQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gNS4gVmFsaWRhY2lvbmVzIGRlIGRpcmVjY2nDs25cclxuICAgIGlmICh2YWxpZGF0ZWREYXRhLnNoaXBwaW5nQWRkcmVzcy5zdGF0ZSA9PT0gJ0NBQkEnICYmICF2YWxpZGF0ZWREYXRhLnNoaXBwaW5nQWRkcmVzcy56aXBDb2RlLnN0YXJ0c1dpdGgoJ0MnKSkge1xyXG4gICAgICB2YWxpZGF0aW9uUmVzdWx0cy53YXJuaW5ncy5wdXNoKFxyXG4gICAgICAgICdFbCBjw7NkaWdvIHBvc3RhbCBubyBwYXJlY2UgY29ycmVzcG9uZGVyIGEgQ0FCQSdcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gNi4gU3VnZXJlbmNpYXMgYmFzYWRhcyBlbiBvYnNlcnZhY2lvbmVzXHJcbiAgICBpZiAodmFsaWRhdGVkRGF0YS5zaGlwcGluZ0FkZHJlc3Mub2JzZXJ2YXRpb25zKSB7XHJcbiAgICAgIGNvbnN0IG9icyA9IHZhbGlkYXRlZERhdGEuc2hpcHBpbmdBZGRyZXNzLm9ic2VydmF0aW9ucy50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBpZiAob2JzLmluY2x1ZGVzKCdiYXJyaW8nKSB8fCBvYnMuaW5jbHVkZXMoJ3pvbmEnKSkge1xyXG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHRzLnN1Z2dlc3Rpb25zLnB1c2goXHJcbiAgICAgICAgICAnRXhjZWxlbnRlISBMYXMgb2JzZXJ2YWNpb25lcyBzb2JyZSBlbCBiYXJyaW8gYXl1ZGFyw6FuIGFsIGRlbGl2ZXJ5J1xyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9icy5pbmNsdWRlcygnaG9yYXJpbycpIHx8IG9icy5pbmNsdWRlcygnaG9yYScpKSB7XHJcbiAgICAgICAgdmFsaWRhdGlvblJlc3VsdHMuc3VnZ2VzdGlvbnMucHVzaChcclxuICAgICAgICAgICdQZXJmZWN0byEgTG9zIGhvcmFyaW9zIGVzcGVjaWZpY2Fkb3MgZmFjaWxpdGFyw6FuIGxhIGVudHJlZ2EnXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdmFsaWRhdGlvblJlc3VsdHMuc3VnZ2VzdGlvbnMucHVzaChcclxuICAgICAgICAnQ29uc2lkZXJhIGFncmVnYXIgb2JzZXJ2YWNpb25lcyBzb2JyZSBlbCBiYXJyaW8gbyBob3JhcmlvcyBwcmVmZXJpZG9zIHBhcmEgbWVqb3JhciBsYSBlbnRyZWdhJ1xyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyA3LiBWYWxpZGFyIG3DqXRvZG8gZGUgcGFnb1xyXG4gICAgaWYgKHZhbGlkYXRlZERhdGEucGF5bWVudE1ldGhvZCA9PT0gJ2JhbmsnICYmIHZhbGlkYXRlZERhdGEudG90YWxzLnRvdGFsIDwgMTAwMDApIHtcclxuICAgICAgdmFsaWRhdGlvblJlc3VsdHMud2FybmluZ3MucHVzaChcclxuICAgICAgICAnUGFyYSBtb250b3MgbWVub3JlcyBhICQxMC4wMDAsIHJlY29tZW5kYW1vcyBNZXJjYWRvUGFnbyBwYXJhIG1heW9yIGNvbW9kaWRhZCdcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gTG9nIGRlIHZhbGlkYWNpw7NuXHJcbiAgICBjb25zb2xlLmxvZygn4pyFIFZhbGlkYWNpw7NuIGRlIGNoZWNrb3V0OicsIHtcclxuICAgICAgY3VzdG9tZXI6IGAke3ZhbGlkYXRlZERhdGEuY3VzdG9tZXJJbmZvLmZpcnN0TmFtZX0gJHt2YWxpZGF0ZWREYXRhLmN1c3RvbWVySW5mby5sYXN0TmFtZX1gLFxyXG4gICAgICBpdGVtczogdmFsaWRhdGVkRGF0YS5pdGVtcy5sZW5ndGgsXHJcbiAgICAgIHRvdGFsOiB2YWxpZGF0ZWREYXRhLnRvdGFscy50b3RhbCxcclxuICAgICAgaXNWYWxpZDogdmFsaWRhdGlvblJlc3VsdHMuaXNWYWxpZCxcclxuICAgICAgZXJyb3JzOiB2YWxpZGF0aW9uUmVzdWx0cy5lcnJvcnMubGVuZ3RoLFxyXG4gICAgICB3YXJuaW5nczogdmFsaWRhdGlvblJlc3VsdHMud2FybmluZ3MubGVuZ3RoLFxyXG4gICAgICBvYnNlcnZhdGlvbnM6IHZhbGlkYXRlZERhdGEuc2hpcHBpbmdBZGRyZXNzLm9ic2VydmF0aW9ucyA/ICdTw60nIDogJ05vJ1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGNvbnN0IHJlc3BvbnNlID0ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgdmFsaWRhdGlvbjogdmFsaWRhdGlvblJlc3VsdHMsXHJcbiAgICAgICAgZXN0aW1hdGVkRGVsaXZlcnk6IGNhbGN1bGF0ZUVzdGltYXRlZERlbGl2ZXJ5KHZhbGlkYXRlZERhdGEuc2hpcHBpbmdNZXRob2QpLFxyXG4gICAgICAgIHJlY29tbWVuZGVkQWN0aW9uczogZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnModmFsaWRhdGVkRGF0YSwgdmFsaWRhdGlvblJlc3VsdHMpXHJcbiAgICAgIH0sXHJcbiAgICAgIG1lc3NhZ2U6IHZhbGlkYXRpb25SZXN1bHRzLmlzVmFsaWQgPyAnQ2hlY2tvdXQgdsOhbGlkbycgOiAnQ2hlY2tvdXQgY29uIGVycm9yZXMnXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgLy8gTG9nIGRlIHZhbGlkYWNpw7NuIGV4aXRvc2FcclxuICAgICAgICBzZWN1cml0eUxvZ2dlci5sb2coe1xyXG4gICAgICAgICAgdHlwZTogJ2NoZWNrb3V0X3ZhbGlkYXRpb24nLFxyXG4gICAgICAgICAgaXNWYWxpZDogdmFsaWRhdGlvblJlc3VsdHMuaXNWYWxpZCxcclxuICAgICAgICAgIGVycm9yc0NvdW50OiB2YWxpZGF0aW9uUmVzdWx0cy5lcnJvcnMubGVuZ3RoLFxyXG4gICAgICAgICAgd2FybmluZ3NDb3VudDogdmFsaWRhdGlvblJlc3VsdHMud2FybmluZ3MubGVuZ3RoLFxyXG4gICAgICAgICAgdG90YWw6IHZhbGlkYXRlZERhdGEudG90YWxzLnRvdGFsLFxyXG4gICAgICAgICAgcGF5bWVudE1ldGhvZDogdmFsaWRhdGVkRGF0YS5wYXltZW50TWV0aG9kXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXNwb25zZSwge1xyXG4gICAgICAgICAgc3RhdHVzOiB2YWxpZGF0aW9uUmVzdWx0cy5pc1ZhbGlkID8gMjAwIDogNDAwXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB2YWxpZGFuZG8gY2hlY2tvdXQ6JywgZXJyb3IpO1xyXG5cclxuICAgICAgICAvLyBMb2cgZGUgZXJyb3IgZGUgc2VndXJpZGFkXHJcbiAgICAgICAgc2VjdXJpdHlMb2dnZXIubG9nQXBpRXJyb3IoXHJcbiAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcclxuICAgICAgICAgICcvYXBpL2NoZWNrb3V0L3ZhbGlkYXRlJ1xyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcclxuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBlcnJvcjogJ0RhdG9zIGRlIGVudHJhZGEgaW52w6FsaWRvcycsXHJcbiAgICAgICAgICAgIGRldGFpbHM6IGVycm9yLmVycm9ycy5tYXAoZXJyID0+ICh7XHJcbiAgICAgICAgICAgICAgZmllbGQ6IGVyci5wYXRoLmpvaW4oJy4nKSxcclxuICAgICAgICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZVxyXG4gICAgICAgICAgICB9KSlcclxuICAgICAgICAgIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvcjogJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJ1xyXG4gICAgICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICApO1xyXG5cclxuICAvLyBNYW5lamFyIHJhdGUgbGltaXQgZXhjZWRpZG9cclxuICBpZiAocmF0ZUxpbWl0UmVzdWx0IGluc3RhbmNlb2YgTmV4dFJlc3BvbnNlKSB7XHJcbiAgICBzZWN1cml0eUxvZ2dlci5sb2dSYXRlTGltaXRFeGNlZWRlZChcclxuICAgICAgc2VjdXJpdHlMb2dnZXIuY29udGV4dCxcclxuICAgICAgeyBlbmRwb2ludDogJy9hcGkvY2hlY2tvdXQvdmFsaWRhdGUnLCBtZXRob2Q6ICdQT1NUJyB9XHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJhdGVMaW1pdFJlc3VsdDtcclxuICB9XHJcblxyXG4gIHJldHVybiByYXRlTGltaXRSZXN1bHQ7XHJcbn1cclxuXHJcbi8vIEZ1bmNpw7NuIGF1eGlsaWFyIHBhcmEgY2FsY3VsYXIgY29zdG8gZGUgZW52w61vXHJcbmZ1bmN0aW9uIGNhbGN1bGF0ZVNoaXBwaW5nQ29zdChtZXRob2Q6IHN0cmluZywgc3VidG90YWw6IG51bWJlciwgc3RhdGU6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgaWYgKG1ldGhvZCA9PT0gJ3BpY2t1cCcpIHtyZXR1cm4gMDt9XHJcbiAgaWYgKG1ldGhvZCA9PT0gJ2ZyZWUnICYmIHN1YnRvdGFsID49IDI1MDAwKSB7cmV0dXJuIDA7fVxyXG4gIFxyXG4gIGNvbnN0IGJhc2VDb3N0ID0gbWV0aG9kID09PSAnZXhwcmVzcycgPyA1MDAwIDogMjUwMDtcclxuICBcclxuICAvLyBDb3N0byBhZGljaW9uYWwgcG9yIHByb3ZpbmNpYVxyXG4gIGNvbnN0IHN0YXRlU3VyY2hhcmdlID0gc3RhdGUgPT09ICdDQUJBJyA/IDAgOiA1MDA7XHJcbiAgXHJcbiAgcmV0dXJuIGJhc2VDb3N0ICsgc3RhdGVTdXJjaGFyZ2U7XHJcbn1cclxuXHJcbi8vIEZ1bmNpw7NuIGF1eGlsaWFyIHBhcmEgY2FsY3VsYXIgZmVjaGEgZXN0aW1hZGEgZGUgZW50cmVnYVxyXG5mdW5jdGlvbiBjYWxjdWxhdGVFc3RpbWF0ZWREZWxpdmVyeShzaGlwcGluZ01ldGhvZDogc3RyaW5nKTogc3RyaW5nIHtcclxuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gIGxldCBkYXlzVG9BZGQgPSA3O1xyXG4gIFxyXG4gIHN3aXRjaCAoc2hpcHBpbmdNZXRob2QpIHtcclxuICAgIGNhc2UgJ2V4cHJlc3MnOiBkYXlzVG9BZGQgPSAyOyBicmVhaztcclxuICAgIGNhc2UgJ2ZyZWUnOiBkYXlzVG9BZGQgPSA3OyBicmVhaztcclxuICAgIGNhc2UgJ3BpY2t1cCc6IGRheXNUb0FkZCA9IDE7IGJyZWFrO1xyXG4gIH1cclxuICBcclxuICBjb25zdCBlc3RpbWF0ZWREYXRlID0gbmV3IERhdGUobm93LmdldFRpbWUoKSArIChkYXlzVG9BZGQgKiAyNCAqIDYwICogNjAgKiAxMDAwKSk7XHJcbiAgcmV0dXJuIGVzdGltYXRlZERhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOyAvLyBTb2xvIGZlY2hhXHJcbn1cclxuXHJcbi8vIEZ1bmNpw7NuIGF1eGlsaWFyIHBhcmEgZ2VuZXJhciByZWNvbWVuZGFjaW9uZXNcclxuZnVuY3Rpb24gZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoZGF0YTogYW55LCB2YWxpZGF0aW9uOiBhbnkpOiBzdHJpbmdbXSB7XHJcbiAgY29uc3QgcmVjb21tZW5kYXRpb25zID0gW107XHJcbiAgXHJcbiAgaWYgKCF2YWxpZGF0aW9uLmlzVmFsaWQpIHtcclxuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb3JyaWdlIGxvcyBlcnJvcmVzIGFudGVzIGRlIGNvbnRpbnVhcicpO1xyXG4gIH1cclxuICBcclxuICBpZiAoZGF0YS50b3RhbHMudG90YWwgPiA1MDAwMCkge1xyXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyYSBkaXZpZGlyIGxhIGNvbXByYSBlbiBtw7psdGlwbGVzIMOzcmRlbmVzIHBhcmEgbWF5b3Igc2VndXJpZGFkJyk7XHJcbiAgfVxyXG4gIFxyXG4gIGlmIChkYXRhLnBheW1lbnRNZXRob2QgPT09ICdjYXNoJyAmJiBkYXRhLnRvdGFscy50b3RhbCA+IDMwMDAwKSB7XHJcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnUGFyYSBtb250b3MgYWx0b3MsIHJlY29tZW5kYW1vcyBwYWdvIGRpZ2l0YWwgcG9yIHNlZ3VyaWRhZCcpO1xyXG4gIH1cclxuICBcclxuICBpZiAoIWRhdGEuc2hpcHBpbmdBZGRyZXNzLm9ic2VydmF0aW9ucykge1xyXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0FncmVnYSBvYnNlcnZhY2lvbmVzIHBhcmEgZmFjaWxpdGFyIGxhIGVudHJlZ2EnKTtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcclxufVxyXG5cclxuLy8gTcOpdG9kbyBPUFRJT05TIHBhcmEgQ09SU1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gT1BUSU9OUygpIHtcclxuICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShudWxsLCB7XHJcbiAgICBzdGF0dXM6IDIwMCxcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJyxcclxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnOiAnUE9TVCwgT1BUSU9OUycsXHJcbiAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJzogJ0NvbnRlbnQtVHlwZSwgQXV0aG9yaXphdGlvbicsXHJcbiAgICB9LFxyXG4gIH0pO1xyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iXSwibmFtZXMiOlsiT1BUSU9OUyIsIlBPU1QiLCJydW50aW1lIiwiY2hlY2tvdXRWYWxpZGF0aW9uU2NoZW1hIiwieiIsIm9iamVjdCIsImN1c3RvbWVySW5mbyIsImZpcnN0TmFtZSIsInN0cmluZyIsIm1pbiIsImxhc3ROYW1lIiwiZW1haWwiLCJwaG9uZSIsInNoaXBwaW5nQWRkcmVzcyIsInN0cmVldEFkZHJlc3MiLCJhcGFydG1lbnQiLCJvcHRpb25hbCIsImNpdHkiLCJzdGF0ZSIsInppcENvZGUiLCJjb3VudHJ5IiwiZGVmYXVsdCIsIm9ic2VydmF0aW9ucyIsIml0ZW1zIiwiYXJyYXkiLCJpZCIsIm5hbWUiLCJwcmljZSIsIm51bWJlciIsInBvc2l0aXZlIiwicXVhbnRpdHkiLCJpbnQiLCJzdG9jayIsIm5vbm5lZ2F0aXZlIiwicGF5bWVudE1ldGhvZCIsImVudW0iLCJzaGlwcGluZ01ldGhvZCIsInRvdGFscyIsInN1YnRvdGFsIiwic2hpcHBpbmciLCJkaXNjb3VudCIsInRvdGFsIiwicmVxdWVzdCIsInNlY3VyaXR5TG9nZ2VyIiwiY3JlYXRlU2VjdXJpdHlMb2dnZXIiLCJyYXRlTGltaXRSZXN1bHQiLCJ3aXRoUmF0ZUxpbWl0IiwiUkFURV9MSU1JVF9DT05GSUdTIiwiY2hlY2tvdXQiLCJsb2ciLCJ0eXBlIiwiZW5kcG9pbnQiLCJtZXRob2QiLCJ1c2VyQWdlbnQiLCJoZWFkZXJzIiwiZ2V0IiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiYm9keSIsImpzb24iLCJ2YWxpZGF0ZWREYXRhIiwicGFyc2UiLCJ2YWxpZGF0aW9uUmVzdWx0cyIsImlzVmFsaWQiLCJlcnJvcnMiLCJ3YXJuaW5ncyIsInN1Z2dlc3Rpb25zIiwiaXRlbSIsInNpbXVsYXRlZFN0b2NrIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicHVzaCIsImNhbGN1bGF0ZWRTdWJ0b3RhbCIsInJlZHVjZSIsInN1bSIsImFicyIsImV4cGVjdGVkU2hpcHBpbmciLCJjYWxjdWxhdGVTaGlwcGluZ0Nvc3QiLCJleHBlY3RlZFRvdGFsIiwic3RhcnRzV2l0aCIsIm9icyIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJjb25zb2xlIiwiY3VzdG9tZXIiLCJsZW5ndGgiLCJyZXNwb25zZSIsInN1Y2Nlc3MiLCJkYXRhIiwidmFsaWRhdGlvbiIsImVzdGltYXRlZERlbGl2ZXJ5IiwiY2FsY3VsYXRlRXN0aW1hdGVkRGVsaXZlcnkiLCJyZWNvbW1lbmRlZEFjdGlvbnMiLCJnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyIsIm1lc3NhZ2UiLCJlcnJvcnNDb3VudCIsIndhcm5pbmdzQ291bnQiLCJOZXh0UmVzcG9uc2UiLCJzdGF0dXMiLCJlcnJvciIsImxvZ0FwaUVycm9yIiwiRXJyb3IiLCJab2RFcnJvciIsImRldGFpbHMiLCJtYXAiLCJlcnIiLCJmaWVsZCIsInBhdGgiLCJqb2luIiwibG9nUmF0ZUxpbWl0RXhjZWVkZWQiLCJjb250ZXh0IiwiYmFzZUNvc3QiLCJzdGF0ZVN1cmNoYXJnZSIsIm5vdyIsImRheXNUb0FkZCIsImVzdGltYXRlZERhdGUiLCJnZXRUaW1lIiwic3BsaXQiLCJyZWNvbW1lbmRhdGlvbnMiXSwibWFwcGluZ3MiOiJBQUFBLHFDQUFxQzs7Ozs7Ozs7Ozs7O1FBcVNmQTtlQUFBQTs7UUEvT0FDO2VBQUFBOztRQXJEVEM7ZUFBQUE7Ozt3QkFFNkI7cUJBQ3hCOzZCQVFYO2dDQU04QjtBQWpCOUIsTUFBTUEsVUFBVTtBQW1CdkIscUNBQXFDO0FBQ3JDLE1BQU1DLDJCQUEyQkMsTUFBQyxDQUFDQyxNQUFNLENBQUM7SUFDeENDLGNBQWNGLE1BQUMsQ0FBQ0MsTUFBTSxDQUFDO1FBQ3JCRSxXQUFXSCxNQUFDLENBQUNJLE1BQU0sR0FBR0MsR0FBRyxDQUFDLEdBQUc7UUFDN0JDLFVBQVVOLE1BQUMsQ0FBQ0ksTUFBTSxHQUFHQyxHQUFHLENBQUMsR0FBRztRQUM1QkUsT0FBT1AsTUFBQyxDQUFDSSxNQUFNLEdBQUdHLEtBQUssQ0FBQztRQUN4QkMsT0FBT1IsTUFBQyxDQUFDSSxNQUFNLEdBQUdDLEdBQUcsQ0FBQyxHQUFHO0lBQzNCO0lBQ0FJLGlCQUFpQlQsTUFBQyxDQUFDQyxNQUFNLENBQUM7UUFDeEJTLGVBQWVWLE1BQUMsQ0FBQ0ksTUFBTSxHQUFHQyxHQUFHLENBQUMsR0FBRztRQUNqQ00sV0FBV1gsTUFBQyxDQUFDSSxNQUFNLEdBQUdRLFFBQVE7UUFDOUJDLE1BQU1iLE1BQUMsQ0FBQ0ksTUFBTSxHQUFHQyxHQUFHLENBQUMsR0FBRztRQUN4QlMsT0FBT2QsTUFBQyxDQUFDSSxNQUFNLEdBQUdDLEdBQUcsQ0FBQyxH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