eb33b0b3bb44bba3ef4f40a3d3035365
/**
 * API para obtener detalles específicos de una ruta asignada al driver
 * GET /api/driver/routes/[id]
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get GET () {
        return GET;
    },
    get PUT () {
        return PUT;
    }
});
const _server = require("next/server");
const _auth = require("../../../../../auth");
const _server1 = require("../../../../../lib/integrations/supabase/server");
async function GET(request, { params }) {
    try {
        const routeId = params.id;
        // Para pruebas, devolver datos de ejemplo
        const routeData = {
            id: routeId,
            name: `Ruta de Entrega #${routeId}`,
            total_distance: 35.6,
            estimated_time: 2640,
            status: 'active',
            shipments: [
                {
                    id: routeId,
                    orderNumber: `#${routeId}`,
                    tracking_number: `TRK-${routeId}`,
                    customer_name: 'Cliente de Prueba',
                    customer_phone: '+54 351 123-4567',
                    destination: {
                        address: 'Av. Colón 1234, Piso 2, Depto A, Córdoba, Córdoba 5000',
                        city: 'Córdoba',
                        postal_code: '5000',
                        coordinates: {
                            lat: -31.4084841,
                            lng: -64.1917654
                        }
                    },
                    items: [
                        {
                            name: 'Producto de Prueba',
                            quantity: 1,
                            weight: 1
                        }
                    ],
                    status: 'confirmed',
                    estimated_delivery_time: '14:00 - 18:00',
                    requires_signature: false
                }
            ],
            waypoints: [
                {
                    lat: -31.4084841,
                    lng: -64.1917654
                }
            ],
            driver: {
                id: 'driver-1',
                name: 'Santiago Martinez'
            },
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
        };
        return _server.NextResponse.json(routeData);
    } catch (error) {
        console.error('Error in driver route API:', error);
        return _server.NextResponse.json({
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}
async function PUT(request, { params }) {
    try {
        // Verificar autenticación
        const session = await (0, _auth.auth)();
        if (!session?.user?.email) {
            return _server.NextResponse.json({
                error: 'No autorizado'
            }, {
                status: 401
            });
        }
        const routeId = params.id;
        const body = await request.json();
        const { status, shipments, current_shipment_index } = body;
        const supabase = await (0, _server1.createClient)();
        // Obtener información del driver
        const { data: driver, error: driverError } = await supabase.from('drivers').select('id').eq('email', session.user.email).single();
        if (driverError || !driver) {
            return _server.NextResponse.json({
                error: 'Driver no encontrado'
            }, {
                status: 404
            });
        }
        // Actualizar la ruta
        const updateData = {
            updated_at: new Date().toISOString()
        };
        if (status) updateData.status = status;
        if (shipments) updateData.shipments = shipments;
        const { data: updatedRoute, error: updateError } = await supabase.from('optimized_routes').update(updateData).eq('id', routeId).eq('driver_id', driver.id).select().single();
        if (updateError) {
            console.error('Error updating route:', updateError);
            return _server.NextResponse.json({
                error: 'Error actualizando ruta'
            }, {
                status: 500
            });
        }
        return _server.NextResponse.json(updatedRoute);
    } catch (error) {
        console.error('Error in driver route update API:', error);
        return _server.NextResponse.json({
            error: 'Error interno del servidor'
        }, {
            status: 500
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcYXBwXFxhcGlcXGRyaXZlclxccm91dGVzXFxbaWRdXFxyb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFQSSBwYXJhIG9idGVuZXIgZGV0YWxsZXMgZXNwZWPDrWZpY29zIGRlIHVuYSBydXRhIGFzaWduYWRhIGFsIGRyaXZlclxuICogR0VUIC9hcGkvZHJpdmVyL3JvdXRlcy9baWRdXG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgYXV0aCB9IGZyb20gJ0AvYXV0aCdcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0AvbGliL2ludGVncmF0aW9ucy9zdXBhYmFzZS9zZXJ2ZXInXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QsIHsgcGFyYW1zIH06IHsgcGFyYW1zOiB7IGlkOiBzdHJpbmcgfSB9KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgcm91dGVJZCA9IHBhcmFtcy5pZFxuXG4gICAgLy8gUGFyYSBwcnVlYmFzLCBkZXZvbHZlciBkYXRvcyBkZSBlamVtcGxvXG4gICAgY29uc3Qgcm91dGVEYXRhID0ge1xuICAgICAgaWQ6IHJvdXRlSWQsXG4gICAgICBuYW1lOiBgUnV0YSBkZSBFbnRyZWdhICMke3JvdXRlSWR9YCxcbiAgICAgIHRvdGFsX2Rpc3RhbmNlOiAzNS42LFxuICAgICAgZXN0aW1hdGVkX3RpbWU6IDI2NDAsIC8vIDQ0IG1pbnV0b3MgZW4gc2VndW5kb3NcbiAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICBzaGlwbWVudHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiByb3V0ZUlkLFxuICAgICAgICAgIG9yZGVyTnVtYmVyOiBgIyR7cm91dGVJZH1gLFxuICAgICAgICAgIHRyYWNraW5nX251bWJlcjogYFRSSy0ke3JvdXRlSWR9YCxcbiAgICAgICAgICBjdXN0b21lcl9uYW1lOiAnQ2xpZW50ZSBkZSBQcnVlYmEnLFxuICAgICAgICAgIGN1c3RvbWVyX3Bob25lOiAnKzU0IDM1MSAxMjMtNDU2NycsXG4gICAgICAgICAgZGVzdGluYXRpb246IHtcbiAgICAgICAgICAgIGFkZHJlc3M6ICdBdi4gQ29sw7NuIDEyMzQsIFBpc28gMiwgRGVwdG8gQSwgQ8OzcmRvYmEsIEPDs3Jkb2JhIDUwMDAnLFxuICAgICAgICAgICAgY2l0eTogJ0PDs3Jkb2JhJyxcbiAgICAgICAgICAgIHBvc3RhbF9jb2RlOiAnNTAwMCcsXG4gICAgICAgICAgICBjb29yZGluYXRlczoge1xuICAgICAgICAgICAgICBsYXQ6IC0zMS40MDg0ODQxLFxuICAgICAgICAgICAgICBsbmc6IC02NC4xOTE3NjU0LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdQcm9kdWN0byBkZSBQcnVlYmEnLFxuICAgICAgICAgICAgICBxdWFudGl0eTogMSxcbiAgICAgICAgICAgICAgd2VpZ2h0OiAxLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIHN0YXR1czogJ2NvbmZpcm1lZCcsXG4gICAgICAgICAgZXN0aW1hdGVkX2RlbGl2ZXJ5X3RpbWU6ICcxNDowMCAtIDE4OjAwJyxcbiAgICAgICAgICByZXF1aXJlc19zaWduYXR1cmU6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHdheXBvaW50czogW1xuICAgICAgICB7XG4gICAgICAgICAgbGF0OiAtMzEuNDA4NDg0MSxcbiAgICAgICAgICBsbmc6IC02NC4xOTE3NjU0LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIGRyaXZlcjoge1xuICAgICAgICBpZDogJ2RyaXZlci0xJyxcbiAgICAgICAgbmFtZTogJ1NhbnRpYWdvIE1hcnRpbmV6JyxcbiAgICAgIH0sXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJvdXRlRGF0YSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBkcml2ZXIgcm91dGUgQVBJOicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3InIH0sIHsgc3RhdHVzOiA1MDAgfSlcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUFVUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0LCB7IHBhcmFtcyB9OiB7IHBhcmFtczogeyBpZDogc3RyaW5nIH0gfSkge1xuICB0cnkge1xuICAgIC8vIFZlcmlmaWNhciBhdXRlbnRpY2FjacOzblxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoKClcblxuICAgIGlmICghc2Vzc2lvbj8udXNlcj8uZW1haWwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTm8gYXV0b3JpemFkbycgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgIH1cblxuICAgIGNvbnN0IHJvdXRlSWQgPSBwYXJhbXMuaWRcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcbiAgICBjb25zdCB7IHN0YXR1cywgc2hpcG1lbnRzLCBjdXJyZW50X3NoaXBtZW50X2luZGV4IH0gPSBib2R5XG5cbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpXG5cbiAgICAvLyBPYnRlbmVyIGluZm9ybWFjacOzbiBkZWwgZHJpdmVyXG4gICAgY29uc3QgeyBkYXRhOiBkcml2ZXIsIGVycm9yOiBkcml2ZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdkcml2ZXJzJylcbiAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgIC5lcSgnZW1haWwnLCBzZXNzaW9uLnVzZXIuZW1haWwpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmIChkcml2ZXJFcnJvciB8fCAhZHJpdmVyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0RyaXZlciBubyBlbmNvbnRyYWRvJyB9LCB7IHN0YXR1czogNDA0IH0pXG4gICAgfVxuXG4gICAgLy8gQWN0dWFsaXphciBsYSBydXRhXG4gICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge1xuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH1cblxuICAgIGlmIChzdGF0dXMpIHVwZGF0ZURhdGEuc3RhdHVzID0gc3RhdHVzXG4gICAgaWYgKHNoaXBtZW50cykgdXBkYXRlRGF0YS5zaGlwbWVudHMgPSBzaGlwbWVudHNcblxuICAgIGNvbnN0IHsgZGF0YTogdXBkYXRlZFJvdXRlLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnb3B0aW1pemVkX3JvdXRlcycpXG4gICAgICAudXBkYXRlKHVwZGF0ZURhdGEpXG4gICAgICAuZXEoJ2lkJywgcm91dGVJZClcbiAgICAgIC5lcSgnZHJpdmVyX2lkJywgZHJpdmVyLmlkKVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmICh1cGRhdGVFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcm91dGU6JywgdXBkYXRlRXJyb3IpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0Vycm9yIGFjdHVhbGl6YW5kbyBydXRhJyB9LCB7IHN0YXR1czogNTAwIH0pXG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHVwZGF0ZWRSb3V0ZSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBkcml2ZXIgcm91dGUgdXBkYXRlIEFQSTonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0Vycm9yIGludGVybm8gZGVsIHNlcnZpZG9yJyB9LCB7IHN0YXR1czogNTAwIH0pXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJHRVQiLCJQVVQiLCJyZXF1ZXN0IiwicGFyYW1zIiwicm91dGVJZCIsImlkIiwicm91dGVEYXRhIiwibmFtZSIsInRvdGFsX2Rpc3RhbmNlIiwiZXN0aW1hdGVkX3RpbWUiLCJzdGF0dXMiLCJzaGlwbWVudHMiLCJvcmRlck51bWJlciIsInRyYWNraW5nX251bWJlciIsImN1c3RvbWVyX25hbWUiLCJjdXN0b21lcl9waG9uZSIsImRlc3RpbmF0aW9uIiwiYWRkcmVzcyIsImNpdHkiLCJwb3N0YWxfY29kZSIsImNvb3JkaW5hdGVzIiwibGF0IiwibG5nIiwiaXRlbXMiLCJxdWFudGl0eSIsIndlaWdodCIsImVzdGltYXRlZF9kZWxpdmVyeV90aW1lIiwicmVxdWlyZXNfc2lnbmF0dXJlIiwid2F5cG9pbnRzIiwiZHJpdmVyIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInVwZGF0ZWRfYXQiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwiZXJyb3IiLCJjb25zb2xlIiwic2Vzc2lvbiIsImF1dGgiLCJ1c2VyIiwiZW1haWwiLCJib2R5IiwiY3VycmVudF9zaGlwbWVudF9pbmRleCIsInN1cGFiYXNlIiwiY3JlYXRlQ2xpZW50IiwiZGF0YSIsImRyaXZlckVycm9yIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwidXBkYXRlRGF0YSIsInVwZGF0ZWRSb3V0ZSIsInVwZGF0ZUVycm9yIiwidXBkYXRlIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0M7Ozs7Ozs7Ozs7O1FBTXFCQTtl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