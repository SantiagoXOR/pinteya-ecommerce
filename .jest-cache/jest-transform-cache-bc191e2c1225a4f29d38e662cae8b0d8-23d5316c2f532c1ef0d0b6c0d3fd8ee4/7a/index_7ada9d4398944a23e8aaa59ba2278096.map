{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\components\\Common\\CartSidebarModal\\index.tsx"],"sourcesContent":["'use client'\nimport React, { useEffect, useState } from 'react'\n\nimport { useCartModalContext } from '@/app/context/CartSidebarModalContext'\nimport { selectTotalPrice } from '@/redux/features/cart-slice'\nimport { useAppSelector } from '@/redux/store'\nimport { useSelector } from 'react-redux'\nimport SingleItem from './SingleItem'\nimport Link from 'next/link'\nimport EmptyCart from './EmptyCart'\nimport ShippingProgressBar from '@/components/ui/shipping-progress-bar'\nimport Image from 'next/image'\nimport CheckoutTransitionAnimation from '@/components/ui/checkout-transition-animation'\nimport useCheckoutTransition from '@/hooks/useCheckoutTransition'\nimport { useCartWithBackend } from '@/hooks/useCartWithBackend'\n\nconst CartSidebarModal = () => {\n  const { isCartModalOpen, closeCartModal } = useCartModalContext()\n  const cartItems = useAppSelector(state => state.cartReducer.items)\n\n  // Hook para carrito con backend\n  const {\n    items: backendCartItems,\n    totalItems: backendTotalItems,\n    totalAmount: backendTotalAmount,\n    loading: cartLoading,\n  } = useCartWithBackend()\n\n  const totalPrice = useSelector(selectTotalPrice)\n\n  // Usar carrito del backend si está disponible, sino usar Redux\n  const effectiveCartItems = backendCartItems.length > 0 ? backendCartItems : cartItems\n  const effectiveTotalPrice = backendCartItems.length > 0 ? backendTotalAmount : totalPrice\n  const hasItems = effectiveCartItems.length > 0\n\n  // Hook para manejar la animación de transición al checkout\n  const { isTransitioning, startTransition, skipAnimation, isButtonDisabled } =\n    useCheckoutTransition({\n      onTransitionStart: () => {\n        // Cerrar el modal con animación de deslizamiento\n        closeCartModal()\n      },\n      onTransitionComplete: () => {\n        // La navegación se maneja automáticamente en el componente de animación\n      },\n    })\n\n  useEffect(() => {\n    // closing modal while clicking outside\n    function handleClickOutside(event: MouseEvent) {\n      if (event.target && !(event.target as Element).closest('.modal-content')) {\n        closeCartModal()\n      }\n    }\n\n    if (isCartModalOpen) {\n      document.addEventListener('mousedown', handleClickOutside)\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [isCartModalOpen, closeCartModal])\n\n  return (\n    <div\n      className={`fixed top-0 left-0 z-99999 overflow-y-auto no-scrollbar w-full h-screen bg-dark/70 transition-all duration-500 ease-out ${\n        isCartModalOpen ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'\n      }`}\n    >\n      <div className='flex items-center justify-end'>\n        <div\n          className={`w-full max-w-[500px] shadow-1 bg-white px-4 sm:px-7.5 lg:px-11 relative modal-content transition-transform duration-500 ease-out ${\n            isCartModalOpen ? 'translate-x-0' : 'translate-x-full'\n          }`}\n        >\n          <div className='sticky top-0 bg-white z-20 flex items-center justify-between py-4 border-b border-gray-200 shadow-sm'>\n            <div className='flex items-center gap-3'>\n              <div className='bg-gradient-to-r from-orange-500 to-yellow-500 p-2 rounded-full'>\n                <svg className='w-5 h-5 text-white' fill='currentColor' viewBox='0 0 20 20'>\n                  <path d='M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z' />\n                </svg>\n              </div>\n              <div>\n                <h2 className='font-bold text-lg' style={{ color: '#ea5a17' }}>\n                  🛒 Tu Selección\n                </h2>\n                <p className='text-xs text-gray-500'>\n                  {cartItems.length} {cartItems.length === 1 ? 'producto' : 'productos'} listos\n                </p>\n              </div>\n            </div>\n            <button\n              onClick={() => closeCartModal()}\n              aria-label='Cerrar carrito'\n              className='flex items-center justify-center p-2 rounded-full hover:bg-gray-100 transition-colors duration-150'\n            >\n              <svg\n                className='w-6 h-6 text-gray-400 hover:text-gray-600'\n                fill='none'\n                stroke='currentColor'\n                viewBox='0 0 24 24'\n              >\n                <path\n                  strokeLinecap='round'\n                  strokeLinejoin='round'\n                  strokeWidth={2}\n                  d='M6 18L18 6M6 6l12 12'\n                />\n              </svg>\n            </button>\n          </div>\n\n          <div className='flex-1 overflow-y-auto no-scrollbar pt-4'>\n            <div className='flex flex-col gap-4 px-1'>\n              {/* <!-- cart item --> */}\n              {cartItems.length > 0 ? (\n                cartItems.map((item: any, key: number) => <SingleItem key={key} item={item} />)\n              ) : (\n                <EmptyCart />\n              )}\n            </div>\n          </div>\n\n          <div className='border-t border-gray-200 bg-white pt-3 pb-3 mt-4 sticky bottom-0'>\n            {/* Barra de Progreso Envío Gratis */}\n            {cartItems.length > 0 && (\n              <div className='mb-3'>\n                <ShippingProgressBar currentAmount={totalPrice} variant='compact' />\n              </div>\n            )}\n\n            {/* Subtotal */}\n            <div className='flex items-center justify-between gap-3 mb-3'>\n              <p className='font-bold text-lg text-gray-900'>Subtotal:</p>\n              <p className='font-bold text-lg' style={{ color: '#ea5a17' }}>\n                ${totalPrice.toLocaleString()}\n              </p>\n            </div>\n\n            {/* Información de pago */}\n            <div className='space-y-2'>\n              {/* Línea informativa de MercadoPago - 150px */}\n              <div className='w-full flex items-center justify-center gap-2 py-1 px-2 text-sm text-gray-600'>\n                <Image\n                  src='/images/logo/MercadoPagoLogos/SVGs/MP_RGB_HANDSHAKE_color_horizontal.svg'\n                  alt='MercadoPago'\n                  width={150}\n                  height={48}\n                  className='w-auto h-auto max-w-[150px]'\n                />\n                <span className='font-medium'>Pago seguro</span>\n              </div>\n\n              {/* Botón principal de checkout */}\n              <button\n                onClick={startTransition}\n                disabled={isButtonDisabled || !hasItems || cartLoading}\n                data-testid='checkout-btn'\n                className={`w-full flex justify-center font-bold text-black bg-yellow-400 hover:bg-yellow-500 py-3 px-4 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl ${\n                  isButtonDisabled || !hasItems || cartLoading\n                    ? 'opacity-50 cursor-not-allowed'\n                    : 'hover:scale-105 active:scale-95'\n                }`}\n              >\n                {cartLoading\n                  ? 'Cargando carrito...'\n                  : isButtonDisabled\n                    ? 'Procesando...'\n                    : 'Finalizar Compra'}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Componente de animación de transición */}\n      <CheckoutTransitionAnimation\n        isActive={isTransitioning}\n        skipAnimation={skipAnimation}\n        onComplete={() => {\n          // Callback adicional si es necesario\n        }}\n      />\n    </div>\n  )\n}\n\nexport default CartSidebarModal\n"],"names":["CartSidebarModal","isCartModalOpen","closeCartModal","useCartModalContext","cartItems","useAppSelector","state","cartReducer","items","backendCartItems","totalItems","backendTotalItems","totalAmount","backendTotalAmount","loading","cartLoading","useCartWithBackend","totalPrice","useSelector","selectTotalPrice","effectiveCartItems","length","effectiveTotalPrice","hasItems","isTransitioning","startTransition","skipAnimation","isButtonDisabled","useCheckoutTransition","onTransitionStart","onTransitionComplete","useEffect","handleClickOutside","event","target","closest","document","addEventListener","removeEventListener","div","className","svg","fill","viewBox","path","d","h2","style","color","p","button","onClick","aria-label","stroke","strokeLinecap","strokeLinejoin","strokeWidth","map","item","key","SingleItem","EmptyCart","ShippingProgressBar","currentAmount","variant","toLocaleString","Image","src","alt","width","height","span","disabled","data-testid","CheckoutTransitionAnimation","isActive","onComplete"],"mappings":"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"}