{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\components\\OrderListEnterprise-circular-deps.test.tsx"],"sourcesContent":["// ===================================\n// PINTEYA E-COMMERCE - CIRCULAR DEPENDENCIES TEST\n// Pruebas específicas para verificar que no hay dependencias circulares\n// ===================================\n\nimport React from 'react'\nimport { render, screen, fireEvent, waitFor, act } from '@testing-library/react'\nimport { describe, it, expect, beforeEach, afterEach } from '@jest/globals'\nimport { jest } from '@jest/globals'\nimport { OrderListEnterprise } from '@/components/admin/orders/OrderListEnterprise'\n\n// ===================================\n// MOCKS\n// ===================================\n\nconst mockFetch = jest.fn()\nglobal.fetch = mockFetch\n\nconst mockToast = jest.fn()\njest.mock('@/hooks/use-toast', () => ({\n  useToast: () => ({ toast: mockToast }),\n}))\n\n// Mock de performance para monitoreo\nconst mockPerformanceNow = jest.fn()\nObject.defineProperty(global, 'performance', {\n  value: { now: mockPerformanceNow },\n  writable: true,\n})\n\n// Mock de console para capturar renders excesivos\nconst mockConsoleWarn = jest.spyOn(console, 'warn').mockImplementation(() => {})\nconst mockConsoleLog = jest.spyOn(console, 'log').mockImplementation(() => {})\n\n// Datos de prueba\nconst mockOrder = {\n  id: 'order-123',\n  order_number: 'ORD-2024-001',\n  status: 'pending',\n  payment_status: 'pending',\n  fulfillment_status: 'pending',\n  total_amount: 15000,\n  created_at: '2024-01-01T10:00:00Z',\n  updated_at: '2024-01-01T10:00:00Z',\n  customer_id: 'customer-123',\n  customer_name: 'Juan Pérez',\n  customer_email: 'juan@example.com',\n}\n\nconst mockApiResponse = {\n  success: true,\n  data: {\n    orders: [mockOrder],\n    pagination: {\n      page: 1,\n      limit: 20,\n      total: 1,\n      totalPages: 1,\n      hasNextPage: false,\n      hasPreviousPage: false,\n    },\n    analytics: {\n      total_orders: 1,\n      total_revenue: 15000,\n      pending_orders: 1,\n      completed_orders: 0,\n    },\n  },\n  message: 'Orders retrieved successfully',\n  timestamp: new Date().toISOString(),\n}\n\n// ===================================\n// SETUP Y CLEANUP\n// ===================================\n\nbeforeEach(() => {\n  jest.clearAllMocks()\n  mockPerformanceNow.mockReturnValue(1000)\n\n  mockFetch.mockResolvedValue({\n    ok: true,\n    status: 200,\n    json: async () => mockApiResponse,\n  })\n})\n\nafterEach(() => {\n  jest.clearAllTimers()\n})\n\n// ===================================\n// TESTS DE DEPENDENCIAS CIRCULARES\n// ===================================\n\ndescribe('OrderListEnterprise - Circular Dependencies', () => {\n  it('no debe tener renders infinitos al cambiar filtros', async () => {\n    jest.useFakeTimers()\n\n    // Contador de renders\n    let renderCount = 0\n    const TestWrapper = () => {\n      renderCount++\n      return <OrderListEnterprise />\n    }\n\n    render(<TestWrapper />)\n\n    // Esperar carga inicial\n    await waitFor(() => {\n      expect(screen.getByText('ORD-2024-001')).toBeInTheDocument()\n    })\n\n    const initialRenderCount = renderCount\n\n    // Cambiar filtro de estado\n    const statusFilter = screen.getByDisplayValue('all')\n\n    act(() => {\n      fireEvent.change(statusFilter, { target: { value: 'pending' } })\n    })\n\n    // Avanzar timers para que se ejecute el debouncing\n    act(() => {\n      jest.advanceTimersByTime(500)\n    })\n\n    // Esperar que se complete la petición\n    await waitFor(() => {\n      expect(mockFetch).toHaveBeenCalledTimes(2) // Initial + filter change\n    })\n\n    // Verificar que no hay renders excesivos\n    const finalRenderCount = renderCount\n    const renderDifference = finalRenderCount - initialRenderCount\n\n    // Permitir algunos renders normales (cambio de filtro + loading + resultado)\n    // pero no más de 10 renders por cambio de filtro\n    expect(renderDifference).toBeLessThan(10)\n\n    jest.useRealTimers()\n  })\n\n  it('no debe hacer peticiones duplicadas al cambiar filtros rápidamente', async () => {\n    jest.useFakeTimers()\n\n    render(<OrderListEnterprise />)\n\n    // Esperar carga inicial\n    await waitFor(() => {\n      expect(screen.getByText('ORD-2024-001')).toBeInTheDocument()\n    })\n\n    const initialCallCount = mockFetch.mock.calls.length\n\n    // Cambiar filtros múltiples veces rápidamente\n    const statusFilter = screen.getByDisplayValue('all')\n\n    act(() => {\n      fireEvent.change(statusFilter, { target: { value: 'pending' } })\n      fireEvent.change(statusFilter, { target: { value: 'confirmed' } })\n      fireEvent.change(statusFilter, { target: { value: 'shipped' } })\n    })\n\n    // Avanzar timers para que se ejecute el debouncing\n    act(() => {\n      jest.advanceTimersByTime(500)\n    })\n\n    // Esperar que se complete la petición\n    await waitFor(() => {\n      expect(mockFetch.mock.calls.length).toBeGreaterThan(initialCallCount)\n    })\n\n    // Verificar que solo se hizo una petición adicional (debouncing funcionando)\n    const finalCallCount = mockFetch.mock.calls.length\n    const callDifference = finalCallCount - initialCallCount\n\n    // Debería ser solo 1 petición adicional debido al debouncing\n    expect(callDifference).toBeLessThanOrEqual(2)\n\n    jest.useRealTimers()\n  })\n\n  it('no debe tener memory leaks en cambios de filtros', async () => {\n    jest.useFakeTimers()\n\n    const { unmount } = render(<OrderListEnterprise />)\n\n    // Esperar carga inicial\n    await waitFor(() => {\n      expect(screen.getByText('ORD-2024-001')).toBeInTheDocument()\n    })\n\n    // Cambiar filtros varias veces\n    const statusFilter = screen.getByDisplayValue('all')\n\n    for (let i = 0; i < 5; i++) {\n      act(() => {\n        fireEvent.change(statusFilter, { target: { value: i % 2 === 0 ? 'pending' : 'confirmed' } })\n      })\n\n      act(() => {\n        jest.advanceTimersByTime(100)\n      })\n    }\n\n    // Avanzar timers finales\n    act(() => {\n      jest.advanceTimersByTime(500)\n    })\n\n    // Desmontar componente\n    unmount()\n\n    // Verificar que no hay warnings de memory leaks\n    expect(mockConsoleWarn).not.toHaveBeenCalledWith(expect.stringContaining('memory leak'))\n\n    jest.useRealTimers()\n  })\n\n  it('debe manejar correctamente el cleanup de timers', async () => {\n    jest.useFakeTimers()\n\n    const { unmount } = render(<OrderListEnterprise />)\n\n    // Esperar carga inicial\n    await waitFor(() => {\n      expect(screen.getByText('ORD-2024-001')).toBeInTheDocument()\n    })\n\n    // Cambiar filtro para activar debouncing\n    const statusFilter = screen.getByDisplayValue('all')\n\n    act(() => {\n      fireEvent.change(statusFilter, { target: { value: 'pending' } })\n    })\n\n    // Desmontar antes de que se complete el debouncing\n    unmount()\n\n    // Avanzar timers después del desmontaje\n    act(() => {\n      jest.advanceTimersByTime(500)\n    })\n\n    // No debería haber errores o warnings sobre timers no limpiados\n    expect(mockConsoleWarn).not.toHaveBeenCalledWith(expect.stringContaining('timer'))\n\n    jest.useRealTimers()\n  })\n\n  it('debe mantener performance estable con múltiples cambios de filtros', async () => {\n    jest.useFakeTimers()\n\n    render(<OrderListEnterprise />)\n\n    // Esperar carga inicial\n    await waitFor(() => {\n      expect(screen.getByText('ORD-2024-001')).toBeInTheDocument()\n    })\n\n    const startTime = performance.now()\n\n    // Simular múltiples cambios de filtros\n    const statusFilter = screen.getByDisplayValue('all')\n\n    for (let i = 0; i < 10; i++) {\n      act(() => {\n        fireEvent.change(statusFilter, {\n          target: { value: ['pending', 'confirmed', 'shipped'][i % 3] },\n        })\n      })\n\n      act(() => {\n        jest.advanceTimersByTime(50)\n      })\n    }\n\n    // Avanzar timers finales\n    act(() => {\n      jest.advanceTimersByTime(500)\n    })\n\n    const endTime = performance.now()\n    const duration = endTime - startTime\n\n    // La operación no debería tomar más de 1 segundo (muy generoso)\n    expect(duration).toBeLessThan(1000)\n\n    jest.useRealTimers()\n  })\n})\n"],"names":["mockFetch","jest","fn","global","fetch","mockToast","mock","useToast","toast","mockPerformanceNow","Object","defineProperty","value","now","writable","mockConsoleWarn","spyOn","console","mockImplementation","mockConsoleLog","mockOrder","id","order_number","status","payment_status","fulfillment_status","total_amount","created_at","updated_at","customer_id","customer_name","customer_email","mockApiResponse","success","data","orders","pagination","page","limit","total","totalPages","hasNextPage","hasPreviousPage","analytics","total_orders","total_revenue","pending_orders","completed_orders","message","timestamp","Date","toISOString","beforeEach","clearAllMocks","mockReturnValue","mockResolvedValue","ok","json","afterEach","clearAllTimers","describe","it","useFakeTimers","renderCount","TestWrapper","OrderListEnterprise","render","waitFor","expect","screen","getByText","toBeInTheDocument","initialRenderCount","statusFilter","getByDisplayValue","act","fireEvent","change","target","advanceTimersByTime","toHaveBeenCalledTimes","finalRenderCount","renderDifference","toBeLessThan","useRealTimers","initialCallCount","calls","length","toBeGreaterThan","finalCallCount","callDifference","toBeLessThanOrEqual","unmount","i","not","toHaveBeenCalledWith","stringContaining","startTime","performance","endTime","duration"],"mappings":"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"}