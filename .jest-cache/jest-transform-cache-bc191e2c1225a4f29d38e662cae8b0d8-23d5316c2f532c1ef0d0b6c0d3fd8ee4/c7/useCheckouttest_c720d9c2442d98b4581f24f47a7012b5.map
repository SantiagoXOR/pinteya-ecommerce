{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\hooks\\useCheckout.test.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - TEST useCheckout HOOK\r\n// ===================================\r\n\r\nimport React from 'react'\r\nimport { renderHook, act } from '@testing-library/react'\r\nimport { Provider } from 'react-redux'\r\nimport { configureStore } from '@reduxjs/toolkit'\r\nimport { useCheckout } from '@/hooks/useCheckout'\r\nimport cartReducer from '@/redux/features/cart-slice'\r\n\r\n// Mock useAuth hook\r\njest.mock('@/hooks/useAuth', () => ({\r\n  useAuth: () => ({\r\n    user: null,\r\n    isLoaded: true,\r\n  }),\r\n}))\r\n\r\n// Mock data\r\nconst mockCartItems = [\r\n  {\r\n    id: 1,\r\n    title: 'Test Product 1',\r\n    price: 1000,\r\n    discountedPrice: 900,\r\n    quantity: 2,\r\n  },\r\n  {\r\n    id: 2,\r\n    title: 'Test Product 2',\r\n    price: 2000,\r\n    discountedPrice: 2000,\r\n    quantity: 1,\r\n  },\r\n]\r\n\r\n// Mock store setup\r\nconst createMockStore = (initialState = {}) => {\r\n  return configureStore({\r\n    reducer: {\r\n      cartReducer: cartReducer,\r\n    },\r\n    preloadedState: {\r\n      cartReducer: {\r\n        items: mockCartItems,\r\n        ...initialState.cartReducer,\r\n      },\r\n    },\r\n  })\r\n}\r\n\r\n// Mock fetch\r\nconst mockFetch = jest.fn()\r\nglobal.fetch = mockFetch\r\n\r\n// Mock NextAuth\r\n// NextAuth se mockea automáticamente via moduleNameMapper\r\n\r\n// Helper function to render hook with Redux store\r\nconst renderHookWithStore = (initialState = {}) => {\r\n  const store = createMockStore(initialState)\r\n  const wrapper = ({ children }: { children: React.ReactNode }) =>\r\n    React.createElement(Provider, { store }, children)\r\n\r\n  return {\r\n    ...renderHook(() => useCheckout(), { wrapper }),\r\n    store,\r\n  }\r\n}\r\n\r\ndescribe('useCheckout Hook', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks()\r\n\r\n    // Mock successful payment preference creation\r\n    mockFetch.mockResolvedValue({\r\n      ok: true,\r\n      json: async () => ({\r\n        success: true,\r\n        data: {\r\n          init_point: 'https://mercadopago.com/checkout/test',\r\n          preference_id: 'test-preference-id',\r\n        },\r\n      }),\r\n    })\r\n  })\r\n\r\n  it('initializes with correct default state', () => {\r\n    const { result } = renderHookWithStore()\r\n\r\n    expect(result.current.isLoading).toBe(false)\r\n    expect(result.current.errors).toEqual({})\r\n    expect(result.current.step).toBe('form')\r\n  })\r\n\r\n  it('updates billing data correctly', () => {\r\n    const { result } = renderHookWithStore()\r\n\r\n    act(() => {\r\n      result.current.updateBillingData({\r\n        firstName: 'Juan',\r\n        lastName: 'Pérez',\r\n        email: 'juan@test.com',\r\n      })\r\n    })\r\n\r\n    expect(result.current.formData.billing.firstName).toBe('Juan')\r\n    expect(result.current.formData.billing.lastName).toBe('Pérez')\r\n    expect(result.current.formData.billing.email).toBe('juan@test.com')\r\n  })\r\n\r\n  it('calculates shipping cost correctly', () => {\r\n    const { result } = renderHookWithStore()\r\n\r\n    // Test free shipping\r\n    expect(result.current.shippingCost).toBeGreaterThanOrEqual(0)\r\n  })\r\n\r\n  it('validates form correctly', () => {\r\n    const { result } = renderHookWithStore();\r\n\r\n    act(() => {\r\n      const isValid = result.current.validateForm();\r\n      expect(isValid).toBe(false);\r\n    });\r\n\r\n    // Verificar que los errores se establecieron correctamente\r\n    expect(result.current.errors.firstName).toBe('Nombre es requerido');\r\n    expect(result.current.errors.email).toBe('Email es requerido');\r\n  });\r\n\r\n  it('calculates total correctly', () => {\r\n    const { result } = renderHookWithStore()\r\n\r\n    expect(result.current.finalTotal).toBeGreaterThan(0)\r\n    expect(typeof result.current.finalTotal).toBe('number')\r\n  })\r\n})\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["jest","mock","useAuth","user","isLoaded","mockCartItems","id","title","price","discountedPrice","quantity","createMockStore","initialState","configureStore","reducer","cartReducer","preloadedState","items","mockFetch","fn","global","fetch","renderHookWithStore","store","wrapper","children","React","createElement","Provider","renderHook","useCheckout","describe","beforeEach","clearAllMocks","mockResolvedValue","ok","json","success","data","init_point","preference_id","it","result","expect","current","isLoading","toBe","errors","toEqual","step","act","updateBillingData","firstName","lastName","email","formData","billing","shippingCost","toBeGreaterThanOrEqual","isValid","validateForm","finalTotal","toBeGreaterThan"],"mappings":"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"}