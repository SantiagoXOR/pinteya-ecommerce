{"version":3,"names":["cov_2cvybq20zr","actualCoverage","s","GET","f","runtime","request","authResult","_adminauth","getAuthenticatedUser","userId","b","_server","NextResponse","json","success","error","migration","status","oldMethod","newMethod","note","clerkUserId","console","log","_supabase","supabaseAdmin","data","user","from","select","eq","single","debug","errorMessage","message","errorCode","code","found","Error"],"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\app\\api\\test-simple-user\\route.ts"],"sourcesContent":["// Configuraci√≥n para Node.js Runtime\r\nexport const runtime = 'nodejs';\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { supabaseAdmin } from '@/lib/integrations/supabase';\r\nimport { getAuthenticatedUser } from '@/lib/auth/admin-auth';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // MIGRADO: Usar getAuthenticatedUser en lugar de headers\r\n    const authResult = await getAuthenticatedUser(request);\r\n\r\n    if (!authResult.userId) {\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: authResult.error || 'Usuario no autenticado',\r\n        migration: {\r\n          status: 'MIGRATED',\r\n          oldMethod: 'headers x-clerk-user-id',\r\n          newMethod: 'getAuthenticatedUser()',\r\n          note: 'Ya no usa headers directamente'\r\n        }\r\n      }, { status: 401 });\r\n    }\r\n\r\n    const clerkUserId = authResult.userId;\r\n\r\n    console.log('üîç Test Simple User: Searching for user:', clerkUserId);\r\n\r\n    if (!supabaseAdmin) {\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: 'Supabase admin client not available'\r\n      }, { status: 500 });\r\n    }\r\n\r\n    // Consulta muy simple sin joins\r\n    const { data: user, error } = await supabaseAdmin\r\n      .from('user_profiles')\r\n      .select('id, clerk_user_id, email, role_id, is_active')\r\n      .eq('clerk_user_id', clerkUserId)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error('üîç Test Simple User: Error:', error);\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: 'Database error',\r\n        debug: {\r\n          clerkUserId,\r\n          errorMessage: error.message,\r\n          errorCode: error.code\r\n        }\r\n      }, { status: 500 });\r\n    }\r\n\r\n    if (!user) {\r\n      return NextResponse.json({\r\n        success: false,\r\n        error: 'User not found',\r\n        debug: {\r\n          clerkUserId\r\n        }\r\n      }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      user: user,\r\n      debug: {\r\n        clerkUserId,\r\n        found: true\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('üîç Test Simple User: Unexpected error:', error);\r\n    return NextResponse.json({\r\n      success: false,\r\n      error: 'Unexpected error',\r\n      debug: {\r\n        errorMessage: error instanceof Error ? error.message : 'Unknown error'\r\n      }\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]}