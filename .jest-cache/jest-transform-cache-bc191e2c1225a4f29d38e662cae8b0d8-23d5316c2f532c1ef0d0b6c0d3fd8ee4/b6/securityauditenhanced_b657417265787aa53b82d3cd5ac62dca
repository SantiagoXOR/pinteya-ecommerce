113064086a417793e5bef20a72f001d4
/**
 * Sistema de Auditoría de Seguridad Mejorado
 * Extiende el sistema base con análisis avanzado, alertas automáticas y reportes
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get DEFAULT_SECURITY_PATTERNS () {
        return DEFAULT_SECURITY_PATTERNS;
    },
    get analyzeSecurityPatterns () {
        return analyzeSecurityPatterns;
    },
    get cleanupOldSecurityEvents () {
        return cleanupOldSecurityEvents;
    },
    get exportSecurityEvents () {
        return exportSecurityEvents;
    },
    get generateSecurityReport () {
        return generateSecurityReport;
    },
    get getActiveSecurityAlerts () {
        return getActiveSecurityAlerts;
    },
    get getSecurityMetrics () {
        return getSecurityMetrics;
    },
    get markAlertAsFalsePositive () {
        return markAlertAsFalsePositive;
    },
    get resolveSecurityAlert () {
        return resolveSecurityAlert;
    },
    get runSecurityHealthCheck () {
        return runSecurityHealthCheck;
    },
    get startSecurityMonitoring () {
        return startSecurityMonitoring;
    },
    get stopSecurityMonitoring () {
        return stopSecurityMonitoring;
    },
    get updateSecurityAlert () {
        return updateSecurityAlert;
    }
});
const _supabase = require("../integrations/supabase");
const _securityaudit = require("./security-audit");
const _cachemanager = require("../cache-manager");
const DEFAULT_SECURITY_PATTERNS = [
    {
        id: 'brute_force_login',
        name: 'Ataque de Fuerza Bruta',
        description: 'Múltiples intentos de login fallidos desde la misma IP',
        severity: 'high',
        timeWindow: 15,
        threshold: 5,
        enabled: true,
        conditions: [
            {
                field: 'event_type',
                operator: 'equals',
                value: 'AUTH_FAILURE',
                weight: 1
            },
            {
                field: 'ip_address',
                operator: 'equals',
                value: 'same',
                weight: 1
            }
        ],
        actions: [
            {
                type: 'alert',
                parameters: {
                    notify_admins: true
                }
            },
            {
                type: 'log',
                parameters: {
                    severity: 'high'
                }
            }
        ]
    },
    {
        id: 'privilege_escalation',
        name: 'Escalación de Privilegios',
        description: 'Intento de acceso a recursos sin permisos suficientes',
        severity: 'critical',
        timeWindow: 60,
        threshold: 3,
        enabled: true,
        conditions: [
            {
                field: 'event_type',
                operator: 'equals',
                value: 'PERMISSION_DENIED',
                weight: 1
            },
            {
                field: 'event_category',
                operator: 'equals',
                value: 'authorization',
                weight: 1
            }
        ],
        actions: [
            {
                type: 'alert',
                parameters: {
                    notify_admins: true,
                    priority: 'high'
                }
            },
            {
                type: 'log',
                parameters: {
                    severity: 'critical'
                }
            }
        ]
    },
    {
        id: 'suspicious_data_access',
        name: 'Acceso Sospechoso a Datos',
        description: 'Acceso masivo a datos sensibles en corto período',
        severity: 'medium',
        timeWindow: 30,
        threshold: 10,
        enabled: true,
        conditions: [
            {
                field: 'event_type',
                operator: 'equals',
                value: 'DATA_ACCESS',
                weight: 1
            },
            {
                field: 'event_category',
                operator: 'equals',
                value: 'data_access',
                weight: 1
            }
        ],
        actions: [
            {
                type: 'alert',
                parameters: {
                    notify_admins: false
                }
            },
            {
                type: 'log',
                parameters: {
                    severity: 'medium'
                }
            }
        ]
    },
    {
        id: 'admin_action_burst',
        name: 'Ráfaga de Acciones Administrativas',
        description: 'Múltiples acciones administrativas en corto período',
        severity: 'medium',
        timeWindow: 10,
        threshold: 5,
        enabled: true,
        conditions: [
            {
                field: 'event_type',
                operator: 'equals',
                value: 'ADMIN_ACTION',
                weight: 1
            },
            {
                field: 'event_category',
                operator: 'equals',
                value: 'admin_operations',
                weight: 1
            }
        ],
        actions: [
            {
                type: 'alert',
                parameters: {
                    notify_admins: true
                }
            },
            {
                type: 'log',
                parameters: {
                    severity: 'medium'
                }
            }
        ]
    },
    {
        id: 'geographic_anomaly',
        name: 'Anomalía Geográfica',
        description: 'Acceso desde ubicaciones geográficas inusuales',
        severity: 'medium',
        timeWindow: 60,
        threshold: 2,
        enabled: true,
        conditions: [
            {
                field: 'event_type',
                operator: 'equals',
                value: 'AUTH_SUCCESS',
                weight: 1
            },
            {
                field: 'ip_address',
                operator: 'not_in',
                value: 'usual_locations',
                weight: 1
            }
        ],
        actions: [
            {
                type: 'alert',
                parameters: {
                    notify_user: true
                }
            },
            {
                type: 'log',
                parameters: {
                    severity: 'medium'
                }
            }
        ]
    }
];
async function analyzeSecurityPatterns(userId, timeWindowHours = 24) {
    try {
        console.log('[SECURITY] Iniciando análisis de patrones de seguridad');
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const timeThreshold = new Date(Date.now() - timeWindowHours * 60 * 60 * 1000).toISOString();
        const alerts = [];
        // Obtener eventos recientes
        let query = _supabase.supabaseAdmin.from('security_events').select('*').gte('timestamp', timeThreshold).order('timestamp', {
            ascending: false
        });
        if (userId) {
            query = query.eq('user_id', userId);
        }
        const { data: events, error } = await query;
        if (error) {
            throw new Error(`Error obteniendo eventos: ${error.message}`);
        }
        if (!events || events.length === 0) {
            return alerts;
        }
        // Analizar cada patrón
        for (const pattern of DEFAULT_SECURITY_PATTERNS){
            if (!pattern.enabled) {
                continue;
            }
            const patternAlerts = await detectPattern(pattern, events);
            alerts.push(...patternAlerts);
        }
        // Guardar alertas en base de datos
        if (alerts.length > 0) {
            const { error: insertError } = await _supabase.supabaseAdmin.from('security_alerts').insert(alerts);
            if (insertError) {
                console.error('[SECURITY] Error guardando alertas:', insertError);
            }
        }
        console.log(`[SECURITY] Análisis completado: ${alerts.length} alertas generadas`);
        return alerts;
    } catch (error) {
        console.error('[SECURITY] Error en análisis de patrones:', error);
        return [];
    }
}
/**
 * Detecta un patrón específico en los eventos
 */ async function detectPattern(pattern, events) {
    const alerts = [];
    const timeWindow = pattern.timeWindow * 60 * 1000; // convertir a ms
    // Agrupar eventos por usuario
    const eventsByUser = events.reduce((acc, event)=>{
        if (!acc[event.user_id]) {
            acc[event.user_id] = [];
        }
        acc[event.user_id].push(event);
        return acc;
    }, {});
    // Analizar cada usuario
    for (const [userId, userEvents] of Object.entries(eventsByUser)){
        const matchingEvents = userEvents.filter((event)=>matchesPatternConditions(event, pattern.conditions));
        if (matchingEvents.length < pattern.threshold) {
            continue;
        }
        // Verificar ventana de tiempo
        const sortedEvents = matchingEvents.sort((a, b)=>new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());
        for(let i = 0; i <= sortedEvents.length - pattern.threshold; i++){
            const windowStart = new Date(sortedEvents[i].timestamp).getTime();
            const windowEnd = windowStart + timeWindow;
            const eventsInWindow = sortedEvents.filter((event)=>{
                const eventTime = new Date(event.timestamp).getTime();
                return eventTime >= windowStart && eventTime <= windowEnd;
            });
            if (eventsInWindow.length >= pattern.threshold) {
                // Patrón detectado
                const alert = {
                    id: `${pattern.id}_${userId}_${Date.now()}`,
                    pattern_id: pattern.id,
                    user_id: userId,
                    severity: pattern.severity,
                    title: pattern.name,
                    description: `${pattern.description} - ${eventsInWindow.length} eventos detectados`,
                    event_count: eventsInWindow.length,
                    first_occurrence: eventsInWindow[0].timestamp,
                    last_occurrence: eventsInWindow[eventsInWindow.length - 1].timestamp,
                    status: 'open',
                    metadata: {
                        pattern_name: pattern.name,
                        events: eventsInWindow.map((e)=>e.id),
                        threshold: pattern.threshold,
                        time_window_minutes: pattern.timeWindow
                    }
                };
                alerts.push(alert);
                // Ejecutar acciones del patrón
                await executePatternActions(pattern.actions, alert, eventsInWindow);
                break; // Solo una alerta por patrón por usuario
            }
        }
    }
    return alerts;
}
/**
 * Verifica si un evento coincide con las condiciones del patrón
 */ function matchesPatternConditions(event, conditions) {
    return conditions.every((condition)=>{
        const eventValue = event[condition.field];
        switch(condition.operator){
            case 'equals':
                return eventValue === condition.value;
            case 'contains':
                return typeof eventValue === 'string' && eventValue.includes(condition.value);
            case 'greater_than':
                return Number(eventValue) > Number(condition.value);
            case 'less_than':
                return Number(eventValue) < Number(condition.value);
            case 'in':
                return Array.isArray(condition.value) && condition.value.includes(eventValue);
            case 'not_in':
                return Array.isArray(condition.value) && !condition.value.includes(eventValue);
            default:
                return false;
        }
    });
}
/**
 * Ejecuta las acciones definidas para un patrón
 */ async function executePatternActions(actions, alert, events) {
    for (const action of actions){
        try {
            switch(action.type){
                case 'log':
                    await (0, _securityaudit.logSecurityEvent)({
                        user_id: alert.user_id,
                        event_type: 'SUSPICIOUS_ACTIVITY',
                        event_category: 'suspicious_behavior',
                        severity: action.parameters?.severity || alert.severity,
                        description: `Patrón detectado: ${alert.title}`,
                        metadata: {
                            pattern_id: alert.pattern_id,
                            alert_id: alert.id,
                            event_count: alert.event_count,
                            ...action.parameters
                        }
                    });
                    break;
                case 'alert':
                    console.warn(`[SECURITY ALERT] ${alert.title} - Usuario: ${alert.user_id}`);
                    if (action.parameters?.notify_admins) {
                        // Aquí se podría integrar con un sistema de notificaciones
                        console.log('[SECURITY] Notificando a administradores...');
                    }
                    break;
                case 'block_user':
                    console.log(`[SECURITY] Bloqueando usuario: ${alert.user_id}`);
                    break;
                case 'invalidate_sessions':
                    console.log(`[SECURITY] Invalidando sesiones del usuario: ${alert.user_id}`);
                    break;
                default:
                    console.warn(`[SECURITY] Acción no reconocida: ${action.type}`);
            }
        } catch (error) {
            console.error(`[SECURITY] Error ejecutando acción ${action.type}:`, error);
        }
    }
}
async function getSecurityMetrics() {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const cache = _cachemanager.CacheManager.getInstance();
        const cacheKey = 'security_metrics';
        // Intentar obtener desde cache
        const cached = await cache.get(_cachemanager.CACHE_CONFIGS.USER_SESSION, cacheKey);
        if (cached) {
            return cached;
        }
        const now = new Date();
        const last24h = new Date(now.getTime() - 24 * 60 * 60 * 1000).toISOString();
        // Obtener eventos de las últimas 24 horas
        const { data: events, error } = await _supabase.supabaseAdmin.from('security_events').select('*').gte('timestamp', last24h);
        if (error) {
            throw new Error(`Error obteniendo eventos: ${error.message}`);
        }
        // Obtener alertas activas
        const { data: alerts, error: alertsError } = await _supabase.supabaseAdmin.from('security_alerts').select('id').eq('status', 'open');
        if (alertsError) {
            console.error('[SECURITY] Error obteniendo alertas:', alertsError);
        }
        // Calcular métricas
        const totalEvents = events?.length || 0;
        const criticalEvents = events?.filter((e)=>e.severity === 'critical').length || 0;
        const uniqueUsers = new Set(events?.map((e)=>e.user_id)).size;
        const authFailures = events?.filter((e)=>e.event_type === 'AUTH_FAILURE').length || 0;
        const suspiciousActivities = events?.filter((e)=>e.event_type === 'SUSPICIOUS_ACTIVITY').length || 0;
        const activeAlerts = alerts?.length || 0;
        // Calcular score de seguridad (0-100)
        let securityScore = 100;
        if (criticalEvents > 0) {
            securityScore -= criticalEvents * 10;
        }
        if (authFailures > 10) {
            securityScore -= (authFailures - 10) * 2;
        }
        if (suspiciousActivities > 5) {
            securityScore -= (suspiciousActivities - 5) * 5;
        }
        if (activeAlerts > 0) {
            securityScore -= activeAlerts * 3;
        }
        securityScore = Math.max(0, Math.min(100, securityScore));
        const metrics = {
            total_events_24h: totalEvents,
            critical_events_24h: criticalEvents,
            unique_users_24h: uniqueUsers,
            auth_failures_24h: authFailures,
            suspicious_activities_24h: suspiciousActivities,
            blocked_users: 0,
            active_alerts: activeAlerts,
            avg_response_time: 0,
            security_score: securityScore
        };
        // Guardar en cache por 5 minutos
        await cache.set(_cachemanager.CACHE_CONFIGS.USER_SESSION, cacheKey, metrics);
        return metrics;
    } catch (error) {
        console.error('[SECURITY] Error obteniendo métricas:', error);
        return {
            total_events_24h: 0,
            critical_events_24h: 0,
            unique_users_24h: 0,
            auth_failures_24h: 0,
            suspicious_activities_24h: 0,
            blocked_users: 0,
            active_alerts: 0,
            avg_response_time: 0,
            security_score: 0
        };
    }
}
async function generateSecurityReport(startDate, endDate) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        console.log(`[SECURITY] Generando reporte de seguridad: ${startDate.toISOString()} - ${endDate.toISOString()}`);
        // Obtener eventos del período
        const { data: events, error } = await _supabase.supabaseAdmin.from('security_events').select('*').gte('timestamp', startDate.toISOString()).lte('timestamp', endDate.toISOString()).order('timestamp', {
            ascending: false
        });
        if (error) {
            throw new Error(`Error obteniendo eventos: ${error.message}`);
        }
        const totalEvents = events?.length || 0;
        // Agrupar por severidad
        const eventsBySeverity = {
            low: 0,
            medium: 0,
            high: 0,
            critical: 0
        };
        // Agrupar por categoría
        const eventsByCategory = {
            authentication: 0,
            authorization: 0,
            data_access: 0,
            admin_operations: 0,
            suspicious_behavior: 0
        };
        // Contadores de usuarios e IPs
        const userCounts = {};
        const ipCounts = {};
        events?.forEach((event)=>{
            // Contar por severidad
            eventsBySeverity[event.severity]++;
            // Contar por categoría
            eventsByCategory[event.event_category]++;
            // Contar por usuario
            userCounts[event.user_id] = (userCounts[event.user_id] || 0) + 1;
            // Contar por IP
            if (event.ip_address) {
                ipCounts[event.ip_address] = (ipCounts[event.ip_address] || 0) + 1;
            }
        });
        // Top usuarios (más eventos)
        const topUsers = Object.entries(userCounts).sort(([, a], [, b])=>b - a).slice(0, 10).map(([user_id, event_count])=>({
                user_id,
                event_count
            }));
        // Top IPs (más eventos)
        const topIps = Object.entries(ipCounts).sort(([, a], [, b])=>b - a).slice(0, 10).map(([ip_address, event_count])=>({
                ip_address,
                event_count
            }));
        // Obtener patrones detectados
        const { data: alerts, error: alertsError } = await _supabase.supabaseAdmin.from('security_alerts').select('pattern_id').gte('first_occurrence', startDate.toISOString()).lte('last_occurrence', endDate.toISOString());
        const patternsDetected = [];
        if (!alertsError && alerts) {
            const patternCounts = {};
            alerts.forEach((alert)=>{
                patternCounts[alert.pattern_id] = (patternCounts[alert.pattern_id] || 0) + 1;
            });
            Object.entries(patternCounts).forEach(([pattern_id, occurrences])=>{
                patternsDetected.push({
                    pattern_id,
                    occurrences
                });
            });
        }
        // Generar recomendaciones
        const recommendations = generateSecurityRecommendations(eventsBySeverity, eventsByCategory, patternsDetected);
        const report = {
            id: `report_${Date.now()}`,
            period_start: startDate.toISOString(),
            period_end: endDate.toISOString(),
            total_events: totalEvents,
            events_by_severity: eventsBySeverity,
            events_by_category: eventsByCategory,
            top_users: topUsers,
            top_ips: topIps,
            patterns_detected: patternsDetected,
            recommendations,
            generated_at: new Date().toISOString()
        };
        // Guardar reporte en base de datos
        const { error: insertError } = await _supabase.supabaseAdmin.from('security_reports').insert(report);
        if (insertError) {
            console.error('[SECURITY] Error guardando reporte:', insertError);
        }
        console.log(`[SECURITY] Reporte generado: ${totalEvents} eventos analizados`);
        return report;
    } catch (error) {
        console.error('[SECURITY] Error generando reporte:', error);
        throw error;
    }
}
/**
 * Genera recomendaciones de seguridad basadas en los datos del reporte
 */ function generateSecurityRecommendations(eventsBySeverity, eventsByCategory, patternsDetected) {
    const recommendations = [];
    // Recomendaciones basadas en severidad
    if (eventsBySeverity.critical > 0) {
        recommendations.push(`Se detectaron ${eventsBySeverity.critical} eventos críticos. Revisar inmediatamente.`);
    }
    if (eventsBySeverity.high > 10) {
        recommendations.push(`Alto número de eventos de severidad alta (${eventsBySeverity.high}). Considerar reforzar medidas de seguridad.`);
    }
    // Recomendaciones basadas en categorías
    if (eventsByCategory.authentication > 50) {
        recommendations.push(`Muchos eventos de autenticación (${eventsByCategory.authentication}). Considerar implementar MFA.`);
    }
    if (eventsByCategory.authorization > 20) {
        recommendations.push(`Eventos de autorización elevados (${eventsByCategory.authorization}). Revisar permisos de usuarios.`);
    }
    if (eventsByCategory.suspicious_behavior > 5) {
        recommendations.push(`Actividad sospechosa detectada (${eventsByCategory.suspicious_behavior} eventos). Monitorear de cerca.`);
    }
    // Recomendaciones basadas en patrones
    const highFrequencyPatterns = patternsDetected.filter((p)=>p.occurrences > 3);
    if (highFrequencyPatterns.length > 0) {
        recommendations.push(`Patrones de seguridad recurrentes detectados. Considerar medidas preventivas adicionales.`);
    }
    // Recomendaciones generales
    if (recommendations.length === 0) {
        recommendations.push('No se detectaron problemas críticos de seguridad. Mantener monitoreo regular.');
    }
    return recommendations;
}
async function getActiveSecurityAlerts(userId, severity) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        let query = _supabase.supabaseAdmin.from('security_alerts').select('*').eq('status', 'open').order('last_occurrence', {
            ascending: false
        });
        if (userId) {
            query = query.eq('user_id', userId);
        }
        if (severity) {
            query = query.eq('severity', severity);
        }
        const { data: alerts, error } = await query;
        if (error) {
            throw new Error(`Error obteniendo alertas: ${error.message}`);
        }
        return alerts || [];
    } catch (error) {
        console.error('[SECURITY] Error obteniendo alertas activas:', error);
        return [];
    }
}
async function updateSecurityAlert(alertId, updates) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const { error } = await _supabase.supabaseAdmin.from('security_alerts').update({
            ...updates,
            updated_at: new Date().toISOString()
        }).eq('id', alertId);
        if (error) {
            throw new Error(`Error actualizando alerta: ${error.message}`);
        }
        console.log(`[SECURITY] Alerta ${alertId} actualizada: ${JSON.stringify(updates)}`);
        return true;
    } catch (error) {
        console.error('[SECURITY] Error actualizando alerta:', error);
        return false;
    }
}
async function resolveSecurityAlert(alertId, resolutionNotes, resolvedBy) {
    return await updateSecurityAlert(alertId, {
        status: 'resolved',
        assigned_to: resolvedBy,
        resolution_notes: resolutionNotes
    });
}
async function markAlertAsFalsePositive(alertId, notes, markedBy) {
    return await updateSecurityAlert(alertId, {
        status: 'false_positive',
        assigned_to: markedBy,
        resolution_notes: notes
    });
}
function startSecurityMonitoring(intervalMinutes = 5) {
    console.log(`[SECURITY] 🚫 MONITOREO AUTOMÁTICO TEMPORALMENTE DESHABILITADO`);
    console.log(`[SECURITY] 📋 Razón: Evitar llamadas recursivas a APIs de auth`);
    // RETORNAR UN TIMEOUT DUMMY PARA NO ROMPER EL CÓDIGO QUE LO LLAMA
    return setTimeout(()=>{
        console.log('[SECURITY] Timeout dummy completado');
    }, 1000);
// CÓDIGO COMENTADO TEMPORALMENTE
// return setInterval(async () => {
//   try {
//     console.log('[SECURITY] Ejecutando análisis automático...');
//     // Analizar patrones de seguridad
//     const alerts = await analyzeSecurityPatterns();
//     if (alerts.length > 0) {
//       console.log(`[SECURITY] ${alerts.length} nuevas alertas generadas`);
//       // Procesar alertas críticas inmediatamente
//       const criticalAlerts = alerts.filter(a => a.severity === 'critical');
//       if (criticalAlerts.length > 0) {
//         console.warn(`[SECURITY] ¡${criticalAlerts.length} alertas críticas detectadas!`);
//         // Aquí se podrían enviar notificaciones inmediatas
//       }
//     }
//     // Actualizar métricas
//     await getSecurityMetrics();
//   } catch (error) {
//     console.error('[SECURITY] Error en monitoreo automático:', error);
//   }
// }, intervalMinutes * 60 * 1000);
}
function stopSecurityMonitoring(intervalId) {
    clearInterval(intervalId);
    console.log('[SECURITY] Monitoreo automático detenido');
}
async function runSecurityHealthCheck() {
    try {
        console.log('[SECURITY] Ejecutando verificación completa de seguridad...');
        // Obtener métricas actuales
        const metrics = await getSecurityMetrics();
        // Obtener alertas activas
        const activeAlerts = await getActiveSecurityAlerts();
        const issues = [];
        const recommendations = [];
        let status = 'healthy';
        // Evaluar estado de seguridad
        if (metrics.critical_events_24h > 0) {
            issues.push(`${metrics.critical_events_24h} eventos críticos en las últimas 24 horas`);
            status = 'critical';
        }
        if (metrics.auth_failures_24h > 20) {
            issues.push(`Alto número de fallos de autenticación: ${metrics.auth_failures_24h}`);
            if (status !== 'critical') {
                status = 'warning';
            }
            recommendations.push('Considerar implementar medidas anti-brute force');
        }
        if (metrics.suspicious_activities_24h > 10) {
            issues.push(`Actividad sospechosa elevada: ${metrics.suspicious_activities_24h} eventos`);
            if (status !== 'critical') {
                status = 'warning';
            }
            recommendations.push('Revisar patrones de actividad sospechosa');
        }
        if (metrics.active_alerts > 5) {
            issues.push(`Muchas alertas activas sin resolver: ${metrics.active_alerts}`);
            if (status !== 'critical') {
                status = 'warning';
            }
            recommendations.push('Revisar y resolver alertas pendientes');
        }
        if (metrics.security_score < 70) {
            issues.push(`Score de seguridad bajo: ${metrics.security_score}/100`);
            if (status !== 'critical') {
                status = 'warning';
            }
            recommendations.push('Implementar medidas para mejorar el score de seguridad');
        }
        // Recomendaciones generales
        if (issues.length === 0) {
            recommendations.push('Sistema de seguridad funcionando correctamente');
            recommendations.push('Mantener monitoreo regular y actualizaciones de seguridad');
        }
        console.log(`[SECURITY] Verificación completada - Estado: ${status}`);
        return {
            status,
            issues,
            recommendations,
            metrics
        };
    } catch (error) {
        console.error('[SECURITY] Error en verificación de seguridad:', error);
        return {
            status: 'critical',
            issues: [
                'Error ejecutando verificación de seguridad'
            ],
            recommendations: [
                'Revisar logs del sistema'
            ],
            metrics: await getSecurityMetrics()
        };
    }
}
async function cleanupOldSecurityEvents(daysToKeep = 90) {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const cutoffDate = new Date(Date.now() - daysToKeep * 24 * 60 * 60 * 1000).toISOString();
        const { data, error } = await _supabase.supabaseAdmin.from('security_events').delete().lt('timestamp', cutoffDate);
        if (error) {
            throw new Error(`Error limpiando eventos: ${error.message}`);
        }
        const deletedCount = Array.isArray(data) ? data.length : 0;
        console.log(`[SECURITY] Limpieza completada: ${deletedCount} eventos eliminados`);
        return deletedCount;
    } catch (error) {
        console.error('[SECURITY] Error en limpieza de eventos:', error);
        return 0;
    }
}
async function exportSecurityEvents(startDate, endDate, format = 'json') {
    try {
        if (!_supabase.supabaseAdmin) {
            throw new Error('Supabase admin client no disponible');
        }
        const { data: events, error } = await _supabase.supabaseAdmin.from('security_events').select('*').gte('timestamp', startDate.toISOString()).lte('timestamp', endDate.toISOString()).order('timestamp', {
            ascending: true
        });
        if (error) {
            throw new Error(`Error exportando eventos: ${error.message}`);
        }
        if (format === 'json') {
            return JSON.stringify(events, null, 2);
        } else {
            // Formato CSV
            if (!events || events.length === 0) {
                return 'No hay eventos para exportar';
            }
            const headers = Object.keys(events[0]).join(',');
            const rows = events.map((event)=>Object.values(event).map((value)=>typeof value === 'string' ? `"${value.replace(/"/g, '""')}"` : value).join(','));
            return [
                headers,
                ...rows
            ].join('\n');
        }
    } catch (error) {
        console.error('[SECURITY] Error exportando eventos:', error);
        throw error;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxhdXRoXFxzZWN1cml0eS1hdWRpdC1lbmhhbmNlZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogU2lzdGVtYSBkZSBBdWRpdG9yw61hIGRlIFNlZ3VyaWRhZCBNZWpvcmFkb1xyXG4gKiBFeHRpZW5kZSBlbCBzaXN0ZW1hIGJhc2UgY29uIGFuw6FsaXNpcyBhdmFuemFkbywgYWxlcnRhcyBhdXRvbcOhdGljYXMgeSByZXBvcnRlc1xyXG4gKi9cclxuXHJcbmltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICdAL2xpYi9pbnRlZ3JhdGlvbnMvc3VwYWJhc2UnO1xyXG5pbXBvcnQgeyBcclxuICBsb2dTZWN1cml0eUV2ZW50LCBcclxuICB0eXBlIFNlY3VyaXR5RXZlbnQsIFxyXG4gIHR5cGUgU2VjdXJpdHlTZXZlcml0eSxcclxuICB0eXBlIFNlY3VyaXR5RXZlbnRUeXBlLFxyXG4gIHR5cGUgU2VjdXJpdHlFdmVudENhdGVnb3J5IFxyXG59IGZyb20gJy4vc2VjdXJpdHktYXVkaXQnO1xyXG5pbXBvcnQgeyBDYWNoZU1hbmFnZXIsIENBQ0hFX0NPTkZJR1MgfSBmcm9tICdAL2xpYi9jYWNoZS1tYW5hZ2VyJztcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIFRJUE9TIFkgSU5URVJGQUNFUyBFWFRFTkRJREFTXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5UGF0dGVybiB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAgZGVzY3JpcHRpb246IHN0cmluZztcclxuICBzZXZlcml0eTogU2VjdXJpdHlTZXZlcml0eTtcclxuICBjb25kaXRpb25zOiBQYXR0ZXJuQ29uZGl0aW9uW107XHJcbiAgdGltZVdpbmRvdzogbnVtYmVyOyAvLyBlbiBtaW51dG9zXHJcbiAgdGhyZXNob2xkOiBudW1iZXI7XHJcbiAgZW5hYmxlZDogYm9vbGVhbjtcclxuICBhY3Rpb25zOiBTZWN1cml0eUFjdGlvbltdO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBhdHRlcm5Db25kaXRpb24ge1xyXG4gIGZpZWxkOiBzdHJpbmc7XHJcbiAgb3BlcmF0b3I6ICdlcXVhbHMnIHwgJ2NvbnRhaW5zJyB8ICdncmVhdGVyX3RoYW4nIHwgJ2xlc3NfdGhhbicgfCAnaW4nIHwgJ25vdF9pbic7XHJcbiAgdmFsdWU6IGFueTtcclxuICB3ZWlnaHQ6IG51bWJlcjsgLy8gcGVzbyBlbiBlbCBjw6FsY3VsbyBkZWwgcGF0csOzblxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5QWN0aW9uIHtcclxuICB0eXBlOiAnbG9nJyB8ICdhbGVydCcgfCAnYmxvY2tfdXNlcicgfCAnbm90aWZ5X2FkbWluJyB8ICdpbnZhbGlkYXRlX3Nlc3Npb25zJztcclxuICBwYXJhbWV0ZXJzPzogUmVjb3JkPHN0cmluZywgYW55PjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTZWN1cml0eVJlcG9ydCB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBwZXJpb2Rfc3RhcnQ6IHN0cmluZztcclxuICBwZXJpb2RfZW5kOiBzdHJpbmc7XHJcbiAgdG90YWxfZXZlbnRzOiBudW1iZXI7XHJcbiAgZXZlbnRzX2J5X3NldmVyaXR5OiBSZWNvcmQ8U2VjdXJpdHlTZXZlcml0eSwgbnVtYmVyPjtcclxuICBldmVudHNfYnlfY2F0ZWdvcnk6IFJlY29yZDxTZWN1cml0eUV2ZW50Q2F0ZWdvcnksIG51bWJlcj47XHJcbiAgdG9wX3VzZXJzOiBBcnJheTx7IHVzZXJfaWQ6IHN0cmluZzsgZXZlbnRfY291bnQ6IG51bWJlciB9PjtcclxuICB0b3BfaXBzOiBBcnJheTx7IGlwX2FkZHJlc3M6IHN0cmluZzsgZXZlbnRfY291bnQ6IG51bWJlciB9PjtcclxuICBwYXR0ZXJuc19kZXRlY3RlZDogQXJyYXk8eyBwYXR0ZXJuX2lkOiBzdHJpbmc7IG9jY3VycmVuY2VzOiBudW1iZXIgfT47XHJcbiAgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXTtcclxuICBnZW5lcmF0ZWRfYXQ6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTZWN1cml0eU1ldHJpY3Mge1xyXG4gIHRvdGFsX2V2ZW50c18yNGg6IG51bWJlcjtcclxuICBjcml0aWNhbF9ldmVudHNfMjRoOiBudW1iZXI7XHJcbiAgdW5pcXVlX3VzZXJzXzI0aDogbnVtYmVyO1xyXG4gIGF1dGhfZmFpbHVyZXNfMjRoOiBudW1iZXI7XHJcbiAgc3VzcGljaW91c19hY3Rpdml0aWVzXzI0aDogbnVtYmVyO1xyXG4gIGJsb2NrZWRfdXNlcnM6IG51bWJlcjtcclxuICBhY3RpdmVfYWxlcnRzOiBudW1iZXI7XHJcbiAgYXZnX3Jlc3BvbnNlX3RpbWU6IG51bWJlcjtcclxuICBzZWN1cml0eV9zY29yZTogbnVtYmVyOyAvLyAwLTEwMFxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5QWxlcnQge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgcGF0dGVybl9pZDogc3RyaW5nO1xyXG4gIHVzZXJfaWQ6IHN0cmluZztcclxuICBzZXZlcml0eTogU2VjdXJpdHlTZXZlcml0eTtcclxuICB0aXRsZTogc3RyaW5nO1xyXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XHJcbiAgZXZlbnRfY291bnQ6IG51bWJlcjtcclxuICBmaXJzdF9vY2N1cnJlbmNlOiBzdHJpbmc7XHJcbiAgbGFzdF9vY2N1cnJlbmNlOiBzdHJpbmc7XHJcbiAgc3RhdHVzOiAnb3BlbicgfCAnaW52ZXN0aWdhdGluZycgfCAncmVzb2x2ZWQnIHwgJ2ZhbHNlX3Bvc2l0aXZlJztcclxuICBhc3NpZ25lZF90bz86IHN0cmluZztcclxuICByZXNvbHV0aW9uX25vdGVzPzogc3RyaW5nO1xyXG4gIG1ldGFkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBQQVRST05FUyBERSBTRUdVUklEQUQgUFJFREVGSU5JRE9TXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRUNVUklUWV9QQVRURVJOUzogU2VjdXJpdHlQYXR0ZXJuW10gPSBbXHJcbiAge1xyXG4gICAgaWQ6ICdicnV0ZV9mb3JjZV9sb2dpbicsXHJcbiAgICBuYW1lOiAnQXRhcXVlIGRlIEZ1ZXJ6YSBCcnV0YScsXHJcbiAgICBkZXNjcmlwdGlvbjogJ03Dumx0aXBsZXMgaW50ZW50b3MgZGUgbG9naW4gZmFsbGlkb3MgZGVzZGUgbGEgbWlzbWEgSVAnLFxyXG4gICAgc2V2ZXJpdHk6ICdoaWdoJyxcclxuICAgIHRpbWVXaW5kb3c6IDE1LFxyXG4gICAgdGhyZXNob2xkOiA1LFxyXG4gICAgZW5hYmxlZDogdHJ1ZSxcclxuICAgIGNvbmRpdGlvbnM6IFtcclxuICAgICAgeyBmaWVsZDogJ2V2ZW50X3R5cGUnLCBvcGVyYXRvcjogJ2VxdWFscycsIHZhbHVlOiAnQVVUSF9GQUlMVVJFJywgd2VpZ2h0OiAxIH0sXHJcbiAgICAgIHsgZmllbGQ6ICdpcF9hZGRyZXNzJywgb3BlcmF0b3I6ICdlcXVhbHMnLCB2YWx1ZTogJ3NhbWUnLCB3ZWlnaHQ6IDEgfVxyXG4gICAgXSxcclxuICAgIGFjdGlvbnM6IFtcclxuICAgICAgeyB0eXBlOiAnYWxlcnQnLCBwYXJhbWV0ZXJzOiB7IG5vdGlmeV9hZG1pbnM6IHRydWUgfSB9LFxyXG4gICAgICB7IHR5cGU6ICdsb2cnLCBwYXJhbWV0ZXJzOiB7IHNldmVyaXR5OiAnaGlnaCcgfSB9XHJcbiAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICBpZDogJ3ByaXZpbGVnZV9lc2NhbGF0aW9uJyxcclxuICAgIG5hbWU6ICdFc2NhbGFjacOzbiBkZSBQcml2aWxlZ2lvcycsXHJcbiAgICBkZXNjcmlwdGlvbjogJ0ludGVudG8gZGUgYWNjZXNvIGEgcmVjdXJzb3Mgc2luIHBlcm1pc29zIHN1ZmljaWVudGVzJyxcclxuICAgIHNldmVyaXR5OiAnY3JpdGljYWwnLFxyXG4gICAgdGltZVdpbmRvdzogNjAsXHJcbiAgICB0aHJlc2hvbGQ6IDMsXHJcbiAgICBlbmFibGVkOiB0cnVlLFxyXG4gICAgY29uZGl0aW9uczogW1xyXG4gICAgICB7IGZpZWxkOiAnZXZlbnRfdHlwZScsIG9wZXJhdG9yOiAnZXF1YWxzJywgdmFsdWU6ICdQRVJNSVNTSU9OX0RFTklFRCcsIHdlaWdodDogMSB9LFxyXG4gICAgICB7IGZpZWxkOiAnZXZlbnRfY2F0ZWdvcnknLCBvcGVyYXRvcjogJ2VxdWFscycsIHZhbHVlOiAnYXV0aG9yaXphdGlvbicsIHdlaWdodDogMSB9XHJcbiAgICBdLFxyXG4gICAgYWN0aW9uczogW1xyXG4gICAgICB7IHR5cGU6ICdhbGVydCcsIHBhcmFtZXRlcnM6IHsgbm90aWZ5X2FkbWluczogdHJ1ZSwgcHJpb3JpdHk6ICdoaWdoJyB9IH0sXHJcbiAgICAgIHsgdHlwZTogJ2xvZycsIHBhcmFtZXRlcnM6IHsgc2V2ZXJpdHk6ICdjcml0aWNhbCcgfSB9XHJcbiAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICBpZDogJ3N1c3BpY2lvdXNfZGF0YV9hY2Nlc3MnLFxyXG4gICAgbmFtZTogJ0FjY2VzbyBTb3NwZWNob3NvIGEgRGF0b3MnLFxyXG4gICAgZGVzY3JpcHRpb246ICdBY2Nlc28gbWFzaXZvIGEgZGF0b3Mgc2Vuc2libGVzIGVuIGNvcnRvIHBlcsOtb2RvJyxcclxuICAgIHNldmVyaXR5OiAnbWVkaXVtJyxcclxuICAgIHRpbWVXaW5kb3c6IDMwLFxyXG4gICAgdGhyZXNob2xkOiAxMCxcclxuICAgIGVuYWJsZWQ6IHRydWUsXHJcbiAgICBjb25kaXRpb25zOiBbXHJcbiAgICAgIHsgZmllbGQ6ICdldmVudF90eXBlJywgb3BlcmF0b3I6ICdlcXVhbHMnLCB2YWx1ZTogJ0RBVEFfQUNDRVNTJywgd2VpZ2h0OiAxIH0sXHJcbiAgICAgIHsgZmllbGQ6ICdldmVudF9jYXRlZ29yeScsIG9wZXJhdG9yOiAnZXF1YWxzJywgdmFsdWU6ICdkYXRhX2FjY2VzcycsIHdlaWdodDogMSB9XHJcbiAgICBdLFxyXG4gICAgYWN0aW9uczogW1xyXG4gICAgICB7IHR5cGU6ICdhbGVydCcsIHBhcmFtZXRlcnM6IHsgbm90aWZ5X2FkbWluczogZmFsc2UgfSB9LFxyXG4gICAgICB7IHR5cGU6ICdsb2cnLCBwYXJhbWV0ZXJzOiB7IHNldmVyaXR5OiAnbWVkaXVtJyB9IH1cclxuICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgIGlkOiAnYWRtaW5fYWN0aW9uX2J1cnN0JyxcclxuICAgIG5hbWU6ICdSw6FmYWdhIGRlIEFjY2lvbmVzIEFkbWluaXN0cmF0aXZhcycsXHJcbiAgICBkZXNjcmlwdGlvbjogJ03Dumx0aXBsZXMgYWNjaW9uZXMgYWRtaW5pc3RyYXRpdmFzIGVuIGNvcnRvIHBlcsOtb2RvJyxcclxuICAgIHNldmVyaXR5OiAnbWVkaXVtJyxcclxuICAgIHRpbWVXaW5kb3c6IDEwLFxyXG4gICAgdGhyZXNob2xkOiA1LFxyXG4gICAgZW5hYmxlZDogdHJ1ZSxcclxuICAgIGNvbmRpdGlvbnM6IFtcclxuICAgICAgeyBmaWVsZDogJ2V2ZW50X3R5cGUnLCBvcGVyYXRvcjogJ2VxdWFscycsIHZhbHVlOiAnQURNSU5fQUNUSU9OJywgd2VpZ2h0OiAxIH0sXHJcbiAgICAgIHsgZmllbGQ6ICdldmVudF9jYXRlZ29yeScsIG9wZXJhdG9yOiAnZXF1YWxzJywgdmFsdWU6ICdhZG1pbl9vcGVyYXRpb25zJywgd2VpZ2h0OiAxIH1cclxuICAgIF0sXHJcbiAgICBhY3Rpb25zOiBbXHJcbiAgICAgIHsgdHlwZTogJ2FsZXJ0JywgcGFyYW1ldGVyczogeyBub3RpZnlfYWRtaW5zOiB0cnVlIH0gfSxcclxuICAgICAgeyB0eXBlOiAnbG9nJywgcGFyYW1ldGVyczogeyBzZXZlcml0eTogJ21lZGl1bScgfSB9XHJcbiAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICBpZDogJ2dlb2dyYXBoaWNfYW5vbWFseScsXHJcbiAgICBuYW1lOiAnQW5vbWFsw61hIEdlb2dyw6FmaWNhJyxcclxuICAgIGRlc2NyaXB0aW9uOiAnQWNjZXNvIGRlc2RlIHViaWNhY2lvbmVzIGdlb2dyw6FmaWNhcyBpbnVzdWFsZXMnLFxyXG4gICAgc2V2ZXJpdHk6ICdtZWRpdW0nLFxyXG4gICAgdGltZVdpbmRvdzogNjAsXHJcbiAgICB0aHJlc2hvbGQ6IDIsXHJcbiAgICBlbmFibGVkOiB0cnVlLFxyXG4gICAgY29uZGl0aW9uczogW1xyXG4gICAgICB7IGZpZWxkOiAnZXZlbnRfdHlwZScsIG9wZXJhdG9yOiAnZXF1YWxzJywgdmFsdWU6ICdBVVRIX1NVQ0NFU1MnLCB3ZWlnaHQ6IDEgfSxcclxuICAgICAgeyBmaWVsZDogJ2lwX2FkZHJlc3MnLCBvcGVyYXRvcjogJ25vdF9pbicsIHZhbHVlOiAndXN1YWxfbG9jYXRpb25zJywgd2VpZ2h0OiAxIH1cclxuICAgIF0sXHJcbiAgICBhY3Rpb25zOiBbXHJcbiAgICAgIHsgdHlwZTogJ2FsZXJ0JywgcGFyYW1ldGVyczogeyBub3RpZnlfdXNlcjogdHJ1ZSB9IH0sXHJcbiAgICAgIHsgdHlwZTogJ2xvZycsIHBhcmFtZXRlcnM6IHsgc2V2ZXJpdHk6ICdtZWRpdW0nIH0gfVxyXG4gICAgXVxyXG4gIH1cclxuXTtcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEZVTkNJT05FUyBERSBBTsOBTElTSVMgQVZBTlpBRE9cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbi8qKlxyXG4gKiBBbmFsaXphIGV2ZW50b3MgZGUgc2VndXJpZGFkIHBhcmEgZGV0ZWN0YXIgcGF0cm9uZXNcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhbmFseXplU2VjdXJpdHlQYXR0ZXJucyhcclxuICB1c2VySWQ/OiBzdHJpbmcsXHJcbiAgdGltZVdpbmRvd0hvdXJzOiBudW1iZXIgPSAyNFxyXG4pOiBQcm9taXNlPFNlY3VyaXR5QWxlcnRbXT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZygnW1NFQ1VSSVRZXSBJbmljaWFuZG8gYW7DoWxpc2lzIGRlIHBhdHJvbmVzIGRlIHNlZ3VyaWRhZCcpO1xyXG5cclxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGFkbWluIGNsaWVudCBubyBkaXNwb25pYmxlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdGltZVRocmVzaG9sZCA9IG5ldyBEYXRlKERhdGUubm93KCkgLSB0aW1lV2luZG93SG91cnMgKiA2MCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKTtcclxuICAgIGNvbnN0IGFsZXJ0czogU2VjdXJpdHlBbGVydFtdID0gW107XHJcblxyXG4gICAgLy8gT2J0ZW5lciBldmVudG9zIHJlY2llbnRlc1xyXG4gICAgbGV0IHF1ZXJ5ID0gc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc2VjdXJpdHlfZXZlbnRzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5ndGUoJ3RpbWVzdGFtcCcsIHRpbWVUaHJlc2hvbGQpXHJcbiAgICAgIC5vcmRlcigndGltZXN0YW1wJywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIGlmICh1c2VySWQpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgndXNlcl9pZCcsIHVzZXJJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBldmVudHMsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBvYnRlbmllbmRvIGV2ZW50b3M6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWV2ZW50cyB8fCBldmVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybiBhbGVydHM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQW5hbGl6YXIgY2FkYSBwYXRyw7NuXHJcbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgREVGQVVMVF9TRUNVUklUWV9QQVRURVJOUykge1xyXG4gICAgICBpZiAoIXBhdHRlcm4uZW5hYmxlZCkge2NvbnRpbnVlO31cclxuXHJcbiAgICAgIGNvbnN0IHBhdHRlcm5BbGVydHMgPSBhd2FpdCBkZXRlY3RQYXR0ZXJuKHBhdHRlcm4sIGV2ZW50cyk7XHJcbiAgICAgIGFsZXJ0cy5wdXNoKC4uLnBhdHRlcm5BbGVydHMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEd1YXJkYXIgYWxlcnRhcyBlbiBiYXNlIGRlIGRhdG9zXHJcbiAgICBpZiAoYWxlcnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgeyBlcnJvcjogaW5zZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAuZnJvbSgnc2VjdXJpdHlfYWxlcnRzJylcclxuICAgICAgICAuaW5zZXJ0KGFsZXJ0cyk7XHJcblxyXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIGd1YXJkYW5kbyBhbGVydGFzOicsIGluc2VydEVycm9yKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbU0VDVVJJVFldIEFuw6FsaXNpcyBjb21wbGV0YWRvOiAke2FsZXJ0cy5sZW5ndGh9IGFsZXJ0YXMgZ2VuZXJhZGFzYCk7XHJcbiAgICByZXR1cm4gYWxlcnRzO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIGVuIGFuw6FsaXNpcyBkZSBwYXRyb25lczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogRGV0ZWN0YSB1biBwYXRyw7NuIGVzcGVjw61maWNvIGVuIGxvcyBldmVudG9zXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBkZXRlY3RQYXR0ZXJuKFxyXG4gIHBhdHRlcm46IFNlY3VyaXR5UGF0dGVybixcclxuICBldmVudHM6IFNlY3VyaXR5RXZlbnRbXVxyXG4pOiBQcm9taXNlPFNlY3VyaXR5QWxlcnRbXT4ge1xyXG4gIGNvbnN0IGFsZXJ0czogU2VjdXJpdHlBbGVydFtdID0gW107XHJcbiAgY29uc3QgdGltZVdpbmRvdyA9IHBhdHRlcm4udGltZVdpbmRvdyAqIDYwICogMTAwMDsgLy8gY29udmVydGlyIGEgbXNcclxuXHJcbiAgLy8gQWdydXBhciBldmVudG9zIHBvciB1c3VhcmlvXHJcbiAgY29uc3QgZXZlbnRzQnlVc2VyID0gZXZlbnRzLnJlZHVjZSgoYWNjLCBldmVudCkgPT4ge1xyXG4gICAgaWYgKCFhY2NbZXZlbnQudXNlcl9pZF0pIHtcclxuICAgICAgYWNjW2V2ZW50LnVzZXJfaWRdID0gW107XHJcbiAgICB9XHJcbiAgICBhY2NbZXZlbnQudXNlcl9pZF0ucHVzaChldmVudCk7XHJcbiAgICByZXR1cm4gYWNjO1xyXG4gIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIFNlY3VyaXR5RXZlbnRbXT4pO1xyXG5cclxuICAvLyBBbmFsaXphciBjYWRhIHVzdWFyaW9cclxuICBmb3IgKGNvbnN0IFt1c2VySWQsIHVzZXJFdmVudHNdIG9mIE9iamVjdC5lbnRyaWVzKGV2ZW50c0J5VXNlcikpIHtcclxuICAgIGNvbnN0IG1hdGNoaW5nRXZlbnRzID0gdXNlckV2ZW50cy5maWx0ZXIoZXZlbnQgPT4gXHJcbiAgICAgIG1hdGNoZXNQYXR0ZXJuQ29uZGl0aW9ucyhldmVudCwgcGF0dGVybi5jb25kaXRpb25zKVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAobWF0Y2hpbmdFdmVudHMubGVuZ3RoIDwgcGF0dGVybi50aHJlc2hvbGQpIHtjb250aW51ZTt9XHJcblxyXG4gICAgLy8gVmVyaWZpY2FyIHZlbnRhbmEgZGUgdGllbXBvXHJcbiAgICBjb25zdCBzb3J0ZWRFdmVudHMgPSBtYXRjaGluZ0V2ZW50cy5zb3J0KChhLCBiKSA9PiBcclxuICAgICAgbmV3IERhdGUoYS50aW1lc3RhbXApLmdldFRpbWUoKSAtIG5ldyBEYXRlKGIudGltZXN0YW1wKS5nZXRUaW1lKClcclxuICAgICk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gc29ydGVkRXZlbnRzLmxlbmd0aCAtIHBhdHRlcm4udGhyZXNob2xkOyBpKyspIHtcclxuICAgICAgY29uc3Qgd2luZG93U3RhcnQgPSBuZXcgRGF0ZShzb3J0ZWRFdmVudHNbaV0udGltZXN0YW1wKS5nZXRUaW1lKCk7XHJcbiAgICAgIGNvbnN0IHdpbmRvd0VuZCA9IHdpbmRvd1N0YXJ0ICsgdGltZVdpbmRvdztcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGV2ZW50c0luV2luZG93ID0gc29ydGVkRXZlbnRzLmZpbHRlcihldmVudCA9PiB7XHJcbiAgICAgICAgY29uc3QgZXZlbnRUaW1lID0gbmV3IERhdGUoZXZlbnQudGltZXN0YW1wKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgcmV0dXJuIGV2ZW50VGltZSA+PSB3aW5kb3dTdGFydCAmJiBldmVudFRpbWUgPD0gd2luZG93RW5kO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmIChldmVudHNJbldpbmRvdy5sZW5ndGggPj0gcGF0dGVybi50aHJlc2hvbGQpIHtcclxuICAgICAgICAvLyBQYXRyw7NuIGRldGVjdGFkb1xyXG4gICAgICAgIGNvbnN0IGFsZXJ0OiBTZWN1cml0eUFsZXJ0ID0ge1xyXG4gICAgICAgICAgaWQ6IGAke3BhdHRlcm4uaWR9XyR7dXNlcklkfV8ke0RhdGUubm93KCl9YCxcclxuICAgICAgICAgIHBhdHRlcm5faWQ6IHBhdHRlcm4uaWQsXHJcbiAgICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgICBzZXZlcml0eTogcGF0dGVybi5zZXZlcml0eSxcclxuICAgICAgICAgIHRpdGxlOiBwYXR0ZXJuLm5hbWUsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYCR7cGF0dGVybi5kZXNjcmlwdGlvbn0gLSAke2V2ZW50c0luV2luZG93Lmxlbmd0aH0gZXZlbnRvcyBkZXRlY3RhZG9zYCxcclxuICAgICAgICAgIGV2ZW50X2NvdW50OiBldmVudHNJbldpbmRvdy5sZW5ndGgsXHJcbiAgICAgICAgICBmaXJzdF9vY2N1cnJlbmNlOiBldmVudHNJbldpbmRvd1swXS50aW1lc3RhbXAsXHJcbiAgICAgICAgICBsYXN0X29jY3VycmVuY2U6IGV2ZW50c0luV2luZG93W2V2ZW50c0luV2luZG93Lmxlbmd0aCAtIDFdLnRpbWVzdGFtcCxcclxuICAgICAgICAgIHN0YXR1czogJ29wZW4nLFxyXG4gICAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgcGF0dGVybl9uYW1lOiBwYXR0ZXJuLm5hbWUsXHJcbiAgICAgICAgICAgIGV2ZW50czogZXZlbnRzSW5XaW5kb3cubWFwKGUgPT4gZS5pZCksXHJcbiAgICAgICAgICAgIHRocmVzaG9sZDogcGF0dGVybi50aHJlc2hvbGQsXHJcbiAgICAgICAgICAgIHRpbWVfd2luZG93X21pbnV0ZXM6IHBhdHRlcm4udGltZVdpbmRvd1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGFsZXJ0cy5wdXNoKGFsZXJ0KTtcclxuXHJcbiAgICAgICAgLy8gRWplY3V0YXIgYWNjaW9uZXMgZGVsIHBhdHLDs25cclxuICAgICAgICBhd2FpdCBleGVjdXRlUGF0dGVybkFjdGlvbnMocGF0dGVybi5hY3Rpb25zLCBhbGVydCwgZXZlbnRzSW5XaW5kb3cpO1xyXG4gICAgICAgIGJyZWFrOyAvLyBTb2xvIHVuYSBhbGVydGEgcG9yIHBhdHLDs24gcG9yIHVzdWFyaW9cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGFsZXJ0cztcclxufVxyXG5cclxuLyoqXHJcbiAqIFZlcmlmaWNhIHNpIHVuIGV2ZW50byBjb2luY2lkZSBjb24gbGFzIGNvbmRpY2lvbmVzIGRlbCBwYXRyw7NuXHJcbiAqL1xyXG5mdW5jdGlvbiBtYXRjaGVzUGF0dGVybkNvbmRpdGlvbnMoXHJcbiAgZXZlbnQ6IFNlY3VyaXR5RXZlbnQsXHJcbiAgY29uZGl0aW9uczogUGF0dGVybkNvbmRpdGlvbltdXHJcbik6IGJvb2xlYW4ge1xyXG4gIHJldHVybiBjb25kaXRpb25zLmV2ZXJ5KGNvbmRpdGlvbiA9PiB7XHJcbiAgICBjb25zdCBldmVudFZhbHVlID0gKGV2ZW50IGFzIGFueSlbY29uZGl0aW9uLmZpZWxkXTtcclxuICAgIFxyXG4gICAgc3dpdGNoIChjb25kaXRpb24ub3BlcmF0b3IpIHtcclxuICAgICAgY2FzZSAnZXF1YWxzJzpcclxuICAgICAgICByZXR1cm4gZXZlbnRWYWx1ZSA9PT0gY29uZGl0aW9uLnZhbHVlO1xyXG4gICAgICBjYXNlICdjb250YWlucyc6XHJcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBldmVudFZhbHVlID09PSAnc3RyaW5nJyAmJiBldmVudFZhbHVlLmluY2x1ZGVzKGNvbmRpdGlvbi52YWx1ZSk7XHJcbiAgICAgIGNhc2UgJ2dyZWF0ZXJfdGhhbic6XHJcbiAgICAgICAgcmV0dXJuIE51bWJlcihldmVudFZhbHVlKSA+IE51bWJlcihjb25kaXRpb24udmFsdWUpO1xyXG4gICAgICBjYXNlICdsZXNzX3RoYW4nOlxyXG4gICAgICAgIHJldHVybiBOdW1iZXIoZXZlbnRWYWx1ZSkgPCBOdW1iZXIoY29uZGl0aW9uLnZhbHVlKTtcclxuICAgICAgY2FzZSAnaW4nOlxyXG4gICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KGNvbmRpdGlvbi52YWx1ZSkgJiYgY29uZGl0aW9uLnZhbHVlLmluY2x1ZGVzKGV2ZW50VmFsdWUpO1xyXG4gICAgICBjYXNlICdub3RfaW4nOlxyXG4gICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KGNvbmRpdGlvbi52YWx1ZSkgJiYgIWNvbmRpdGlvbi52YWx1ZS5pbmNsdWRlcyhldmVudFZhbHVlKTtcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBFamVjdXRhIGxhcyBhY2Npb25lcyBkZWZpbmlkYXMgcGFyYSB1biBwYXRyw7NuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBleGVjdXRlUGF0dGVybkFjdGlvbnMoXHJcbiAgYWN0aW9uczogU2VjdXJpdHlBY3Rpb25bXSxcclxuICBhbGVydDogU2VjdXJpdHlBbGVydCxcclxuICBldmVudHM6IFNlY3VyaXR5RXZlbnRbXVxyXG4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICBmb3IgKGNvbnN0IGFjdGlvbiBvZiBhY3Rpb25zKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XHJcbiAgICAgICAgY2FzZSAnbG9nJzpcclxuICAgICAgICAgIGF3YWl0IGxvZ1NlY3VyaXR5RXZlbnQoe1xyXG4gICAgICAgICAgICB1c2VyX2lkOiBhbGVydC51c2VyX2lkLFxyXG4gICAgICAgICAgICBldmVudF90eXBlOiAnU1VTUElDSU9VU19BQ1RJVklUWScsXHJcbiAgICAgICAgICAgIGV2ZW50X2NhdGVnb3J5OiAnc3VzcGljaW91c19iZWhhdmlvcicsXHJcbiAgICAgICAgICAgIHNldmVyaXR5OiBhY3Rpb24ucGFyYW1ldGVycz8uc2V2ZXJpdHkgfHwgYWxlcnQuc2V2ZXJpdHksXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgUGF0csOzbiBkZXRlY3RhZG86ICR7YWxlcnQudGl0bGV9YCxcclxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgICBwYXR0ZXJuX2lkOiBhbGVydC5wYXR0ZXJuX2lkLFxyXG4gICAgICAgICAgICAgIGFsZXJ0X2lkOiBhbGVydC5pZCxcclxuICAgICAgICAgICAgICBldmVudF9jb3VudDogYWxlcnQuZXZlbnRfY291bnQsXHJcbiAgICAgICAgICAgICAgLi4uYWN0aW9uLnBhcmFtZXRlcnNcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAnYWxlcnQnOlxyXG4gICAgICAgICAgY29uc29sZS53YXJuKGBbU0VDVVJJVFkgQUxFUlRdICR7YWxlcnQudGl0bGV9IC0gVXN1YXJpbzogJHthbGVydC51c2VyX2lkfWApO1xyXG4gICAgICAgICAgaWYgKGFjdGlvbi5wYXJhbWV0ZXJzPy5ub3RpZnlfYWRtaW5zKSB7XHJcbiAgICAgICAgICAgIC8vIEFxdcOtIHNlIHBvZHLDrWEgaW50ZWdyYXIgY29uIHVuIHNpc3RlbWEgZGUgbm90aWZpY2FjaW9uZXNcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tTRUNVUklUWV0gTm90aWZpY2FuZG8gYSBhZG1pbmlzdHJhZG9yZXMuLi4nKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlICdibG9ja191c2VyJzpcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBbU0VDVVJJVFldIEJsb3F1ZWFuZG8gdXN1YXJpbzogJHthbGVydC51c2VyX2lkfWApO1xyXG4gICAgICAgICAgLy8gSW1wbGVtZW50YXIgbMOzZ2ljYSBkZSBibG9xdWVvXHJcbiAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAnaW52YWxpZGF0ZV9zZXNzaW9ucyc6XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgW1NFQ1VSSVRZXSBJbnZhbGlkYW5kbyBzZXNpb25lcyBkZWwgdXN1YXJpbzogJHthbGVydC51c2VyX2lkfWApO1xyXG4gICAgICAgICAgLy8gSW50ZWdyYXIgY29uIHNpc3RlbWEgZGUgZ2VzdGnDs24gZGUgc2VzaW9uZXNcclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgY29uc29sZS53YXJuKGBbU0VDVVJJVFldIEFjY2nDs24gbm8gcmVjb25vY2lkYTogJHthY3Rpb24udHlwZX1gKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihgW1NFQ1VSSVRZXSBFcnJvciBlamVjdXRhbmRvIGFjY2nDs24gJHthY3Rpb24udHlwZX06YCwgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gRlVOQ0lPTkVTIERFIE3DiVRSSUNBUyBZIFJFUE9SVEVTXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4vKipcclxuICogT2J0aWVuZSBtw6l0cmljYXMgZGUgc2VndXJpZGFkIGVuIHRpZW1wbyByZWFsXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VjdXJpdHlNZXRyaWNzKCk6IFByb21pc2U8U2VjdXJpdHlNZXRyaWNzPiB7XHJcbiAgdHJ5IHtcclxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGFkbWluIGNsaWVudCBubyBkaXNwb25pYmxlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2FjaGUgPSBDYWNoZU1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcclxuICAgIGNvbnN0IGNhY2hlS2V5ID0gJ3NlY3VyaXR5X21ldHJpY3MnO1xyXG5cclxuICAgIC8vIEludGVudGFyIG9idGVuZXIgZGVzZGUgY2FjaGVcclxuICAgIGNvbnN0IGNhY2hlZCA9IGF3YWl0IGNhY2hlLmdldChDQUNIRV9DT05GSUdTLlVTRVJfU0VTU0lPTiwgY2FjaGVLZXkpO1xyXG4gICAgaWYgKGNhY2hlZCkge1xyXG4gICAgICByZXR1cm4gY2FjaGVkIGFzIFNlY3VyaXR5TWV0cmljcztcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgY29uc3QgbGFzdDI0aCA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpO1xyXG5cclxuICAgIC8vIE9idGVuZXIgZXZlbnRvcyBkZSBsYXMgw7psdGltYXMgMjQgaG9yYXNcclxuICAgIGNvbnN0IHsgZGF0YTogZXZlbnRzLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc2VjdXJpdHlfZXZlbnRzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5ndGUoJ3RpbWVzdGFtcCcsIGxhc3QyNGgpO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIG9idGVuaWVuZG8gZXZlbnRvczogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIE9idGVuZXIgYWxlcnRhcyBhY3RpdmFzXHJcbiAgICBjb25zdCB7IGRhdGE6IGFsZXJ0cywgZXJyb3I6IGFsZXJ0c0Vycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9hbGVydHMnKVxyXG4gICAgICAuc2VsZWN0KCdpZCcpXHJcbiAgICAgIC5lcSgnc3RhdHVzJywgJ29wZW4nKTtcclxuXHJcbiAgICBpZiAoYWxlcnRzRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignW1NFQ1VSSVRZXSBFcnJvciBvYnRlbmllbmRvIGFsZXJ0YXM6JywgYWxlcnRzRXJyb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhbGN1bGFyIG3DqXRyaWNhc1xyXG4gICAgY29uc3QgdG90YWxFdmVudHMgPSBldmVudHM/Lmxlbmd0aCB8fCAwO1xyXG4gICAgY29uc3QgY3JpdGljYWxFdmVudHMgPSBldmVudHM/LmZpbHRlcihlID0+IGUuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcpLmxlbmd0aCB8fCAwO1xyXG4gICAgY29uc3QgdW5pcXVlVXNlcnMgPSBuZXcgU2V0KGV2ZW50cz8ubWFwKGUgPT4gZS51c2VyX2lkKSkuc2l6ZTtcclxuICAgIGNvbnN0IGF1dGhGYWlsdXJlcyA9IGV2ZW50cz8uZmlsdGVyKGUgPT4gZS5ldmVudF90eXBlID09PSAnQVVUSF9GQUlMVVJFJykubGVuZ3RoIHx8IDA7XHJcbiAgICBjb25zdCBzdXNwaWNpb3VzQWN0aXZpdGllcyA9IGV2ZW50cz8uZmlsdGVyKGUgPT4gZS5ldmVudF90eXBlID09PSAnU1VTUElDSU9VU19BQ1RJVklUWScpLmxlbmd0aCB8fCAwO1xyXG4gICAgY29uc3QgYWN0aXZlQWxlcnRzID0gYWxlcnRzPy5sZW5ndGggfHwgMDtcclxuXHJcbiAgICAvLyBDYWxjdWxhciBzY29yZSBkZSBzZWd1cmlkYWQgKDAtMTAwKVxyXG4gICAgbGV0IHNlY3VyaXR5U2NvcmUgPSAxMDA7XHJcbiAgICBpZiAoY3JpdGljYWxFdmVudHMgPiAwKSB7c2VjdXJpdHlTY29yZSAtPSBjcml0aWNhbEV2ZW50cyAqIDEwO31cclxuICAgIGlmIChhdXRoRmFpbHVyZXMgPiAxMCkge3NlY3VyaXR5U2NvcmUgLT0gKGF1dGhGYWlsdXJlcyAtIDEwKSAqIDI7fVxyXG4gICAgaWYgKHN1c3BpY2lvdXNBY3Rpdml0aWVzID4gNSkge3NlY3VyaXR5U2NvcmUgLT0gKHN1c3BpY2lvdXNBY3Rpdml0aWVzIC0gNSkgKiA1O31cclxuICAgIGlmIChhY3RpdmVBbGVydHMgPiAwKSB7c2VjdXJpdHlTY29yZSAtPSBhY3RpdmVBbGVydHMgKiAzO31cclxuICAgIHNlY3VyaXR5U2NvcmUgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIHNlY3VyaXR5U2NvcmUpKTtcclxuXHJcbiAgICBjb25zdCBtZXRyaWNzOiBTZWN1cml0eU1ldHJpY3MgPSB7XHJcbiAgICAgIHRvdGFsX2V2ZW50c18yNGg6IHRvdGFsRXZlbnRzLFxyXG4gICAgICBjcml0aWNhbF9ldmVudHNfMjRoOiBjcml0aWNhbEV2ZW50cyxcclxuICAgICAgdW5pcXVlX3VzZXJzXzI0aDogdW5pcXVlVXNlcnMsXHJcbiAgICAgIGF1dGhfZmFpbHVyZXNfMjRoOiBhdXRoRmFpbHVyZXMsXHJcbiAgICAgIHN1c3BpY2lvdXNfYWN0aXZpdGllc18yNGg6IHN1c3BpY2lvdXNBY3Rpdml0aWVzLFxyXG4gICAgICBibG9ja2VkX3VzZXJzOiAwLCAvLyBUT0RPOiBpbXBsZW1lbnRhciBjdWFuZG8gc2UgdGVuZ2Egc2lzdGVtYSBkZSBibG9xdWVvXHJcbiAgICAgIGFjdGl2ZV9hbGVydHM6IGFjdGl2ZUFsZXJ0cyxcclxuICAgICAgYXZnX3Jlc3BvbnNlX3RpbWU6IDAsIC8vIFRPRE86IGNhbGN1bGFyIHRpZW1wbyBwcm9tZWRpbyBkZSByZXNwdWVzdGFcclxuICAgICAgc2VjdXJpdHlfc2NvcmU6IHNlY3VyaXR5U2NvcmVcclxuICAgIH07XHJcblxyXG4gICAgLy8gR3VhcmRhciBlbiBjYWNoZSBwb3IgNSBtaW51dG9zXHJcbiAgICBhd2FpdCBjYWNoZS5zZXQoQ0FDSEVfQ09ORklHUy5VU0VSX1NFU1NJT04sIGNhY2hlS2V5LCBtZXRyaWNzKTtcclxuXHJcbiAgICByZXR1cm4gbWV0cmljcztcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignW1NFQ1VSSVRZXSBFcnJvciBvYnRlbmllbmRvIG3DqXRyaWNhczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0b3RhbF9ldmVudHNfMjRoOiAwLFxyXG4gICAgICBjcml0aWNhbF9ldmVudHNfMjRoOiAwLFxyXG4gICAgICB1bmlxdWVfdXNlcnNfMjRoOiAwLFxyXG4gICAgICBhdXRoX2ZhaWx1cmVzXzI0aDogMCxcclxuICAgICAgc3VzcGljaW91c19hY3Rpdml0aWVzXzI0aDogMCxcclxuICAgICAgYmxvY2tlZF91c2VyczogMCxcclxuICAgICAgYWN0aXZlX2FsZXJ0czogMCxcclxuICAgICAgYXZnX3Jlc3BvbnNlX3RpbWU6IDAsXHJcbiAgICAgIHNlY3VyaXR5X3Njb3JlOiAwXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEdlbmVyYSB1biByZXBvcnRlIGRlIHNlZ3VyaWRhZCBwYXJhIHVuIHBlcsOtb2RvIGVzcGVjw61maWNvXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVTZWN1cml0eVJlcG9ydChcclxuICBzdGFydERhdGU6IERhdGUsXHJcbiAgZW5kRGF0ZTogRGF0ZVxyXG4pOiBQcm9taXNlPFNlY3VyaXR5UmVwb3J0PiB7XHJcbiAgdHJ5IHtcclxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGFkbWluIGNsaWVudCBubyBkaXNwb25pYmxlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coYFtTRUNVUklUWV0gR2VuZXJhbmRvIHJlcG9ydGUgZGUgc2VndXJpZGFkOiAke3N0YXJ0RGF0ZS50b0lTT1N0cmluZygpfSAtICR7ZW5kRGF0ZS50b0lTT1N0cmluZygpfWApO1xyXG5cclxuICAgIC8vIE9idGVuZXIgZXZlbnRvcyBkZWwgcGVyw61vZG9cclxuICAgIGNvbnN0IHsgZGF0YTogZXZlbnRzLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc2VjdXJpdHlfZXZlbnRzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5ndGUoJ3RpbWVzdGFtcCcsIHN0YXJ0RGF0ZS50b0lTT1N0cmluZygpKVxyXG4gICAgICAubHRlKCd0aW1lc3RhbXAnLCBlbmREYXRlLnRvSVNPU3RyaW5nKCkpXHJcbiAgICAgIC5vcmRlcigndGltZXN0YW1wJywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIG9idGVuaWVuZG8gZXZlbnRvczogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRvdGFsRXZlbnRzID0gZXZlbnRzPy5sZW5ndGggfHwgMDtcclxuXHJcbiAgICAvLyBBZ3J1cGFyIHBvciBzZXZlcmlkYWRcclxuICAgIGNvbnN0IGV2ZW50c0J5U2V2ZXJpdHk6IFJlY29yZDxTZWN1cml0eVNldmVyaXR5LCBudW1iZXI+ID0ge1xyXG4gICAgICBsb3c6IDAsXHJcbiAgICAgIG1lZGl1bTogMCxcclxuICAgICAgaGlnaDogMCxcclxuICAgICAgY3JpdGljYWw6IDBcclxuICAgIH07XHJcblxyXG4gICAgLy8gQWdydXBhciBwb3IgY2F0ZWdvcsOtYVxyXG4gICAgY29uc3QgZXZlbnRzQnlDYXRlZ29yeTogUmVjb3JkPFNlY3VyaXR5RXZlbnRDYXRlZ29yeSwgbnVtYmVyPiA9IHtcclxuICAgICAgYXV0aGVudGljYXRpb246IDAsXHJcbiAgICAgIGF1dGhvcml6YXRpb246IDAsXHJcbiAgICAgIGRhdGFfYWNjZXNzOiAwLFxyXG4gICAgICBhZG1pbl9vcGVyYXRpb25zOiAwLFxyXG4gICAgICBzdXNwaWNpb3VzX2JlaGF2aW9yOiAwXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIENvbnRhZG9yZXMgZGUgdXN1YXJpb3MgZSBJUHNcclxuICAgIGNvbnN0IHVzZXJDb3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcclxuICAgIGNvbnN0IGlwQ291bnRzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XHJcblxyXG4gICAgZXZlbnRzPy5mb3JFYWNoKGV2ZW50ID0+IHtcclxuICAgICAgLy8gQ29udGFyIHBvciBzZXZlcmlkYWRcclxuICAgICAgZXZlbnRzQnlTZXZlcml0eVtldmVudC5zZXZlcml0eV0rKztcclxuXHJcbiAgICAgIC8vIENvbnRhciBwb3IgY2F0ZWdvcsOtYVxyXG4gICAgICBldmVudHNCeUNhdGVnb3J5W2V2ZW50LmV2ZW50X2NhdGVnb3J5XSsrO1xyXG5cclxuICAgICAgLy8gQ29udGFyIHBvciB1c3VhcmlvXHJcbiAgICAgIHVzZXJDb3VudHNbZXZlbnQudXNlcl9pZF0gPSAodXNlckNvdW50c1tldmVudC51c2VyX2lkXSB8fCAwKSArIDE7XHJcblxyXG4gICAgICAvLyBDb250YXIgcG9yIElQXHJcbiAgICAgIGlmIChldmVudC5pcF9hZGRyZXNzKSB7XHJcbiAgICAgICAgaXBDb3VudHNbZXZlbnQuaXBfYWRkcmVzc10gPSAoaXBDb3VudHNbZXZlbnQuaXBfYWRkcmVzc10gfHwgMCkgKyAxO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBUb3AgdXN1YXJpb3MgKG3DoXMgZXZlbnRvcylcclxuICAgIGNvbnN0IHRvcFVzZXJzID0gT2JqZWN0LmVudHJpZXModXNlckNvdW50cylcclxuICAgICAgLnNvcnQoKFssIGFdLCBbLCBiXSkgPT4gYiAtIGEpXHJcbiAgICAgIC5zbGljZSgwLCAxMClcclxuICAgICAgLm1hcCgoW3VzZXJfaWQsIGV2ZW50X2NvdW50XSkgPT4gKHsgdXNlcl9pZCwgZXZlbnRfY291bnQgfSkpO1xyXG5cclxuICAgIC8vIFRvcCBJUHMgKG3DoXMgZXZlbnRvcylcclxuICAgIGNvbnN0IHRvcElwcyA9IE9iamVjdC5lbnRyaWVzKGlwQ291bnRzKVxyXG4gICAgICAuc29ydCgoWywgYV0sIFssIGJdKSA9PiBiIC0gYSlcclxuICAgICAgLnNsaWNlKDAsIDEwKVxyXG4gICAgICAubWFwKChbaXBfYWRkcmVzcywgZXZlbnRfY291bnRdKSA9PiAoeyBpcF9hZGRyZXNzLCBldmVudF9jb3VudCB9KSk7XHJcblxyXG4gICAgLy8gT2J0ZW5lciBwYXRyb25lcyBkZXRlY3RhZG9zXHJcbiAgICBjb25zdCB7IGRhdGE6IGFsZXJ0cywgZXJyb3I6IGFsZXJ0c0Vycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9hbGVydHMnKVxyXG4gICAgICAuc2VsZWN0KCdwYXR0ZXJuX2lkJylcclxuICAgICAgLmd0ZSgnZmlyc3Rfb2NjdXJyZW5jZScsIHN0YXJ0RGF0ZS50b0lTT1N0cmluZygpKVxyXG4gICAgICAubHRlKCdsYXN0X29jY3VycmVuY2UnLCBlbmREYXRlLnRvSVNPU3RyaW5nKCkpO1xyXG5cclxuICAgIGNvbnN0IHBhdHRlcm5zRGV0ZWN0ZWQ6IEFycmF5PHsgcGF0dGVybl9pZDogc3RyaW5nOyBvY2N1cnJlbmNlczogbnVtYmVyIH0+ID0gW107XHJcbiAgICBpZiAoIWFsZXJ0c0Vycm9yICYmIGFsZXJ0cykge1xyXG4gICAgICBjb25zdCBwYXR0ZXJuQ291bnRzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XHJcbiAgICAgIGFsZXJ0cy5mb3JFYWNoKGFsZXJ0ID0+IHtcclxuICAgICAgICBwYXR0ZXJuQ291bnRzW2FsZXJ0LnBhdHRlcm5faWRdID0gKHBhdHRlcm5Db3VudHNbYWxlcnQucGF0dGVybl9pZF0gfHwgMCkgKyAxO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIE9iamVjdC5lbnRyaWVzKHBhdHRlcm5Db3VudHMpLmZvckVhY2goKFtwYXR0ZXJuX2lkLCBvY2N1cnJlbmNlc10pID0+IHtcclxuICAgICAgICBwYXR0ZXJuc0RldGVjdGVkLnB1c2goeyBwYXR0ZXJuX2lkLCBvY2N1cnJlbmNlcyB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhciByZWNvbWVuZGFjaW9uZXNcclxuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IGdlbmVyYXRlU2VjdXJpdHlSZWNvbW1lbmRhdGlvbnMoXHJcbiAgICAgIGV2ZW50c0J5U2V2ZXJpdHksXHJcbiAgICAgIGV2ZW50c0J5Q2F0ZWdvcnksXHJcbiAgICAgIHBhdHRlcm5zRGV0ZWN0ZWRcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgcmVwb3J0OiBTZWN1cml0eVJlcG9ydCA9IHtcclxuICAgICAgaWQ6IGByZXBvcnRfJHtEYXRlLm5vdygpfWAsXHJcbiAgICAgIHBlcmlvZF9zdGFydDogc3RhcnREYXRlLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIHBlcmlvZF9lbmQ6IGVuZERhdGUudG9JU09TdHJpbmcoKSxcclxuICAgICAgdG90YWxfZXZlbnRzOiB0b3RhbEV2ZW50cyxcclxuICAgICAgZXZlbnRzX2J5X3NldmVyaXR5OiBldmVudHNCeVNldmVyaXR5LFxyXG4gICAgICBldmVudHNfYnlfY2F0ZWdvcnk6IGV2ZW50c0J5Q2F0ZWdvcnksXHJcbiAgICAgIHRvcF91c2VyczogdG9wVXNlcnMsXHJcbiAgICAgIHRvcF9pcHM6IHRvcElwcyxcclxuICAgICAgcGF0dGVybnNfZGV0ZWN0ZWQ6IHBhdHRlcm5zRGV0ZWN0ZWQsXHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucyxcclxuICAgICAgZ2VuZXJhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH07XHJcblxyXG4gICAgLy8gR3VhcmRhciByZXBvcnRlIGVuIGJhc2UgZGUgZGF0b3NcclxuICAgIGNvbnN0IHsgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9yZXBvcnRzJylcclxuICAgICAgLmluc2VydChyZXBvcnQpO1xyXG5cclxuICAgIGlmIChpbnNlcnRFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIGd1YXJkYW5kbyByZXBvcnRlOicsIGluc2VydEVycm9yKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmxvZyhgW1NFQ1VSSVRZXSBSZXBvcnRlIGdlbmVyYWRvOiAke3RvdGFsRXZlbnRzfSBldmVudG9zIGFuYWxpemFkb3NgKTtcclxuICAgIHJldHVybiByZXBvcnQ7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tTRUNVUklUWV0gRXJyb3IgZ2VuZXJhbmRvIHJlcG9ydGU6JywgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogR2VuZXJhIHJlY29tZW5kYWNpb25lcyBkZSBzZWd1cmlkYWQgYmFzYWRhcyBlbiBsb3MgZGF0b3MgZGVsIHJlcG9ydGVcclxuICovXHJcbmZ1bmN0aW9uIGdlbmVyYXRlU2VjdXJpdHlSZWNvbW1lbmRhdGlvbnMoXHJcbiAgZXZlbnRzQnlTZXZlcml0eTogUmVjb3JkPFNlY3VyaXR5U2V2ZXJpdHksIG51bWJlcj4sXHJcbiAgZXZlbnRzQnlDYXRlZ29yeTogUmVjb3JkPFNlY3VyaXR5RXZlbnRDYXRlZ29yeSwgbnVtYmVyPixcclxuICBwYXR0ZXJuc0RldGVjdGVkOiBBcnJheTx7IHBhdHRlcm5faWQ6IHN0cmluZzsgb2NjdXJyZW5jZXM6IG51bWJlciB9PlxyXG4pOiBzdHJpbmdbXSB7XHJcbiAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuICAvLyBSZWNvbWVuZGFjaW9uZXMgYmFzYWRhcyBlbiBzZXZlcmlkYWRcclxuICBpZiAoZXZlbnRzQnlTZXZlcml0eS5jcml0aWNhbCA+IDApIHtcclxuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGBTZSBkZXRlY3Rhcm9uICR7ZXZlbnRzQnlTZXZlcml0eS5jcml0aWNhbH0gZXZlbnRvcyBjcsOtdGljb3MuIFJldmlzYXIgaW5tZWRpYXRhbWVudGUuYCk7XHJcbiAgfVxyXG5cclxuICBpZiAoZXZlbnRzQnlTZXZlcml0eS5oaWdoID4gMTApIHtcclxuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGBBbHRvIG7Dum1lcm8gZGUgZXZlbnRvcyBkZSBzZXZlcmlkYWQgYWx0YSAoJHtldmVudHNCeVNldmVyaXR5LmhpZ2h9KS4gQ29uc2lkZXJhciByZWZvcnphciBtZWRpZGFzIGRlIHNlZ3VyaWRhZC5gKTtcclxuICB9XHJcblxyXG4gIC8vIFJlY29tZW5kYWNpb25lcyBiYXNhZGFzIGVuIGNhdGVnb3LDrWFzXHJcbiAgaWYgKGV2ZW50c0J5Q2F0ZWdvcnkuYXV0aGVudGljYXRpb24gPiA1MCkge1xyXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goYE11Y2hvcyBldmVudG9zIGRlIGF1dGVudGljYWNpw7NuICgke2V2ZW50c0J5Q2F0ZWdvcnkuYXV0aGVudGljYXRpb259KS4gQ29uc2lkZXJhciBpbXBsZW1lbnRhciBNRkEuYCk7XHJcbiAgfVxyXG5cclxuICBpZiAoZXZlbnRzQnlDYXRlZ29yeS5hdXRob3JpemF0aW9uID4gMjApIHtcclxuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGBFdmVudG9zIGRlIGF1dG9yaXphY2nDs24gZWxldmFkb3MgKCR7ZXZlbnRzQnlDYXRlZ29yeS5hdXRob3JpemF0aW9ufSkuIFJldmlzYXIgcGVybWlzb3MgZGUgdXN1YXJpb3MuYCk7XHJcbiAgfVxyXG5cclxuICBpZiAoZXZlbnRzQnlDYXRlZ29yeS5zdXNwaWNpb3VzX2JlaGF2aW9yID4gNSkge1xyXG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goYEFjdGl2aWRhZCBzb3NwZWNob3NhIGRldGVjdGFkYSAoJHtldmVudHNCeUNhdGVnb3J5LnN1c3BpY2lvdXNfYmVoYXZpb3J9IGV2ZW50b3MpLiBNb25pdG9yZWFyIGRlIGNlcmNhLmApO1xyXG4gIH1cclxuXHJcbiAgLy8gUmVjb21lbmRhY2lvbmVzIGJhc2FkYXMgZW4gcGF0cm9uZXNcclxuICBjb25zdCBoaWdoRnJlcXVlbmN5UGF0dGVybnMgPSBwYXR0ZXJuc0RldGVjdGVkLmZpbHRlcihwID0+IHAub2NjdXJyZW5jZXMgPiAzKTtcclxuICBpZiAoaGlnaEZyZXF1ZW5jeVBhdHRlcm5zLmxlbmd0aCA+IDApIHtcclxuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGBQYXRyb25lcyBkZSBzZWd1cmlkYWQgcmVjdXJyZW50ZXMgZGV0ZWN0YWRvcy4gQ29uc2lkZXJhciBtZWRpZGFzIHByZXZlbnRpdmFzIGFkaWNpb25hbGVzLmApO1xyXG4gIH1cclxuXHJcbiAgLy8gUmVjb21lbmRhY2lvbmVzIGdlbmVyYWxlc1xyXG4gIGlmIChyZWNvbW1lbmRhdGlvbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnTm8gc2UgZGV0ZWN0YXJvbiBwcm9ibGVtYXMgY3LDrXRpY29zIGRlIHNlZ3VyaWRhZC4gTWFudGVuZXIgbW9uaXRvcmVvIHJlZ3VsYXIuJyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBGVU5DSU9ORVMgREUgR0VTVEnDk04gREUgQUxFUlRBU1xyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuLyoqXHJcbiAqIE9idGllbmUgYWxlcnRhcyBkZSBzZWd1cmlkYWQgYWN0aXZhc1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFjdGl2ZVNlY3VyaXR5QWxlcnRzKFxyXG4gIHVzZXJJZD86IHN0cmluZyxcclxuICBzZXZlcml0eT86IFNlY3VyaXR5U2V2ZXJpdHlcclxuKTogUHJvbWlzZTxTZWN1cml0eUFsZXJ0W10+IHtcclxuICB0cnkge1xyXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignU3VwYWJhc2UgYWRtaW4gY2xpZW50IG5vIGRpc3BvbmlibGUnKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9hbGVydHMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdzdGF0dXMnLCAnb3BlbicpXHJcbiAgICAgIC5vcmRlcignbGFzdF9vY2N1cnJlbmNlJywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xyXG5cclxuICAgIGlmICh1c2VySWQpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgndXNlcl9pZCcsIHVzZXJJZCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHNldmVyaXR5KSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3NldmVyaXR5Jywgc2V2ZXJpdHkpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YTogYWxlcnRzLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3Igb2J0ZW5pZW5kbyBhbGVydGFzOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGFsZXJ0cyB8fCBbXTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignW1NFQ1VSSVRZXSBFcnJvciBvYnRlbmllbmRvIGFsZXJ0YXMgYWN0aXZhczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQWN0dWFsaXphIGVsIGVzdGFkbyBkZSB1bmEgYWxlcnRhXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlU2VjdXJpdHlBbGVydChcclxuICBhbGVydElkOiBzdHJpbmcsXHJcbiAgdXBkYXRlczogUGFydGlhbDxQaWNrPFNlY3VyaXR5QWxlcnQsICdzdGF0dXMnIHwgJ2Fzc2lnbmVkX3RvJyB8ICdyZXNvbHV0aW9uX25vdGVzJz4+XHJcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gIHRyeSB7XHJcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm8gZGlzcG9uaWJsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3NlY3VyaXR5X2FsZXJ0cycpXHJcbiAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgIC4uLnVwZGF0ZXMsXHJcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0pXHJcbiAgICAgIC5lcSgnaWQnLCBhbGVydElkKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBhY3R1YWxpemFuZG8gYWxlcnRhOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coYFtTRUNVUklUWV0gQWxlcnRhICR7YWxlcnRJZH0gYWN0dWFsaXphZGE6ICR7SlNPTi5zdHJpbmdpZnkodXBkYXRlcyl9YCk7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignW1NFQ1VSSVRZXSBFcnJvciBhY3R1YWxpemFuZG8gYWxlcnRhOicsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXN1ZWx2ZSB1bmEgYWxlcnRhIGRlIHNlZ3VyaWRhZFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlc29sdmVTZWN1cml0eUFsZXJ0KFxyXG4gIGFsZXJ0SWQ6IHN0cmluZyxcclxuICByZXNvbHV0aW9uTm90ZXM6IHN0cmluZyxcclxuICByZXNvbHZlZEJ5OiBzdHJpbmdcclxuKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgcmV0dXJuIGF3YWl0IHVwZGF0ZVNlY3VyaXR5QWxlcnQoYWxlcnRJZCwge1xyXG4gICAgc3RhdHVzOiAncmVzb2x2ZWQnLFxyXG4gICAgYXNzaWduZWRfdG86IHJlc29sdmVkQnksXHJcbiAgICByZXNvbHV0aW9uX25vdGVzOiByZXNvbHV0aW9uTm90ZXNcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIE1hcmNhIHVuYSBhbGVydGEgY29tbyBmYWxzbyBwb3NpdGl2b1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1hcmtBbGVydEFzRmFsc2VQb3NpdGl2ZShcclxuICBhbGVydElkOiBzdHJpbmcsXHJcbiAgbm90ZXM6IHN0cmluZyxcclxuICBtYXJrZWRCeTogc3RyaW5nXHJcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gIHJldHVybiBhd2FpdCB1cGRhdGVTZWN1cml0eUFsZXJ0KGFsZXJ0SWQsIHtcclxuICAgIHN0YXR1czogJ2ZhbHNlX3Bvc2l0aXZlJyxcclxuICAgIGFzc2lnbmVkX3RvOiBtYXJrZWRCeSxcclxuICAgIHJlc29sdXRpb25fbm90ZXM6IG5vdGVzXHJcbiAgfSk7XHJcbn1cclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIEZVTkNJT05FUyBERSBNT05JVE9SRU8gRU4gVElFTVBPIFJFQUxcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbi8qKlxyXG4gKiBJbmljaWEgZWwgbW9uaXRvcmVvIGF1dG9tw6F0aWNvIGRlIHNlZ3VyaWRhZFxyXG4gKiDwn5qrIFRFTVBPUkFMTUVOVEUgREVTSEFCSUxJVEFETyBQQVJBIEVWSVRBUiBSRUNVUlNJw5NOXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gc3RhcnRTZWN1cml0eU1vbml0b3JpbmcoaW50ZXJ2YWxNaW51dGVzOiBudW1iZXIgPSA1KTogTm9kZUpTLlRpbWVvdXQge1xyXG4gIGNvbnNvbGUubG9nKGBbU0VDVVJJVFldIPCfmqsgTU9OSVRPUkVPIEFVVE9Nw4FUSUNPIFRFTVBPUkFMTUVOVEUgREVTSEFCSUxJVEFET2ApO1xyXG4gIGNvbnNvbGUubG9nKGBbU0VDVVJJVFldIPCfk4sgUmF6w7NuOiBFdml0YXIgbGxhbWFkYXMgcmVjdXJzaXZhcyBhIEFQSXMgZGUgYXV0aGApO1xyXG5cclxuICAvLyBSRVRPUk5BUiBVTiBUSU1FT1VUIERVTU1ZIFBBUkEgTk8gUk9NUEVSIEVMIEPDk0RJR08gUVVFIExPIExMQU1BXHJcbiAgcmV0dXJuIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ1tTRUNVUklUWV0gVGltZW91dCBkdW1teSBjb21wbGV0YWRvJyk7XHJcbiAgfSwgMTAwMCkgYXMgTm9kZUpTLlRpbWVvdXQ7XHJcblxyXG4gIC8vIEPDk0RJR08gQ09NRU5UQURPIFRFTVBPUkFMTUVOVEVcclxuICAvLyByZXR1cm4gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xyXG4gIC8vICAgdHJ5IHtcclxuICAvLyAgICAgY29uc29sZS5sb2coJ1tTRUNVUklUWV0gRWplY3V0YW5kbyBhbsOhbGlzaXMgYXV0b23DoXRpY28uLi4nKTtcclxuXHJcbiAgLy8gICAgIC8vIEFuYWxpemFyIHBhdHJvbmVzIGRlIHNlZ3VyaWRhZFxyXG4gIC8vICAgICBjb25zdCBhbGVydHMgPSBhd2FpdCBhbmFseXplU2VjdXJpdHlQYXR0ZXJucygpO1xyXG5cclxuICAvLyAgICAgaWYgKGFsZXJ0cy5sZW5ndGggPiAwKSB7XHJcbiAgLy8gICAgICAgY29uc29sZS5sb2coYFtTRUNVUklUWV0gJHthbGVydHMubGVuZ3RofSBudWV2YXMgYWxlcnRhcyBnZW5lcmFkYXNgKTtcclxuXHJcbiAgLy8gICAgICAgLy8gUHJvY2VzYXIgYWxlcnRhcyBjcsOtdGljYXMgaW5tZWRpYXRhbWVudGVcclxuICAvLyAgICAgICBjb25zdCBjcml0aWNhbEFsZXJ0cyA9IGFsZXJ0cy5maWx0ZXIoYSA9PiBhLnNldmVyaXR5ID09PSAnY3JpdGljYWwnKTtcclxuICAvLyAgICAgICBpZiAoY3JpdGljYWxBbGVydHMubGVuZ3RoID4gMCkge1xyXG4gIC8vICAgICAgICAgY29uc29sZS53YXJuKGBbU0VDVVJJVFldIMKhJHtjcml0aWNhbEFsZXJ0cy5sZW5ndGh9IGFsZXJ0YXMgY3LDrXRpY2FzIGRldGVjdGFkYXMhYCk7XHJcbiAgLy8gICAgICAgICAvLyBBcXXDrSBzZSBwb2Ryw61hbiBlbnZpYXIgbm90aWZpY2FjaW9uZXMgaW5tZWRpYXRhc1xyXG4gIC8vICAgICAgIH1cclxuICAvLyAgICAgfVxyXG5cclxuICAvLyAgICAgLy8gQWN0dWFsaXphciBtw6l0cmljYXNcclxuICAvLyAgICAgYXdhaXQgZ2V0U2VjdXJpdHlNZXRyaWNzKCk7XHJcblxyXG4gIC8vICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAvLyAgICAgY29uc29sZS5lcnJvcignW1NFQ1VSSVRZXSBFcnJvciBlbiBtb25pdG9yZW8gYXV0b23DoXRpY286JywgZXJyb3IpO1xyXG4gIC8vICAgfVxyXG4gIC8vIH0sIGludGVydmFsTWludXRlcyAqIDYwICogMTAwMCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZXRpZW5lIGVsIG1vbml0b3JlbyBhdXRvbcOhdGljb1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHN0b3BTZWN1cml0eU1vbml0b3JpbmcoaW50ZXJ2YWxJZDogTm9kZUpTLlRpbWVvdXQpOiB2b2lkIHtcclxuICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xyXG4gIGNvbnNvbGUubG9nKCdbU0VDVVJJVFldIE1vbml0b3JlbyBhdXRvbcOhdGljbyBkZXRlbmlkbycpO1xyXG59XHJcblxyXG4vKipcclxuICogRWplY3V0YSB1bmEgdmVyaWZpY2FjacOzbiBjb21wbGV0YSBkZSBzZWd1cmlkYWRcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBydW5TZWN1cml0eUhlYWx0aENoZWNrKCk6IFByb21pc2U8e1xyXG4gIHN0YXR1czogJ2hlYWx0aHknIHwgJ3dhcm5pbmcnIHwgJ2NyaXRpY2FsJztcclxuICBpc3N1ZXM6IHN0cmluZ1tdO1xyXG4gIHJlY29tbWVuZGF0aW9uczogc3RyaW5nW107XHJcbiAgbWV0cmljczogU2VjdXJpdHlNZXRyaWNzO1xyXG59PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKCdbU0VDVVJJVFldIEVqZWN1dGFuZG8gdmVyaWZpY2FjacOzbiBjb21wbGV0YSBkZSBzZWd1cmlkYWQuLi4nKTtcclxuXHJcbiAgICAvLyBPYnRlbmVyIG3DqXRyaWNhcyBhY3R1YWxlc1xyXG4gICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IGdldFNlY3VyaXR5TWV0cmljcygpO1xyXG5cclxuICAgIC8vIE9idGVuZXIgYWxlcnRhcyBhY3RpdmFzXHJcbiAgICBjb25zdCBhY3RpdmVBbGVydHMgPSBhd2FpdCBnZXRBY3RpdmVTZWN1cml0eUFsZXJ0cygpO1xyXG5cclxuICAgIGNvbnN0IGlzc3Vlczogc3RyaW5nW10gPSBbXTtcclxuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcclxuICAgIGxldCBzdGF0dXM6ICdoZWFsdGh5JyB8ICd3YXJuaW5nJyB8ICdjcml0aWNhbCcgPSAnaGVhbHRoeSc7XHJcblxyXG4gICAgLy8gRXZhbHVhciBlc3RhZG8gZGUgc2VndXJpZGFkXHJcbiAgICBpZiAobWV0cmljcy5jcml0aWNhbF9ldmVudHNfMjRoID4gMCkge1xyXG4gICAgICBpc3N1ZXMucHVzaChgJHttZXRyaWNzLmNyaXRpY2FsX2V2ZW50c18yNGh9IGV2ZW50b3MgY3LDrXRpY29zIGVuIGxhcyDDumx0aW1hcyAyNCBob3Jhc2ApO1xyXG4gICAgICBzdGF0dXMgPSAnY3JpdGljYWwnO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChtZXRyaWNzLmF1dGhfZmFpbHVyZXNfMjRoID4gMjApIHtcclxuICAgICAgaXNzdWVzLnB1c2goYEFsdG8gbsO6bWVybyBkZSBmYWxsb3MgZGUgYXV0ZW50aWNhY2nDs246ICR7bWV0cmljcy5hdXRoX2ZhaWx1cmVzXzI0aH1gKTtcclxuICAgICAgaWYgKHN0YXR1cyAhPT0gJ2NyaXRpY2FsJykge3N0YXR1cyA9ICd3YXJuaW5nJzt9XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlcmFyIGltcGxlbWVudGFyIG1lZGlkYXMgYW50aS1icnV0ZSBmb3JjZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChtZXRyaWNzLnN1c3BpY2lvdXNfYWN0aXZpdGllc18yNGggPiAxMCkge1xyXG4gICAgICBpc3N1ZXMucHVzaChgQWN0aXZpZGFkIHNvc3BlY2hvc2EgZWxldmFkYTogJHttZXRyaWNzLnN1c3BpY2lvdXNfYWN0aXZpdGllc18yNGh9IGV2ZW50b3NgKTtcclxuICAgICAgaWYgKHN0YXR1cyAhPT0gJ2NyaXRpY2FsJykge3N0YXR1cyA9ICd3YXJuaW5nJzt9XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdSZXZpc2FyIHBhdHJvbmVzIGRlIGFjdGl2aWRhZCBzb3NwZWNob3NhJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1ldHJpY3MuYWN0aXZlX2FsZXJ0cyA+IDUpIHtcclxuICAgICAgaXNzdWVzLnB1c2goYE11Y2hhcyBhbGVydGFzIGFjdGl2YXMgc2luIHJlc29sdmVyOiAke21ldHJpY3MuYWN0aXZlX2FsZXJ0c31gKTtcclxuICAgICAgaWYgKHN0YXR1cyAhPT0gJ2NyaXRpY2FsJykge3N0YXR1cyA9ICd3YXJuaW5nJzt9XHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdSZXZpc2FyIHkgcmVzb2x2ZXIgYWxlcnRhcyBwZW5kaWVudGVzJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1ldHJpY3Muc2VjdXJpdHlfc2NvcmUgPCA3MCkge1xyXG4gICAgICBpc3N1ZXMucHVzaChgU2NvcmUgZGUgc2VndXJpZGFkIGJham86ICR7bWV0cmljcy5zZWN1cml0eV9zY29yZX0vMTAwYCk7XHJcbiAgICAgIGlmIChzdGF0dXMgIT09ICdjcml0aWNhbCcpIHtzdGF0dXMgPSAnd2FybmluZyc7fVxyXG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnSW1wbGVtZW50YXIgbWVkaWRhcyBwYXJhIG1lam9yYXIgZWwgc2NvcmUgZGUgc2VndXJpZGFkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVjb21lbmRhY2lvbmVzIGdlbmVyYWxlc1xyXG4gICAgaWYgKGlzc3Vlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1Npc3RlbWEgZGUgc2VndXJpZGFkIGZ1bmNpb25hbmRvIGNvcnJlY3RhbWVudGUnKTtcclxuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ01hbnRlbmVyIG1vbml0b3JlbyByZWd1bGFyIHkgYWN0dWFsaXphY2lvbmVzIGRlIHNlZ3VyaWRhZCcpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKGBbU0VDVVJJVFldIFZlcmlmaWNhY2nDs24gY29tcGxldGFkYSAtIEVzdGFkbzogJHtzdGF0dXN9YCk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdHVzLFxyXG4gICAgICBpc3N1ZXMsXHJcbiAgICAgIHJlY29tbWVuZGF0aW9ucyxcclxuICAgICAgbWV0cmljc1xyXG4gICAgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignW1NFQ1VSSVRZXSBFcnJvciBlbiB2ZXJpZmljYWNpw7NuIGRlIHNlZ3VyaWRhZDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdGF0dXM6ICdjcml0aWNhbCcsXHJcbiAgICAgIGlzc3VlczogWydFcnJvciBlamVjdXRhbmRvIHZlcmlmaWNhY2nDs24gZGUgc2VndXJpZGFkJ10sXHJcbiAgICAgIHJlY29tbWVuZGF0aW9uczogWydSZXZpc2FyIGxvZ3MgZGVsIHNpc3RlbWEnXSxcclxuICAgICAgbWV0cmljczogYXdhaXQgZ2V0U2VjdXJpdHlNZXRyaWNzKClcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBGVU5DSU9ORVMgREUgVVRJTElEQURcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbi8qKlxyXG4gKiBMaW1waWEgZXZlbnRvcyBkZSBzZWd1cmlkYWQgYW50aWd1b3NcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwT2xkU2VjdXJpdHlFdmVudHMoZGF5c1RvS2VlcDogbnVtYmVyID0gOTApOiBQcm9taXNlPG51bWJlcj4ge1xyXG4gIHRyeSB7XHJcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBhYmFzZSBhZG1pbiBjbGllbnQgbm8gZGlzcG9uaWJsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGN1dG9mZkRhdGUgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gZGF5c1RvS2VlcCAqIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKCk7XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc2VjdXJpdHlfZXZlbnRzJylcclxuICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgIC5sdCgndGltZXN0YW1wJywgY3V0b2ZmRGF0ZSk7XHJcblxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgbGltcGlhbmRvIGV2ZW50b3M6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBkZWxldGVkQ291bnQgPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YS5sZW5ndGggOiAwO1xyXG4gICAgY29uc29sZS5sb2coYFtTRUNVUklUWV0gTGltcGllemEgY29tcGxldGFkYTogJHtkZWxldGVkQ291bnR9IGV2ZW50b3MgZWxpbWluYWRvc2ApO1xyXG5cclxuICAgIHJldHVybiBkZWxldGVkQ291bnQ7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tTRUNVUklUWV0gRXJyb3IgZW4gbGltcGllemEgZGUgZXZlbnRvczonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBFeHBvcnRhIGV2ZW50b3MgZGUgc2VndXJpZGFkIHBhcmEgYW7DoWxpc2lzIGV4dGVybm9cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHBvcnRTZWN1cml0eUV2ZW50cyhcclxuICBzdGFydERhdGU6IERhdGUsXHJcbiAgZW5kRGF0ZTogRGF0ZSxcclxuICBmb3JtYXQ6ICdqc29uJyB8ICdjc3YnID0gJ2pzb24nXHJcbik6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgdHJ5IHtcclxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGFkbWluIGNsaWVudCBubyBkaXNwb25pYmxlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhOiBldmVudHMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9ldmVudHMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmd0ZSgndGltZXN0YW1wJywgc3RhcnREYXRlLnRvSVNPU3RyaW5nKCkpXHJcbiAgICAgIC5sdGUoJ3RpbWVzdGFtcCcsIGVuZERhdGUudG9JU09TdHJpbmcoKSlcclxuICAgICAgLm9yZGVyKCd0aW1lc3RhbXAnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBleHBvcnRhbmRvIGV2ZW50b3M6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZm9ybWF0ID09PSAnanNvbicpIHtcclxuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGV2ZW50cywgbnVsbCwgMik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBGb3JtYXRvIENTVlxyXG4gICAgICBpZiAoIWV2ZW50cyB8fCBldmVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuICdObyBoYXkgZXZlbnRvcyBwYXJhIGV4cG9ydGFyJztcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgaGVhZGVycyA9IE9iamVjdC5rZXlzKGV2ZW50c1swXSkuam9pbignLCcpO1xyXG4gICAgICBjb25zdCByb3dzID0gZXZlbnRzLm1hcChldmVudCA9PlxyXG4gICAgICAgIE9iamVjdC52YWx1ZXMoZXZlbnQpLm1hcCh2YWx1ZSA9PlxyXG4gICAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IGBcIiR7dmFsdWUucmVwbGFjZSgvXCIvZywgJ1wiXCInKX1cImAgOiB2YWx1ZVxyXG4gICAgICAgICkuam9pbignLCcpXHJcbiAgICAgICk7XHJcblxyXG4gICAgICByZXR1cm4gW2hlYWRlcnMsIC4uLnJvd3NdLmpvaW4oJ1xcbicpO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbU0VDVVJJVFldIEVycm9yIGV4cG9ydGFuZG8gZXZlbnRvczonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbIkRFRkFVTFRfU0VDVVJJVFlfUEFUVEVSTlMiLCJhbmFseXplU2VjdXJpdHlQYXR0ZXJucyIsImNsZWFudXBPbGRTZWN1cml0eUV2ZW50cyIsImV4cG9ydFNlY3VyaXR5RXZlbnRzIiwiZ2VuZXJhdGVTZWN1cml0eVJlcG9ydCIsImdldEFjdGl2ZVNlY3VyaXR5QWxlcnRzIiwiZ2V0U2VjdXJpdHlNZXRyaWNzIiwibWFya0FsZXJ0QXNGYWxzZVBvc2l0aXZlIiwicmVzb2x2ZVNlY3VyaXR5QWxlcnQiLCJydW5TZWN1cml0eUhlYWx0aENoZWNrIiwic3RhcnRTZWN1cml0eU1vbml0b3JpbmciLCJzdG9wU2VjdXJpdHlNb25pdG9yaW5nIiwidXBkYXRlU2VjdXJpdHlBbGVydCIsImlkIiwibmFtZSIsImRlc2NyaXB0aW9uIiwic2V2ZXJpdHkiLCJ0aW1lV2luZG93IiwidGhyZXNob2xkIiwiZW5hYmxlZCIsImNvbmRpdGlvbnMiLCJmaWVsZCIsIm9wZXJhdG9yIiwidmFsdWUiLCJ3ZWlnaHQiLCJhY3Rpb25zIiwidHlwZSIsInBhcmFtZXRlcnMiLCJub3RpZnlfYWRtaW5zIiwicHJpb3JpdHkiLCJub3RpZnlfdXNlciIsInVzZXJJZCIsInRpbWVXaW5kb3dIb3VycyIsImNvbnNvbGUiLCJsb2ciLCJzdXBhYmFzZUFkbWluIiwiRXJyb3IiLCJ0aW1lVGhyZXNob2xkIiwiRGF0ZSIsIm5vdyIsInRvSVNPU3RyaW5nIiwiYWxlcnRzIiwicXVlcnkiLCJmcm9tIiwic2VsZWN0IiwiZ3RlIiwib3JkZXIiLCJhc2NlbmRpbmciLCJlcSIsImRhdGEiLCJldmVudHMiLCJlcnJvciIsIm1lc3NhZ2UiLCJsZW5ndGgiLCJwYXR0ZXJuIiwicGF0dGVybkFsZXJ0cyIsImRldGVjdFBhdHRlcm4iLCJwdXNoIiwiaW5zZXJ0RXJyb3IiLCJpbnNlcnQiLCJldmVudHNCeVVzZXIiLCJyZWR1Y2UiLCJhY2MiLCJldmVudCIsInVzZXJfaWQiLCJ1c2VyRXZlbnRzIiwiT2JqZWN0IiwiZW50cmllcyIsIm1hdGNoaW5nRXZlbnRzIiwiZmlsdGVyIiwibWF0Y2hlc1BhdHRlcm5Db25kaXRpb25zIiwic29ydGVkRXZlbnRzIiwic29ydCIsImEiLCJiIiwidGltZXN0YW1wIiwiZ2V0VGltZSIsImkiLCJ3aW5kb3dTdGFydCIsIndpbmRvd0VuZCIsImV2ZW50c0luV2luZG93IiwiZXZlbnRUaW1lIiwiYWxlcnQiLCJwYXR0ZXJuX2lkIiwidGl0bGUiLCJldmVudF9jb3VudCIsImZpcnN0X29jY3VycmVuY2UiLCJsYXN0X29jY3VycmVuY2UiLCJzdGF0dXMiLCJtZXRhZGF0YSIsInBhdHRlcm5fbmFtZSIsIm1hcCIsImUiLCJ0aW1lX3dpbmRvd19taW51dGVzIiwiZXhlY3V0ZVBhdHRlcm5BY3Rpb25zIiwiZXZlcnkiLCJjb25kaXRpb24iLCJldmVudFZhbHVlIiwiaW5jbHVkZXMiLCJOdW1iZXIiLCJBcnJheSIsImlzQXJyYXkiLCJhY3Rpb24iLCJsb2dTZWN1cml0eUV2ZW50IiwiZXZlbnRfdHlwZSIsImV2ZW50X2NhdGVnb3J5IiwiYWxlcnRfaWQiLCJ3YXJuIiwiY2FjaGUiLCJDYWNoZU1hbmFnZXIiLCJnZXRJbnN0YW5jZSIsImNhY2hlS2V5IiwiY2FjaGVkIiwiZ2V0IiwiQ0FDSEVfQ09ORklHUyIsIlVTRVJfU0VTU0lPTiIsImxhc3QyNGgiLCJhbGVydHNFcnJvciIsInRvdGFsRXZlbnRzIiwiY3JpdGljYWxFdmVudHMiLCJ1bmlxdWVVc2VycyIsIlNldCIsInNpemUiLCJhdXRoRmFpbHVyZXMiLCJzdXNwaWNpb3VzQWN0aXZpdGllcyIsImFjdGl2ZUFsZXJ0cyIsInNlY3VyaXR5U2NvcmUiLCJNYXRoIiwibWF4IiwibWluIiwibWV0cmljcyIsInRvdGFsX2V2ZW50c18yNGgiLCJjcml0aWNhbF9ldmVudHNfMjRoIiwidW5pcXVlX3VzZXJzXzI0aCIsImF1dGhfZmFpbHVyZXNfMjRoIiwic3VzcGljaW91c19hY3Rpdml0aWVzXzI0aCIsImJsb2NrZWRfdXNlcnMiLCJhY3RpdmVfYWxlcnRzIiwiYXZnX3Jlc3BvbnNlX3RpbWUiLCJzZWN1cml0eV9zY29yZSIsInNldCIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJsdGUiLCJldmVudHNCeVNldmVyaXR5IiwibG93IiwibWVkaXVtIiwiaGlnaCIsImNyaXRpY2FsIiwiZXZlbnRzQnlDYXRlZ29yeSIsImF1dGhlbnRpY2F0aW9uIiwiYXV0aG9yaXphdGlvbiIsImRhdGFfYWNjZXNzIiwiYWRtaW5fb3BlcmF0aW9ucyIsInN1c3BpY2lvdXNfYmVoYXZpb3IiLCJ1c2VyQ291bnRzIiwiaXBDb3VudHMiLCJmb3JFYWNoIiwiaXBfYWRkcmVzcyIsInRvcFVzZXJzIiwic2xpY2UiLCJ0b3BJcHMiLCJwYXR0ZXJuc0RldGVjdGVkIiwicGF0dGVybkNvdW50cyIsIm9jY3VycmVuY2VzIiwicmVjb21tZW5kYXRpb25zIiwiZ2VuZXJhdGVTZWN1cml0eVJlY29tbWVuZGF0aW9ucyIsInJlcG9ydCIsInBlcmlvZF9zdGFydCIsInBlcmlvZF9lbmQiLCJ0b3RhbF9ldmVudHMiLCJldmVudHNfYnlfc2V2ZXJpdHkiLCJldmVudHNfYnlfY2F0ZWdvcnkiLCJ0b3BfdXNlcnMiLCJ0b3BfaXBzIiwicGF0dGVybnNfZGV0ZWN0ZWQiLCJnZW5lcmF0ZWRfYXQiLCJoaWdoRnJlcXVlbmN5UGF0dGVybnMiLCJwIiwiYWxlcnRJZCIsInVwZGF0ZXMiLCJ1cGRhdGUiLCJ1cGRhdGVkX2F0IiwiSlNPTiIsInN0cmluZ2lmeSIsInJlc29sdXRpb25Ob3RlcyIsInJlc29sdmVkQnkiLCJhc3NpZ25lZF90byIsInJlc29sdXRpb25fbm90ZXMiLCJub3RlcyIsIm1hcmtlZEJ5IiwiaW50ZXJ2YWxNaW51dGVzIiwic2V0VGltZW91dCIsImludGVydmFsSWQiLCJjbGVhckludGVydmFsIiwiaXNzdWVzIiwiZGF5c1RvS2VlcCIsImN1dG9mZkRhdGUiLCJkZWxldGUiLCJsdCIsImRlbGV0ZWRDb3VudCIsImZvcm1hdCIsImhlYWRlcnMiLCJrZXlzIiwiam9pbiIsInJvd3MiLCJ2YWx1ZXMiLCJyZXBsYWNlIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0M7Ozs7Ozs7Ozs7O1FBc0ZZQTtlQUFBQTs7UUErRlNDO2VBQUFBOztRQTh0QkFDO2VBQUFBOztRQThCQUM7ZUFBQUE7O1FBamNBQztlQUFBQTs7UUF3TEFDO2VBQUFBOztRQWpSQUM7ZUFBQUE7O1FBdVdBQztlQUFBQTs7UUFmQUM7ZUFBQUE7O1FBbUZBQztlQUFBQTs7UUFoRE5DO2VBQUFBOztRQXdDQUM7ZUFBQUE7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