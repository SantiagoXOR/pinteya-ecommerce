28d73f443d4a634f56e4bafe417ed948
// ===================================
// PINTEYA E-COMMERCE - CACHE MANAGER
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get CACHE_CONFIGS () {
        return CACHE_CONFIGS;
    },
    get CacheManager () {
        return CacheManager;
    },
    get CacheUtils () {
        return CacheUtils;
    },
    get cacheManager () {
        return cacheManager;
    },
    get cached () {
        return cached;
    }
});
const _redis = require("./integrations/redis");
const _logger = require("./enterprise/logger");
const CACHE_CONFIGS = {
    // Para respuestas de MercadoPago (corta duración)
    MERCADOPAGO_RESPONSE: {
        ttl: 300,
        prefix: 'mp_response',
        compress: true,
        serialize: true
    },
    // Para información de pagos (duración media)
    PAYMENT_INFO: {
        ttl: 1800,
        prefix: 'payment_info',
        compress: false,
        serialize: true
    },
    // Para configuraciones del sistema (larga duración)
    SYSTEM_CONFIG: {
        ttl: 3600,
        prefix: 'sys_config',
        compress: false,
        serialize: true
    },
    // Para datos de productos (duración media)
    PRODUCT_DATA: {
        ttl: 900,
        prefix: 'product',
        compress: true,
        serialize: true
    },
    // Para sesiones de usuario (corta duración)
    USER_SESSION: {
        ttl: 600,
        prefix: 'user_session',
        compress: false,
        serialize: true
    }
};
class CacheManager {
    constructor(){}
    static getInstance() {
        if (!CacheManager.instance) {
            CacheManager.instance = new CacheManager();
        }
        return CacheManager.instance;
    }
    /**
   * Genera clave de cache
   */ generateKey(config, key) {
        return `cache:${config.prefix}:${key}`;
    }
    /**
   * Serializa datos para almacenamiento
   */ serialize(data, config) {
        try {
            let serialized = config.serialize ? JSON.stringify(data) : data.toString();
            if (config.compress && serialized.length > 1000) {
                // Implementación básica de compresión (en producción usar zlib)
                serialized = this.simpleCompress(serialized);
            }
            return serialized;
        } catch (error) {
            _logger.logger.error(_logger.LogCategory.API, 'Serialization error', error);
            throw error;
        }
    }
    /**
   * Deserializa datos del cache
   */ deserialize(data, config) {
        try {
            let deserialized = data;
            if (config.compress && data.startsWith('COMPRESSED:')) {
                deserialized = this.simpleDecompress(data);
            }
            return config.serialize ? JSON.parse(deserialized) : deserialized;
        } catch (error) {
            _logger.logger.error(_logger.LogCategory.API, 'Deserialization error', error);
            throw error;
        }
    }
    /**
   * Compresión simple (placeholder para implementación real)
   */ simpleCompress(data) {
        // En producción, usar zlib o similar
        return `COMPRESSED:${data}`;
    }
    /**
   * Descompresión simple (placeholder para implementación real)
   */ simpleDecompress(data) {
        return data.replace('COMPRESSED:', '');
    }
    /**
   * Obtiene un valor del cache
   */ async get(key, config) {
        const startTime = Date.now();
        const cacheKey = this.generateKey(config, key);
        try {
            const cached = await _redis.redisCache.get(cacheKey);
            if (cached === null) {
                _logger.logger.info(_logger.LogCategory.API, 'Cache miss');
                return null;
            }
            const result = this.deserialize(cached, config);
            _logger.logger.info(_logger.LogCategory.API, 'Cache hit');
            return result;
        } catch (error) {
            _logger.logger.error(_logger.LogCategory.API, 'Cache get error', error);
            return null; // Fallar silenciosamente para no afectar la aplicación
        }
    }
    /**
   * Establece un valor en el cache
   */ async set(key, value, config) {
        const startTime = Date.now();
        const cacheKey = this.generateKey(config, key);
        try {
            const serialized = this.serialize(value, config);
            const success = await _redis.redisCache.set(cacheKey, serialized, config.ttl);
            _logger.logger.info(_logger.LogCategory.API, 'Cache set');
            return success;
        } catch (error) {
            _logger.logger.error(_logger.LogCategory.API, 'Cache set error', error);
            return false;
        }
    }
    /**
   * Elimina un valor del cache
   */ async delete(key, config) {
        const cacheKey = this.generateKey(config, key);
        try {
            const success = await _redis.redisCache.del(cacheKey);
            _logger.logger.info(_logger.LogCategory.API, 'Cache delete');
            return success;
        } catch (error) {
            _logger.logger.error(_logger.LogCategory.API, 'Cache delete error', error);
            return false;
        }
    }
    /**
   * Obtiene o establece un valor (patrón cache-aside)
   */ async getOrSet(key, fetcher, config) {
        // Intentar obtener del cache primero
        const cached = await this.get(key, config);
        if (cached !== null) {
            return cached;
        }
        // Si no está en cache, obtener del origen
        const startTime = Date.now();
        try {
            const value = await fetcher();
            // Almacenar en cache de forma asíncrona
            this.set(key, value, config).catch((error)=>{
                _logger.logger.warn(_logger.LogCategory.API, 'Background cache set failed');
            });
            _logger.logger.info(_logger.LogCategory.API, 'Cache miss - fetched from source');
            return value;
        } catch (error) {
            _logger.logger.error(_logger.LogCategory.API, 'Fetcher error in getOrSet', error);
            throw error;
        }
    }
    /**
   * Invalida cache por patrón
   */ async invalidatePattern(pattern, config) {
        const fullPattern = this.generateKey(config, pattern);
        try {
            // En Redis real, usaríamos SCAN + DEL para patrones
            // Por simplicidad, aquí solo registramos la operación
            _logger.logger.info(_logger.LogCategory.API, 'Cache invalidation requested');
            // TODO: Implementar invalidación real por patrón
            return 0;
        } catch (error) {
            _logger.logger.error(_logger.LogCategory.API, 'Cache invalidation error', error);
            return 0;
        }
    }
    /**
   * Obtiene estadísticas del cache
   */ async getStats() {
        try {
            // En implementación real, obtendríamos estas métricas de Redis
            return {
                hits: 0,
                misses: 0,
                hitRate: 0,
                totalKeys: 0
            };
        } catch (error) {
            _logger.logger.error(_logger.LogCategory.API, 'Cache stats error', error);
            return {
                hits: 0,
                misses: 0,
                hitRate: 0,
                totalKeys: 0
            };
        }
    }
    /**
   * Limpia todo el cache de un prefijo
   */ async clear(config) {
        try {
            _logger.logger.info(_logger.LogCategory.API, 'Cache clear requested');
            // TODO: Implementar limpieza real por prefijo
            return true;
        } catch (error) {
            _logger.logger.error(_logger.LogCategory.API, 'Cache clear error', error);
            return false;
        }
    }
}
const cacheManager = CacheManager.getInstance();
function cached(config, keyGenerator) {
    return function(target, propertyName, descriptor) {
        const method = descriptor.value;
        descriptor.value = async function(...args) {
            const key = keyGenerator ? keyGenerator(...args) : `${propertyName}:${JSON.stringify(args)}`;
            return cacheManager.getOrSet(key, ()=>method.apply(this, args), config);
        };
        return descriptor;
    };
}
const CacheUtils = {
    /**
   * Cache para respuestas de MercadoPago
   */ async cacheMercadoPagoResponse (key, fetcher) {
        return cacheManager.getOrSet(key, fetcher, CACHE_CONFIGS.MERCADOPAGO_RESPONSE);
    },
    /**
   * Cache para información de pagos
   */ async cachePaymentInfo (paymentId, fetcher) {
        return cacheManager.getOrSet(`payment:${paymentId}`, fetcher, CACHE_CONFIGS.PAYMENT_INFO);
    },
    /**
   * Cache para datos de productos
   */ async cacheProductData (productId, fetcher) {
        return cacheManager.getOrSet(`product:${productId}`, fetcher, CACHE_CONFIGS.PRODUCT_DATA);
    },
    /**
   * Invalida cache de un pago específico
   */ async invalidatePayment (paymentId) {
        return cacheManager.delete(`payment:${paymentId}`, CACHE_CONFIGS.PAYMENT_INFO);
    },
    /**
   * Invalida cache de un producto específico
   */ async invalidateProduct (productId) {
        return cacheManager.delete(`product:${productId}`, CACHE_CONFIGS.PRODUCT_DATA);
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxjYWNoZS1tYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIFBJTlRFWUEgRS1DT01NRVJDRSAtIENBQ0hFIE1BTkFHRVJcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbmltcG9ydCB7IHJlZGlzQ2FjaGUgfSBmcm9tICcuL2ludGVncmF0aW9ucy9yZWRpcyc7XHJcbmltcG9ydCB7IGxvZ2dlciwgTG9nTGV2ZWwsIExvZ0NhdGVnb3J5IH0gZnJvbSAnLi9lbnRlcnByaXNlL2xvZ2dlcic7XHJcblxyXG4vLyBDb25maWd1cmFjacOzbiBkZSBjYWNoZVxyXG5leHBvcnQgaW50ZXJmYWNlIENhY2hlQ29uZmlnIHtcclxuICB0dGw6IG51bWJlcjsgICAgICAgICAgIC8vIFRpbWUgdG8gbGl2ZSBlbiBzZWd1bmRvc1xyXG4gIHByZWZpeDogc3RyaW5nOyAgICAgICAgLy8gUHJlZmlqbyBwYXJhIGxhcyBjbGF2ZXNcclxuICBjb21wcmVzcz86IGJvb2xlYW47ICAgIC8vIENvbXByaW1pciBkYXRvcyBncmFuZGVzXHJcbiAgc2VyaWFsaXplPzogYm9vbGVhbjsgICAvLyBTZXJpYWxpemFyIG9iamV0b3MgY29tcGxlam9zXHJcbn1cclxuXHJcbi8vIENvbmZpZ3VyYWNpb25lcyBwcmVkZWZpbmlkYXNcclxuZXhwb3J0IGNvbnN0IENBQ0hFX0NPTkZJR1MgPSB7XHJcbiAgLy8gUGFyYSByZXNwdWVzdGFzIGRlIE1lcmNhZG9QYWdvIChjb3J0YSBkdXJhY2nDs24pXHJcbiAgTUVSQ0FET1BBR09fUkVTUE9OU0U6IHtcclxuICAgIHR0bDogMzAwLCAgICAgICAgICAgICAgLy8gNSBtaW51dG9zXHJcbiAgICBwcmVmaXg6ICdtcF9yZXNwb25zZScsXHJcbiAgICBjb21wcmVzczogdHJ1ZSxcclxuICAgIHNlcmlhbGl6ZTogdHJ1ZSxcclxuICB9LFxyXG4gIFxyXG4gIC8vIFBhcmEgaW5mb3JtYWNpw7NuIGRlIHBhZ29zIChkdXJhY2nDs24gbWVkaWEpXHJcbiAgUEFZTUVOVF9JTkZPOiB7XHJcbiAgICB0dGw6IDE4MDAsICAgICAgICAgICAgIC8vIDMwIG1pbnV0b3NcclxuICAgIHByZWZpeDogJ3BheW1lbnRfaW5mbycsXHJcbiAgICBjb21wcmVzczogZmFsc2UsXHJcbiAgICBzZXJpYWxpemU6IHRydWUsXHJcbiAgfSxcclxuICBcclxuICAvLyBQYXJhIGNvbmZpZ3VyYWNpb25lcyBkZWwgc2lzdGVtYSAobGFyZ2EgZHVyYWNpw7NuKVxyXG4gIFNZU1RFTV9DT05GSUc6IHtcclxuICAgIHR0bDogMzYwMCwgICAgICAgICAgICAgLy8gMSBob3JhXHJcbiAgICBwcmVmaXg6ICdzeXNfY29uZmlnJyxcclxuICAgIGNvbXByZXNzOiBmYWxzZSxcclxuICAgIHNlcmlhbGl6ZTogdHJ1ZSxcclxuICB9LFxyXG4gIFxyXG4gIC8vIFBhcmEgZGF0b3MgZGUgcHJvZHVjdG9zIChkdXJhY2nDs24gbWVkaWEpXHJcbiAgUFJPRFVDVF9EQVRBOiB7XHJcbiAgICB0dGw6IDkwMCwgICAgICAgICAgICAgIC8vIDE1IG1pbnV0b3NcclxuICAgIHByZWZpeDogJ3Byb2R1Y3QnLFxyXG4gICAgY29tcHJlc3M6IHRydWUsXHJcbiAgICBzZXJpYWxpemU6IHRydWUsXHJcbiAgfSxcclxuICBcclxuICAvLyBQYXJhIHNlc2lvbmVzIGRlIHVzdWFyaW8gKGNvcnRhIGR1cmFjacOzbilcclxuICBVU0VSX1NFU1NJT046IHtcclxuICAgIHR0bDogNjAwLCAgICAgICAgICAgICAgLy8gMTAgbWludXRvc1xyXG4gICAgcHJlZml4OiAndXNlcl9zZXNzaW9uJyxcclxuICAgIGNvbXByZXNzOiBmYWxzZSxcclxuICAgIHNlcmlhbGl6ZTogdHJ1ZSxcclxuICB9LFxyXG59IGFzIGNvbnN0O1xyXG5cclxuLyoqXHJcbiAqIENsYXNlIHByaW5jaXBhbCBwYXJhIG1hbmVqbyBkZSBjYWNoZVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIENhY2hlTWFuYWdlciB7XHJcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IENhY2hlTWFuYWdlcjtcclxuXHJcbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHt9XHJcblxyXG4gIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBDYWNoZU1hbmFnZXIge1xyXG4gICAgaWYgKCFDYWNoZU1hbmFnZXIuaW5zdGFuY2UpIHtcclxuICAgICAgQ2FjaGVNYW5hZ2VyLmluc3RhbmNlID0gbmV3IENhY2hlTWFuYWdlcigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIENhY2hlTWFuYWdlci5pbnN0YW5jZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYSBjbGF2ZSBkZSBjYWNoZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2VuZXJhdGVLZXkoY29uZmlnOiBDYWNoZUNvbmZpZywga2V5OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIGBjYWNoZToke2NvbmZpZy5wcmVmaXh9OiR7a2V5fWA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXJpYWxpemEgZGF0b3MgcGFyYSBhbG1hY2VuYW1pZW50b1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc2VyaWFsaXplPFQ+KGRhdGE6IFQsIGNvbmZpZzogQ2FjaGVDb25maWcpOiBzdHJpbmcge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbGV0IHNlcmlhbGl6ZWQgPSBjb25maWcuc2VyaWFsaXplID8gSlNPTi5zdHJpbmdpZnkoZGF0YSkgOiBkYXRhLnRvU3RyaW5nKCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoY29uZmlnLmNvbXByZXNzICYmIHNlcmlhbGl6ZWQubGVuZ3RoID4gMTAwMCkge1xyXG4gICAgICAgIC8vIEltcGxlbWVudGFjacOzbiBiw6FzaWNhIGRlIGNvbXByZXNpw7NuIChlbiBwcm9kdWNjacOzbiB1c2FyIHpsaWIpXHJcbiAgICAgICAgc2VyaWFsaXplZCA9IHRoaXMuc2ltcGxlQ29tcHJlc3Moc2VyaWFsaXplZCk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiBzZXJpYWxpemVkO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKExvZ0NhdGVnb3J5LkFQSSwgJ1NlcmlhbGl6YXRpb24gZXJyb3InLCBlcnJvciBhcyBFcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVzZXJpYWxpemEgZGF0b3MgZGVsIGNhY2hlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkZXNlcmlhbGl6ZTxUPihkYXRhOiBzdHJpbmcsIGNvbmZpZzogQ2FjaGVDb25maWcpOiBUIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGxldCBkZXNlcmlhbGl6ZWQgPSBkYXRhO1xyXG4gICAgICBcclxuICAgICAgaWYgKGNvbmZpZy5jb21wcmVzcyAmJiBkYXRhLnN0YXJ0c1dpdGgoJ0NPTVBSRVNTRUQ6JykpIHtcclxuICAgICAgICBkZXNlcmlhbGl6ZWQgPSB0aGlzLnNpbXBsZURlY29tcHJlc3MoZGF0YSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiBjb25maWcuc2VyaWFsaXplID8gSlNPTi5wYXJzZShkZXNlcmlhbGl6ZWQpIDogZGVzZXJpYWxpemVkO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKExvZ0NhdGVnb3J5LkFQSSwgJ0Rlc2VyaWFsaXphdGlvbiBlcnJvcicsIGVycm9yIGFzIEVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb21wcmVzacOzbiBzaW1wbGUgKHBsYWNlaG9sZGVyIHBhcmEgaW1wbGVtZW50YWNpw7NuIHJlYWwpXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzaW1wbGVDb21wcmVzcyhkYXRhOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgLy8gRW4gcHJvZHVjY2nDs24sIHVzYXIgemxpYiBvIHNpbWlsYXJcclxuICAgIHJldHVybiBgQ09NUFJFU1NFRDoke2RhdGF9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERlc2NvbXByZXNpw7NuIHNpbXBsZSAocGxhY2Vob2xkZXIgcGFyYSBpbXBsZW1lbnRhY2nDs24gcmVhbClcclxuICAgKi9cclxuICBwcml2YXRlIHNpbXBsZURlY29tcHJlc3MoZGF0YTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIHJldHVybiBkYXRhLnJlcGxhY2UoJ0NPTVBSRVNTRUQ6JywgJycpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogT2J0aWVuZSB1biB2YWxvciBkZWwgY2FjaGVcclxuICAgKi9cclxuICBhc3luYyBnZXQ8VD4oa2V5OiBzdHJpbmcsIGNvbmZpZzogQ2FjaGVDb25maWcpOiBQcm9taXNlPFQgfCBudWxsPiB7XHJcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgY29uc3QgY2FjaGVLZXkgPSB0aGlzLmdlbmVyYXRlS2V5KGNvbmZpZywga2V5KTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCByZWRpc0NhY2hlLmdldChjYWNoZUtleSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoY2FjaGVkID09PSBudWxsKSB7XHJcbiAgICAgICAgbG9nZ2VyLmluZm8oTG9nQ2F0ZWdvcnkuQVBJLCAnQ2FjaGUgbWlzcycpO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmRlc2VyaWFsaXplPFQ+KGNhY2hlZCwgY29uZmlnKTtcclxuICAgICAgXHJcbiAgICAgIGxvZ2dlci5pbmZvKExvZ0NhdGVnb3J5LkFQSSwgJ0NhY2hlIGhpdCcpO1xyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcihMb2dDYXRlZ29yeS5BUEksICdDYWNoZSBnZXQgZXJyb3InLCBlcnJvciBhcyBFcnJvcik7XHJcbiAgICAgIHJldHVybiBudWxsOyAvLyBGYWxsYXIgc2lsZW5jaW9zYW1lbnRlIHBhcmEgbm8gYWZlY3RhciBsYSBhcGxpY2FjacOzblxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRXN0YWJsZWNlIHVuIHZhbG9yIGVuIGVsIGNhY2hlXHJcbiAgICovXHJcbiAgYXN5bmMgc2V0PFQ+KGtleTogc3RyaW5nLCB2YWx1ZTogVCwgY29uZmlnOiBDYWNoZUNvbmZpZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgIGNvbnN0IGNhY2hlS2V5ID0gdGhpcy5nZW5lcmF0ZUtleShjb25maWcsIGtleSk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc2VyaWFsaXplZCA9IHRoaXMuc2VyaWFsaXplPFQ+KHZhbHVlLCBjb25maWcpO1xyXG4gICAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgcmVkaXNDYWNoZS5zZXQoY2FjaGVLZXksIHNlcmlhbGl6ZWQsIGNvbmZpZy50dGwpO1xyXG4gICAgICBcclxuICAgICAgbG9nZ2VyLmluZm8oTG9nQ2F0ZWdvcnkuQVBJLCAnQ2FjaGUgc2V0Jyk7XHJcblxyXG4gICAgICByZXR1cm4gc3VjY2VzcztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcihMb2dDYXRlZ29yeS5BUEksICdDYWNoZSBzZXQgZXJyb3InLCBlcnJvciBhcyBFcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEVsaW1pbmEgdW4gdmFsb3IgZGVsIGNhY2hlXHJcbiAgICovXHJcbiAgYXN5bmMgZGVsZXRlKGtleTogc3RyaW5nLCBjb25maWc6IENhY2hlQ29uZmlnKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCBjYWNoZUtleSA9IHRoaXMuZ2VuZXJhdGVLZXkoY29uZmlnLCBrZXkpO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCByZWRpc0NhY2hlLmRlbChjYWNoZUtleSk7XHJcbiAgICAgIFxyXG4gICAgICBsb2dnZXIuaW5mbyhMb2dDYXRlZ29yeS5BUEksICdDYWNoZSBkZWxldGUnKTtcclxuXHJcbiAgICAgIHJldHVybiBzdWNjZXNzO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKExvZ0NhdGVnb3J5LkFQSSwgJ0NhY2hlIGRlbGV0ZSBlcnJvcicsIGVycm9yIGFzIEVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogT2J0aWVuZSBvIGVzdGFibGVjZSB1biB2YWxvciAocGF0csOzbiBjYWNoZS1hc2lkZSlcclxuICAgKi9cclxuICBhc3luYyBnZXRPclNldDxUPihcclxuICAgIGtleTogc3RyaW5nLFxyXG4gICAgZmV0Y2hlcjogKCkgPT4gUHJvbWlzZTxUPixcclxuICAgIGNvbmZpZzogQ2FjaGVDb25maWdcclxuICApOiBQcm9taXNlPFQ+IHtcclxuICAgIC8vIEludGVudGFyIG9idGVuZXIgZGVsIGNhY2hlIHByaW1lcm9cclxuICAgIGNvbnN0IGNhY2hlZCA9IGF3YWl0IHRoaXMuZ2V0PFQ+KGtleSwgY29uZmlnKTtcclxuICAgIGlmIChjYWNoZWQgIT09IG51bGwpIHtcclxuICAgICAgcmV0dXJuIGNhY2hlZDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTaSBubyBlc3TDoSBlbiBjYWNoZSwgb2J0ZW5lciBkZWwgb3JpZ2VuXHJcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCBmZXRjaGVyKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBBbG1hY2VuYXIgZW4gY2FjaGUgZGUgZm9ybWEgYXPDrW5jcm9uYVxyXG4gICAgICB0aGlzLnNldChrZXksIHZhbHVlLCBjb25maWcpLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICBsb2dnZXIud2FybihMb2dDYXRlZ29yeS5BUEksICdCYWNrZ3JvdW5kIGNhY2hlIHNldCBmYWlsZWQnKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBsb2dnZXIuaW5mbyhMb2dDYXRlZ29yeS5BUEksICdDYWNoZSBtaXNzIC0gZmV0Y2hlZCBmcm9tIHNvdXJjZScpO1xyXG5cclxuICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKExvZ0NhdGVnb3J5LkFQSSwgJ0ZldGNoZXIgZXJyb3IgaW4gZ2V0T3JTZXQnLCBlcnJvciBhcyBFcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW52YWxpZGEgY2FjaGUgcG9yIHBhdHLDs25cclxuICAgKi9cclxuICBhc3luYyBpbnZhbGlkYXRlUGF0dGVybihwYXR0ZXJuOiBzdHJpbmcsIGNvbmZpZzogQ2FjaGVDb25maWcpOiBQcm9taXNlPG51bWJlcj4ge1xyXG4gICAgY29uc3QgZnVsbFBhdHRlcm4gPSB0aGlzLmdlbmVyYXRlS2V5KGNvbmZpZywgcGF0dGVybik7XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEVuIFJlZGlzIHJlYWwsIHVzYXLDrWFtb3MgU0NBTiArIERFTCBwYXJhIHBhdHJvbmVzXHJcbiAgICAgIC8vIFBvciBzaW1wbGljaWRhZCwgYXF1w60gc29sbyByZWdpc3RyYW1vcyBsYSBvcGVyYWNpw7NuXHJcbiAgICAgIGxvZ2dlci5pbmZvKExvZ0NhdGVnb3J5LkFQSSwgJ0NhY2hlIGludmFsaWRhdGlvbiByZXF1ZXN0ZWQnKTtcclxuXHJcbiAgICAgIC8vIFRPRE86IEltcGxlbWVudGFyIGludmFsaWRhY2nDs24gcmVhbCBwb3IgcGF0csOzblxyXG4gICAgICByZXR1cm4gMDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcihMb2dDYXRlZ29yeS5BUEksICdDYWNoZSBpbnZhbGlkYXRpb24gZXJyb3InLCBlcnJvciBhcyBFcnJvcik7XHJcbiAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogT2J0aWVuZSBlc3RhZMOtc3RpY2FzIGRlbCBjYWNoZVxyXG4gICAqL1xyXG4gIGFzeW5jIGdldFN0YXRzKCk6IFByb21pc2U8e1xyXG4gICAgaGl0czogbnVtYmVyO1xyXG4gICAgbWlzc2VzOiBudW1iZXI7XHJcbiAgICBoaXRSYXRlOiBudW1iZXI7XHJcbiAgICB0b3RhbEtleXM6IG51bWJlcjtcclxuICB9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBFbiBpbXBsZW1lbnRhY2nDs24gcmVhbCwgb2J0ZW5kcsOtYW1vcyBlc3RhcyBtw6l0cmljYXMgZGUgUmVkaXNcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBoaXRzOiAwLFxyXG4gICAgICAgIG1pc3NlczogMCxcclxuICAgICAgICBoaXRSYXRlOiAwLFxyXG4gICAgICAgIHRvdGFsS2V5czogMCxcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcihMb2dDYXRlZ29yeS5BUEksICdDYWNoZSBzdGF0cyBlcnJvcicsIGVycm9yIGFzIEVycm9yKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBoaXRzOiAwLFxyXG4gICAgICAgIG1pc3NlczogMCxcclxuICAgICAgICBoaXRSYXRlOiAwLFxyXG4gICAgICAgIHRvdGFsS2V5czogMCxcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExpbXBpYSB0b2RvIGVsIGNhY2hlIGRlIHVuIHByZWZpam9cclxuICAgKi9cclxuICBhc3luYyBjbGVhcihjb25maWc6IENhY2hlQ29uZmlnKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsb2dnZXIuaW5mbyhMb2dDYXRlZ29yeS5BUEksICdDYWNoZSBjbGVhciByZXF1ZXN0ZWQnKTtcclxuXHJcbiAgICAgIC8vIFRPRE86IEltcGxlbWVudGFyIGxpbXBpZXphIHJlYWwgcG9yIHByZWZpam9cclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoTG9nQ2F0ZWdvcnkuQVBJLCAnQ2FjaGUgY2xlYXIgZXJyb3InLCBlcnJvciBhcyBFcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIEluc3RhbmNpYSBzaW5nbGV0b25cclxuZXhwb3J0IGNvbnN0IGNhY2hlTWFuYWdlciA9IENhY2hlTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xyXG5cclxuLyoqXHJcbiAqIERlY29yYWRvciBwYXJhIGNhY2hlYXIgcmVzdWx0YWRvcyBkZSBmdW5jaW9uZXNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjYWNoZWQoY29uZmlnOiBDYWNoZUNvbmZpZywga2V5R2VuZXJhdG9yPzogKC4uLmFyZ3M6IGFueVtdKSA9PiBzdHJpbmcpIHtcclxuICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldDogYW55LCBwcm9wZXJ0eU5hbWU6IHN0cmluZywgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yKSB7XHJcbiAgICBjb25zdCBtZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xyXG5cclxuICAgIGRlc2NyaXB0b3IudmFsdWUgPSBhc3luYyBmdW5jdGlvbiAoLi4uYXJnczogYW55W10pIHtcclxuICAgICAgY29uc3Qga2V5ID0ga2V5R2VuZXJhdG9yID8ga2V5R2VuZXJhdG9yKC4uLmFyZ3MpIDogYCR7cHJvcGVydHlOYW1lfToke0pTT04uc3RyaW5naWZ5KGFyZ3MpfWA7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gY2FjaGVNYW5hZ2VyLmdldE9yU2V0KFxyXG4gICAgICAgIGtleSxcclxuICAgICAgICAoKSA9PiBtZXRob2QuYXBwbHkodGhpcywgYXJncyksXHJcbiAgICAgICAgY29uZmlnXHJcbiAgICAgICk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBkZXNjcmlwdG9yO1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGdW5jaW9uZXMgZGUgdXRpbGlkYWQgcGFyYSBjYXNvcyBjb211bmVzXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgQ2FjaGVVdGlscyA9IHtcclxuICAvKipcclxuICAgKiBDYWNoZSBwYXJhIHJlc3B1ZXN0YXMgZGUgTWVyY2Fkb1BhZ29cclxuICAgKi9cclxuICBhc3luYyBjYWNoZU1lcmNhZG9QYWdvUmVzcG9uc2U8VD4oa2V5OiBzdHJpbmcsIGZldGNoZXI6ICgpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+IHtcclxuICAgIHJldHVybiBjYWNoZU1hbmFnZXIuZ2V0T3JTZXQoa2V5LCBmZXRjaGVyLCBDQUNIRV9DT05GSUdTLk1FUkNBRE9QQUdPX1JFU1BPTlNFKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBDYWNoZSBwYXJhIGluZm9ybWFjacOzbiBkZSBwYWdvc1xyXG4gICAqL1xyXG4gIGFzeW5jIGNhY2hlUGF5bWVudEluZm88VD4ocGF5bWVudElkOiBzdHJpbmcsIGZldGNoZXI6ICgpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+IHtcclxuICAgIHJldHVybiBjYWNoZU1hbmFnZXIuZ2V0T3JTZXQoYHBheW1lbnQ6JHtwYXltZW50SWR9YCwgZmV0Y2hlciwgQ0FDSEVfQ09ORklHUy5QQVlNRU5UX0lORk8pO1xyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIENhY2hlIHBhcmEgZGF0b3MgZGUgcHJvZHVjdG9zXHJcbiAgICovXHJcbiAgYXN5bmMgY2FjaGVQcm9kdWN0RGF0YTxUPihwcm9kdWN0SWQ6IHN0cmluZywgZmV0Y2hlcjogKCkgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xyXG4gICAgcmV0dXJuIGNhY2hlTWFuYWdlci5nZXRPclNldChgcHJvZHVjdDoke3Byb2R1Y3RJZH1gLCBmZXRjaGVyLCBDQUNIRV9DT05GSUdTLlBST0RVQ1RfREFUQSk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogSW52YWxpZGEgY2FjaGUgZGUgdW4gcGFnbyBlc3BlY8OtZmljb1xyXG4gICAqL1xyXG4gIGFzeW5jIGludmFsaWRhdGVQYXltZW50KHBheW1lbnRJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICByZXR1cm4gY2FjaGVNYW5hZ2VyLmRlbGV0ZShgcGF5bWVudDoke3BheW1lbnRJZH1gLCBDQUNIRV9DT05GSUdTLlBBWU1FTlRfSU5GTyk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogSW52YWxpZGEgY2FjaGUgZGUgdW4gcHJvZHVjdG8gZXNwZWPDrWZpY29cclxuICAgKi9cclxuICBhc3luYyBpbnZhbGlkYXRlUHJvZHVjdChwcm9kdWN0SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgcmV0dXJuIGNhY2hlTWFuYWdlci5kZWxldGUoYHByb2R1Y3Q6JHtwcm9kdWN0SWR9YCwgQ0FDSEVfQ09ORklHUy5QUk9EVUNUX0RBVEEpO1xyXG4gIH0sXHJcbn07XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiJdLCJuYW1lcyI6WyJDQUNIRV9DT05GSUdTIiwiQ2FjaGVNYW5hZ2VyIiwiQ2FjaGVVdGlscyIsImNhY2hlTWFuYWdlciIsImNhY2hlZCIsIk1FUkNBRE9QQUdPX1JFU1BPTlNFIiwidHRsIiwicHJlZml4IiwiY29tcHJlc3MiLCJzZXJpYWxpemUiLCJQQVlNRU5UX0lORk8iLCJTWVNURU1fQ09ORklHIiwiUFJPRFVDVF9EQVRBIiwiVVNFUl9TRVNTSU9OIiwiZ2V0SW5zdGFuY2UiLCJpbnN0YW5jZSIsImdlbmVyYXRlS2V5IiwiY29uZmlnIiwia2V5IiwiZGF0YSIsInNlcmlhbGl6ZWQiLCJKU09OIiwic3RyaW5naWZ5IiwidG9TdHJpbmciLCJsZW5ndGgiLCJzaW1wbGVDb21wcmVzcyIsImVycm9yIiwibG9nZ2VyIiwiTG9nQ2F0ZWdvcnkiLCJBUEkiLCJkZXNlcmlhbGl6ZSIsImRlc2VyaWFsaXplZCIsInN0YXJ0c1dpdGgiLCJzaW1wbGVEZWNvbXByZXNzIiwicGFyc2UiLCJyZXBsYWNlIiwiZ2V0Iiwic3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsImNhY2hlS2V5IiwicmVkaXNDYWNoZSIsImluZm8iLCJyZXN1bHQiLCJzZXQiLCJ2YWx1ZSIsInN1Y2Nlc3MiLCJkZWxldGUiLCJkZWwiLCJnZXRPclNldCIsImZldGNoZXIiLCJjYXRjaCIsIndhcm4iLCJpbnZhbGlkYXRlUGF0dGVybiIsInBhdHRlcm4iLCJmdWxsUGF0dGVybiIsImdldFN0YXRzIiwiaGl0cyIsIm1pc3NlcyIsImhpdFJhdGUiLCJ0b3RhbEtleXMiLCJjbGVhciIsImtleUdlbmVyYXRvciIsInRhcmdldCIsInByb3BlcnR5TmFtZSIsImRlc2NyaXB0b3IiLCJtZXRob2QiLCJhcmdzIiwiYXBwbHkiLCJjYWNoZU1lcmNhZG9QYWdvUmVzcG9uc2UiLCJjYWNoZVBheW1lbnRJbmZvIiwicGF5bWVudElkIiwiY2FjaGVQcm9kdWN0RGF0YSIsInByb2R1Y3RJZCIsImludmFsaWRhdGVQYXltZW50IiwiaW52YWxpZGF0ZVByb2R1Y3QiXSwibWFwcGluZ3MiOiJBQUFBLHNDQUFzQztBQUN0QyxxQ0FBcUM7QUFDckMsc0NBQXNDOzs7Ozs7Ozs7Ozs7UUFjekJBO2VBQUFBOztRQTZDQUM7ZUFBQUE7O1FBa1FBQztlQUFBQTs7UUExQkFDO2VBQUFBOztRQUtHQztlQUFB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