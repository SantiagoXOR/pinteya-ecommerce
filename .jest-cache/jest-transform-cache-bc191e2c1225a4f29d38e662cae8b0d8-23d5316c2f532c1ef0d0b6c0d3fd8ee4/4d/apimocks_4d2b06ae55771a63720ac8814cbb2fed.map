{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\__tests__\\setup\\api-mocks.js"],"sourcesContent":["// ðŸ§ª Enterprise API Mocks for Testing\r\n\r\n// Mock Next.js API Route handlers\r\nexport const createMockApiHandler = (implementation) => {\r\n  return jest.fn().mockImplementation(async (request, context) => {\r\n    try {\r\n      return await implementation(request, context);\r\n    } catch (error) {\r\n      return {\r\n        status: 500,\r\n        json: () => Promise.resolve({\r\n          success: false,\r\n          error: error.message,\r\n          timestamp: new Date().toISOString(),\r\n        }),\r\n      };\r\n    }\r\n  });\r\n};\r\n\r\n// Mock Supabase client for API tests\r\nexport const createMockSupabaseClient = () => ({\r\n  from: jest.fn(() => ({\r\n    select: jest.fn(() => ({\r\n      eq: jest.fn(() => ({\r\n        single: jest.fn().mockResolvedValue({ data: null, error: null }),\r\n        limit: jest.fn().mockResolvedValue({ data: [], error: null }),\r\n        order: jest.fn(() => ({\r\n          order: jest.fn().mockResolvedValue({ data: [], error: null }),\r\n        })),\r\n      })),\r\n    })),\r\n    insert: jest.fn(() => ({\r\n      select: jest.fn(() => ({\r\n        single: jest.fn().mockResolvedValue({ data: null, error: null }),\r\n      })),\r\n    })),\r\n    update: jest.fn(() => ({\r\n      eq: jest.fn(() => ({\r\n        select: jest.fn(() => ({\r\n          single: jest.fn().mockResolvedValue({ data: null, error: null }),\r\n        })),\r\n        neq: jest.fn().mockResolvedValue({ error: null }),\r\n      })),\r\n    })),\r\n    delete: jest.fn(() => ({\r\n      eq: jest.fn().mockResolvedValue({ error: null }),\r\n    })),\r\n  })),\r\n  storage: {\r\n    from: jest.fn(() => ({\r\n      upload: jest.fn().mockResolvedValue({ data: { path: 'test-path' }, error: null }),\r\n      getPublicUrl: jest.fn().mockReturnValue({ data: { publicUrl: 'https://test.com/image.jpg' } }),\r\n      remove: jest.fn().mockResolvedValue({ error: null }),\r\n    })),\r\n  },\r\n});\r\n\r\n// Mock request with common properties\r\nexport const createMockRequest = (overrides = {}) => ({\r\n  url: 'http://localhost:3000/api/test',\r\n  method: 'GET',\r\n  headers: new Map(),\r\n  json: jest.fn().mockResolvedValue({}),\r\n  formData: jest.fn().mockResolvedValue(new FormData()),\r\n  text: jest.fn().mockResolvedValue(''),\r\n  supabase: createMockSupabaseClient(),\r\n  user: { id: 'test-user-id', email: 'test@example.com' },\r\n  validatedData: {},\r\n  ...overrides,\r\n});\r\n\r\n// Mock response helpers\r\nexport const createMockResponse = (data, status = 200) => ({\r\n  status,\r\n  ok: status >= 200 && status < 300,\r\n  json: () => Promise.resolve(data),\r\n  text: () => Promise.resolve(JSON.stringify(data)),\r\n});\r\n\r\n// Mock file for upload tests\r\nexport const createMockFile = (name = 'test.jpg', type = 'image/jpeg', size = 1024) => {\r\n  const file = new File(['test content'], name, { type });\r\n  Object.defineProperty(file, 'size', { value: size });\r\n  return file;\r\n};\r\n\r\n// Mock FormData for file uploads\r\nexport const createMockFormData = (files = {}, fields = {}) => {\r\n  const formData = new FormData();\r\n  \r\n  Object.entries(files).forEach(([key, file]) => {\r\n    formData.append(key, file);\r\n  });\r\n  \r\n  Object.entries(fields).forEach(([key, value]) => {\r\n    formData.append(key, value);\r\n  });\r\n  \r\n  return formData;\r\n};\r\n\r\n// Mock auth result\r\nexport const createMockAuthResult = (success = true, user = null) => ({\r\n  success,\r\n  user: user || { id: 'test-user-id', email: 'test@example.com' },\r\n  supabase: createMockSupabaseClient(),\r\n  status: success ? 200 : 401,\r\n  error: success ? null : 'Unauthorized',\r\n});\r\n\r\n// Helper to setup API test environment\r\nexport const setupApiTestEnvironment = () => {\r\n  // Mock auth functions\r\n  jest.doMock('@/lib/auth/admin-auth', () => ({\r\n    checkCRUDPermissions: jest.fn().mockResolvedValue(createMockAuthResult()),\r\n  }));\r\n\r\n  // Mock API logger\r\n  jest.doMock('@/lib/api/api-logger', () => ({\r\n    withApiLogging: jest.fn((handler) => handler),\r\n    logAdminAction: jest.fn(),\r\n  }));\r\n\r\n  // Mock error handler\r\n  jest.doMock('@/lib/api/error-handler', () => ({\r\n    withErrorHandler: jest.fn((handler) => handler),\r\n    ApiError: class ApiError extends Error {\r\n      constructor(message, statusCode = 500) {\r\n        super(message);\r\n        this.statusCode = statusCode;\r\n      }\r\n    },\r\n    NotFoundError: jest.fn((resource) => new Error(`${resource} no encontrado`)),\r\n    ValidationError: jest.fn((message) => new Error(message)),\r\n  }));\r\n\r\n  // Mock middleware composer\r\n  jest.doMock('@/lib/api/middleware-composer', () => ({\r\n    composeMiddlewares: jest.fn((...middlewares) => (handler) => handler),\r\n  }));\r\n\r\n  // Mock auth middleware\r\n  jest.doMock('@/lib/auth/api-auth-middleware', () => ({\r\n    withAdminAuth: jest.fn(() => (handler) => handler),\r\n  }));\r\n\r\n  // Mock validation middleware\r\n  jest.doMock('@/lib/validation/admin-schemas', () => ({\r\n    withValidation: jest.fn(() => (handler) => handler),\r\n  }));\r\n};\r\n\r\n// Cleanup function\r\nexport const cleanupApiTestEnvironment = () => {\r\n  jest.clearAllMocks();\r\n  jest.resetModules();\r\n};\r\n\r\n\r\n\r\n\r\n"],"names":["cleanupApiTestEnvironment","createMockApiHandler","createMockAuthResult","createMockFile","createMockFormData","createMockRequest","createMockResponse","createMockSupabaseClient","setupApiTestEnvironment","implementation","jest","fn","mockImplementation","request","context","error","status","json","Promise","resolve","success","message","timestamp","Date","toISOString","from","select","eq","single","mockResolvedValue","data","limit","order","insert","update","neq","delete","storage","upload","path","getPublicUrl","mockReturnValue","publicUrl","remove","overrides","url","method","headers","Map","formData","FormData","text","supabase","user","id","email","validatedData","ok","JSON","stringify","name","type","size","file","File","Object","defineProperty","value","files","fields","entries","forEach","key","append","doMock","checkCRUDPermissions","withApiLogging","handler","logAdminAction","withErrorHandler","ApiError","Error","statusCode","NotFoundError","resource","ValidationError","composeMiddlewares","middlewares","withAdminAuth","withValidation","clearAllMocks","resetModules"],"mappings":"AAAA,sCAAsC;AAEtC,kCAAkC;;;;;;;;;;;;QAwJrBA;eAAAA;;QAvJAC;eAAAA;;QAoGAC;eAAAA;;QAtBAC;eAAAA;;QAOAC;eAAAA;;QA7BAC;eAAAA;;QAcAC;eAAAA;;QApDAC;eAAAA;;QA2FAC;eAAAA;;;AA7GN,MAAMP,uBAAuB,CAACQ;IACnC,OAAOC,KAAKC,EAAE,GAAGC,kBAAkB,CAAC,OAAOC,SAASC;QAClD,IAAI;YACF,OAAO,MAAML,eAAeI,SAASC;QACvC,EAAE,OAAOC,OAAO;YACd,OAAO;gBACLC,QAAQ;gBACRC,MAAM,IAAMC,QAAQC,OAAO,CAAC;wBAC1BC,SAAS;wBACTL,OAAOA,MAAMM,OAAO;wBACpBC,WAAW,IAAIC,OAAOC,WAAW;oBACnC;YACF;QACF;IACF;AACF;AAGO,MAAMjB,2BAA2B,IAAO,CAAA;QAC7CkB,MAAMf,KAAKC,EAAE,CAAC,IAAO,CAAA;gBACnBe,QAAQhB,KAAKC,EAAE,CAAC,IAAO,CAAA;wBACrBgB,IAAIjB,KAAKC,EAAE,CAAC,IAAO,CAAA;gCACjBiB,QAAQlB,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC;oCAAEC,MAAM;oCAAMf,OAAO;gCAAK;gCAC9DgB,OAAOrB,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC;oCAAEC,MAAM,EAAE;oCAAEf,OAAO;gCAAK;gCAC3DiB,OAAOtB,KAAKC,EAAE,CAAC,IAAO,CAAA;wCACpBqB,OAAOtB,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC;4CAAEC,MAAM,EAAE;4CAAEf,OAAO;wCAAK;oCAC7D,CAAA;4BACF,CAAA;oBACF,CAAA;gBACAkB,QAAQvB,KAAKC,EAAE,CAAC,IAAO,CAAA;wBACrBe,QAAQhB,KAAKC,EAAE,CAAC,IAAO,CAAA;gCACrBiB,QAAQlB,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC;oCAAEC,MAAM;oCAAMf,OAAO;gCAAK;4BAChE,CAAA;oBACF,CAAA;gBACAmB,QAAQxB,KAAKC,EAAE,CAAC,IAAO,CAAA;wBACrBgB,IAAIjB,KAAKC,EAAE,CAAC,IAAO,CAAA;gCACjBe,QAAQhB,KAAKC,EAAE,CAAC,IAAO,CAAA;wCACrBiB,QAAQlB,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC;4CAAEC,MAAM;4CAAMf,OAAO;wCAAK;oCAChE,CAAA;gCACAoB,KAAKzB,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC;oCAAEd,OAAO;gCAAK;4BACjD,CAAA;oBACF,CAAA;gBACAqB,QAAQ1B,KAAKC,EAAE,CAAC,IAAO,CAAA;wBACrBgB,IAAIjB,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC;4BAAEd,OAAO;wBAAK;oBAChD,CAAA;YACF,CAAA;QACAsB,SAAS;YACPZ,MAAMf,KAAKC,EAAE,CAAC,IAAO,CAAA;oBACnB2B,QAAQ5B,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC;wBAAEC,MAAM;4BAAES,MAAM;wBAAY;wBAAGxB,OAAO;oBAAK;oBAC/EyB,cAAc9B,KAAKC,EAAE,GAAG8B,eAAe,CAAC;wBAAEX,MAAM;4BAAEY,WAAW;wBAA6B;oBAAE;oBAC5FC,QAAQjC,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC;wBAAEd,OAAO;oBAAK;gBACpD,CAAA;QACF;IACF,CAAA;AAGO,MAAMV,oBAAoB,CAACuC,YAAY,CAAC,CAAC,GAAM,CAAA;QACpDC,KAAK;QACLC,QAAQ;QACRC,SAAS,IAAIC;QACb/B,MAAMP,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC,CAAC;QACnCoB,UAAUvC,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC,IAAIqB;QAC1CC,MAAMzC,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC;QAClCuB,UAAU7C;QACV8C,MAAM;YAAEC,IAAI;YAAgBC,OAAO;QAAmB;QACtDC,eAAe,CAAC;QAChB,GAAGZ,SAAS;IACd,CAAA;AAGO,MAAMtC,qBAAqB,CAACwB,MAAMd,SAAS,GAAG,GAAM,CAAA;QACzDA;QACAyC,IAAIzC,UAAU,OAAOA,SAAS;QAC9BC,MAAM,IAAMC,QAAQC,OAAO,CAACW;QAC5BqB,MAAM,IAAMjC,QAAQC,OAAO,CAACuC,KAAKC,SAAS,CAAC7B;IAC7C,CAAA;AAGO,MAAM3B,iBAAiB,CAACyD,OAAO,UAAU,EAAEC,OAAO,YAAY,EAAEC,OAAO,IAAI;IAChF,MAAMC,OAAO,IAAIC,KAAK;QAAC;KAAe,EAAEJ,MAAM;QAAEC;IAAK;IACrDI,OAAOC,cAAc,CAACH,MAAM,QAAQ;QAAEI,OAAOL;IAAK;IAClD,OAAOC;AACT;AAGO,MAAM3D,qBAAqB,CAACgE,QAAQ,CAAC,CAAC,EAAEC,SAAS,CAAC,CAAC;IACxD,MAAMpB,WAAW,IAAIC;IAErBe,OAAOK,OAAO,CAACF,OAAOG,OAAO,CAAC,CAAC,CAACC,KAAKT,KAAK;QACxCd,SAASwB,MAAM,CAACD,KAAKT;IACvB;IAEAE,OAAOK,OAAO,CAACD,QAAQE,OAAO,CAAC,CAAC,CAACC,KAAKL,MAAM;QAC1ClB,SAASwB,MAAM,CAACD,KAAKL;IACvB;IAEA,OAAOlB;AACT;AAGO,MAAM/C,uBAAuB,CAACkB,UAAU,IAAI,EAAEiC,OAAO,IAAI,GAAM,CAAA;QACpEjC;QACAiC,MAAMA,QAAQ;YAAEC,IAAI;YAAgBC,OAAO;QAAmB;QAC9DH,UAAU7C;QACVS,QAAQI,UAAU,MAAM;QACxBL,OAAOK,UAAU,OAAO;IAC1B,CAAA;AAGO,MAAMZ,0BAA0B;IACrC,sBAAsB;IACtBE,KAAKgE,MAAM,CAAC,yBAAyB,IAAO,CAAA;YAC1CC,sBAAsBjE,KAAKC,EAAE,GAAGkB,iBAAiB,CAAC3B;QACpD,CAAA;IAEA,kBAAkB;IAClBQ,KAAKgE,MAAM,CAAC,wBAAwB,IAAO,CAAA;YACzCE,gBAAgBlE,KAAKC,EAAE,CAAC,CAACkE,UAAYA;YACrCC,gBAAgBpE,KAAKC,EAAE;QACzB,CAAA;IAEA,qBAAqB;IACrBD,KAAKgE,MAAM,CAAC,2BAA2B,IAAO,CAAA;YAC5CK,kBAAkBrE,KAAKC,EAAE,CAAC,CAACkE,UAAYA;YACvCG,UAAU,MAAMA,iBAAiBC;gBAC/B,YAAY5D,OAAO,EAAE6D,aAAa,GAAG,CAAE;oBACrC,KAAK,CAAC7D;oBACN,IAAI,CAAC6D,UAAU,GAAGA;gBACpB;YACF;YACAC,eAAezE,KAAKC,EAAE,CAAC,CAACyE,WAAa,IAAIH,MAAM,GAAGG,SAAS,cAAc,CAAC;YAC1EC,iBAAiB3E,KAAKC,EAAE,CAAC,CAACU,UAAY,IAAI4D,MAAM5D;QAClD,CAAA;IAEA,2BAA2B;IAC3BX,KAAKgE,MAAM,CAAC,iCAAiC,IAAO,CAAA;YAClDY,oBAAoB5E,KAAKC,EAAE,CAAC,CAAC,GAAG4E,cAAgB,CAACV,UAAYA;QAC/D,CAAA;IAEA,uBAAuB;IACvBnE,KAAKgE,MAAM,CAAC,kCAAkC,IAAO,CAAA;YACnDc,eAAe9E,KAAKC,EAAE,CAAC,IAAM,CAACkE,UAAYA;QAC5C,CAAA;IAEA,6BAA6B;IAC7BnE,KAAKgE,MAAM,CAAC,kCAAkC,IAAO,CAAA;YACnDe,gBAAgB/E,KAAKC,EAAE,CAAC,IAAM,CAACkE,UAAYA;QAC7C,CAAA;AACF;AAGO,MAAM7E,4BAA4B;IACvCU,KAAKgF,aAAa;IAClBhF,KAAKiF,YAAY;AACnB"}