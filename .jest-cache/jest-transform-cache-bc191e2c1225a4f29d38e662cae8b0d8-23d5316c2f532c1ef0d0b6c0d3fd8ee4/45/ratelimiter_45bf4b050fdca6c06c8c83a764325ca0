1e70cd003e051914f7db2d4afe95c946
// ===================================
// PINTEYA E-COMMERCE - RATE LIMITING MIDDLEWARE
// ===================================
// Sistema de rate limiting enterprise con configuración flexible
// y logging estructurado para APIs críticas
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get RATE_LIMIT_CONFIGS () {
        return RATE_LIMIT_CONFIGS;
    },
    get checkRateLimit () {
        return checkRateLimit;
    },
    get createRateLimitMiddleware () {
        return createRateLimitMiddleware;
    },
    get createRateLimiter () {
        return createRateLimiter;
    },
    get keyGenerators () {
        return keyGenerators;
    },
    get withRateLimit () {
        return withRateLimit;
    }
});
const _server = require("next/server");
// ===================================
// CONFIGURACIONES PREDEFINIDAS
// ===================================
// Configuraciones base para producción
const PRODUCTION_CONFIGS = {
    public: {
        windowMs: 15 * 60 * 1000,
        maxRequests: 1000,
        message: 'Demasiadas solicitudes. Intente nuevamente en 15 minutos.'
    },
    products: {
        windowMs: 5 * 60 * 1000,
        maxRequests: 200,
        message: 'Límite de consultas de productos excedido. Intente en 5 minutos.'
    },
    search: {
        windowMs: 5 * 60 * 1000,
        maxRequests: 150,
        message: 'Límite de búsquedas excedido. Intente en 5 minutos.'
    }
};
// Configuraciones relajadas para desarrollo
const DEVELOPMENT_CONFIGS = {
    public: {
        windowMs: 15 * 60 * 1000,
        maxRequests: 10000,
        message: 'Demasiadas solicitudes. Intente nuevamente en 15 minutos.'
    },
    products: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 1000,
        message: 'Límite de consultas de productos excedido. Intente en 1 minuto.'
    },
    search: {
        windowMs: 1 * 60 * 1000,
        maxRequests: 500,
        message: 'Límite de búsquedas excedido. Intente en 1 minuto.'
    }
};
// ===================================
// HELPER PARA VERIFICAR SI RATE LIMITING ESTÁ HABILITADO
// ===================================
function isRateLimitingEnabled() {
    // Permitir deshabilitar rate limiting en desarrollo con variable de entorno
    if (process.env.DISABLE_RATE_LIMITING === 'true') {
        return false;
    }
    // En desarrollo, usar rate limiting relajado pero habilitado por defecto
    return true;
}
// Seleccionar configuración según el entorno
const isDevelopment = process.env.NODE_ENV === 'development';
const baseConfigs = isDevelopment ? DEVELOPMENT_CONFIGS : PRODUCTION_CONFIGS;
const RATE_LIMIT_CONFIGS = {
    // APIs públicas - límites generosos
    public: baseConfigs.public,
    // APIs de productos - límites moderados
    products: baseConfigs.products,
    // APIs de búsqueda - límites moderados
    search: baseConfigs.search,
    // APIs de autenticación - límites estrictos
    auth: {
        windowMs: 15 * 60 * 1000,
        maxRequests: isDevelopment ? 100 : 10,
        message: 'Demasiados intentos de autenticación. Intente en 15 minutos.'
    },
    // APIs de admin - límites moderados pero monitoreados
    admin: {
        windowMs: 10 * 60 * 1000,
        maxRequests: isDevelopment ? 1000 : 100,
        message: 'Límite de operaciones administrativas excedido.'
    },
    // APIs de pagos - límites muy estrictos
    payment: {
        windowMs: 15 * 60 * 1000,
        maxRequests: isDevelopment ? 100 : 30,
        message: 'Límite de operaciones de pago excedido. Intente en 15 minutos.'
    },
    // APIs de creación - límites estrictos
    creation: {
        windowMs: 10 * 60 * 1000,
        maxRequests: isDevelopment ? 200 : 20,
        message: 'Límite de creación de recursos excedido.'
    },
    // Webhooks - límites rápidos pero altos
    webhook: {
        windowMs: 1 * 60 * 1000,
        maxRequests: isDevelopment ? 1000 : 100,
        message: 'Límite de webhooks excedido. Intente en 1 minuto.'
    }
};
// ===================================
// LOGGING DE CONFIGURACIÓN
// ===================================
// Log de configuración al cargar el módulo
if (process.env.NODE_ENV === 'development') {
    console.log('[RATE_LIMITER] Configuración cargada:', {
        environment: process.env.NODE_ENV,
        rateLimitingEnabled: isRateLimitingEnabled(),
        disableRateLimiting: process.env.DISABLE_RATE_LIMITING,
        productLimits: {
            windowMs: RATE_LIMIT_CONFIGS.products.windowMs / 1000 / 60 + ' minutos',
            maxRequests: RATE_LIMIT_CONFIGS.products.maxRequests
        },
        searchLimits: {
            windowMs: RATE_LIMIT_CONFIGS.search.windowMs / 1000 / 60 + ' minutos',
            maxRequests: RATE_LIMIT_CONFIGS.search.maxRequests
        }
    });
}
// ===================================
// STORE EN MEMORIA (PARA DESARROLLO)
// ===================================
class MemoryStore {
    async get(key) {
        const data = this.store.get(key);
        if (!data) {
            return null;
        }
        // Limpiar datos expirados
        if (Date.now() > data.resetTime) {
            this.store.delete(key);
            return null;
        }
        return data;
    }
    async set(key, value, ttl) {
        this.store.set(key, value);
        // Limpiar automáticamente después del TTL
        setTimeout(()=>{
            this.store.delete(key);
        }, ttl);
    }
    async increment(key, ttl) {
        const now = Date.now();
        const existing = await this.get(key);
        if (!existing) {
            const newData = {
                count: 1,
                resetTime: now + ttl
            };
            await this.set(key, newData, ttl);
            return newData;
        }
        const updatedData = {
            ...existing,
            count: existing.count + 1
        };
        await this.set(key, updatedData, existing.resetTime - now);
        return updatedData;
    }
    constructor(){
        this.store = new Map();
    }
}
// ===================================
// INSTANCIA GLOBAL DEL STORE
// ===================================
const defaultStore = new MemoryStore();
const keyGenerators = {
    // Por IP
    ip: (req)=>{
        const forwarded = req.headers.get('x-forwarded-for');
        const ip = forwarded ? forwarded.split(',')[0] : req.headers.get('x-real-ip') || 'unknown';
        return `ip:${ip}`;
    },
    // Por usuario autenticado (requiere implementación específica)
    user: (req)=>{
        // TODO: Implementar extracción de user ID desde token/session
        const userId = req.headers.get('x-user-id') || 'anonymous';
        return `user:${userId}`;
    },
    // Por endpoint específico
    endpoint: (req)=>{
        const url = new URL(req.url);
        return `endpoint:${url.pathname}`;
    },
    // Combinado IP + endpoint
    combined: (req)=>{
        const ip = keyGenerators.ip(req);
        const endpoint = keyGenerators.endpoint(req);
        return `${ip}:${endpoint}`;
    }
};
function createRateLimiter(config = {}, store = defaultStore) {
    const finalConfig = {
        windowMs: 15 * 60 * 1000,
        maxRequests: 100,
        message: 'Rate limit exceeded',
        headers: true,
        standardHeaders: true,
        legacyHeaders: true,
        ...config
    };
    return async (req)=>{
        return await checkRateLimit(req, finalConfig, store);
    };
}
async function checkRateLimit(req, config, store = defaultStore) {
    const keyGenerator = config.keyGenerator || keyGenerators.combined;
    const key = keyGenerator(req);
    try {
        const data = await store.increment(key, config.windowMs);
        const result = {
            allowed: data.count <= config.maxRequests,
            limit: config.maxRequests,
            remaining: Math.max(0, config.maxRequests - data.count),
            resetTime: data.resetTime
        };
        if (!result.allowed) {
            result.retryAfter = Math.ceil((data.resetTime - Date.now()) / 1000);
        }
        return result;
    } catch (error) {
        console.error('[RATE_LIMITER] Error checking rate limit:', error);
        // En caso de error, permitir la request (fail-open)
        return {
            allowed: true,
            limit: config.maxRequests,
            remaining: config.maxRequests,
            resetTime: Date.now() + config.windowMs
        };
    }
}
function createRateLimitMiddleware(config) {
    return async (req)=>{
        const result = await checkRateLimit(req, config);
        // Crear headers de rate limit
        const headers = new Headers();
        if (config.headers !== false) {
            if (config.standardHeaders !== false) {
                // Headers estándar RFC 6585
                headers.set('RateLimit-Limit', result.limit.toString());
                headers.set('RateLimit-Remaining', result.remaining.toString());
                headers.set('RateLimit-Reset', new Date(result.resetTime).toISOString());
            }
            if (config.legacyHeaders !== false) {
                // Headers legacy para compatibilidad
                headers.set('X-RateLimit-Limit', result.limit.toString());
                headers.set('X-RateLimit-Remaining', result.remaining.toString());
                headers.set('X-RateLimit-Reset', Math.ceil(result.resetTime / 1000).toString());
            }
        }
        if (!result.allowed) {
            if (result.retryAfter) {
                headers.set('Retry-After', result.retryAfter.toString());
            }
            // Log del rate limit excedido
            console.warn('[RATE_LIMITER] Rate limit exceeded:', {
                key: config.keyGenerator ? config.keyGenerator(req) : 'combined',
                limit: result.limit,
                resetTime: new Date(result.resetTime).toISOString(),
                userAgent: req.headers.get('user-agent'),
                ip: req.headers.get('x-forwarded-for') || req.headers.get('x-real-ip')
            });
            return new _server.NextResponse(JSON.stringify({
                error: 'Rate limit exceeded',
                message: config.message || 'Too many requests',
                retryAfter: result.retryAfter
            }), {
                status: 429,
                headers
            });
        }
        // Request permitida, agregar headers informativos
        return _server.NextResponse.next({
            headers
        });
    };
}
async function withRateLimit(req, config, handler) {
    // Si rate limiting está deshabilitado, ejecutar directamente el handler
    if (!isRateLimitingEnabled()) {
        return await handler();
    }
    const result = await checkRateLimit(req, config);
    if (!result.allowed) {
        // Crear headers de rate limit
        const headers = new Headers();
        if (config.headers !== false) {
            if (config.standardHeaders !== false) {
                // Headers estándar RFC 6585
                headers.set('RateLimit-Limit', result.limit.toString());
                headers.set('RateLimit-Remaining', result.remaining.toString());
                headers.set('RateLimit-Reset', new Date(result.resetTime).toISOString());
            }
            if (config.legacyHeaders !== false) {
                // Headers legacy para compatibilidad
                headers.set('X-RateLimit-Limit', result.limit.toString());
                headers.set('X-RateLimit-Remaining', result.remaining.toString());
                headers.set('X-RateLimit-Reset', Math.ceil(result.resetTime / 1000).toString());
            }
        }
        if (result.retryAfter) {
            headers.set('Retry-After', result.retryAfter.toString());
        }
        // Log del rate limit excedido
        console.warn('[RATE_LIMITER] Rate limit exceeded:', {
            key: config.keyGenerator ? config.keyGenerator(req) : 'combined',
            limit: result.limit,
            resetTime: new Date(result.resetTime).toISOString(),
            userAgent: req.headers.get('user-agent'),
            ip: req.headers.get('x-forwarded-for') || req.headers.get('x-real-ip')
        });
        return new _server.NextResponse(JSON.stringify({
            error: 'Rate limit exceeded',
            message: config.message || 'Too many requests',
            retryAfter: result.retryAfter
        }), {
            status: 429,
            headers
        });
    }
    return handler();
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxyYXRlLWxpbWl0aW5nXFxyYXRlLWxpbWl0ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBJTlRFWUEgRS1DT01NRVJDRSAtIFJBVEUgTElNSVRJTkcgTUlERExFV0FSRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFNpc3RlbWEgZGUgcmF0ZSBsaW1pdGluZyBlbnRlcnByaXNlIGNvbiBjb25maWd1cmFjacOzbiBmbGV4aWJsZVxuLy8geSBsb2dnaW5nIGVzdHJ1Y3R1cmFkbyBwYXJhIEFQSXMgY3LDrXRpY2FzXG5cbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7IGhlYWRlcnMgfSBmcm9tICduZXh0L2hlYWRlcnMnXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUSVBPUyBZIElOVEVSRkFDRVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmF0ZUxpbWl0Q29uZmlnIHtcbiAgd2luZG93TXM6IG51bWJlciAvLyBWZW50YW5hIGRlIHRpZW1wbyBlbiBtaWxpc2VndW5kb3NcbiAgbWF4UmVxdWVzdHM6IG51bWJlciAvLyBNw6F4aW1vIGRlIHJlcXVlc3RzIHBvciB2ZW50YW5hXG4gIGtleUdlbmVyYXRvcj86IChyZXE6IE5leHRSZXF1ZXN0KSA9PiBzdHJpbmcgLy8gR2VuZXJhZG9yIGRlIGNsYXZlIHBlcnNvbmFsaXphZG9cbiAgc2tpcFN1Y2Nlc3NmdWxSZXF1ZXN0cz86IGJvb2xlYW4gLy8gT21pdGlyIHJlcXVlc3RzIGV4aXRvc29zXG4gIHNraXBGYWlsZWRSZXF1ZXN0cz86IGJvb2xlYW4gLy8gT21pdGlyIHJlcXVlc3RzIGZhbGxpZG9zXG4gIG1lc3NhZ2U/OiBzdHJpbmcgLy8gTWVuc2FqZSBkZSBlcnJvciBwZXJzb25hbGl6YWRvXG4gIGhlYWRlcnM/OiBib29sZWFuIC8vIEluY2x1aXIgaGVhZGVycyBkZSByYXRlIGxpbWl0XG4gIHN0YW5kYXJkSGVhZGVycz86IGJvb2xlYW4gLy8gVXNhciBoZWFkZXJzIGVzdMOhbmRhciBSRkNcbiAgbGVnYWN5SGVhZGVycz86IGJvb2xlYW4gLy8gSW5jbHVpciBoZWFkZXJzIGxlZ2FjeVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJhdGVMaW1pdFJlc3VsdCB7XG4gIGFsbG93ZWQ6IGJvb2xlYW5cbiAgbGltaXQ6IG51bWJlclxuICByZW1haW5pbmc6IG51bWJlclxuICByZXNldFRpbWU6IG51bWJlclxuICByZXRyeUFmdGVyPzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmF0ZUxpbWl0U3RvcmUge1xuICBnZXQoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHsgY291bnQ6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfSB8IG51bGw+XG4gIHNldChrZXk6IHN0cmluZywgdmFsdWU6IHsgY291bnQ6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfSwgdHRsOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+XG4gIGluY3JlbWVudChrZXk6IHN0cmluZywgdHRsOiBudW1iZXIpOiBQcm9taXNlPHsgY291bnQ6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfT5cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENPTkZJR1VSQUNJT05FUyBQUkVERUZJTklEQVNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIENvbmZpZ3VyYWNpb25lcyBiYXNlIHBhcmEgcHJvZHVjY2nDs25cbmNvbnN0IFBST0RVQ1RJT05fQ09ORklHUyA9IHtcbiAgcHVibGljOiB7XG4gICAgd2luZG93TXM6IDE1ICogNjAgKiAxMDAwLCAvLyAxNSBtaW51dG9zXG4gICAgbWF4UmVxdWVzdHM6IDEwMDAsIC8vIDEwMDAgcmVxdWVzdHMgcG9yIHZlbnRhbmFcbiAgICBtZXNzYWdlOiAnRGVtYXNpYWRhcyBzb2xpY2l0dWRlcy4gSW50ZW50ZSBudWV2YW1lbnRlIGVuIDE1IG1pbnV0b3MuJyxcbiAgfSxcbiAgcHJvZHVjdHM6IHtcbiAgICB3aW5kb3dNczogNSAqIDYwICogMTAwMCwgLy8gNSBtaW51dG9zXG4gICAgbWF4UmVxdWVzdHM6IDIwMCwgLy8gMjAwIHJlcXVlc3RzIHBvciB2ZW50YW5hXG4gICAgbWVzc2FnZTogJ0zDrW1pdGUgZGUgY29uc3VsdGFzIGRlIHByb2R1Y3RvcyBleGNlZGlkby4gSW50ZW50ZSBlbiA1IG1pbnV0b3MuJyxcbiAgfSxcbiAgc2VhcmNoOiB7XG4gICAgd2luZG93TXM6IDUgKiA2MCAqIDEwMDAsIC8vIDUgbWludXRvc1xuICAgIG1heFJlcXVlc3RzOiAxNTAsIC8vIDE1MCByZXF1ZXN0cyBwb3IgdmVudGFuYVxuICAgIG1lc3NhZ2U6ICdMw61taXRlIGRlIGLDunNxdWVkYXMgZXhjZWRpZG8uIEludGVudGUgZW4gNSBtaW51dG9zLicsXG4gIH0sXG59XG5cbi8vIENvbmZpZ3VyYWNpb25lcyByZWxhamFkYXMgcGFyYSBkZXNhcnJvbGxvXG5jb25zdCBERVZFTE9QTUVOVF9DT05GSUdTID0ge1xuICBwdWJsaWM6IHtcbiAgICB3aW5kb3dNczogMTUgKiA2MCAqIDEwMDAsIC8vIDE1IG1pbnV0b3NcbiAgICBtYXhSZXF1ZXN0czogMTAwMDAsIC8vIDEwMDAwIHJlcXVlc3RzIHBvciB2ZW50YW5hIChtdXkgZ2VuZXJvc28pXG4gICAgbWVzc2FnZTogJ0RlbWFzaWFkYXMgc29saWNpdHVkZXMuIEludGVudGUgbnVldmFtZW50ZSBlbiAxNSBtaW51dG9zLicsXG4gIH0sXG4gIHByb2R1Y3RzOiB7XG4gICAgd2luZG93TXM6IDEgKiA2MCAqIDEwMDAsIC8vIDEgbWludXRvXG4gICAgbWF4UmVxdWVzdHM6IDEwMDAsIC8vIDEwMDAgcmVxdWVzdHMgcG9yIG1pbnV0byAobXV5IGdlbmVyb3NvKVxuICAgIG1lc3NhZ2U6ICdMw61taXRlIGRlIGNvbnN1bHRhcyBkZSBwcm9kdWN0b3MgZXhjZWRpZG8uIEludGVudGUgZW4gMSBtaW51dG8uJyxcbiAgfSxcbiAgc2VhcmNoOiB7XG4gICAgd2luZG93TXM6IDEgKiA2MCAqIDEwMDAsIC8vIDEgbWludXRvXG4gICAgbWF4UmVxdWVzdHM6IDUwMCwgLy8gNTAwIHJlcXVlc3RzIHBvciBtaW51dG8gKG11eSBnZW5lcm9zbylcbiAgICBtZXNzYWdlOiAnTMOtbWl0ZSBkZSBiw7pzcXVlZGFzIGV4Y2VkaWRvLiBJbnRlbnRlIGVuIDEgbWludXRvLicsXG4gIH0sXG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVIgUEFSQSBWRVJJRklDQVIgU0kgUkFURSBMSU1JVElORyBFU1TDgSBIQUJJTElUQURPXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBpc1JhdGVMaW1pdGluZ0VuYWJsZWQoKTogYm9vbGVhbiB7XG4gIC8vIFBlcm1pdGlyIGRlc2hhYmlsaXRhciByYXRlIGxpbWl0aW5nIGVuIGRlc2Fycm9sbG8gY29uIHZhcmlhYmxlIGRlIGVudG9ybm9cbiAgaWYgKHByb2Nlc3MuZW52LkRJU0FCTEVfUkFURV9MSU1JVElORyA9PT0gJ3RydWUnKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICAvLyBFbiBkZXNhcnJvbGxvLCB1c2FyIHJhdGUgbGltaXRpbmcgcmVsYWphZG8gcGVybyBoYWJpbGl0YWRvIHBvciBkZWZlY3RvXG4gIHJldHVybiB0cnVlXG59XG5cbi8vIFNlbGVjY2lvbmFyIGNvbmZpZ3VyYWNpw7NuIHNlZ8O6biBlbCBlbnRvcm5vXG5jb25zdCBpc0RldmVsb3BtZW50ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCdcbmNvbnN0IGJhc2VDb25maWdzID0gaXNEZXZlbG9wbWVudCA/IERFVkVMT1BNRU5UX0NPTkZJR1MgOiBQUk9EVUNUSU9OX0NPTkZJR1NcblxuZXhwb3J0IGNvbnN0IFJBVEVfTElNSVRfQ09ORklHUyA9IHtcbiAgLy8gQVBJcyBww7pibGljYXMgLSBsw61taXRlcyBnZW5lcm9zb3NcbiAgcHVibGljOiBiYXNlQ29uZmlncy5wdWJsaWMsXG5cbiAgLy8gQVBJcyBkZSBwcm9kdWN0b3MgLSBsw61taXRlcyBtb2RlcmFkb3NcbiAgcHJvZHVjdHM6IGJhc2VDb25maWdzLnByb2R1Y3RzLFxuXG4gIC8vIEFQSXMgZGUgYsO6c3F1ZWRhIC0gbMOtbWl0ZXMgbW9kZXJhZG9zXG4gIHNlYXJjaDogYmFzZUNvbmZpZ3Muc2VhcmNoLFxuXG4gIC8vIEFQSXMgZGUgYXV0ZW50aWNhY2nDs24gLSBsw61taXRlcyBlc3RyaWN0b3NcbiAgYXV0aDoge1xuICAgIHdpbmRvd01zOiAxNSAqIDYwICogMTAwMCwgLy8gMTUgbWludXRvc1xuICAgIG1heFJlcXVlc3RzOiBpc0RldmVsb3BtZW50ID8gMTAwIDogMTAsIC8vIDEwMCBlbiBkZXYsIDEwIGVuIHByb2RcbiAgICBtZXNzYWdlOiAnRGVtYXNpYWRvcyBpbnRlbnRvcyBkZSBhdXRlbnRpY2FjacOzbi4gSW50ZW50ZSBlbiAxNSBtaW51dG9zLicsXG4gIH0sXG5cbiAgLy8gQVBJcyBkZSBhZG1pbiAtIGzDrW1pdGVzIG1vZGVyYWRvcyBwZXJvIG1vbml0b3JlYWRvc1xuICBhZG1pbjoge1xuICAgIHdpbmRvd01zOiAxMCAqIDYwICogMTAwMCwgLy8gMTAgbWludXRvc1xuICAgIG1heFJlcXVlc3RzOiBpc0RldmVsb3BtZW50ID8gMTAwMCA6IDEwMCwgLy8gMTAwMCBlbiBkZXYsIDEwMCBlbiBwcm9kXG4gICAgbWVzc2FnZTogJ0zDrW1pdGUgZGUgb3BlcmFjaW9uZXMgYWRtaW5pc3RyYXRpdmFzIGV4Y2VkaWRvLicsXG4gIH0sXG5cbiAgLy8gQVBJcyBkZSBwYWdvcyAtIGzDrW1pdGVzIG11eSBlc3RyaWN0b3NcbiAgcGF5bWVudDoge1xuICAgIHdpbmRvd01zOiAxNSAqIDYwICogMTAwMCwgLy8gMTUgbWludXRvc1xuICAgIG1heFJlcXVlc3RzOiBpc0RldmVsb3BtZW50ID8gMTAwIDogMzAsIC8vIDEwMCBlbiBkZXYsIDMwIGVuIHByb2RcbiAgICBtZXNzYWdlOiAnTMOtbWl0ZSBkZSBvcGVyYWNpb25lcyBkZSBwYWdvIGV4Y2VkaWRvLiBJbnRlbnRlIGVuIDE1IG1pbnV0b3MuJyxcbiAgfSxcblxuICAvLyBBUElzIGRlIGNyZWFjacOzbiAtIGzDrW1pdGVzIGVzdHJpY3Rvc1xuICBjcmVhdGlvbjoge1xuICAgIHdpbmRvd01zOiAxMCAqIDYwICogMTAwMCwgLy8gMTAgbWludXRvc1xuICAgIG1heFJlcXVlc3RzOiBpc0RldmVsb3BtZW50ID8gMjAwIDogMjAsIC8vIDIwMCBlbiBkZXYsIDIwIGVuIHByb2RcbiAgICBtZXNzYWdlOiAnTMOtbWl0ZSBkZSBjcmVhY2nDs24gZGUgcmVjdXJzb3MgZXhjZWRpZG8uJyxcbiAgfSxcblxuICAvLyBXZWJob29rcyAtIGzDrW1pdGVzIHLDoXBpZG9zIHBlcm8gYWx0b3NcbiAgd2ViaG9vazoge1xuICAgIHdpbmRvd01zOiAxICogNjAgKiAxMDAwLCAvLyAxIG1pbnV0b1xuICAgIG1heFJlcXVlc3RzOiBpc0RldmVsb3BtZW50ID8gMTAwMCA6IDEwMCwgLy8gMTAwMCBlbiBkZXYsIDEwMCBlbiBwcm9kXG4gICAgbWVzc2FnZTogJ0zDrW1pdGUgZGUgd2ViaG9va3MgZXhjZWRpZG8uIEludGVudGUgZW4gMSBtaW51dG8uJyxcbiAgfSxcbn0gYXMgY29uc3RcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIExPR0dJTkcgREUgQ09ORklHVVJBQ0nDk05cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIExvZyBkZSBjb25maWd1cmFjacOzbiBhbCBjYXJnYXIgZWwgbcOzZHVsb1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gIGNvbnNvbGUubG9nKCdbUkFURV9MSU1JVEVSXSBDb25maWd1cmFjacOzbiBjYXJnYWRhOicsIHtcbiAgICBlbnZpcm9ubWVudDogcHJvY2Vzcy5lbnYuTk9ERV9FTlYsXG4gICAgcmF0ZUxpbWl0aW5nRW5hYmxlZDogaXNSYXRlTGltaXRpbmdFbmFibGVkKCksXG4gICAgZGlzYWJsZVJhdGVMaW1pdGluZzogcHJvY2Vzcy5lbnYuRElTQUJMRV9SQVRFX0xJTUlUSU5HLFxuICAgIHByb2R1Y3RMaW1pdHM6IHtcbiAgICAgIHdpbmRvd01zOiBSQVRFX0xJTUlUX0NPTkZJR1MucHJvZHVjdHMud2luZG93TXMgLyAxMDAwIC8gNjAgKyAnIG1pbnV0b3MnLFxuICAgICAgbWF4UmVxdWVzdHM6IFJBVEVfTElNSVRfQ09ORklHUy5wcm9kdWN0cy5tYXhSZXF1ZXN0cyxcbiAgICB9LFxuICAgIHNlYXJjaExpbWl0czoge1xuICAgICAgd2luZG93TXM6IFJBVEVfTElNSVRfQ09ORklHUy5zZWFyY2gud2luZG93TXMgLyAxMDAwIC8gNjAgKyAnIG1pbnV0b3MnLFxuICAgICAgbWF4UmVxdWVzdHM6IFJBVEVfTElNSVRfQ09ORklHUy5zZWFyY2gubWF4UmVxdWVzdHMsXG4gICAgfSxcbiAgfSlcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFNUT1JFIEVOIE1FTU9SSUEgKFBBUkEgREVTQVJST0xMTylcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNsYXNzIE1lbW9yeVN0b3JlIGltcGxlbWVudHMgUmF0ZUxpbWl0U3RvcmUge1xuICBwcml2YXRlIHN0b3JlID0gbmV3IE1hcDxzdHJpbmcsIHsgY291bnQ6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfT4oKVxuXG4gIGFzeW5jIGdldChrZXk6IHN0cmluZyk6IFByb21pc2U8eyBjb3VudDogbnVtYmVyOyByZXNldFRpbWU6IG51bWJlciB9IHwgbnVsbD4ge1xuICAgIGNvbnN0IGRhdGEgPSB0aGlzLnN0b3JlLmdldChrZXkpXG4gICAgaWYgKCFkYXRhKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIC8vIExpbXBpYXIgZGF0b3MgZXhwaXJhZG9zXG4gICAgaWYgKERhdGUubm93KCkgPiBkYXRhLnJlc2V0VGltZSkge1xuICAgICAgdGhpcy5zdG9yZS5kZWxldGUoa2V5KVxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0YVxuICB9XG5cbiAgYXN5bmMgc2V0KGtleTogc3RyaW5nLCB2YWx1ZTogeyBjb3VudDogbnVtYmVyOyByZXNldFRpbWU6IG51bWJlciB9LCB0dGw6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuc3RvcmUuc2V0KGtleSwgdmFsdWUpXG5cbiAgICAvLyBMaW1waWFyIGF1dG9tw6F0aWNhbWVudGUgZGVzcHXDqXMgZGVsIFRUTFxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5zdG9yZS5kZWxldGUoa2V5KVxuICAgIH0sIHR0bClcbiAgfVxuXG4gIGFzeW5jIGluY3JlbWVudChrZXk6IHN0cmluZywgdHRsOiBudW1iZXIpOiBQcm9taXNlPHsgY291bnQ6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcbiAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHRoaXMuZ2V0KGtleSlcblxuICAgIGlmICghZXhpc3RpbmcpIHtcbiAgICAgIGNvbnN0IG5ld0RhdGEgPSB7IGNvdW50OiAxLCByZXNldFRpbWU6IG5vdyArIHR0bCB9XG4gICAgICBhd2FpdCB0aGlzLnNldChrZXksIG5ld0RhdGEsIHR0bClcbiAgICAgIHJldHVybiBuZXdEYXRhXG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlZERhdGEgPSB7IC4uLmV4aXN0aW5nLCBjb3VudDogZXhpc3RpbmcuY291bnQgKyAxIH1cbiAgICBhd2FpdCB0aGlzLnNldChrZXksIHVwZGF0ZWREYXRhLCBleGlzdGluZy5yZXNldFRpbWUgLSBub3cpXG4gICAgcmV0dXJuIHVwZGF0ZWREYXRhXG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIElOU1RBTkNJQSBHTE9CQUwgREVMIFNUT1JFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5jb25zdCBkZWZhdWx0U3RvcmUgPSBuZXcgTWVtb3J5U3RvcmUoKVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gR0VORVJBRE9SRVMgREUgQ0xBVkVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBjb25zdCBrZXlHZW5lcmF0b3JzID0ge1xuICAvLyBQb3IgSVBcbiAgaXA6IChyZXE6IE5leHRSZXF1ZXN0KTogc3RyaW5nID0+IHtcbiAgICBjb25zdCBmb3J3YXJkZWQgPSByZXEuaGVhZGVycy5nZXQoJ3gtZm9yd2FyZGVkLWZvcicpXG4gICAgY29uc3QgaXAgPSBmb3J3YXJkZWQgPyBmb3J3YXJkZWQuc3BsaXQoJywnKVswXSA6IHJlcS5oZWFkZXJzLmdldCgneC1yZWFsLWlwJykgfHwgJ3Vua25vd24nXG4gICAgcmV0dXJuIGBpcDoke2lwfWBcbiAgfSxcblxuICAvLyBQb3IgdXN1YXJpbyBhdXRlbnRpY2FkbyAocmVxdWllcmUgaW1wbGVtZW50YWNpw7NuIGVzcGVjw61maWNhKVxuICB1c2VyOiAocmVxOiBOZXh0UmVxdWVzdCk6IHN0cmluZyA9PiB7XG4gICAgLy8gVE9ETzogSW1wbGVtZW50YXIgZXh0cmFjY2nDs24gZGUgdXNlciBJRCBkZXNkZSB0b2tlbi9zZXNzaW9uXG4gICAgY29uc3QgdXNlcklkID0gcmVxLmhlYWRlcnMuZ2V0KCd4LXVzZXItaWQnKSB8fCAnYW5vbnltb3VzJ1xuICAgIHJldHVybiBgdXNlcjoke3VzZXJJZH1gXG4gIH0sXG5cbiAgLy8gUG9yIGVuZHBvaW50IGVzcGVjw61maWNvXG4gIGVuZHBvaW50OiAocmVxOiBOZXh0UmVxdWVzdCk6IHN0cmluZyA9PiB7XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXEudXJsKVxuICAgIHJldHVybiBgZW5kcG9pbnQ6JHt1cmwucGF0aG5hbWV9YFxuICB9LFxuXG4gIC8vIENvbWJpbmFkbyBJUCArIGVuZHBvaW50XG4gIGNvbWJpbmVkOiAocmVxOiBOZXh0UmVxdWVzdCk6IHN0cmluZyA9PiB7XG4gICAgY29uc3QgaXAgPSBrZXlHZW5lcmF0b3JzLmlwKHJlcSlcbiAgICBjb25zdCBlbmRwb2ludCA9IGtleUdlbmVyYXRvcnMuZW5kcG9pbnQocmVxKVxuICAgIHJldHVybiBgJHtpcH06JHtlbmRwb2ludH1gXG4gIH0sXG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBGQUNUT1JZIFBBUkEgQ1JFQVIgUkFURSBMSU1JVEVSU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBDcmVhIHVuIHJhdGUgbGltaXRlciBjb24gY29uZmlndXJhY2nDs24gZXNwZWPDrWZpY2FcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJhdGVMaW1pdGVyKFxuICBjb25maWc6IFBhcnRpYWw8UmF0ZUxpbWl0Q29uZmlnPiA9IHt9LFxuICBzdG9yZTogUmF0ZUxpbWl0U3RvcmUgPSBkZWZhdWx0U3RvcmVcbikge1xuICBjb25zdCBmaW5hbENvbmZpZzogUmF0ZUxpbWl0Q29uZmlnID0ge1xuICAgIHdpbmRvd01zOiAxNSAqIDYwICogMTAwMCwgLy8gMTUgbWludXRvcyBwb3IgZGVmZWN0b1xuICAgIG1heFJlcXVlc3RzOiAxMDAsIC8vIDEwMCByZXF1ZXN0cyBwb3IgZGVmZWN0b1xuICAgIG1lc3NhZ2U6ICdSYXRlIGxpbWl0IGV4Y2VlZGVkJyxcbiAgICBoZWFkZXJzOiB0cnVlLFxuICAgIHN0YW5kYXJkSGVhZGVyczogdHJ1ZSxcbiAgICBsZWdhY3lIZWFkZXJzOiB0cnVlLFxuICAgIC4uLmNvbmZpZyxcbiAgfVxuXG4gIHJldHVybiBhc3luYyAocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8UmF0ZUxpbWl0UmVzdWx0PiA9PiB7XG4gICAgcmV0dXJuIGF3YWl0IGNoZWNrUmF0ZUxpbWl0KHJlcSwgZmluYWxDb25maWcsIHN0b3JlKVxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBGVU5DScOTTiBQUklOQ0lQQUwgREUgUkFURSBMSU1JVElOR1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrUmF0ZUxpbWl0KFxuICByZXE6IE5leHRSZXF1ZXN0LFxuICBjb25maWc6IFJhdGVMaW1pdENvbmZpZyxcbiAgc3RvcmU6IFJhdGVMaW1pdFN0b3JlID0gZGVmYXVsdFN0b3JlXG4pOiBQcm9taXNlPFJhdGVMaW1pdFJlc3VsdD4ge1xuICBjb25zdCBrZXlHZW5lcmF0b3IgPSBjb25maWcua2V5R2VuZXJhdG9yIHx8IGtleUdlbmVyYXRvcnMuY29tYmluZWRcbiAgY29uc3Qga2V5ID0ga2V5R2VuZXJhdG9yKHJlcSlcblxuICB0cnkge1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBzdG9yZS5pbmNyZW1lbnQoa2V5LCBjb25maWcud2luZG93TXMpXG5cbiAgICBjb25zdCByZXN1bHQ6IFJhdGVMaW1pdFJlc3VsdCA9IHtcbiAgICAgIGFsbG93ZWQ6IGRhdGEuY291bnQgPD0gY29uZmlnLm1heFJlcXVlc3RzLFxuICAgICAgbGltaXQ6IGNvbmZpZy5tYXhSZXF1ZXN0cyxcbiAgICAgIHJlbWFpbmluZzogTWF0aC5tYXgoMCwgY29uZmlnLm1heFJlcXVlc3RzIC0gZGF0YS5jb3VudCksXG4gICAgICByZXNldFRpbWU6IGRhdGEucmVzZXRUaW1lLFxuICAgIH1cblxuICAgIGlmICghcmVzdWx0LmFsbG93ZWQpIHtcbiAgICAgIHJlc3VsdC5yZXRyeUFmdGVyID0gTWF0aC5jZWlsKChkYXRhLnJlc2V0VGltZSAtIERhdGUubm93KCkpIC8gMTAwMClcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1JBVEVfTElNSVRFUl0gRXJyb3IgY2hlY2tpbmcgcmF0ZSBsaW1pdDonLCBlcnJvcilcblxuICAgIC8vIEVuIGNhc28gZGUgZXJyb3IsIHBlcm1pdGlyIGxhIHJlcXVlc3QgKGZhaWwtb3BlbilcbiAgICByZXR1cm4ge1xuICAgICAgYWxsb3dlZDogdHJ1ZSxcbiAgICAgIGxpbWl0OiBjb25maWcubWF4UmVxdWVzdHMsXG4gICAgICByZW1haW5pbmc6IGNvbmZpZy5tYXhSZXF1ZXN0cyxcbiAgICAgIHJlc2V0VGltZTogRGF0ZS5ub3coKSArIGNvbmZpZy53aW5kb3dNcyxcbiAgICB9XG4gIH1cbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1JRERMRVdBUkUgREUgUkFURSBMSU1JVElOR1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJhdGVMaW1pdE1pZGRsZXdhcmUoY29uZmlnOiBSYXRlTGltaXRDb25maWcpIHtcbiAgcmV0dXJuIGFzeW5jIChyZXE6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxOZXh0UmVzcG9uc2UgfCBudWxsPiA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2hlY2tSYXRlTGltaXQocmVxLCBjb25maWcpXG5cbiAgICAvLyBDcmVhciBoZWFkZXJzIGRlIHJhdGUgbGltaXRcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKVxuXG4gICAgaWYgKGNvbmZpZy5oZWFkZXJzICE9PSBmYWxzZSkge1xuICAgICAgaWYgKGNvbmZpZy5zdGFuZGFyZEhlYWRlcnMgIT09IGZhbHNlKSB7XG4gICAgICAgIC8vIEhlYWRlcnMgZXN0w6FuZGFyIFJGQyA2NTg1XG4gICAgICAgIGhlYWRlcnMuc2V0KCdSYXRlTGltaXQtTGltaXQnLCByZXN1bHQubGltaXQudG9TdHJpbmcoKSlcbiAgICAgICAgaGVhZGVycy5zZXQoJ1JhdGVMaW1pdC1SZW1haW5pbmcnLCByZXN1bHQucmVtYWluaW5nLnRvU3RyaW5nKCkpXG4gICAgICAgIGhlYWRlcnMuc2V0KCdSYXRlTGltaXQtUmVzZXQnLCBuZXcgRGF0ZShyZXN1bHQucmVzZXRUaW1lKS50b0lTT1N0cmluZygpKVxuICAgICAgfVxuXG4gICAgICBpZiAoY29uZmlnLmxlZ2FjeUhlYWRlcnMgIT09IGZhbHNlKSB7XG4gICAgICAgIC8vIEhlYWRlcnMgbGVnYWN5IHBhcmEgY29tcGF0aWJpbGlkYWRcbiAgICAgICAgaGVhZGVycy5zZXQoJ1gtUmF0ZUxpbWl0LUxpbWl0JywgcmVzdWx0LmxpbWl0LnRvU3RyaW5nKCkpXG4gICAgICAgIGhlYWRlcnMuc2V0KCdYLVJhdGVMaW1pdC1SZW1haW5pbmcnLCByZXN1bHQucmVtYWluaW5nLnRvU3RyaW5nKCkpXG4gICAgICAgIGhlYWRlcnMuc2V0KCdYLVJhdGVMaW1pdC1SZXNldCcsIE1hdGguY2VpbChyZXN1bHQucmVzZXRUaW1lIC8gMTAwMCkudG9TdHJpbmcoKSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXJlc3VsdC5hbGxvd2VkKSB7XG4gICAgICBpZiAocmVzdWx0LnJldHJ5QWZ0ZXIpIHtcbiAgICAgICAgaGVhZGVycy5zZXQoJ1JldHJ5LUFmdGVyJywgcmVzdWx0LnJldHJ5QWZ0ZXIudG9TdHJpbmcoKSlcbiAgICAgIH1cblxuICAgICAgLy8gTG9nIGRlbCByYXRlIGxpbWl0IGV4Y2VkaWRvXG4gICAgICBjb25zb2xlLndhcm4oJ1tSQVRFX0xJTUlURVJdIFJhdGUgbGltaXQgZXhjZWVkZWQ6Jywge1xuICAgICAgICBrZXk6IGNvbmZpZy5rZXlHZW5lcmF0b3IgPyBjb25maWcua2V5R2VuZXJhdG9yKHJlcSkgOiAnY29tYmluZWQnLFxuICAgICAgICBsaW1pdDogcmVzdWx0LmxpbWl0LFxuICAgICAgICByZXNldFRpbWU6IG5ldyBEYXRlKHJlc3VsdC5yZXNldFRpbWUpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHVzZXJBZ2VudDogcmVxLmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JyksXG4gICAgICAgIGlwOiByZXEuaGVhZGVycy5nZXQoJ3gtZm9yd2FyZGVkLWZvcicpIHx8IHJlcS5oZWFkZXJzLmdldCgneC1yZWFsLWlwJyksXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGVycm9yOiAnUmF0ZSBsaW1pdCBleGNlZWRlZCcsXG4gICAgICAgICAgbWVzc2FnZTogY29uZmlnLm1lc3NhZ2UgfHwgJ1RvbyBtYW55IHJlcXVlc3RzJyxcbiAgICAgICAgICByZXRyeUFmdGVyOiByZXN1bHQucmV0cnlBZnRlcixcbiAgICAgICAgfSksXG4gICAgICAgIHtcbiAgICAgICAgICBzdGF0dXM6IDQyOSxcbiAgICAgICAgICBoZWFkZXJzLFxuICAgICAgICB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gUmVxdWVzdCBwZXJtaXRpZGEsIGFncmVnYXIgaGVhZGVycyBpbmZvcm1hdGl2b3NcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoe1xuICAgICAgaGVhZGVycyxcbiAgICB9KVxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBIRUxQRVIgUEFSQSBBUExJQ0FSIFJBVEUgTElNSVRJTkdcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB3aXRoUmF0ZUxpbWl0PFQ+KFxuICByZXE6IE5leHRSZXF1ZXN0LFxuICBjb25maWc6IFJhdGVMaW1pdENvbmZpZyxcbiAgaGFuZGxlcjogKCkgPT4gUHJvbWlzZTxUPlxuKTogUHJvbWlzZTxUIHwgTmV4dFJlc3BvbnNlPiB7XG4gIC8vIFNpIHJhdGUgbGltaXRpbmcgZXN0w6EgZGVzaGFiaWxpdGFkbywgZWplY3V0YXIgZGlyZWN0YW1lbnRlIGVsIGhhbmRsZXJcbiAgaWYgKCFpc1JhdGVMaW1pdGluZ0VuYWJsZWQoKSkge1xuICAgIHJldHVybiBhd2FpdCBoYW5kbGVyKClcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNoZWNrUmF0ZUxpbWl0KHJlcSwgY29uZmlnKVxuXG4gIGlmICghcmVzdWx0LmFsbG93ZWQpIHtcbiAgICAvLyBDcmVhciBoZWFkZXJzIGRlIHJhdGUgbGltaXRcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKVxuXG4gICAgaWYgKGNvbmZpZy5oZWFkZXJzICE9PSBmYWxzZSkge1xuICAgICAgaWYgKGNvbmZpZy5zdGFuZGFyZEhlYWRlcnMgIT09IGZhbHNlKSB7XG4gICAgICAgIC8vIEhlYWRlcnMgZXN0w6FuZGFyIFJGQyA2NTg1XG4gICAgICAgIGhlYWRlcnMuc2V0KCdSYXRlTGltaXQtTGltaXQnLCByZXN1bHQubGltaXQudG9TdHJpbmcoKSlcbiAgICAgICAgaGVhZGVycy5zZXQoJ1JhdGVMaW1pdC1SZW1haW5pbmcnLCByZXN1bHQucmVtYWluaW5nLnRvU3RyaW5nKCkpXG4gICAgICAgIGhlYWRlcnMuc2V0KCdSYXRlTGltaXQtUmVzZXQnLCBuZXcgRGF0ZShyZXN1bHQucmVzZXRUaW1lKS50b0lTT1N0cmluZygpKVxuICAgICAgfVxuXG4gICAgICBpZiAoY29uZmlnLmxlZ2FjeUhlYWRlcnMgIT09IGZhbHNlKSB7XG4gICAgICAgIC8vIEhlYWRlcnMgbGVnYWN5IHBhcmEgY29tcGF0aWJpbGlkYWRcbiAgICAgICAgaGVhZGVycy5zZXQoJ1gtUmF0ZUxpbWl0LUxpbWl0JywgcmVzdWx0LmxpbWl0LnRvU3RyaW5nKCkpXG4gICAgICAgIGhlYWRlcnMuc2V0KCdYLVJhdGVMaW1pdC1SZW1haW5pbmcnLCByZXN1bHQucmVtYWluaW5nLnRvU3RyaW5nKCkpXG4gICAgICAgIGhlYWRlcnMuc2V0KCdYLVJhdGVMaW1pdC1SZXNldCcsIE1hdGguY2VpbChyZXN1bHQucmVzZXRUaW1lIC8gMTAwMCkudG9TdHJpbmcoKSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocmVzdWx0LnJldHJ5QWZ0ZXIpIHtcbiAgICAgIGhlYWRlcnMuc2V0KCdSZXRyeS1BZnRlcicsIHJlc3VsdC5yZXRyeUFmdGVyLnRvU3RyaW5nKCkpXG4gICAgfVxuXG4gICAgLy8gTG9nIGRlbCByYXRlIGxpbWl0IGV4Y2VkaWRvXG4gICAgY29uc29sZS53YXJuKCdbUkFURV9MSU1JVEVSXSBSYXRlIGxpbWl0IGV4Y2VlZGVkOicsIHtcbiAgICAgIGtleTogY29uZmlnLmtleUdlbmVyYXRvciA/IGNvbmZpZy5rZXlHZW5lcmF0b3IocmVxKSA6ICdjb21iaW5lZCcsXG4gICAgICBsaW1pdDogcmVzdWx0LmxpbWl0LFxuICAgICAgcmVzZXRUaW1lOiBuZXcgRGF0ZShyZXN1bHQucmVzZXRUaW1lKS50b0lTT1N0cmluZygpLFxuICAgICAgdXNlckFnZW50OiByZXEuaGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKSxcbiAgICAgIGlwOiByZXEuaGVhZGVycy5nZXQoJ3gtZm9yd2FyZGVkLWZvcicpIHx8IHJlcS5oZWFkZXJzLmdldCgneC1yZWFsLWlwJyksXG4gICAgfSlcblxuICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKFxuICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBlcnJvcjogJ1JhdGUgbGltaXQgZXhjZWVkZWQnLFxuICAgICAgICBtZXNzYWdlOiBjb25maWcubWVzc2FnZSB8fCAnVG9vIG1hbnkgcmVxdWVzdHMnLFxuICAgICAgICByZXRyeUFmdGVyOiByZXN1bHQucmV0cnlBZnRlcixcbiAgICAgIH0pLFxuICAgICAge1xuICAgICAgICBzdGF0dXM6IDQyOSxcbiAgICAgICAgaGVhZGVycyxcbiAgICAgIH1cbiAgICApXG4gIH1cblxuICByZXR1cm4gaGFuZGxlcigpXG59XG4iXSwibmFtZXMiOlsiUkFURV9MSU1JVF9DT05GSUdTIiwiY2hlY2tSYXRlTGltaXQiLCJjcmVhdGVSYXRlTGltaXRNaWRkbGV3YXJlIiwiY3JlYXRlUmF0ZUxpbWl0ZXIiLCJrZXlHZW5lcmF0b3JzIiwid2l0aFJhdGVMaW1pdCIsIlBST0RVQ1RJT05fQ09ORklHUyIsInB1YmxpYyIsIndpbmRvd01zIiwibWF4UmVxdWVzdHMiLCJtZXNzYWdlIiwicHJvZHVjdHMiLCJzZWFyY2giLCJERVZFTE9QTUVOVF9DT05GSUdTIiwiaXNSYXRlTGltaXRpbmdFbmFibGVkIiwicHJvY2VzcyIsImVudiIsIkRJU0FCTEVfUkFURV9MSU1JVElORyIsImlzRGV2ZWxvcG1lbnQiLCJOT0RFX0VOViIsImJhc2VDb25maWdzIiwiYXV0aCIsImFkbWluIiwicGF5bWVudCIsImNyZWF0aW9uIiwid2ViaG9vayIsImNvbnNvbGUiLCJsb2ciLCJlbnZpcm9ubWVudCIsInJhdGVMaW1pdGluZ0VuYWJsZWQiLCJkaXNhYmxlUmF0ZUxpbWl0aW5nIiwicHJvZHVjdExpbWl0cyIsInNlYXJjaExpbWl0cyIsIk1lbW9yeVN0b3JlIiwiZ2V0Iiwia2V5IiwiZGF0YSIsInN0b3JlIiwiRGF0ZSIsIm5vdyIsInJlc2V0VGltZSIsImRlbGV0ZSIsInNldCIsInZhbHVlIiwidHRsIiwic2V0VGltZW91dCIsImluY3JlbWVudCIsImV4aXN0aW5nIiwibmV3RGF0YSIsImNvdW50IiwidXBkYXRlZERhdGEiLCJNYXAiLCJkZWZhdWx0U3RvcmUiLCJpcCIsInJlcSIsImZvcndhcmRlZCIsImhlYWRlcnMiLCJzcGxpdCIsInVzZXIiLCJ1c2VySWQiLCJlbmRwb2ludCIsInVybCIsIlVSTCIsInBhdGhuYW1lIiwiY29tYmluZWQiLCJjb25maWciLCJmaW5hbENvbmZpZyIsInN0YW5kYXJkSGVhZGVycyIsImxlZ2FjeUhlYWRlcnMiLCJrZXlHZW5lcmF0b3IiLCJyZXN1bHQiLCJhbGxvd2VkIiwibGltaXQiLCJyZW1haW5pbmciLCJNYXRoIiwibWF4IiwicmV0cnlBZnRlciIsImNlaWwiLCJlcnJvciIsIkhlYWRlcnMiLCJ0b1N0cmluZyIsInRvSVNPU3RyaW5nIiwid2FybiIsInVzZXJBZ2VudCIsIk5leHRSZXNwb25zZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGF0dXMiLCJuZXh0IiwiaGFuZGxlciJdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBQ3RDLGdEQUFnRDtBQUNoRCxzQ0FBc0M7QUFDdEMsaUVBQWlFO0FBQ2pFLDRDQUE0Qzs7Ozs7Ozs7Ozs7O1FBK0YvQkE7ZUFBQUE7O1FBdUxTQztlQUFBQTs7UUF3Q05DO2VBQUFBOztRQS9EQUM7ZUFBQUE7O1FBcENIQztlQUFBQTs7UUFnS1NDO2VBQUFBOzs7d0JBelhvQjtBQWlDMUMsc0NBQXNDO0FBQ3RDLCtCQUErQjtBQUMvQixzQ0FBc0M7QUFFdEMsdUNBQXVDO0FBQ3ZDLE1BQU1DLHFCQUFxQjtJQUN6QkMsUUFBUTtRQUNOQyxVQUFVLEtBQUssS0FBSztRQUNwQkMsYUFBYTtRQUNiQyxTQUFTO0lBQ1g7SUFDQUMsVUFBVTtRQUNSSCxVQUFVLElBQUksS0FBSztRQUNuQkMsYUFBYTtRQUNiQyxTQUFTO0lBQ1g7SUFDQUUsUUFBUTtRQUNOSixVQUFVLElBQUksS0FBSztRQUNuQkMsYUFBYTtRQUNiQyxTQUFTO0lBQ1g7QUFDRjtBQUVBLDRDQUE0QztBQUM1QyxNQUFNRyxzQkFBc0I7SUFDMUJOLFFBQVE7UUFDTkMsVUFBVSxLQUFLLEtBQUs7UUFDcEJDLGFBQWE7UUFDYkMsU0FBUztJQUNYO0lBQ0FDLFVBQVU7UUFDUkgsVUFBVSxJQUFJLEtBQUs7UUFDbkJDLGFBQWE7UUFDYkMsU0FBUztJQUNYO0lBQ0FFLFFBQVE7UUFDTkosVUFBVSxJQUFJLEtBQUs7UUFDbkJDLGFBQWE7UUFDYkMs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