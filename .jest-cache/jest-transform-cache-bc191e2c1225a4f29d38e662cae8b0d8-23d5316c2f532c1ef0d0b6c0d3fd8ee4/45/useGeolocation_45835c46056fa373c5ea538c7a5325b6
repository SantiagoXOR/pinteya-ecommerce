1b8233d707fcd91f9c952d4ca3354390
/**
 * Hook para geolocalizaci√≥n autom√°tica y detecci√≥n de zona de entrega
 * Detecta la ubicaci√≥n del usuario y determina la zona de entrega m√°s cercana
 */ 'use client';
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "useGeolocation", {
    enumerable: true,
    get: function() {
        return useGeolocation;
    }
});
const _react = require("react");
// Zonas de entrega con coordenadas aproximadas
const DELIVERY_ZONES = [
    {
        id: 'cordoba-capital',
        name: 'C√≥rdoba Capital',
        available: true,
        coordinates: {
            lat: -31.4201,
            lng: -64.1888
        },
        radius: 15
    },
    {
        id: 'cordoba-interior',
        name: 'Interior de C√≥rdoba',
        available: true,
        coordinates: {
            lat: -31.4201,
            lng: -64.1888
        },
        radius: 100
    },
    {
        id: 'buenos-aires',
        name: 'Buenos Aires',
        available: false,
        coordinates: {
            lat: -34.6118,
            lng: -58.396
        },
        radius: 50
    },
    {
        id: 'rosario',
        name: 'Rosario',
        available: false,
        coordinates: {
            lat: -32.9442,
            lng: -60.6505
        },
        radius: 30
    }
];
// Funci√≥n para calcular distancia entre dos puntos (f√≥rmula de Haversine)
function calculateDistance(lat1, lng1, lat2, lng2) {
    const R = 6371 // Radio de la Tierra en km
    ;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLng = (lng2 - lng1) * Math.PI / 180;
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLng / 2) * Math.sin(dLng / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
}
// Funci√≥n para detectar la zona m√°s cercana
function detectNearestZone(userLat, userLng) {
    let nearestZone = null;
    let minDistance = Infinity;
    for (const zone of DELIVERY_ZONES){
        if (zone.coordinates) {
            const distance = calculateDistance(userLat, userLng, zone.coordinates.lat, zone.coordinates.lng);
            console.log(`üó∫Ô∏è Distance to ${zone.name}: ${distance.toFixed(2)}km (radius: ${zone.radius}km)`);
            // Verificar si est√° dentro del radio de la zona
            if (zone.radius && distance <= zone.radius && distance < minDistance) {
                nearestZone = zone;
                minDistance = distance;
            } else {}
        } else {}
    }
    // Si no encuentra una zona espec√≠fica, usar C√≥rdoba Interior como fallback
    const fallbackZone = DELIVERY_ZONES.find((zone)=>zone.id === 'cordoba-interior');
    const result = nearestZone || fallbackZone || null;
    return result;
}
const useGeolocation = ()=>{
    const [state, setState] = (0, _react.useState)({
        location: null,
        isLoading: false,
        error: null,
        permissionStatus: 'unknown',
        detectedZone: null
    });
    // Funci√≥n para solicitar geolocalizaci√≥n
    const requestLocation = (0, _react.useCallback)(()=>{
        if (!navigator.geolocation) {
            setState((prev)=>({
                    ...prev,
                    error: 'Geolocalizaci√≥n no soportada por este navegador',
                    permissionStatus: 'denied'
                }));
            return;
        }
        setState((prev)=>{
            const newState = {
                ...prev,
                isLoading: true,
                error: null
            };
            return newState;
        });
        // Usar Promise para mejor manejo de errores
        const getCurrentPositionPromise = ()=>{
            return new Promise((resolve, reject)=>{
                navigator.geolocation.getCurrentPosition(resolve, reject, {
                    enableHighAccuracy: false,
                    timeout: 30000,
                    maximumAge: 0
                });
            });
        };
        // Ejecutar con async/await para mejor control
        getCurrentPositionPromise().then((position)=>{
            const { latitude, longitude, accuracy } = position.coords;
            const detectedZone = detectNearestZone(latitude, longitude);
            // Usar setTimeout para asegurar que el setState se ejecute en el pr√≥ximo tick
            setTimeout(()=>{
                setState((prev)=>{
                    const newState = {
                        ...prev,
                        location: {
                            lat: latitude,
                            lng: longitude
                        },
                        detectedZone,
                        isLoading: false,
                        permissionStatus: 'granted',
                        error: null
                    };
                    return newState;
                });
            }, 0);
        }).catch((error)=>{
            let errorMessage = 'Error al obtener ubicaci√≥n';
            let permissionStatus = 'unknown';
            switch(error.code){
                case error.PERMISSION_DENIED:
                    errorMessage = 'Permisos de ubicaci√≥n denegados';
                    permissionStatus = 'denied';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = 'Ubicaci√≥n no disponible';
                    break;
                case error.TIMEOUT:
                    errorMessage = 'Tiempo de espera agotado';
                    break;
            }
            // Tambi√©n usar setTimeout para el manejo de errores
            setTimeout(()=>{
                setState((prev)=>({
                        ...prev,
                        error: errorMessage,
                        isLoading: false,
                        permissionStatus
                    }));
            }, 0);
        });
    }, []);
    // Verificar permisos al montar el componente
    (0, _react.useEffect)(()=>{
        if ('permissions' in navigator) {
            navigator.permissions.query({
                name: 'geolocation'
            }).then((result)=>{
                setState((prev)=>({
                        ...prev,
                        permissionStatus: result.state
                    }));
                // Si ya tiene permisos, solicitar ubicaci√≥n autom√°ticamente
                if (result.state === 'granted') {
                // No solicitar autom√°ticamente para evitar bucles infinitos
                } else if (result.state === 'prompt') {
                // No solicitar autom√°ticamente si es 'prompt' para evitar popup inesperado
                } else {}
            }).catch((error)=>{
                setState((prev)=>({
                        ...prev,
                        permissionStatus: 'unknown'
                    }));
            });
        } else {
            setState((prev)=>({
                    ...prev,
                    permissionStatus: 'unknown'
                }));
        }
    }, []); // Sin dependencias para evitar bucles
    // Funci√≥n para obtener todas las zonas disponibles
    const getAvailableZones = (0, _react.useCallback)(()=>{
        return DELIVERY_ZONES;
    }, []);
    // Funci√≥n para seleccionar zona manualmente
    const selectZone = (0, _react.useCallback)((zoneId)=>{
        const zone = DELIVERY_ZONES.find((z)=>z.id === zoneId);
        if (zone) {
            setState((prev)=>({
                    ...prev,
                    detectedZone: zone
                }));
        }
    }, []);
    // Funci√≥n de test para simular geolocalizaci√≥n exitosa
    const testLocation = (0, _react.useCallback)((lat = -31.4201, lng = -64.1888)=>{
        const detectedZone = detectNearestZone(lat, lng);
        setState((prev)=>{
            const newState = {
                ...prev,
                location: {
                    lat,
                    lng
                },
                detectedZone,
                isLoading: false,
                permissionStatus: 'granted',
                error: null
            };
            return newState;
        });
    }, []);
    return {
        ...state,
        requestLocation,
        getAvailableZones,
        selectZone,
        deliveryZones: DELIVERY_ZONES,
        testLocation
    };
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcaG9va3NcXHVzZUdlb2xvY2F0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSG9vayBwYXJhIGdlb2xvY2FsaXphY2nDs24gYXV0b23DoXRpY2EgeSBkZXRlY2Npw7NuIGRlIHpvbmEgZGUgZW50cmVnYVxuICogRGV0ZWN0YSBsYSB1YmljYWNpw7NuIGRlbCB1c3VhcmlvIHkgZGV0ZXJtaW5hIGxhIHpvbmEgZGUgZW50cmVnYSBtw6FzIGNlcmNhbmFcbiAqL1xuXG4ndXNlIGNsaWVudCdcblxuaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCdcblxuZXhwb3J0IGludGVyZmFjZSBEZWxpdmVyeVpvbmUge1xuICBpZDogc3RyaW5nXG4gIG5hbWU6IHN0cmluZ1xuICBhdmFpbGFibGU6IGJvb2xlYW5cbiAgY29vcmRpbmF0ZXM/OiB7XG4gICAgbGF0OiBudW1iZXJcbiAgICBsbmc6IG51bWJlclxuICB9XG4gIHJhZGl1cz86IG51bWJlciAvLyBSYWRpbyBlbiBrbVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdlb2xvY2F0aW9uU3RhdGUge1xuICBsb2NhdGlvbjoge1xuICAgIGxhdDogbnVtYmVyXG4gICAgbG5nOiBudW1iZXJcbiAgfSB8IG51bGxcbiAgaXNMb2FkaW5nOiBib29sZWFuXG4gIGVycm9yOiBzdHJpbmcgfCBudWxsXG4gIHBlcm1pc3Npb25TdGF0dXM6ICdncmFudGVkJyB8ICdkZW5pZWQnIHwgJ3Byb21wdCcgfCAndW5rbm93bidcbiAgZGV0ZWN0ZWRab25lOiBEZWxpdmVyeVpvbmUgfCBudWxsXG59XG5cbi8vIFpvbmFzIGRlIGVudHJlZ2EgY29uIGNvb3JkZW5hZGFzIGFwcm94aW1hZGFzXG5jb25zdCBERUxJVkVSWV9aT05FUzogRGVsaXZlcnlab25lW10gPSBbXG4gIHtcbiAgICBpZDogJ2NvcmRvYmEtY2FwaXRhbCcsXG4gICAgbmFtZTogJ0PDs3Jkb2JhIENhcGl0YWwnLFxuICAgIGF2YWlsYWJsZTogdHJ1ZSxcbiAgICBjb29yZGluYXRlczogeyBsYXQ6IC0zMS40MjAxLCBsbmc6IC02NC4xODg4IH0sXG4gICAgcmFkaXVzOiAxNSxcbiAgfSxcbiAge1xuICAgIGlkOiAnY29yZG9iYS1pbnRlcmlvcicsXG4gICAgbmFtZTogJ0ludGVyaW9yIGRlIEPDs3Jkb2JhJyxcbiAgICBhdmFpbGFibGU6IHRydWUsXG4gICAgY29vcmRpbmF0ZXM6IHsgbGF0OiAtMzEuNDIwMSwgbG5nOiAtNjQuMTg4OCB9LFxuICAgIHJhZGl1czogMTAwLFxuICB9LFxuICB7XG4gICAgaWQ6ICdidWVub3MtYWlyZXMnLFxuICAgIG5hbWU6ICdCdWVub3MgQWlyZXMnLFxuICAgIGF2YWlsYWJsZTogZmFsc2UsXG4gICAgY29vcmRpbmF0ZXM6IHsgbGF0OiAtMzQuNjExOCwgbG5nOiAtNTguMzk2IH0sXG4gICAgcmFkaXVzOiA1MCxcbiAgfSxcbiAge1xuICAgIGlkOiAncm9zYXJpbycsXG4gICAgbmFtZTogJ1Jvc2FyaW8nLFxuICAgIGF2YWlsYWJsZTogZmFsc2UsXG4gICAgY29vcmRpbmF0ZXM6IHsgbGF0OiAtMzIuOTQ0MiwgbG5nOiAtNjAuNjUwNSB9LFxuICAgIHJhZGl1czogMzAsXG4gIH0sXG5dXG5cbi8vIEZ1bmNpw7NuIHBhcmEgY2FsY3VsYXIgZGlzdGFuY2lhIGVudHJlIGRvcyBwdW50b3MgKGbDs3JtdWxhIGRlIEhhdmVyc2luZSlcbmZ1bmN0aW9uIGNhbGN1bGF0ZURpc3RhbmNlKGxhdDE6IG51bWJlciwgbG5nMTogbnVtYmVyLCBsYXQyOiBudW1iZXIsIGxuZzI6IG51bWJlcik6IG51bWJlciB7XG4gIGNvbnN0IFIgPSA2MzcxIC8vIFJhZGlvIGRlIGxhIFRpZXJyYSBlbiBrbVxuICBjb25zdCBkTGF0ID0gKChsYXQyIC0gbGF0MSkgKiBNYXRoLlBJKSAvIDE4MFxuICBjb25zdCBkTG5nID0gKChsbmcyIC0gbG5nMSkgKiBNYXRoLlBJKSAvIDE4MFxuICBjb25zdCBhID1cbiAgICBNYXRoLnNpbihkTGF0IC8gMikgKiBNYXRoLnNpbihkTGF0IC8gMikgK1xuICAgIE1hdGguY29zKChsYXQxICogTWF0aC5QSSkgLyAxODApICpcbiAgICAgIE1hdGguY29zKChsYXQyICogTWF0aC5QSSkgLyAxODApICpcbiAgICAgIE1hdGguc2luKGRMbmcgLyAyKSAqXG4gICAgICBNYXRoLnNpbihkTG5nIC8gMilcbiAgY29uc3QgYyA9IDIgKiBNYXRoLmF0YW4yKE1hdGguc3FydChhKSwgTWF0aC5zcXJ0KDEgLSBhKSlcbiAgcmV0dXJuIFIgKiBjXG59XG5cbi8vIEZ1bmNpw7NuIHBhcmEgZGV0ZWN0YXIgbGEgem9uYSBtw6FzIGNlcmNhbmFcbmZ1bmN0aW9uIGRldGVjdE5lYXJlc3Rab25lKHVzZXJMYXQ6IG51bWJlciwgdXNlckxuZzogbnVtYmVyKTogRGVsaXZlcnlab25lIHwgbnVsbCB7XG4gIGxldCBuZWFyZXN0Wm9uZTogRGVsaXZlcnlab25lIHwgbnVsbCA9IG51bGxcbiAgbGV0IG1pbkRpc3RhbmNlID0gSW5maW5pdHlcblxuICBmb3IgKGNvbnN0IHpvbmUgb2YgREVMSVZFUllfWk9ORVMpIHtcbiAgICBpZiAoem9uZS5jb29yZGluYXRlcykge1xuICAgICAgY29uc3QgZGlzdGFuY2UgPSBjYWxjdWxhdGVEaXN0YW5jZShcbiAgICAgICAgdXNlckxhdCxcbiAgICAgICAgdXNlckxuZyxcbiAgICAgICAgem9uZS5jb29yZGluYXRlcy5sYXQsXG4gICAgICAgIHpvbmUuY29vcmRpbmF0ZXMubG5nXG4gICAgICApXG5cbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg8J+Xuu+4jyBEaXN0YW5jZSB0byAke3pvbmUubmFtZX06ICR7ZGlzdGFuY2UudG9GaXhlZCgyKX1rbSAocmFkaXVzOiAke3pvbmUucmFkaXVzfWttKWBcbiAgICAgIClcblxuICAgICAgLy8gVmVyaWZpY2FyIHNpIGVzdMOhIGRlbnRybyBkZWwgcmFkaW8gZGUgbGEgem9uYVxuICAgICAgaWYgKHpvbmUucmFkaXVzICYmIGRpc3RhbmNlIDw9IHpvbmUucmFkaXVzICYmIGRpc3RhbmNlIDwgbWluRGlzdGFuY2UpIHtcbiAgICAgICAgbmVhcmVzdFpvbmUgPSB6b25lXG4gICAgICAgIG1pbkRpc3RhbmNlID0gZGlzdGFuY2VcbiAgICAgIH0gZWxzZSB7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICB9XG4gIH1cblxuICAvLyBTaSBubyBlbmN1ZW50cmEgdW5hIHpvbmEgZXNwZWPDrWZpY2EsIHVzYXIgQ8OzcmRvYmEgSW50ZXJpb3IgY29tbyBmYWxsYmFja1xuICBjb25zdCBmYWxsYmFja1pvbmUgPSBERUxJVkVSWV9aT05FUy5maW5kKHpvbmUgPT4gem9uZS5pZCA9PT0gJ2NvcmRvYmEtaW50ZXJpb3InKVxuICBjb25zdCByZXN1bHQgPSBuZWFyZXN0Wm9uZSB8fCBmYWxsYmFja1pvbmUgfHwgbnVsbFxuXG4gIHJldHVybiByZXN1bHRcbn1cblxuZXhwb3J0IGNvbnN0IHVzZUdlb2xvY2F0aW9uID0gKCkgPT4ge1xuICBjb25zdCBbc3RhdGUsIHNldFN0YXRlXSA9IHVzZVN0YXRlPEdlb2xvY2F0aW9uU3RhdGU+KHtcbiAgICBsb2NhdGlvbjogbnVsbCxcbiAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgIGVycm9yOiBudWxsLFxuICAgIHBlcm1pc3Npb25TdGF0dXM6ICd1bmtub3duJyxcbiAgICBkZXRlY3RlZFpvbmU6IG51bGwsXG4gIH0pXG5cbiAgLy8gRnVuY2nDs24gcGFyYSBzb2xpY2l0YXIgZ2VvbG9jYWxpemFjacOzblxuICBjb25zdCByZXF1ZXN0TG9jYXRpb24gPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaWYgKCFuYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHtcbiAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgZXJyb3I6ICdHZW9sb2NhbGl6YWNpw7NuIG5vIHNvcG9ydGFkYSBwb3IgZXN0ZSBuYXZlZ2Fkb3InLFxuICAgICAgICBwZXJtaXNzaW9uU3RhdHVzOiAnZGVuaWVkJyxcbiAgICAgIH0pKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgc2V0U3RhdGUocHJldiA9PiB7XG4gICAgICBjb25zdCBuZXdTdGF0ZSA9IHsgLi4ucHJldiwgaXNMb2FkaW5nOiB0cnVlLCBlcnJvcjogbnVsbCB9XG4gICAgICByZXR1cm4gbmV3U3RhdGVcbiAgICB9KVxuXG4gICAgLy8gVXNhciBQcm9taXNlIHBhcmEgbWVqb3IgbWFuZWpvIGRlIGVycm9yZXNcbiAgICBjb25zdCBnZXRDdXJyZW50UG9zaXRpb25Qcm9taXNlID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPEdlb2xvY2F0aW9uUG9zaXRpb24+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbihyZXNvbHZlLCByZWplY3QsIHtcbiAgICAgICAgICBlbmFibGVIaWdoQWNjdXJhY3k6IGZhbHNlLFxuICAgICAgICAgIHRpbWVvdXQ6IDMwMDAwLFxuICAgICAgICAgIG1heGltdW1BZ2U6IDAsXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIEVqZWN1dGFyIGNvbiBhc3luYy9hd2FpdCBwYXJhIG1lam9yIGNvbnRyb2xcbiAgICBnZXRDdXJyZW50UG9zaXRpb25Qcm9taXNlKClcbiAgICAgIC50aGVuKHBvc2l0aW9uID0+IHtcbiAgICAgICAgY29uc3QgeyBsYXRpdHVkZSwgbG9uZ2l0dWRlLCBhY2N1cmFjeSB9ID0gcG9zaXRpb24uY29vcmRzXG5cbiAgICAgICAgY29uc3QgZGV0ZWN0ZWRab25lID0gZGV0ZWN0TmVhcmVzdFpvbmUobGF0aXR1ZGUsIGxvbmdpdHVkZSlcblxuICAgICAgICAvLyBVc2FyIHNldFRpbWVvdXQgcGFyYSBhc2VndXJhciBxdWUgZWwgc2V0U3RhdGUgc2UgZWplY3V0ZSBlbiBlbCBwcsOzeGltbyB0aWNrXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHNldFN0YXRlKHByZXYgPT4ge1xuICAgICAgICAgICAgY29uc3QgbmV3U3RhdGUgPSB7XG4gICAgICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgICAgIGxvY2F0aW9uOiB7IGxhdDogbGF0aXR1ZGUsIGxuZzogbG9uZ2l0dWRlIH0sXG4gICAgICAgICAgICAgIGRldGVjdGVkWm9uZSxcbiAgICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgcGVybWlzc2lvblN0YXR1czogJ2dyYW50ZWQnIGFzIGNvbnN0LFxuICAgICAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXdTdGF0ZVxuICAgICAgICAgIH0pXG4gICAgICAgIH0sIDApXG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9ICdFcnJvciBhbCBvYnRlbmVyIHViaWNhY2nDs24nXG4gICAgICAgIGxldCBwZXJtaXNzaW9uU3RhdHVzOiAnZGVuaWVkJyB8ICd1bmtub3duJyA9ICd1bmtub3duJ1xuXG4gICAgICAgIHN3aXRjaCAoZXJyb3IuY29kZSkge1xuICAgICAgICAgIGNhc2UgZXJyb3IuUEVSTUlTU0lPTl9ERU5JRUQ6XG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAnUGVybWlzb3MgZGUgdWJpY2FjacOzbiBkZW5lZ2Fkb3MnXG4gICAgICAgICAgICBwZXJtaXNzaW9uU3RhdHVzID0gJ2RlbmllZCdcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgY2FzZSBlcnJvci5QT1NJVElPTl9VTkFWQUlMQUJMRTpcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICdVYmljYWNpw7NuIG5vIGRpc3BvbmlibGUnXG4gICAgICAgICAgICBicmVha1xuICAgICAgICAgIGNhc2UgZXJyb3IuVElNRU9VVDpcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICdUaWVtcG8gZGUgZXNwZXJhIGFnb3RhZG8nXG4gICAgICAgICAgICBicmVha1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGFtYmnDqW4gdXNhciBzZXRUaW1lb3V0IHBhcmEgZWwgbWFuZWpvIGRlIGVycm9yZXNcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgc2V0U3RhdGUocHJldiA9PiAoe1xuICAgICAgICAgICAgLi4ucHJldixcbiAgICAgICAgICAgIGVycm9yOiBlcnJvck1lc3NhZ2UsXG4gICAgICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgcGVybWlzc2lvblN0YXR1cyxcbiAgICAgICAgICB9KSlcbiAgICAgICAgfSwgMClcbiAgICAgIH0pXG4gIH0sIFtdKVxuXG4gIC8vIFZlcmlmaWNhciBwZXJtaXNvcyBhbCBtb250YXIgZWwgY29tcG9uZW50ZVxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICgncGVybWlzc2lvbnMnIGluIG5hdmlnYXRvcikge1xuICAgICAgbmF2aWdhdG9yLnBlcm1pc3Npb25zXG4gICAgICAgIC5xdWVyeSh7IG5hbWU6ICdnZW9sb2NhdGlvbicgfSlcbiAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICBzZXRTdGF0ZShwcmV2ID0+ICh7IC4uLnByZXYsIHBlcm1pc3Npb25TdGF0dXM6IHJlc3VsdC5zdGF0ZSBhcyBhbnkgfSkpXG5cbiAgICAgICAgICAvLyBTaSB5YSB0aWVuZSBwZXJtaXNvcywgc29saWNpdGFyIHViaWNhY2nDs24gYXV0b23DoXRpY2FtZW50ZVxuICAgICAgICAgIGlmIChyZXN1bHQuc3RhdGUgPT09ICdncmFudGVkJykge1xuICAgICAgICAgICAgLy8gTm8gc29saWNpdGFyIGF1dG9tw6F0aWNhbWVudGUgcGFyYSBldml0YXIgYnVjbGVzIGluZmluaXRvc1xuICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0LnN0YXRlID09PSAncHJvbXB0Jykge1xuICAgICAgICAgICAgLy8gTm8gc29saWNpdGFyIGF1dG9tw6F0aWNhbWVudGUgc2kgZXMgJ3Byb21wdCcgcGFyYSBldml0YXIgcG9wdXAgaW5lc3BlcmFkb1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIHNldFN0YXRlKHByZXYgPT4gKHsgLi4ucHJldiwgcGVybWlzc2lvblN0YXR1czogJ3Vua25vd24nIH0pKVxuICAgICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICBzZXRTdGF0ZShwcmV2ID0+ICh7IC4uLnByZXYsIHBlcm1pc3Npb25TdGF0dXM6ICd1bmtub3duJyB9KSlcbiAgICB9XG4gIH0sIFtdKSAvLyBTaW4gZGVwZW5kZW5jaWFzIHBhcmEgZXZpdGFyIGJ1Y2xlc1xuXG4gIC8vIEZ1bmNpw7NuIHBhcmEgb2J0ZW5lciB0b2RhcyBsYXMgem9uYXMgZGlzcG9uaWJsZXNcbiAgY29uc3QgZ2V0QXZhaWxhYmxlWm9uZXMgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgcmV0dXJuIERFTElWRVJZX1pPTkVTXG4gIH0sIFtdKVxuXG4gIC8vIEZ1bmNpw7NuIHBhcmEgc2VsZWNjaW9uYXIgem9uYSBtYW51YWxtZW50ZVxuICBjb25zdCBzZWxlY3Rab25lID0gdXNlQ2FsbGJhY2soKHpvbmVJZDogc3RyaW5nKSA9PiB7XG4gICAgY29uc3Qgem9uZSA9IERFTElWRVJZX1pPTkVTLmZpbmQoeiA9PiB6LmlkID09PSB6b25lSWQpXG4gICAgaWYgKHpvbmUpIHtcbiAgICAgIHNldFN0YXRlKHByZXYgPT4gKHsgLi4ucHJldiwgZGV0ZWN0ZWRab25lOiB6b25lIH0pKVxuICAgIH1cbiAgfSwgW10pXG5cbiAgLy8gRnVuY2nDs24gZGUgdGVzdCBwYXJhIHNpbXVsYXIgZ2VvbG9jYWxpemFjacOzbiBleGl0b3NhXG4gIGNvbnN0IHRlc3RMb2NhdGlvbiA9IHVzZUNhbGxiYWNrKChsYXQ6IG51bWJlciA9IC0zMS40MjAxLCBsbmc6IG51bWJlciA9IC02NC4xODg4KSA9PiB7XG4gICAgY29uc3QgZGV0ZWN0ZWRab25lID0gZGV0ZWN0TmVhcmVzdFpvbmUobGF0LCBsbmcpXG5cbiAgICBzZXRTdGF0ZShwcmV2ID0+IHtcbiAgICAgIGNvbnN0IG5ld1N0YXRlID0ge1xuICAgICAgICAuLi5wcmV2LFxuICAgICAgICBsb2NhdGlvbjogeyBsYXQsIGxuZyB9LFxuICAgICAgICBkZXRlY3RlZFpvbmUsXG4gICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgIHBlcm1pc3Npb25TdGF0dXM6ICdncmFudGVkJyBhcyBjb25zdCxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3U3RhdGVcbiAgICB9KVxuICB9LCBbXSlcblxuICByZXR1cm4ge1xuICAgIC4uLnN0YXRlLFxuICAgIHJlcXVlc3RMb2NhdGlvbixcbiAgICBnZXRBdmFpbGFibGVab25lcyxcbiAgICBzZWxlY3Rab25lLFxuICAgIGRlbGl2ZXJ5Wm9uZXM6IERFTElWRVJZX1pPTkVTLFxuICAgIHRlc3RMb2NhdGlvbiwgLy8gRnVuY2nDs24gZGUgdGVzdCBwYXJhIGRlYnVnZ2luZ1xuICB9XG59XG4iXSwibmFtZXMiOlsidXNlR2VvbG9jYXRpb24iLCJERUxJVkVSWV9aT05FUyIsImlkIiwibmFtZSIsImF2YWlsYWJsZSIsImNvb3JkaW5hdGVzIiwibGF0IiwibG5nIiwicmFkaXVzIiwiY2FsY3VsYXRlRGlzdGFuY2UiLCJsYXQxIiwibG5nMSIsImxhdDIiLCJsbmcyIiwiUiIsImRMYXQiLCJNYXRoIiwiUEkiLCJkTG5nIiwiYSIsInNpbiIsImNvcyIsImMiLCJhdGFuMiIsInNxcnQiLCJkZXRlY3ROZWFyZXN0Wm9uZSIsInVzZXJMYXQiLCJ1c2VyTG5nIiwibmVhcmVzdFpvbmUiLCJtaW5EaXN0YW5jZSIsIkluZmluaXR5Iiwiem9uZSIsImRpc3RhbmNlIiwiY29uc29sZSIsImxvZyIsInRvRml4ZWQiLCJmYWxsYmFja1pvbmUiLCJmaW5kIiwicmVzdWx0Iiwic3RhdGUiLCJzZXRTdGF0ZSIsInVzZVN0YXRlIiwibG9jYXRpb24iLCJpc0xvYWRpbmciLCJlcnJvciIsInBlcm1pc3Npb25TdGF0dXMiLCJkZXRlY3RlZFpvbmUiLCJyZXF1ZXN0TG9jYXRpb24iLCJ1c2VDYWxsYmFjayIsIm5hdmlnYXRvciIsImdlb2xvY2F0aW9uIiwicHJldiIsIm5ld1N0YXRlIiwiZ2V0Q3VycmVudFBvc2l0aW9uUHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZ2V0Q3VycmVudFBvc2l0aW9uIiwiZW5hYmxlSGlnaEFjY3VyYWN5IiwidGltZW91dCIsIm1heGltdW1BZ2UiLCJ0aGVuIiwicG9zaXRpb24iLCJsYXRpdHVkZSIsImxvbmdpdHVkZSIsImFjY3VyYWN5IiwiY29vcmRzIiwic2V0VGltZW91dCIsImNhdGNoIiwiZXJyb3JNZXNzYWdlIiwiY29kZSIsIlBFUk1JU1NJT05fREVOSUVEIiwiUE9TSVRJT05fVU5BVkFJTEFCTEUiLCJUSU1FT1VUIiwidXNlRWZmZWN0IiwicGVybWlzc2lvbnMiLCJxdWVyeSIsImdldEF2YWlsYWJsZVpvbmVzIiwic2VsZWN0Wm9uZSIsInpvbmVJZCIsInoiLCJ0ZXN0TG9jYXRpb24iLCJkZWxpdmVyeVpvbmVzIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0MsR0FFRDs7Ozs7K0JBNEdhQTs7O2VBQUFBOzs7dUJBMUdvQztBQXdCakQsK0NBQStDO0FBQy9DLE1BQU1DLGlCQUFpQztJQUNyQztRQUNFQyxJQUFJO1FBQ0pDLE1BQU07UUFDTkMsV0FBVztRQUNYQyxhQUFhO1lBQUVDLEtBQUssQ0FBQztZQUFTQyxLQUFLLENBQUM7UUFBUTtRQUM1Q0MsUUFBUTtJQUNWO0lBQ0E7UUFDRU4sSUFBSTtRQUNKQyxNQUFNO1FBQ05DLFdBQVc7UUFDWEMsYUFBYTtZQUFFQyxLQUFL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