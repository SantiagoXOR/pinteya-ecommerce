{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\components\\ErrorBoundary.tsx"],"sourcesContent":["'use client'\r\n\r\nimport React, { Component, ErrorInfo, ReactNode } from 'react'\r\nimport { Button } from './ui/button'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from './ui/card'\r\nimport { Alert, AlertDescription } from './ui/alert'\r\nimport { proactiveMonitoring } from '../lib/monitoring/proactive-monitoring'\r\nimport { logger, LogLevel, LogCategory } from '@/lib/enterprise/logger'\r\nimport { AlertTriangle, RefreshCw, Home, Bug } from 'lucide-react'\r\n\r\ninterface Props {\r\n  children: ReactNode\r\n  fallback?: ReactNode\r\n  onError?: (error: Error, errorInfo: ErrorInfo) => void\r\n  showDetails?: boolean\r\n  enableReporting?: boolean\r\n}\r\n\r\ninterface State {\r\n  hasError: boolean\r\n  error: Error | null\r\n  errorInfo: ErrorInfo | null\r\n  errorId: string | null\r\n}\r\n\r\nexport class ErrorBoundary extends Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props)\r\n    this.state = {\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null,\r\n      errorId: null\r\n    }\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): Partial<State> {\r\n    // Actualizar el estado para mostrar la UI de error\r\n    return {\r\n      hasError: true,\r\n      error,\r\n      errorId: `error_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\r\n    }\r\n  }\r\n\r\n  async componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    // Actualizar estado con información del error\r\n    this.setState({ errorInfo })\r\n\r\n    // Llamar callback personalizado si existe\r\n    if (this.props.onError) {\r\n      this.props.onError(error, errorInfo)\r\n    }\r\n\r\n    // Reportar error al sistema de monitoreo si está habilitado\r\n    if (this.props.enableReporting !== false) {\r\n      try {\r\n        await proactiveMonitoring.reportError(error, {\r\n          errorBoundary: true,\r\n          componentStack: errorInfo.componentStack,\r\n          errorInfo: {\r\n            componentStack: errorInfo.componentStack,\r\n            errorBoundary: true\r\n          },\r\n          timestamp: new Date().toISOString(),\r\n          userAgent: typeof window !== 'undefined' ? window.navigator.userAgent : 'unknown',\r\n          url: typeof window !== 'undefined' ? window.location.href : 'unknown',\r\n          errorId: this.state.errorId\r\n        })\r\n      } catch (reportingError) {\r\n        logger.error(LogLevel.ERROR, 'Failed to report error to monitoring system', {\r\n          originalError: error.message,\r\n          reportingError: reportingError instanceof Error ? reportingError.message : 'Unknown error'\r\n        }, LogCategory.SYSTEM)\r\n      }\r\n    }\r\n\r\n    // Log del error\r\n    logger.error(LogLevel.ERROR, 'React Error Boundary caught an error', {\r\n      error: error.message,\r\n      stack: error.stack,\r\n      componentStack: errorInfo.componentStack,\r\n      errorId: this.state.errorId\r\n    }, LogCategory.UI)\r\n  }\r\n\r\n  handleRetry = () => {\r\n    this.setState({\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null,\r\n      errorId: null\r\n    })\r\n  }\r\n\r\n  handleReload = () => {\r\n    if (typeof window !== 'undefined') {\r\n      window.location.reload()\r\n    }\r\n  }\r\n\r\n  handleGoHome = () => {\r\n    if (typeof window !== 'undefined') {\r\n      window.location.href = '/'\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // Usar fallback personalizado si se proporciona\r\n      if (this.props.fallback) {\r\n        return this.props.fallback\r\n      }\r\n\r\n      // UI de error por defecto\r\n      return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50 px-4\">\r\n          <Card className=\"w-full max-w-2xl\">\r\n            <CardHeader className=\"text-center\">\r\n              <div className=\"mx-auto mb-4 h-12 w-12 text-red-500\">\r\n                <AlertTriangle className=\"h-full w-full\" />\r\n              </div>\r\n              <CardTitle className=\"text-2xl font-bold text-red-600\">\r\n                ¡Oops! Algo salió mal\r\n              </CardTitle>\r\n              <CardDescription className=\"text-lg\">\r\n                Se ha producido un error inesperado en la aplicación\r\n              </CardDescription>\r\n            </CardHeader>\r\n            \r\n            <CardContent className=\"space-y-6\">\r\n              {/* Error ID para soporte */}\r\n              {this.state.errorId && (\r\n                <Alert>\r\n                  <Bug className=\"h-4 w-4\" />\r\n                  <AlertDescription>\r\n                    <strong>ID del Error:</strong> {this.state.errorId}\r\n                    <br />\r\n                    <span className=\"text-sm text-muted-foreground\">\r\n                      Proporciona este ID al equipo de soporte para una asistencia más rápida\r\n                    </span>\r\n                  </AlertDescription>\r\n                </Alert>\r\n              )}\r\n\r\n              {/* Detalles del error (solo en desarrollo o si se habilita explícitamente) */}\r\n              {this.props.showDetails && this.state.error && (\r\n                <div className=\"space-y-4\">\r\n                  <Alert variant=\"destructive\">\r\n                    <AlertDescription>\r\n                      <strong>Error:</strong> {this.state.error.message}\r\n                    </AlertDescription>\r\n                  </Alert>\r\n                  \r\n                  {this.state.error.stack && (\r\n                    <details className=\"text-sm\">\r\n                      <summary className=\"cursor-pointer font-medium text-gray-700 hover:text-gray-900\">\r\n                        Ver detalles técnicos\r\n                      </summary>\r\n                      <pre className=\"mt-2 whitespace-pre-wrap bg-gray-100 p-3 rounded text-xs overflow-auto max-h-40\">\r\n                        {this.state.error.stack}\r\n                      </pre>\r\n                    </details>\r\n                  )}\r\n                  \r\n                  {this.state.errorInfo?.componentStack && (\r\n                    <details className=\"text-sm\">\r\n                      <summary className=\"cursor-pointer font-medium text-gray-700 hover:text-gray-900\">\r\n                        Ver stack de componentes\r\n                      </summary>\r\n                      <pre className=\"mt-2 whitespace-pre-wrap bg-gray-100 p-3 rounded text-xs overflow-auto max-h-40\">\r\n                        {this.state.errorInfo.componentStack}\r\n                      </pre>\r\n                    </details>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Acciones */}\r\n              <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\r\n                <Button onClick={this.handleRetry} className=\"flex items-center\">\r\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                  Intentar de nuevo\r\n                </Button>\r\n                \r\n                <Button variant=\"outline\" onClick={this.handleReload} className=\"flex items-center\">\r\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                  Recargar página\r\n                </Button>\r\n                \r\n                <Button variant=\"outline\" onClick={this.handleGoHome} className=\"flex items-center\">\r\n                  <Home className=\"h-4 w-4 mr-2\" />\r\n                  Ir al inicio\r\n                </Button>\r\n              </div>\r\n\r\n              {/* Información adicional */}\r\n              <div className=\"text-center text-sm text-muted-foreground\">\r\n                <p>\r\n                  Si el problema persiste, por favor contacta al equipo de soporte.\r\n                </p>\r\n                {this.props.enableReporting !== false && (\r\n                  <p className=\"mt-1\">\r\n                    Este error ha sido reportado automáticamente para su revisión.\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return this.props.children\r\n  }\r\n}\r\n\r\n/**\r\n * Hook para usar Error Boundary de forma funcional\r\n */\r\nexport function useErrorHandler() {\r\n  const reportError = React.useCallback(async (error: Error, context?: Record<string, any>) => {\r\n    try {\r\n      await proactiveMonitoring.reportError(error, {\r\n        ...context,\r\n        source: 'useErrorHandler',\r\n        timestamp: new Date().toISOString(),\r\n        url: typeof window !== 'undefined' ? window.location.href : 'unknown'\r\n      })\r\n    } catch (reportingError) {\r\n      logger.error(LogLevel.ERROR, 'Failed to report error via useErrorHandler', {\r\n        originalError: error.message,\r\n        reportingError: reportingError instanceof Error ? reportingError.message : 'Unknown error'\r\n      }, LogCategory.SYSTEM)\r\n    }\r\n  }, [])\r\n\r\n  return { reportError }\r\n}\r\n\r\n/**\r\n * Componente wrapper para facilitar el uso de Error Boundary\r\n */\r\ninterface ErrorBoundaryWrapperProps {\r\n  children: ReactNode\r\n  fallback?: ReactNode\r\n  showDetails?: boolean\r\n  enableReporting?: boolean\r\n}\r\n\r\nexport function ErrorBoundaryWrapper({ \r\n  children, \r\n  fallback, \r\n  showDetails = process.env.NODE_ENV === 'development',\r\n  enableReporting = true \r\n}: ErrorBoundaryWrapperProps) {\r\n  return (\r\n    <ErrorBoundary \r\n      fallback={fallback}\r\n      showDetails={showDetails}\r\n      enableReporting={enableReporting}\r\n    >\r\n      {children}\r\n    </ErrorBoundary>\r\n  )\r\n}\r\n\r\n/**\r\n * Error Boundary específico para páginas\r\n */\r\nexport function PageErrorBoundary({ children }: { children: ReactNode }) {\r\n  return (\r\n    <ErrorBoundary\r\n      showDetails={process.env.NODE_ENV === 'development'}\r\n      enableReporting={true}\r\n      fallback={\r\n        <div className=\"min-h-screen flex items-center justify-center\">\r\n          <Card className=\"w-full max-w-md\">\r\n            <CardHeader className=\"text-center\">\r\n              <AlertTriangle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\r\n              <CardTitle>Error en la página</CardTitle>\r\n              <CardDescription>\r\n                No se pudo cargar esta página correctamente\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"text-center\">\r\n              <Button onClick={() => window.location.reload()} className=\"mr-2\">\r\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                Recargar\r\n              </Button>\r\n              <Button variant=\"outline\" onClick={() => window.location.href = '/'}>\r\n                <Home className=\"h-4 w-4 mr-2\" />\r\n                Inicio\r\n              </Button>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      }\r\n    >\r\n      {children}\r\n    </ErrorBoundary>\r\n  )\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["ErrorBoundary","ErrorBoundaryWrapper","PageErrorBoundary","useErrorHandler","Component","props","handleRetry","setState","hasError","error","errorInfo","errorId","handleReload","window","location","reload","handleGoHome","href","state","getDerivedStateFromError","Date","now","Math","random","toString","substr","componentDidCatch","onError","enableReporting","proactiveMonitoring","reportError","errorBoundary","componentStack","timestamp","toISOString","userAgent","navigator","url","reportingError","logger","LogLevel","ERROR","originalError","message","Error","LogCategory","SYSTEM","stack","UI","render","fallback","div","className","Card","CardHeader","AlertTriangle","CardTitle","CardDescription","CardContent","Alert","Bug","AlertDescription","strong","br","span","showDetails","variant","details","summary","pre","Button","onClick","RefreshCw","Home","p","children","React","useCallback","context","source","process","env","NODE_ENV"],"mappings":"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"}