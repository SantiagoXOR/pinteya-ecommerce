{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\hooks\\useSearch.ts"],"sourcesContent":["// ===================================\r\n// HOOK: useSearch - Sistema de b√∫squeda centralizado\r\n// ===================================\r\n\r\nimport React, { useState, useCallback, useRef } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useDebouncedCallback } from 'use-debounce';\r\nimport { searchProducts } from '@/lib/api/products';\r\nimport { ProductWithCategory } from '@/types/api';\r\nimport { useSearchErrorHandler } from './useSearchErrorHandler';\r\nimport { useSearchToast } from './useSearchToast';\r\n\r\n// ===================================\r\n// TIPOS\r\n// ===================================\r\n\r\nexport interface SearchState {\r\n  query: string;\r\n  results: ProductWithCategory[];\r\n  suggestions: SearchSuggestion[];\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  hasSearched: boolean;\r\n}\r\n\r\nexport interface SearchSuggestion {\r\n  id: string;\r\n  type: 'product' | 'category' | 'recent' | 'trending';\r\n  title: string;\r\n  subtitle?: string;\r\n  image?: string;\r\n  badge?: string;\r\n  href: string;\r\n}\r\n\r\nexport interface UseSearchOptions {\r\n  /** Tiempo de debounce en milisegundos */\r\n  debounceMs?: number;\r\n  /** N√∫mero m√°ximo de sugerencias */\r\n  maxSuggestions?: number;\r\n  /** L√≠mite de resultados de b√∫squeda */\r\n  searchLimit?: number;\r\n  /** Guardar b√∫squedas recientes */\r\n  saveRecentSearches?: boolean;\r\n  /** Callback cuando se realiza una b√∫squeda */\r\n  onSearch?: (query: string, results: ProductWithCategory[]) => void;\r\n  /** Callback cuando se selecciona una sugerencia */\r\n  onSuggestionSelect?: (suggestion: SearchSuggestion) => void;\r\n}\r\n\r\n// ===================================\r\n// B√öSQUEDAS TRENDING POR DEFECTO\r\n// ===================================\r\n\r\nconst defaultTrendingSearches: SearchSuggestion[] = [\r\n  {\r\n    id: \"trending-1\",\r\n    type: \"trending\",\r\n    title: \"Pintura l√°tex\",\r\n    href: \"/search?q=pintura+latex\",\r\n  },\r\n  {\r\n    id: \"trending-2\",\r\n    type: \"trending\",\r\n    title: \"Sherwin Williams\",\r\n    href: \"/search?q=sherwin+williams\",\r\n  },\r\n  {\r\n    id: \"trending-3\",\r\n    type: \"trending\",\r\n    title: \"Rodillos premium\",\r\n    href: \"/search?q=rodillos+premium\",\r\n  },\r\n  {\r\n    id: \"trending-4\",\r\n    type: \"trending\",\r\n    title: \"Pinceles\",\r\n    href: \"/search?q=pinceles\",\r\n  },\r\n];\r\n\r\n// ===================================\r\n// HOOK PRINCIPAL\r\n// ===================================\r\n\r\nexport function useSearch(options: UseSearchOptions = {}) {\r\n  const {\r\n    debounceMs = 150,\r\n    maxSuggestions = 8,\r\n    searchLimit = 12,\r\n    saveRecentSearches = true,\r\n    onSearch,\r\n    onSuggestionSelect\r\n  } = options;\r\n\r\n  const router = useRouter();\r\n  const debounceRef = useRef<NodeJS.Timeout>();\r\n  const safetyTimeoutRef = useRef<NodeJS.Timeout>(); // Timeout de seguridad para evitar loading permanente\r\n  const optionsRef = useRef(options); // Ref para opciones estables\r\n  const recentSearchesRef = useRef<string[]>([]); // Ref para b√∫squedas recientes\r\n\r\n  // Hooks para manejo de errores y toast notifications\r\n  const errorHandler = useSearchErrorHandler({\r\n    onError: (error) => {\r\n      console.error('Error de b√∫squeda:', error);\r\n    },\r\n    onRetrySuccess: () => {\r\n      toastHandler.showRetrySuccessToast();\r\n    },\r\n    onRetryFailed: (error, attempts) => {\r\n      toastHandler.showRetryFailedToast(attempts);\r\n    },\r\n  });\r\n\r\n  const toastHandler = useSearchToast({\r\n    defaultDuration: 4000,\r\n    maxToasts: 2,\r\n  });\r\n\r\n  // Actualizar ref cuando cambien las opciones\r\n  optionsRef.current = options;\r\n\r\n  // Estado principal\r\n  const [state, setState] = useState<SearchState>({\r\n    query: '',\r\n    results: [],\r\n    suggestions: [],\r\n    isLoading: false,\r\n    error: null,\r\n    hasSearched: false,\r\n  });\r\n\r\n  const [recentSearches, setRecentSearches] = useState<string[]>([]);\r\n\r\n  // Sincronizar referencia con estado para evitar dependencias en useCallback\r\n  React.useEffect(() => {\r\n    recentSearchesRef.current = recentSearches;\r\n  }, [recentSearches]);\r\n\r\n  // ===================================\r\n  // FUNCIONES AUXILIARES SIMPLIFICADAS\r\n  // ===================================\r\n\r\n  // ===================================\r\n  // FUNCIONES PRINCIPALES CON USE-DEBOUNCE\r\n  // ===================================\r\n\r\n  /**\r\n   * Funci√≥n de b√∫squeda interna optimizada\r\n   */\r\n  const performSearch = useCallback(async (searchQuery: string) => {\r\n\r\n    // Limpiar timeout de seguridad anterior\r\n    if (safetyTimeoutRef.current) {\r\n      clearTimeout(safetyTimeoutRef.current);\r\n    }\r\n\r\n    // Si la query est√° vac√≠a, mostrar sugerencias por defecto\r\n    if (!searchQuery.trim()) {\r\n      const defaultSuggestions = [\r\n        ...defaultTrendingSearches.slice(0, 4),\r\n        ...recentSearchesRef.current.slice(0, 3).map((search, index) => ({\r\n          id: `recent-${index}`,\r\n          type: 'recent' as const,\r\n          title: search,\r\n          href: `/search?q=${encodeURIComponent(search)}`,\r\n        }))\r\n      ].slice(0, maxSuggestions);\r\n\r\n      setState(prev => ({\r\n        ...prev,\r\n        query: searchQuery,\r\n        suggestions: defaultSuggestions,\r\n        isLoading: false,\r\n      }));\r\n      return;\r\n    }\r\n\r\n    // Timeout de seguridad para evitar loading permanente (5 segundos)\r\n    safetyTimeoutRef.current = setTimeout(() => {\r\n      setState(prev => ({\r\n        ...prev,\r\n        isLoading: false,\r\n        error: 'Tiempo de espera agotado. Intenta nuevamente.',\r\n      }));\r\n    }, 5000);\r\n\r\n    // Ejecutar b√∫squeda directamente (el debounce se maneja en searchWithDebounce)\r\n    try {\r\n\r\n      const response = await searchProducts(searchQuery, maxSuggestions);\r\n\r\n      // Limpiar timeout de seguridad ya que la API respondi√≥\r\n      if (safetyTimeoutRef.current) {\r\n        clearTimeout(safetyTimeoutRef.current);\r\n      }\r\n\r\n        if (response.success && response.data && Array.isArray(response.data)) {\r\n          const productSuggestions = response.data.map(product => ({\r\n            id: `product-${product.id}`,\r\n            type: 'product' as const,\r\n            title: product.name,\r\n            subtitle: product.category?.name || 'Sin categor√≠a',\r\n            image: product.images?.previews?.[0] || '/images/products/placeholder.jpg',\r\n            badge: product.stock > 0 ? 'En stock' : 'Sin stock',\r\n            href: `/shop-details/${product.id}`,\r\n          }));\r\n\r\n\r\n          setState(prev => ({\r\n            ...prev,\r\n            query: searchQuery, // Actualizar query cuando hay resultados exitosos\r\n            suggestions: productSuggestions,\r\n            isLoading: false,\r\n            error: null,\r\n          }));\r\n        } else {\r\n          setState(prev => ({\r\n            ...prev,\r\n            query: searchQuery, // Actualizar query incluso cuando no hay resultados\r\n            suggestions: [],\r\n            isLoading: false,\r\n            error: response.error || 'No se encontraron resultados',\r\n          }));\r\n        }\r\n      } catch (error) {\r\n        console.error('‚ùå useSearch: Error en b√∫squeda:', error);\r\n\r\n        // Limpiar timeout de seguridad\r\n        if (safetyTimeoutRef.current) {\r\n          clearTimeout(safetyTimeoutRef.current);\r\n        }\r\n\r\n        setState(prev => ({\r\n          ...prev,\r\n          query: searchQuery, // Actualizar query incluso en caso de error\r\n          suggestions: [],\r\n          isLoading: false,\r\n          error: 'Error en la b√∫squeda. Intenta nuevamente.',\r\n        }));\r\n      }\r\n  }, [maxSuggestions]); // Solo maxSuggestions es necesario como dependencia\r\n\r\n  /**\r\n   * Funci√≥n de b√∫squeda con debounce optimizado usando use-debounce\r\n   */\r\n  const searchWithDebounce = useDebouncedCallback(\r\n    (searchQuery: string) => {\r\n      console.log('üîç useSearch: searchWithDebounce (use-debounce) llamado con:', searchQuery);\r\n\r\n      // Actualizar estado de loading inmediatamente\r\n      setState(prev => ({\r\n        ...prev,\r\n        isLoading: !!searchQuery.trim(),\r\n        error: null,\r\n      }));\r\n\r\n      // Ejecutar b√∫squeda\r\n      performSearch(searchQuery);\r\n    },\r\n    debounceMs,\r\n    {\r\n      maxWait: 2000,\r\n      leading: false,\r\n      trailing: true,\r\n    }\r\n  );\r\n\r\n  /**\r\n   * Ejecuta una b√∫squeda completa y navega a resultados\r\n   */\r\n  const executeSearch = useCallback(async (searchQuery: string, category?: string) => {\r\n    if (!searchQuery.trim()) {return;}\r\n\r\n    try {\r\n      setState(prev => ({ ...prev, isLoading: true, error: null }));\r\n\r\n      // Guardar en historial\r\n      if (saveRecentSearches && searchQuery.trim()) {\r\n        const updated = [\r\n          searchQuery.trim(),\r\n          ...recentSearchesRef.current.filter(s => s !== searchQuery.trim())\r\n        ].slice(0, 5);\r\n\r\n        setRecentSearches(updated);\r\n        try {\r\n          localStorage.setItem('pinteya-recent-searches', JSON.stringify(updated));\r\n        } catch (error) {\r\n          console.warn('Error guardando b√∫squeda reciente:', error);\r\n        }\r\n      }\r\n\r\n      // Realizar b√∫squeda con manejo robusto de errores\r\n      const response = await errorHandler.executeWithRetry(\r\n        () => searchProducts(searchQuery.trim(), searchLimit),\r\n        `b√∫squeda de \"${searchQuery.trim()}\"`\r\n      );\r\n\r\n      if (response.success && response.data) {\r\n        const resultCount = response.data.length;\r\n\r\n        setState(prev => ({\r\n          ...prev,\r\n          results: response.data || [],\r\n          isLoading: false,\r\n          hasSearched: true,\r\n          error: null,\r\n        }));\r\n\r\n        // Limpiar errores previos\r\n        errorHandler.clearError();\r\n\r\n        // Mostrar toast de √©xito si hay resultados\r\n        if (resultCount > 0) {\r\n          toastHandler.showSuccessToast(searchQuery.trim(), resultCount);\r\n        } else {\r\n          toastHandler.showNoResultsToast(searchQuery.trim());\r\n        }\r\n\r\n        // Callback personalizado\r\n        optionsRef.current.onSearch?.(searchQuery.trim(), response.data || []);\r\n\r\n        // Navegar a resultados\r\n        const searchParams = new URLSearchParams();\r\n        searchParams.set('q', searchQuery.trim());\r\n        if (category) {\r\n          searchParams.set('category', category);\r\n        }\r\n\r\n        router.push(`/search?${searchParams.toString()}`);\r\n      } else {\r\n        const errorMessage = response.error || 'No se encontraron resultados';\r\n\r\n        setState(prev => ({\r\n          ...prev,\r\n          results: [],\r\n          isLoading: false,\r\n          hasSearched: true,\r\n          error: errorMessage,\r\n        }));\r\n\r\n        // Mostrar toast de advertencia para respuestas sin √©xito\r\n        toastHandler.showWarningToast('B√∫squeda sin resultados', errorMessage);\r\n      }\r\n    } catch (error) {\r\n      console.error('‚ùå Error ejecutando b√∫squeda:', error);\r\n\r\n      // Manejar error con el error handler\r\n      const searchError = errorHandler.handleError(error);\r\n\r\n      setState(prev => ({\r\n        ...prev,\r\n        results: [],\r\n        isLoading: false,\r\n        hasSearched: true,\r\n        error: searchError.message,\r\n      }));\r\n\r\n      // Mostrar toast de error\r\n      toastHandler.showErrorToast(searchError, errorHandler.retryCount, () => {\r\n        executeSearch(searchQuery.trim(), category);\r\n      });\r\n    }\r\n  }, [searchLimit, saveRecentSearches, router, errorHandler, toastHandler]); // Remover recentSearches de dependencias para evitar bucle infinito\r\n\r\n  /**\r\n   * Maneja la selecci√≥n de una sugerencia\r\n   */\r\n  const selectSuggestion = useCallback((suggestion: SearchSuggestion) => {\r\n    // Guardar en historial si es producto o categor√≠a\r\n    if ((suggestion.type === 'product' || suggestion.type === 'category') && saveRecentSearches) {\r\n      const updated = [\r\n        suggestion.title,\r\n        ...recentSearchesRef.current.filter(s => s !== suggestion.title)\r\n      ].slice(0, 5);\r\n\r\n      setRecentSearches(updated);\r\n      try {\r\n        localStorage.setItem('pinteya-recent-searches', JSON.stringify(updated));\r\n      } catch (error) {\r\n        console.warn('Error guardando b√∫squeda reciente:', error);\r\n      }\r\n    }\r\n\r\n    // Actualizar estado\r\n    setState(prev => ({\r\n      ...prev,\r\n      query: suggestion.title,\r\n    }));\r\n\r\n    // Callback personalizado\r\n    optionsRef.current.onSuggestionSelect?.(suggestion);\r\n\r\n    // Navegar\r\n    router.push(suggestion.href);\r\n  }, [saveRecentSearches, router]); // Remover recentSearches de dependencias para evitar bucle infinito\r\n\r\n  /**\r\n   * Limpia el estado de b√∫squeda\r\n   */\r\n  const clearSearch = useCallback(() => {\r\n\r\n    // Limpiar todos los timeouts\r\n    if (debounceRef.current) {\r\n      clearTimeout(debounceRef.current);\r\n    }\r\n    if (safetyTimeoutRef.current) {\r\n      clearTimeout(safetyTimeoutRef.current);\r\n    }\r\n\r\n    // Resetear estado completamente (sin sugerencias por defecto para tests)\r\n    setState({\r\n      query: '',\r\n      results: [],\r\n      suggestions: [],\r\n      isLoading: false,\r\n      error: null,\r\n      hasSearched: false,\r\n    });\r\n  }, []); // Remover dependencia circular\r\n\r\n  /**\r\n   * Inicializa el hook (cargar b√∫squedas recientes)\r\n   */\r\n  const initialize = useCallback(() => {\r\n    if (saveRecentSearches) {\r\n      try {\r\n        const stored = localStorage.getItem('pinteya-recent-searches');\r\n        if (stored && stored.trim() !== '' && stored !== '\"\"' && stored !== \"''\") {\r\n          // Validar que no est√© corrupto\r\n          if (stored.includes('\"\"') && stored.length < 5) {\r\n            console.warn('Detected corrupted recent searches data, cleaning up');\r\n            localStorage.removeItem('pinteya-recent-searches');\r\n            return;\r\n          }\r\n\r\n          const parsed = JSON.parse(stored);\r\n          // Verificar que sea un array v√°lido\r\n          if (Array.isArray(parsed)) {\r\n            setRecentSearches(parsed);\r\n          } else {\r\n            console.warn('Invalid recent searches format, resetting');\r\n            localStorage.removeItem('pinteya-recent-searches');\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('Error cargando b√∫squedas recientes:', error);\r\n        // Limpiar datos corruptos\r\n        localStorage.removeItem('pinteya-recent-searches');\r\n      }\r\n    }\r\n  }, [saveRecentSearches]);\r\n\r\n  // ===================================\r\n  // CLEANUP\r\n  // ===================================\r\n\r\n  const cleanup = useCallback(() => {\r\n    // Cancelar debounce de use-debounce\r\n    searchWithDebounce.cancel();\r\n\r\n    // Limpiar timeouts manuales restantes\r\n    if (debounceRef.current) {\r\n      clearTimeout(debounceRef.current);\r\n    }\r\n    if (safetyTimeoutRef.current) {\r\n      clearTimeout(safetyTimeoutRef.current);\r\n    }\r\n  }, [searchWithDebounce]);\r\n\r\n  // ===================================\r\n  // RETURN\r\n  // ===================================\r\n\r\n  return {\r\n    // Estado\r\n    ...state,\r\n    recentSearches,\r\n\r\n    // Estado de errores y toasts\r\n    searchError: errorHandler.currentError,\r\n    isRetrying: errorHandler.isRetrying,\r\n    retryCount: errorHandler.retryCount,\r\n    toasts: toastHandler.toasts,\r\n\r\n    // Funciones principales\r\n    searchWithDebounce,\r\n    executeSearch,\r\n    selectSuggestion,\r\n    clearSearch,\r\n    initialize,\r\n    cleanup,\r\n\r\n    // Funciones de manejo de errores\r\n    clearError: errorHandler.clearError,\r\n    retryManually: errorHandler.retryManually,\r\n\r\n    // Funciones de toast\r\n    removeToast: toastHandler.removeToast,\r\n    clearToasts: toastHandler.clearToasts,\r\n  };\r\n}\r\n\r\nexport default useSearch;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["useSearch","defaultTrendingSearches","id","type","title","href","options","debounceMs","maxSuggestions","searchLimit","saveRecentSearches","onSearch","onSuggestionSelect","router","useRouter","debounceRef","useRef","safetyTimeoutRef","optionsRef","recentSearchesRef","errorHandler","useSearchErrorHandler","onError","error","console","onRetrySuccess","toastHandler","showRetrySuccessToast","onRetryFailed","attempts","showRetryFailedToast","useSearchToast","defaultDuration","maxToasts","current","state","setState","useState","query","results","suggestions","isLoading","hasSearched","recentSearches","setRecentSearches","React","useEffect","performSearch","useCallback","searchQuery","clearTimeout","trim","defaultSuggestions","slice","map","search","index","encodeURIComponent","prev","setTimeout","response","searchProducts","success","data","Array","isArray","productSuggestions","product","name","subtitle","category","image","images","previews","badge","stock","searchWithDebounce","useDebouncedCallback","log","maxWait","leading","trailing","executeSearch","updated","filter","s","localStorage","setItem","JSON","stringify","warn","executeWithRetry","resultCount","length","clearError","showSuccessToast","showNoResultsToast","searchParams","URLSearchParams","set","push","toString","errorMessage","showWarningToast","searchError","handleError","message","showErrorToast","retryCount","selectSuggestion","suggestion","clearSearch","initialize","stored","getItem","includes","removeItem","parsed","parse","cleanup","cancel","currentError","isRetrying","toasts","retryManually","removeToast","clearToasts"],"mappings":"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"}