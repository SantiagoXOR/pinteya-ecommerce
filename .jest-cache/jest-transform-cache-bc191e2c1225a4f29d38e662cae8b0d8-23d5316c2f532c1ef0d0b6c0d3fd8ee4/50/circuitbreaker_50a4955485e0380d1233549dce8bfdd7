7a56c9a06709ff2e2cfac4f794891e6c
// ===================================
// PINTEYA E-COMMERCE - CIRCUIT BREAKER PATTERN ENTERPRISE
// ===================================
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get CIRCUIT_BREAKER_CONFIGS () {
        return CIRCUIT_BREAKER_CONFIGS;
    },
    get CircuitBreaker () {
        return CircuitBreaker;
    },
    get CircuitBreakerState () {
        return CircuitBreakerState;
    },
    get executeMercadoPagoCritical () {
        return executeMercadoPagoCritical;
    },
    get executeMercadoPagoStandard () {
        return executeMercadoPagoStandard;
    },
    get executeWebhookProcessing () {
        return executeWebhookProcessing;
    },
    get mercadoPagoCriticalBreaker () {
        return mercadoPagoCriticalBreaker;
    },
    get mercadoPagoStandardBreaker () {
        return mercadoPagoStandardBreaker;
    },
    get webhookProcessingBreaker () {
        return webhookProcessingBreaker;
    }
});
const _logger = require("../../enterprise/logger");
const _metrics = require("../../enterprise/metrics");
var CircuitBreakerState = /*#__PURE__*/ function(CircuitBreakerState) {
    CircuitBreakerState["CLOSED"] = "CLOSED";
    CircuitBreakerState["OPEN"] = "OPEN";
    CircuitBreakerState["HALF_OPEN"] = "HALF_OPEN"; // Probando si el servicio se recuperó
    return CircuitBreakerState;
}({});
const CIRCUIT_BREAKER_CONFIGS = {
    MERCADOPAGO_CRITICAL: {
        failureThreshold: 5,
        recoveryTimeout: 60000,
        monitoringWindow: 120000,
        halfOpenMaxCalls: 3,
        successThreshold: 2
    },
    MERCADOPAGO_STANDARD: {
        failureThreshold: 3,
        recoveryTimeout: 30000,
        monitoringWindow: 60000,
        halfOpenMaxCalls: 2,
        successThreshold: 1
    },
    WEBHOOK_PROCESSING: {
        failureThreshold: 10,
        recoveryTimeout: 15000,
        monitoringWindow: 30000,
        halfOpenMaxCalls: 5,
        successThreshold: 3
    }
};
class CircuitBreaker {
    constructor(name, config){
        this.name = name;
        this.config = config;
        this.state = "CLOSED";
        this.failures = 0;
        this.successes = 0;
        this.lastFailureTime = 0;
        this.lastSuccessTime = 0;
        this.halfOpenCalls = 0;
        this.stateChanges = 0;
        this.metrics = {
            totalCalls: 0,
            successfulCalls: 0,
            failedCalls: 0,
            rejectedCalls: 0,
            lastFailureTime: 0,
            lastSuccessTime: 0,
            stateChanges: 0
        };
        _logger.logger.debug(_logger.LogLevel.DEBUG, `Circuit Breaker initialized: ${name}`, {
            config: this.config
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Ejecuta una operación protegida por el circuit breaker
   */ async execute(operation) {
        const startTime = Date.now();
        this.metrics.totalCalls++;
        // Verificar si debemos rechazar la llamada
        if (this.shouldReject()) {
            this.metrics.rejectedCalls++;
            await this.recordMetrics('rejected');
            return {
                success: false,
                error: new Error(`Circuit breaker is ${this.state} - operation rejected`),
                state: this.state,
                executionTime: Date.now() - startTime,
                wasRejected: true
            };
        }
        try {
            // Ejecutar la operación
            const result = await operation();
            // Registrar éxito
            await this.onSuccess();
            const executionTime = Date.now() - startTime;
            await this.recordMetrics('success', executionTime);
            return {
                success: true,
                data: result,
                state: this.state,
                executionTime,
                wasRejected: false
            };
        } catch (error) {
            // Registrar fallo
            await this.onFailure(error);
            const executionTime = Date.now() - startTime;
            await this.recordMetrics('failure', executionTime);
            return {
                success: false,
                error: error,
                state: this.state,
                executionTime,
                wasRejected: false
            };
        }
    }
    /**
   * Determina si debemos rechazar la operación
   */ shouldReject() {
        const now = Date.now();
        switch(this.state){
            case "CLOSED":
                return false;
            case "OPEN":
                // Verificar si es tiempo de intentar recuperación
                if (now - this.lastFailureTime >= this.config.recoveryTimeout) {
                    this.transitionToHalfOpen();
                    return false;
                }
                return true;
            case "HALF_OPEN":
                // Limitar llamadas en estado HALF_OPEN
                return this.halfOpenCalls >= this.config.halfOpenMaxCalls;
            default:
                return false;
        }
    }
    /**
   * Maneja un éxito en la operación
   */ async onSuccess() {
        this.lastSuccessTime = Date.now();
        this.metrics.successfulCalls++;
        switch(this.state){
            case "HALF_OPEN":
                this.successes++;
                this.halfOpenCalls++;
                if (this.successes >= this.config.successThreshold) {
                    this.transitionToClosed();
                }
                break;
            case "CLOSED":
                // Reset failure counter en ventana de monitoreo
                if (this.isInMonitoringWindow()) {
                    this.failures = 0;
                }
                break;
        }
    }
    /**
   * Maneja un fallo en la operación
   */ async onFailure(error) {
        this.lastFailureTime = Date.now();
        this.metrics.failedCalls++;
        this.failures++;
        _logger.logger.warn(_logger.LogLevel.WARN, `Circuit Breaker failure: ${this.name}`, {
            error: error.message,
            failures: this.failures,
            state: this.state
        }, _logger.LogCategory.SYSTEM);
        switch(this.state){
            case "CLOSED":
                if (this.failures >= this.config.failureThreshold) {
                    this.transitionToOpen();
                }
                break;
            case "HALF_OPEN":
                this.transitionToOpen();
                break;
        }
    }
    /**
   * Transición a estado OPEN
   */ transitionToOpen() {
        this.state = "OPEN";
        this.stateChanges++;
        this.metrics.stateChanges++;
        this.halfOpenCalls = 0;
        this.successes = 0;
        _logger.logger.warn(_logger.LogLevel.WARN, `Circuit Breaker OPENED: ${this.name}`, {
            failures: this.failures,
            threshold: this.config.failureThreshold
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Transición a estado HALF_OPEN
   */ transitionToHalfOpen() {
        this.state = "HALF_OPEN";
        this.stateChanges++;
        this.metrics.stateChanges++;
        this.halfOpenCalls = 0;
        this.successes = 0;
        _logger.logger.info(_logger.LogLevel.INFO, `Circuit Breaker HALF-OPEN: ${this.name}`, {
            recoveryTimeout: this.config.recoveryTimeout
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Transición a estado CLOSED
   */ transitionToClosed() {
        this.state = "CLOSED";
        this.stateChanges++;
        this.metrics.stateChanges++;
        this.failures = 0;
        this.successes = 0;
        this.halfOpenCalls = 0;
        _logger.logger.info(_logger.LogLevel.INFO, `Circuit Breaker CLOSED: ${this.name}`, {
            successThreshold: this.config.successThreshold
        }, _logger.LogCategory.SYSTEM);
    }
    /**
   * Verifica si estamos en la ventana de monitoreo
   */ isInMonitoringWindow() {
        const now = Date.now();
        return now - this.lastFailureTime <= this.config.monitoringWindow;
    }
    /**
   * Registra métricas del circuit breaker
   */ async recordMetrics(operation, executionTime) {
        try {
            await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.${operation}`, 1, {
                state: this.state,
                operation
            });
            if (executionTime) {
                await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.execution_time`, executionTime, {
                    state: this.state
                });
            }
            // Métricas de estado
            await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.state_changes`, this.stateChanges);
            await _metrics.metricsCollector.recordMetric(`circuit_breaker.${this.name}.failure_rate`, this.metrics.totalCalls > 0 ? this.metrics.failedCalls / this.metrics.totalCalls : 0);
        } catch (error) {
            _logger.logger.error(_logger.LogLevel.ERROR, `Failed to record circuit breaker metrics: ${this.name}`, {
                error: error instanceof Error ? error.message : 'Unknown error'
            }, _logger.LogCategory.SYSTEM);
        }
    }
    /**
   * Obtiene el estado actual del circuit breaker
   */ getState() {
        return this.state;
    }
    /**
   * Obtiene las métricas del circuit breaker
   */ getMetrics() {
        return {
            ...this.metrics,
            state: this.state,
            config: this.config
        };
    }
    /**
   * Fuerza el reset del circuit breaker (solo para testing/admin)
   */ reset() {
        this.state = "CLOSED";
        this.failures = 0;
        this.successes = 0;
        this.halfOpenCalls = 0;
        this.lastFailureTime = 0;
        this.lastSuccessTime = 0;
        _logger.logger.info(_logger.LogLevel.INFO, `Circuit Breaker manually reset: ${this.name}`, {}, _logger.LogCategory.SYSTEM);
    }
}
const mercadoPagoCriticalBreaker = new CircuitBreaker('mercadopago_critical', CIRCUIT_BREAKER_CONFIGS.MERCADOPAGO_CRITICAL);
const mercadoPagoStandardBreaker = new CircuitBreaker('mercadopago_standard', CIRCUIT_BREAKER_CONFIGS.MERCADOPAGO_STANDARD);
const webhookProcessingBreaker = new CircuitBreaker('webhook_processing', CIRCUIT_BREAKER_CONFIGS.WEBHOOK_PROCESSING);
async function executeMercadoPagoCritical(operation) {
    return mercadoPagoCriticalBreaker.execute(operation);
}
async function executeMercadoPagoStandard(operation) {
    return mercadoPagoStandardBreaker.execute(operation);
}
async function executeWebhookProcessing(operation) {
    return webhookProcessingBreaker.execute(operation);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFydGlcXERlc2t0b3BcXERFU0FSUk9MTE9TV1xcQk9JTEVSUExBVFRFIEUtQ09NTUVSQ0VcXHNyY1xcbGliXFxpbnRlZ3JhdGlvbnNcXG1lcmNhZG9wYWdvXFxjaXJjdWl0LWJyZWFrZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gUElOVEVZQSBFLUNPTU1FUkNFIC0gQ0lSQ1VJVCBCUkVBS0VSIFBBVFRFUk4gRU5URVJQUklTRVxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuaW1wb3J0IHsgbG9nZ2VyLCBMb2dMZXZlbCwgTG9nQ2F0ZWdvcnkgfSBmcm9tICdAL2xpYi9lbnRlcnByaXNlL2xvZ2dlcic7XHJcbmltcG9ydCB7IG1ldHJpY3NDb2xsZWN0b3IgfSBmcm9tICdAL2xpYi9lbnRlcnByaXNlL21ldHJpY3MnO1xyXG5cclxuLy8gRXN0YWRvcyBkZWwgQ2lyY3VpdCBCcmVha2VyXHJcbmV4cG9ydCBlbnVtIENpcmN1aXRCcmVha2VyU3RhdGUge1xyXG4gIENMT1NFRCA9ICdDTE9TRUQnLCAgICAgLy8gRnVuY2lvbmFtaWVudG8gbm9ybWFsXHJcbiAgT1BFTiA9ICdPUEVOJywgICAgICAgICAvLyBDaXJjdWl0byBhYmllcnRvLCByZWNoYXphIHJlcXVlc3RzXHJcbiAgSEFMRl9PUEVOID0gJ0hBTEZfT1BFTicgLy8gUHJvYmFuZG8gc2kgZWwgc2VydmljaW8gc2UgcmVjdXBlcsOzXHJcbn1cclxuXHJcbi8vIENvbmZpZ3VyYWNpw7NuIGRlbCBDaXJjdWl0IEJyZWFrZXJcclxuZXhwb3J0IGludGVyZmFjZSBDaXJjdWl0QnJlYWtlckNvbmZpZyB7XHJcbiAgZmFpbHVyZVRocmVzaG9sZDogbnVtYmVyOyAgICAgIC8vIE7Dum1lcm8gZGUgZmFsbG9zIHBhcmEgYWJyaXIgZWwgY2lyY3VpdG9cclxuICByZWNvdmVyeVRpbWVvdXQ6IG51bWJlcjsgICAgICAgLy8gVGllbXBvIGFudGVzIGRlIGludGVudGFyIHJlY3VwZXJhY2nDs24gKG1zKVxyXG4gIG1vbml0b3JpbmdXaW5kb3c6IG51bWJlcjsgICAgICAvLyBWZW50YW5hIGRlIG1vbml0b3JlbyBwYXJhIGNvbnRhciBmYWxsb3MgKG1zKVxyXG4gIGhhbGZPcGVuTWF4Q2FsbHM6IG51bWJlcjsgICAgICAvLyBNw6F4aW1vIGRlIGxsYW1hZGFzIGVuIGVzdGFkbyBIQUxGX09QRU5cclxuICBzdWNjZXNzVGhyZXNob2xkOiBudW1iZXI7ICAgICAgLy8gw4l4aXRvcyBuZWNlc2FyaW9zIHBhcmEgY2VycmFyIGVsIGNpcmN1aXRvXHJcbn1cclxuXHJcbi8vIENvbmZpZ3VyYWNpb25lcyBwcmVkZWZpbmlkYXNcclxuZXhwb3J0IGNvbnN0IENJUkNVSVRfQlJFQUtFUl9DT05GSUdTID0ge1xyXG4gIE1FUkNBRE9QQUdPX0NSSVRJQ0FMOiB7XHJcbiAgICBmYWlsdXJlVGhyZXNob2xkOiA1LFxyXG4gICAgcmVjb3ZlcnlUaW1lb3V0OiA2MDAwMCwgICAgICAvLyAxIG1pbnV0b1xyXG4gICAgbW9uaXRvcmluZ1dpbmRvdzogMTIwMDAwLCAgICAvLyAyIG1pbnV0b3NcclxuICAgIGhhbGZPcGVuTWF4Q2FsbHM6IDMsXHJcbiAgICBzdWNjZXNzVGhyZXNob2xkOiAyXHJcbiAgfSxcclxuICBNRVJDQURPUEFHT19TVEFOREFSRDoge1xyXG4gICAgZmFpbHVyZVRocmVzaG9sZDogMyxcclxuICAgIHJlY292ZXJ5VGltZW91dDogMzAwMDAsICAgICAgLy8gMzAgc2VndW5kb3NcclxuICAgIG1vbml0b3JpbmdXaW5kb3c6IDYwMDAwLCAgICAgLy8gMSBtaW51dG9cclxuICAgIGhhbGZPcGVuTWF4Q2FsbHM6IDIsXHJcbiAgICBzdWNjZXNzVGhyZXNob2xkOiAxXHJcbiAgfSxcclxuICBXRUJIT09LX1BST0NFU1NJTkc6IHtcclxuICAgIGZhaWx1cmVUaHJlc2hvbGQ6IDEwLFxyXG4gICAgcmVjb3ZlcnlUaW1lb3V0OiAxNTAwMCwgICAgICAvLyAxNSBzZWd1bmRvc1xyXG4gICAgbW9uaXRvcmluZ1dpbmRvdzogMzAwMDAsICAgICAvLyAzMCBzZWd1bmRvc1xyXG4gICAgaGFsZk9wZW5NYXhDYWxsczogNSxcclxuICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6IDNcclxuICB9XHJcbn0gYXMgY29uc3Q7XHJcblxyXG4vLyBNw6l0cmljYXMgZGVsIENpcmN1aXQgQnJlYWtlclxyXG5pbnRlcmZhY2UgQ2lyY3VpdEJyZWFrZXJNZXRyaWNzIHtcclxuICB0b3RhbENhbGxzOiBudW1iZXI7XHJcbiAgc3VjY2Vzc2Z1bENhbGxzOiBudW1iZXI7XHJcbiAgZmFpbGVkQ2FsbHM6IG51bWJlcjtcclxuICByZWplY3RlZENhbGxzOiBudW1iZXI7XHJcbiAgbGFzdEZhaWx1cmVUaW1lOiBudW1iZXI7XHJcbiAgbGFzdFN1Y2Nlc3NUaW1lOiBudW1iZXI7XHJcbiAgc3RhdGVDaGFuZ2VzOiBudW1iZXI7XHJcbn1cclxuXHJcbi8vIFJlc3VsdGFkbyBkZSBlamVjdWNpw7NuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ2lyY3VpdEJyZWFrZXJSZXN1bHQ8VD4ge1xyXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XHJcbiAgZGF0YT86IFQ7XHJcbiAgZXJyb3I/OiBFcnJvcjtcclxuICBzdGF0ZTogQ2lyY3VpdEJyZWFrZXJTdGF0ZTtcclxuICBleGVjdXRpb25UaW1lOiBudW1iZXI7XHJcbiAgd2FzUmVqZWN0ZWQ6IGJvb2xlYW47XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDaXJjdWl0IEJyZWFrZXIgRW50ZXJwcmlzZSBwYXJhIE1lcmNhZG9QYWdvXHJcbiAqIEltcGxlbWVudGEgZWwgcGF0csOzbiBDaXJjdWl0IEJyZWFrZXIgY29uIGVzdGFkb3MgeSByZWN1cGVyYWNpw7NuIGF1dG9tw6F0aWNhXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQ2lyY3VpdEJyZWFrZXIge1xyXG4gIHByaXZhdGUgc3RhdGU6IENpcmN1aXRCcmVha2VyU3RhdGUgPSBDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRDtcclxuICBwcml2YXRlIGZhaWx1cmVzOiBudW1iZXIgPSAwO1xyXG4gIHByaXZhdGUgc3VjY2Vzc2VzOiBudW1iZXIgPSAwO1xyXG4gIHByaXZhdGUgbGFzdEZhaWx1cmVUaW1lOiBudW1iZXIgPSAwO1xyXG4gIHByaXZhdGUgbGFzdFN1Y2Nlc3NUaW1lOiBudW1iZXIgPSAwO1xyXG4gIHByaXZhdGUgaGFsZk9wZW5DYWxsczogbnVtYmVyID0gMDtcclxuICBwcml2YXRlIHN0YXRlQ2hhbmdlczogbnVtYmVyID0gMDtcclxuICBwcml2YXRlIG1ldHJpY3M6IENpcmN1aXRCcmVha2VyTWV0cmljcztcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIG5hbWU6IHN0cmluZyxcclxuICAgIHByaXZhdGUgY29uZmlnOiBDaXJjdWl0QnJlYWtlckNvbmZpZ1xyXG4gICkge1xyXG4gICAgdGhpcy5tZXRyaWNzID0ge1xyXG4gICAgICB0b3RhbENhbGxzOiAwLFxyXG4gICAgICBzdWNjZXNzZnVsQ2FsbHM6IDAsXHJcbiAgICAgIGZhaWxlZENhbGxzOiAwLFxyXG4gICAgICByZWplY3RlZENhbGxzOiAwLFxyXG4gICAgICBsYXN0RmFpbHVyZVRpbWU6IDAsXHJcbiAgICAgIGxhc3RTdWNjZXNzVGltZTogMCxcclxuICAgICAgc3RhdGVDaGFuZ2VzOiAwXHJcbiAgICB9O1xyXG5cclxuICAgIGxvZ2dlci5kZWJ1ZyhMb2dMZXZlbC5ERUJVRywgYENpcmN1aXQgQnJlYWtlciBpbml0aWFsaXplZDogJHtuYW1lfWAsIHtcclxuICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZ1xyXG4gICAgfSwgTG9nQ2F0ZWdvcnkuU1lTVEVNKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEVqZWN1dGEgdW5hIG9wZXJhY2nDs24gcHJvdGVnaWRhIHBvciBlbCBjaXJjdWl0IGJyZWFrZXJcclxuICAgKi9cclxuICBhc3luYyBleGVjdXRlPFQ+KG9wZXJhdGlvbjogKCkgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8Q2lyY3VpdEJyZWFrZXJSZXN1bHQ8VD4+IHtcclxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgICB0aGlzLm1ldHJpY3MudG90YWxDYWxscysrO1xyXG5cclxuICAgIC8vIFZlcmlmaWNhciBzaSBkZWJlbW9zIHJlY2hhemFyIGxhIGxsYW1hZGFcclxuICAgIGlmICh0aGlzLnNob3VsZFJlamVjdCgpKSB7XHJcbiAgICAgIHRoaXMubWV0cmljcy5yZWplY3RlZENhbGxzKys7XHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCB0aGlzLnJlY29yZE1ldHJpY3MoJ3JlamVjdGVkJyk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBuZXcgRXJyb3IoYENpcmN1aXQgYnJlYWtlciBpcyAke3RoaXMuc3RhdGV9IC0gb3BlcmF0aW9uIHJlamVjdGVkYCksXHJcbiAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXHJcbiAgICAgICAgZXhlY3V0aW9uVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcclxuICAgICAgICB3YXNSZWplY3RlZDogdHJ1ZVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEVqZWN1dGFyIGxhIG9wZXJhY2nDs25cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgb3BlcmF0aW9uKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZWdpc3RyYXIgw6l4aXRvXHJcbiAgICAgIGF3YWl0IHRoaXMub25TdWNjZXNzKCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBleGVjdXRpb25UaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcclxuICAgICAgYXdhaXQgdGhpcy5yZWNvcmRNZXRyaWNzKCdzdWNjZXNzJywgZXhlY3V0aW9uVGltZSk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgZGF0YTogcmVzdWx0LFxyXG4gICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxyXG4gICAgICAgIGV4ZWN1dGlvblRpbWUsXHJcbiAgICAgICAgd2FzUmVqZWN0ZWQ6IGZhbHNlXHJcbiAgICAgIH07XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgLy8gUmVnaXN0cmFyIGZhbGxvXHJcbiAgICAgIGF3YWl0IHRoaXMub25GYWlsdXJlKGVycm9yIGFzIEVycm9yKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG4gICAgICBhd2FpdCB0aGlzLnJlY29yZE1ldHJpY3MoJ2ZhaWx1cmUnLCBleGVjdXRpb25UaW1lKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVycm9yIGFzIEVycm9yLFxyXG4gICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxyXG4gICAgICAgIGV4ZWN1dGlvblRpbWUsXHJcbiAgICAgICAgd2FzUmVqZWN0ZWQ6IGZhbHNlXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXRlcm1pbmEgc2kgZGViZW1vcyByZWNoYXphciBsYSBvcGVyYWNpw7NuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzaG91bGRSZWplY3QoKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xyXG5cclxuICAgIHN3aXRjaCAodGhpcy5zdGF0ZSkge1xyXG4gICAgICBjYXNlIENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEOlxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgIGNhc2UgQ2lyY3VpdEJyZWFrZXJTdGF0ZS5PUEVOOlxyXG4gICAgICAgIC8vIFZlcmlmaWNhciBzaSBlcyB0aWVtcG8gZGUgaW50ZW50YXIgcmVjdXBlcmFjacOzblxyXG4gICAgICAgIGlmIChub3cgLSB0aGlzLmxhc3RGYWlsdXJlVGltZSA+PSB0aGlzLmNvbmZpZy5yZWNvdmVyeVRpbWVvdXQpIHtcclxuICAgICAgICAgIHRoaXMudHJhbnNpdGlvblRvSGFsZk9wZW4oKTtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgICBjYXNlIENpcmN1aXRCcmVha2VyU3RhdGUuSEFMRl9PUEVOOlxyXG4gICAgICAgIC8vIExpbWl0YXIgbGxhbWFkYXMgZW4gZXN0YWRvIEhBTEZfT1BFTlxyXG4gICAgICAgIHJldHVybiB0aGlzLmhhbGZPcGVuQ2FsbHMgPj0gdGhpcy5jb25maWcuaGFsZk9wZW5NYXhDYWxscztcclxuXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFuZWphIHVuIMOpeGl0byBlbiBsYSBvcGVyYWNpw7NuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBvblN1Y2Nlc3MoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0aGlzLmxhc3RTdWNjZXNzVGltZSA9IERhdGUubm93KCk7XHJcbiAgICB0aGlzLm1ldHJpY3Muc3VjY2Vzc2Z1bENhbGxzKys7XHJcblxyXG4gICAgc3dpdGNoICh0aGlzLnN0YXRlKSB7XHJcbiAgICAgIGNhc2UgQ2lyY3VpdEJyZWFrZXJTdGF0ZS5IQUxGX09QRU46XHJcbiAgICAgICAgdGhpcy5zdWNjZXNzZXMrKztcclxuICAgICAgICB0aGlzLmhhbGZPcGVuQ2FsbHMrKztcclxuICAgICAgICBcclxuICAgICAgICBpZiAodGhpcy5zdWNjZXNzZXMgPj0gdGhpcy5jb25maWcuc3VjY2Vzc1RocmVzaG9sZCkge1xyXG4gICAgICAgICAgdGhpcy50cmFuc2l0aW9uVG9DbG9zZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlIENpcmN1aXRCcmVha2VyU3RhdGUuQ0xPU0VEOlxyXG4gICAgICAgIC8vIFJlc2V0IGZhaWx1cmUgY291bnRlciBlbiB2ZW50YW5hIGRlIG1vbml0b3Jlb1xyXG4gICAgICAgIGlmICh0aGlzLmlzSW5Nb25pdG9yaW5nV2luZG93KCkpIHtcclxuICAgICAgICAgIHRoaXMuZmFpbHVyZXMgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hbmVqYSB1biBmYWxsbyBlbiBsYSBvcGVyYWNpw7NuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBvbkZhaWx1cmUoZXJyb3I6IEVycm9yKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0aGlzLmxhc3RGYWlsdXJlVGltZSA9IERhdGUubm93KCk7XHJcbiAgICB0aGlzLm1ldHJpY3MuZmFpbGVkQ2FsbHMrKztcclxuICAgIHRoaXMuZmFpbHVyZXMrKztcclxuXHJcbiAgICBsb2dnZXIud2FybihMb2dMZXZlbC5XQVJOLCBgQ2lyY3VpdCBCcmVha2VyIGZhaWx1cmU6ICR7dGhpcy5uYW1lfWAsIHtcclxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXHJcbiAgICAgIGZhaWx1cmVzOiB0aGlzLmZhaWx1cmVzLFxyXG4gICAgICBzdGF0ZTogdGhpcy5zdGF0ZVxyXG4gICAgfSwgTG9nQ2F0ZWdvcnkuU1lTVEVNKTtcclxuXHJcbiAgICBzd2l0Y2ggKHRoaXMuc3RhdGUpIHtcclxuICAgICAgY2FzZSBDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRDpcclxuICAgICAgICBpZiAodGhpcy5mYWlsdXJlcyA+PSB0aGlzLmNvbmZpZy5mYWlsdXJlVGhyZXNob2xkKSB7XHJcbiAgICAgICAgICB0aGlzLnRyYW5zaXRpb25Ub09wZW4oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlIENpcmN1aXRCcmVha2VyU3RhdGUuSEFMRl9PUEVOOlxyXG4gICAgICAgIHRoaXMudHJhbnNpdGlvblRvT3BlbigpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHJhbnNpY2nDs24gYSBlc3RhZG8gT1BFTlxyXG4gICAqL1xyXG4gIHByaXZhdGUgdHJhbnNpdGlvblRvT3BlbigpOiB2b2lkIHtcclxuICAgIHRoaXMuc3RhdGUgPSBDaXJjdWl0QnJlYWtlclN0YXRlLk9QRU47XHJcbiAgICB0aGlzLnN0YXRlQ2hhbmdlcysrO1xyXG4gICAgdGhpcy5tZXRyaWNzLnN0YXRlQ2hhbmdlcysrO1xyXG4gICAgdGhpcy5oYWxmT3BlbkNhbGxzID0gMDtcclxuICAgIHRoaXMuc3VjY2Vzc2VzID0gMDtcclxuXHJcbiAgICBsb2dnZXIud2FybihMb2dMZXZlbC5XQVJOLCBgQ2lyY3VpdCBCcmVha2VyIE9QRU5FRDogJHt0aGlzLm5hbWV9YCwge1xyXG4gICAgICBmYWlsdXJlczogdGhpcy5mYWlsdXJlcyxcclxuICAgICAgdGhyZXNob2xkOiB0aGlzLmNvbmZpZy5mYWlsdXJlVGhyZXNob2xkXHJcbiAgICB9LCBMb2dDYXRlZ29yeS5TWVNURU0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHJhbnNpY2nDs24gYSBlc3RhZG8gSEFMRl9PUEVOXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB0cmFuc2l0aW9uVG9IYWxmT3BlbigpOiB2b2lkIHtcclxuICAgIHRoaXMuc3RhdGUgPSBDaXJjdWl0QnJlYWtlclN0YXRlLkhBTEZfT1BFTjtcclxuICAgIHRoaXMuc3RhdGVDaGFuZ2VzKys7XHJcbiAgICB0aGlzLm1ldHJpY3Muc3RhdGVDaGFuZ2VzKys7XHJcbiAgICB0aGlzLmhhbGZPcGVuQ2FsbHMgPSAwO1xyXG4gICAgdGhpcy5zdWNjZXNzZXMgPSAwO1xyXG5cclxuICAgIGxvZ2dlci5pbmZvKExvZ0xldmVsLklORk8sIGBDaXJjdWl0IEJyZWFrZXIgSEFMRi1PUEVOOiAke3RoaXMubmFtZX1gLCB7XHJcbiAgICAgIHJlY292ZXJ5VGltZW91dDogdGhpcy5jb25maWcucmVjb3ZlcnlUaW1lb3V0XHJcbiAgICB9LCBMb2dDYXRlZ29yeS5TWVNURU0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHJhbnNpY2nDs24gYSBlc3RhZG8gQ0xPU0VEXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB0cmFuc2l0aW9uVG9DbG9zZWQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0YXRlID0gQ2lyY3VpdEJyZWFrZXJTdGF0ZS5DTE9TRUQ7XHJcbiAgICB0aGlzLnN0YXRlQ2hhbmdlcysrO1xyXG4gICAgdGhpcy5tZXRyaWNzLnN0YXRlQ2hhbmdlcysrO1xyXG4gICAgdGhpcy5mYWlsdXJlcyA9IDA7XHJcbiAgICB0aGlzLnN1Y2Nlc3NlcyA9IDA7XHJcbiAgICB0aGlzLmhhbGZPcGVuQ2FsbHMgPSAwO1xyXG5cclxuICAgIGxvZ2dlci5pbmZvKExvZ0xldmVsLklORk8sIGBDaXJjdWl0IEJyZWFrZXIgQ0xPU0VEOiAke3RoaXMubmFtZX1gLCB7XHJcbiAgICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6IHRoaXMuY29uZmlnLnN1Y2Nlc3NUaHJlc2hvbGRcclxuICAgIH0sIExvZ0NhdGVnb3J5LlNZU1RFTSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBWZXJpZmljYSBzaSBlc3RhbW9zIGVuIGxhIHZlbnRhbmEgZGUgbW9uaXRvcmVvXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc0luTW9uaXRvcmluZ1dpbmRvdygpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICByZXR1cm4gKG5vdyAtIHRoaXMubGFzdEZhaWx1cmVUaW1lKSA8PSB0aGlzLmNvbmZpZy5tb25pdG9yaW5nV2luZG93O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVnaXN0cmEgbcOpdHJpY2FzIGRlbCBjaXJjdWl0IGJyZWFrZXJcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHJlY29yZE1ldHJpY3MoXHJcbiAgICBvcGVyYXRpb246ICdzdWNjZXNzJyB8ICdmYWlsdXJlJyB8ICdyZWplY3RlZCcsXHJcbiAgICBleGVjdXRpb25UaW1lPzogbnVtYmVyXHJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCBtZXRyaWNzQ29sbGVjdG9yLnJlY29yZE1ldHJpYyhgY2lyY3VpdF9icmVha2VyLiR7dGhpcy5uYW1lfS4ke29wZXJhdGlvbn1gLCAxLCB7XHJcbiAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXHJcbiAgICAgICAgb3BlcmF0aW9uXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKGV4ZWN1dGlvblRpbWUpIHtcclxuICAgICAgICBhd2FpdCBtZXRyaWNzQ29sbGVjdG9yLnJlY29yZE1ldHJpYyhcclxuICAgICAgICAgIGBjaXJjdWl0X2JyZWFrZXIuJHt0aGlzLm5hbWV9LmV4ZWN1dGlvbl90aW1lYCxcclxuICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXHJcbiAgICAgICAgICB7IHN0YXRlOiB0aGlzLnN0YXRlIH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBNw6l0cmljYXMgZGUgZXN0YWRvXHJcbiAgICAgIGF3YWl0IG1ldHJpY3NDb2xsZWN0b3IucmVjb3JkTWV0cmljKGBjaXJjdWl0X2JyZWFrZXIuJHt0aGlzLm5hbWV9LnN0YXRlX2NoYW5nZXNgLCB0aGlzLnN0YXRlQ2hhbmdlcyk7XHJcbiAgICAgIGF3YWl0IG1ldHJpY3NDb2xsZWN0b3IucmVjb3JkTWV0cmljKGBjaXJjdWl0X2JyZWFrZXIuJHt0aGlzLm5hbWV9LmZhaWx1cmVfcmF0ZWAsIFxyXG4gICAgICAgIHRoaXMubWV0cmljcy50b3RhbENhbGxzID4gMCA/IHRoaXMubWV0cmljcy5mYWlsZWRDYWxscyAvIHRoaXMubWV0cmljcy50b3RhbENhbGxzIDogMFxyXG4gICAgICApO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcihMb2dMZXZlbC5FUlJPUiwgYEZhaWxlZCB0byByZWNvcmQgY2lyY3VpdCBicmVha2VyIG1ldHJpY3M6ICR7dGhpcy5uYW1lfWAsIHtcclxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcclxuICAgICAgfSwgTG9nQ2F0ZWdvcnkuU1lTVEVNKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE9idGllbmUgZWwgZXN0YWRvIGFjdHVhbCBkZWwgY2lyY3VpdCBicmVha2VyXHJcbiAgICovXHJcbiAgZ2V0U3RhdGUoKTogQ2lyY3VpdEJyZWFrZXJTdGF0ZSB7XHJcbiAgICByZXR1cm4gdGhpcy5zdGF0ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE9idGllbmUgbGFzIG3DqXRyaWNhcyBkZWwgY2lyY3VpdCBicmVha2VyXHJcbiAgICovXHJcbiAgZ2V0TWV0cmljcygpOiBDaXJjdWl0QnJlYWtlck1ldHJpY3MgJiB7IHN0YXRlOiBDaXJjdWl0QnJlYWtlclN0YXRlOyBjb25maWc6IENpcmN1aXRCcmVha2VyQ29uZmlnIH0ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgLi4udGhpcy5tZXRyaWNzLFxyXG4gICAgICBzdGF0ZTogdGhpcy5zdGF0ZSxcclxuICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZ1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZ1ZXJ6YSBlbCByZXNldCBkZWwgY2lyY3VpdCBicmVha2VyIChzb2xvIHBhcmEgdGVzdGluZy9hZG1pbilcclxuICAgKi9cclxuICByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMuc3RhdGUgPSBDaXJjdWl0QnJlYWtlclN0YXRlLkNMT1NFRDtcclxuICAgIHRoaXMuZmFpbHVyZXMgPSAwO1xyXG4gICAgdGhpcy5zdWNjZXNzZXMgPSAwO1xyXG4gICAgdGhpcy5oYWxmT3BlbkNhbGxzID0gMDtcclxuICAgIHRoaXMubGFzdEZhaWx1cmVUaW1lID0gMDtcclxuICAgIHRoaXMubGFzdFN1Y2Nlc3NUaW1lID0gMDtcclxuXHJcbiAgICBsb2dnZXIuaW5mbyhMb2dMZXZlbC5JTkZPLCBgQ2lyY3VpdCBCcmVha2VyIG1hbnVhbGx5IHJlc2V0OiAke3RoaXMubmFtZX1gLCB7fSwgTG9nQ2F0ZWdvcnkuU1lTVEVNKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIEluc3RhbmNpYXMgZ2xvYmFsZXMgZGUgY2lyY3VpdCBicmVha2Vyc1xyXG5leHBvcnQgY29uc3QgbWVyY2Fkb1BhZ29Dcml0aWNhbEJyZWFrZXIgPSBuZXcgQ2lyY3VpdEJyZWFrZXIoXHJcbiAgJ21lcmNhZG9wYWdvX2NyaXRpY2FsJyxcclxuICBDSVJDVUlUX0JSRUFLRVJfQ09ORklHUy5NRVJDQURPUEFHT19DUklUSUNBTFxyXG4pO1xyXG5cclxuZXhwb3J0IGNvbnN0IG1lcmNhZG9QYWdvU3RhbmRhcmRCcmVha2VyID0gbmV3IENpcmN1aXRCcmVha2VyKFxyXG4gICdtZXJjYWRvcGFnb19zdGFuZGFyZCcsIFxyXG4gIENJUkNVSVRfQlJFQUtFUl9DT05GSUdTLk1FUkNBRE9QQUdPX1NUQU5EQVJEXHJcbik7XHJcblxyXG5leHBvcnQgY29uc3Qgd2ViaG9va1Byb2Nlc3NpbmdCcmVha2VyID0gbmV3IENpcmN1aXRCcmVha2VyKFxyXG4gICd3ZWJob29rX3Byb2Nlc3NpbmcnLFxyXG4gIENJUkNVSVRfQlJFQUtFUl9DT05GSUdTLldFQkhPT0tfUFJPQ0VTU0lOR1xyXG4pO1xyXG5cclxuLyoqXHJcbiAqIFdyYXBwZXIgcGFyYSBvcGVyYWNpb25lcyBjcsOtdGljYXMgZGUgTWVyY2Fkb1BhZ29cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlTWVyY2Fkb1BhZ29Dcml0aWNhbDxUPihcclxuICBvcGVyYXRpb246ICgpID0+IFByb21pc2U8VD5cclxuKTogUHJvbWlzZTxDaXJjdWl0QnJlYWtlclJlc3VsdDxUPj4ge1xyXG4gIHJldHVybiBtZXJjYWRvUGFnb0NyaXRpY2FsQnJlYWtlci5leGVjdXRlKG9wZXJhdGlvbik7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBXcmFwcGVyIHBhcmEgb3BlcmFjaW9uZXMgZXN0w6FuZGFyIGRlIE1lcmNhZG9QYWdvXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZU1lcmNhZG9QYWdvU3RhbmRhcmQ8VD4oXHJcbiAgb3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+XHJcbik6IFByb21pc2U8Q2lyY3VpdEJyZWFrZXJSZXN1bHQ8VD4+IHtcclxuICByZXR1cm4gbWVyY2Fkb1BhZ29TdGFuZGFyZEJyZWFrZXIuZXhlY3V0ZShvcGVyYXRpb24pO1xyXG59XHJcblxyXG4vKipcclxuICogV3JhcHBlciBwYXJhIHByb2Nlc2FtaWVudG8gZGUgd2ViaG9va3NcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlV2ViaG9va1Byb2Nlc3Npbmc8VD4oXHJcbiAgb3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+XHJcbik6IFByb21pc2U8Q2lyY3VpdEJyZWFrZXJSZXN1bHQ8VD4+IHtcclxuICByZXR1cm4gd2ViaG9va1Byb2Nlc3NpbmdCcmVha2VyLmV4ZWN1dGUob3BlcmF0aW9uKTtcclxufVxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iXSwibmFtZXMiOlsiQ0lSQ1VJVF9CUkVBS0VSX0NPTkZJR1MiLCJDaXJjdWl0QnJlYWtlciIsIkNpcmN1aXRCcmVha2VyU3RhdGUiLCJleGVjdXRlTWVyY2Fkb1BhZ29Dcml0aWNhbCIsImV4ZWN1dGVNZXJjYWRvUGFnb1N0YW5kYXJkIiwiZXhlY3V0ZVdlYmhvb2tQcm9jZXNzaW5nIiwibWVyY2Fkb1BhZ29Dcml0aWNhbEJyZWFrZXIiLCJtZXJjYWRvUGFnb1N0YW5kYXJkQnJlYWtlciIsIndlYmhvb2tQcm9jZXNzaW5nQnJlYWtlciIsIk1FUkNBRE9QQUdPX0NSSVRJQ0FMIiwiZmFpbHVyZVRocmVzaG9sZCIsInJlY292ZXJ5VGltZW91dCIsIm1vbml0b3JpbmdXaW5kb3ciLCJoYWxmT3Blbk1heENhbGxzIiwic3VjY2Vzc1RocmVzaG9sZCIsIk1FUkNBRE9QQUdPX1NUQU5EQVJEIiwiV0VCSE9PS19QUk9DRVNTSU5HIiwibmFtZSIsImNvbmZpZyIsInN0YXRlIiwiZmFpbHVyZXMiLCJzdWNjZXNzZXMiLCJsYXN0RmFpbHVyZVRpbWUiLCJsYXN0U3VjY2Vzc1RpbWUiLCJoYWxmT3BlbkNhbGxzIiwic3RhdGVDaGFuZ2VzIiwibWV0cmljcyIsInRvdGFsQ2FsbHMiLCJzdWNjZXNzZnVsQ2FsbHMiLCJmYWlsZWRDYWxscyIsInJlamVjdGVkQ2FsbHMiLCJsb2dnZXIiLCJkZWJ1ZyIsIkxvZ0xldmVsIiwiREVCVUciLCJMb2dDYXRlZ29yeSIsIlNZU1RFTSIsImV4ZWN1dGUiLCJvcGVyYXRpb24iLCJzdGFydFRpbWUiLCJEYXRlIiwibm93Iiwic2hvdWxkUmVqZWN0IiwicmVjb3JkTWV0cmljcyIsInN1Y2Nlc3MiLCJlcnJvciIsIkVycm9yIiwiZXhlY3V0aW9uVGltZSIsIndhc1JlamVjdGVkIiwicmVzdWx0Iiwib25TdWNjZXNzIiwiZGF0YSIsIm9uRmFpbHVyZSIsInRyYW5zaXRpb25Ub0hhbGZPcGVuIiwidHJhbnNpdGlvblRvQ2xvc2VkIiwiaXNJbk1vbml0b3JpbmdXaW5kb3ciLCJ3YXJuIiwiV0FSTiIsIm1lc3NhZ2UiLCJ0cmFuc2l0aW9uVG9PcGVuIiwidGhyZXNob2xkIiwiaW5mbyIsIklORk8iLCJtZXRyaWNzQ29sbGVjdG9yIiwicmVjb3JkTWV0cmljIiwiRVJST1IiLCJnZXRTdGF0ZSIsImdldE1ldHJpY3MiLCJyZXNldCJdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBQ3RDLDBEQUEwRDtBQUMxRCxzQ0FBc0M7Ozs7Ozs7Ozs7OztRQXNCekJBO2VBQUFBOztRQWlEQUM7ZUFBQUE7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