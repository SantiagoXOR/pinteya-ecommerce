{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\lib\\monitoring\\enterprise-monitoring-manager.ts"],"sourcesContent":["// ===================================\r\n// PINTEYA E-COMMERCE - ENTERPRISE MONITORING MANAGER\r\n// Sistema de monitoreo enterprise con error tracking, performance y analytics\r\n// ===================================\r\n\r\n// Importar performance hooks solo en servidor\r\nconst perfHooks = typeof window === 'undefined' ? require('perf_hooks') : null;\r\n\r\n// ===================================\r\n// TIPOS Y INTERFACES ESPECÍFICAS\r\n// ===================================\r\n\r\n// Tipos base para métricas\r\ntype MetricValue = number;\r\ntype MetricTimestamp = Date;\r\ntype MetricContext = Record<string, string | number | boolean>;\r\n\r\n// Interfaces específicas para Core Web Vitals\r\ninterface CoreWebVitals {\r\n  lcp?: MetricValue; // Largest Contentful Paint\r\n  fid?: MetricValue; // First Input Delay\r\n  cls?: MetricValue; // Cumulative Layout Shift\r\n}\r\n\r\n// Interfaces específicas para métricas personalizadas\r\ninterface CustomPerformanceMetrics {\r\n  loadTime: MetricValue;\r\n  renderTime: MetricValue;\r\n  memoryUsage: MetricValue;\r\n  bundleSize: MetricValue;\r\n}\r\n\r\n// Interfaces específicas para métricas de API\r\ninterface ApiMetrics {\r\n  apiResponseTime: MetricValue;\r\n  apiErrorRate: MetricValue;\r\n}\r\n\r\n// Interfaces específicas para métricas de usuario\r\ninterface UserMetrics {\r\n  sessionDuration: MetricValue;\r\n  pageViews: MetricValue;\r\n  bounceRate: MetricValue;\r\n}\r\n\r\n// Interface específica para contexto de métricas\r\ninterface MetricsContext {\r\n  page: string;\r\n  userId?: string;\r\n  sessionId: string;\r\n  device: string;\r\n  browser: string;\r\n}\r\n\r\ninterface ErrorEvent {\r\n  id: string;\r\n  timestamp: MetricTimestamp;\r\n  message: string;\r\n  stack?: string;\r\n  level: 'info' | 'warning' | 'error' | 'critical';\r\n  context: {\r\n    userId?: string;\r\n    sessionId: string;\r\n    url: string;\r\n    userAgent: string;\r\n    component?: string;\r\n    action?: string;\r\n  };\r\n  tags: string[];\r\n  fingerprint: string;\r\n  count: number;\r\n}\r\n\r\ninterface PerformanceMetrics {\r\n  timestamp: MetricTimestamp;\r\n  metrics: CoreWebVitals & CustomPerformanceMetrics & ApiMetrics & UserMetrics;\r\n  context: MetricsContext;\r\n}\r\n\r\n// Tipos específicos para alertas\r\ntype AlertSeverity = 'low' | 'medium' | 'high' | 'critical';\r\ntype AlertOperator = '>' | '<' | '=' | '>=' | '<=';\r\ntype AlertMetricName = string;\r\n\r\n// Interface específica para contexto de alertas\r\ninterface AlertContext {\r\n  page?: string;\r\n  userId?: string;\r\n  sessionId?: string;\r\n  component?: string;\r\n  action?: string;\r\n  metadata?: Record<string, string | number | boolean>;\r\n}\r\n\r\n// Interfaces específicas para configuración de monitoreo\r\ninterface ErrorTrackingConfig {\r\n  enabled: boolean;\r\n  sampleRate: number;\r\n  ignoreErrors: string[];\r\n  maxBreadcrumbs: number;\r\n}\r\n\r\ninterface PerformanceThresholds {\r\n  lcp: MetricValue;\r\n  fid: MetricValue;\r\n  cls: MetricValue;\r\n  loadTime: MetricValue;\r\n}\r\n\r\ninterface PerformanceConfig {\r\n  enabled: boolean;\r\n  sampleRate: number;\r\n  thresholds: PerformanceThresholds;\r\n}\r\n\r\ninterface AlertChannels {\r\n  email?: string[];\r\n  slack?: string;\r\n  webhook?: string;\r\n}\r\n\r\ninterface AlertsConfig {\r\n  enabled: boolean;\r\n  channels: AlertChannels;\r\n}\r\n\r\ninterface AlertRule {\r\n  id: string;\r\n  name: string;\r\n  metric: AlertMetricName;\r\n  threshold: MetricValue;\r\n  operator: AlertOperator;\r\n  severity: AlertSeverity;\r\n  enabled: boolean;\r\n  cooldown: number; // minutes\r\n  lastTriggered?: MetricTimestamp;\r\n}\r\n\r\ninterface AlertEvent {\r\n  id: string;\r\n  ruleId: string;\r\n  timestamp: MetricTimestamp;\r\n  severity: AlertSeverity;\r\n  message: string;\r\n  value: MetricValue;\r\n  threshold: MetricValue;\r\n  context: AlertContext;\r\n  acknowledged: boolean;\r\n  resolvedAt?: MetricTimestamp;\r\n}\r\n\r\ninterface MonitoringConfig {\r\n  errorTracking: ErrorTrackingConfig;\r\n  performance: PerformanceConfig;\r\n  alerts: AlertsConfig;\r\n}\r\n\r\n// ===================================\r\n// INTERFACES\r\n// ===================================\r\n\r\n// Interface para Navigation Timing\r\ninterface NavigationTiming extends PerformanceEntry {\r\n  loadEventEnd: number;\r\n  loadEventStart: number;\r\n  domContentLoadedEventEnd: number;\r\n  domContentLoadedEventStart: number;\r\n}\r\n\r\n// Interface para Performance Memory\r\ninterface PerformanceMemory {\r\n  usedJSHeapSize: number;\r\n}\r\n\r\ninterface PerformanceWithMemory extends Performance {\r\n  memory?: PerformanceMemory;\r\n}\r\n\r\n// ===================================\r\n// ENTERPRISE MONITORING MANAGER\r\n// ===================================\r\n// CLASE PRINCIPAL\r\n// ===================================\r\n\r\nclass EnterpriseMonitoringManager {\r\n  private static instance: EnterpriseMonitoringManager;\r\n  private config: MonitoringConfig;\r\n  private errors: Map<string, ErrorEvent> = new Map();\r\n  private performanceData: PerformanceMetrics[] = [];\r\n  private alertRules: Map<string, AlertRule> = new Map();\r\n  private activeAlerts: Map<string, AlertEvent> = new Map();\r\n  private sessionId: string;\r\n\r\n  constructor(config: MonitoringConfig) {\r\n    this.config = config;\r\n    this.sessionId = this.generateSessionId();\r\n    this.initializeDefaultAlertRules();\r\n    this.startPerformanceMonitoring();\r\n  }\r\n\r\n  static getInstance(config?: MonitoringConfig): EnterpriseMonitoringManager {\r\n    if (!EnterpriseMonitoringManager.instance) {\r\n      if (!config) {\r\n        throw new Error('Configuration required for first initialization');\r\n      }\r\n      EnterpriseMonitoringManager.instance = new EnterpriseMonitoringManager(config);\r\n    }\r\n    return EnterpriseMonitoringManager.instance;\r\n  }\r\n\r\n  // ===================================\r\n  // ERROR TRACKING\r\n  // ===================================\r\n\r\n  /**\r\n   * Capturar y procesar error\r\n   */\r\n  captureError(\r\n    error: Error | string,\r\n    level: ErrorEvent['level'] = 'error',\r\n    context: Partial<ErrorEvent['context']> = {},\r\n    tags: string[] = []\r\n  ): string {\r\n    if (!this.config.errorTracking.enabled) {\r\n      return '';\r\n    }\r\n\r\n    // Sample rate check\r\n    if (Math.random() > this.config.errorTracking.sampleRate) {\r\n      return '';\r\n    }\r\n\r\n    const errorMessage = typeof error === 'string' ? error : error.message;\r\n    const stack = typeof error === 'string' ? undefined : error.stack;\r\n\r\n    // Check if error should be ignored\r\n    if (this.config.errorTracking.ignoreErrors.some(pattern => \r\n      errorMessage.includes(pattern)\r\n    )) {\r\n      return '';\r\n    }\r\n\r\n    const fingerprint = this.generateErrorFingerprint(errorMessage, stack);\r\n    const errorId = this.generateErrorId();\r\n\r\n    const errorEvent: ErrorEvent = {\r\n      id: errorId,\r\n      timestamp: new Date(),\r\n      message: errorMessage,\r\n      stack,\r\n      level,\r\n      context: {\r\n        sessionId: this.sessionId,\r\n        url: typeof window !== 'undefined' ? window.location.href : '',\r\n        userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : '',\r\n        ...context\r\n      },\r\n      tags,\r\n      fingerprint,\r\n      count: 1\r\n    };\r\n\r\n    // Check if error already exists (deduplication)\r\n    const existingError = Array.from(this.errors.values())\r\n      .find(e => e.fingerprint === fingerprint);\r\n\r\n    if (existingError) {\r\n      existingError.count++;\r\n      existingError.timestamp = new Date();\r\n    } else {\r\n      this.errors.set(errorId, errorEvent);\r\n    }\r\n\r\n    // Check alert rules\r\n    this.checkErrorAlerts(errorEvent);\r\n\r\n    // Log to console in development\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.error('[Monitoring] Error captured:', errorEvent);\r\n    }\r\n\r\n    return errorId;\r\n  }\r\n\r\n  /**\r\n   * Obtener errores con filtros\r\n   */\r\n  getErrors(filters: {\r\n    level?: ErrorEvent['level'];\r\n    timeRange?: { start: Date; end: Date };\r\n    component?: string;\r\n    limit?: number;\r\n  } = {}): ErrorEvent[] {\r\n    let errors = Array.from(this.errors.values());\r\n\r\n    // Apply filters\r\n    if (filters.level) {\r\n      errors = errors.filter(e => e.level === filters.level);\r\n    }\r\n\r\n    if (filters.timeRange) {\r\n      errors = errors.filter(e => \r\n        e.timestamp >= filters.timeRange!.start && \r\n        e.timestamp <= filters.timeRange!.end\r\n      );\r\n    }\r\n\r\n    if (filters.component) {\r\n      errors = errors.filter(e => e.context.component === filters.component);\r\n    }\r\n\r\n    // Sort by timestamp (newest first)\r\n    errors.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\r\n\r\n    // Apply limit\r\n    if (filters.limit) {\r\n      errors = errors.slice(0, filters.limit);\r\n    }\r\n\r\n    return errors;\r\n  }\r\n\r\n  // ===================================\r\n  // PERFORMANCE MONITORING\r\n  // ===================================\r\n\r\n  /**\r\n   * Inicializar monitoreo de performance\r\n   */\r\n  private startPerformanceMonitoring(): void {\r\n    if (!this.config.performance.enabled || typeof window === 'undefined') {\r\n      return;\r\n    }\r\n\r\n    // Monitor Core Web Vitals\r\n    this.monitorWebVitals();\r\n\r\n    // Monitor custom metrics every 30 seconds\r\n    setInterval(() => {\r\n      this.capturePerformanceMetrics();\r\n    }, 30000);\r\n\r\n    // Monitor page visibility changes\r\n    document.addEventListener('visibilitychange', () => {\r\n      if (document.visibilityState === 'hidden') {\r\n        this.capturePerformanceMetrics();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Monitorear Core Web Vitals\r\n   */\r\n  private monitorWebVitals(): void {\r\n    // LCP - Largest Contentful Paint\r\n    new PerformanceObserver((entryList) => {\r\n      const entries = entryList.getEntries();\r\n      const lastEntry = entries[entries.length - 1];\r\n      this.recordMetric('lcp', lastEntry.startTime);\r\n    }).observe({ entryTypes: ['largest-contentful-paint'] });\r\n\r\n    // FID - First Input Delay\r\n// Interfaces para Performance Observer entries\r\ninterface PerformanceEventTiming extends PerformanceEntry {\r\n  processingStart: number;\r\n  startTime: number;\r\n}\r\n\r\ninterface LayoutShiftEntry extends PerformanceEntry {\r\n  value: number;\r\n  hadRecentInput: boolean;\r\n}\r\n\r\n    new PerformanceObserver((entryList) => {\r\n      const entries = entryList.getEntries();\r\n      entries.forEach((entry: PerformanceEventTiming) => {\r\n        this.recordMetric('fid', entry.processingStart - entry.startTime);\r\n      });\r\n    }).observe({ entryTypes: ['first-input'] });\r\n\r\n    // CLS - Cumulative Layout Shift\r\n    let clsValue = 0;\r\n    new PerformanceObserver((entryList) => {\r\n      const entries = entryList.getEntries();\r\n      entries.forEach((entry: LayoutShiftEntry) => {\r\n        if (!entry.hadRecentInput) {\r\n          clsValue += entry.value;\r\n        }\r\n      });\r\n      this.recordMetric('cls', clsValue);\r\n    }).observe({ entryTypes: ['layout-shift'] });\r\n  }\r\n\r\n  /**\r\n   * Capturar métricas de performance\r\n   */\r\n  capturePerformanceMetrics(): void {\r\n    if (!this.config.performance.enabled) {\r\n      return;\r\n    }\r\n\r\n    // Sample rate check\r\n    if (Math.random() > this.config.performance.sampleRate) {\r\n      return;\r\n    }\r\n\r\n    const metrics: PerformanceMetrics = {\r\n      timestamp: new Date(),\r\n      metrics: {\r\n        loadTime: this.getLoadTime(),\r\n        renderTime: this.getRenderTime(),\r\n        memoryUsage: this.getMemoryUsage(),\r\n        bundleSize: this.getBundleSize(),\r\n        apiResponseTime: this.getAverageApiResponseTime(),\r\n        apiErrorRate: this.getApiErrorRate(),\r\n        sessionDuration: this.getSessionDuration(),\r\n        pageViews: this.getPageViews(),\r\n        bounceRate: this.getBounceRate()\r\n      },\r\n      context: {\r\n        page: typeof window !== 'undefined' ? window.location.pathname : '',\r\n        sessionId: this.sessionId,\r\n        device: this.getDeviceType(),\r\n        browser: this.getBrowserType(),\r\n        userId: this.getUserId()\r\n      }\r\n    };\r\n\r\n    this.performanceData.push(metrics);\r\n\r\n    // Keep only last 1000 entries\r\n    if (this.performanceData.length > 1000) {\r\n      this.performanceData = this.performanceData.slice(-1000);\r\n    }\r\n\r\n    // Check performance alerts\r\n    this.checkPerformanceAlerts(metrics);\r\n\r\n    // Log in development\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log('[Monitoring] Performance metrics captured:', metrics);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Registrar métrica específica\r\n   */\r\n  recordMetric(name: string, value: number, context: MetricContext = {}): void {\r\n    const metric = {\r\n      name,\r\n      value,\r\n      timestamp: new Date(),\r\n      context: {\r\n        sessionId: this.sessionId,\r\n        ...context\r\n      }\r\n    };\r\n\r\n    // Check if metric triggers alerts\r\n    this.checkMetricAlerts(name, value);\r\n\r\n    // Log in development\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log(`[Monitoring] Metric recorded: ${name} = ${value}`, metric);\r\n    }\r\n  }\r\n\r\n  // ===================================\r\n  // ALERT SYSTEM\r\n  // ===================================\r\n\r\n  /**\r\n   * Inicializar reglas de alerta por defecto\r\n   */\r\n  private initializeDefaultAlertRules(): void {\r\n    const defaultRules: AlertRule[] = [\r\n      {\r\n        id: 'high-error-rate',\r\n        name: 'High Error Rate',\r\n        metric: 'error_rate',\r\n        threshold: 0.05, // 5%\r\n        operator: '>',\r\n        severity: 'high',\r\n        enabled: true,\r\n        cooldown: 15\r\n      },\r\n      {\r\n        id: 'slow-page-load',\r\n        name: 'Slow Page Load',\r\n        metric: 'load_time',\r\n        threshold: 3000, // 3 seconds\r\n        operator: '>',\r\n        severity: 'medium',\r\n        enabled: true,\r\n        cooldown: 10\r\n      },\r\n      {\r\n        id: 'high-memory-usage',\r\n        name: 'High Memory Usage',\r\n        metric: 'memory_usage',\r\n        threshold: 100, // 100MB\r\n        operator: '>',\r\n        severity: 'medium',\r\n        enabled: true,\r\n        cooldown: 20\r\n      },\r\n      {\r\n        id: 'poor-lcp',\r\n        name: 'Poor Largest Contentful Paint',\r\n        metric: 'lcp',\r\n        threshold: 2500, // 2.5 seconds\r\n        operator: '>',\r\n        severity: 'medium',\r\n        enabled: true,\r\n        cooldown: 15\r\n      }\r\n    ];\r\n\r\n    defaultRules.forEach(rule => {\r\n      this.alertRules.set(rule.id, rule);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Verificar alertas de errores\r\n   */\r\n  private checkErrorAlerts(errorEvent: ErrorEvent): void {\r\n    // Calculate error rate\r\n    const recentErrors = this.getErrors({\r\n      timeRange: {\r\n        start: new Date(Date.now() - 5 * 60 * 1000), // Last 5 minutes\r\n        end: new Date()\r\n      }\r\n    });\r\n\r\n    const errorRate = recentErrors.length / 100; // Assuming 100 requests per 5 minutes\r\n\r\n    this.checkMetricAlerts('error_rate', errorRate);\r\n\r\n    // Check for critical errors\r\n    if (errorEvent.level === 'critical') {\r\n      this.triggerAlert('critical-error', {\r\n        message: `Critical error occurred: ${errorEvent.message}`,\r\n        value: 1,\r\n        threshold: 0,\r\n        context: errorEvent\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Verificar alertas de performance\r\n   */\r\n  private checkPerformanceAlerts(metrics: PerformanceMetrics): void {\r\n    const { metrics: m } = metrics;\r\n\r\n    // Check each metric against alert rules\r\n    Object.entries(m).forEach(([metricName, value]) => {\r\n      if (typeof value === 'number') {\r\n        this.checkMetricAlerts(metricName, value);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Verificar alertas para una métrica específica\r\n   */\r\n  private checkMetricAlerts(metricName: string, value: number): void {\r\n    const relevantRules = Array.from(this.alertRules.values())\r\n      .filter(rule => rule.metric === metricName && rule.enabled);\r\n\r\n    relevantRules.forEach(rule => {\r\n      const shouldTrigger = this.evaluateAlertCondition(rule, value);\r\n      \r\n      if (shouldTrigger && this.canTriggerAlert(rule)) {\r\n        this.triggerAlert(rule.id, {\r\n          message: `${rule.name}: ${metricName} is ${value} (threshold: ${rule.threshold})`,\r\n          value,\r\n          threshold: rule.threshold,\r\n          context: { metricName, rule }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Evaluar condición de alerta\r\n   */\r\n  private evaluateAlertCondition(rule: AlertRule, value: number): boolean {\r\n    switch (rule.operator) {\r\n      case '>': return value > rule.threshold;\r\n      case '<': return value < rule.threshold;\r\n      case '>=': return value >= rule.threshold;\r\n      case '<=': return value <= rule.threshold;\r\n      case '=': return value === rule.threshold;\r\n      default: return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Verificar si se puede disparar alerta (cooldown)\r\n   */\r\n  private canTriggerAlert(rule: AlertRule): boolean {\r\n    if (!rule.lastTriggered) {\r\n      return true;\r\n    }\r\n\r\n    const cooldownMs = rule.cooldown * 60 * 1000;\r\n    const timeSinceLastTrigger = Date.now() - rule.lastTriggered.getTime();\r\n    \r\n    return timeSinceLastTrigger >= cooldownMs;\r\n  }\r\n\r\n  /**\r\n   * Disparar alerta\r\n   */\r\n  private triggerAlert(ruleId: string, alertData: {\r\n    message: string;\r\n    value: number;\r\n    threshold: number;\r\n    context: AlertContext;\r\n  }): void {\r\n    const rule = this.alertRules.get(ruleId);\r\n    if (!rule) {return;}\r\n\r\n    const alertId = this.generateAlertId();\r\n    const alert: AlertEvent = {\r\n      id: alertId,\r\n      ruleId,\r\n      timestamp: new Date(),\r\n      severity: rule.severity,\r\n      message: alertData.message,\r\n      value: alertData.value,\r\n      threshold: alertData.threshold,\r\n      context: alertData.context,\r\n      acknowledged: false\r\n    };\r\n\r\n    this.activeAlerts.set(alertId, alert);\r\n    rule.lastTriggered = new Date();\r\n\r\n    // Send notifications\r\n    this.sendAlertNotifications(alert);\r\n\r\n    console.warn('[Monitoring] Alert triggered:', alert);\r\n  }\r\n\r\n  /**\r\n   * Enviar notificaciones de alerta\r\n   */\r\n  private async sendAlertNotifications(alert: AlertEvent): Promise<void> {\r\n    if (!this.config.alerts.enabled) {\r\n      return;\r\n    }\r\n\r\n    const { channels } = this.config.alerts;\r\n\r\n    // Email notifications\r\n    if (channels.email && channels.email.length > 0) {\r\n      // Implementation would integrate with email service\r\n      console.log(`[Monitoring] Email alert sent to: ${channels.email.join(', ')}`);\r\n    }\r\n\r\n    // Slack notifications\r\n    if (channels.slack) {\r\n      // Implementation would integrate with Slack webhook\r\n      console.log(`[Monitoring] Slack alert sent to: ${channels.slack}`);\r\n    }\r\n\r\n    // Webhook notifications\r\n    if (channels.webhook) {\r\n      try {\r\n        // Implementation would send HTTP POST to webhook\r\n        console.log(`[Monitoring] Webhook alert sent to: ${channels.webhook}`);\r\n      } catch (error) {\r\n        console.error('[Monitoring] Failed to send webhook alert:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  // ===================================\r\n  // UTILITY METHODS\r\n  // ===================================\r\n\r\n  private generateSessionId(): string {\r\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  private generateErrorId(): string {\r\n    return `error_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  private generateAlertId(): string {\r\n    return `alert_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  private generateErrorFingerprint(message: string, stack?: string): string {\r\n    const content = `${message}${stack || ''}`;\r\n    // Simple hash function for fingerprinting\r\n    let hash = 0;\r\n    for (let i = 0; i < content.length; i++) {\r\n      const char = content.charCodeAt(i);\r\n      hash = ((hash << 5) - hash) + char;\r\n      hash = hash & hash; // Convert to 32-bit integer\r\n    }\r\n    return hash.toString(36);\r\n  }\r\n\r\n\r\n\r\n  private getLoadTime(): number {\r\n    if (typeof window === 'undefined') {return 0;}\r\n    const navigation = performance.getEntriesByType('navigation')[0] as NavigationTiming;\r\n    return navigation ? navigation.loadEventEnd - navigation.loadEventStart : 0;\r\n  }\r\n\r\n  private getRenderTime(): number {\r\n    if (typeof window === 'undefined') {return 0;}\r\n    const navigation = performance.getEntriesByType('navigation')[0] as NavigationTiming;\r\n    return navigation ? navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart : 0;\r\n  }\r\n\r\n  private getMemoryUsage(): number {\r\n    if (typeof window === 'undefined' || !(performance as PerformanceWithMemory).memory) {return 0;}\r\n    return (performance as PerformanceWithMemory).memory!.usedJSHeapSize / 1024 / 1024; // MB\r\n  }\r\n\r\n  private getBundleSize(): number {\r\n    // This would be calculated based on loaded resources\r\n    return 0; // Placeholder\r\n  }\r\n\r\n  private getAverageApiResponseTime(): number {\r\n    // This would be calculated from API call metrics\r\n    return 0; // Placeholder\r\n  }\r\n\r\n  private getApiErrorRate(): number {\r\n    // This would be calculated from API call metrics\r\n    return 0; // Placeholder\r\n  }\r\n\r\n  private getSessionDuration(): number {\r\n    return Date.now() - parseInt(this.sessionId.split('_')[1]);\r\n  }\r\n\r\n  private getPageViews(): number {\r\n    // This would be tracked separately\r\n    return 1; // Placeholder\r\n  }\r\n\r\n  private getBounceRate(): number {\r\n    // This would be calculated from user behavior\r\n    return 0; // Placeholder\r\n  }\r\n\r\n  private getDeviceType(): string {\r\n    if (typeof window === 'undefined') {return 'unknown';}\r\n    const width = window.innerWidth;\r\n    if (width < 768) {return 'mobile';}\r\n    if (width < 1024) {return 'tablet';}\r\n    return 'desktop';\r\n  }\r\n\r\n  private getBrowserType(): string {\r\n    if (typeof navigator === 'undefined') {return 'unknown';}\r\n    const userAgent = navigator.userAgent;\r\n    if (userAgent.includes('Chrome')) {return 'chrome';}\r\n    if (userAgent.includes('Firefox')) {return 'firefox';}\r\n    if (userAgent.includes('Safari')) {return 'safari';}\r\n    if (userAgent.includes('Edge')) {return 'edge';}\r\n    return 'other';\r\n  }\r\n\r\n  private getUserId(): string | undefined {\r\n    // This would be retrieved from authentication context\r\n    return undefined; // Placeholder\r\n  }\r\n\r\n  // ===================================\r\n  // PUBLIC API\r\n  // ===================================\r\n\r\n  /**\r\n   * Obtener métricas de performance\r\n   */\r\n  getPerformanceMetrics(timeRange?: { start: Date; end: Date }): PerformanceMetrics[] {\r\n    let data = this.performanceData;\r\n\r\n    if (timeRange) {\r\n      data = data.filter(m => \r\n        m.timestamp >= timeRange.start && m.timestamp <= timeRange.end\r\n      );\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Obtener alertas activas\r\n   */\r\n  getActiveAlerts(): AlertEvent[] {\r\n    return Array.from(this.activeAlerts.values())\r\n      .filter(alert => !alert.resolvedAt)\r\n      .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\r\n  }\r\n\r\n  /**\r\n   * Reconocer alerta\r\n   */\r\n  acknowledgeAlert(alertId: string): boolean {\r\n    const alert = this.activeAlerts.get(alertId);\r\n    if (alert) {\r\n      alert.acknowledged = true;\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Resolver alerta\r\n   */\r\n  resolveAlert(alertId: string): boolean {\r\n    const alert = this.activeAlerts.get(alertId);\r\n    if (alert) {\r\n      alert.resolvedAt = new Date();\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Obtener resumen de monitoreo\r\n   */\r\n  getMonitoringSummary() {\r\n    const now = new Date();\r\n    const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);\r\n\r\n    const recentErrors = this.getErrors({\r\n      timeRange: { start: oneHourAgo, end: now }\r\n    });\r\n\r\n    const recentMetrics = this.getPerformanceMetrics({\r\n      start: oneHourAgo,\r\n      end: now\r\n    });\r\n\r\n    const activeAlerts = this.getActiveAlerts();\r\n\r\n    return {\r\n      errors: {\r\n        total: recentErrors.length,\r\n        critical: recentErrors.filter(e => e.level === 'critical').length,\r\n        warning: recentErrors.filter(e => e.level === 'warning').length\r\n      },\r\n      performance: {\r\n        averageLoadTime: recentMetrics.length > 0 \r\n          ? recentMetrics.reduce((sum, m) => sum + m.metrics.loadTime, 0) / recentMetrics.length \r\n          : 0,\r\n        averageMemoryUsage: recentMetrics.length > 0\r\n          ? recentMetrics.reduce((sum, m) => sum + m.metrics.memoryUsage, 0) / recentMetrics.length\r\n          : 0\r\n      },\r\n      alerts: {\r\n        active: activeAlerts.length,\r\n        critical: activeAlerts.filter(a => a.severity === 'critical').length,\r\n        unacknowledged: activeAlerts.filter(a => !a.acknowledged).length\r\n      },\r\n      system: {\r\n        uptime: this.getSessionDuration(),\r\n        sessionId: this.sessionId\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n// ===================================\r\n// EXPORTS\r\n// ===================================\r\n\r\nexport default EnterpriseMonitoringManager;\r\n\r\nexport type {\r\n  ErrorEvent,\r\n  PerformanceMetrics,\r\n  AlertRule,\r\n  AlertEvent,\r\n  MonitoringConfig\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["perfHooks","window","require","EnterpriseMonitoringManager","config","errors","Map","performanceData","alertRules","activeAlerts","sessionId","generateSessionId","initializeDefaultAlertRules","startPerformanceMonitoring","getInstance","instance","Error","captureError","error","level","context","tags","errorTracking","enabled","Math","random","sampleRate","errorMessage","message","stack","undefined","ignoreErrors","some","pattern","includes","fingerprint","generateErrorFingerprint","errorId","generateErrorId","errorEvent","id","timestamp","Date","url","location","href","userAgent","navigator","count","existingError","Array","from","values","find","e","set","checkErrorAlerts","process","env","NODE_ENV","console","getErrors","filters","filter","timeRange","start","end","component","sort","a","b","getTime","limit","slice","performance","monitorWebVitals","setInterval","capturePerformanceMetrics","document","addEventListener","visibilityState","PerformanceObserver","entryList","entries","getEntries","lastEntry","length","recordMetric","startTime","observe","entryTypes","forEach","entry","processingStart","clsValue","hadRecentInput","value","metrics","loadTime","getLoadTime","renderTime","getRenderTime","memoryUsage","getMemoryUsage","bundleSize","getBundleSize","apiResponseTime","getAverageApiResponseTime","apiErrorRate","getApiErrorRate","sessionDuration","getSessionDuration","pageViews","getPageViews","bounceRate","getBounceRate","page","pathname","device","getDeviceType","browser","getBrowserType","userId","getUserId","push","checkPerformanceAlerts","log","name","metric","checkMetricAlerts","defaultRules","threshold","operator","severity","cooldown","rule","recentErrors","now","errorRate","triggerAlert","m","Object","metricName","relevantRules","shouldTrigger","evaluateAlertCondition","canTriggerAlert","lastTriggered","cooldownMs","timeSinceLastTrigger","ruleId","alertData","get","alertId","generateAlertId","alert","acknowledged","sendAlertNotifications","warn","alerts","channels","email","join","slack","webhook","toString","substr","content","hash","i","char","charCodeAt","navigation","getEntriesByType","loadEventEnd","loadEventStart","domContentLoadedEventEnd","domContentLoadedEventStart","memory","usedJSHeapSize","parseInt","split","width","innerWidth","getPerformanceMetrics","data","getActiveAlerts","resolvedAt","acknowledgeAlert","resolveAlert","getMonitoringSummary","oneHourAgo","recentMetrics","total","critical","warning","averageLoadTime","reduce","sum","averageMemoryUsage","active","unacknowledged","system","uptime"],"mappings":"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"}