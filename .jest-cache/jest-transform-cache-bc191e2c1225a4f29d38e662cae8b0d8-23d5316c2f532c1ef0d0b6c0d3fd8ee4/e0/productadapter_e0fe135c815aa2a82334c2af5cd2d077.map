{"version":3,"sources":["C:\\Users\\marti\\Desktop\\DESARROLLOSW\\BOILERPLATTE E-COMMERCE\\src\\lib\\adapters\\product-adapter.ts"],"sourcesContent":["// ===================================\n// PINTEYA E-COMMERCE - ADAPTADOR DE PRODUCTOS\n// ===================================\n\nimport { Product } from '@/types/product'\nimport { ProductWithCategory } from '@/types/api'\n\n/**\n * Convierte un producto de la API al formato esperado por los componentes\n * @param apiProduct - Producto desde la API\n * @returns Product - Producto en formato de componente\n */\nexport function adaptApiProductToComponent(\n  apiProduct: ProductWithCategory\n): Product & { name?: string } {\n  // Mapear correctamente las imágenes desde la estructura de BD a la estructura de componentes\n  const images = apiProduct.images || {}\n\n  return {\n    id: apiProduct.id,\n    title: apiProduct.name,\n    name: apiProduct.name, // Agregar el campo name para compatibilidad\n    brand: apiProduct.brand, // Agregar el campo brand que faltaba\n    reviews: Math.floor(Math.random() * 50) + 1, // Temporal: generar reviews aleatorias\n    price: apiProduct.price,\n    // FIX CRÍTICO: Solo usar discounted_price si es menor que price, sino undefined\n    discountedPrice:\n      apiProduct.discounted_price && apiProduct.discounted_price < apiProduct.price\n        ? apiProduct.discounted_price\n        : undefined,\n    imgs: {\n      // Mapear desde la estructura real de la BD: { main, gallery, thumbnail }\n      thumbnails: images.thumbnail ? [images.thumbnail] : ['/images/products/placeholder.svg'],\n      previews: images.main\n        ? [images.main]\n        : images.gallery?.[0]\n          ? [images.gallery[0]]\n          : ['/images/products/placeholder.svg'],\n    },\n  }\n}\n\n/**\n * Convierte una lista de productos de la API al formato de componentes\n * @param apiProducts - Lista de productos desde la API\n * @returns Product[] - Lista de productos en formato de componente\n */\nexport function adaptApiProductsToComponents(\n  apiProducts: ProductWithCategory[]\n): (Product & { name?: string })[] {\n  return apiProducts.map(adaptApiProductToComponent)\n}\n\n/**\n * Convierte un producto de componente al formato de la API\n * @param componentProduct - Producto en formato de componente\n * @returns Partial<ProductWithCategory> - Producto en formato de API\n */\nexport function adaptComponentProductToApi(\n  componentProduct: Product\n): Partial<ProductWithCategory> {\n  return {\n    id: componentProduct.id,\n    name: componentProduct.title,\n    price: componentProduct.price,\n    discounted_price:\n      componentProduct.discountedPrice !== componentProduct.price\n        ? componentProduct.discountedPrice\n        : null,\n    images: componentProduct.imgs,\n    stock: 50, // Valor por defecto\n  }\n}\n\n/**\n * Verifica si un producto tiene descuento\n * @param product - Producto\n * @returns boolean\n */\nexport function hasDiscount(product: Product | ProductWithCategory): boolean {\n  if ('discountedPrice' in product) {\n    return product.discountedPrice !== undefined && product.discountedPrice < product.price\n  }\n  if ('discounted_price' in product) {\n    return product.discounted_price !== null && product.discounted_price < product.price\n  }\n  return false\n}\n\n/**\n * Calcula el porcentaje de descuento\n * @param product - Producto\n * @returns number - Porcentaje de descuento\n */\nexport function getDiscountPercentage(product: Product | ProductWithCategory): number {\n  let originalPrice: number\n  let discountedPrice: number\n\n  if ('discountedPrice' in product) {\n    originalPrice = product.price\n    discountedPrice = product.discountedPrice\n  } else {\n    originalPrice = product.price\n    discountedPrice = product.discounted_price || product.price\n  }\n\n  if (discountedPrice >= originalPrice) {\n    return 0\n  }\n\n  return Math.round(((originalPrice - discountedPrice) / originalPrice) * 100)\n}\n\n/**\n * Obtiene el precio final del producto (con descuento si aplica)\n * @param product - Producto\n * @returns number - Precio final\n */\nexport function getFinalPrice(product: Product | ProductWithCategory): number {\n  if ('discountedPrice' in product) {\n    return product.discountedPrice\n  }\n  return product.discounted_price ?? product.price\n}\n\n/**\n * Obtiene la imagen principal del producto\n * @param product - Producto\n * @returns string - URL de la imagen\n */\nexport function getMainImage(product: Product | ProductWithCategory): string {\n  if ('imgs' in product && product.imgs?.previews?.[0]) {\n    return product.imgs.previews[0]\n  }\n  if ('images' in product && product.images?.previews?.[0]) {\n    return product.images.previews[0]\n  }\n  return '/images/products/placeholder.svg'\n}\n\n/**\n * Valida y obtiene una URL de imagen válida, manejando cadenas vacías y undefined\n * @param imageUrl - URL de imagen a validar\n * @param fallback - URL de fallback (por defecto: placeholder)\n * @returns string - URL de imagen válida\n */\nexport function getValidImageUrl(\n  imageUrl: string | undefined | null,\n  fallback: string = '/images/products/placeholder.svg'\n): string {\n  // Verificar si la imagen existe y no es una cadena vacía o solo espacios\n  if (imageUrl && typeof imageUrl === 'string' && imageUrl.trim() !== '') {\n    return imageUrl.trim()\n  }\n  return fallback\n}\n\n/**\n * Obtiene la imagen thumbnail del producto con validación robusta\n * @param product - Producto\n * @returns string - URL de la imagen thumbnail válida\n */\nexport function getThumbnailImage(product: Product | ProductWithCategory): string {\n  let imageUrl: string | undefined\n\n  if ('imgs' in product && product.imgs?.thumbnails?.[0]) {\n    imageUrl = product.imgs.thumbnails[0]\n  } else if ('images' in product && product.images?.thumbnails?.[0]) {\n    imageUrl = product.images.thumbnails[0]\n  }\n\n  return getValidImageUrl(imageUrl)\n}\n\n/**\n * Obtiene la imagen preview del producto con validación robusta\n * @param product - Producto\n * @returns string - URL de la imagen preview válida\n */\nexport function getPreviewImage(product: Product | ProductWithCategory): string {\n  let imageUrl: string | undefined\n\n  if ('imgs' in product && product.imgs?.previews?.[0]) {\n    imageUrl = product.imgs.previews[0]\n  } else if ('images' in product && product.images?.previews?.[0]) {\n    imageUrl = product.images.previews[0]\n  }\n\n  return getValidImageUrl(imageUrl)\n}\n\n/**\n * Formatea el precio para mostrar en pesos argentinos\n * @param price - Precio\n * @returns string - Precio formateado\n */\nexport function formatPrice(price: number): string {\n  return new Intl.NumberFormat('es-AR', {\n    style: 'currency',\n    currency: 'ARS',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0,\n  }).format(price)\n}\n\n/**\n * Genera un slug a partir del nombre del producto\n * @param name - Nombre del producto\n * @returns string - Slug\n */\nexport function generateSlug(name: string): string {\n  return name\n    .toLowerCase()\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '') // Remover acentos\n    .replace(/[^a-z0-9\\s-]/g, '') // Remover caracteres especiales\n    .replace(/\\s+/g, '-') // Reemplazar espacios con guiones\n    .replace(/-+/g, '-') // Remover guiones múltiples\n    .replace(/^-|-$/g, '') // Remover guiones al inicio y final\n}\n"],"names":["adaptApiProductToComponent","adaptApiProductsToComponents","adaptComponentProductToApi","formatPrice","generateSlug","getDiscountPercentage","getFinalPrice","getMainImage","getPreviewImage","getThumbnailImage","getValidImageUrl","hasDiscount","apiProduct","images","id","title","name","brand","reviews","Math","floor","random","price","discountedPrice","discounted_price","undefined","imgs","thumbnails","thumbnail","previews","main","gallery","apiProducts","map","componentProduct","stock","product","originalPrice","round","imageUrl","fallback","trim","Intl","NumberFormat","style","currency","minimumFractionDigits","maximumFractionDigits","format","toLowerCase","normalize","replace"],"mappings":"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"}