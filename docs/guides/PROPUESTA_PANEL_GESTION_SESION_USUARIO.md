# üë§ Propuesta: Panel de Gesti√≥n de Sesi√≥n del Usuario - Pinteya E-commerce

**Fecha**: 13 de Septiembre, 2025  
**Proyecto**: Pinteya E-commerce  
**Objetivo**: Implementar dashboard personal completo para usuarios finales  

---

## üéØ **OBJETIVO**

Crear un **panel de administraci√≥n de sesi√≥n personal** completo que permita a los usuarios finales gestionar su cuenta, sesiones, preferencias y configuraciones de seguridad de manera intuitiva y segura.

---

## üìã **ESPECIFICACIONES FUNCIONALES**

### **1. Dashboard Principal** (`/dashboard`)

#### **Informaci√≥n Mostrada**:
- **Resumen de cuenta**: Nombre, email, fecha de registro
- **Estad√≠sticas personales**: √ìrdenes, gasto total, productos favoritos
- **Actividad reciente**: √öltimos logins, √≥rdenes, cambios de perfil
- **Accesos r√°pidos**: Editar perfil, ver √≥rdenes, configuraci√≥n

#### **M√©tricas Clave**:
```typescript
interface DashboardMetrics {
  totalOrders: number;
  totalSpent: number;
  pendingOrders: number;
  favoriteProducts: number;
  lastLoginDate: string;
  accountAge: string;
  sessionsActive: number;
}
```

### **2. Gesti√≥n de Perfil** (`/dashboard/profile`)

#### **Informaci√≥n Editable**:
- **Datos personales**: Nombre, apellido, tel√©fono
- **Avatar**: Subida y gesti√≥n de imagen de perfil
- **Direcciones**: Gesti√≥n completa de direcciones de env√≠o
- **Preferencias b√°sicas**: Idioma, zona horaria, moneda

#### **Funcionalidades**:
- ‚úÖ Validaci√≥n en tiempo real
- ‚úÖ Previsualizaci√≥n de cambios
- ‚úÖ Confirmaci√≥n por email para cambios cr√≠ticos
- ‚úÖ Historial de cambios

### **3. Gesti√≥n de Sesiones** (`/dashboard/sessions`)

#### **Informaci√≥n de Sesiones**:
```typescript
interface UserSession {
  id: string;
  deviceInfo: {
    browser: string;
    os: string;
    device: string;
  };
  location: {
    ip: string;
    city: string;
    country: string;
  };
  createdAt: string;
  lastActivity: string;
  isCurrent: boolean;
}
```

#### **Funcionalidades**:
- ‚úÖ **Ver sesiones activas**: Lista de todos los dispositivos conectados
- ‚úÖ **Cerrar sesiones**: Capacidad de cerrar sesiones espec√≠ficas o todas
- ‚úÖ **Detectar actividad sospechosa**: Alertas de logins desde ubicaciones nuevas
- ‚úÖ **Informaci√≥n detallada**: Browser, OS, IP, ubicaci√≥n aproximada

### **4. Configuraci√≥n de Seguridad** (`/dashboard/security`)

#### **Opciones de Seguridad**:
- **Cambio de contrase√±a**: (Futuro - cuando se implemente auth por email)
- **Autenticaci√≥n de dos factores**: Configuraci√≥n de 2FA
- **C√≥digos de respaldo**: Generaci√≥n y gesti√≥n
- **Alertas de seguridad**: Configuraci√≥n de notificaciones
- **Dispositivos de confianza**: Gesti√≥n de dispositivos conocidos

#### **Logs de Seguridad**:
- Historial de cambios de contrase√±a
- Intentos de login fallidos
- Cambios en configuraci√≥n de seguridad
- Accesos desde dispositivos nuevos

### **5. Preferencias de Usuario** (`/dashboard/preferences`)

#### **Configuraciones Disponibles**:
```typescript
interface UserPreferences {
  notifications: {
    email: boolean;
    orderUpdates: boolean;
    promotions: boolean;
    securityAlerts: boolean;
  };
  display: {
    language: 'es' | 'en';
    timezone: string;
    currency: 'ARS' | 'USD';
    theme: 'light' | 'dark' | 'auto';
  };
  privacy: {
    profileVisibility: 'public' | 'private';
    activityTracking: boolean;
    marketingEmails: boolean;
  };
}
```

### **6. Historial de Actividad** (`/dashboard/activity`)

#### **Eventos Registrados**:
- Logins y logouts
- Cambios de perfil
- √ìrdenes realizadas
- Cambios de configuraci√≥n
- Accesos a secciones sensibles

#### **Filtros Disponibles**:
- Por tipo de evento
- Por rango de fechas
- Por dispositivo/ubicaci√≥n
- Por nivel de importancia

---

## üèóÔ∏è **ARQUITECTURA T√âCNICA**

### **1. Estructura de Rutas**
```typescript
src/app/(site)/(pages)/dashboard/
‚îú‚îÄ‚îÄ page.tsx                     // Dashboard principal
‚îú‚îÄ‚îÄ layout.tsx                   // Layout com√∫n del dashboard
‚îú‚îÄ‚îÄ profile/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                // Perfil principal
‚îÇ   ‚îú‚îÄ‚îÄ edit/page.tsx           // Editor de perfil
‚îÇ   ‚îî‚îÄ‚îÄ avatar/page.tsx         // Gesti√≥n de avatar
‚îú‚îÄ‚îÄ sessions/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                // Gesti√≥n de sesiones
‚îÇ   ‚îî‚îÄ‚îÄ [sessionId]/page.tsx    // Detalles de sesi√≥n espec√≠fica
‚îú‚îÄ‚îÄ security/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                // Configuraci√≥n de seguridad
‚îÇ   ‚îú‚îÄ‚îÄ 2fa/page.tsx           // Configuraci√≥n 2FA
‚îÇ   ‚îî‚îÄ‚îÄ activity/page.tsx       // Log de actividad de seguridad
‚îú‚îÄ‚îÄ preferences/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                // Preferencias generales
‚îÇ   ‚îú‚îÄ‚îÄ notifications/page.tsx  // Configuraci√≥n de notificaciones
‚îÇ   ‚îî‚îÄ‚îÄ privacy/page.tsx        // Configuraci√≥n de privacidad
‚îî‚îÄ‚îÄ activity/
    ‚îî‚îÄ‚îÄ page.tsx                // Historial de actividad completo
```

### **2. APIs Necesarias**
```typescript
// Gesti√≥n de sesiones
GET    /api/user/sessions              // Listar sesiones activas
DELETE /api/user/sessions/[id]         // Cerrar sesi√≥n espec√≠fica
DELETE /api/user/sessions/all          // Cerrar todas las sesiones excepto actual
POST   /api/user/sessions/trust        // Marcar dispositivo como confiable

// Actividad y logs
GET    /api/user/activity              // Historial de actividad
GET    /api/user/activity/security     // Logs espec√≠ficos de seguridad
POST   /api/user/activity/log          // Registrar evento personalizado

// Preferencias
GET    /api/user/preferences           // Obtener preferencias
PUT    /api/user/preferences           // Actualizar preferencias
PATCH  /api/user/preferences/[section] // Actualizar secci√≥n espec√≠fica

// Seguridad
GET    /api/user/security              // Configuraci√≥n de seguridad
PUT    /api/user/security/2fa          // Configurar 2FA
POST   /api/user/security/backup-codes // Generar c√≥digos de respaldo
PUT    /api/user/security/alerts       // Configurar alertas

// Avatar y archivos
POST   /api/user/avatar                // Subir avatar
DELETE /api/user/avatar                // Eliminar avatar
```

### **3. Componentes Principales**
```typescript
// Dashboard
src/components/User/Dashboard/
‚îú‚îÄ‚îÄ UserDashboard.tsx               // Dashboard principal
‚îú‚îÄ‚îÄ DashboardStats.tsx              // Tarjetas de estad√≠sticas
‚îú‚îÄ‚îÄ QuickActions.tsx                // Acciones r√°pidas
‚îú‚îÄ‚îÄ RecentActivity.tsx              // Actividad reciente
‚îî‚îÄ‚îÄ WelcomeSection.tsx              // Secci√≥n de bienvenida

// Perfil
src/components/User/Profile/
‚îú‚îÄ‚îÄ ProfileEditor.tsx               // Editor de perfil
‚îú‚îÄ‚îÄ AvatarUpload.tsx               // Subida de avatar
‚îú‚îÄ‚îÄ AddressManager.tsx             // Gesti√≥n de direcciones
‚îî‚îÄ‚îÄ ProfilePreview.tsx             // Vista previa del perfil

// Sesiones
src/components/User/Sessions/
‚îú‚îÄ‚îÄ SessionManager.tsx             // Gesti√≥n de sesiones
‚îú‚îÄ‚îÄ SessionCard.tsx                // Tarjeta de sesi√≥n individual
‚îú‚îÄ‚îÄ SessionDetails.tsx             // Detalles de sesi√≥n
‚îî‚îÄ‚îÄ SecurityAlert.tsx              // Alertas de seguridad

// Configuraci√≥n
src/components/User/Settings/
‚îú‚îÄ‚îÄ SecuritySettings.tsx           // Configuraci√≥n de seguridad
‚îú‚îÄ‚îÄ TwoFactorAuth.tsx             // Configuraci√≥n 2FA
‚îú‚îÄ‚îÄ PreferencesForm.tsx           // Formulario de preferencias
‚îú‚îÄ‚îÄ NotificationSettings.tsx      // Configuraci√≥n de notificaciones
‚îî‚îÄ‚îÄ PrivacySettings.tsx           // Configuraci√≥n de privacidad

// Actividad
src/components/User/Activity/
‚îú‚îÄ‚îÄ ActivityLog.tsx               // Log de actividad
‚îú‚îÄ‚îÄ ActivityItem.tsx              // Item individual de actividad
‚îú‚îÄ‚îÄ ActivityFilters.tsx           // Filtros de actividad
‚îî‚îÄ‚îÄ SecurityLog.tsx               // Log espec√≠fico de seguridad
```

### **4. Hooks Personalizados**
```typescript
// Hooks de gesti√≥n
src/hooks/user/
‚îú‚îÄ‚îÄ useUserSessions.ts            // Gesti√≥n de sesiones
‚îú‚îÄ‚îÄ useUserActivity.ts            // Historial de actividad
‚îú‚îÄ‚îÄ useUserPreferences.ts         // Preferencias de usuario
‚îú‚îÄ‚îÄ useUserSecurity.ts            // Configuraci√≥n de seguridad
‚îú‚îÄ‚îÄ useAvatarUpload.ts           // Subida de avatar
‚îî‚îÄ‚îÄ useSecurityAlerts.ts         // Alertas de seguridad
```

---

## üé® **DISE√ëO DE INTERFAZ**

### **1. Layout del Dashboard**
```typescript
// Layout com√∫n para todas las p√°ginas del dashboard
const DashboardLayout = () => (
  <div className="min-h-screen bg-gray-50">
    <DashboardHeader />
    <div className="flex">
      <DashboardSidebar />
      <main className="flex-1 p-6">
        {children}
      </main>
    </div>
  </div>
);
```

### **2. Navegaci√≥n Lateral**
```typescript
const sidebarItems = [
  { icon: Home, label: 'Dashboard', href: '/dashboard' },
  { icon: User, label: 'Mi Perfil', href: '/dashboard/profile' },
  { icon: Shield, label: 'Seguridad', href: '/dashboard/security' },
  { icon: Monitor, label: 'Sesiones', href: '/dashboard/sessions' },
  { icon: Settings, label: 'Preferencias', href: '/dashboard/preferences' },
  { icon: Activity, label: 'Actividad', href: '/dashboard/activity' },
  { icon: Package, label: 'Mis √ìrdenes', href: '/orders' },
];
```

### **3. Componentes de UI Reutilizables**
- **DashboardCard**: Tarjetas con estad√≠sticas
- **SettingsSection**: Secciones de configuraci√≥n
- **ActivityTimeline**: Timeline de actividad
- **SessionCard**: Tarjeta de sesi√≥n con acciones
- **SecurityBadge**: Indicadores de estado de seguridad

---

## üîí **CONSIDERACIONES DE SEGURIDAD**

### **1. Autenticaci√≥n y Autorizaci√≥n**
- ‚úÖ Verificar sesi√≥n v√°lida en todas las rutas
- ‚úÖ Validar que el usuario solo acceda a sus propios datos
- ‚úÖ Rate limiting en APIs sensibles
- ‚úÖ Logs de auditor√≠a para cambios importantes

### **2. Protecci√≥n de Datos**
- ‚úÖ Encriptar informaci√≥n sensible
- ‚úÖ No exponer tokens o IDs internos
- ‚úÖ Validaci√≥n estricta en el backend
- ‚úÖ Sanitizaci√≥n de inputs del usuario

### **3. Gesti√≥n de Sesiones**
- ‚úÖ Invalidar sesiones al cerrar remotamente
- ‚úÖ Detectar patrones de uso sospechosos
- ‚úÖ Limitar n√∫mero de sesiones concurrentes
- ‚úÖ Notificar cambios de seguridad importantes

---

## üìä **M√âTRICAS Y MONITOREO**

### **1. M√©tricas de Uso**
- P√°ginas m√°s visitadas del dashboard
- Tiempo promedio en cada secci√≥n
- Funcionalidades m√°s utilizadas
- Tasa de abandono por p√°gina

### **2. M√©tricas de Seguridad**
- N√∫mero de sesiones cerradas remotamente
- Intentos de acceso sospechosos
- Cambios de configuraci√≥n de seguridad
- Activaci√≥n de 2FA

### **3. M√©tricas de Satisfacci√≥n**
- Feedback de usuarios sobre el dashboard
- Tiempo para completar tareas comunes
- Errores reportados por usuarios
- Solicitudes de nuevas funcionalidades

---

## üöÄ **PLAN DE IMPLEMENTACI√ìN**

### **Fase 1: Dashboard B√°sico** (1-2 semanas)
- [ ] Crear estructura de rutas
- [ ] Implementar layout y navegaci√≥n
- [ ] Dashboard principal con estad√≠sticas b√°sicas
- [ ] Integraci√≥n con APIs existentes

### **Fase 2: Gesti√≥n de Perfil** (1 semana)
- [ ] Editor de perfil completo
- [ ] Subida de avatar
- [ ] Gesti√≥n de direcciones mejorada
- [ ] Validaciones y confirmaciones

### **Fase 3: Sesiones y Seguridad** (2-3 semanas)
- [ ] API de gesti√≥n de sesiones
- [ ] Componente de sesiones activas
- [ ] Configuraci√≥n de seguridad b√°sica
- [ ] Historial de actividad

### **Fase 4: Preferencias Avanzadas** (1-2 semanas)
- [ ] Sistema completo de preferencias
- [ ] Configuraci√≥n de notificaciones
- [ ] Configuraci√≥n de privacidad
- [ ] Integraci√≥n con sistema de emails

### **Fase 5: Funcionalidades Avanzadas** (2-3 semanas)
- [ ] Autenticaci√≥n de dos factores
- [ ] Alertas de seguridad autom√°ticas
- [ ] An√°lisis de actividad avanzado
- [ ] Exportaci√≥n de datos personales

---

## üéØ **CRITERIOS DE √âXITO**

### **Funcionales**
- ‚úÖ Usuarios pueden gestionar completamente su perfil
- ‚úÖ Visualizaci√≥n clara de sesiones activas
- ‚úÖ Configuraci√≥n de preferencias funcional
- ‚úÖ Historial de actividad completo y √∫til

### **T√©cnicos**
- ‚úÖ Tiempo de carga < 2 segundos
- ‚úÖ Responsive en todos los dispositivos
- ‚úÖ APIs con tiempo de respuesta < 500ms
- ‚úÖ Cobertura de tests > 80%

### **Seguridad**
- ‚úÖ Todas las acciones auditadas
- ‚úÖ Validaci√≥n completa en backend
- ‚úÖ Protecci√≥n contra ataques comunes
- ‚úÖ Cumplimiento con mejores pr√°cticas

---

**Documento generado el**: 13 de Septiembre, 2025  
**Estado**: Propuesta para implementaci√≥n  
**Pr√≥ximo paso**: Aprobaci√≥n y planificaci√≥n detallada
