<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Trending Searches</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .section {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .section h3 {
        margin-top: 0;
        color: #333;
      }
      .log-entry {
        background: #f8f9fa;
        padding: 10px;
        margin: 5px 0;
        border-left: 4px solid #007bff;
        font-family: monospace;
        font-size: 12px;
      }
      .error {
        border-left-color: #dc3545;
        background: #f8d7da;
      }
      .success {
        border-left-color: #28a745;
        background: #d4edda;
      }
      .warning {
        border-left-color: #ffc107;
        background: #fff3cd;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .clear-btn {
        background: #dc3545;
      }
      .clear-btn:hover {
        background: #c82333;
      }
      .test-btn {
        background: #28a745;
      }
      .test-btn:hover {
        background: #218838;
      }
      .api-response {
        background: #e9ecef;
        padding: 15px;
        border-radius: 5px;
        margin-top: 10px;
        white-space: pre-wrap;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîç Debug Trending Searches</h1>

      <div class="section">
        <h3>Controles de Debug</h3>
        <button onclick="testTrendingAPI()" class="test-btn">Test API /api/search/trending</button>
        <button onclick="testSearchAutocomplete()" class="test-btn">Test SearchAutocomplete</button>
        <button onclick="clearLogs()" class="clear-btn">Limpiar Logs</button>
        <button onclick="exportLogs()">Exportar Logs</button>
      </div>

      <div class="section">
        <h3>Estado de la API</h3>
        <div id="api-status">Esperando test...</div>
      </div>

      <div class="section">
        <h3>Respuesta de la API</h3>
        <div id="api-response" class="api-response">No hay datos a√∫n...</div>
      </div>

      <div class="section">
        <h3>Logs de Consola (Filtrados)</h3>
        <div id="console-logs"></div>
      </div>

      <div class="section">
        <h3>An√°lisis de Componentes</h3>
        <div id="component-analysis">
          <p>Verificando componentes en la p√°gina...</p>
        </div>
      </div>
    </div>

    <script>
      let logs = []

      // Interceptar console.log
      const originalLog = console.log
      const originalError = console.error
      const originalWarn = console.warn

      console.log = function (...args) {
        const message = args.join(' ')
        if (
          message.includes('trending') ||
          message.includes('SearchAutocomplete') ||
          message.includes('üîç')
        ) {
          addLog('info', message)
        }
        originalLog.apply(console, args)
      }

      console.error = function (...args) {
        const message = args.join(' ')
        addLog('error', message)
        originalError.apply(console, args)
      }

      console.warn = function (...args) {
        const message = args.join(' ')
        if (message.includes('trending') || message.includes('SearchAutocomplete')) {
          addLog('warning', message)
        }
        originalWarn.apply(console, args)
      }

      function addLog(type, message) {
        const timestamp = new Date().toLocaleTimeString()
        logs.push({ type, message, timestamp })

        const logContainer = document.getElementById('console-logs')
        const logEntry = document.createElement('div')
        logEntry.className = `log-entry ${type}`
        logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`
        logContainer.appendChild(logEntry)

        // Auto-scroll
        logContainer.scrollTop = logContainer.scrollHeight
      }

      async function testTrendingAPI() {
        const statusDiv = document.getElementById('api-status')
        const responseDiv = document.getElementById('api-response')

        statusDiv.innerHTML = 'üîÑ Probando API...'

        try {
          const response = await fetch('/api/search/trending')
          const data = await response.json()

          statusDiv.innerHTML = `‚úÖ API Status: ${response.status} ${response.statusText}`
          responseDiv.textContent = JSON.stringify(data, null, 2)

          addLog('success', `API Response: ${JSON.stringify(data)}`)

          // Analizar la respuesta
          if (data.trending && Array.isArray(data.trending)) {
            addLog('info', `Trending searches encontradas: ${data.trending.length}`)
            data.trending.forEach((item, index) => {
              addLog('info', `Trending ${index + 1}: ${JSON.stringify(item)}`)
            })
          } else {
            addLog('warning', 'No se encontraron trending searches en la respuesta')
          }
        } catch (error) {
          statusDiv.innerHTML = `‚ùå Error: ${error.message}`
          responseDiv.textContent = `Error: ${error.message}`
          addLog('error', `API Error: ${error.message}`)
        }
      }

      function testSearchAutocomplete() {
        addLog('info', 'Iniciando an√°lisis de SearchAutocomplete...')

        // Buscar elementos de SearchAutocomplete en la p√°gina
        const searchInputs = document.querySelectorAll(
          'input[type="search"], input[placeholder*="Buscar"]'
        )
        addLog('info', `Inputs de b√∫squeda encontrados: ${searchInputs.length}`)

        searchInputs.forEach((input, index) => {
          addLog('info', `Input ${index + 1}: ${input.placeholder || 'Sin placeholder'}`)
        })

        // Buscar dropdowns de sugerencias
        const dropdowns = document.querySelectorAll('[role="listbox"], .suggestions, .autocomplete')
        addLog('info', `Dropdowns de sugerencias encontrados: ${dropdowns.length}`)

        // Simular focus en el primer input de b√∫squeda
        if (searchInputs.length > 0) {
          addLog('info', 'Simulando focus en el input de b√∫squeda...')
          searchInputs[0].focus()

          setTimeout(() => {
            const visibleDropdowns = document.querySelectorAll(
              '[role="listbox"]:not([style*="display: none"])'
            )
            addLog('info', `Dropdowns visibles despu√©s del focus: ${visibleDropdowns.length}`)

            visibleDropdowns.forEach((dropdown, index) => {
              const suggestions = dropdown.querySelectorAll('[role="option"], li, .suggestion-item')
              addLog('info', `Dropdown ${index + 1}: ${suggestions.length} sugerencias`)

              suggestions.forEach((suggestion, suggIndex) => {
                addLog(
                  'info',
                  `  Sugerencia ${suggIndex + 1}: ${suggestion.textContent?.trim() || 'Sin texto'}`
                )
              })
            })
          }, 1000)
        }
      }

      function clearLogs() {
        logs = []
        document.getElementById('console-logs').innerHTML = ''
        addLog('info', 'Logs limpiados')
      }

      function exportLogs() {
        const logText = logs
          .map(log => `[${log.timestamp}] ${log.type.toUpperCase()}: ${log.message}`)
          .join('\n')
        const blob = new Blob([logText], { type: 'text/plain' })
        const url = URL.createObjectURL(blob)
        const a = document.createElement('a')
        a.href = url
        a.download = `trending-searches-debug-${new Date().toISOString().slice(0, 19)}.txt`
        a.click()
        URL.revokeObjectURL(url)
      }

      // An√°lisis inicial de componentes
      window.addEventListener('load', () => {
        setTimeout(() => {
          const analysisDiv = document.getElementById('component-analysis')

          // Verificar si React est√° cargado
          const hasReact = typeof React !== 'undefined'
          analysisDiv.innerHTML += `<p>React cargado: ${hasReact ? '‚úÖ' : '‚ùå'}</p>`

          // Verificar elementos de b√∫squeda
          const searchElements = document.querySelectorAll(
            'input[type="search"], input[placeholder*="Buscar"]'
          )
          analysisDiv.innerHTML += `<p>Elementos de b√∫squeda: ${searchElements.length}</p>`

          // Verificar si hay elementos con atributos de trending
          const trendingElements = document.querySelectorAll(
            '[data-trending], .trending, [class*="trending"]'
          )
          analysisDiv.innerHTML += `<p>Elementos relacionados con trending: ${trendingElements.length}</p>`

          addLog('info', 'An√°lisis inicial completado')
        }, 2000)
      })

      // Auto-test inicial
      setTimeout(() => {
        addLog('info', 'Iniciando debug autom√°tico...')
        testTrendingAPI()
      }, 1000)
    </script>
  </body>
</html>
